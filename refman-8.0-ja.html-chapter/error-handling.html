<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>付録 B エラーメッセージと一般的な問題</title><link rel="stylesheet" type="text/css" href="mvl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="MySQL 8.0 リファレンスマニュアル"><link rel="up" href="index.html" title="MySQL 8.0 リファレンスマニュアル"><link rel="prev" href="faqs.html" title="付録 A MySQL 8.0 のよくある質問"><link rel="next" href="indexes.html" title="付録 C インデックス"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">付録 B エラーメッセージと一般的な問題</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="faqs.html">前</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="indexes.html">次へ</a></td></tr></table><hr></div><div class="status-header"><p class="alert">このページは機械翻訳したものです。</p></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="error-handling"></a>付録 B エラーメッセージと一般的な問題</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="section"><a href="error-handling.html#error-message-elements">B.1 エラーメッセージのソースと要素</a></span></dt><dt><span class="section"><a href="error-handling.html#error-interfaces">B.2 エラー情報インタフェース</a></span></dt><dt><span class="section"><a href="error-handling.html#problems">B.3 問題および一般的なエラー</a></span></dt><dd><dl><dt><span class="section"><a href="error-handling.html#what-is-crashing">B.3.1 問題の原因を判別する方法</a></span></dt><dt><span class="section"><a href="error-handling.html#common-errors">B.3.2 MySQL プログラム使用時の一般的なエラー</a></span></dt><dt><span class="section"><a href="error-handling.html#administration-issues">B.3.3 管理関連の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#query-issues">B.3.4 クエリー関連の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#optimizer-issues">B.3.5 オプティマイザ関連の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#table-definition-issues">B.3.6 テーブル定義関連の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#known-issues">B.3.7 MySQL の既知の問題</a></span></dt></dl></dd></dl></div><p>
    この付録では、MySQL で提供されるエラー情報のタイプとその情報の取得方法について説明します。 最後のセクションでは、トラブルシューティングについて説明します。 発生する可能性のある一般的な問題とエラー、および潜在的な解決策について説明します。 
  </p><h2><a name="idm45302162354416"></a>追加のリソース</h2><p>
    その他のエラー関連ドキュメントは次のとおりです:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        サーバーがエラーログを書き込む場所と方法の構成に関する情報: <a class="xref" href="server-administration.html#error-log" title="5.4.2 エラーログ">セクション5.4.2「エラーログ」</a>
      </p></li><li class="listitem"><p>
        エラーメッセージに使用される文字セットに関する情報: <a class="xref" href="charset.html#charset-errors" title="10.6 エラーメッセージ文字セット">セクション10.6「エラーメッセージ文字セット」</a>
      </p></li><li class="listitem"><p>
        エラーメッセージに使用される言語に関する情報: <a class="xref" href="charset.html#error-message-language" title="10.12 エラーメッセージ言語の設定">セクション10.12「エラーメッセージ言語の設定」</a>
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> に関連するエラーに関する情報: <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="15.21.4 InnoDB のエラー処理">セクション15.21.4「InnoDB のエラー処理」</a>
      </p></li><li class="listitem"><p>
        MySQL サーバーおよびクライアントプログラムによって生成されるエラーメッセージの説明: <a class="ulink" href="https://dev.mysql.com/doc/mysql-errors/8.0/en/" target="_top">MySQL 8.0 Error Message Reference</a>
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="error-message-elements"></a>B.1 エラーメッセージのソースと要素</h2></div></div></div><p>
      このセクションでは、エラーメッセージが MySQL 内でどのように生成されるか、およびエラーメッセージに含まれる要素について説明します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="error-handling.html#error-sources" title="エラーメッセージのソース">エラーメッセージのソース</a></p></li><li class="listitem"><p><a class="xref" href="error-handling.html#error-elements" title="エラーメッセージの要素">エラーメッセージの要素</a></p></li><li class="listitem"><p><a class="xref" href="error-handling.html#error-code-ranges" title="エラーコード範囲">エラーコード範囲</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="error-sources"></a>エラーメッセージのソース</h3></div></div></div><p>
        エラーメッセージは、サーバー側またはクライアント側で発生する可能性があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー側では、SQL ステートメントの実行中に発生する問題などの結果として、起動および停止プロセス中にエラーメッセージが表示される場合があります。
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                MySQL サーバーは、エラーログにいくつかのエラーメッセージを書き込みます。 これらは、データベース管理者にとって関心のある問題、または DBA アクションが必要な問題を示します。 
              </p></li><li class="listitem"><p>
                サーバーは、ほかのエラーメッセージをクライアントプログラムに送信します。 これらは、特定のクライアントにのみ関連する問題を示します。 MySQL クライアントライブラリは、サーバーから受信したエラーを取得し、ホストクライアントプログラムで使用できるようにします。 
              </p></li></ul></div></li><li class="listitem"><p>
            クライアント側のエラーメッセージは MySQL クライアントライブラリ内から生成され、通常はサーバーとの通信に問題が発生します。
          </p></li></ul></div><p>
        エラーログに書き込まれるサーバー側のエラーメッセージの例:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            起動プロセス中に生成されるこのメッセージには、ステータスインジケータまたは進捗インジケータが表示されます:
          </p><pre class="programlisting">2018-10-28T13:01:32.735983Z 0 [Note] [MY-010303] [Server] Skipping
generation of SSL certificates as options related to SSL are specified.
</pre></li><li class="listitem"><p>
            このメッセージは、DBA アクションが必要な問題を示しています:
          </p><pre class="programlisting">2018-10-02T03:20:39.410387Z 768 [ERROR] [MY-010045] [Server] Event Scheduler:
[evtuser@localhost][myschema.e_daily] Unknown database 'mydb'
</pre></li></ul></div><p>
        <span class="command"><strong>mysql</strong></span> クライアントによって表示される、クライアントプログラムに送信されるサーバー側のエラーメッセージの例:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM no_such_table;</code></strong>
ERROR 1146 (42S02): Table 'test.no_such_table' doesn't exist
</pre><p>
        <span class="command"><strong>mysql</strong></span> クライアントによって表示される、クライアントライブラリ内からのクライアント側エラーメッセージの例:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h no-such-host</code></strong>
ERROR 2005 (HY000): Unknown MySQL server host 'no-such-host' (0)
</pre><p>
        エラーがクライアントライブラリ内から発生したか、サーバーから受信されたかにかかわらず、MySQL クライアントプログラムは様々な方法で応答できます。 図のように、ユーザーが修正策を講じることができるように、クライアントにエラーメッセージが表示される場合があります。 かわりに、クライアントは内部的に失敗した操作を解決または再試行するか、他のアクションを実行できます。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="error-elements"></a>エラーメッセージの要素</h3></div></div></div><p>
        エラーが発生した場合、エラー情報には複数の要素が含まれます: エラーコード、SQLSTATE 値、およびメッセージ文字列。 これらの要素には、次の特性があります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            エラーコード: この値は数値です。 MySQL 固有であり、他のデータベースシステムには移植できません。 
          </p><p>
            各エラー番号には対応するシンボリック値があります。 例: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                サーバーエラー番号 <code class="literal">1146</code> の記号は <code class="literal">ER_NO_SUCH_TABLE</code> です。
              </p></li><li class="listitem"><p>
                クライアントエラー番号 <code class="literal">2005</code> の記号は <code class="literal">CR_UNKNOWN_HOST</code> です。
              </p></li></ul></div><p>
            エラーメッセージで使用されるエラーコードのセットは、個別の範囲にパーティション化されます。<a class="xref" href="error-handling.html#error-code-ranges" title="エラーコード範囲">エラーコード範囲</a> を参照してください。
          </p><p>
            エラーコードは、特定の MySQL シリーズの General Availability (GA) リリース間で安定しています。 シリーズが GA ステータスになる前に、新しいコードがまだ開発中であり、変更される可能性があります。 
          </p></li><li class="listitem"><p>
            SQLSTATE 値: この値は 5 文字の文字列 (<code class="literal">'42S02'</code>など) です。 SQLSTATE 値は ANSI SQL および ODBC から取得され、数値エラーコードよりも標準化されています。 SQLSTATE 値の最初の 2 文字はエラークラスを示しています。 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                クラス = <code class="literal">'00'</code> は成功を示しています。
              </p></li><li class="listitem"><p>
                クラス = <code class="literal">'01'</code> は警告を示しています。
              </p></li><li class="listitem"><p>
                クラス = <code class="literal">'02'</code> は <span class="quote">「<span class="quote">Not Found</span>」</span> を示しています。 これは、カーソルのコンテキストに関係しており、カーソルがデータセットの最後に達したときの動作を制御するために使用します。 この状況は、行が取得されない <code class="literal">SELECT ... INTO <em class="replaceable"><code>var_list</code></em></code> ステートメントでも発生します。 
              </p></li><li class="listitem"><p>
                クラス &gt; <code class="literal">'02'</code> は例外を示しています。
              </p></li></ul></div><p>
            サーバー側エラーの場合、すべての MySQL エラー番号に対応する SQLSTATE 値があるわけではありません。 それらの場合は、<code class="literal">'HY000'</code> (一般エラー) が使用されます。 
          </p><p>
            クライアント側のエラーの場合、SQLSTATE 値は常に<code class="literal">'HY000'</code> (一般エラー) であるため、あるクライアントエラーを別のクライアントエラーと区別することは意味がありません。
          </p></li><li class="listitem"><p>
            メッセージ文字列: この文字列は、エラーのテキストによる説明を提供します。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="error-code-ranges"></a>エラーコード範囲</h3></div></div></div><p>
        エラーメッセージで使用されるエラーコードのセットは、それぞれ独自の目的を持つ個別の範囲にパーティション化されます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            1 から 999: グローバルエラーコード。 このエラーコード範囲は、サーバーおよびクライアントによって使用される共有範囲であるため、<span class="quote">「<span class="quote">global</span>」</span> と呼ばれます。 
          </p><p>
            この範囲のエラーがサーバー側で発生すると、サーバーはエラーコードをエラーログに書き込み、エラーコードの先頭にゼロを付けて 6 桁にし、<code class="literal">MY-</code> の接頭辞を追加します。
          </p><p>
            この範囲のエラーがクライアント側で発生すると、クライアントライブラリはゼロ埋込みや接頭辞なしでクライアントプログラムで使用できるようになります。
          </p></li><li class="listitem"><p>
            1,000 から 1,999: クライアントに送信されるメッセージ用に予約されているサーバーエラーコード。
          </p></li><li class="listitem"><p>
            2,000 から 2,999: クライアントライブラリで使用するために予約されているクライアントエラーコード。
          </p></li><li class="listitem"><p>
            3,000 から 4,999: クライアントに送信されるメッセージ用に予約されているサーバーエラーコード。
          </p></li><li class="listitem"><p>
            5,000 から 5,999 : クライアントに送信されるメッセージ用に X プラグイン で使用するために予約されているエラーコード。
          </p></li><li class="listitem"><p>
            10,000 から 49,999: エラーログに書き込まれるメッセージ用に予約されているサーバーエラーコード (クライアントには送信されません)。
          </p><p>
            この範囲のエラーが発生すると、サーバーはエラーログに書き込み、エラーコードの先頭にゼロを 6 桁に埋め込み、<code class="literal">MY-</code> の接頭辞を追加します。
          </p></li><li class="listitem"><p>
            50,000 から 51,999: サードパーティが使用するために予約されたエラーコード。
          </p></li></ul></div><p>
        サーバーは、エラーログに書き込まれたエラーメッセージを、クライアントに送信されたエラーメッセージとは異なる方法で処理します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバーがエラーログにメッセージを書き込むと、エラーコードが先頭にゼロを付けて 6 桁に埋め込まれ、<code class="literal">MY-</code> の接頭辞が追加されます (例: <code class="literal">MY-000022</code>, <code class="literal">MY-010048</code> ).
          </p></li><li class="listitem"><p>
            サーバーがクライアントプログラムにメッセージを送信すると、エラーコードにゼロ埋込みや接頭辞は追加されません (例): <code class="literal">1036</code>, <code class="literal">3013</code> ).
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="error-interfaces"></a>B.2 エラー情報インタフェース</h2></div></div></div><a class="indexterm" name="idm45302162264128"></a><a class="indexterm" name="idm45302162262000"></a><p>
      <a class="xref" href="error-handling.html#error-message-elements" title="B.1 エラーメッセージのソースと要素">セクションB.1「エラーメッセージのソースと要素」</a> で説明されているように、エラーメッセージはサーバー側またはクライアント側で生成され、各エラーメッセージにはエラーコード、SQLSTATE 値、およびメッセージ文字列が含まれます。 サーバー側、クライアント側およびグローバル (サーバーとクライアント間で共有) のエラーのリストは、<a class="ulink" href="https://dev.mysql.com/doc/mysql-errors/8.0/en/" target="_top">MySQL 8.0 Error Message Reference</a> を参照してください。 
    </p><p>
      プログラム内からのエラーチェックには、エラーメッセージ文字列ではなく、エラーコード番号または記号を使用します。 メッセージ文字列は頻繁には変更されませんが、変更は可能です。 また、データベース管理者がメッセージ文字列の言語に影響する言語設定を変更した場合は、<a class="xref" href="charset.html#error-message-language" title="10.12 エラーメッセージ言語の設定">セクション10.12「エラーメッセージ言語の設定」</a> を参照してください。 
    </p><p>
      MySQL のエラー情報は、サーバーエラーログ、SQL レベル、クライアントプログラムおよびコマンドラインから入手できます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="error-handling.html#error-interface-log" title="エラーログ">エラーログ</a></p></li><li class="listitem"><p><a class="xref" href="error-handling.html#error-interface-sql" title="SQL エラーメッセージインタフェース">SQL エラーメッセージインタフェース</a></p></li><li class="listitem"><p><a class="xref" href="error-handling.html#error-interface-client" title="クライアントエラーメッセージインタフェース">クライアントエラーメッセージインタフェース</a></p></li><li class="listitem"><p><a class="xref" href="error-handling.html#error-interface-command" title="コマンドラインエラーメッセージインタフェース">コマンドラインエラーメッセージインタフェース</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="error-interface-log"></a>エラーログ</h3></div></div></div><p>
        サーバー側では、一部のメッセージはエラーログ用です。 サーバーがログを書き込む場所と方法の構成の詳細は、<a class="xref" href="server-administration.html#error-log" title="5.4.2 エラーログ">セクション5.4.2「エラーログ」</a> を参照してください。 
      </p><p>
        その他のサーバーエラーメッセージはクライアントプログラムに送信することを目的としており、<a class="xref" href="error-handling.html#error-interface-client" title="クライアントエラーメッセージインタフェース">クライアントエラーメッセージインタフェース</a> で説明されているように使用できます。
      </p><p>
        特定のエラーコードが存在する範囲によって、サーバーがエラーメッセージをエラーログに書き込むか、クライアントに送信するかが決まります。 これらの範囲の詳細は、<a class="xref" href="error-handling.html#error-code-ranges" title="エラーコード範囲">エラーコード範囲</a> を参照してください。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="error-interface-sql"></a>SQL エラーメッセージインタフェース</h3></div></div></div><p>
        SQL レベルでは、MySQL にエラー情報のソースがいくつかあります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL ステートメントの警告およびエラーの情報は、<code class="literal">SHOW WARNINGS</code> ステートメントおよび <code class="literal">SHOW ERRORS</code> ステートメントを使用して表示できます。 <code class="literal">warning_count</code> システム変数は、エラー、警告およびノートの数を示します (<code class="literal">sql_notes</code> システム変数が無効な場合、ノートは除外されます)。 <code class="literal">error_count</code> システム変数はエラー数を示します。 この値には警告および注意は含まれていません。 
          </p></li><li class="listitem"><p>
            <code class="literal">GET DIAGNOSTICS</code> ステートメントは、診断領域の診断情報を調査するために使用できます。 <a class="xref" href="sql-statements.html#get-diagnostics" title="13.6.7.3 GET DIAGNOSTICS ステートメント">セクション13.6.7.3「GET DIAGNOSTICS ステートメント」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            <code class="literal">SHOW SLAVE STATUS</code> ステートメントの出力には、レプリカサーバーで発生したレプリケーションエラーに関する情報が含まれます。
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> テーブルに対する<code class="literal">CREATE TABLE</code> ステートメントが失敗した場合、<code class="literal">SHOW ENGINE INNODB STATUS</code> ステートメントの出力には、最後の外部キーエラーに関する情報が含まれています。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="error-interface-client"></a>クライアントエラーメッセージインタフェース</h3></div></div></div><p>
        クライアントプログラムは、次の 2 つのソースからエラーを受け取ります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL クライアントライブラリ内からクライアント側で発生したエラー。
          </p></li><li class="listitem"><p>
            サーバー側で発生し、サーバーによってクライアントに送信されるエラー。 これらはクライアントライブラリ内で受信され、ホストクライアントプログラムで使用できるようになります。 
          </p></li></ul></div><p>
        特定のエラーコードが存在する範囲によって、クライアントライブラリ内から発生したものか、クライアントがサーバーから受信したものかが決まります。 これらの範囲の詳細は、<a class="xref" href="error-handling.html#error-code-ranges" title="エラーコード範囲">エラーコード範囲</a> を参照してください。 
      </p><p>
        エラーがクライアントライブラリ内から発生したか、サーバーから受信されたかに関係なく、MySQL クライアントプログラムは、クライアントライブラリで C API 関数をコールして、エラーコード、SQLSTATE 値、メッセージ文字列およびその他の関連情報を取得します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysql_errno()</code> は、MySQL エラーコードを返します。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql_sqlstate()</code> は SQLSTATE 値を返します。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql_error()</code> はメッセージ文字列を返します。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql_stmt_errno()</code>、<code class="literal">mysql_stmt_sqlstate()</code> および <code class="literal">mysql_stmt_error()</code> は、プリペアドステートメントに対応するエラー関数です。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql_warning_count()</code> は、最新のステートメントのエラー、警告およびノートの数を返します。
          </p></li></ul></div><p>
        クライアントライブラリのエラー関数については、<a class="ulink" href="https://dev.mysql.com/doc/c-api/8.0/en/" target="_top">MySQL 8.0 C API Developer Guide</a> を参照してください。
      </p><p>
        MySQL クライアントプログラムは、様々な方法でエラーに応答する場合があります。 クライアントはエラーメッセージを表示して、ユーザーが修正措置を講じるか、内部的に失敗した操作の解決または再試行を試みるか、または他のアクションを実行できるようにすることができます。 たとえば、(<span class="command"><strong>mysql</strong></span> クライアントを使用して) サーバーへの接続に失敗すると、次のメッセージが表示されることがあります: 
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -h no-such-host</code></strong>
ERROR 2005 (HY000): Unknown MySQL server host 'no-such-host' (0)
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="error-interface-command"></a>コマンドラインエラーメッセージインタフェース</h3></div></div></div><p>
        <span class="command"><strong>perror</strong></span> プログラムは、コマンド行からエラー番号に関する情報を表示します。 <a class="xref" href="programs.html#perror" title="4.8.2 perror — MySQL エラーメッセージ情報の表示">セクション4.8.2「perror — MySQL エラーメッセージ情報の表示」</a>を参照してください。 
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>perror 1231</code></strong>
MySQL error code MY-001231 (ER_WRONG_VALUE_FOR_VAR): Variable '%-.64s'
can't be set to the value of '%-.200s'
</pre><p>
        MySQL NDB Cluster エラーの場合は、<span class="command"><strong>ndb_perror</strong></span> を使用します。 <a class="xref" href="mysql-cluster.html#mysql-cluster-programs-ndb-perror" title="23.4.16 ndb_perror — NDB エラーメッセージ情報の取得">セクション23.4.16「ndb_perror — NDB エラーメッセージ情報の取得」</a>を参照してください。 
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>ndb_perror 323</code></strong>
NDB error code 323: Invalid nodegroup id, nodegroup already existing:
Permanent error: Application error
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="problems"></a>B.3 問題および一般的なエラー</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="error-handling.html#what-is-crashing">B.3.1 問題の原因を判別する方法</a></span></dt><dt><span class="section"><a href="error-handling.html#common-errors">B.3.2 MySQL プログラム使用時の一般的なエラー</a></span></dt><dt><span class="section"><a href="error-handling.html#administration-issues">B.3.3 管理関連の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#query-issues">B.3.4 クエリー関連の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#optimizer-issues">B.3.5 オプティマイザ関連の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#table-definition-issues">B.3.6 テーブル定義関連の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#known-issues">B.3.7 MySQL の既知の問題</a></span></dt></dl></div><a class="indexterm" name="idm45302162193152"></a><a class="indexterm" name="idm45302162191024"></a><p>
      このセクションでは、発生する可能性がある一般的な問題およびエラーメッセージを一覧表示しています。 問題の原因を判別する方法およびそれらを解決するための手順について説明しています。 
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="what-is-crashing"></a>B.3.1 問題の原因を判別する方法</h3></div></div></div><p>
        問題が発生したときに最初にするべきことは、原因となっているプログラムまたはユニットを特定することです。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            次のいずれかの症状が発生している場合は、ハードウェアの問題 (メモリー、マザーボード、CPU、ハードディスクなど) またはカーネルの問題である可能性があります。
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                キーボードが動作しない。 通常、これは Caps Lock キーを押すことによって確認できます。 Caps Lock のランプが変わらない場合は、キーボードを交換する必要があります。 (これを行う前に、コンピュータの再起動を試みて、キーボードのすべてのケーブルを確認する必要があります。) 
              </p></li><li class="listitem"><p>
                マウスポインタが動かない。
              </p></li><li class="listitem"><p>
                リモートマシンからの ping にマシンが応答しない。
              </p></li><li class="listitem"><p>
                MySQL に関連しないその他のプログラムが正常に動作しない。
              </p></li><li class="listitem"><p>
                システムが突然再起動される。 (ユーザーレベルの欠陥のあるプログラムがシステムを停止できないようにしてください。) 
              </p></li></ul></div><p>
            この場合は、すべてのケーブルを確認し、診断ツールを実行してハードウェアをチェックすることから開始してください。 問題を解決できる可能性があるオペレーティングシステムのパッチ、アップデート、またはサービスパックがあるかどうかも確認してください。 すべてのライブラリ (<code class="literal">glibc</code> など) が最新であることも確認してください。 
          </p><p>
            メモリーの問題を早期に発見するために、ECC メモリーを持つマシンを使用することは良いことです。
          </p></li><li class="listitem"><p>
            キーボードがロックアップした場合は、別のマシンから自分のマシンにログインして <code class="literal">kbd_mode -a</code> を実行することによってリカバリできることがあります。
          </p></li><li class="listitem"><p>
            システムのログファイル (<code class="filename">/var/log/messages</code> または同様のログファイル) で問題の原因を調べてください。 問題の原因が MySQL にあると思われる場合は、MySQL のログファイルも調べてください。 <a class="xref" href="server-administration.html#server-logs" title="5.4 MySQL Server ログ">セクション5.4「MySQL Server ログ」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            ハードウェアに問題がないと思われる場合は、問題の原因となっているプログラムを見つけてください。 <span class="command"><strong>top</strong></span>、<span class="command"><strong>ps</strong></span>、タスクマネージャー、または同様のプログラムを使用して、すべての CPU を使用しているプログラムまたはマシンをロックしているプログラムを確認します。 
          </p></li><li class="listitem"><p>
            <span class="command"><strong>top</strong></span>、<span class="command"><strong>df</strong></span>、または同様のプログラムを使用して、メモリー、ディスク領域、ファイルディスクリプタ、またはその他の重要なリソースが不足しているかどうかを確認します。
          </p></li><li class="listitem"><p>
            問題の原因が暴走したプロセスにある場合は、そのプロセスの強制終了を試みることができます。 プロセスが停止しない場合は、オペレーティングシステムにバグがある可能性があります。 
          </p></li></ul></div><p>
        他のすべての可能性を調べ、MySQL サーバーまたは MySQL クライアントが問題の原因となっていると判断した場合は、バグレポートを作成します。<a class="xref" href="introduction.html#bug-reports" title="1.6 質問またはバグをレポートする方法">セクション1.6「質問またはバグをレポートする方法」</a> を参照してください。 バグレポートで、システムがどのように動作しているか、および何が起こっていると思われるかについて完全に説明してみてください。 また、MySQL が問題の原因と考えている理由も記載します。 この章で説明するすべての状況を考慮してください。 システムを検査したときの問題の状況を正確に記述します。 プログラムおよびログファイルの出力やエラーメッセージを<span class="quote">「<span class="quote">コピー&amp;ペースト</span>」</span>します。 
      </p><p>
        動作していないプログラムおよびすべての症状について詳しく記述してください。 <span class="quote">「<span class="quote">システムが動作しない</span>」</span>とのみ記述されたバグレポートを過去に多数受け取りました。 これでは、問題の原因に関する情報が提供されません。 
      </p><p>
        プログラムで障害が発生した場合は、次の情報を知ることが常に役に立ちます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            問題のプログラムでセグメンテーション違反が発生したかどうか (コアがダンプされたかどうか)。
          </p></li><li class="listitem"><p>
            プログラムが使用可能なすべての CPU 時間を使用しているかどうか。 <span class="command"><strong>top</strong></span> を使用して確認してください。 プログラムをしばらく実行したままにしてみてください。計算の多い処理が行われているだけである可能性があります。 
          </p></li><li class="listitem"><p>
            <span class="command"><strong>mysqld</strong></span> サーバーが問題の原因である場合は、<span class="command"><strong>mysqladmin -u root ping</strong></span> または <span class="command"><strong>mysqladmin -u root processlist</strong></span> で応答を取得できますか。
          </p></li><li class="listitem"><p>
            MySQL サーバーに接続しようとしたときに、クライアントプログラムはどのように動作しますか。 (たとえば、<span class="command"><strong>mysql</strong></span> を実行します。) クライアントが動作しなくなりますか。 プログラムから出力はありますか。 
          </p></li></ul></div><p>
        バグレポートを送信する場合は、<a class="xref" href="introduction.html#bug-reports" title="1.6 質問またはバグをレポートする方法">セクション1.6「質問またはバグをレポートする方法」</a>に説明されている手順に従ってください。
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="common-errors"></a>B.3.2 MySQL プログラム使用時の一般的なエラー</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="error-handling.html#error-access-denied">B.3.2.1 アクセスは拒否されました</a></span></dt><dt><span class="section"><a href="error-handling.html#can-not-connect-to-server">B.3.2.2 [ローカルの] MySQL サーバーに接続できません</a></span></dt><dt><span class="section"><a href="error-handling.html#error-lost-connection">B.3.2.3 MySQL サーバーへの接続が失われました</a></span></dt><dt><span class="section"><a href="error-handling.html#password-too-long">B.3.2.4 パスワードをインタラクティブに入力すると失敗する</a></span></dt><dt><span class="section"><a href="error-handling.html#too-many-connections">B.3.2.5 接続が多すぎます</a></span></dt><dt><span class="section"><a href="error-handling.html#out-of-memory">B.3.2.6 メモリー不足</a></span></dt><dt><span class="section"><a href="error-handling.html#gone-away">B.3.2.7 MySQL サーバーが存在しなくなりました</a></span></dt><dt><span class="section"><a href="error-handling.html#packet-too-large">B.3.2.8 パケットが大きすぎます</a></span></dt><dt><span class="section"><a href="error-handling.html#communication-errors">B.3.2.9 通信エラーおよび中止された接続</a></span></dt><dt><span class="section"><a href="error-handling.html#full-table">B.3.2.10 テーブルが満杯です</a></span></dt><dt><span class="section"><a href="error-handling.html#cannot-create">B.3.2.11 ファイルを作成/書き込みできない</a></span></dt><dt><span class="section"><a href="error-handling.html#commands-out-of-sync">B.3.2.12 コマンドは同期されていません</a></span></dt><dt><span class="section"><a href="error-handling.html#ignoring-user">B.3.2.13 ユーザーを無視します</a></span></dt><dt><span class="section"><a href="error-handling.html#cannot-find-table">B.3.2.14 表 'tbl_name' は存在しません</a></span></dt><dt><span class="section"><a href="error-handling.html#cannot-initialize-character-set">B.3.2.15 文字セットを初期化できません</a></span></dt><dt><span class="section"><a href="error-handling.html#not-enough-file-handles">B.3.2.16 ファイルが見つからず同様のエラーが発生しました</a></span></dt><dt><span class="section"><a href="error-handling.html#table-corruption">B.3.2.17 テーブルの破損の問題</a></span></dt></dl></div><a class="indexterm" name="idm45302162149280"></a><p>
        このセクションでは、MySQL プログラムを実行したときによく発生するエラーを一覧表示しています。 問題はクライアントプログラムを実行しようとしたときに発生しますが、多くの問題の解決策では MySQL サーバーの構成を変更します。 
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="error-access-denied"></a>B.3.2.1 アクセスは拒否されました</h4></div></div></div><a class="indexterm" name="idm45302162145120"></a><a class="indexterm" name="idm45302162142976"></a><a class="indexterm" name="idm45302162140880"></a><p>
          <code class="literal">「アクセスは拒否されました」</code>というエラーには多くの原因があります。 多くの場合、問題はサーバーが接続時にクライアントプログラムに使用を許可する MySQL アカウントに関連しています。 <a class="xref" href="security.html#access-control" title="6.2 アクセス制御とアカウント管理">セクション6.2「アクセス制御とアカウント管理」</a>および<a class="xref" href="security.html#problems-connecting" title="6.2.21 MySQL への接続の問題のトラブルシューティング">セクション6.2.21「MySQL への接続の問題のトラブルシューティング」</a>を参照してください。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="can-not-connect-to-server"></a>B.3.2.2 [ローカルの] MySQL サーバーに接続できません</h4></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="error-handling.html#can-not-connect-to-server-on-windows">B.3.2.2.1 Windows で MySQL サーバーへの接続に失敗する</a></span></dt></dl></div><a class="indexterm" name="idm45302162135424"></a><a class="indexterm" name="idm45302162134112"></a><p>
          UNIX 上の MySQL クライアントは <span class="command"><strong>mysqld</strong></span> サーバーに 2 つの方法で接続できます。UNIX ソケットファイルを使用してファイルシステム内のファイル (デフォルトは <code class="filename">/tmp/mysql.sock</code>) を介して接続するか、TCP/IP を使用してポート番号を介して接続します。 UNIX ソケットファイルでの接続は TCP/IP よりも高速ですが、同じコンピュータ上にあるサーバーに接続するときにのみ使用できます。 UNIX ソケットファイルは、ホスト名を指定しない場合、または特殊なホスト名 <code class="literal">localhost</code> を指定する場合に使用されます。 
        </p><p>
          MySQL サーバーが Windows 上で実行されている場合は、TCP/IP を使用して接続できます。 <code class="literal">named_pipe</code> システム変数を有効にしてサーバーを起動した場合、サーバーが実行されているホストでクライアントを実行していれば、名前付きパイプで接続することもできます。 デフォルトでは、名前付きパイプの名前は <code class="literal">MySQL</code> です。 <span class="command"><strong>mysqld</strong></span> に接続するときにホスト名を指定しない場合、MySQL クライアントは最初に名前付きパイプに接続しようとします。 接続できない場合は、TCP/IP ポートに接続します。 Windows で名前付きパイプの使用を強制するには、ホスト名として <code class="literal">.</code> を使用します。 
        </p><p>
          エラー (2002) <code class="literal">「... に接続できません」</code> は、通常、サーバーに接続しようとしたときに、システムで MySQL サーバーが実行されていなかったこと、あるいは間違った UNIX ソケットファイル名または TCP/IP ポート番号を使用していることを意味しています。 使用している TCP/IP ポートがファイアウォールまたはポートブロックサービスによってブロックされていないことも確認してください。 
        </p><p>
          エラー (2003) <code class="literal">「'<em class="replaceable"><code>server</code></em>' の MySQL サーバーに接続できません (10061)」</code> は、ネットワーク接続が拒否されたことを示しています。 MySQL サーバーが実行されていること、ネットワーク接続が有効にされていること、および指定したネットワークポートがサーバーに構成されていることを確認してください。 
        </p><p>
          サーバーのホストで <span class="command"><strong>mysqld</strong></span> という名前のプロセスが実行されているかどうかを確認することから始めます。 (UNIX では <span class="command"><strong>ps xa | grep mysqld</strong></span>、Windows ではタスクマネージャーを使用します。) プロセスがない場合は、サーバーを起動してください。 <a class="xref" href="installing.html#starting-server" title="2.10.2 サーバーの起動">セクション2.10.2「サーバーの起動」</a>を参照してください。 
        </p><p>
          <span class="command"><strong>mysqld</strong></span> プロセスが実行されている場合は、次のコマンドを使用してチェックできます。 ポート番号または UNIX ソケットファイル名は、使用している環境では異なる場合があります。<code class="literal">host_ip</code> は、サーバーが実行されているマシンの IP アドレスを表しています。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin version</code></strong>
shell&gt; <strong class="userinput"><code>mysqladmin variables</code></strong>
shell&gt; <strong class="userinput"><code>mysqladmin -h `hostname` version variables</code></strong>
shell&gt; <strong class="userinput"><code>mysqladmin -h `hostname` --port=3306 version</code></strong>
shell&gt; <strong class="userinput"><code>mysqladmin -h host_ip version</code></strong>
shell&gt; <strong class="userinput"><code>mysqladmin --protocol=SOCKET --socket=/tmp/mysql.sock version</code></strong>
</pre><p>
          <span class="command"><strong>hostname</strong></span> コマンドでは通常の引用符ではなく逆引用符が使用されています。これにより、<span class="command"><strong>hostname</strong></span> の出力 (つまり、現在のホスト名) が <span class="command"><strong>mysqladmin</strong></span> コマンドに渡されます。 <span class="command"><strong>hostname</strong></span> コマンドがないか、Windows 上で実行している場合は、<code class="literal">-h</code> オプションに続けて、マシンのホスト名を手動で入力できます (逆引用符なし)。 <code class="literal">-h 127.0.0.1</code> を使用して、TCP/IP でローカルホストへの接続を試みることもできます。 
        </p><p>
          サーバーがネットワーク接続を無視するように構成されていないこと、または (リモート側から接続しようとする場合に) サーバーのネットワークインタフェース上でローカル側でのみ待機するように構成されていないことを確認します。 <code class="literal">skip_networking</code> システム変数を有効にしてサーバーを起動した場合、TCP/IP 接続を受け入れることはできません。 <code class="literal">bind_address</code> システム変数を <code class="literal">127.0.0.1</code> に設定してサーバーを起動した場合、サーバーはループバックインタフェースでローカルでのみ TCP/IP 接続をリスニングし、リモート接続を受け入れません。 
        </p><p>
          ファイアウォールが MySQL へのアクセスをブロックしていないか確認します。 ファイアウォールは、実行中のアプリケーションまたは MySQL によって通信用に使用されるポート番号 (デフォルトは 3306) を基準として構成されることがあります。 Linux または Unix の場合、IP テーブル (または同様の機能の) 構成を調べてポートがブロックされていないことを確認します。 Windows では、ZoneAlarm や Windows ファイアウォールなどのアプリケーションを、MySQL ポートをブロックしないように構成する必要がある場合があります。 
        </p><p>
          <code class="literal">「ローカルの MySQL サーバーに接続できません」</code>というエラーが発生する可能性があるいくつかの原因を次に示します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <span class="command"><strong>mysqld</strong></span> がローカルホストで実行されていない。 オペレーティングシステムのプロセスリストをチェックして、<span class="command"><strong>mysqld</strong></span> プロセスが存在することを確認します。 
            </p></li><li class="listitem"><p>
              多数の TCP/IP 接続がある Windows 上で MySQL サーバーを実行している。 クライアントで頻繁にそのエラーが発生している場合は、<a class="xref" href="error-handling.html#can-not-connect-to-server-on-windows" title="B.3.2.2.1 Windows で MySQL サーバーへの接続に失敗する">セクションB.3.2.2.1「Windows で MySQL サーバーへの接続に失敗する」</a>に回避策があります。 
            </p></li><li class="listitem"><p>
              <span class="command"><strong>mysqld</strong></span> が使用する UNIX ソケットファイル (デフォルトでは <code class="filename">/tmp/mysql.sock</code>) をほかのユーザーが削除した。 たとえば、<code class="filename">/tmp</code> ディレクトリから古いファイルを削除する <span class="command"><strong>cron</strong></span> ジョブがある可能性があります。 <span class="command"><strong>mysqladmin version</strong></span> を実行すると、<span class="command"><strong>mysqladmin</strong></span> が使用する UNIX ソケットファイルが実際に存在するかどうかを確認できます。 この場合の対処方法は、<code class="filename">mysql.sock</code> を削除しないように <span class="command"><strong>cron</strong></span> ジョブを変更するか、ソケットファイルを別の場所に配置することです。 <a class="xref" href="error-handling.html#problems-with-mysql-sock" title="B.3.3.6 MySQL の UNIX ソケットファイルを保護または変更する方法">セクションB.3.3.6「MySQL の UNIX ソケットファイルを保護または変更する方法」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="option">--socket=/path/to/socket</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> サーバーを起動したが、クライアントプログラムにソケットファイルの新しい名前を指定し忘れた。 サーバーのソケットパス名を変更したら、MySQL クライアントにも通知する必要があります。 これを行うには、クライアントプログラムを実行するときに同じ <code class="option">--socket</code> オプションを指定します。 <code class="filename">mysql.sock</code> ファイルにアクセスするための権限がクライアントにあることも確認する必要があります。 ソケットファイルがある場所を見つけるには、次のコマンドを実行します。 
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>netstat -ln | grep mysql</code></strong>
</pre><p>
              <a class="xref" href="error-handling.html#problems-with-mysql-sock" title="B.3.3.6 MySQL の UNIX ソケットファイルを保護または変更する方法">セクションB.3.3.6「MySQL の UNIX ソケットファイルを保護または変更する方法」</a>を参照してください。
            </p></li><li class="listitem"><p>
              Linux を使用していて、1 つのサーバースレッドが停止した (コアがダンプされた)。 この場合は、MySQL サーバーを再起動する前に、ほかの <span class="command"><strong>mysqld</strong></span> スレッドを強制終了する (たとえば、<span class="command"><strong>kill</strong></span> を使用します) 必要があります。 <a class="xref" href="error-handling.html#crashing" title="B.3.3.3 MySQL が繰り返しクラッシュする場合の対処方法">セクションB.3.3.3「MySQL が繰り返しクラッシュする場合の対処方法」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              UNIX ソケットファイルが保持されているディレクトリまたはソケットファイル自体に対する適切なアクセス権限が、サーバーまたはクライアントプログラムにない可能性がある。 この場合は、ディレクトリまたはソケットファイルのアクセス権限を変更して、サーバーおよびクライアントがそれらにアクセスできるようにするか、サーバーがソケットファイルを作成でき、クライアントプログラムがアクセスできるディレクトリのソケットファイル名を指定する <code class="option">--socket</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> を再起動します。 
            </p></li></ul></div><p>
          <code class="literal">「some_host 上の MySQL サーバーに接続できません」</code>というエラーメッセージが表示された場合は、次のことを行なって問題の原因を見つけてください。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">telnet some_host 3306</code> を実行して Enter キーを何度か押すことによって、サーバーがそのホスト上で実行されているかどうかを確認します (3306 は MySQL のデフォルトのポート番号です。 サーバーが別のポートで待機している場合は、値を変更します。) MySQL サーバーが実行されていて、そのポートで待機している場合は、サーバーのバージョン番号を含む応答を受け取ります。 <code class="literal">「telnet: リモートホストに接続できません: 接続は拒否されました」</code>などのエラーを受け取った場合、指定したポートでサーバーは実行されていません。 
            </p></li><li class="listitem"><p>
              サーバーがローカルホストで実行されている場合は、<span class="command"><strong>mysqladmin -h localhost variables</strong></span> を使用して UNIX ソケットファイルを使用して接続することを試みてください。 サーバーが待機するように構成されている TCP/IP ポート番号を確認します (これは <code class="literal">port</code> 変数の値です。) 
            </p></li><li class="listitem"><p>
              Linux で実行しており、セキュリティ強化された Linux (SELinux) が有効になっている場合は、<a class="xref" href="security.html#selinux" title="6.7 SELinux">セクション6.7「SELinux」</a> を参照してください。
            </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="can-not-connect-to-server-on-windows"></a>B.3.2.2.1 Windows で MySQL サーバーへの接続に失敗する</h5></div></div></div><p>
            多数の TCP/IP 接続のある Windows 上で MySQL サーバーを実行していて、<code class="literal">「MySQL サーバーに接続できません」</code>というエラーが頻繁に発生している場合は、それらの接続に対応するための十分なエフェメラル (一時的な) ポートを Windows が許可していないことが原因である可能性があります。
          </p><p>
            <code class="literal">TIME_WAIT</code> の目的は、接続が閉じられたあとでも、接続がパケットを受け入れるようにすることです。 これは、インターネットのルーティングによってパケットに低速なルートが割り当てられ、双方がクローズに同意したあとにパケットが受信されることがあるためです。 そのポートが新しい接続に使用された場合は、古い接続からのパケットによってプロトコルが断絶したり、元の接続からの個人情報が漏えいしたりすることがあります。 <code class="literal">TIME_WAIT</code> による遅延は、それらの遅延したパケットを受信するために一定の時間を猶予してからポートが再使用されるようにすることによってこれを防ぎます。 
          </p><p>
            LAN 接続では、距離と遅延が比較的に大きいインターネットとは異なり、パケットが大きく遅延して受信されることはほとんどないため、<code class="literal">TIME_WAIT</code> を大幅に減らしたほうが安全です。
          </p><p>
            Windows はエフェメラル (一時的な) TCP ポートをユーザーに許可しています。 ポートが閉じられると、120 秒間 <code class="literal">TIME_WAIT</code> ステータスのままになります。 この時間が経過するまで、ポートは再び使用できません。 ポート番号のデフォルトの範囲は、Windows のバージョンによって異なります。古いバージョンではポートの数がより制限されます。 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Windows Server 2003 まで: 1025-5000 の範囲のポート
              </p></li><li class="listitem"><p>
                Windows Vista、Server 2008 以降: 49152-65535 の範囲のポート
              </p></li></ul></div><p>
            使用可能な TCP ポートが少なく (5000)、<code class="literal">TIME_WAIT</code> ステータスで多数の TCP ポートが短い期間にオープンおよびクローズされると、ポートが不足する可能性が高くなります。 この問題に対処する方法は 2 つあります。 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                原因となっている可能性のある接続プールまたは永続的な接続を調査することによって、急速に消費される TCP ポートの数を減らします
              </p></li><li class="listitem"><p>
                Windows レジストリのいくつかの設定をチューニングします (次の手順を参照してください)
              </p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
              次の手順では、Windows レジストリを変更します。 レジストリを変更する前に、必ずレジストリをバックアップし、問題が発生した場合の復元方法を理解しておいてください。 レジストリをバックアップ、復旧、および編集する方法については、Microsoft サポート技術情報の記事 (<a class="ulink" href="http://support.microsoft.com/kb/256986/EN-US/" target="_top">http://support.microsoft.com/kb/256986/EN-US/</a>) を参照してください。 
            </p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                レジストリエディタ (<code class="filename">Regedt32.exe</code>) を開始します。
              </p></li><li class="listitem"><p>
                レジストリの次のキーを見つけます。
              </p><pre class="programlisting">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
</pre></li><li class="listitem"><p>
                <code class="literal">「編集」</code>メニューで、<code class="literal">「値の追加」</code>をクリックして次のレジストリ値を追加します。
              </p><pre class="programlisting">Value Name: MaxUserPort
Data Type: REG_DWORD
Value: 65534
</pre><p>
                これにより、ユーザーが使用できるエフェメラルポートの番号が設定されます。 有効な範囲は 5000 から 65534 (10 進数) までです。 デフォルト値は 0x1388 (10 進数の 5000) です。 
              </p></li><li class="listitem"><p>
                <code class="literal">「編集」</code>メニューで、<code class="literal">「値の追加」</code>をクリックして次のレジストリ値を追加します。
              </p><pre class="programlisting">Value Name: TcpTimedWaitDelay
Data Type: REG_DWORD
Value: 30
</pre><p>
                これにより、閉じる前に <code class="literal">TIME_WAIT</code> 状態で TCP ポートの接続を保持する秒数が設定されます。 有効な範囲は 30 から 300 桁ですが、Microsoft で許可されている最新の値を確認できます。 デフォルト値は 0x78 (10 進数の 120) です。 
              </p></li><li class="listitem"><p>
                レジストリエディタを終了します。
              </p></li><li class="listitem"><p>
                マシンをリブートします。
              </p></li></ol></div><p>
            注意: 前述した設定を元に戻すには、作成したレジストリのエントリを削除します。
          </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="error-lost-connection"></a>B.3.2.3 MySQL サーバーへの接続が失われました</h4></div></div></div><a class="indexterm" name="idm45302162022992"></a><a class="indexterm" name="idm45302162020848"></a><a class="indexterm" name="idm45302162018768"></a><p>
          このエラーメッセージには 3 つの原因が考えられます。
        </p><p>
          通常、これはネットワーク接続の問題を示しており、このエラーが頻繁に発生する場合は、ネットワークの状態を確認してください。 エラーメッセージに<span class="quote">「<span class="quote">クエリー中</span>」</span>が含まれている場合、発生している問題はこれに該当する可能性があります。 
        </p><p>
          <span class="quote">「<span class="quote">クエリー中</span>」</span>の状態は、1 つ以上のクエリーの一部として数百万件の行が送信されているときに発生することがあります。 この問題が発生していることがわかった場合は、<code class="literal">net_read_timeout</code> をデフォルトの 30 秒から 60 秒またはデータ転送が完了するのに十分な時間に増やすことを試みてください。 
        </p><p>
          まれに、クライアントがサーバーに初期接続を試みるときに発生することがあります。 この場合、<code class="literal">connect_timeout</code> 値の設定が数秒であるときは、10 秒 (距離が非常に遠い場合、または低速な接続の場合はさらに長く) に増やすことによって、この問題を解決できることがあります。 より一般的ではない原因によってこの問題が発生しているかどうかを判別するには、<code class="literal">SHOW GLOBAL STATUS LIKE 'Aborted_connects'</code> を使用します。 サーバーが中断する初期接続試行ごとに 1 つずつ増加します。 エラーメッセージの一部として<span class="quote">「<span class="quote">認証パケットを読み込んでいます</span>」</span>が表示されることがあります。その場合も、必要となる解決策がこの方法であることを示しています。 
        </p><p>
          前述の原因ではない場合は、一部のクライアントで発生することがある <code class="literal">max_allowed_packet</code> より大きい <code class="literal">BLOB</code> 値に関する問題が発生している可能性があります。 <code class="literal">ER_NET_PACKET_TOO_LARGE</code> エラーが発生することがありますが、それは <code class="literal">max_allowed_packet</code> を増やす必要があることを示しています。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="password-too-long"></a>B.3.2.4 パスワードをインタラクティブに入力すると失敗する</h4></div></div></div><p>
          <code class="option">--password</code> オプションまたは <code class="option">-p</code> オプションをパスワード値を指定せずに使用して起動すると、MySQL クライアントプログラムはパスワードの入力を求めます。
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u <em class="replaceable"><code>user_name</code></em> -p</code></strong>
Enter password:
</pre><p>
          一部のシステムでは、オプションファイルまたはコマンド行で指定するとパスワードが機能するが、<code class="literal">Enter password:</code> プロンプトでインタラクティブに入力すると機能しないことがあります。 これは、パスワードを読み取るためにシステムによって提供されたライブラリが、パスワード値を少ない文字数 (通常、8 文字) に制限したときに発生します。 これはシステムライブラリの問題であり、MySQL の問題ではありません。 これを回避するには、MySQL のパスワードを 8 文字以下の値に変更するか、パスワードをオプションファイルに格納します。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="too-many-connections"></a>B.3.2.5 接続が多すぎます</h4></div></div></div><p>
          <span class="command"><strong>mysqld</strong></span> サーバーに接続しようとしたときにクライアントで <code class="literal">Too many connections</code> エラーが発生した場合、使用可能なすべての接続が他のクライアントによって使用されています。
        </p><p>
          許可される接続数は、<code class="literal">max_connections</code> システム変数によって制御されます。 より多くの接続をサポートするには、<code class="literal">max_connections</code> をより大きな値に設定します。 
        </p><p>
          <span class="command"><strong>mysqld</strong></span> では、実際には <code class="literal">max_connections</code> + 1 クライアント接続が許可されます。 追加の接続は、<code class="literal">CONNECTION_ADMIN</code> 権限 (または非推奨の <code class="literal">SUPER</code> 権限) を持つアカウントで使用するために予約されています。 通常のユーザー (必要ないユーザー) ではなく管理者に権限を付与することで、管理者はサーバーに接続し、権限のないクライアントの最大数が接続されている場合でも <code class="literal">SHOW PROCESSLIST</code> を使用して問題を診断できます。 <a class="xref" href="sql-statements.html#show-processlist" title="13.7.7.29 SHOW PROCESSLIST ステートメント">セクション13.7.7.29「SHOW PROCESSLIST ステートメント」</a>を参照してください。 
        </p><p>
          サーバーは、専用インタフェースでの管理接続も許可します。 サーバーがクライアント接続を処理する方法の詳細は、<a class="xref" href="server-administration.html#connection-interfaces" title="5.1.12.1 接続インタフェース">セクション5.1.12.1「接続インタフェース」</a> を参照してください。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="out-of-memory"></a>B.3.2.6 メモリー不足</h4></div></div></div><p>
          <span class="command"><strong>mysql</strong></span> クライアントプログラムを使用してクエリーを発行し、次のようなエラーを受け取った場合は、<span class="command"><strong>mysql</strong></span> にクエリーの結果全体を格納するための十分なメモリーがないことを意味しています。
        </p><pre class="programlisting">mysql: Out of memory at line 42, 'malloc.c'
mysql: needed 8136 byte (8k), memory in use: 12481367 bytes (12189k)
ERROR 2008: MySQL client ran out of memory
</pre><p>
          この問題を解決するには、最初にクエリーが正しいかどうかを確認します。 そのような多数の行が返されることが予想されるクエリーですか。 そうではない場合は、クエリーを修正して再試行してください。 予想される場合は、<code class="option">--quick</code> オプションを指定して <span class="command"><strong>mysql</strong></span> を呼び出すことができます。 これにより、<code class="literal">mysql_use_result()</code> C API 関数を使用して結果セットが取得されるようになり、クライアントへのロードが少なくなります (サーバーへのロードが増えます)。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="gone-away"></a>B.3.2.7 MySQL サーバーが存在しなくなりました</h4></div></div></div><a class="indexterm" name="idm45302161972560"></a><a class="indexterm" name="idm45302161971248"></a><p>
          このセクションでは、関連する<code class="literal">「クエリー中にサーバーへの接続が失われました」</code>というエラーについても説明します。
        </p><p>
          <code class="literal">「MySQL サーバーが存在しなくなりました」</code>というエラーのもっとも一般的な原因は、サーバーがタイムアウトして接続が閉じられた場合です。 この場合は、通常、次のいずれかのエラーコードを受け取ります (受け取るエラーコードはオペレーティングシステムによって異なります)。 
        </p><div class="informaltable"><table summary="MySQL server has gone away error codes and a description of each code."><col style="width: 35%"><col style="width: 65%"><thead><tr>
              <th>エラーコード</th>
              <th>説明</th>
            </tr></thead><tbody><tr>
              <td><code class="literal">CR_SERVER_GONE_ERROR</code></td>
              <td>クライアントはサーバーに問い合わせを送信できませんでした。</td>
            </tr><tr>
              <td><code class="literal">CR_SERVER_LOST</code></td>
              <td>クライアントはサーバーに書き込むときにエラーを受け取りませんでしたが、問い合わせに対する完全な応答 (または何らかの応答) が得られませんでした。</td>
            </tr></tbody></table></div><p>
          デフォルトでは、何も発生しなかった場合、サーバーは 8 時間後に接続を閉じます。 この時間制限を変更するには、<span class="command"><strong>mysqld</strong></span> を起動するときに <code class="literal">wait_timeout</code> 変数を設定します。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 
        </p><p>
          スクリプトがある場合、クライアントが自動再接続を行うには、クエリーを再発行する必要があるだけです。 これは、クライアントの自動再接続を有効にしている (<code class="literal">mysql</code> コマンド行クライアントのデフォルト) ことが前提です。 
        </p><p>
          <code class="literal">「MySQL サーバーが存在しなくなりました」</code>というエラーのほかの一般的な原因を次に示します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              ユーザー (またはデータベース管理者) が実行中のスレッドを <code class="literal">KILL</code> ステートメントまたは <span class="command"><strong>mysqladmin kill</strong></span> コマンドを使用して強制終了した。
            </p></li><li class="listitem"><p>
              サーバーへの接続を閉じたあとにクエリーを実行しようとした。 これはアプリケーションの論理エラーを示しており、修正する必要があります。 
            </p></li><li class="listitem"><p>
              別のホスト上で実行されているクライアントアプリケーションに、そのホストから MySQL サーバーに接続するために必要な権限がない。
            </p></li><li class="listitem"><p>
              クライアント側で TCP/IP 接続がタイムアウトした。 これは、コマンド <code class="literal">mysql_options(..., MYSQL_OPT_READ_TIMEOUT,...)</code> または <code class="literal">mysql_options(..., MYSQL_OPT_WRITE_TIMEOUT,...)</code> を使用している場合に発生することがあります。 この場合は、タイムアウト値を増やすと問題が解決されることがあります。 
            </p></li><li class="listitem"><p>
              サーバー側でタイムアウトが発生し、クライアントの自動再接続が無効にされている (<code class="literal">MYSQL</code> 構造体の <code class="literal">reconnect</code> フラグが 0 と等しい)。
            </p></li><li class="listitem"><p>
              Windows クライアントを使用していて、コマンドが発行される前にサーバーによって接続がドロップされた (おそらく <code class="literal">wait_timeout</code> が期限切れになったため)。
            </p><p>
              Windows での問題は、TCP/IP 接続をサーバーに書き込むときに MySQL が OS からエラーを受け取らず、接続から応答を読み取ろうとしたときにエラーを受け取ることです。
            </p><p>
              この問題の解決策は、最後のクエリーから長い時間がたっている場合に接続に対して <code class="literal">mysql_ping()</code> を実行するか (これは Connector/ODBC が行なっていることです)、<span class="command"><strong>mysqld</strong></span> サーバーで <code class="literal">wait_timeout</code> に事実上タイムアウトすることがないような高い値を設定することです。
            </p></li><li class="listitem"><p>
              間違ったクエリーまたは長すぎるクエリーをサーバーに送信した場合にも、これらのエラーを受け取ることがあります。 <span class="command"><strong>mysqld</strong></span> が長すぎるパケットまたは順序が間違っているパケットを受け取ると、クライアントで何らかの問題が発生していると見なして、接続を閉じます。 大きなクエリーが必要な場合 (たとえば、大きな <code class="literal">BLOB</code> カラムを操作している場合)、クエリーの制限を緩和するには、サーバーの <code class="literal">max_allowed_packet</code> 変数 (デフォルト値は 64M バイト) を設定します。 クライアント側の最大パケットサイズも増やす必要がある場合もあります。 パケットサイズの設定については、<a class="xref" href="error-handling.html#packet-too-large" title="B.3.2.8 パケットが大きすぎます">セクションB.3.2.8「パケットが大きすぎます」</a>を参照してください。 
            </p><p>
              多数の行を挿入する <code class="literal">INSERT</code> ステートメントまたは <code class="literal">REPLACE</code> ステートメントも、これらの種類のエラーの原因となることがあります。 これらのステートメントのいずれかは、挿入される行数に関係なくサーバーに単一の要求を送信します。このため、1 つの <code class="literal">INSERT</code> または <code class="literal">REPLACE</code> で送信される行数を減らすことによって多くの場合エラーを防ぐことができます。 
            </p></li><li class="listitem"><p>
              ホスト名のルックアップが失敗した場合に、このエラーが発生することもあります (たとえば、サーバーまたはネットワークが依存する DNS サーバーが停止した場合)。 これは、MySQL が名前解決についてホストシステムに依存しているが、それが動作しているかどうかは知ることができないためです。MySQL が認識している範囲では、この問題はほかのネットワークタイムアウトと区別が付きません。 
            </p><p>
              <code class="literal">skip_networking</code> システム変数を有効にして MySQL を起動すると、<code class="literal">MySQL server has gone away</code> エラーが表示されることもあります。
            </p><p>
              MySQL のポート (デフォルトは 3306) がファイアウォールによってブロックされていて、MySQL サーバーへのすべての接続が遮断される場合、このエラーの原因となることがある別のネットワークの問題が発生します。
            </p></li><li class="listitem"><p>
              アプリケーションで複数の子プロセスがフォークされ、すべての子プロセスが MySQL サーバーへの同じ接続を使用しようとした場合に、このエラーが発生することもあります。 これは、各子プロセスが個別の接続を使用することによって防ぐことができます。 
            </p></li><li class="listitem"><p>
              クエリーの実行中にサーバーが停止するバグが発生した。
            </p></li></ul></div><p>
          MySQL サーバーが停止して再起動されたかどうかを確認するには、<span class="command"><strong>mysqladmin version</strong></span> を実行してサーバーの稼働時間を検査します。 <span class="command"><strong>mysqld</strong></span> がクラッシュして再起動されたためにクライアント接続が切断された場合は、そのクラッシュの原因を見つけることに集中してください。 クエリーを再び発行するとサーバーが再び強制終了されるかどうかを確認することから始めます。 <a class="xref" href="error-handling.html#crashing" title="B.3.3.3 MySQL が繰り返しクラッシュする場合の対処方法">セクションB.3.3.3「MySQL が繰り返しクラッシュする場合の対処方法」</a>を参照してください。 
        </p><p>
          失われた接続の詳細を取得するには、<code class="literal">log_error_verbosity</code> システム変数を 3 に設定して <span class="command"><strong>mysqld</strong></span> を起動します。 これにより、切断メッセージの一部が <code class="literal">hostname.err</code> ファイルに記録されます。 <a class="xref" href="server-administration.html#error-log" title="5.4.2 エラーログ">セクション5.4.2「エラーログ」</a> を参照してください。 
        </p><p>
          この問題に関するバグレポートを作成する場合は、次の情報を含めてください。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MySQL サーバーが停止したかどうかを示します。 これに関する情報はサーバーのエラーログにあります。 <a class="xref" href="error-handling.html#crashing" title="B.3.3.3 MySQL が繰り返しクラッシュする場合の対処方法">セクションB.3.3.3「MySQL が繰り返しクラッシュする場合の対処方法」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              特定のクエリーによって <span class="command"><strong>mysqld</strong></span> が強制終了し、クエリーを実行する前に関係するテーブルが <code class="literal">CHECK TABLE</code> でチェックされていた場合は、再現可能なテストケースを提供してください。 <a class="xref" href="server-administration.html#debugging-mysql" title="5.9 MySQL のデバッグ">セクション5.9「MySQL のデバッグ」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              MySQL サーバーの <code class="literal">wait_timeout</code> システム変数の値 (<span class="command"><strong>mysqladmin variables</strong></span> を使用すると、この変数の値を取得できます。)
            </p></li><li class="listitem"><p>
              一般クエリーログを有効にして <span class="command"><strong>mysqld</strong></span> を実行し、問題のクエリーがログに出力されるかどうかを確認することを試みましたか。 (<a class="xref" href="server-administration.html#query-log" title="5.4.3 一般クエリーログ">セクション5.4.3「一般クエリーログ」</a>を参照してください。) 
            </p></li></ul></div><p>
          <a class="xref" href="error-handling.html#communication-errors" title="B.3.2.9 通信エラーおよび中止された接続">セクションB.3.2.9「通信エラーおよび中止された接続」</a>および<a class="xref" href="introduction.html#bug-reports" title="1.6 質問またはバグをレポートする方法">セクション1.6「質問またはバグをレポートする方法」</a>も参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="packet-too-large"></a>B.3.2.8 パケットが大きすぎます</h4></div></div></div><p>
          通信パケットは、MySQL サーバーに送信される単一の SQL ステートメント、クライアントに送信される単一行、またはソースレプリケーションサーバーからレプリカに送信されるバイナリログイベントです。
        </p><p>
          MySQL 8.0 Server およびクライアント間で転送可能なパケットの最大サイズは 1G バイトです。
        </p><p>
          MySQL クライアントまたは <span class="command"><strong>mysqld</strong></span> サーバーが <code class="literal">max_allowed_packet</code> バイトより大きいパケットを受け取ると、<code class="literal">ER_NET_PACKET_TOO_LARGE</code> エラーが発行され、接続が失われます。 一部のクライアントでは、パケットが大きすぎる場合、<code class="literal">「クエリー中に MySQL サーバーへの接続が失われました」</code>というエラーを受け取ることもあります。 
        </p><p>
          クライアントとサーバーの両方にそれぞれ <code class="literal">max_allowed_packet</code> 変数があるため、大きなパケットを処理する場合は、クライアントとサーバーの両方のこの変数を増やす必要があります。
        </p><p>
          <span class="command"><strong>mysql</strong></span> クライアントプログラムを使用している場合、<code class="literal">max_allowed_packet</code> 変数のデフォルトは 16M バイトです。 大きな値を設定するには、<span class="command"><strong>mysql</strong></span> を次のように起動します。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --max_allowed_packet=32M</code></strong>
</pre><p>
          これにより、パケットサイズが 32M バイトに設定されます。
        </p><p>
          サーバーのデフォルトの <code class="literal">max_allowed_packet</code> 値は 64M バイトです。 サーバーが大きなクエリーを処理する必要がある場合 (たとえば、大きい <code class="literal">BLOB</code> カラムを操作している場合) は、この値を増やすことができます。 たとえば、この変数に 128M バイトを設定するには、サーバーを次のように起動します。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld --max_allowed_packet=128M</code></strong>
</pre><p>
          オプションファイルを使用して <code class="literal">max_allowed_packet</code> を設定することもできます。 たとえば、サーバー側のサイズを 128M バイトに設定するには、次の行をオプションファイルに追加します。 
        </p><pre class="programlisting">[mysqld]
max_allowed_packet=128M
</pre><p>
          追加のメモリーは必要なときにのみ割り当てられるため、この変数の値を増やしておくと安全です。 たとえば、<span class="command"><strong>mysqld</strong></span> が追加のメモリーを割り当てるのは、長いクエリーが発行された場合、または<span class="command"><strong>mysqld</strong></span> が大きな結果行を返す必要がある場合のみです。 この変数のデフォルト値が小さいのは、クライアントとサーバーの間の不正なパケットを捕捉するための予防措置であり、誤って大きなパケットが使用されてメモリー不足にならないようにするためでもあります。 
        </p><p>
          大きい <code class="literal">BLOB</code> 値を使用しているが、そのクエリーを処理するための十分なメモリーへのアクセスを <span class="command"><strong>mysqld</strong></span> に与えていない場合にも、大きいパケットに関する予期しない問題が発生することがあります。 これに当てはまると思われる場合は、<span class="command"><strong>mysqld_safe</strong></span> スクリプトの先頭に <span class="command"><strong>ulimit -d 256000</strong></span> を追加して、<span class="command"><strong>mysqld</strong></span> を再起動してください。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="communication-errors"></a>B.3.2.9 通信エラーおよび中止された接続</h4></div></div></div><a class="indexterm" name="idm45302161860416"></a><a class="indexterm" name="idm45302161858960"></a><a class="indexterm" name="idm45302161857600"></a><p>
          通信エラー、中止された接続などの接続の問題が発生した場合は、次の情報ソースを使用して問題を診断してください。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              エラーログ。 <a class="xref" href="server-administration.html#error-log" title="5.4.2 エラーログ">セクション5.4.2「エラーログ」</a> を参照してください。 
            </p></li><li class="listitem"><p>
              一般クエリーログ。 <a class="xref" href="server-administration.html#query-log" title="5.4.3 一般クエリーログ">セクション5.4.3「一般クエリーログ」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">Aborted_<em class="replaceable"><code>xxx</code></em></code> ステータス変数および <code class="literal">Connection_errors_<em class="replaceable"><code>xxx</code></em></code> ステータス変数。 <a class="xref" href="server-administration.html#server-status-variables" title="5.1.10 サーバーステータス変数">セクション5.1.10「サーバーステータス変数」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              ホストキャッシュ。パフォーマンススキーマ <code class="literal">host_cache</code> テーブルを使用してアクセスできます。 <a class="xref" href="server-administration.html#host-cache" title="5.1.12.3 DNS ルックアップとホストキャッシュ">セクション5.1.12.3「DNS ルックアップとホストキャッシュ」</a>および<a class="xref" href="performance-schema.html#performance-schema-host-cache-table" title="27.12.19.5 host_cache テーブル">セクション27.12.19.5「host_cache テーブル」</a>を参照してください。 
            </p></li></ul></div><p>
          <code class="literal">log_error_verbosity</code> システム変数が 3 に設定されている場合、次のようなメッセージがエラーログに記録されることがあります:
        </p><pre class="programlisting">[Note] Aborted connection 854 to db: 'employees' user: 'josh'
</pre><p>
          クライアントも接続できない場合、サーバーは <code class="literal">Aborted_connects</code> ステータス変数をインクリメントします。 接続の失敗は、次の原因で発生することがあります。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              クライアントがデータベースにアクセスしようとしましたが、データベースに対する権限がありません。
            </p></li><li class="listitem"><p>
              クライアントが不正なパスワードを使用している。
            </p></li><li class="listitem"><p>
              パケットに正しい情報が含まれていない。
            </p></li><li class="listitem"><p>
              接続パケットの取得には <code class="literal">connect_timeout</code> 秒より長くかかります。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 
            </p></li></ul></div><p>
          これらのことが発生した場合は、何者かがサーバーに侵入しようとしていることを示している可能性があります。 一般クエリーログが有効になっている場合は、これらのタイプの問題に関するメッセージがログに記録されます。 
        </p><p>
          クライアントが正常に接続したが、その後不適切に切断または終了した場合、サーバーは <code class="literal">Aborted_clients</code> ステータス変数をインクリメントし、<span class="errortext">「接続が中止されました」</span>というメッセージをエラーログに記録します。 この原因は次のいずれかです。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              クライアントプログラムが、終了する前に <code class="literal">mysql_close()</code> を呼び出さなかった。
            </p></li><li class="listitem"><p>
              クライアントが、サーバーに要求を発行せずに <code class="literal">wait_timeout</code> 秒または <code class="literal">interactive_timeout</code> 秒を超えてスリープしている。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              クライアントプログラムがデータ転送中に突然終了した。
            </p></li></ul></div><p>
          中断された接続または中断されたクライアントに関するその他の問題の理由は次のとおりです:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">max_allowed_packet</code> 変数の値が小さすぎるか、クエリーが <span class="command"><strong>mysqld</strong></span> 用に割り当てられているメモリーより大きいメモリーの領域を要求した。 <a class="xref" href="error-handling.html#packet-too-large" title="B.3.2.8 パケットが大きすぎます">セクションB.3.2.8「パケットが大きすぎます」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              Linux で半二重および全二重の両方の Ethernet プロトコルが使用された。 一部の Linux イーサネットドライバにはこのバグがあります。 FTP を使用して、クライアントマシンとサーバーマシンの間で大きなファイルを転送することによって、このバグをテストしてください。 転送がバースト-ポーズ-バースト-ポーズモードになる場合は、Linux の二重化シンドロームに陥っています。 ネットワークカードとハブ/スイッチの二重化モードを全二重または半二重に切り替えて結果をテストし、最適な設定を判別します。 
            </p></li><li class="listitem"><p>
              読み取りで中断が発生するスレッドライブラリの問題。
            </p></li><li class="listitem"><p>
              不適切に構成されている TCP/IP。
            </p></li><li class="listitem"><p>
              障害のある Ethernet、ハブ、スイッチ、ケーブルなど。 これは、ハードウェアを交換することによってのみ適切に診断できます。 
            </p></li></ul></div><p>
          <a class="xref" href="error-handling.html#gone-away" title="B.3.2.7 MySQL サーバーが存在しなくなりました">セクションB.3.2.7「MySQL サーバーが存在しなくなりました」</a>も参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="full-table"></a>B.3.2.10 テーブルが満杯です</h4></div></div></div><a class="indexterm" name="idm45302161811136"></a><p>
          テーブルが満杯であるというエラーが発生した場合は、ディスクが満杯であるか、テーブルが最大サイズに達した可能性があります。 MySQL データベースの事実上の最大テーブルサイズは、通常、MySQL の内部制限ではなくオペレーティングシステムのファイルサイズに関する制約によって判断します。 <a class="xref" href="optimization.html#table-size-limit" title="8.4.6 テーブルサイズの制限">セクション8.4.6「テーブルサイズの制限」</a>を参照してください。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cannot-create"></a>B.3.2.11 ファイルを作成/書き込みできない</h4></div></div></div><a class="indexterm" name="idm45302161806592"></a><p>
          一部のクエリーで次のタイプのエラーを受け取る場合は、MySQL が一時ディレクトリに結果セットの一時ファイルを作成できないことを意味します。
        </p><pre class="programlisting">Can't create/write to file '\\sqla3fe_0.ism'.
</pre><p>
          上記のエラーは Windows での一般的なメッセージです。UNIX のメッセージも似ています。
        </p><p>
          解決策の 1 つは、<code class="option">--tmpdir</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> を起動するか、オプションファイルの <code class="literal">[mysqld]</code> セクションにこのオプションを追加することです。 たとえば、<code class="filename">C:\temp</code> ディレクトリを指定するには、次の行を使用します。 
        </p><pre class="programlisting">[mysqld]
tmpdir=C:/temp
</pre><p>
          <code class="filename">C:\temp</code> ディレクトリが存在していて、MySQL サーバーが書き込むための十分な領域がある必要があります。 <a class="xref" href="programs.html#option-files" title="4.2.2.2 オプションファイルの使用">セクション4.2.2.2「オプションファイルの使用」</a>を参照してください。 
        </p><p>
          このエラーの別の原因は権限の問題です。 MySQL サーバーが <code class="literal">tmpdir</code> ディレクトリに書き込めることを確認してください。 
        </p><p>
          <span class="command"><strong>perror</strong></span> で表示されるエラーコードも確認します。 サーバーがテーブルに書き込むことができない原因の 1 つは、ファイルシステムが満杯であるためです。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>perror 28</code></strong>
OS error code  28:  No space left on device
</pre><p>
          起動時に次のタイプのエラーを受け取る場合は、データファイルの格納に使用されるファイルシステムまたはディレクトリが書き込み保護されていることを示しています。 書き込みエラーがテストファイルに対するものであれば、このエラーは重大ではなく、無視しても安全です。 
        </p><pre class="programlisting">Can't create test file /usr/local/mysql/data/master.lower-test</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="commands-out-of-sync"></a>B.3.2.12 コマンドは同期されていません</h4></div></div></div><a class="indexterm" name="idm45302161787680"></a><p>
          クライアントのコードで<code class="literal">「コマンドは同期されていません。このコマンドは現在実行できません」</code>というメッセージを受け取る場合は、クライアント関数を間違った順序で呼び出しています。
        </p><p>
          たとえば、これは、<code class="literal">mysql_free_result()</code> を呼び出す前に、<code class="literal">mysql_use_result()</code> を使用して、新しいクエリーを実行しようとした場合に発生することがあります。 これは、データを返す 2 つのクエリーの間に <code class="literal">mysql_use_result()</code> または <code class="literal">mysql_store_result()</code> を呼び出さずに実行した場合にも発生することがあります。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ignoring-user"></a>B.3.2.13 ユーザーを無視します</h4></div></div></div><p>
          次のエラーが表示される場合は、<span class="command"><strong>mysqld</strong></span> が起動されたときまたは付与テーブルをリロードしたときに、<code class="literal">user</code> テーブルで不正なパスワードを持つアカウントが見つかったことを意味します。
        </p><p>
          <code class="literal">ユーザー '<em class="replaceable"><code>some_user</code></em>'@'<em class="replaceable"><code>some_host</code></em>' のパスワードが不正です。ユーザーを無視します</code>
        </p><p>
          その結果、このアカウントは権限システムによって無視されます。 この問題を解決するには、新しい有効なパスワードをアカウントに割り当てます。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cannot-find-table"></a>B.3.2.14 表 'tbl_name' は存在しません</h4></div></div></div><p>
          次のエラーが表示される場合は、通常、指定された名前のデフォルトデータベースにテーブルが存在しないことを意味します。
        </p><pre class="programlisting">Table '<em class="replaceable"><code>tbl_name</code></em>' doesn't exist
Can't find file: '<em class="replaceable"><code>tbl_name</code></em>' (errno: 2)
</pre><p>
          テーブルは存在しているが、誤った名前で参照している場合もあります。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MySQL ではディレクトリとファイルを使用してデータベースとテーブルを格納するため、大/小文字が区別されるファイル名を持つファイルシステム上にある場合、データベースとテーブルの名前は大/小文字が区別されます。
            </p></li><li class="listitem"><p>
              Windows など、大文字と小文字が区別されないファイルシステムの場合でも、クエリー内の特定のテーブルへのすべての参照で同じ大文字と小文字を使用する必要があります。
            </p></li></ul></div><p>
          デフォルトデータベースにあるテーブルを確認するには、<code class="literal">SHOW TABLES</code> を使用します。 <a class="xref" href="sql-statements.html#show" title="13.7.7 SHOW ステートメント">セクション13.7.7「SHOW ステートメント」</a>を参照してください。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cannot-initialize-character-set"></a>B.3.2.15 文字セットを初期化できません</h4></div></div></div><a class="indexterm" name="idm45302161762032"></a><p>
          文字セットの問題がある場合は、次のようなエラーが表示されることがあります。
        </p><pre class="programlisting">MySQL Connection Failed: Can't initialize character set <em class="replaceable"><code>charset_name</code></em>
</pre><p>
          このエラーには次のいずれかの原因がある可能性があります。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              文字セットがマルチバイト文字セットであり、クライアントでその文字セットがサポートされていない。 この場合、<code class="option">-DDEFAULT_CHARSET=<em class="replaceable"><code>charset_name</code></em></code> オプションを指定して <span class="command"><strong>CMake</strong></span> を実行し、クライアントを再コンパイルする必要があります。 <a class="xref" href="installing.html#source-configuration-options" title="2.9.7 MySQL ソース構成オプション">セクション2.9.7「MySQL ソース構成オプション」</a>を参照してください。 
            </p><p>
              すべての標準 MySQL バイナリは、すべてのマルチバイト文字セットをサポートしてコンパイルされます。
            </p></li><li class="listitem"><p>
              文字セットは <span class="command"><strong>mysqld</strong></span> にコンパイルされない単純な文字セットであり、文字セットの定義ファイルがクライアントが予期している場所にありません。
            </p><p>
              この場合は、次のいずれかの方法を使用して問題を解決する必要があります。
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  その文字セットがサポートされるようにクライアントを再コンパイルします。 <a class="xref" href="installing.html#source-configuration-options" title="2.9.7 MySQL ソース構成オプション">セクション2.9.7「MySQL ソース構成オプション」</a>を参照してください。 
                </p></li><li class="listitem"><p>
                  文字セットの定義ファイルがあるディレクトリをクライアントに指定します。 多くのクライアントでは、<code class="option">--character-sets-dir</code> オプションを指定することによってこれを行うことができます。 
                </p></li><li class="listitem"><p>
                  文字定義ファイルをクライアントが予期しているパスにコピーします。
                </p></li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="not-enough-file-handles"></a>B.3.2.16 ファイルが見つからず同様のエラーが発生しました</h4></div></div></div><p>
          MySQL から <code class="literal">errno 23</code> または <code class="literal">errno 24</code> で <code class="literal">ERROR '<em class="replaceable"><code>file_name</code></em>' not found (errno: 23)</code>、<code class="literal">Can't open file: <em class="replaceable"><code>file_name</code></em> (errno: 24)</code>、またはその他のエラーが発生した場合は、MySQL サーバーに十分なファイル記述子が割り当てられていないことを意味します。 <span class="command"><strong>perror</strong></span> ユーティリティーを使用すると、エラー番号の意味の説明を取得できます。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>perror 23</code></strong>
OS error code  23:  File table overflow
shell&gt; <strong class="userinput"><code>perror 24</code></strong>
OS error code  24:  Too many open files
shell&gt; <strong class="userinput"><code>perror 11</code></strong>
OS error code  11:  Resource temporarily unavailable
</pre><p>
          ここでの問題は、<span class="command"><strong>mysqld</strong></span> が同時にオープンしたままにしようとしているファイルが多すぎることです。 一度に多数のファイルをオープンしないように <span class="command"><strong>mysqld</strong></span> に通知するか、<span class="command"><strong>mysqld</strong></span> が使用できるファイルディスクリプタの数を増やします。 
        </p><p>
          一度にオープンするファイル数を少なくするように <span class="command"><strong>mysqld</strong></span> に通知するには、<code class="literal">table_open_cache</code> システム変数の値 (デフォルト値は 64) を減らすことによってテーブルキャッシュを小さくします。 <a class="xref" href="optimization.html#table-cache" title="8.4.3.1 MySQL でのテーブルのオープンとクローズの方法">セクション8.4.3.1「MySQL でのテーブルのオープンとクローズの方法」</a>で説明されているように、状況によっては、サーバーがキャッシュサイズを一時的に拡張しようとする可能性があるため、これによってファイルディスクリプタの不足を完全に防ぐことはできません。 <code class="literal">max_connections</code> の値を減らすことによっても、オープンファイルの数が減少します (デフォルト値は 100)。 
        </p><a class="indexterm" name="idm45302161727856"></a><p>
          <span class="command"><strong>mysqld</strong></span> が使用できるファイルディスクリプタの数を変更するには、<span class="command"><strong>mysqld_safe</strong></span> に <code class="option">--open-files-limit</code> オプションを使用するか、<code class="literal">open_files_limit</code> システム変数を設定します。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 これらの値を設定するもっとも簡単な方法は、オプションファイルにオプションを追加することです。 <a class="xref" href="programs.html#option-files" title="4.2.2.2 オプションファイルの使用">セクション4.2.2.2「オプションファイルの使用」</a>を参照してください。 オープンファイルの制限の設定をサポートしていない古いバージョンの <span class="command"><strong>mysqld</strong></span> を使用している場合は、<span class="command"><strong>mysqld_safe</strong></span> スクリプトを編集できます。 このスクリプトには、コメントアウトされた行 <span class="command"><strong>ulimit -n 256</strong></span> があります。 <code class="literal">#</code> 文字を削除してこの行をコメント解除し、数字 <code class="literal">256</code> を変更して、<span class="command"><strong>mysqld</strong></span> が使用できるファイルディスクリプタの数を設定します。 
        </p><p>
          <code class="option">--open-files-limit</code> および <span class="command"><strong>ulimit</strong></span> を使用すると、ファイルディスクリプタの数を増やすことができますが、オペレーティングシステムが課している制限が上限となります。 <span class="command"><strong>mysqld_safe</strong></span> または <span class="command"><strong>mysqld</strong></span> を <code class="literal">root</code> として起動した場合にのみオーバーライドできる<span class="quote">「<span class="quote">堅固な</span>」</span>制限もあります (この場合、起動後に <code class="literal">root</code> として実行され続けないように、<code class="option">--user</code> オプションを指定してサーバーを起動する必要もあります)。 各プロセスで使用できるファイルディスクリプタの数に関するオペレーティングシステムの制限を緩める必要がある場合は、システムのドキュメントを参照してください。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            <span class="command"><strong>tcsh</strong></span> シェルを実行している場合、<span class="command"><strong>ulimit</strong></span> は機能しません。また、<span class="command"><strong>tcsh</strong></span> では、現在の制限を問い合わせたときに不正な値が報告されます。 この場合は、<span class="command"><strong>sh</strong></span> を使用して <span class="command"><strong>mysqld_safe</strong></span> を起動してください。 
          </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="table-corruption"></a>B.3.2.17 テーブルの破損の問題</h4></div></div></div><p>
          <code class="literal">myisam_recover_options</code> システム変数を設定して <span class="command"><strong>mysqld</strong></span> を起動した場合、<code class="literal">MyISAM</code> テーブルが正しくクローズされていないまたはクラッシュとマークされていれば、MySQL によって自動的にチェックされ、修復が試行されます。 これが発生した場合、MySQL は <code class="literal">hostname.err</code> ファイルに<code class="literal">「警告: テーブル ... をチェックしています」</code>と書き込み、テーブルを修復する必要がある場合は、<code class="literal">「警告: テーブルを修復しています」</code>がそのあとに書き込まれます。 これらのエラーを多数受け取り、その直前に予期しない <span class="command"><strong>mysqld</strong></span> の停止がなかった場合は、何らかの問題があるため、さらに調査する必要があります。 
        </p><p>
          サーバーは、<code class="literal">MyISAM</code> テーブルの破損を検出すると、ソースファイルの名前や行番号、テーブルにアクセスするスレッドのリストなどの追加情報をエラーログに書き込みます。 たとえば、<code class="literal">「thread_id=1 からエラーを受け取りました。mi_dynrec.c:368」</code>です。 これは、バグレポートに含めると役に立つ情報です。 
        </p><p>
          <a class="xref" href="server-administration.html#server-options" title="5.1.7 サーバーコマンドオプション">セクション5.1.7「サーバーコマンドオプション」</a>および<a class="xref" href="server-administration.html#reproducible-test-case" title="5.9.1.7 テーブルが破損した場合のテストケースの作成">セクション5.9.1.7「テーブルが破損した場合のテストケースの作成」</a>も参照してください。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="administration-issues"></a>B.3.3 管理関連の問題</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="error-handling.html#file-permissions">B.3.3.1 ファイル権限の問題</a></span></dt><dt><span class="section"><a href="error-handling.html#resetting-permissions">B.3.3.2 root のパスワードをリセットする方法</a></span></dt><dt><span class="section"><a href="error-handling.html#crashing">B.3.3.3 MySQL が繰り返しクラッシュする場合の対処方法</a></span></dt><dt><span class="section"><a href="error-handling.html#full-disk">B.3.3.4 MySQL が満杯のディスクを処理する方法</a></span></dt><dt><span class="section"><a href="error-handling.html#temporary-files">B.3.3.5 MySQL が一時ファイルを格納する場所</a></span></dt><dt><span class="section"><a href="error-handling.html#problems-with-mysql-sock">B.3.3.6 MySQL の UNIX ソケットファイルを保護または変更する方法</a></span></dt><dt><span class="section"><a href="error-handling.html#timezone-problems">B.3.3.7 タイムゾーンの問題</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="file-permissions"></a>B.3.3.1 ファイル権限の問題</h4></div></div></div><a class="indexterm" name="idm45302161689680"></a><a class="indexterm" name="idm45302161687568"></a><a class="indexterm" name="idm45302161685472"></a><a class="indexterm" name="idm45302161683392"></a><a class="indexterm" name="idm45302161682016"></a><p>
          ファイル権限に問題がある場合、<span class="command"><strong>mysqld</strong></span> の起動時に <code class="literal">UMASK</code> または <code class="literal">UMASK_DIR</code> 環境変数が正しく設定されないことがあります。 たとえば、<span class="command"><strong>mysqld</strong></span> では、テーブルの作成時に次のエラーメッセージが発行される場合があります: 
        </p><pre class="programlisting">ERROR: Can't find file: 'path/with/<em class="replaceable"><code>file_name</code></em>' (Errcode: 13)
</pre><p>
          <code class="literal">UMASK</code> および <code class="literal">UMASK_DIR</code> のデフォルト値は、それぞれ <code class="literal">0640</code> および <code class="literal">0750</code> です。<span class="command"><strong>mysqld</strong></span> では、<code class="literal">UMASK</code> または <code class="literal">UMASK_DIR</code> の値がゼロで始まる場合、その値は 8 進数であるとみなされます。 たとえば、0600 オクタルは 384 桁であるため、<code class="literal">UMASK=0600</code> の設定は <code class="literal">UMASK=384</code> と同等です。 
        </p><p>
          <span class="command"><strong>mysqld_safe</strong></span> を使用して <span class="command"><strong>mysqld</strong></span> を起動する場合は、デフォルトの <code class="literal">UMASK</code> 値を次のように変更します:
        </p><pre class="programlisting">UMASK=384  # = 600 in octal
export UMASK
mysqld_safe &amp;
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            <code class="literal">UMASK</code> を考慮しない <span class="command"><strong>mysqld_safe</strong></span> を使用して <span class="command"><strong>mysqld</strong></span> を起動すると、エラーログファイルに例外が適用されます: <span class="command"><strong>mysqld</strong></span> の起動前にエラーログファイルが存在しない場合、<span class="command"><strong>mysqld_safe</strong></span> はエラーログファイルを作成し、<span class="command"><strong>mysqld_safe</strong></span> は厳密な値 <code class="literal">0137</code> に設定された umask を使用します。 これが適切でない場合は、<span class="command"><strong>mysqld_safe</strong></span> を実行する前に、目的のアクセスモードでエラーファイルを手動で作成します。 
          </p></div><a class="indexterm" name="idm45302161656496"></a><a class="indexterm" name="idm45302161654992"></a><p>
          デフォルトでは、<span class="command"><strong>mysqld</strong></span> はアクセス権限の値が <code class="literal">0750</code> のデータベースディレクトリを作成します。 この動作を変更するには、<code class="literal">UMASK_DIR</code> 変数を設定します。 この値を設定すると、新しいディレクトリは <code class="literal">UMASK</code> 値と <code class="literal">UMASK_DIR</code> 値を組み合わせたもので作成されます。 たとえば、グループにすべての新しいディレクトリへのアクセス権を付与するには、次のように <span class="command"><strong>mysqld_safe</strong></span> を起動します: 
        </p><pre class="programlisting">UMASK_DIR=504  # = 770 in octal
export UMASK_DIR
mysqld_safe &amp;
</pre><p>
          追加の詳細については、<a class="xref" href="programs.html#environment-variables" title="4.9 環境変数">セクション4.9「環境変数」</a>を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="resetting-permissions"></a>B.3.3.2 root のパスワードをリセットする方法</h4></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="error-handling.html#resetting-permissions-windows">B.3.3.2.1 root のパスワードのリセット: Windows システム</a></span></dt><dt><span class="section"><a href="error-handling.html#resetting-permissions-unix">B.3.3.2.2 root パスワードのリセット: Unix および Unix- 類似システム</a></span></dt><dt><span class="section"><a href="error-handling.html#resetting-permissions-generic">B.3.3.2.3 root のパスワードのリセット: 一般的な手順</a></span></dt></dl></div><a class="indexterm" name="idm45302161643952"></a><a class="indexterm" name="idm45302161641840"></a><a class="indexterm" name="idm45302161639808"></a><a class="indexterm" name="idm45302161637776"></a><p>
          MySQL の <code class="literal">root</code> パスワードを割り当てていない場合、サーバーは <code class="literal">root</code> として接続するためのパスワードをまったく必要としません。 ただし、これはセキュリティー保護されていません。 パスワードの割当て手順は、<a class="xref" href="installing.html#default-privileges" title="2.10.4 初期 MySQL アカウントの保護">セクション2.10.4「初期 MySQL アカウントの保護」</a> を参照してください。 
        </p><p>
          <code class="literal">root</code> パスワードがわかっていて、それを変更する場合は、<a class="xref" href="sql-statements.html#alter-user" title="13.7.1.1 ALTER USER ステートメント">セクション13.7.1.1「ALTER USER ステートメント」</a> および <a class="xref" href="sql-statements.html#set-password" title="13.7.1.10 SET PASSWORD ステートメント">セクション13.7.1.10「SET PASSWORD ステートメント」</a> を参照してください。
        </p><p>
          以前に <code class="literal">root</code> パスワードを割り当てたが、忘れた場合は、新しいパスワードを割り当てることができます。 次のセクションでは、Windows、Unix および Unix に似たシステムの手順と、任意のシステムに適用される一般的な手順について説明します。 
        </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="resetting-permissions-windows"></a>B.3.3.2.1 root のパスワードのリセット: Windows システム</h5></div></div></div><p>
            Windows では、次の手順を使用して MySQL <code class="literal">'root'@'localhost'</code>アカウントのパスワードをリセットします。 別のホスト名部分を持つ <code class="literal">root</code> アカウントのパスワードを変更するには、そのホスト名を使用するように指示を変更します。 
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                Administrator としてシステムにログオンします。
              </p></li><li class="listitem"><p>
                MySQL サーバーが実行されている場合は停止します。 Windows サービスとして実行されているサーバーの場合は、サービスマネージャーを開きます (<span class="guimenu">「スタート」</span>メニューから、<span class="guisubmenu">「コントロール パネル」</span>、<span class="guisubmenu">「管理ツール」</span>、<span class="guimenuitem">「サービス」</span>の順に選択します)。 リスト内で MySQL サービスを見つけて、それを停止します。 
              </p><p>
                サーバーがサービスとして実行されていない場合は、タスクマネージャーを使用して強制的に停止する必要があることがあります。
              </p></li><li class="listitem"><p>
                単一行にパスワード割当てステートメントを含むテキストファイルを作成します。 パスワードを使用するパスワードに置き換えます。 
              </p><pre class="programlisting">ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewPass';
</pre></li><li class="listitem"><p>
                ファイルを保存します。 この例では、ファイルに <code class="filename">C:\mysql-init.txt</code> という名前を付けることを前提としています。 
              </p></li><li class="listitem"><p>
                コンソールウィンドウを開いて、コマンドプロンプトを表示します (<span class="guimenu">「スタート」</span>メニューから<span class="guisubmenu">「ファイル名を指定して実行」</span>を選択し、実行するコマンドとして <span class="command"><strong>cmd</strong></span> を入力します)。
              </p></li><li class="listitem"><p>
                ファイルに名前を付けるように <code class="literal">init_file</code> システム変数を設定して MySQL サーバーを起動します (オプション値のバックスラッシュが二重になることに注意してください):
              </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>cd "C:\Program Files\MySQL\MySQL Server 8.0\bin"</code></strong>
C:\&gt; <strong class="userinput"><code>mysqld --init-file=C:\\mysql-init.txt</code></strong>
</pre><p>
                MySQL を別の場所にインストールした場合は、<span class="command"><strong>cd</strong></span> コマンドを適宜調整します。
              </p><p>
                サーバーは、起動時に <code class="literal">init_file</code> システム変数で指定されたファイルの内容を実行し、<code class="literal">'root'@'localhost'</code>アカウントのパスワードを変更します。
              </p><p>
                サーバー出力をログファイルではなくコンソールウィンドウに表示するには、<span class="command"><strong>mysqld</strong></span> コマンドに <code class="option">--console</code> オプションを追加します。
              </p><p>
                MySQL インストールウィザードを使用して MySQL をインストールした場合、<code class="option">--defaults-file</code> オプションの指定が必要になることがあります。 例: 
              </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>mysqld</code></strong>
         <strong class="userinput"><code>--defaults-file="C:\\ProgramData\\MySQL\\MySQL Server 8.0\\my.ini"</code></strong>
         <strong class="userinput"><code>--init-file=C:\\mysql-init.txt</code></strong>
</pre><p>
                適切な <code class="option">--defaults-file</code> 設定はサービスマネージャーを使用して見つけることができます (<span class="guimenu">「スタート」</span>メニューから<span class="guisubmenu">「コントロール パネル」</span>、<span class="guisubmenu">「管理ツール」</span>、<span class="guimenuitem">「サービス」</span>の順に選択します)。 リスト内で MySQL サービスを見つけて、それを右クリックし、<code class="literal">「プロパティ」</code>オプションを選択します。 <code class="literal">「実行ファイルのパス」</code>フィールドに <code class="option">--defaults-file</code> 設定が含まれています。 
              </p></li><li class="listitem"><p>
                サーバーが正常に起動されたら <code class="filename">C:\mysql-init.txt</code> を削除します。
              </p></li></ol></div><p>
            新しいパスワードを使用して <code class="literal">root</code> として MySQL サーバーに接続できるようになりました。 MySQL サーバーを停止し、通常どおりに再起動します。 サーバーをサービスとして実行している場合は、Windows の「サービス」ウィンドウから開始します。 サーバーを手動で起動している場合は、通常使用するコマンドを使用してください。 
          </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="resetting-permissions-unix"></a>B.3.3.2.2 root パスワードのリセット: Unix および Unix- 類似システム</h5></div></div></div><p>
            Unix では、次の手順を使用して MySQL <code class="literal">'root'@'localhost'</code>アカウントのパスワードをリセットします。 別のホスト名部分を持つ <code class="literal">root</code> アカウントのパスワードを変更するには、そのホスト名を使用するように指示を変更します。 
          </p><p>
            この手順では、通常実行に使用する Unix ログインアカウントから MySQL サーバーを起動することを前提としています。 たとえば、<code class="literal">mysql</code> のログインアカウントを使用してサーバーを実行する場合は、この手順を使用する前に <code class="literal">mysql</code> としてログインしてください。 または、<code class="literal">root</code> としてログインすることもできますが、この場合は <code class="option">--user=mysql</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> を起動する<span class="emphasis"><em>必要があります</em></span>。 <code class="option">--user=mysql</code> を使用せずに <code class="literal">root</code> としてサーバーを起動した場合、サーバーは <code class="literal">root</code> が所有するファイル (ログファイルなど) をデータディレクトリに作成することがあり、以降のサーバーの起動で権限関連の問題の原因となることがあります。 その場合は、ファイルの所有権を <code class="literal">mysql</code> に変更するか、削除する必要があります。 
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                MySQL サーバーを実行する Unix ユーザー (<code class="literal">mysql</code> など) としてシステムにログオンします。
              </p></li><li class="listitem"><p>
                MySQL サーバーが実行されている場合は停止します。 サーバーのプロセス ID が含まれている <code class="filename">.pid</code> ファイルを見つけます。 このファイルの正確な場所と名前は、配布、ホスト名、および構成によって異なります。 一般的な場所は、<code class="filename">/var/lib/mysql/</code>、<code class="filename">/var/run/mysqld/</code>、および <code class="filename">/usr/local/mysql/data/</code> です。 通常、ファイル名には <code class="filename">.pid</code> という拡張子が付けられており、<code class="filename">mysqld</code> またはシステムのホスト名で始まります。 
              </p><p>
                通常の <code class="literal">kill</code> (<code class="literal">kill -9</code> ではなく) を <span class="command"><strong>mysqld</strong></span> プロセスに送信して、MySQL サーバーを停止します。 次のコマンドで、<code class="filename">.pid</code> ファイルの実際のパス名を使用します: 
              </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>kill `cat /mysql-data-directory/host_name.pid`</code></strong>
</pre><p>
                <code class="literal">cat</code> コマンドには逆引用符 (通常の引用符ではなく) を使用します。 これにより、<code class="literal">cat</code> の出力が <code class="literal">kill</code> コマンドに指定されます。 
              </p></li><li class="listitem"><p>
                単一行にパスワード割当てステートメントを含むテキストファイルを作成します。 パスワードを使用するパスワードに置き換えます。 
              </p><pre class="programlisting">ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewPass';
</pre></li><li class="listitem"><p>
                ファイルを保存します。 この例では、ファイルに<code class="filename">/home/me/mysql-init</code> という名前を付けることを前提としています。 ファイルにはパスワードが含まれているため、他のユーザーが読み取れる場所に保存しないでください。 <code class="literal">mysql</code> (サーバーが実行されるときのユーザー) としてログインしていない場合は、<code class="literal">mysql</code> による読み取りを許可する権限がファイルに設定されていることを確認してください。 
              </p></li><li class="listitem"><p>
                ファイルに名前を付けるように <code class="literal">init_file</code> システム変数を設定して、MySQL サーバーを起動します:
              </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqld --init-file=/home/me/mysql-init &amp;</code></strong>
</pre><p>
                サーバーは、起動時に <code class="literal">init_file</code> システム変数で指定されたファイルの内容を実行し、<code class="literal">'root'@'localhost'</code>アカウントのパスワードを変更します。
              </p><p>
                サーバーの通常の起動方法によっては、その他のオプションも必要になる場合があります。 たとえば、<code class="literal">init_file</code> 引数の前に <code class="option">--defaults-file</code> が必要な場合があります。 
              </p></li><li class="listitem"><p>
                サーバーが正常に起動されたら <code class="filename">/home/me/mysql-init</code> を削除します。
              </p></li></ol></div><p>
            新しいパスワードを使用して <code class="literal">root</code> として MySQL サーバーに接続できるようになりました。 サーバーを停止して、通常モードで再起動します。 
          </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="resetting-permissions-generic"></a>B.3.3.2.3 root のパスワードのリセット: 一般的な手順</h5></div></div></div><p>
            前述のセクションでは、Windows、Unix および Unix に似たシステム専用のパスワードリセット手順について説明します。 または、どのプラットフォームでも、<span class="command"><strong>mysql</strong></span> クライアントを使用してパスワードをリセットできます (ただし、このアプローチの安全性は低くなります): 
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                必要に応じて MySQL サーバーを停止し、<code class="option">--skip-grant-tables</code> オプションを使用して再起動します。 これにより、すべてのユーザーがパスワードなしですべての権限で接続できるようになり、<code class="literal">ALTER USER</code> や <code class="literal">SET PASSWORD</code> などのアカウント管理ステートメントが無効になります。 これはセキュアではないため、<code class="option">--skip-grant-tables</code> オプションを使用してサーバーを起動すると、<code class="literal">skip_networking</code> を有効にしてリモート接続も無効になります。 
              </p></li><li class="listitem"><p>
                <span class="command"><strong>mysql</strong></span> クライアントを使用して MySQL サーバーに接続します。サーバーは <code class="option">--skip-grant-tables</code> で起動されたため、パスワードは必要ありません:
              </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql</code></strong>
</pre></li><li class="listitem"><p>
                <code class="literal">mysql</code> クライアントで、account-management ステートメントが機能するように付与テーブルをリロードするようにサーバーに指示します:
              </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>FLUSH PRIVILEGES;</code></strong>
</pre><p>
                次に、<code class="literal">'root'@'localhost'</code>アカウントのパスワードを変更します。 パスワードを使用するパスワードに置き換えます。 別のホスト名部分を持つ <code class="literal">root</code> アカウントのパスワードを変更するには、そのホスト名を使用するように指示を変更します。 
              </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewPass';</code></strong>
</pre></li></ol></div><p>
            新しいパスワードを使用して <code class="literal">root</code> として MySQL サーバーに接続できるようになりました。 サーバーを停止し、通常どおりに再起動します (<code class="option">--skip-grant-tables</code> オプションを指定せず、<code class="literal">skip_networking</code> システム変数を有効にせずに)。 
          </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="crashing"></a>B.3.3.3 MySQL が繰り返しクラッシュする場合の対処方法</h4></div></div></div><a class="indexterm" name="idm45302161510736"></a><p>
          各 MySQL バージョンは、リリース前に多くのプラットフォームでテストされています。 これは、MySQL にバグがないということではありませんが、バグがあってもごく少数であり、見つかることはまれです。 問題が発生した場合は、システムがクラッシュした正確な原因を探すことが常に役に立ちます。問題の修正が迅速に得られる可能性が高まるためです。 
        </p><p>
          まず、問題は <span class="command"><strong>mysqld</strong></span> サーバーが停止したことであるかどうか、またはクライアントに関連しているかどうかを判別してください。 <span class="command"><strong>mysqld</strong></span> サーバーが稼働している時間を確認するには、<span class="command"><strong>mysqladmin version</strong></span> を実行します。 <span class="command"><strong>mysqld</strong></span> が停止して再起動された場合は、サーバーのエラーログを確認すると原因が見つかる可能性があります。 <a class="xref" href="server-administration.html#error-log" title="5.4.2 エラーログ">セクション5.4.2「エラーログ」</a> を参照してください。 
        </p><p>
          一部のシステムでは、<span class="command"><strong>mysqld</strong></span> が停止した場所のスタックトレースがエラーログに記録されます。 エラーログに書き込まれる変数値は、常に 100% 正しいとは限りません。 
        </p><p>
          予期しないサーバーイグジットの多くは、データファイルまたはインデックスファイルが破損していることが原因です。 MySQL は、各 SQL ステートメントの実行後、クライアントに結果を通知する前に、ディスク上のファイルを <code class="literal">write()</code> システムコールを使用して更新します。 (<code class="literal">delay_key_write</code> システム変数を有効にして実行している場合、データファイルは書き込まれますがインデックスファイルは書き込まれません。) これは、<span class="command"><strong>mysqld</strong></span> がクラッシュしてもデータファイルのコンテンツは安全であることを意味します。フラッシュされていないデータがオペレーティングシステムによってディスクに書き込まれることが保証されているためです。 各 SQL ステートメントのあとに MySQL がすべてのデータをディスクにフラッシュするようにするには、<code class="option">--flush</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> を起動します。 
        </p><p>
          これは、通常、次のいずれかが発生していなければ、データが損なわれたテーブルができることはないことを意味します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MySQL サーバーまたはサーバーのホストが更新中に強制終了された。
            </p></li><li class="listitem"><p>
              更新の途中に <span class="command"><strong>mysqld</strong></span> が停止するバグが見つかった。
            </p></li><li class="listitem"><p>
              一部の外部プログラムは、テーブルを適切にロックせずに、<span class="command"><strong>mysqld</strong></span> と同時にデータファイルまたはインデックスファイルを操作しています。
            </p></li><li class="listitem"><p>
              適切なファイルシステムのロック (通常は <code class="literal">lockd</code> ロックマネージャーによって処理されます) をサポートしていないシステムで同じデータディレクトリを使用して多数の <span class="command"><strong>mysqld</strong></span> サーバーを実行しているか、外部ロックを無効にして複数のサーバーを実行している。
            </p></li><li class="listitem"><p>
              大きく破損したデータが含まれているクラッシュしたデータファイルまたはインデックスファイルがあり、<span class="command"><strong>mysqld</strong></span> が混乱した。
            </p></li><li class="listitem"><p>
              データストレージのコードにバグが見つかった。 可能性は低いですがあり得ることです。 この場合は、修復されたテーブルのコピーに対して <code class="literal">ALTER TABLE</code> を使用することによって、別のエンジンへのストレージエンジンの変更を試みることができます。 
            </p></li></ul></div><p>
          何らかのクラッシュが発生している理由を知ることは非常に困難であるため、まず他のユーザーのために機能するものが予期しない終了になるかどうかを確認してみてください。 次のことを試してください。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <span class="command"><strong>mysqladmin shutdown</strong></span> を使用して <span class="command"><strong>mysqld</strong></span> サーバーを停止し、データディレクトリから <span class="command"><strong>myisamchk --silent --force */*.MYI</strong></span> を実行して、すべての <code class="literal">MyISAM</code> テーブルを確認し、<span class="command"><strong>mysqld</strong></span> を再起動します。 これにより、クリーンな状態から実行していることが保証されます。 <a class="xref" href="server-administration.html" title="第 5 章 MySQL サーバーの管理">第5章「<i>MySQL サーバーの管理</i>」</a> を参照してください。 
            </p></li><li class="listitem"><p>
              一般クエリーログを有効にして (<a class="xref" href="server-administration.html#query-log" title="5.4.3 一般クエリーログ">セクション5.4.3「一般クエリーログ」</a>を参照してください) <span class="command"><strong>mysqld</strong></span> を起動します。 ログに書き込まれた情報から、特定のクエリーによってサーバーが強制終了したかどうかを判別してください。 すべてのバグの 95% は特定のクエリーに関連しています。 通常、これは、サーバーが再起動される前のログファイルの最後のクエリーのいずれかです。 <a class="xref" href="server-administration.html#query-log" title="5.4.3 一般クエリーログ">セクション5.4.3「一般クエリーログ」</a>を参照してください。 クエリーを発行する前にすべてのテーブルを確認しても、特定のクエリーによって MySQL が繰り返し強制終了される場合は、バグとして判別されましたのでバグレポートを送信してください。 <a class="xref" href="introduction.html#bug-reports" title="1.6 質問またはバグをレポートする方法">セクション1.6「質問またはバグをレポートする方法」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              問題を再現するために使用できるテストケースを作成してください。 <a class="xref" href="server-administration.html#debugging-mysql" title="5.9 MySQL のデバッグ">セクション5.9「MySQL のデバッグ」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">fork_big.pl</code> スクリプトを試してください。 (ソース配布の <code class="filename">tests</code> ディレクトリにあります。) 
            </p></li><li class="listitem"><p>
              MySQL をデバッグ用に構成すると、何らかの問題がある場合に、考えられるエラーに関する情報を収集しやすくなります。 <code class="option">-DWITH_DEBUG=1</code> オプションを指定して MySQL を再構成し、<span class="command"><strong>CMake</strong></span> を実行して再コンパイルします。 <a class="xref" href="server-administration.html#debugging-mysql" title="5.9 MySQL のデバッグ">セクション5.9「MySQL のデバッグ」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              オペレーティングシステムに最新のパッチが適用されていることを確認してください。
            </p></li><li class="listitem"><p>
              <code class="option">--skip-external-locking</code> オプションを使用して <span class="command"><strong>mysqld</strong></span> を起動します。 一部のシステムでは <code class="literal">lockd</code> ロックマネージャーが正常に動作しません。<code class="option">--skip-external-locking</code> オプションは <span class="command"><strong>mysqld</strong></span> に外部ロックを使用しないように通知します。 (これは、同じデータディレクトリで 2 つの <span class="command"><strong>mysqld</strong></span> サーバーは実行できず、<span class="command"><strong>myisamchk</strong></span> を使用する場合は注意する必要があることを意味します。 それでも、テストとしてこのオプションを試すことには価値があります。) 
            </p></li><li class="listitem"><p>
              <span class="command"><strong>mysqld</strong></span> は実行されているが応答しない場合は、<span class="command"><strong>mysqladmin -u root processlist</strong></span> を試してください。 <span class="command"><strong>mysqld</strong></span> が応答しないように見えても、ハングアップしていないことがあります。 すべての接続が使用されているか、内部ロックの問題である可能性があります。<span class="command"><strong>mysqladmin -u root processlist</strong></span> は、通常、これらの場合でも接続を確立することができ、現在の接続数およびそのステータスに関する役に立つ情報が表示されます。 
            </p></li><li class="listitem"><p>
              ほかのクエリーを実行しているときに、別のウィンドウで <span class="command"><strong>mysqladmin -i 5 status</strong></span> コマンドまたは <span class="command"><strong>mysqladmin -i 5 -r status</strong></span> コマンドを実行して統計を生成します。
            </p></li><li class="listitem"><p>
              次の手順を試してください。
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                  <span class="command"><strong>gdb</strong></span> (または別のデバッガ) から <span class="command"><strong>mysqld</strong></span> を起動します。 <a class="xref" href="server-administration.html#debugging-mysql" title="5.9 MySQL のデバッグ">セクション5.9「MySQL のデバッグ」</a>を参照してください。 
                </p></li><li class="listitem"><p>
                  テストスクリプトを実行します。
                </p></li><li class="listitem"><p>
                  もっとも低い 3 つのレベルでバックトレースおよびローカル変数を出力します。 <span class="command"><strong>gdb</strong></span> でこれを行うには、<span class="command"><strong>mysqld</strong></span> が <span class="command"><strong>gdb</strong></span> 内でクラッシュしたときに、次のコマンドを使用します。 
                </p><pre class="programlisting">backtrace
info local
up
info local
up
info local
</pre><p>
                  <span class="command"><strong>gdb</strong></span> で、<code class="literal">info threads</code> を使用して存在するスレッドを検査し、<code class="literal">thread <em class="replaceable"><code>N</code></em></code> (ここで <em class="replaceable"><code>N</code></em> はスレッド ID です) を使用して特定のスレッドに切り替えることもできます。
                </p></li></ol></div></li><li class="listitem"><p>
              Perl スクリプトを使用してアプリケーションをシミュレートし、MySQL を強制的に終了または誤動作させてください。
            </p></li><li class="listitem"><p>
              通常のバグレポートを送信します。 <a class="xref" href="introduction.html#bug-reports" title="1.6 質問またはバグをレポートする方法">セクション1.6「質問またはバグをレポートする方法」</a>を参照してください。 通常より詳しく記述してください。 MySQL は多くのユーザーの環境では動作しているため、クラッシュは問題となっているコンピュータにのみ存在する何かによって発生している可能性があります (たとえば、特定のシステムライブラリに関連するエラー)。 
            </p></li><li class="listitem"><p>
              動的長の行を含むテーブルで問題があり、<code class="literal">VARCHAR</code> カラム (<code class="literal">BLOB</code> カラムまたは <code class="literal">TEXT</code> カラムではなく) のみを使用している場合は、<code class="literal">ALTER TABLE</code> を使用して、すべての <code class="literal">VARCHAR</code> を <code class="literal">CHAR</code> に変更してみてください。 これにより、MySQL が固定長の行を使用するようになります。 固定長の行では若干追加の領域が使用されますが、破損に対してより耐性があります。 
            </p><p>
              現在の動的行のコードは数年使用されており、問題はほとんど発生していませんが、動的長の行はその性質のためエラーが発生しやすい傾向があるので、この方法がうまくいくかどうかを試すのは良い考えである可能性があります。
            </p></li><li class="listitem"><p>
              問題を診断する場合は、ハードウェアの障害の可能性を考慮に入れてください。 欠陥のあるハードウェアは、データ破損の原因となることがあります。 ハードウェアをトラブルシューティングする場合は、メモリーおよびディスクのサブシステムに特に注意してください。 
            </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="full-disk"></a>B.3.3.4 MySQL が満杯のディスクを処理する方法</h4></div></div></div><a class="indexterm" name="idm45302161419248"></a><a class="indexterm" name="idm45302161417808"></a><p>
          このセクションでは、MySQL がディスク満杯エラー (<span class="quote">「<span class="quote">デバイスに領域が残っていない</span>」</span>など)、および割り当て超過エラー (<span class="quote">「<span class="quote">書き込みに失敗しました</span>」</span>、<span class="quote">「<span class="quote">ユーザーブロックの制限に達しました</span>」</span>など) に対処する方法について説明します。
        </p><p>
          このセクションは、<code class="literal">MyISAM</code> テーブルへの書き込みに関連しています。 <span class="quote">「<span class="quote">行</span>」</span>および<span class="quote">「<span class="quote">レコード</span>」</span>への言及が<span class="quote">「<span class="quote">イベント</span>」</span>を意味すると理解する必要があることを除き、バイナリログファイルおよびバイナリログインデックスファイルへの書き込みにも当てはまります。 
        </p><p>
          ディスク満杯状態が発生すると、MySQL は次のことを行います。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              現在の行を書き込むための十分な領域があるかどうかを 1 分おきに確認します。 十分な領域がある場合は、何事もなかったかのように稼働し続けます。 
            </p></li><li class="listitem"><p>
              ディスク満杯状態について警告するエントリをログファイルに 10 分おきに書き込みます。
            </p></li></ul></div><p>
          問題を軽減するには次のアクションを行います。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              続行する場合は、すべてのレコードを挿入するための十分なディスク領域を解放する必要があるだけです。
            </p></li><li class="listitem"><p>
              または、スレッドを中止するには <span class="command"><strong>mysqladmin kill</strong></span> を使用します。 スレッドは次回ディスクがチェックされるとき (1 分以内) に中止されます。 
            </p></li><li class="listitem"><p>
              ほかのスレッドが、ディスク満杯状態の原因となったテーブルを待機している可能性があります。 複数の<span class="quote">「<span class="quote">ロックされた</span>」</span>スレッドがある場合は、ディスク満杯状態を待機していた 1 つのスレッドを強制終了すると、ほかのスレッドが続行できるようになります。 
            </p></li></ul></div><p>
          前述の動作の例外は、<code class="literal">REPAIR TABLE</code> または <code class="literal">OPTIMIZE TABLE</code> を使用する場合、または <code class="literal">LOAD DATA</code> の後または <code class="literal">ALTER TABLE</code> ステートメントの後にインデックスがバッチで作成される場合です。 これらのすべてのステートメントでは大きい一時ファイルが作成されることがあり、それがそのまま残された場合、システムのほかの部分で大きな問題となる可能性があります。 MySQL がこれらのいずれかの操作を実行していて、ディスクが満杯になった場合は、大きい一時ファイルが削除され、テーブルがクラッシュとしてマークされます。 例外は <code class="literal">ALTER TABLE</code> の場合で、古いテーブルは変更されないままになります。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="temporary-files"></a>B.3.3.5 MySQL が一時ファイルを格納する場所</h4></div></div></div><a class="indexterm" name="idm45302161395072"></a><a class="indexterm" name="idm45302161393648"></a><a class="indexterm" name="idm45302161392272"></a><p>
          UNIX では、MySQL は一時ファイルを格納するディレクトリのパス名として、<code class="literal">TMPDIR</code> 環境変数の値を使用します。 <code class="literal">TMPDIR</code> が設定されていない場合、MySQL はシステムのデフォルトを使用します。通常、これは <code class="filename">/tmp</code>、<code class="filename">/var/tmp</code>、または <code class="filename">/usr/tmp</code> です。 
        </p><p>
          Windows では、MySQL は <code class="literal">TMPDIR</code>、<code class="literal">TEMP</code>、および <code class="literal">TMP</code> 環境変数の値を順番にチェックします。 MySQL は最初に見つかった設定されている変数を使用し、残りの変数はチェックしません。 <code class="literal">TMPDIR</code>、<code class="literal">TEMP</code>、および <code class="literal">TMP</code> がいずれも設定されていない場合、MySQL は Windows システムのデフォルトを使用します。通常、これは <code class="filename">C:\windows\temp\</code> です。 
        </p><p>
          一時ファイルディレクトリを含むファイルシステムが小さすぎる場合は、<span class="command"><strong>mysqld</strong></span> <code class="option">--tmpdir</code> オプションを使用して、十分な領域があるファイルシステム内のディレクトリを指定できます。
        </p><p>
          <code class="option">--tmpdir</code> オプションには、ラウンドロビン方式で使用される複数のパスのリストを設定できます。 パスは、Unix ではコロン文字 (<code class="literal">:</code>) で区切り、Windows ではセミコロン文字 (<code class="literal">;</code>) で区切る必要があります。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            負荷を効果的に分散するには、これらのパスに同じディスクの個別のパーティションではなく、個別の<span class="emphasis"><em>物理</em></span>ディスクを指定してください。
          </p></div><p>
          MySQL サーバーがレプリカとして機能している場合は、<code class="literal">slave_load_tmpdir</code> システム変数を設定して、<code class="literal">LOAD DATA</code> ステートメントのレプリケート時に一時ファイルを保持するための個別のディレクトリを指定できます。 LOAD DATA の複製に使用される一時ファイルがマシンの再起動後も存続できるように、このディレクトリは (メモリーベースのファイルシステムではなく) ディスクベースのファイルシステム内にある必要があります。 このディレクトリは、システム起動プロセス中にオペレーティングシステムによってクリアされるものではいけません。 ただし、一時ファイルが削除されている場合は、再起動後にレプリケーションを続行できるようになりました。 
        </p><p>
          MySQL は、<span class="command"><strong>mysqld</strong></span> が終了したら一時ファイルが削除されるようにしています。 これがサポートされるプラットフォームでは (UNIX など)、ファイルをオープンしたあとにリンク解除することによってこれが行われます。 この方法のデメリットは、名前がディレクトリのリストに表示されないことであり、一時ファイルディレクトリがあるファイルシステムを満杯にしている大きい一時ファイルが表示されません。 (そのような場合は、<span class="command"><strong>mysqld</strong></span> に関連付けられている大きいファイルを識別するために、<span class="command"><strong>lsof +L1</strong></span> が役に立つことがあります。) 
        </p><p>
          通常、MySQL はソート (<code class="literal">ORDER BY</code> または <code class="literal">GROUP BY</code>) を行うときに、1 つまたは 2 つの一時ファイルを使用します。 必要となる最大のディスク領域は次の式によって判別されます。 
        </p><pre class="programlisting">(length of what is sorted + sizeof(row pointer))
* number of matched rows
* 2
</pre><p>
          行ポインタのサイズは通常 4 バイトですが、大きいテーブルの場合は将来拡張される可能性があります。
        </p><p>
          一部のステートメントでは、MySQL によって、非表示ではなく、<code class="filename">#sql</code> で始まる名前を持つ一時 SQL テーブルが作成されます。
        </p><p>
          一部の <code class="literal">SELECT</code> クエリーでは、中間結果を保持するための一時 SQL テーブルが作成されます。
        </p><p>
          テーブルを再構築し、<code class="literal">ALGORITHM=INPLACE</code> 技術を使用してオンラインで実行されない DDL 操作では、元のテーブルと同じディレクトリに元のテーブルの一時コピーが作成されます。
        </p><p>
          オンライン DDL 操作では、同時 DML の記録に一時ログファイル、インデックスの作成時に一時ソートファイル、テーブルの再構築時に一時中間テーブルファイルを使用できます。 詳細は、<a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-space-requirements" title="15.12.3 オンライン DDL 領域の要件">セクション15.12.3「オンライン DDL 領域の要件」</a>を参照してください。 
        </p><p>
          <code class="literal">InnoDB</code> のユーザー作成一時テーブルおよびディスク上の内部一時テーブルは、MySQL データディレクトリの <code class="filename">ibtmp1</code> という名前の一時テーブルスペースファイルに作成されます。 詳細は、<a class="xref" href="innodb-storage-engine.html#innodb-temporary-tablespace" title="15.6.3.5 一時テーブルスペース">セクション15.6.3.5「一時テーブルスペース」</a>を参照してください。 
        </p><p>
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-temp-table-info" title="15.15.7 InnoDB INFORMATION_SCHEMA 一時テーブル情報テーブル">セクション15.15.7「InnoDB INFORMATION_SCHEMA 一時テーブル情報テーブル」</a>も参照してください。
        </p><p>
          オプションの <code class="literal">EXTENDED</code> 修飾子を使用すると、失敗した <code class="literal">ALTER TABLE</code> ステートメントによって作成された非表示のテーブルが <code class="literal">SHOW TABLES</code> にリストされます。 <a class="xref" href="sql-statements.html#show-tables" title="13.7.7.39 SHOW TABLES ステートメント">セクション13.7.7.39「SHOW TABLES ステートメント」</a>を参照してください。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="problems-with-mysql-sock"></a>B.3.3.6 MySQL の UNIX ソケットファイルを保護または変更する方法</h4></div></div></div><a class="indexterm" name="idm45302161345264"></a><a class="indexterm" name="idm45302161343152"></a><p>
          サーバーがローカルクライアントと通信するために使用する UNIX ソケットファイルのデフォルトの場所は、<code class="filename">/tmp/mysql.sock</code> です。 (一部の配布形式ではディレクトリが異なる場合があり、たとえば RPM の場合は <code class="filename">/var/lib/mysql</code> です。) 
        </p><p>
          UNIX の一部のバージョンでは、<code class="filename">/tmp</code> ディレクトリ内のファイル、または一時ファイルに使用されるほかの同様のディレクトリ内のファイルをだれでも削除できます。 ソケットファイルがシステム上のそのようなディレクトリに配置されている場合は、問題となることがあります。 
        </p><p>
          ほとんどのバージョンの UNIX では、<code class="filename">/tmp</code> ディレクトリを保護して、所有者またはスーパーユーザー (<code class="literal">root</code>) のみがファイルを削除できるようにすることができます。 これを行うには、<code class="literal">root</code> としてログインして次のコマンドを使用することによって、<code class="filename">/tmp</code> ディレクトリに<code class="literal">スティッキー</code>ビットを設定します。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>chmod +t /tmp</code></strong>
</pre><p>
          <code class="literal">スティッキー</code>ビットが設定されたかどうかを確認するには、<code class="literal">ls -ld /tmp</code> を実行します。 いちばん最後の権限文字が <code class="literal">t</code> である場合は、このビットが設定されています。 
        </p><a class="indexterm" name="idm45302161327888"></a><p>
          別の方法は、サーバーが UNIX ソケットファイルを作成する場所を変更することです。 これを行う場合は、クライアントプログラムにもファイルの新しい場所を認識させてください。 ファイルの場所を指定する方法はいくつかあります。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              グローバルまたはローカルのオプションファイルにパスを指定します。 たとえば、次の行を <code class="literal">/etc/my.cnf</code> に指定します。 
            </p><pre class="programlisting">[mysqld]
socket=/path/to/socket

[client]
socket=/path/to/socket
</pre><p>
              <a class="xref" href="programs.html#option-files" title="4.2.2.2 オプションファイルの使用">セクション4.2.2.2「オプションファイルの使用」</a>を参照してください。
            </p></li><li class="listitem"><p>
              <span class="command"><strong>mysqld_safe</strong></span> およびクライアントプログラムを実行するときに、<code class="option">--socket</code> オプションをコマンド行に指定します。
            </p></li><li class="listitem"><p>
              <code class="literal">MYSQL_UNIX_PORT</code> 環境変数に UNIX ソケットファイルのパスを設定します。
            </p></li><li class="listitem"><p>
              別のデフォルトの UNIX ソケットファイルの場所を使用するように、ソースから MySQL を再コンパイルします。 <span class="command"><strong>CMake</strong></span> を実行するときに <code class="option">MYSQL_UNIX_ADDR</code> オプションでファイルへのパスを定義します。 <a class="xref" href="installing.html#source-configuration-options" title="2.9.7 MySQL ソース構成オプション">セクション2.9.7「MySQL ソース構成オプション」</a>を参照してください。 
            </p></li></ul></div><p>
          新しいソケットの場所が動作しているかどうかをテストするには、次のコマンドを使用してサーバーに接続します。
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin --socket=/path/to/socket version</code></strong>
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="timezone-problems"></a>B.3.3.7 タイムゾーンの問題</h4></div></div></div><a class="indexterm" name="idm45302161309376"></a><a class="indexterm" name="idm45302161307920"></a><a class="indexterm" name="idm45302161305888"></a><a class="indexterm" name="idm45302161304512"></a><p>
          <code class="literal">SELECT NOW()</code> でローカルの時間ではなく UTC で値が返される問題がある場合は、サーバーに現在のタイムゾーンを通知する必要があります。 <code class="literal">UNIX_TIMESTAMP()</code> が間違った値を返す場合も同様です。 これは、サーバーが実行されている環境 (<span class="command"><strong>mysqld_safe</strong></span> や <span class="command"><strong>mysql.server</strong></span> など) で実行する必要があります。 <a class="xref" href="programs.html#environment-variables" title="4.9 環境変数">セクション4.9「環境変数」</a>を参照してください。 
        </p><p>
          サーバーのタイムゾーンを設定するには、<span class="command"><strong>mysqld_safe</strong></span> に <code class="option">--timezone=<em class="replaceable"><code>timezone_name</code></em></code> オプションを指定します。 <span class="command"><strong>mysqld</strong></span> を起動する前に、<code class="literal">TZ</code> 環境変数を設定することによって設定することもできます。 
        </p><p>
          <code class="option">--timezone</code> または <code class="literal">TZ</code> に許可される値は、システムによって異なります。 許容可能な値を確認するには、オペレーティングシステムのドキュメントを参照してください。 
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="query-issues"></a>B.3.4 クエリー関連の問題</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="error-handling.html#case-sensitivity">B.3.4.1 文字列検索での大文字/小文字の区別</a></span></dt><dt><span class="section"><a href="error-handling.html#using-date">B.3.4.2 DATE カラムの使用に関する問題</a></span></dt><dt><span class="section"><a href="error-handling.html#problems-with-null">B.3.4.3 NULL 値に関する問題</a></span></dt><dt><span class="section"><a href="error-handling.html#problems-with-alias">B.3.4.4 カラムエイリアスに関する問題</a></span></dt><dt><span class="section"><a href="error-handling.html#nontransactional-tables">B.3.4.5 非トランザクションテーブルのロールバックの失敗</a></span></dt><dt><span class="section"><a href="error-handling.html#deleting-from-related-tables">B.3.4.6 関連するテーブルからの行の削除</a></span></dt><dt><span class="section"><a href="error-handling.html#no-matching-rows">B.3.4.7 一致する行がない場合の問題の解決</a></span></dt><dt><span class="section"><a href="error-handling.html#problems-with-float">B.3.4.8 浮動小数点値に関する問題</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="case-sensitivity"></a>B.3.4.1 文字列検索での大文字/小文字の区別</h4></div></div></div><a class="indexterm" name="idm45302161289120"></a><a class="indexterm" name="idm45302161286976"></a><p>
          非バイナリ文字列の場合 (<code class="literal">CHAR</code>、<code class="literal">VARCHAR</code>、<code class="literal">TEXT</code>)、文字列検索では比較オペランドの照合順序が使用されます。 バイナリ文字列 (<code class="literal">BINARY</code>, <code class="literal">VARBINARY</code>, <code class="literal">BLOB</code>) の場合、比較ではオペランド内のバイトの数値が使用されます。つまり、アルファベット文字の場合、比較では大文字と小文字が区別されます。 
        </p><p>
          非バイナリ文字列とバイナリ文字列の比較は、バイナリ文字列の比較として扱われます。
        </p><p>
          単純な比較操作 (<code class="literal">&gt;=、&gt;、=、&lt;、&lt;=</code>、ソート、およびグループ化) は、各文字の<span class="quote">「<span class="quote">ソート値</span>」</span>に基づきます。 同じソート値を持つ文字は同じ文字として扱われます。 たとえば、特定の照合で <code class="literal">e</code> と<code class="literal">é</code>のソート値が同じである場合、それらは等しいと比較されます。 
        </p><p>
          デフォルトの文字セットおよび照合順序は <code class="literal">utf8mb4</code> および <code class="literal">utf8mb4_0900_ai_ci</code> であるため、非バイナリ文字列比較ではデフォルトで大文字と小文字が区別されません。 これは、<code class="literal"><em class="replaceable"><code>col_name</code></em> LIKE 'a%'</code> を使用して検索した場合、<code class="literal">A</code> または <code class="literal">a</code> で始まるすべてのカラム値が取得されることを意味します。 この検索で大文字と小文字を区別するには、オペランドのいずれかに大文字と小文字を区別する照合順序またはバイナリ照合順序があることを確認します。 たとえば、両方とも <code class="literal">utf8mb4</code> 文字セットを持つカラムと文字列を比較する場合は、<code class="literal">COLLATE</code> 演算子を使用して、いずれかのオペランドに <code class="literal">utf8mb4_0900_as_cs</code> 照合順序または <code class="literal">utf8mb4_bin</code> 照合順序を設定できます: 
        </p><pre class="programlisting"><em class="replaceable"><code>col_name</code></em> COLLATE utf8mb4_0900_as_cs LIKE 'a%'
<em class="replaceable"><code>col_name</code></em> LIKE 'a%' COLLATE utf8mb4_0900_as_cs
<em class="replaceable"><code>col_name</code></em> COLLATE utf8mb4_bin LIKE 'a%'
<em class="replaceable"><code>col_name</code></em> LIKE 'a%' COLLATE utf8mb4_bin
</pre><p>
          カラムを常に大文字と小文字を区別して処理する場合は、大文字と小文字を区別する照合順序またはバイナリ照合順序で宣言します。 <a class="xref" href="sql-statements.html#create-table" title="13.1.20 CREATE TABLE ステートメント">セクション13.1.20「CREATE TABLE ステートメント」</a>を参照してください。 
        </p><p>
          非バイナリ文字列の大/小文字を区別する比較で大/小文字を区別しないようにするには、<code class="literal">COLLATE</code> を使用して大/小文字を区別しない照合に名前を付けます。 次の例の文字列では、通常、大/小文字が区別されますが、<code class="literal">COLLATE</code> は比較を大/小文字を区別しないように変更します: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET NAMES 'utf8mb4';</code></strong>
mysql&gt; <strong class="userinput"><code>SET @s1 = 'MySQL' COLLATE utf8mb4_bin,</code></strong>
           <strong class="userinput"><code>@s2 = 'mysql' COLLATE utf8mb4_bin;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT @s1 = @s2;</code></strong>
+-----------+
| @s1 = @s2 |
+-----------+
|         0 |
+-----------+
mysql&gt; <strong class="userinput"><code>SELECT @s1 COLLATE utf8mb4_0900_ai_ci = @s2;</code></strong>
+--------------------------------------+
| @s1 COLLATE utf8mb4_0900_ai_ci = @s2 |
+--------------------------------------+
|                                    1 |
+--------------------------------------+
</pre><p>
          バイナリ文字列では、比較で大/小文字が区別されます。 文字列を大/小文字を区別しないものとして比較するには、文字列を非バイナリ文字列に変換し、<code class="literal">COLLATE</code> を使用して大/小文字を区別しない照合に名前を付けます: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET @s = BINARY 'MySQL';</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT @s = 'mysql';</code></strong>
+--------------+
| @s = 'mysql' |
+--------------+
|            0 |
+--------------+
mysql&gt; <strong class="userinput"><code>SELECT CONVERT(@s USING utf8mb4) COLLATE utf8mb4_0900_ai_ci = 'mysql';</code></strong>
+----------------------------------------------------------------+
| CONVERT(@s USING utf8mb4) COLLATE utf8mb4_0900_ai_ci = 'mysql' |
+----------------------------------------------------------------+
|                                                              1 |
+----------------------------------------------------------------+
</pre><p>
          値を非バイナリ文字列とバイナリ文字列のどちらとして比較するかを決定するには、<code class="literal">COLLATION()</code> 関数を使用します。 この例では、<code class="literal">VERSION()</code> が大文字と小文字を区別しない照合順序を持つ文字列を返すため、比較では大文字と小文字が区別されません: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT COLLATION(VERSION());</code></strong>
+----------------------+
| COLLATION(VERSION()) |
+----------------------+
| utf8_general_ci      |
+----------------------+
</pre><p>
          バイナリ文字列の場合、照合値は <code class="literal">binary</code> であるため、比較では大文字と小文字が区別されます。 <code class="literal">binary</code> が予想されるコンテキストの 1 つは、一般的なルールとしてバイナリ文字列を返す圧縮関数です: string: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT COLLATION(COMPRESS('x'));</code></strong>
+--------------------------+
| COLLATION(COMPRESS('x')) |
+--------------------------+
| binary                   |
+--------------------------+
</pre><p>
          文字列のソート値を確認する場合は、<code class="literal">WEIGHT_STRING()</code> が役に立つことがあります。 <a class="xref" href="functions.html#string-functions" title="12.8 文字列関数および演算子">セクション12.8「文字列関数および演算子」</a>を参照してください。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="using-date"></a>B.3.4.2 DATE カラムの使用に関する問題</h4></div></div></div><a class="indexterm" name="idm45302161236048"></a><a class="indexterm" name="idm45302161234736"></a><a class="indexterm" name="idm45302161232576"></a><p>
          <code class="literal">DATE</code> 値の形式は<code class="literal">'<em class="replaceable"><code>YYYY-MM-DD</code></em>'</code>です。 標準 SQL に従うと、ほかの形式は許可されません。 <code class="literal">UPDATE</code> の式および <code class="literal">SELECT</code> ステートメントの <code class="literal">WHERE</code> 句では、この形式を使用してください。 例: 
        </p><pre class="programlisting">SELECT * FROM t1 WHERE date &gt;= '2003-05-05';
</pre><p>
          便宜上、日付が数値コンテキストで使用されている場合、MySQL は自動的に日付を数値に変換します。逆の場合も同様です。 また、MySQL は、更新時、および日付を <code class="literal">DATE</code>、<code class="literal">DATETIME</code>、または <code class="literal">TIMESTAMP</code> カラムと比較する <code class="literal">WHERE</code> 句で、<span class="quote">「<span class="quote">緩やかな</span>」</span>文字列形式を許可します。 <span class="quote">「<span class="quote">緩やかな</span>」</span>形式とは、各部分の区切り文字として句読点文字を使用できることを意味します。 たとえば、<code class="literal">'2004-08-15'</code> と <code class="literal">'2004#08#15'</code> は同等です。 MySQL は、日付として解釈できる場合、区切り文字が含まれていない文字列 (<code class="literal">'20040815'</code> など) も変換できます。 
        </p><p>
          <code class="literal">&lt;</code>、<code class="literal">&lt;=</code>、<code class="literal">=</code>、<code class="literal">&gt;=</code>、<code class="literal">&gt;</code>、または <code class="literal">BETWEEN</code> 演算子を使用して、<code class="literal">DATE</code>、<code class="literal">TIME</code>、<code class="literal">DATETIME</code>、または <code class="literal">TIMESTAMP</code> を定数文字列と比較する場合、通常、MySQL はより速く比較するために (および<span class="quote">「<span class="quote">緩やかな</span>」</span>文字列チェックのため) 文字列を内部長整数に変換します。 ただし、この変換には次の例外があります。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              2 つのカラムを比較する場合
            </p></li><li class="listitem"><p>
              <code class="literal">DATE</code>、<code class="literal">TIME</code>、<code class="literal">DATETIME</code>、または <code class="literal">TIMESTAMP</code> カラムと式を比較する場合
            </p></li><li class="listitem"><p>
              上記で一覧表示した比較方法以外の比較方法を使用する場合 (<code class="literal">IN</code>、<code class="literal">STRCMP()</code> など)。
            </p></li></ul></div><p>
          これらの例外の場合、比較はオブジェクトを文字列に変換して文字列比較を実行することによって行われます。
        </p><p>
          安全に処理を行うには、時間値と文字列を比較する場合、文字列が文字列として比較されると想定し、適切な文字列関数を使用します。
        </p><p>
          特殊な<span class="quote">「<span class="quote">ゼロ</span>」</span>日付 <code class="literal">'0000-00-00'</code> は、<code class="literal">'0000-00-00'.</code> として格納および取得できます。<code class="literal">'0000-00-00'</code> 日付が Connector/ODBC を介して使用される場合、ODBC はそのような日付を処理できないため、<code class="literal">NULL</code> に自動的に変換されます。
        </p><p>
          MySQL が前述の変換を実行するため、次のステートメントは動作します (<code class="literal">idate</code> が <code class="literal">DATE</code> カラムであると想定しています)。
        </p><pre class="programlisting">INSERT INTO t1 (idate) VALUES (19970505);
INSERT INTO t1 (idate) VALUES ('19970505');
INSERT INTO t1 (idate) VALUES ('97-05-05');
INSERT INTO t1 (idate) VALUES ('1997.05.05');
INSERT INTO t1 (idate) VALUES ('1997 05 05');
INSERT INTO t1 (idate) VALUES ('0000-00-00');

SELECT idate FROM t1 WHERE idate &gt;= '1997-05-05';
SELECT idate FROM t1 WHERE idate &gt;= 19970505;
SELECT MOD(idate,100) FROM t1 WHERE idate &gt;= 19970505;
SELECT idate FROM t1 WHERE idate &gt;= '19970505';
</pre><p>
          ただし、次のステートメントは動作しません。
        </p><pre class="programlisting">SELECT idate FROM t1 WHERE STRCMP(idate,'20030505')=0;
</pre><p>
          <code class="literal">STRCMP()</code> は文字列関数であるため、<code class="literal">idate</code> を<code class="literal">'<em class="replaceable"><code>YYYY-MM-DD</code></em>'</code>形式の文字列に変換し、文字列比較を実行します。 <code class="literal">'20030505'</code> は日付 <code class="literal">'2003-05-05'</code> に変換されずに、日付比較が実行されます。 
        </p><p>
          <code class="literal">ALLOW_INVALID_DATES</code> SQL モードを有効にしている場合、MySQL は限定的なチェックのみが行われた日付を格納することを許可します。MySQL は、日が 1 から 31 までの範囲内にあり、月が 1 から 12 までの範囲内にあることのみを要求します。 これにより、Web アプリケーションで年、月、および日を 3 つの別個のフィールドで取得して、ユーザーが入力したとおりに格納する (日付検証なしで) 場合に、MySQL が非常に便利になります。 
        </p><p>
          MySQL は、日または月と日がゼロである日付の格納を許可します。 これは、生年月日を <code class="literal">DATE</code> カラムに格納するが、その日付の一部のみがわかっている場合に便利です。 日付にゼロの月または日の部分を許可しないようにするには、<code class="literal">NO_ZERO_IN_DATE</code> モードを有効にします。 
        </p><p>
          MySQL では、<span class="quote">「<span class="quote">ダミーの日付</span>」</span>として <code class="literal">'0000-00-00'</code> の<span class="quote">「<span class="quote">ゼロ</span>」</span>の値を格納できます。 これは、<code class="literal">NULL</code> 値を使用するよりも便利な場合があります。 <code class="literal">DATE</code> カラムに格納される日付を妥当な値に変換できない場合、MySQL は <code class="literal">'0000-00-00'</code> を格納します。 <code class="literal">'0000-00-00'</code>を禁止するには、<code class="literal">NO_ZERO_DATE</code> モードを有効にします。 
        </p><p>
          MySQL がすべての日付をチェックして、有効な日付のみを受け入れるようにするには (<code class="literal">IGNORE</code> によってオーバーライドされないかぎり)、<code class="literal">sql_mode</code> システム変数に <code class="literal">"NO_ZERO_IN_DATE,NO_ZERO_DATE"</code> を設定します。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="problems-with-null"></a>B.3.4.3 NULL 値に関する問題</h4></div></div></div><a class="indexterm" name="idm45302161165664"></a><a class="indexterm" name="idm45302161163552"></a><p>
          <code class="literal">NULL</code> 値の概念については、<code class="literal">NULL</code> が空の文字列 <code class="literal">''</code> と同じであると考えがちな SQL の初心者が混乱することがよくあります。 これらは同一ではありません。 たとえば、次の 2 つのステートメントは完全に異なります。 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>INSERT INTO my_table (phone) VALUES (NULL);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO my_table (phone) VALUES ('');</code></strong>
</pre><p>
          両方のステートメントで <code class="literal">phone</code> カラムに値が挿入されていますが、最初のステートメントは <code class="literal">NULL</code> 値を挿入しており、2 番目のステートメントは空の文字列を挿入しています。 最初のステートメントの意味は<span class="quote">「<span class="quote">電話番号がわからない</span>」</span>、2 番目のステートメントの意味は<span class="quote">「<span class="quote">この人は電話を持っていないため、電話番号がない</span>」</span>と見なすことができます。 
        </p><p>
          <code class="literal">NULL</code> を処理する場合は、<code class="literal">IS NULL</code> 演算子と <code class="literal">IS NOT NULL</code> 演算子、および <code class="literal">IFNULL()</code> 関数を使用できます。
        </p><p>
          SQL では、<code class="literal">NULL</code> 値はほかの値 (<code class="literal">NULL</code> を含む) との比較で true になることはありません。 <code class="literal">NULL</code> を含む式は、式に関連する演算子および関数のドキュメントに示されている場合を除き、常に <code class="literal">NULL</code> 値を生成します。 次の例のすべてのカラムは <code class="literal">NULL</code> を返します。 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT NULL, 1+NULL, CONCAT('Invisible',NULL);</code></strong>
</pre><p>
          <code class="literal">NULL</code> であるカラム値を検索する場合、<code class="literal">expr = NULL</code> テストは使用できません。 <code class="literal">expr = NULL</code> はどのような式の場合でも true にならないため、次のステートメントは行を返しません。 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM my_table WHERE phone = NULL;</code></strong>
</pre><p>
          <code class="literal">NULL</code> 値を検索するには、<code class="literal">IS NULL</code> テストを使用する必要があります。 次のステートメントは、<code class="literal">NULL</code> の電話番号および空の電話番号を検索する方法を示しています。 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM my_table WHERE phone IS NULL;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM my_table WHERE phone = '';</code></strong>
</pre><p>
          追加情報および例については、<a class="xref" href="tutorial.html#working-with-null" title="3.3.4.6 NULL 値の操作">セクション3.3.4.6「NULL 値の操作」</a>を参照してください。
        </p><p>
          <code class="literal">MyISAM</code>、<code class="literal">InnoDB</code>、または <code class="literal">MEMORY</code> ストレージエンジンを使用している場合は、<code class="literal">NULL</code> 値を持つことができるカラムにインデックスを追加できます。 それ以外の場合は、インデックスが付けられるカラムを <code class="literal">NOT NULL</code> と宣言する必要があり、そのカラムには <code class="literal">NULL</code> を挿入できません。 
        </p><a class="indexterm" name="idm45302161126448"></a><p>
          <code class="literal">LOAD DATA</code> でデータを読み取ると、空または欠落しているカラムが<code class="literal">''</code>で更新されます。 <code class="literal">NULL</code> 値をカラムにロードするには、データファイルで <code class="literal">\N</code> を使用します。 状況によっては、リテラル文字 <code class="literal">NULL</code> も使用できます。 <a class="xref" href="sql-statements.html#load-data" title="13.2.7 LOAD DATA ステートメント">セクション13.2.7「LOAD DATA ステートメント」</a>を参照してください。 
        </p><p>
          <code class="literal">DISTINCT</code>、<code class="literal">GROUP BY</code>、または <code class="literal">ORDER BY</code> が使用された場合、すべての <code class="literal">NULL</code> 値は等しいと見なされます。
        </p><p>
          <code class="literal">ORDER BY</code> を使用した場合、<code class="literal">NULL</code> 値は最初 (<code class="literal">DESC</code> を指定してソートを降順にした場合は最後) に表示されます。
        </p><p>
          <code class="literal">COUNT()</code>、<code class="literal">MIN()</code>、<code class="literal">SUM()</code> などの集計 (グループ) 関数では、<code class="literal">NULL</code> 値は無視されます。 例外は個別のカラム値ではなく行数をカウントする <code class="literal">COUNT(*)</code> です。 たとえば、次のステートメントは 2 つのカウントを生成します。 最初のカウントはテーブル内の行数のカウントであり、2 番目のカウントは <code class="literal">age</code> カラムの <code class="literal">NULL</code> 以外の値の数のカウントです。 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT COUNT(*), COUNT(age) FROM person;</code></strong>
</pre><a class="indexterm" name="idm45302161104720"></a><a class="indexterm" name="idm45302161102576"></a><a class="indexterm" name="idm45302161100544"></a><a class="indexterm" name="idm45302161098480"></a><p>
          一部のデータ型では、MySQL は <code class="literal">NULL</code> 値に対して特殊な処理を行います。 <code class="literal">NULL</code> を <code class="literal">TIMESTAMP</code> カラムに挿入すると、現在の日付と時間が挿入されます。 <code class="literal">NULL</code> を <code class="literal">AUTO_INCREMENT</code> 属性を持つ整数カラムまたは浮動小数点カラムに挿入すると、シーケンスの次の数値が挿入されます。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="problems-with-alias"></a>B.3.4.4 カラムエイリアスに関する問題</h4></div></div></div><a class="indexterm" name="idm45302161090352"></a><a class="indexterm" name="idm45302161088208"></a><a class="indexterm" name="idm45302161086144"></a><p>
          エイリアスをクエリーの選択リストに使用すると、カラムを別の名前にすることができます。 <code class="literal">GROUP BY</code>、<code class="literal">ORDER BY</code>、または <code class="literal">HAVING</code> 句でエイリアスを使用して、カラムを参照できます。 
        </p><pre class="programlisting">SELECT SQRT(a*b) AS root FROM <em class="replaceable"><code>tbl_name</code></em>
  GROUP BY root HAVING root &gt; 0;
SELECT id, COUNT(*) AS cnt FROM <em class="replaceable"><code>tbl_name</code></em>
  GROUP BY id HAVING cnt &gt; 0;
SELECT id AS 'Customer identity' FROM <em class="replaceable"><code>tbl_name</code></em>;
</pre><p>
          標準 SQL では、<code class="literal">WHERE</code> 句でのカラムエイリアスへの参照は許可されません。 <code class="literal">WHERE</code> 句が評価されるときに、カラム値がまだ判別されていない場合があるため、この制限が課されています。 たとえば、次のクエリーは不正です。 
        </p><pre class="programlisting">SELECT id, COUNT(*) AS cnt FROM <em class="replaceable"><code>tbl_name</code></em>
  WHERE cnt &gt; 0 GROUP BY id;
</pre><p>
          <code class="literal">WHERE</code> 句は <code class="literal">GROUP BY</code> 句に含められる行を判別しますが、行が選択されるまでわからないカラム値のエイリアスを参照して <code class="literal">GROUP BY</code> によってグループ化しています。
        </p><p>
          クエリーの選択リストで、引用したカラムエイリアスを指定するには、識別子または文字列引用文字を使用します。
        </p><pre class="programlisting">SELECT 1 AS `one`, 2 AS 'two';
</pre><p>
          ステートメント内のどこに指定する場合でも、エイリアスへの引用した参照には、識別子引用符を使用する必要があります。そうしないと、参照は文字列リテラルとして扱われます。 たとえば、次のステートメントはカラム <code class="literal">id</code> の値によってグループ化され、エイリアス <code class="literal">`a`</code> を使用して参照されます。 
        </p><pre class="programlisting">SELECT id AS 'a', COUNT(*) AS cnt FROM <em class="replaceable"><code>tbl_name</code></em>
  GROUP BY `a`;
</pre><p>
          このステートメントはリテラル文字列<code class="literal">'a'</code>でグループ化され、次のようには機能しません:
        </p><pre class="programlisting">SELECT id AS 'a', COUNT(*) AS cnt FROM <em class="replaceable"><code>tbl_name</code></em>
  GROUP BY 'a';
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="nontransactional-tables"></a>B.3.4.5 非トランザクションテーブルのロールバックの失敗</h4></div></div></div><a class="indexterm" name="idm45302161062064"></a><p>
          <code class="literal">ROLLBACK</code> を実行しようとしたときに次のメッセージを受け取った場合は、トランザクションで使用された 1 つ以上のテーブルがトランザクションをサポートしていないことを意味します。
        </p><pre class="programlisting">Warning: Some non-transactional changed tables couldn't be rolled back
</pre><p>
          これらの非トランザクションテーブルは、<code class="literal">ROLLBACK</code> ステートメントの影響を受けません。
        </p><p>
          トランザクション内でトランザクションテーブルと非トランザクションテーブルを意図的に混在させていない場合、このメッセージの原因は、トランザクションテーブルと考えていたテーブルが実際にはそうではなかったことである可能性があります。 これは、<span class="command"><strong>mysqld</strong></span> サーバーによってサポートされていない (または起動オプションで無効にされた) トランザクションストレージエンジンを使用してテーブルを作成しようとした場合に発生することがあります。 <span class="command"><strong>mysqld</strong></span> がストレージエンジンをサポートしない場合は、非トランザクションである <code class="literal">MyISAM</code> テーブルとしてテーブルが作成されます。 
        </p><p>
          テーブルのストレージエンジンを確認するには、次のいずれかのステートメントを使用します。
        </p><pre class="programlisting">SHOW TABLE STATUS LIKE '<em class="replaceable"><code>tbl_name</code></em>';
SHOW CREATE TABLE <em class="replaceable"><code>tbl_name</code></em>;
</pre><p>
          <a class="xref" href="sql-statements.html#show-table-status" title="13.7.7.38 SHOW TABLE STATUS ステートメント">セクション13.7.7.38「SHOW TABLE STATUS ステートメント」</a>および<a class="xref" href="sql-statements.html#show-create-table" title="13.7.7.10 SHOW CREATE TABLE ステートメント">セクション13.7.7.10「SHOW CREATE TABLE ステートメント」</a>を参照してください。
        </p><p>
          <span class="command"><strong>mysqld</strong></span> サーバーによってサポートされるストレージエンジンを確認するには、次のステートメントを使用します。
        </p><pre class="programlisting">SHOW ENGINES;
</pre><p>
          詳細は、<a class="xref" href="sql-statements.html#show-engines" title="13.7.7.16 SHOW ENGINES ステートメント">セクション13.7.7.16「SHOW ENGINES ステートメント」</a>を参照してください。
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="deleting-from-related-tables"></a>B.3.4.6 関連するテーブルからの行の削除</h4></div></div></div><a class="indexterm" name="idm45302161042512"></a><a class="indexterm" name="idm45302161040400"></a><a class="indexterm" name="idm45302161038368"></a><p>
          <code class="literal">related_table</code> の <code class="literal">DELETE</code> ステートメントの合計長が <code class="literal">max_allowed_packet</code> システム変数のデフォルト値より大きい場合は、小さい部分に分割して、複数の <code class="literal">DELETE</code> ステートメントを実行する必要があります。 <code class="literal">related_column</code> にインデックスが付けられている場合は、ステートメントごとに 100 から 1,000 の <code class="literal">related_column</code> 値のみを指定することによって、<code class="literal">DELETE</code> が最速になる可能性があります。 <code class="literal">related_column</code> にインデックスが付けられていない場合、速度は <code class="literal">IN</code> 句の引数の数の影響を受けません。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="no-matching-rows"></a>B.3.4.7 一致する行がない場合の問題の解決</h4></div></div></div><a class="indexterm" name="idm45302161026352"></a><a class="indexterm" name="idm45302161024896"></a><p>
          多数のテーブルを使用する複雑なクエリーで行が返されない場合は、次の手順を使用して問題を判別してください。
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              <code class="literal">EXPLAIN</code> を指定してクエリーをテストし、明らかな間違いが見つかるかどうかを確認します。 <a class="xref" href="sql-statements.html#explain" title="13.8.2 EXPLAIN ステートメント">セクション13.8.2「EXPLAIN ステートメント」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">WHERE</code> 句で使用されているカラムのみを選択します。
            </p></li><li class="listitem"><p>
              行が返されるまで、クエリーから一度に 1 つずつテーブルを削除します。 テーブルが大きい場合、クエリーに <code class="literal">LIMIT 10</code>を使用するのは良い方法です。 
            </p></li><li class="listitem"><p>
              クエリーから最後に削除したテーブルに対して一致する行を持つカラムに <code class="literal">SELECT</code> を発行します。
            </p></li><li class="listitem"><p>
              <code class="literal">FLOAT</code> カラムまたは <code class="literal">DOUBLE</code> カラムと 10 進数の数値を比較している場合、等式 (<code class="literal">=</code>) 比較は使用できません。 すべての浮動小数点値が正確な精度で格納されるとはかぎらないため、この問題はほとんどのコンピュータ言語で一般的です。 <code class="literal">FLOAT</code> を <code class="literal">DOUBLE</code> に変更すると解決することがあります。 <a class="xref" href="error-handling.html#problems-with-float" title="B.3.4.8 浮動小数点値に関する問題">セクションB.3.4.8「浮動小数点値に関する問題」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              問題がまだ特定されない場合は、<code class="literal">mysql test &lt; query.sql</code> を使用して実行可能な、問題が再現される最小限のテストを作成します。 テストファイルを作成するには、<span class="command"><strong>mysqldump --quick db_name <em class="replaceable"><code>tbl_name_1</code></em> ... <em class="replaceable"><code>tbl_name_n</code></em> &gt; query.sql</strong></span> を使用してテーブルをダンプします。 エディタでファイルを開いて、一部の挿入行を削除し (問題の再現に必要な分量以上にある場合)、ファイルの最後に <code class="literal">SELECT</code> ステートメントを追加します。 
            </p><p>
              次のコマンドを実行して、テストファイルで問題が再現されることを確認します。
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin create test2</code></strong>
shell&gt; <strong class="userinput"><code>mysql test2 &lt; query.sql</code></strong>
</pre><p>
              テストファイルをバグレポートに添付します (<a class="xref" href="introduction.html#bug-reports" title="1.6 質問またはバグをレポートする方法">セクション1.6「質問またはバグをレポートする方法」</a>の手順を参照してください)。
            </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="problems-with-float"></a>B.3.4.8 浮動小数点値に関する問題</h4></div></div></div><p>
          浮動小数点数は、近似値であり正確な値として格納されないため、混乱の原因となることがあります。 SQL ステートメントで出力される浮動小数点値は、内部で表された値と同じではないことがあります。 比較で浮動小数点値を正確な値として扱おうとすると、問題となることがあります。 これらはまた、プラットフォームまたは実装の依存関係にも従います。 <code class="literal">FLOAT</code> データ型および <code class="literal">DOUBLE</code> データ型では、これらの問題が発生することがあります。 <code class="literal">DECIMAL</code> カラムの場合、MySQL は演算を 65 桁 (10 進数) の精度で実行するため、ほとんどの一般的な精度の問題が解決されます。 
        </p><p>
          次の例では、<code class="literal">DOUBLE</code> を使用し、浮動小数点演算を使用して行われる計算がどのように浮動小数点エラーとなるかを示しています。
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (i INT, d1 DOUBLE, d2 DOUBLE);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO t1 VALUES (1, 101.40, 21.40), (1, -80.00, 0.00),</code></strong>
    -&gt; <strong class="userinput"><code>(2, 0.00, 0.00), (2, -13.20, 0.00), (2, 59.60, 46.40),</code></strong>
    -&gt; <strong class="userinput"><code>(2, 30.40, 30.40), (3, 37.00, 7.40), (3, -29.60, 0.00),</code></strong>
    -&gt; <strong class="userinput"><code>(4, 60.00, 15.40), (4, -10.60, 0.00), (4, -34.00, 0.00),</code></strong>
    -&gt; <strong class="userinput"><code>(5, 33.00, 0.00), (5, -25.80, 0.00), (5, 0.00, 7.20),</code></strong>
    -&gt; <strong class="userinput"><code>(6, 0.00, 0.00), (6, -51.40, 0.00);</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT i, SUM(d1) AS a, SUM(d2) AS b</code></strong>
    -&gt; <strong class="userinput"><code>FROM t1 GROUP BY i HAVING a &lt;&gt; b;</code></strong>

+------+-------+------+
| i    | a     | b    |
+------+-------+------+
|    1 |  21.4 | 21.4 |
|    2 |  76.8 | 76.8 |
|    3 |   7.4 |  7.4 |
|    4 |  15.4 | 15.4 |
|    5 |   7.2 |  7.2 |
|    6 | -51.4 |    0 |
+------+-------+------+
</pre><p>
          正しい結果です。 最初の 5 レコードは比較を満たしていないように見えますが (<code class="literal">a</code> と <code class="literal">b</code> の値は異なるように見えません)、コンピュータのアーキテクチャー、コンパイラのバージョン、最適化レベルなどの要因によって、小数点以下 1 桁などの数字が異なるためにこのような結果となっている可能性があります。 たとえば、CPU が異なると、浮動小数点数の評価が異なることがあります。 
        </p><p>
          カラム <code class="literal">d1</code> および <code class="literal">d2</code> が <code class="literal">DOUBLE</code> ではなく <code class="literal">DECIMAL</code> として定義されていた場合、<code class="literal">SELECT</code> クエリーの結果は 1 行のみ (上記の最後の行) となります。
        </p><p>
          浮動小数点数の比較を正しく行うには、最初に数値の差異に関して受け入れられる許容度を決定し、許容値に対して比較を行います。 たとえば、1 万分の 1 (0.0001) の精度内で同じであれば浮動小数点数が同じであると見なす場合は、許容値より大きい差異を見つけるように比較を記述してください。 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1</code></strong>
    -&gt; <strong class="userinput"><code>GROUP BY i HAVING ABS(a - b) &gt; 0.0001;</code></strong>
+------+-------+------+
| i    | a     | b    |
+------+-------+------+
|    6 | -51.4 |    0 |
+------+-------+------+
1 row in set (0.00 sec)
</pre><p>
          逆に、数値が同じである行を取得する場合は、テストで許容値内での差異を判断するようにします。
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1</code></strong>
    -&gt; <strong class="userinput"><code>GROUP BY i HAVING ABS(a - b) &lt;= 0.0001;</code></strong>
+------+------+------+
| i    | a    | b    |
+------+------+------+
|    1 | 21.4 | 21.4 |
|    2 | 76.8 | 76.8 |
|    3 |  7.4 |  7.4 |
|    4 | 15.4 | 15.4 |
|    5 |  7.2 |  7.2 |
+------+------+------+
5 rows in set (0.03 sec)
</pre><p>
          浮動小数点値はプラットフォームまたは実装の依存関係の影響を受けます。 次のステートメントを実行するとします。 
        </p><pre class="programlisting">CREATE TABLE t1(c1 FLOAT(53,0), c2 FLOAT(53,0));
INSERT INTO t1 VALUES('1e+52','-1e+52');
SELECT * FROM t1;
</pre><p>
          一部のプラットフォームでは、<code class="literal">SELECT</code> ステートメントは <code class="literal">inf</code> および <code class="literal">-inf</code> を返します。 ほかのプラットフォームでは、<code class="literal">0</code> および <code class="literal">-0</code> が返されます。 
        </p><p>
          前述の問題の影響は、ソースで <span class="command"><strong>mysqldump</strong></span> を使用してテーブルの内容をダンプし、ダンプファイルをレプリカにリロードしてレプリカを作成しようとすると、浮動小数点カラムを含むテーブルが 2 つのホスト間で異なる可能性があることです。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="optimizer-issues"></a>B.3.5 オプティマイザ関連の問題</h3></div></div></div><p>
        MySQL はコストベースのオプティマイザを使用して、クエリーを実行する最適な方法を判別しています。 多くの場合、MySQL は実行可能な最適なクエリー計画を計算できますが、データに関する情報を十分に取得できず、データについて<span class="quote">「<span class="quote">学習による</span>」</span>推測を行う必要がある場合があります。 
      </p><p>
        MySQL で「適切」に処理されなかった場合に、MySQL に指示を送るために使用できるツールを次に示します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">EXPLAIN</code> ステートメントを使用して、MySQL がクエリーを処理する方法に関する情報を取得します。 これを使用するには、キーワード <code class="literal">EXPLAIN</code> を <code class="literal">SELECT</code> ステートメントの前に追加します。 
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>EXPLAIN SELECT * FROM t1, t2 WHERE t1.i = t2.i;</code></strong>
</pre><p>
            <code class="literal">EXPLAIN</code> については、<a class="xref" href="sql-statements.html#explain" title="13.8.2 EXPLAIN ステートメント">セクション13.8.2「EXPLAIN ステートメント」</a>で詳しく説明しています。
          </p></li><li class="listitem"><p>
            <code class="literal">ANALYZE TABLE <em class="replaceable"><code>tbl_name</code></em></code> を使用して、スキャンされるテーブルのキー分布を更新します。 <a class="xref" href="sql-statements.html#analyze-table" title="13.7.3.1 ANALYZE TABLE ステートメント">セクション13.7.3.1「ANALYZE TABLE ステートメント」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm45302160944016"></a> スキャンされるテーブルに <code class="literal">FORCE INDEX</code> を使用して、テーブルスキャンは該当するインデックスを使用した場合と比較して著しく負荷が高いことを MySQL に通知します。
          </p><pre class="programlisting">SELECT * FROM t1, t2 FORCE INDEX (index_for_column)
WHERE t1.col_name=t2.col_name;
</pre><p>
            <code class="literal">USE INDEX</code> および <code class="literal">IGNORE INDEX</code> も役に立つことがあります。 <a class="xref" href="optimization.html#index-hints" title="8.9.4 インデックスヒント">セクション8.9.4「インデックスヒント」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            グローバルおよびテーブルレベルの <code class="literal">STRAIGHT_JOIN</code>。 <a class="xref" href="sql-statements.html#select" title="13.2.10 SELECT ステートメント">セクション13.2.10「SELECT ステートメント」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            グローバルなシステム変数またはスレッド固有のシステム変数をチューニングできます。 たとえば、キースキャンでキー検索が 1,000 回を超えて行われることはないと想定するようにオプティマイザに通知するには、<code class="option">--max-seeks-for-key=1000</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> を起動するか、<code class="literal">SET max_seeks_for_key=1000</code> を使用します。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="table-definition-issues"></a>B.3.6 テーブル定義関連の問題</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="error-handling.html#alter-table-problems">B.3.6.1 ALTER TABLE での問題</a></span></dt><dt><span class="section"><a href="error-handling.html#temporary-table-problems">B.3.6.2 TEMPORARY テーブルに関する問題</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="alter-table-problems"></a>B.3.6.1 ALTER TABLE での問題</h4></div></div></div><a class="indexterm" name="idm45302160928496"></a><a class="indexterm" name="idm45302160927184"></a><a class="indexterm" name="idm45302160925040"></a><a class="indexterm" name="idm45302160923008"></a><p>
          <code class="literal">ALTER TABLE</code> を使用して文字セットまたは文字カラムの照合順序を変更するときに、重複キーエラーを受け取った場合、原因は新しいカラムの照合順序が同じ値に対して 2 つのキーをマップしたか、テーブルが破損していることです。 後者の場合は、そのテーブルに対して <code class="literal">REPAIR TABLE</code> を実行してください。 <code class="literal">REPAIR TABLE</code> は、<code class="literal">MyISAM</code>、<code class="literal">ARCHIVE</code> および <code class="literal">CSV</code> テーブルに対して機能します。 
        </p><p>
          トランザクションテーブルに対して <code class="literal">ALTER TABLE</code> を使用したとき、または Windows を使用しているときに、<code class="literal">LOCK TABLE</code> が発行されていた場合、<code class="literal">ALTER TABLE</code> はテーブルをロック解除します。 これが行われるのは、<code class="literal">InnoDB</code> およびこれらのオペレーティングシステムは使用されているテーブルをドロップできないためです。 
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="temporary-table-problems"></a>B.3.6.2 TEMPORARY テーブルに関する問題</h4></div></div></div><a class="indexterm" name="idm45302160908368"></a><p>
          <code class="literal">CREATE TEMPORARY TABLE</code> で作成される一時テーブルには、次の制限があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">TEMPORARY</code> テーブルは、<code class="literal">InnoDB</code>, <code class="literal">MEMORY</code>, <code class="literal">MyISAM</code> および <code class="literal">MERGE</code> ストレージエンジンでのみサポートされます。
            </p></li><li class="listitem"><p>
              NDB Cluster では一時テーブルはサポートされていません。
            </p></li><li class="listitem"><p>
              <code class="literal">SHOW TABLES</code> ステートメントでは <code class="literal">TEMPORARY</code> テーブルは一覧表示されません。
            </p></li><li class="listitem"><p>
              <code class="literal">TEMPORARY</code> テーブルの名前を変更する場合、<code class="literal">RENAME TABLE</code> は機能しません。 かわりに <code class="literal">ALTER TABLE</code> を使用します: 
            </p><pre class="programlisting">ALTER TABLE old_name RENAME new_name;
</pre></li><li class="listitem"><p>
              同じクエリーで <code class="literal">TEMPORARY</code> テーブルを複数回参照することはできません。 たとえば、次のステートメントは動作しません。 
            </p><pre class="programlisting">SELECT * FROM temp_table JOIN temp_table AS t2;
</pre><a class="indexterm" name="idm45302160889232"></a><a class="indexterm" name="idm45302160886992"></a><p>
              このステートメントによって次のエラーが生成されます:
            </p><pre class="programlisting">ERROR 1137: Can't reopen table: 'temp_table'
</pre><p>
              クエリーで <code class="literal">TEMPORARY</code> テーブルではなく共通テーブル式 (CTE) の使用が許可されている場合は、この問題を回避できます。 たとえば、これは<span class="errortext">「テーブルを再オープンできません」</span>エラーで失敗します: 
            </p><pre class="programlisting">CREATE TEMPORARY TABLE t SELECT 1 AS col_a, 2 AS col_b;
SELECT * FROM t AS t1 JOIN t AS t2;
</pre><p>
              エラーを回避するには、<code class="literal">TEMPORARY</code> テーブルではなく CTE を定義する <code class="literal">WITH</code> 句を使用します:
            </p><pre class="programlisting">WITH cte AS (SELECT 1 AS col_a, 2 AS col_b)
SELECT * FROM cte AS t1 JOIN cte AS t2;
</pre></li><li class="listitem"><p>
              ストアドファンクションで一時テーブルを異なるエイリアスで複数回参照すると、関数内の異なるステートメントで参照が発生しても、<span class="errortext">「テーブルを再オープンできません」</span>エラーが発生します。 これは、ストアドファンクションの外部で作成され、複数の呼び出し元および呼び出し先関数にわたって参照される一時テーブルで発生することがあります。 
            </p></li><li class="listitem"><p>
              <code class="literal">TEMPORARY</code> が既存の <code class="literal">TEMPORARY</code> 以外のテーブルと同じ名前で作成された場合、<code class="literal">TEMPORARY</code> 以外のテーブルは、別の記憶域エンジンを使用していても、<code class="literal">TEMPORARY</code> テーブルが削除されるまで非表示になります。
            </p></li><li class="listitem"><p>
              レプリケーションで一時テーブルを使用する場合の既知の問題があります。 詳しくは<a class="xref" href="replication.html#replication-features-temptables" title="17.5.1.31 レプリケーションと一時テーブル">セクション17.5.1.31「レプリケーションと一時テーブル」</a>,をご覧ください。 
            </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="known-issues"></a>B.3.7 MySQL の既知の問題</h3></div></div></div><a class="indexterm" name="idm45302160867584"></a><a class="indexterm" name="idm45302160865472"></a><a class="indexterm" name="idm45302160863440"></a><a class="indexterm" name="idm45302160861408"></a><p>
        このセクションでは、最新バージョンの MySQL の既知の問題を一覧表示します。
      </p><p>
        プラットフォーム固有の問題の詳細は、<a class="xref" href="installing.html#general-installation-issues" title="2.1 一般的なインストールガイド">セクション2.1「一般的なインストールガイド」</a> および <a class="xref" href="server-administration.html#debugging-mysql" title="5.9 MySQL のデバッグ">セクション5.9「MySQL のデバッグ」</a> のインストールおよびデバッグの手順を参照してください。
      </p><p>
        次の問題は既知の問題です。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">IN</code> のサブクエリーの最適化は、<code class="literal">=</code> ほど効果はありません。
          </p></li><li class="listitem"><p>
            <code class="literal">lower_case_table_names=2</code> (データベース名およびテーブル名に大文字/小文字のどちらが使用されたかを MySQL が認識するようになります) を使用していても、MySQL が関数 <code class="literal">DATABASE()</code> のデータベース名、またはさまざまなログ内 (大文字/小文字が区別されないシステムの) で使用された表記を識別できません。
          </p></li><li class="listitem"><p>
            <code class="literal">FOREIGN KEY</code> 制約の削除はレプリケーションでは機能しません。これは、制約がレプリカ上に別の名前を持つ可能性があるためです。
          </p></li><li class="listitem"><p>
            <code class="literal">REPLACE</code> (および <code class="literal">REPLACE</code> オプションを指定した <code class="literal">LOAD DATA</code>) で <code class="literal">ON DELETE CASCADE</code> がトリガーされません。
          </p></li><li class="listitem"><p>
            <code class="literal">DISTINCT</code> リストに指定されたすべてのカラムのみを使用しない場合、<code class="literal">GROUP_CONCAT()</code> 内で <code class="literal">ORDER BY</code> を指定した <code class="literal">DISTINCT</code> が動作しません。
          </p></li><li class="listitem"><p>
            数値は符号付き整数コンテキストで評価されるため、小数カラムまたは文字列カラムに大きい整数値 (2<sup>63</sup> から 2<sup>64</sup>−1) を挿入すると、負の値として挿入されます。
          </p></li><li class="listitem"><p>
            ステートメントベースのバイナリロギングでは、ソースサーバーは実行されたクエリーをバイナリログに書き込みます。 これは、ほとんどの場合に理想的に動作する非常に高速かつコンパクトで効率的なロギング方法です。 ただし、データ変更が非決定的に行われるようにクエリーが設計されている場合は、ソースとレプリカのデータが異なる可能性があります (通常、レプリケーションの外部であっても推奨されません)。 
          </p><p>
            例:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                ゼロ値または <code class="literal">NULL</code> 値を <code class="literal">AUTO_INCREMENT</code> カラムに挿入する <code class="literal">CREATE TABLE ... SELECT</code> ステートメントまたは <code class="literal">INSERT ... SELECT</code> ステートメント。
              </p></li><li class="listitem"><p>
                <code class="literal">ON DELETE CASCADE</code> プロパティーが指定された外部キーを持つテーブルから行を削除する場合の <code class="literal">DELETE</code>。
              </p></li><li class="listitem"><p>
                挿入されるデータに重複キー値がある場合の <code class="literal">REPLACE ... SELECT</code>、<code class="literal">INSERT IGNORE ... SELECT</code>。
              </p></li></ul></div><p>
            <span class="bold"><strong>これは、前述したクエリーに決定性順序を保証する <code class="literal">ORDER BY</code> 句がない場合にのみ発生することがあります</strong></span>。
          </p><p>
            たとえば、<code class="literal">ORDER BY</code> を使用しない <code class="literal">INSERT ... SELECT</code> の場合、<code class="literal">SELECT</code> は、ソースおよびレプリカでのオプティマイザによる選択に応じて、異なる順序で行を返すことがあります (これにより、行のランクが異なるため、<code class="literal">AUTO_INCREMENT</code> カラムで異なる番号が取得されます)。
          </p><p>
            クエリーは、次の場合にのみ、ソースとレプリカで異なる方法で最適化されます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                テーブルは、レプリカとは異なるストレージエンジンを使用してソースに格納されます。 (ソースとレプリカで異なるストレージエンジンを使用できます。 たとえば、ソースでは <code class="literal">InnoDB</code> を使用できますが、レプリカに使用可能なディスク領域が少ない場合はレプリカで <code class="literal">MyISAM</code> を使用できます。) 
              </p></li><li class="listitem"><p>
                MySQL バッファサイズ (<code class="literal">key_buffer_size</code> など) は、ソースとレプリカで異なります。
              </p></li><li class="listitem"><p>
                ソースとレプリカは異なる MySQL バージョンを実行し、オプティマイザコードはこれらのバージョン間で異なります。
              </p></li></ul></div><p>
            この問題は、<span class="command"><strong>mysqlbinlog|mysql</strong></span> を使用したデータベースのリストアに影響することもあります。
          </p><p>
            この問題を回避するもっとも簡単な方法は、行が常に同じ順序で格納または変更されるように、<code class="literal">ORDER BY</code> 句を前述の非決定性クエリーに追加することです。 行ベースのロギング形式または混合したロギング形式を使用することでも、この問題が回避されます。 
          </p></li><li class="listitem"><p>
            スタートアップオプションにファイル名を指定しない場合、ログファイル名はサーバーのホスト名に基づいています。 ホスト名を別の名前に変更した場合に同じログファイル名のままにするには、<code class="option">--log-bin=<em class="replaceable"><code>old_host_name</code></em>-bin</code> などのオプションを明示的に使用する必要があります。 <a class="xref" href="server-administration.html#server-options" title="5.1.7 サーバーコマンドオプション">セクション5.1.7「サーバーコマンドオプション」</a>を参照してください。 または、ホスト名の変更が反映されるように、古いファイルを名前変更します。 バイナリログの場合は、バイナリログのインデックスファイルを編集して、そこにあるバイナリログファイル名も修正する必要があります。 (レプリカ上のリレーログにも同じことが当てはまります。) 
          </p></li><li class="listitem"><p>
            <span class="command"><strong>mysqlbinlog</strong></span> では、<code class="literal">LOAD DATA</code> ステートメントの後に残っている一時ファイルは削除されません。 <a class="xref" href="programs.html#mysqlbinlog" title="4.6.8 mysqlbinlog — バイナリログファイルを処理するためのユーティリティー">セクション4.6.8「mysqlbinlog — バイナリログファイルを処理するためのユーティリティー」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            <code class="literal">RENAME</code> が <code class="literal">TEMPORARY</code> テーブル、または <code class="literal">MERGE</code> テーブルで使用されているテーブルで動作しません。
          </p></li><li class="listitem"><p>
            <code class="literal">SET CHARACTER SET</code> を使用したときに、データベース、テーブル、およびカラムの名前に変換された文字を使用できません。
          </p></li><li class="listitem"><p>
            MySQL 8.0.17 より前は、<code class="literal">LIKE ... ESCAPE</code> で <code class="literal">ESCAPE</code> とともに<code class="literal">_</code>または <code class="literal">%</code> を使用することはできません。
          </p></li><li class="listitem"><p>
            サーバーは、データ値を比較するときに最初の <code class="literal">max_sort_length</code> バイトのみを使用します。 つまり、値が最初の <code class="literal">max_sort_length</code> バイトの後にのみ異なる場合、<code class="literal">GROUP BY</code>、<code class="literal">ORDER BY</code> または <code class="literal">DISTINCT</code> で値を確実に使用することはできません。 これを回避するには、変数値を増やします。 <code class="literal">max_sort_length</code> のデフォルト値は 1024 であり、サーバーの起動時または実行時に変更できます。 
          </p></li><li class="listitem"><p>
            数値計算は <code class="literal">BIGINT</code> または <code class="literal">DOUBLE</code> (通常、どちらも長さは 64 ビットです) で行われます。 返される精度は関数によって異なります。 一般的なルールとしては、ビット関数は <code class="literal">BIGINT</code> の精度、<code class="literal">IF()</code> と <code class="literal">ELT()</code> は <code class="literal">BIGINT</code> または <code class="literal">DOUBLE</code> の精度、および残りは <code class="literal">DOUBLE</code> の精度で実行されます。 符号なしの long long 値がビットフィールド以外で 63 ビット (9223372036854775807) を超える値に解決される場合は、使用しないようにしてください。 
          </p></li><li class="listitem"><p>
            1 つのテーブルには、最大 255 個の <code class="literal">ENUM</code> カラムおよび <code class="literal">SET</code> カラムを作成できます。
          </p></li><li class="listitem"><p>
            現在、<code class="literal">MIN()</code>、<code class="literal">MAX()</code>、およびその他の集約関数では、MySQL はセット内の文字列の相対位置ではなく文字列値で <code class="literal">ENUM</code> カラムおよび <code class="literal">SET</code> カラムを比較します。
          </p></li><li class="listitem"><p>
            <code class="literal">UPDATE</code> ステートメントでは、カラムは左から右に更新されます。 更新されたカラムを参照している場合は、元の値ではなく更新された値が取得されます。 たとえば、次のステートメントでは <code class="literal">KEY</code> に <code class="literal">1</code> <span class="bold"><strong>ではなく</strong></span> <code class="literal">2</code> がインクリメントされます。 
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>UPDATE <em class="replaceable"><code>tbl_name</code></em> SET KEY=KEY+1,KEY=KEY+1;</code></strong>
</pre></li><li class="listitem"><p>
            同じクエリーで複数の一時テーブルを参照することはできますが、特定の一時テーブルを複数回参照することはできません。 たとえば、次のステートメントは動作しません。 
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM temp_table, temp_table AS t2;</code></strong>
ERROR 1137: Can't reopen table: 'temp_table'
</pre></li><li class="listitem"><p>
            結合で<span class="quote">「<span class="quote">隠し</span>」</span>カラムを使用している場合は、オプティマイザでの <code class="literal">DISTINCT</code> の処理が異なることがあります。 結合では、隠しカラムは結果の一部としてカウントされますが (表示されていなくても)、通常のクエリーでは、隠しカラムは <code class="literal">DISTINCT</code> 比較で考慮されません。 
          </p><p>
            次に例を示します。
          </p><pre class="programlisting">SELECT DISTINCT mp3id FROM band_downloads
       WHERE userid = 9 ORDER BY id DESC;
</pre><p>
            および
          </p><pre class="programlisting">SELECT DISTINCT band_downloads.mp3id
       FROM band_downloads,band_mp3
       WHERE band_downloads.userid = 9
       AND band_mp3.id = band_downloads.mp3id
       ORDER BY band_downloads.id DESC;
</pre><p>
            2 番目のケースでは、結果セットに同一の行が 2 つ表示される場合があります (非表示の <code class="literal">id</code> カラムの値が異なる可能性があるため)。
          </p><p>
            これは、結果に <code class="literal">ORDER BY</code> のカラムがないクエリーでのみ発生します。
          </p></li><li class="listitem"><p>
            空のセットを返すクエリーに関する <code class="literal">PROCEDURE</code> を実行すると、<code class="literal">PROCEDURE</code> でカラムが変換されないことがあります。
          </p></li><li class="listitem"><p>
            <code class="literal">MERGE</code> タイプのテーブルの作成で、基礎テーブルが互換性のあるタイプであるかどうかがチェックされません。
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER TABLE</code> を使用して、<code class="literal">MERGE</code> テーブルで使用されるテーブルに <code class="literal">UNIQUE</code> インデックスを追加し、次に <code class="literal">MERGE</code> テーブルに通常のインデックスを追加したときに、テーブルに古い <code class="literal">UNIQUE</code> ではないキーがあった場合、それらのテーブルのキー順序は異なります。 これは、重複キーをできるだけ早く検出できるように、<code class="literal">ALTER TABLE</code> が通常のインデックスより <code class="literal">UNIQUE</code> インデックスを優先するためです。 
          </p></li></ul></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="faqs.html">前</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="indexes.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">付録 A MySQL 8.0 のよくある質問 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 付録 C インデックス</td></tr></table></div><div class="copyright-footer"></div></body></html>
