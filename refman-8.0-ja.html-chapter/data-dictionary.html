<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>第 14 章 MySQL データディクショナリ</title><link rel="stylesheet" type="text/css" href="mvl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="MySQL 8.0 リファレンスマニュアル"><link rel="up" href="index.html" title="MySQL 8.0 リファレンスマニュアル"><link rel="prev" href="sql-statements.html" title="第 13 章 SQL ステートメント"><link rel="next" href="innodb-storage-engine.html" title="第 15 章 InnoDB ストレージエンジン"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 14 章 MySQL データディクショナリ</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="sql-statements.html">前</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="innodb-storage-engine.html">次へ</a></td></tr></table><hr></div><div class="status-header"><p class="alert">このページは機械翻訳したものです。</p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="data-dictionary"></a>第 14 章 MySQL データディクショナリ</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="section"><a href="data-dictionary.html#data-dictionary-schema">14.1 データディクショナリスキーマ</a></span></dt><dt><span class="section"><a href="data-dictionary.html#data-dictionary-file-removal">14.2 ファイルベースのメタデータ記憶域の削除</a></span></dt><dt><span class="section"><a href="data-dictionary.html#data-dictionary-transactional-storage">14.3 ディクショナリデータのトランザクション記憶域</a></span></dt><dt><span class="section"><a href="data-dictionary.html#data-dictionary-object-cache">14.4 ディクショナリオブジェクトキャッシュ</a></span></dt><dt><span class="section"><a href="data-dictionary.html#data-dictionary-information-schema">14.5 INFORMATION_SCHEMA とデータディクショナリの統合</a></span></dt><dt><span class="section"><a href="data-dictionary.html#serialized-dictionary-information">14.6 シリアライズディクショナリ情報 (SDI)</a></span></dt><dt><span class="section"><a href="data-dictionary.html#data-dictionary-usage-differences">14.7 データディクショナリの使用方法の違い</a></span></dt><dt><span class="section"><a href="data-dictionary.html#data-dictionary-limitations">14.8 データディクショナリの制限事項</a></span></dt></dl></div><a class="indexterm" name="idm45547965108320"></a><a class="indexterm" name="idm45547965106816"></a><p>
    MySQL Server には、データベースオブジェクトに関する情報を格納するトランザクションデータディクショナリが組み込まれています。 以前の MySQL リリースでは、ディクショナリデータはメタデータファイル、非トランザクションテーブルおよびストレージエンジン固有のデータディクショナリに格納されていました。 
  </p><p>
    この章では、データディクショナリの主な機能、利点、使用上の違いおよび制限について説明します。 データディクショナリ機能のその他の影響については、<a class="ulink" href="https://dev.mysql.com/doc/relnotes/mysql/8.0/en/" target="_top">「MySQL 8.0 リリースノート」</a>の<span class="quote">「<span class="quote">「データディクショナリのノート」</span>」</span>のセクションを参照してください。 
  </p><p>
    MySQL データディクショナリの利点は次のとおりです:
  </p><a class="indexterm" name="idm45547965101840"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        ディクショナリデータを均一に格納する集中化されたデータディクショナリスキーマの単純性。 <a class="xref" href="data-dictionary.html#data-dictionary-schema" title="14.1 データディクショナリスキーマ">セクション14.1「データディクショナリスキーマ」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        ファイルベースのメタデータ記憶域の削除。 <a class="xref" href="data-dictionary.html#data-dictionary-file-removal" title="14.2 ファイルベースのメタデータ記憶域の削除">セクション14.2「ファイルベースのメタデータ記憶域の削除」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        ディクショナリデータのトランザクション対応のクラッシュセーフ記憶域。 <a class="xref" href="data-dictionary.html#data-dictionary-transactional-storage" title="14.3 ディクショナリデータのトランザクション記憶域">セクション14.3「ディクショナリデータのトランザクション記憶域」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        ディクショナリオブジェクトの共通キャッシュおよび集中キャッシュ。 <a class="xref" href="data-dictionary.html#data-dictionary-object-cache" title="14.4 ディクショナリオブジェクトキャッシュ">セクション14.4「ディクショナリオブジェクトキャッシュ」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        一部の <code class="literal">INFORMATION_SCHEMA</code> テーブルの実装が単純かつ改善されました。 <a class="xref" href="data-dictionary.html#data-dictionary-information-schema" title="14.5 INFORMATION_SCHEMA とデータディクショナリの統合">セクション14.5「INFORMATION_SCHEMA とデータディクショナリの統合」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        アトミック DDL。 <a class="xref" href="sql-statements.html#atomic-ddl" title="13.1.1 アトミックデータ定義ステートメントのサポート">セクション13.1.1「アトミックデータ定義ステートメントのサポート」</a>を参照してください。 
      </p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
      データディクショナリが有効なサーバーには、データディクショナリがないサーバーと比較して、一般的な操作上の違いがいくつかあります。<a class="xref" href="data-dictionary.html#data-dictionary-usage-differences" title="14.7 データディクショナリの使用方法の違い">セクション14.7「データディクショナリの使用方法の違い」</a> を参照してください。 また、MySQL 8.0 へのアップグレードの場合、アップグレード手順は以前の MySQL リリースと多少異なり、特定の前提条件を確認してインストールのアップグレード準備状況を確認する必要があります。 詳細は、<a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a>(特に <a class="xref" href="installing.html#upgrade-prerequisites" title="2.11.5 アップグレード用のインストールの準備">セクション2.11.5「アップグレード用のインストールの準備」</a>) を参照してください。 
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictionary-schema"></a>14.1 データディクショナリスキーマ</h2></div></div></div><a class="indexterm" name="idm45547965083088"></a><p>
      データディクショナリテーブルは保護されており、MySQL のデバッグビルドでのみアクセスできます。 ただし、MySQL では、<code class="literal">INFORMATION_SCHEMA</code> テーブルおよび <code class="literal">SHOW</code> ステートメントを介したデータディクショナリテーブルに格納されたデータへのアクセスがサポートされています。 データディクショナリを構成するテーブルの概要は、<a class="xref" href="server-administration.html#system-schema-data-dictionary-tables" title="データディクショナリテーブル">データディクショナリテーブル</a> を参照してください。 
    </p><p>
      MySQL システムテーブルは MySQL 8.0 にまだ存在し、<code class="literal">mysql</code> システムデータベースで <code class="literal">SHOW TABLES</code> ステートメントを発行することで表示できます。 通常、MySQL データディクショナリテーブルとシステムテーブルの違いは、データディクショナリテーブルには SQL クエリーの実行に必要なメタデータが含まれるのに対し、システムテーブルにはタイムゾーンやヘルプ情報などの補助データが含まれることです。 MySQL システムテーブルとデータディクショナリテーブルも、アップグレード方法が異なります。 MySQL サーバーは、データディクショナリのアップグレードを管理します。 SQL サーバー。 <a class="xref" href="data-dictionary.html#data-dictionary-upgrade" title="データディクショナリのアップグレード方法">データディクショナリのアップグレード方法</a>を参照してください。 MySQL システムテーブルをアップグレードするには、完全な MySQL アップグレード手順を実行する必要があります。 <a class="xref" href="installing.html#upgrading-what-is-upgraded" title="2.11.3 MySQL のアップグレードプロセスの内容">セクション2.11.3「MySQL のアップグレードプロセスの内容」</a>を参照してください。 
    </p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="data-dictionary-upgrade"></a>データディクショナリのアップグレード方法</h3></div></div></div><p>
        MySQL の新しいバージョンには、データディクショナリテーブル定義の変更が含まれる場合があります。 このような変更は、新しくインストールされたバージョンの MySQL に存在しますが、MySQL バイナリのインプレースアップグレードを実行すると、新しいバイナリを使用して MySQL サーバーを再起動したときに変更が適用されます。 起動時に、データディクショナリテーブルをアップグレードする必要があるかどうかを判断するために、サーバーのデータディクショナリのバージョンがデータディクショナリに格納されているバージョン情報と比較されます。 アップグレードが必要でサポートされている場合、サーバーは、更新された定義を含むデータディクショナリテーブルを作成し、永続化されたメタデータを新しいテーブルにコピーし、古いテーブルを新しいテーブルに原子的に置き換え、データディクショナリを再初期化します。 アップグレードが不要な場合、データディクショナリテーブルを更新せずに起動が続行されます。 
      </p><p>
        データディクショナリテーブルのアップグレードはアトミック操作で、すべてのデータディクショナリテーブルが必要に応じてアップグレードされるか、操作が失敗することを意味します。 アップグレード操作が失敗した場合、サーバーの起動はエラーで失敗します。 この場合、古いサーバーバイナリを古いデータディレクトリとともに使用してサーバーを起動できます。 新しいサーバーバイナリを再度使用してサーバーを起動すると、データディクショナリのアップグレードが再試行されます。 
      </p><p>
        通常、データディクショナリテーブルが正常にアップグレードされた後は、古いサーバーバイナリを使用してサーバーを再起動することはできません。 その結果、データディクショナリテーブルのアップグレード後、MySQL サーバーバイナリの以前の MySQL バージョンへのダウングレードはサポートされません。 
      </p><p>
        <span class="command"><strong>mysqld</strong></span> <code class="option">--no-dd-upgrade</code> オプションを使用すると、起動時のデータディクショナリテーブルの自動アップグレードを回避できます。 <code class="option">--no-dd-upgrade</code> が指定され、サーバーのデータディクショナリのバージョンがデータディクショナリに格納されているバージョンと異なることがサーバーで検出されると、データディクショナリのアップグレードが禁止されていることを示すエラーで起動が失敗します。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="viewing-data-dictionary-tables"></a>MySQL のデバッグビルドを使用したデータディクショナリテーブルの表示</h3></div></div></div><p>
        データディクショナリテーブルはデフォルトで保護されていますが、デバッグサポートを使用して (<code class="literal">-DWITH_DEBUG=1</code> <span class="command"><strong>CMake</strong></span> オプションを使用して)MySQL をコンパイルし、<code class="literal">+d,skip_dd_table_access_check</code> <code class="option">debug</code> オプションおよび修飾子を指定することでアクセスできます。 デバッグビルドのコンパイルの詳細は、<a class="xref" href="server-administration.html#compiling-for-debugging" title="5.9.1.1 デバッグのための MySQL のコンパイル">セクション5.9.1.1「デバッグのための MySQL のコンパイル」</a> を参照してください。 
      </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
          データディクショナリテーブルを直接変更または書き込むことはお薦めしません。また、MySQL インスタンスが動作不能になる可能性があります。
        </p></div><p>
        デバッグサポート付きで MySQL をコンパイルした後、次の <code class="literal">SET</code> ステートメントを使用して、<span class="command"><strong>mysql</strong></span> クライアントセッションでデータディクショナリテーブルを表示できるようにします:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET SESSION debug='+d,skip_dd_table_access_check';</code></strong>
</pre><p>
        データディクショナリテーブルのリストを取得するには、次のクエリーを使用します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT name, schema_id, hidden, type FROM mysql.tables where schema_id=1 AND hidden='System';</code></strong>
</pre><p>
        データディクショナリテーブル定義を表示するには、<code class="literal">SHOW CREATE TABLE</code> を使用します。 例: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW CREATE TABLE mysql.catalogs\G</code></strong>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictionary-file-removal"></a>14.2 ファイルベースのメタデータ記憶域の削除</h2></div></div></div><a class="indexterm" name="idm45547965043584"></a><p>
      以前の MySQL リリースでは、ディクショナリデータは部分的にメタデータファイルに格納されていました。 ファイルベースのメタデータ記憶域の問題には、高価なファイルスキャン、ファイルシステム関連の不具合の疑わしい問題、レプリケーションおよびクラッシュリカバリの失敗状態を処理するための複雑なコード、新機能およびリレーショナルオブジェクトのメタデータの追加を困難にする拡張性の欠如などがあります。 
    </p><p>
      次に示すメタデータファイルが MySQL から削除されます。 特に明記されていないかぎり、メタデータファイルに以前格納されたデータはデータディクショナリテーブルに格納されるようになりました。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="filename">.frm</code> ファイル: テーブルメタデータファイル。 <code class="filename">.frm</code> ファイルを削除すると、次のようになります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="filename">.frm</code> ファイル構造によって課される 64KB のテーブル定義サイズ制限が削除されます。
            </p></li><li class="listitem"><p>
              <code class="literal">INFORMATION_SCHEMA.TABLES</code> <code class="literal">VERSION</code> カラムには、MySQL 5.7 で最後に使用された <code class="filename">.frm</code> ファイルバージョンである <code class="literal">10</code> のハードコードされた値がレポートされます。
            </p></li></ul></div></li><li class="listitem"><p>
          <code class="filename">.par</code> ファイル: パーティション定義ファイル。 MySQL 5.7 のパーティション定義ファイルを使用して <code class="literal">InnoDB</code> が停止し、<code class="literal">InnoDB</code> テーブルのネイティブパーティション化サポートが導入されました。 
        </p></li><li class="listitem"><p>
          <code class="filename">.TRN</code> ファイル: トリガーネームスペースファイル。
        </p></li><li class="listitem"><p>
          <code class="filename">.TRG</code> ファイル: トリガーパラメータファイル。
        </p></li><li class="listitem"><p>
          <code class="filename">.isl</code> ファイル: データディレクトリの外部で作成された <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a> テーブルスペースファイルの場所を含む <code class="literal">InnoDB</code> シンボリックリンクファイル。
        </p></li><li class="listitem"><p>
          <code class="filename">db.opt</code> ファイル: データベース構成ファイル。 これらのファイル (データベースディレクトリごとに 1 つ) には、データベースのデフォルト文字セット属性が含まれていました。 
        </p></li><li class="listitem"><p>
          <code class="filename">ddl_log.log</code> ファイル: ファイルには、<code class="literal">DROP TABLE</code> や <code class="literal">ALTER TABLE</code> などのデータ定義ステートメントによって生成されたメタデータ操作のレコードが含まれていました。
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictionary-transactional-storage"></a>14.3 ディクショナリデータのトランザクション記憶域</h2></div></div></div><a class="indexterm" name="idm45547965013648"></a><p>
      データディクショナリビューは、トランザクション (<code class="literal">InnoDB</code>) テーブルにディクショナリデータを格納します。 データディクショナリテーブルは、非データディクショナリシステムテーブルとともに <code class="filename">mysql</code> データベースに配置されます。 
    </p><p>
      データディクショナリテーブルは、MySQL データディレクトリにある <code class="filename">mysql.ibd</code> という名前の単一の <code class="literal">InnoDB</code> テーブルスペースに作成されます。 <code class="filename">mysql.ibd</code> テーブルスペースファイルは MySQL データディレクトリに存在する必要があり、その名前を変更したり、別のテーブルスペースで使用することはできません。 
    </p><p>
      ディクショナリデータは、<code class="literal">InnoDB</code> テーブルに格納されているユーザーデータを保護する同じコミット、ロールバックおよびクラッシュリカバリ機能によって保護されます。
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictionary-object-cache"></a>14.4 ディクショナリオブジェクトキャッシュ</h2></div></div></div><a class="indexterm" name="idm45547965003280"></a><a class="indexterm" name="idm45547965001760"></a><p>
      ディクショナリオブジェクトキャッシュは、以前にアクセスしたデータディクショナリオブジェクトをメモリーに格納して、オブジェクトの再利用を可能にし、ディスク I/O を最小限に抑える共有グローバルキャッシュです。 MySQL で使用される他のキャッシュメカニズムと同様に、ディクショナリオブジェクトキャッシュでは <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> ベースの削除戦略を使用して、メモリーから最も使用頻度の低いオブジェクトを削除します。 
    </p><p>
      ディクショナリオブジェクトキャッシュは、様々なオブジェクト型を格納するキャッシュパーティションで構成されます。 一部のキャッシュパーティションサイズ制限は構成可能ですが、その他の制限はハードコードされています。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong>テーブルスペース定義キャッシュパーティション</strong></span>: テーブルスペース定義オブジェクトを格納します。 <code class="literal">tablespace_definition_cache</code> オプションでは、ディクショナリオブジェクトキャッシュに格納できるテーブルスペース定義オブジェクトの数に制限を設定します。 デフォルト値は 256 です。 
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>スキーマ定義キャッシュパーティション</strong></span>: スキーマ定義オブジェクトを格納します。 <code class="literal">schema_definition_cache</code> オプションでは、ディクショナリオブジェクトキャッシュに格納できるスキーマ定義オブジェクトの数に制限を設定します。 デフォルト値は 256 です。 
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>テーブル定義キャッシュパーティション</strong></span>: テーブル定義オブジェクトを格納します。 オブジェクト制限は <code class="literal">max_connections</code> の値に設定され、デフォルト値は 151 です。 
        </p><p>
          テーブル定義キャッシュパーティションは、<code class="literal">table_definition_cache</code> 構成オプションを使用して構成されたテーブル定義キャッシュと並行して存在します。 どちらのキャッシュにもテーブル定義が格納されますが、MySQL サーバーの様々な部分に対応します。 一方のキャッシュ内のオブジェクトは、他方のキャッシュ内のオブジェクトの存在に依存しません。 
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>ストアドプログラム定義キャッシュパーティション</strong></span>: ストアドプログラム定義オブジェクトを格納します。 <code class="literal">stored_program_definition_cache</code> オプションでは、ディクショナリオブジェクトキャッシュに格納できるストアドプログラム定義オブジェクトの数に制限を設定します。 デフォルト値は 256 です。 
        </p><p>
          ストアドプログラム定義キャッシュパーティションは、<code class="literal">stored_program_cache</code> オプションを使用して構成されたストアドプロシージャおよびストアドファンクションキャッシュと並行して存在します。
        </p><p>
          <code class="literal">stored_program_cache</code> オプションは、接続ごとにキャッシュされるストアドプロシージャまたはファンクションの数に弱い上限を設定し、接続がストアドプロシージャまたはファンクションを実行するたびに制限がチェックされます。 一方、ストアドプログラム定義キャッシュパーティションは、他の目的でストアドプログラム定義オブジェクトを格納する共有キャッシュです。 ストアドプログラム定義キャッシュパーティションにオブジェクトが存在しても、ストアドプロシージャキャッシュまたはストアドファンクションキャッシュにオブジェクトが存在するかどうかには依存しません。その逆も同様です。 
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>文字セット定義キャッシュパーティション</strong></span>: 文字セット定義オブジェクトを格納し、256 のハードコードされたオブジェクト制限を持ちます。
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>照合定義キャッシュパーティション</strong></span>: 照合定義オブジェクトを格納し、256 のハードコードされたオブジェクト制限を持ちます。
        </p></li></ul></div><p>
      ディクショナリオブジェクトキャッシュ構成オプションの有効な値の詳細は、<a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a> を参照してください。
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictionary-information-schema"></a>14.5 INFORMATION_SCHEMA とデータディクショナリの統合</h2></div></div></div><a class="indexterm" name="idm45547964970832"></a><p>
      データディクショナリの導入により、次の <code class="literal">INFORMATION_SCHEMA</code> テーブルがデータディクショナリテーブルのビューとして実装されます:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">CHARACTER_SETS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">CHECK_CONSTRAINTS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">COLLATIONS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">COLLATION_CHARACTER_SET_APPLICABILITY</code>
        </p></li><li class="listitem"><p>
          <code class="literal">COLUMNS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">COLUMN_STATISTICS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">EVENTS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">FILES</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_COLUMNS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_DATAFILES</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_FIELDS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_FOREIGN</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_FOREIGN_COLS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_INDEXES</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_TABLES</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_TABLESPACES</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_TABLESPACES_BRIEF</code>
        </p></li><li class="listitem"><p>
          <code class="literal">INNODB_TABLESTATS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">KEY_COLUMN_USAGE</code>
        </p></li><li class="listitem"><p>
          <code class="literal">KEYWORDS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">PARAMETERS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">PARTITIONS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">REFERENTIAL_CONSTRAINTS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">RESOURCE_GROUPS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">ROUTINES</code>
        </p></li><li class="listitem"><p>
          <code class="literal">SCHEMATA</code>
        </p></li><li class="listitem"><p>
          <code class="literal">STATISTICS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">ST_GEOMETRY_COLUMNS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">ST_SPATIAL_REFERENCE_SYSTEMS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">TABLES</code>
        </p></li><li class="listitem"><p>
          <code class="literal">TABLE_CONSTRAINTS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">TRIGGERS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">VIEWS</code>
        </p></li><li class="listitem"><p>
          <code class="literal">VIEW_ROUTINE_USAGE</code>
        </p></li><li class="listitem"><p>
          <code class="literal">VIEW_TABLE_USAGE</code>
        </p></li></ul></div><p>
      これらのテーブルに対するクエリーは、他の低速な方法ではなくデータディクショナリテーブルから情報を取得するため、より効率的になりました。 特に、データディクショナリテーブルのビューである <code class="literal">INFORMATION_SCHEMA</code> テーブルごとに、次のようにします: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーは、<code class="literal">INFORMATION_SCHEMA</code> テーブルのクエリーごとに一時テーブルを作成する必要がなくなりました。
        </p></li><li class="listitem"><p>
          基礎となるデータディクショナリテーブルに、ディレクトリスキャンによって以前に取得された値 (データベース名やデータベース内のテーブル名を列挙する場合など) またはファイルオープン操作 (<code class="filename">.frm</code> ファイルから情報を読み取る場合など) が格納されている場合、これらの値に対する <code class="literal">INFORMATION_SCHEMA</code> クエリーでは、かわりにテーブルルックアップが使用されるようになりました。 (また、ビュー以外の <code class="literal">INFORMATION_SCHEMA</code> テーブルの場合でも、データベース名やテーブル名などの値はデータディクショナリから参照によって取得されるため、ディレクトリまたはファイルのスキャンは必要ありません。) 
        </p></li><li class="listitem"><p>
          基礎となるデータディクショナリテーブルのインデックスを使用すると、オプティマイザは、クエリーごとに一時テーブルを使用して <code class="literal">INFORMATION_SCHEMA</code> テーブルを処理した以前の実装に当てはまらない効率的なクエリー実行計画を作成できます。
        </p></li></ul></div><p>
      前述の改善は、データディクショナリテーブルのビューである <code class="literal">INFORMATION_SCHEMA</code> テーブルに対応する情報を表示する <code class="literal">SHOW</code> ステートメントにも適用されます。 たとえば、<code class="literal">SHOW DATABASES</code> では、<code class="literal">SCHEMATA</code> テーブルと同じ情報が表示されます。 
    </p><p>
      データディクショナリテーブルのビューの導入に加えて、<code class="literal">STATISTICS</code> テーブルおよび <code class="literal">TABLES</code> テーブルに含まれるテーブル統計がキャッシュされ、<code class="literal">INFORMATION_SCHEMA</code> クエリーのパフォーマンスが向上しました。 <code class="literal">information_schema_stats_expiry</code> システム変数は、キャッシュされたテーブルの統計が期限切れになるまでの期間を定義します。 デフォルトは 86400 秒 (24 時間) です。 キャッシュされた統計がない場合、または統計が期限切れになっている場合は、テーブル統計カラムのクエリー時にストレージエンジンから統計が取得されます。 特定のテーブルのキャッシュされた値をいつでも更新するには、<code class="literal">ANALYZE TABLE</code> を使用 
    </p><p>
      <code class="literal">information_schema_stats_expiry</code> を <code class="literal">0</code> に設定すると、<code class="literal">INFORMATION_SCHEMA</code> クエリーでストレージエンジンから直接最新の統計を取得できます。これは、キャッシュされた統計の取得ほど高速ではありません。
    </p><p>
      詳細は、<a class="xref" href="optimization.html#information-schema-optimization" title="8.2.3 INFORMATION_SCHEMA クエリーの最適化">セクション8.2.3「INFORMATION_SCHEMA クエリーの最適化」</a>を参照してください。
    </p><p>
      MySQL 8.0 の <code class="literal">INFORMATION_SCHEMA</code> テーブルはデータディクショナリに密接に関連付けられているため、いくつかの使用方法が異なります。 <a class="xref" href="data-dictionary.html#data-dictionary-usage-differences" title="14.7 データディクショナリの使用方法の違い">セクション14.7「データディクショナリの使用方法の違い」</a>を参照してください。 
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="serialized-dictionary-information"></a>14.6 シリアライズディクショナリ情報 (SDI)</h2></div></div></div><p>
      データベースオブジェクトに関するメタデータをデータディクショナリに格納する以外に、MySQL ではシリアライズされた形式で格納します。 このデータは、シリアライズディクショナリ情報 (SDI) と呼ばれます。 <code class="literal">InnoDB</code> では、SDI データはテーブルスペースファイル内に格納されます。 <code class="literal">NDBCLUSTER</code> は、SDI データを NDB ディクショナリに格納します。 その他のストレージエンジンは、テーブルデータベースディレクトリ内の特定のテーブルに対して作成された SDI データを <code class="filename">.sdi</code> ファイルに格納します。 SDI データは、コンパクトな <code class="literal">JSON</code> 形式で生成されます。 
    </p><p>
      シリアライズディクショナリ情報 (SDI) は、一時テーブルスペースおよび undo テーブルスペースファイルを除くすべての <code class="literal">InnoDB</code> テーブルスペースファイルに存在します。 <code class="literal">InnoDB</code> テーブルスペースファイルの SDI レコードには、テーブルスペース内に含まれるテーブルおよびテーブルスペースオブジェクトのみが記述されます。 
    </p><p>
      SDI データは、テーブルまたは <code class="literal">CHECK TABLE FOR UPGRADE</code> に対する DDL 操作によって更新されます。 SDI データは、MySQL サーバーを新しいリリースまたはバージョンにアップグレードしても更新されません。 
    </p><p>
      SDI データが存在すると、メタデータの冗長性が提供されます。 たとえば、データディクショナリが使用できなくなった場合、<span class="command"><strong>ibd2sdi</strong></span> ツールを使用して、オブジェクトメタデータを <code class="literal">InnoDB</code> テーブルスペースファイルから直接抽出できます。 
    </p><p>
      <code class="literal">InnoDB</code> の場合、SDI レコードには単一のインデックスページ (デフォルトでは 16KB) が必要です。 ただし、SDI データは、ストレージフットプリントを削減するために圧縮されます。 
    </p><p>
      複数のテーブルスペースで構成されるパーティション化された <code class="literal">InnoDB</code> テーブルの場合、SDI データは最初のパーティションのテーブルスペースファイルに格納されます。
    </p><p>
      MySQL サーバーは、<a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> 操作中にアクセスされる内部 API を使用して SDI レコードを作成および保守します。
    </p><p>
      <code class="literal">IMPORT TABLE</code> ステートメントは、<code class="filename">.sdi</code> ファイルに含まれる情報に基づいて <code class="literal">MyISAM</code> テーブルをインポートします。 詳細は、<a class="xref" href="sql-statements.html#import-table" title="13.2.5 IMPORT TABLE ステートメント">セクション13.2.5「IMPORT TABLE ステートメント」</a>を参照してください。 
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictionary-usage-differences"></a>14.7 データディクショナリの使用方法の違い</h2></div></div></div><a class="indexterm" name="idm45547964856384"></a><p>
      データディクショナリが有効な MySQL サーバーの使用には、データディクショナリがないサーバーと比較して、いくつかの操作上の違いがあります:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          以前は、<code class="literal">innodb_read_only</code> システム変数を有効にすると、<code class="literal">InnoDB</code> ストレージエンジンのテーブルの作成および削除のみができなくなりました。 MySQL 8.0 の時点では、<code class="literal">innodb_read_only</code> を有効にすると、すべてのストレージエンジンでこれらの操作が防止されます。 ストレージエンジンのテーブルの作成および削除操作では、<code class="literal">mysql</code> システムデータベース内のデータディクショナリテーブルが変更されますが、これらのテーブルは <code class="literal">InnoDB</code> ストレージエンジンを使用するため、<code class="literal">innodb_read_only</code> が有効になっている場合は変更できません。 データディクショナリテーブルの変更を必要とする他のテーブル操作にも、同じ原則が適用されます。 例: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              データディクショナリに格納されているテーブル統計が更新されるため、<code class="literal">ANALYZE TABLE</code> は失敗します。
            </p></li><li class="listitem"><p>
              データディクショナリに格納されているストレージエンジンの指定が更新されるため、<code class="literal">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENGINE=<em class="replaceable"><code>engine_name</code></em></code> は失敗します。
            </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            <code class="literal">innodb_read_only</code> を有効にすると、<code class="literal">mysql</code> システムデータベースのデータディクショナリ以外のテーブルにも重要な影響があります。 詳細は、<a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="15.14 InnoDB の起動オプションおよびシステム変数">セクション15.14「InnoDB の起動オプションおよびシステム変数」</a> の <code class="literal">innodb_read_only</code> の説明を参照してください 
          </p></div></li><li class="listitem"><p>
          以前は、<code class="literal">mysql</code> システムデータベース内のテーブルは DML ステートメントおよび DDL ステートメントから参照できました。 MySQL 8.0 では、データディクショナリテーブルは非表示であり、直接変更またはクエリーできません。 ただし、ほとんどの場合、かわりにクエリーすることができる対応する <code class="literal">INFORMATION_SCHEMA</code> テーブルがあります。 これにより、アプリケーションで使用する安定した <code class="literal">INFORMATION_SCHEMA</code> インタフェースを維持しながら、基礎となるデータディクショナリテーブルをサーバー開発の進行中に変更できます。 
        </p></li><li class="listitem"><p>
          MySQL 8.0 の <code class="literal">INFORMATION_SCHEMA</code> テーブルはデータディクショナリに密接に関連付けられているため、いくつかの使用方法が異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              以前は、<code class="literal">INFORMATION_SCHEMA</code> は <code class="literal">STATISTICS</code> および <code class="literal">TABLES</code> テーブルのテーブル統計をクエリーして、ストレージエンジンから直接統計を取得していました。 MySQL 8.0 では、キャッシュされたテーブルの統計がデフォルトで使用されます。 <code class="literal">information_schema_stats_expiry</code> システム変数は、キャッシュされたテーブルの統計が期限切れになるまでの期間を定義します。 デフォルトは 86400 秒 (24 時間) です。 (特定のテーブルのキャッシュされた値をいつでも更新するには、<code class="literal">ANALYZE TABLE</code> を使用します。) キャッシュされた統計がない場合、または統計が期限切れになっている場合は、テーブル統計カラムのクエリー時にストレージエンジンから統計が取得されます。 常に最新の統計をストレージエンジンから直接取得するには、<code class="literal">information_schema_stats_expiry</code> を <code class="literal">0</code> に設定します。 詳細は、<a class="xref" href="optimization.html#information-schema-optimization" title="8.2.3 INFORMATION_SCHEMA クエリーの最適化">セクション8.2.3「INFORMATION_SCHEMA クエリーの最適化」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              いくつかの <code class="literal">INFORMATION_SCHEMA</code> テーブルはデータディクショナリテーブルのビューであり、オプティマイザはこれらの基礎となるテーブルでインデックスを使用できます。 したがって、オプティマイザの選択に応じて、<code class="literal">INFORMATION_SCHEMA</code> クエリーの結果の行順序が以前の結果と異なる場合があります。 クエリー結果に特定の行順序付け特性が必要な場合は、<code class="literal">ORDER BY</code> 句を含めます。 
            </p></li><li class="listitem"><p>
              <code class="literal">INFORMATION_SCHEMA</code> テーブルに対するクエリーでは、以前の MySQL シリーズとは異なる大文字と小文字でカラム名が返される場合があります。 アプリケーションでは、大/小文字を区別しない方法で結果セットのカラム名をテストする必要があります。 実行できない場合は、必要な文字のカラム名を返す選択リストでカラムのエイリアスを使用します。 例: 
            </p><pre class="programlisting">SELECT TABLE_SCHEMA AS table_schema, TABLE_NAME AS table_name
FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'users';
</pre></li><li class="listitem"><p>
              <span class="command"><strong>mysqldump</strong></span> および <span class="command"><strong>mysqlpump</strong></span> は、コマンドラインで明示的に指定されていても、<code class="literal">INFORMATION_SCHEMA</code> データベースをダンプしなくなりました。
            </p></li><li class="listitem"><p>
              <code class="literal">CREATE TABLE <em class="replaceable"><code>dst_tbl</code></em> LIKE <em class="replaceable"><code>src_tbl</code></em></code> では、<em class="replaceable"><code>src_tbl</code></em> が実テーブルである必要があり、データディクショナリテーブルのビューである <code class="literal">INFORMATION_SCHEMA</code> テーブルである場合は失敗します。
            </p></li><li class="listitem"><p>
              以前は、<code class="literal">INFORMATION_SCHEMA</code> テーブルから選択されたカラムの結果セットヘッダーでは、クエリーで指定された大/小文字が使用されていました。 このクエリーでは、<code class="literal">table_name</code> のヘッダーを含む結果セットが生成されます: 
            </p><pre class="programlisting">SELECT table_name FROM INFORMATION_SCHEMA.TABLES;
</pre><p>
              MySQL 8.0 では、これらのヘッダーは大文字になります。前述のクエリーでは、<code class="literal">TABLE_NAME</code> のヘッダーを含む結果セットが生成されます。 必要に応じて、カラムのエイリアスを使用して別の大文字と小文字を実現できます。 例: 
            </p><pre class="programlisting">SELECT table_name AS 'table_name' FROM INFORMATION_SCHEMA.TABLES;
</pre></li></ul></div></li><li class="listitem"><p>
          データディレクトリは、<span class="command"><strong>mysqldump</strong></span> および <span class="command"><strong>mysqlpump</strong></span> が <code class="literal">mysql</code> システムデータベースから情報をダンプする方法に影響します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              以前は、<code class="literal">mysql</code> システムデータベース内のすべてのテーブルをダンプできました。 MySQL 8.0 の時点では、<span class="command"><strong>mysqldump</strong></span> および <span class="command"><strong>mysqlpump</strong></span> はそのデータベース内のデータディクショナリ以外のテーブルのみをダンプします。 
            </p></li><li class="listitem"><p>
              以前は、<code class="option">--routines</code> および <code class="option">--events</code> オプションは、<code class="option">--all-databases</code> オプションの使用時にストアドルーチンおよびイベントを含める必要はありませんでした: ダンプには <code class="literal">mysql</code> システムデータベースが含まれていたため、ストアドルーチンおよびイベント定義を含む <code class="literal">proc</code> および <code class="literal">event</code> テーブルも含まれていました。 MySQL 8.0 では、<code class="literal">event</code> テーブルおよび <code class="literal">proc</code> テーブルは使用されません。 対応するオブジェクトの定義はデータディクショナリテーブルに格納されますが、これらのテーブルはダンプされません。 <code class="option">--all-databases</code> を使用して作成されたダンプにストアドルーチンおよびイベントを含めるには、<code class="option">--routines</code> および <code class="option">--events</code> オプションを明示的に使用します。 
            </p></li><li class="listitem"><p>
              以前は、<code class="option">--routines</code> オプションに <code class="literal">proc</code> テーブルに対する <code class="literal">SELECT</code> 権限が必要でした。 MySQL 8.0 では、このテーブルは使用されません。かわりに、<code class="option">--routines</code> にはグローバル <code class="literal">SELECT</code> 権限が必要です。 
            </p></li><li class="listitem"><p>
              以前は、<code class="literal">proc</code> および <code class="literal">event</code> テーブルをダンプすることで、ストアドルーチンおよびイベント定義をそれらの作成および変更タイムスタンプとともにダンプできました。 MySQL 8.0 では、これらのテーブルは使用されないため、タイムスタンプをダンプすることはできません。 
            </p></li></ul></div></li><li class="listitem"><p>
          以前は、不正な文字を含むストアドルーチンを作成すると、警告が生成されました。 MySQL 8.0 では、これはエラーです。 
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictionary-limitations"></a>14.8 データディクショナリの制限事項</h2></div></div></div><a class="indexterm" name="idm45547964771520"></a><p>
      このセクションでは、MySQL データディクショナリで導入された一時的な制限について説明します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          データディレクトリ (<span class="command"><strong>mkdir</strong></span> など) の下でのデータベースディレクトリの手動作成はサポートされていません。 手動で作成されたデータベースディレクトリは、MySQL Server で認識されません。 
        </p></li><li class="listitem"><p>
          <code class="filename">.frm</code> ファイルのかわりに記憶域、undo ログおよび redo ログに書き込むため、DDL 操作に時間がかかります。
        </p></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-statements.html">前</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="innodb-storage-engine.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第 13 章 SQL ステートメント </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 第 15 章 InnoDB ストレージエンジン</td></tr></table></div><div class="copyright-footer"></div></body></html>
