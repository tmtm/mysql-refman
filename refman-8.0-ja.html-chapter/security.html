<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>第 6 章 セキュリティー</title><link rel="stylesheet" type="text/css" href="mvl.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="MySQL 8.0 リファレンスマニュアル"><link rel="up" href="index.html" title="MySQL 8.0 リファレンスマニュアル"><link rel="prev" href="server-administration.html" title="第 5 章 MySQL サーバーの管理"><link rel="next" href="backup-and-recovery.html" title="第 7 章 バックアップとリカバリ"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 6 章 セキュリティー</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="server-administration.html">前</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="backup-and-recovery.html">次へ</a></td></tr></table><hr></div><div class="status-header"><p class="alert">このページは機械翻訳したものです。</p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="security"></a>第 6 章 セキュリティー</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="section"><a href="security.html#general-security-issues">6.1 一般的なセキュリティーの問題</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#security-guidelines">6.1.1 セキュリティーガイドライン</a></span></dt><dt><span class="section"><a href="security.html#password-security">6.1.2 パスワードをセキュアな状態にする</a></span></dt><dt><span class="section"><a href="security.html#security-against-attack">6.1.3 攻撃者に対する MySQL のセキュアな状態の維持</a></span></dt><dt><span class="section"><a href="security.html#security-options">6.1.4 セキュリティー関連の mysqld オプションおよび変数</a></span></dt><dt><span class="section"><a href="security.html#changing-mysql-user">6.1.5 MySQL を通常ユーザーとして実行する方法</a></span></dt><dt><span class="section"><a href="security.html#load-data-local-security">6.1.6 LOAD DATA LOCAL のセキュリティー上の考慮事項</a></span></dt><dt><span class="section"><a href="security.html#secure-client-programming">6.1.7 クライアントプログラミングのセキュリティーガイドライン</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#access-control">6.2 アクセス制御とアカウント管理</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#user-names">6.2.1 アカウントのユーザー名とパスワード</a></span></dt><dt><span class="section"><a href="security.html#privileges-provided">6.2.2 MySQL で提供される権限</a></span></dt><dt><span class="section"><a href="security.html#grant-tables">6.2.3 付与テーブル</a></span></dt><dt><span class="section"><a href="security.html#account-names">6.2.4 アカウント名の指定</a></span></dt><dt><span class="section"><a href="security.html#role-names">6.2.5 ロール名の指定</a></span></dt><dt><span class="section"><a href="security.html#connection-access">6.2.6 アクセス制御、ステージ 1: 接続の検証</a></span></dt><dt><span class="section"><a href="security.html#request-access">6.2.7 アクセス制御、ステージ 2: リクエストの確認</a></span></dt><dt><span class="section"><a href="security.html#creating-accounts">6.2.8 アカウントの追加、権限の割当ておよびアカウントの削除</a></span></dt><dt><span class="section"><a href="security.html#reserved-accounts">6.2.9 予約済アカウント</a></span></dt><dt><span class="section"><a href="security.html#roles">6.2.10 ロールの使用</a></span></dt><dt><span class="section"><a href="security.html#account-categories">6.2.11 アカウントカテゴリ</a></span></dt><dt><span class="section"><a href="security.html#partial-revokes">6.2.12 部分取消しを使用した権限の制限</a></span></dt><dt><span class="section"><a href="security.html#privilege-changes">6.2.13 権限変更が有効化される時期</a></span></dt><dt><span class="section"><a href="security.html#assigning-passwords">6.2.14 アカウントパスワードの割り当て</a></span></dt><dt><span class="section"><a href="security.html#password-management">6.2.15 パスワード管理</a></span></dt><dt><span class="section"><a href="security.html#expired-password-handling">6.2.16 期限切れパスワードのサーバー処理</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication">6.2.17 プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#proxy-users">6.2.18 プロキシユーザー</a></span></dt><dt><span class="section"><a href="security.html#account-locking">6.2.19 アカウントロック</a></span></dt><dt><span class="section"><a href="security.html#user-resources">6.2.20 アカウントリソース制限の設定</a></span></dt><dt><span class="section"><a href="security.html#problems-connecting">6.2.21 MySQL への接続の問題のトラブルシューティング</a></span></dt><dt><span class="section"><a href="security.html#account-activity-auditing">6.2.22 SQL ベースのアカウントアクティビティ監査</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#encrypted-connections">6.3 暗号化された接続の使用</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#using-encrypted-connections">6.3.1 暗号化接続を使用するための MySQL の構成</a></span></dt><dt><span class="section"><a href="security.html#encrypted-connection-protocols-ciphers">6.3.2 暗号化された接続 TLS プロトコルおよび暗号</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-rsa-files">6.3.3 SSL および RSA 証明書とキーの作成</a></span></dt><dt><span class="section"><a href="security.html#windows-and-ssh">6.3.4 SSH を使用した Windows から MySQL へのリモート接続</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#security-plugins">6.4 セキュリティコンポーネントおよびプラグイン</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#authentication-plugins">6.4.1 認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#connection-control">6.4.2 Connection-Control プラグイン</a></span></dt><dt><span class="section"><a href="security.html#validate-password">6.4.3 パスワード検証コンポーネント</a></span></dt><dt><span class="section"><a href="security.html#keyring">6.4.4 MySQL キーリング</a></span></dt><dt><span class="section"><a href="security.html#audit-log">6.4.5 MySQL Enterprise Audit</a></span></dt><dt><span class="section"><a href="security.html#audit-api-message-emit">6.4.6 監査メッセージコンポーネント</a></span></dt><dt><span class="section"><a href="security.html#firewall">6.4.7 MySQL Enterprise Firewall</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#data-masking">6.5 MySQL Enterprise Data Masking and De-Identification</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#data-masking-elements">6.5.1 MySQL Enterprise Data Masking and De-Identification 要素</a></span></dt><dt><span class="section"><a href="security.html#data-masking-installation">6.5.2 MySQL Enterprise Data Masking and De-Identification のインストールまたはアンインストール</a></span></dt><dt><span class="section"><a href="security.html#data-masking-usage">6.5.3 MySQL Enterprise Data Masking and De-Identification の使用</a></span></dt><dt><span class="section"><a href="security.html#data-masking-function-reference">6.5.4 MySQL Enterprise Data Masking and De-Identification ユーザー定義関数リファレンス</a></span></dt><dt><span class="section"><a href="security.html#data-masking-functions">6.5.5 MySQL Enterprise Data Masking and De-Identification ユーザー定義関数の説明</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#enterprise-encryption">6.6 MySQL Enterprise Encryption</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#enterprise-encryption-installation">6.6.1 MySQL Enterprise Encryption のインストール</a></span></dt><dt><span class="section"><a href="security.html#enterprise-encryption-usage">6.6.2 MySQL Enterprise Encryption の使用方法と例</a></span></dt><dt><span class="section"><a href="security.html#enterprise-encryption-function-reference">6.6.3 MySQL Enterprise Encryption ユーザー定義関数リファレンス</a></span></dt><dt><span class="section"><a href="security.html#enterprise-encryption-functions">6.6.4 MySQL Enterprise Encryption ユーザー定義関数の説明</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#selinux">6.7 SELinux</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#selinux-checking">6.7.1 SELinux が有効かどうかの確認</a></span></dt><dt><span class="section"><a href="security.html#selinux-mode">6.7.2 SELinux モードの変更</a></span></dt><dt><span class="section"><a href="security.html#selinux-policies">6.7.3 MySQL Server SELinux ポリシー</a></span></dt><dt><span class="section"><a href="security.html#selinux-file-context">6.7.4 SELinux ファイルコンテキスト</a></span></dt><dt><span class="section"><a href="security.html#selinux-context-tcp-port">6.7.5 SELinux TCP ポートコンテキスト</a></span></dt><dt><span class="section"><a href="security.html#selinux-troubleshooting">6.7.6 SELinux のトラブルシューティング</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#fips-mode">6.8 FIPS のサポート</a></span></dt></dl></div><p>
    MySQL インストール内のセキュリティーについて検討するときは、可能性のあるさまざまなトピックについて考慮し、それらが MySQL サーバーおよび関連するアプリケーションのセキュリティーに及ぼす影響について考慮するようにしてください。
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        セキュリティーに影響する一般的な要因。 これらには、適切なパスワードの選択、不要な権限をユーザーに付与しないこと、SQL インジェクションおよびデータ損失を防ぐことによるアプリケーションセキュリティーの確保などが含まれます。 <a class="xref" href="security.html#general-security-issues" title="6.1 一般的なセキュリティーの問題">セクション6.1「一般的なセキュリティーの問題」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        インストール自体のセキュリティー。 インストールにおけるデータファイル、ログファイル、およびすべてのアプリケーションファイルを保護することで、許可のない人物による読み取りまたは書き込みができないようにします。 詳細については、<a class="xref" href="installing.html#postinstallation" title="2.10 インストール後のセットアップとテスト">セクション2.10「インストール後のセットアップとテスト」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        データベースおよびデータベース内で使用中のビューおよびストアドプログラムへのアクセス権限を付与されたユーザーおよびデータベースを含む、データベースシステム自体の内部におけるアクセス制御およびセキュリティー。 詳細は、<a class="xref" href="security.html#access-control" title="6.2 アクセス制御とアカウント管理">セクション6.2「アクセス制御とアカウント管理」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        セキュリティー関連のプラグインによって提供される機能。 <a class="xref" href="security.html#security-plugins" title="6.4 セキュリティコンポーネントおよびプラグイン">セクション6.4「セキュリティコンポーネントおよびプラグイン」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        MySQL およびシステムのネットワークセキュリティー。 セキュリティーは個々のユーザーに対する権限付与に関係しますが、MySQL が、MySQL サーバーホスト上でローカルからのみ利用できるか、限定されたほかのホストのセットについてのみ利用できるように MySQL を制限したい場合もあります。 
      </p></li><li class="listitem"><p>
        データベースファイル、構成、およびログファイルの十分かつ適切なバックアップを用意します。 また、リカバリソリューションを用意するようにし、バックアップから情報を正しくリカバリできることをテストしてください。 <a class="xref" href="backup-and-recovery.html" title="第 7 章 バックアップとリカバリ">第7章「<i>バックアップとリカバリ</i>」</a>を参照してください。 
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="general-security-issues"></a>6.1 一般的なセキュリティーの問題</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#security-guidelines">6.1.1 セキュリティーガイドライン</a></span></dt><dt><span class="section"><a href="security.html#password-security">6.1.2 パスワードをセキュアな状態にする</a></span></dt><dt><span class="section"><a href="security.html#security-against-attack">6.1.3 攻撃者に対する MySQL のセキュアな状態の維持</a></span></dt><dt><span class="section"><a href="security.html#security-options">6.1.4 セキュリティー関連の mysqld オプションおよび変数</a></span></dt><dt><span class="section"><a href="security.html#changing-mysql-user">6.1.5 MySQL を通常ユーザーとして実行する方法</a></span></dt><dt><span class="section"><a href="security.html#load-data-local-security">6.1.6 LOAD DATA LOCAL のセキュリティー上の考慮事項</a></span></dt><dt><span class="section"><a href="security.html#secure-client-programming">6.1.7 クライアントプログラミングのセキュリティーガイドライン</a></span></dt></dl></div><a class="indexterm" name="idm46723766650528"></a><p>
    このセクションでは、留意するべき一般的なセキュリティーの問題と、攻撃または悪用に対して MySQL インストールをさらにセキュアな状態にするために実行可能なアクションについて説明します。 ユーザーアカウントのセットアップおよびデータベースアクセスの検査のために MySQL が使用するアクセス制御システムについての詳細は、<a class="xref" href="installing.html#postinstallation" title="2.10 インストール後のセットアップとテスト">セクション2.10「インストール後のセットアップとテスト」</a>を参照してください。 
  </p><p>
    MySQL Server のセキュリティーの問題について、よくある質問のうちのいくつかに対する回答は、<a class="xref" href="faqs.html#faqs-security" title="A.9 MySQL 8.0 FAQ: セキュリティー">セクションA.9「MySQL 8.0 FAQ: セキュリティー」</a>を参照してください。
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-guidelines"></a>6.1.1 セキュリティーガイドライン</h3></div></div></div><a class="indexterm" name="idm46723766644144"></a><a class="indexterm" name="idm46723766642720"></a><p>
      インターネットに接続したコンピュータ上で MySQL を使用するすべてのユーザーは、セキュリティーに関するもっとも一般的な間違いを回避するために、このセクションを読むようにしてください。
    </p><p>
      セキュリティーについて検討する際、該当するすべての種類の攻撃 (盗聴、改変、プレイバック、およびサービス妨害) から、(MySQL サーバーだけでなく) サーバーホスト全体を完全に保護することを考慮する必要があります。 ここでは可用性およびフォールトトレランスのすべての側面について扱うことはしません。 
    </p><p>
      MySQL では、ユーザーが実行を試行できるすべての接続、クエリー、およびその他の操作に対して、アクセス制御リスト (ACL) に基づくセキュリティーが使用されています。 また、MySQL クライアントとサーバーの間で SSL に対応した接続のサポートもあります。 ここで説明されている多くの概念は MySQL に固有のものではなく、同じような一般的な考え方は、ほぼすべてのアプリケーションに該当します。 
    </p><p>
      MySQL を実行するときは、次のガイドラインに従ってください。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">mysql</code> システムデータベースの <code class="literal">user</code> テーブルへのアクセス権を (MySQL <code class="literal">root</code> アカウントを除く) ユーザーに付与しないでください。</strong></span> これはきわめて重要です。 
        </p></li><li class="listitem"><p>
          MySQL アクセス権限システムのしくみについて学習してください (<a class="xref" href="security.html#access-control" title="6.2 アクセス制御とアカウント管理">セクション6.2「アクセス制御とアカウント管理」</a>を参照してください)。 MySQL へのアクセスを制御するには、<code class="literal">GRANT</code> および <code class="literal">REVOKE</code> ステートメントを使用します。 必要以上の権限を付与しないでください。 すべてのホストに権限を付与してはいけません。 
        </p><p>
          チェックリスト:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">mysql -u root</code> を試してください。 パスワードを尋ねられずにサーバーへの接続に成功する場合、すべてのユーザーが、完全な権限を持つ MySQL <code class="literal">root</code> ユーザーとして MySQL サーバーに接続できます。 <code class="literal">root</code> パスワードの設定に関する情報に特に注意して、MySQL インストール手順を見直してください。 <a class="xref" href="installing.html#default-privileges" title="2.10.4 初期 MySQL アカウントの保護">セクション2.10.4「初期 MySQL アカウントの保護」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">SHOW GRANTS</code> ステートメントを使用して、どのアカウントが何にアクセスできるかをチェックします。 <code class="literal">REVOKE</code> ステートメントを使用して、不要な権限を削除します。 
            </p></li></ul></div></li><li class="listitem"><p>
          平文パスワードをデータベースに保管しないでください。 コンピュータのセキュリティーが損なわれた場合、侵入者はすべてのパスワードのリストを取得して使用することができます。 かわりに、<code class="literal">SHA2()</code> またはその他の一方向ハッシュ関数を使用してハッシュ値を格納します。 
        </p><p>
          レインボーテーブルを使用したパスワードのリカバリを避けるために、これらの関数をプレーンテキストパスワードに使用しないようにしてください。代わりに、ソルトとして使用する何らかの文字列を選択して、hash(hash(パスワード)+ソルト) 値を使用してください。
        </p></li><li class="listitem"><p>
          辞書からパスワードを選択しないでください。 パスワードを解読する特殊なプログラムが存在します。 <span class="quote">「<span class="quote">xfish98</span>」</span> のようなパスワードでさえも、非常に悪いものです。 同じ <span class="quote">「<span class="quote">fish</span>」</span> という単語を、標準 QWERTY キーボードでキー 1 個分左にずらしてタイプした <span class="quote">「<span class="quote">duag98</span>」</span> の方が、ずっと優れています。 別の方法は、文の各単語の先頭文字を取ったパスワードを使用することです (たとえば、<span class="quote">「<span class="quote">Four score and seven years ago</span>」</span> からは <span class="quote">「<span class="quote">Fsasya</span>」</span> というパスワードができます)。 パスワードは覚えやすく入力も簡単ですが、文を知らない人は推測が困難です。 この事例で、数字を示す単語をさらに数値に置き換えて <span class="quote">「<span class="quote">4 score and 7 years ago</span>」</span> という句を作成し、<span class="quote">「<span class="quote">4sa7ya</span>」</span> というさらに推測困難なパスワードを得ることができます。 
        </p></li><li class="listitem"><p>
          ファイアウォールに投資します。 これにより、あらゆる種類のソフトウェアの悪用のうち、少なくとも 50% から保護されます。 MySQL をファイアウォールの背後または非武装地帯 (DMZ) に配置します。 
        </p><p>
          チェックリスト:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">nmap</code> などのツールを使用して、インターネットから自分のポートをスキャンしてみてください。 MySQL はデフォルトでポート 3306 を使用します。 このポートは信頼できないホストからアクセス可能であってはいけません。 MySQL ポートが開いているかどうかを検査する簡単な方法として、いずれかのリモートマシンから次のコマンドを試行します。ここで、<em class="replaceable"><code>server_host</code></em> は MySQL サーバーが実行しているホストのホスト名または IP アドレスです。 
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>telnet <em class="replaceable"><code>server_host</code></em> 3306</code></strong>
</pre><p>
              <span class="command"><strong>telnet</strong></span> がハングするか、接続が拒否されれば、ポートはブロックされており、これは期待どおりの結果です。 接続を取得して、何らかの文字化けした文字が得られた場合、ポートは開いているため、ポートを開いたままにしておく十分な理由が実際にある場合を除き、ファイアウォールまたはルーターで閉じるようにしてください。 
            </p></li></ul></div></li><li class="listitem"><p>
          MySQL にアクセスするアプリケーションは、ユーザーから入力されるすべてのデータを信頼しないようにし、適切な防御的プログラミング技術を使用して記述するようにします。 <a class="xref" href="security.html#secure-client-programming" title="6.1.7 クライアントプログラミングのセキュリティーガイドライン">セクション6.1.7「クライアントプログラミングのセキュリティーガイドライン」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          プレーンの (暗号化されていない) データをインターネット経由で送信しないでください。 この情報は、情報を傍受する時間と能力を持ち、自身の目的のために情報を使用するすべての人物からアクセスできます。 代わりに、SSL や SSH などの暗号化されたプロトコルを使用してください。 MySQL は、内部 SSL 接続をサポートします。 別の技術として、SSH ポートフォワーディングを使用して、暗号化された (および圧縮された) 通信用トンネルを作成する方法があります。 
        </p></li><li class="listitem"><p>
          <span class="command"><strong>tcpdump</strong></span> や <span class="command"><strong>strings</strong></span> などのユーティリティーの使用法について学習します。 ほとんどの場合、次のようなコマンドを発行することによって、MySQL データストリームが暗号化されていない状態であるかどうかを検査できます。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>tcpdump -l -i eth0 -w - src or dst port 3306 | strings</code></strong>
</pre><p>
          これは Linux で動作するほか、ほかのシステムでもわずかな変更を行うことで動作するはずです。
        </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
            平文データが表示されない場合、これは情報が実際に暗号化されていることを必ずしも意味しているわけではありません。 セキュリティーを強化する必要がある場合、セキュリティーの専門家に相談してください。 
          </p></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="password-security"></a>6.1.2 パスワードをセキュアな状態にする</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#password-security-user">6.1.2.1 パスワードセキュリティーのためのエンドユーザーガイドライン</a></span></dt><dt><span class="section"><a href="security.html#password-security-admin">6.1.2.2 パスワードセキュリティーについての管理者ガイドライン</a></span></dt><dt><span class="section"><a href="security.html#password-logging">6.1.2.3 パスワードおよびロギング</a></span></dt></dl></div><a class="indexterm" name="idm46723766591280"></a><p>
      パスワードは MySQL のいくつかのコンテキストで現れます。 次のセクションでは、エンドユーザーおよび管理者がこれらのパスワードをセキュアな状態にし、公開しないようにするためのガイドラインを提供します。 また、<code class="literal">validate_password</code> プラグインを使用して、許容可能なパスワードにポリシーを適用できます。 <a class="xref" href="security.html#validate-password" title="6.4.3 パスワード検証コンポーネント">セクション6.4.3「パスワード検証コンポーネント」</a>を参照してください。 
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="password-security-user"></a>6.1.2.1 パスワードセキュリティーのためのエンドユーザーガイドライン</h4></div></div></div><a class="indexterm" name="idm46723766585536"></a><p>
        MySQL ユーザーは、パスワードをセキュアな状態にするために次のガイドラインを使用することをお勧めします。
      </p><p>
        クライアントプログラムを実行して MySQL サーバーに接続する場合、ほかのユーザーからの検出によって公開されるような方法でパスワードを指定することはお勧めできません。 クライアントプログラムを実行するときにパスワードを指定するために使用できる方法と、それぞれの方法のリスクの評価について、次の一覧で示します。 簡単に言えば、もっとも安全な方法は、クライアントプログラムがパスワードを求めるプロンプトを出すようにするか、適切に保護されたオプションファイルにパスワードを指定する方法です。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="command"><strong>mysql_config_editor</strong></span> ユーティリティを使用すると、<code class="filename">.mylogin.cnf</code> という名前の暗号化されたログインパスファイルに認証資格証明を格納できます。 このファイルは、MySQL Server に接続するための認証情報を取得するために、MySQL クライアントプログラムによってあとで読み取ることができます。 <a class="xref" href="programs.html#mysql-config-editor" title="4.6.7 mysql_config_editor — MySQL 構成ユーティリティー">セクション4.6.7「mysql_config_editor — MySQL 構成ユーティリティー」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm46723853168080"></a> <a class="indexterm" name="idm46723853166608"></a>コマンドラインで <code class="option">--password=<em class="replaceable"><code>password</code></em></code> または <code class="option">-p<em class="replaceable"><code>password</code></em></code> オプションを使用します。 例: 
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u francis -pfrank <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
              これは便利ですが<span class="emphasis"><em>セキュアではありません</em></span>。 一部のシステムでは、使用しているパスワードが、コマンド行を表示するためにほかのユーザーによって起動できる <span class="command"><strong>ps</strong></span> などのシステムステータスプログラムによって表示可能になります。 MySQL クライアントは通常、クライアントの初期化シーケンス中にコマンド行パスワード引数をゼロで上書きします。 ただし、まだ値が表示可能な短い期間があります。 また、一部のシステムではこの上書きの方法には効果がなく、パスワードは <span class="command"><strong>ps</strong></span> から表示可能になったままになります。 (SystemV Unix システムおよびおそらくほかのシステムでもこの問題の影響があります。) 
            </p></div><p>
            ターミナルウィンドウのタイトルバーに現在のコマンドを表示するようにオペレーティング環境がセットアップされている場合、コマンドがウィンドウのコンテンツ領域からスクロールアウトされて表示されなくなっても、コマンドが実行中であるかぎりパスワードが表示されたままになります。
          </p></li><li class="listitem"><p>
            パスワード値を指定せずに、コマンドラインで <code class="option">--password</code> または <code class="option">-p</code> オプションを使用します。 この場合、クライアントプログラムはパスワードを対話的に要求します。 
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u francis -p <em class="replaceable"><code>db_name</code></em></code></strong>
Enter password: ********
</pre><p>
            <code class="literal">*</code> 文字はパスワードを入力したことを示しています。 パスワードは入力時に表示されません。 
          </p><p>
            この方法でパスワードを入力する方が、コマンド行でパスワードを指定するよりもセキュアです。これは、パスワードがほかのユーザーに表示されないためです。 ただし、このパスワード入力方法は、対話的に実行するプログラムについてのみ適しています。 非対話的に実行するスクリプトからクライアントを呼び出す場合、キーボードからパスワードを入力する機会はありません。 一部のシステムでは、スクリプトの 1 行目が (誤って) パスワードとして読み取られて解釈されることすらあります。 
          </p></li><li class="listitem"><p>
            パスワードをオプションファイルに格納します。 たとえば Unix の場合、ホームディレクトリの <code class="filename">.my.cnf</code> ファイルの <code class="literal">[client]</code> セクションにパスワードを一覧表示することができます。 
          </p><a class="indexterm" name="idm46723766538736"></a><a class="indexterm" name="idm46723766537216"></a><pre class="programlisting">[client]
password=<em class="replaceable"><code>password</code></em>
</pre><p>
            パスワードを安全に保持するには、自分以外のすべてのユーザーからファイルにアクセス可能にしてはいけません。 このようにするには、ファイルのアクセスモードを <code class="literal">400</code> または <code class="literal">600</code> に設定します。 例: 
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>chmod 600 .my.cnf</code></strong>
</pre><p>
            パスワードを格納する特定のオプションファイルをコマンド行から指定するには、<code class="option">--defaults-file=<em class="replaceable"><code>file_name</code></em></code> オプションを使用します。ここで <code class="filename">file_name</code> はファイルへのフルパス名です。 例: 
          </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --defaults-file=/home/francis/mysql-opts</code></strong>
</pre><p>
            <a class="xref" href="programs.html#option-files" title="4.2.2.2 オプションファイルの使用">セクション4.2.2.2「オプションファイルの使用」</a>には、オプションファイルについてさらに詳しく記載されています。
          </p></li></ul></div><a class="indexterm" name="idm46723766524256"></a><p>
        Unix の場合、<span class="command"><strong>mysql</strong></span> クライアントは実行済みステートメントを履歴ファイルに書き込みます (<a class="xref" href="programs.html#mysql-logging" title="4.5.1.3 mysql クライアントロギング">セクション4.5.1.3「mysql クライアントロギング」</a>を参照してください)。 デフォルトでは、このファイルは <code class="filename">.mysql_history</code> という名前で、ユーザーのホームディレクトリに作成されます。 パスワードは、<code class="literal">CREATE USER</code> や <code class="literal">ALTER USER</code> などの SQL ステートメントにプレーンテキストで記述できるため、これらのステートメントを使用すると、履歴ファイルに記録されます。 このファイルを安全に保持するには、以前 <code class="filename">.my.cnf</code> ファイルについて説明したのと同じ方法である制限アクセスモードを使用します。 
      </p><p>
        コマンドインタプリタで履歴が保持されている場合、コマンドが保存されるすべてのファイルには、コマンドラインで入力された MySQL パスワードが含まれます。 たとえば、<span class="command"><strong>bash</strong></span> は <code class="filename">~/.bash_history</code> を使用します。 そのようなすべてのファイルは、制限アクセスモードにするようにしてください。 
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="password-security-admin"></a>6.1.2.2 パスワードセキュリティーについての管理者ガイドライン</h4></div></div></div><a class="indexterm" name="idm46723766512512"></a><p>
        データベース管理者は、パスワードをセキュアな状態にするための次のガイドラインを使用するようにしてください。
      </p><p>
        MySQL は、ユーザーアカウントのパスワードを <code class="literal">mysql.user</code> システムテーブルに格納します。 このテーブルへのアクセス権を、管理者以外のすべてのアカウントに決して付与しないでください。 
      </p><p>
        アカウントパスワードは期限切れとなることがあり、ユーザーはそれらをリセットする必要があります。 <a class="xref" href="security.html#password-management" title="6.2.15 パスワード管理">セクション6.2.15「パスワード管理」</a>および<a class="xref" href="security.html#expired-password-handling" title="6.2.16 期限切れパスワードのサーバー処理">セクション6.2.16「期限切れパスワードのサーバー処理」</a>を参照してください。 
      </p><p>
        <code class="literal">validate_password</code> プラグインを使用して、許容可能なパスワードについてのポリシーを強制することができます。 <a class="xref" href="security.html#validate-password" title="6.4.3 パスワード検証コンポーネント">セクション6.4.3「パスワード検証コンポーネント」</a>を参照してください。 
      </p><p>
        プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数の値) を変更するためのアクセス権を持つユーザー、またはプラグインディレクトリの場所を指定する <code class="filename">my.cnf</code> ファイルは、プラグインを置き換えたり、認証プラグインを含むプラグインによって提供される機能を変更したりできます。
      </p><p>
        パスワードが書き込まれる可能性があるログファイルなどのファイルを保護するようにしてください。 <a class="xref" href="security.html#password-logging" title="6.1.2.3 パスワードおよびロギング">セクション6.1.2.3「パスワードおよびロギング」</a>を参照してください。 
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="password-logging"></a>6.1.2.3 パスワードおよびロギング</h4></div></div></div><a class="indexterm" name="idm46723766498512"></a><a class="indexterm" name="idm46723766496400"></a><p>
        パスワードは、<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">SET PASSWORD</code> などの SQL ステートメントでプレーンテキストとして記述できます。 このようなステートメントが書き込まれたとおりに MySQL サーバーによってログに記録された場合、それらの中のパスワードは、ログへのアクセス権を持つすべてのユーザーに表示されます。 
      </p><p>
        ステートメントロギングでは、次のステートメントのクリアテキストとしてパスワードを書き込まないようにします:
      </p><pre class="programlisting">CREATE USER ... IDENTIFIED BY ...
ALTER USER ... IDENTIFIED BY ...
SET PASSWORD ...
START SLAVE ... PASSWORD = ...
START REPLICA ... PASSWORD = ...
CREATE SERVER ... OPTIONS(... PASSWORD ...)
ALTER SERVER ... OPTIONS(... PASSWORD ...)
</pre><p>
        これらのステートメントのパスワードは、一般クエリーログ、スロークエリーログ、およびバイナリログに書き込まれたステートメントテキストに文字どおりに表示されないように書き換えられます。 ほかのステートメントについては書き換えが適用されません。 特に、リテラルパスワードを参照する <code class="literal">mysql.user</code> システムテーブルの <code class="literal">INSERT</code> ステートメントまたは <code class="literal">UPDATE</code> ステートメントはそのままログに記録されるため、このようなステートメントは避けてください。 (付与テーブルを直接変更することはお勧めしません。) 
      </p><p>
        一般クエリーログの場合、パスワードの書き換えは、<code class="option">--log-raw</code> オプションを使用してサーバーを起動することによって抑制することができます。 セキュリティ上の理由から、このオプションは本番での使用にはお薦めできません。 診断のために、サーバーで受信されたステートメントの正確なテキストを確認すると役立つ場合があります。 
      </p><p>
        デフォルトでは、監査ログプラグインによって生成される監査ログファイルの内容は暗号化されず、SQL ステートメントのテキストなどの機密情報が含まれることがあります。 セキュリティ上の理由から、監査ログファイルは、MySQL サーバーおよびログを表示する正当な理由を持つユーザーのみがアクセスできるディレクトリに書き込む必要があります。 <a class="xref" href="security.html#audit-log-security" title="6.4.5.3 MySQL Enterprise Audit のセキュリティに関する考慮事項">セクション6.4.5.3「MySQL Enterprise Audit のセキュリティに関する考慮事項」</a>を参照してください。 
      </p><p>
        クエリーリライトプラグインがインストールされている場合は、サーバーが受信したステートメントがリライトされることがあります (<a class="ulink" href="https://dev.mysql.com/doc/extending-mysql/8.0/en/plugin-types.html#query-rewrite-plugin-type" target="_top">Query Rewrite Plugins</a> を参照)。 この場合、<code class="option">--log-raw</code> オプションは次のようにステートメントロギングに影響します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="option">--log-raw</code> がない場合、サーバーはクエリーリライトプラグインによって返されたステートメントをログに記録します。 これは、受け取ったステートメントとは異なる場合があります。 
          </p></li><li class="listitem"><p>
            <code class="option">--log-raw</code> では、サーバーは元のステートメントを受信したとおりにログに記録します。
          </p></li></ul></div><p>
        パスワードの書き換えの影響は、解析できないステートメント (構文エラーなど) はパスワードがないことがわかっていないため、一般クエリーログに書き込まれないことです。 エラーが発生したステートメントを含むすべてのステートメントのロギングが必要なユースケースでは、<code class="option">--log-raw</code> オプションを使用する必要があります。これにより、パスワードのリライトもバイパスされることに注意してください。 
      </p><p>
        パスワードの書き換えは、プレーンテキストパスワードが必要な場合にのみ行われます。 パスワードハッシュ値を想定する構文を持つステートメントの場合、書き換えは行われません。 このような構文に対してプレーンテキストパスワードが誤って指定された場合、パスワードはリライトなしで指定されたとおりにログに記録されます。 
      </p><p>
        保証されていない公開からログファイルを保護するには、サーバーおよびデータベース管理者へのアクセスを制限するディレクトリ内でログファイルを見つけます。 サーバーが <code class="literal">mysql</code> データベース内のテーブルにログを記録する場合は、それらのテーブルへのアクセス権をデータベース管理者にのみ付与します。 
      </p><p>
        レプリカは、レプリケーションソースサーバーのパスワードを接続メタデータリポジトリ (デフォルトでは、<code class="literal">slave_master_info</code> という名前の <code class="literal">mysql</code> データベースのテーブル) に格納します。 接続メタデータリポジトリのデータディレクトリでのファイルの使用は非推奨になりましたが、引き続き可能です (<a class="xref" href="replication.html#replica-logs" title="17.2.4 リレーログおよびレプリケーションメタデータリポジトリ">セクション17.2.4「リレーログおよびレプリケーションメタデータリポジトリ」</a> を参照)。 データベース管理者のみが接続メタデータリポジトリにアクセスできることを確認します。 接続メタデータリポジトリにパスワードを格納するかわりに、<code class="literal">START REPLICA | SLAVE</code> ステートメントまたは <code class="literal">START GROUP_REPLICATION</code> ステートメントを使用して、ソースに接続するための資格証明を指定することもできます。 
      </p><p>
        制限付きアクセスモードを使用して、パスワードを含むログテーブルまたはログファイルを含むデータベースバックアップを保護します。
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-against-attack"></a>6.1.3 攻撃者に対する MySQL のセキュアな状態の維持</h3></div></div></div><a class="indexterm" name="idm46723766460352"></a><a class="indexterm" name="idm46723766458240"></a><a class="indexterm" name="idm46723766456192"></a><a class="indexterm" name="idm46723766454960"></a><a class="indexterm" name="idm46723766453632"></a><p>
      MySQL サーバーに接続するときは、パスワードを使用するようにしてください。 パスワードはクリアテキストとして接続経由で送信されません。 
    </p><p>
      ほかのすべての情報はテキストとして送信され、接続を観察できるすべてのユーザーによって読み取ることができます。 クライアントとサーバーの間の接続が、信頼できないネットワークを介して行われ、そのことに不安がある場合、圧縮されたプロトコルを使用して、トラフィックの解読をさらに困難にすることができます。 また、MySQL の内部 SSL サポートを使用して、接続をさらにセキュアな状態にすることもできます。 <a class="xref" href="security.html#encrypted-connections" title="6.3 暗号化された接続の使用">セクション6.3「暗号化された接続の使用」</a>を参照してください。 または SSH を使用して、MySQL サーバーと MySQL クライアントの間で暗号化された TCP/IP 接続を実現します。 オープンソース SSH クライアントは <a class="ulink" href="http://www.openssh.org/" target="_top">http://www.openssh.org/</a> から見つけることができ、オープンソースと商用の SSH クライアントの比較は <a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</a> にあります。 
    </p><p>
      MySQL システムをセキュアな状態にするには、次の推奨事項についてよく検討するようにしてください。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          すべての MySQL アカウントがパスワードを持つことを要求します。 クライアントプログラムは、それを実行中の人物の ID を必ずしも認識しているわけではありません。 クライアント/サーバーアプリケーションでは、ユーザーがクライアントプログラムに任意のユーザー名を指定できることが一般的です。 たとえば、<em class="replaceable"><code>other_user</code></em> にパスワードがない場合、<span class="command"><strong>mysql</strong></span> プログラムを <code class="literal">mysql -u <em class="replaceable"><code>other_user</code></em> <em class="replaceable"><code>db_name</code></em></code> として呼び出すことによって、すべてのユーザーがこのプログラムを使用してほかのユーザーとして接続することができます。 すべてのアカウントにパスワードがある場合、ほかのユーザーのアカウントを使用した接続は、もっと難しくなります。 
        </p><p>
          パスワードの設定方法についての説明は、<a class="xref" href="security.html#assigning-passwords" title="6.2.14 アカウントパスワードの割り当て">セクション6.2.14「アカウントパスワードの割り当て」</a>を参照してください。
        </p></li><li class="listitem"><p>
          データベースディレクトリ内の読み取りまたは書き込み権限を持つ Unix ユーザーアカウントのみが、<span class="command"><strong>mysqld</strong></span> の実行に使用されるアカウントであるようにしてください。
        </p></li><li class="listitem"><p>
          MySQL サーバーを Unix <code class="literal">root</code> ユーザーとして絶対に実行しないでください。 これを行うと、<code class="literal">FILE</code> 権限を持つすべてのユーザーが、<code class="literal">root</code> としてサーバーにファイルを作成させることができるため (<code class="literal">~root/.bashrc</code> など)、非常に危険です。 これを防ぐために、<span class="command"><strong>mysqld</strong></span> は <code class="option">--user=root</code> オプションを使用して明示的に指定された場合を除き、<code class="literal">root</code> として実行することを拒否します。 
        </p><p>
          <span class="command"><strong>mysqld</strong></span> は、権限のない普通のユーザーとしても実行できます (また、そのように実行するべきです)。 <code class="literal">mysql</code> という名前の別の Unix アカウントを作成して、すべてをさらにセキュアな状態にすることができます。 このアカウントは、MySQL の管理にのみ使用してください。 <span class="command"><strong>mysqld</strong></span> を別の Unix ユーザーとして開始するには、サーバーオプションを指定した <code class="filename">my.cnf</code> オプションファイルの <code class="literal">[mysqld]</code> グループ内のユーザー名を指定する <code class="literal">user</code> オプションを追加します。 例: 
        </p><pre class="programlisting">[mysqld]
user=mysql
</pre><p>
          これにより、サーバーを手動で起動した場合も、<span class="command"><strong>mysqld_safe</strong></span> または <span class="command"><strong>mysql.server</strong></span> を使用して起動した場合も、指定のユーザーでサーバーが起動します。 詳細は、<a class="xref" href="security.html#changing-mysql-user" title="6.1.5 MySQL を通常ユーザーとして実行する方法">セクション6.1.5「MySQL を通常ユーザーとして実行する方法」</a>を参照してください。 
        </p><p>
          <code class="literal">root</code> 以外の Unix ユーザーとして <span class="command"><strong>mysqld</strong></span> を実行しても、<code class="literal">user</code> テーブル内の <code class="literal">root</code> ユーザー名を変更する必要があるということを意味するわけではありません。 <span class="emphasis"><em>MySQL アカウントのユーザー名は、Unix アカウントのユーザー名とは何の関係もありません</em></span>。 
        </p></li><li class="listitem"><p>
          管理者以外のユーザーに <code class="literal">FILE</code> 権限を付与しないでください。 この権限を持つすべてのユーザーは、<span class="command"><strong>mysqld</strong></span> デーモンの権限で、ファイルシステムのあらゆる場所のファイルに書き込むことができます。 これは、権限テーブルを実装するファイルを格納するサーバーのデータディレクトリを含みます。 <code class="literal">FILE</code> 権限の操作をもう少し安全にするために、<code class="literal">SELECT ... INTO OUTFILE</code> で生成されたファイルは既存のファイルを上書きせず、すべてのユーザーによって書き込み可能になります。 
        </p><a class="indexterm" name="idm46723766412592"></a><p>
          <code class="literal">FILE</code> 権限は、すべてのユーザーが読み取り可能であるか、サーバーを実行している Unix ユーザーがアクセスできる、すべてのファイルを読み取る場合にも使用できます。 この権限を使用して、すべてのファイルをデータベーステーブルに読み取ることができます。 これは不正使用される可能性があり、たとえば <code class="literal">LOAD DATA</code> を使用して <code class="filename">/etc/passwd</code> をテーブルにロードし、次に <code class="literal">SELECT</code> を使用してこれを表示することができます。 
        </p><p>
          ファイルを読み取りおよび書き込みできる場所を制限するには、<code class="literal">secure_file_priv</code> システムを特定のディレクトリに設定します。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          バイナリログファイルとリレーログファイルを暗号化します。 暗号化を使用すると、これらのファイルおよびそのファイルに含まれる機密データを、外部の攻撃者による誤用や、ファイルが格納されているオペレーティングシステムのユーザーによる不正な表示から保護できます。 MySQL サーバーで暗号化を有効にするには、<code class="literal">binlog_encryption</code> システム変数を <code class="literal">ON</code> に設定します。 詳細は、<a class="xref" href="replication.html#replication-binlog-encryption" title="17.3.2 バイナリログファイルとリレーログファイルの暗号化">セクション17.3.2「バイナリログファイルとリレーログファイルの暗号化」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          管理者以外のユーザーに <code class="literal">PROCESS</code> または <code class="literal">SUPER</code> 権限を付与しないでください。 <span class="command"><strong>mysqladmin processlist</strong></span> および <code class="literal">SHOW PROCESSLIST</code> の出力には、現在実行されているステートメントのテキストが表示されるため、サーバープロセスリストの表示を許可されているユーザーは、ほかのユーザーによって発行されたステートメントを表示できます。 
        </p><p>
          <span class="command"><strong>mysqld</strong></span> は、<code class="literal">CONNECTION_ADMIN</code> または <code class="literal">SUPER</code> 権限を持つユーザーに対して追加の接続を予約するため、MySQL <code class="literal">root</code> ユーザーは、通常の接続がすべて使用されている場合でも、ログインしてサーバーアクティビティを確認できます。
        </p><p>
          <code class="literal">SUPER</code> 権限は、クライアント接続を終了したり、システム変数の値を変更することによってサーバー操作を変更したり、レプリケーションサーバーを制御したりするために使用することができます。
        </p></li><li class="listitem"><p>
          テーブルへのシンボリックリンクを許可しないでください。 (この機能は <code class="option">--skip-symbolic-links</code> オプションで無効にできます。) このことは、<span class="command"><strong>mysqld</strong></span> を <code class="literal">root</code> として実行する場合に特に重要です。これは、サーバーのデータディレクトリへの書き込みアクセス権限があるすべてのユーザーは、システムのすべてのファイルを削除できることになるためです。 <a class="xref" href="optimization.html#symbolic-links-to-tables" title="8.12.2.2 Unix 上の MyISAM へのシンボリックリンクの使用">セクション8.12.2.2「Unix 上の MyISAM へのシンボリックリンクの使用」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          ストアドプログラムおよびビューは、<a class="xref" href="stored-objects.html#stored-objects-security" title="25.6 ストアドオブジェクトのアクセス制御">セクション25.6「ストアドオブジェクトのアクセス制御」</a>に記載されているセキュリティーガイドラインを使用して記述するようにしてください。
        </p></li><li class="listitem"><p>
          DNS を信頼していない場合、付与テーブル内でホスト名の代わりに IP アドレスを使用するようにしてください。 いずれの場合も、ワイルドカードを含むホスト名の値を使用して付与テーブルエントリを作成することについては、十分に注意するようにしてください。 
        </p></li><li class="listitem"><p>
          単一アカウントに対して許可される接続数を制限するには、<span class="command"><strong>mysqld</strong></span> の <code class="literal">max_user_connections</code> 変数を設定することによってこれを実行できます。 <code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> ステートメントでは、アカウントに許可されるサーバー使用の範囲を制限するためのリソース制御オプションもサポートされています。 <a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a>および<a class="xref" href="sql-statements.html#alter-user" title="13.7.1.1 ALTER USER ステートメント">セクション13.7.1.1「ALTER USER ステートメント」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          プラグインディレクトリがサーバーによって書き込み可能な場合、ユーザーは <code class="literal">SELECT ... INTO DUMPFILE</code> を使用して、ディレクトリ内のファイルに実行可能コードを書き込むことができます。 これを回避するには、<code class="literal">plugin_dir</code> をサーバーに対して読取り専用にするか、<code class="literal">SELECT</code> 書込みを安全に行うことができるディレクトリに <code class="literal">secure_file_priv</code> を設定します。 
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-options"></a>6.1.4 セキュリティー関連の mysqld オプションおよび変数</h3></div></div></div><p>
      次の表は、セキュリティーに影響する <span class="command"><strong>mysqld</strong></span> オプションおよびシステム変数を示します。 これらの個別の説明は、<a class="xref" href="server-administration.html#server-options" title="5.1.7 サーバーコマンドオプション">セクション5.1.7「サーバーコマンドオプション」</a>および<a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 
    </p><div class="table"><a name="idm46723766362928"></a><p class="title"><b>表 6.1 「セキュリティオプションおよび変数サマリー」</b></p><div class="table-contents"><table frame="box" rules="all" summary="「セキュリティ関連のコマンドラインオプションおよびシステム変数。」"><col style="width=20%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><thead><tr><th scope="col">名前</th>
<th scope="col">コマンド行</th>
<th scope="col">オプションファイル</th>
<th scope="col">システム変数</th>
<th scope="col">ステータス変数</th>
<th scope="col">変数スコープ</th>
<th scope="col">動的</th>
</tr></thead><tbody><tr><th scope="row"><a class="link" href="server-administration.html#option_mysqld_allow-suspicious-udfs">allow-suspicious-udfs</a></th>
<td>はい</td>
<td>はい</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#sysvar_automatic_sp_privileges">automatic_sp_privileges</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#option_mysqld_chroot">chroot</a></th>
<td>はい</td>
<td>はい</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#sysvar_local_infile">local_infile</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#option_mysqld_safe-user-create">safe-user-create</a></th>
<td>はい</td>
<td>はい</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#sysvar_secure_file_priv">secure_file_priv</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-grant-tables">skip-grant-tables</a></th>
<td>はい</td>
<td>はい</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#sysvar_skip_name_resolve">skip_name_resolve</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#sysvar_skip_networking">skip_networking</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-show-database">skip_show_database</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="changing-mysql-user"></a>6.1.5 MySQL を通常ユーザーとして実行する方法</h3></div></div></div><a class="indexterm" name="idm46723766276096"></a><a class="indexterm" name="idm46723766274096"></a><p>
      Windows 上では、通常のユーザーアカウントを使用して Windows サービスとしてサーバーを実行できます。
    </p><p>
      Linux では、MySQL リポジトリまたは RPM パッケージを使用してインストールを実行する場合、ローカルの <code class="literal">mysql</code> オペレーティングシステムユーザーが MySQL サーバー <span class="command"><strong>mysqld</strong></span> を起動する必要があります。 別のオペレーティングシステムユーザーによる開始は、MySQL リポジトリの一部として含まれる init スクリプトではサポートされていません。 
    </p><p>
      Unix (<code class="filename">tar.gz</code> パッケージを使用して実行されるインストールの場合は Linux) では、MySQL サーバー <span class="command"><strong>mysqld</strong></span> を起動して任意のユーザーが実行できます。 しかし、セキュリティー上の理由から、Unix <code class="literal">root</code> ユーザーとしてサーバーを実行することは避けてください。 <span class="command"><strong>mysqld</strong></span> を変更し、権限のない普通の Unix ユーザー <em class="replaceable"><code>user_name</code></em> として実行するには、次のことを行う必要があります。 
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          サーバーが稼働していれば、サーバーを停止します (<span class="command"><strong>mysqladmin shutdown</strong></span> を使用します)。
        </p></li><li class="listitem"><p>
          データベースディレクトリとファイルを変更して、<em class="replaceable"><code>user_name</code></em> がそこのファイルの読み取りおよび書き込みを行う権限を与えます (この操作は Unix <code class="literal">root</code> ユーザーとして行う必要があります)。
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>chown -R <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>/path/to/mysql/datadir</code></em></code></strong>
</pre><p>
          これを行わないと、サーバーは <em class="replaceable"><code>user_name</code></em> として実行されているときにデータベースまたはテーブルにアクセスできません。
        </p><p>
          MySQL データディレクトリ内のディレクトリまたはファイルがシンボリックリンクの場合、<code class="literal">chown -R</code> がシンボリックリンク先を参照しないことがあります。 そうでない場合は、これらのリンクをたどり、それらが指し示しているディレクトリおよびファイルを変更する必要もあります。 
        </p></li><li class="listitem"><p>
          <em class="replaceable"><code>user_name</code></em> というユーザーでサーバーを起動します。 別の方法として、Unix <code class="literal">root</code> ユーザーとして <span class="command"><strong>mysqld</strong></span> を起動し、<code class="option">--user=<em class="replaceable"><code>user_name</code></em></code> オプションを使用することもできます。<span class="command"><strong>mysqld</strong></span> が起動し、接続を受け入れる前に Unix ユーザー <em class="replaceable"><code>user_name</code></em> として実行されるように切り替えます。 
        </p></li><li class="listitem"><p>
          システム起動時に指定されたユーザーとしてサーバーを起動するには、<code class="filename">/etc/my.cnf</code> オプションファイルまたはサーバーのデータディレクトリに格納されている <code class="filename">my.cnf</code> オプションファイルの <code class="literal">[mysqld]</code> グループに、<code class="literal">user</code> オプションを追加することによってユーザー名を指定します。 例: 
        </p><pre class="programlisting">[mysqld]
user=<em class="replaceable"><code>user_name</code></em>
</pre></li></ol></div><p>
      Unix マシン自体が保護されていない場合は、権限付与テーブルで MySQL <code class="literal">root</code> アカウントにパスワードを割り当てる必要があります。 これをしないと、そのマシンのログインアカウントを持つすべてのユーザーが、<code class="option">--user=root</code> オプションを使用して <span class="command"><strong>mysql</strong></span> クライアントを実行でき、あらゆる操作を行うことができます。 (すべての場合に MySQL アカウントにパスワードを割り当てることはよい考えですが、ほかのログインアカウントがサーバーホスト上に存在する場合は特に重要です。) <a class="xref" href="installing.html#default-privileges" title="2.10.4 初期 MySQL アカウントの保護">セクション2.10.4「初期 MySQL アカウントの保護」</a>を参照してください。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="load-data-local-security"></a>6.1.6 LOAD DATA LOCAL のセキュリティー上の考慮事項</h3></div></div></div><a class="indexterm" name="idm46723766236720"></a><p>
      <code class="literal">LOAD DATA</code> ステートメントは、データファイルをテーブルにロードします。 このステートメントは、サーバーホスト上のファイル、または <code class="literal">LOCAL</code> キーワードが指定されている場合はクライアントホスト上のファイルをロードできます。 
    </p><p>
      <code class="literal">LOCAL</code> バージョンの <code class="literal">LOAD DATA</code> には、セキュリティ上の潜在的な問題があります:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">LOAD DATA LOCAL</code> は SQL ステートメントであるため、解析はサーバー側で行われ、クライアントホストからサーバーホストへのファイルの転送は MySQL サーバーによって開始され、クライアントにステートメントで指定されたファイルが通知されます。 理論上、パッチが適用されたサーバーは、ステートメントで指定されたファイルではなく、選択したサーバーのファイルを転送するようにクライアントプログラムに指示できます。 そのようなサーバーは、クライアントユーザーが読み取りアクセス権を持つクライアントホスト上のすべてのファイルにアクセスできます。 (パッチが適用されたサーバーは、実際には <code class="literal">LOAD DATA LOCAL</code> だけでなく任意のステートメントへのファイル転送リクエストで応答する可能性があるため、より基本的な問題は、クライアントが信頼できないサーバーに接続しないことです。) 
        </p></li><li class="listitem"><p>
          クライアントが Web サーバーから接続している Web 環境では、ユーザーは <code class="literal">LOAD DATA LOCAL</code> を使用して、Web サーバープロセスが読取りアクセス権を持つファイルを読み取ることができます (ユーザーが SQL サーバーに対して任意のステートメントを実行できると想定しています)。 この環境では、MySQL サーバーに関するクライアントは実際には Web サーバーであり、Web サーバーに接続するユーザーによって実行されるリモートプログラムではありません。 
        </p></li></ul></div><p>
      信頼できないサーバーへの接続を回避するために、クライアントはセキュアな接続を確立し、<code class="option">--ssl-mode=VERIFY_IDENTITY</code> オプションと適切な CA 証明書を使用して接続することでサーバー識別情報を確認できます。
    </p><p>
      <code class="literal">LOAD DATA</code> の問題を回避するには、クライアント側で適切な予防措置が講じられていないかぎり、クライアントは <code class="literal">LOCAL</code> を使用しないようにしてください。
    </p><p>
      ローカルデータロードを制御するために、MySQL ではこの機能を有効または無効にできます。 また、MySQL 8.0.21 の時点では、MySQL を使用すると、クライアントはローカルデータロード操作を指定されたディレクトリにあるファイルに制限できます。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#load-data-local-configuration" title="ローカルデータロード機能の有効化または無効化">ローカルデータロード機能の有効化または無効化</a></p></li><li class="listitem"><p><a class="xref" href="security.html#load-data-local-permitted-files" title="ローカルデータロードに許可されるファイルの制限">ローカルデータロードに許可されるファイルの制限</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="load-data-local-configuration"></a>ローカルデータロード機能の有効化または無効化</h4></div></div></div><p>
        管理者およびアプリケーションは、ローカルデータロードを許可するかどうかを次のように構成できます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー側:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">local_infile</code> システム変数は、サーバー側の <code class="literal">LOCAL</code> 機能を制御します。 <code class="literal">local_infile</code> の設定に応じて、サーバーはローカルデータロードをリクエストするクライアントによるローカルデータロードを拒否または許可します。 
              </p></li><li class="listitem"><p>
                デフォルトでは、<code class="literal">local_infile</code> は無効です。 サーバーが <code class="literal">LOAD DATA LOCAL</code> ステートメントを明示的に拒否または許可するようにするには (構築時または実行時にクライアントプログラムおよびライブラリがどのように構成されているかに関係なく)、<code class="literal">local_infile</code> を無効または有効にして <span class="command"><strong>mysqld</strong></span> を起動します。<code class="literal">local_infile</code> は実行時に設定することもできます。 
              </p><a class="indexterm" name="idm46723766200240"></a><a class="indexterm" name="idm46723766198768"></a></li></ul></div></li><li class="listitem"><p>
            クライアント側:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="option">ENABLED_LOCAL_INFILE</code> <span class="command"><strong>CMake</strong></span> オプションは、MySQL クライアントライブラリのコンパイル済みのデフォルトの <code class="literal">LOCAL</code> 機能を制御します (<a class="xref" href="installing.html#source-configuration-options" title="2.9.7 MySQL ソース構成オプション">セクション2.9.7「MySQL ソース構成オプション」</a> を参照)。 したがって、明示的な配置を行わないクライアントでは、MySQL ビルド時に指定された <code class="option">ENABLED_LOCAL_INFILE</code> 設定に従って、<code class="literal">LOCAL</code> 機能が無効または有効になります。 
              </p><a class="indexterm" name="idm46723766189872"></a><a class="indexterm" name="idm46723766187696"></a></li><li class="listitem"><p>
                デフォルトでは、MySQL バイナリディストリビューションのクライアントライブラリは、<code class="option">ENABLED_LOCAL_INFILE</code> を無効にしてコンパイルされます。 ソースから MySQL をコンパイルする場合は、明示的な配置を行わないクライアントで <code class="literal">LOCAL</code> 機能を無効にするか有効にするかに基づいて、<code class="option">ENABLED_LOCAL_INFILE</code> を無効または有効にして構成します。 
              </p></li><li class="listitem"><p>
                C API を使用するクライアントプログラムの場合、ローカルデータロード機能は、MySQL クライアントライブラリにコンパイルされるデフォルトで決定されます。 明示的に有効または無効にするには、<code class="literal">mysql_options()</code> C API 関数を呼び出して、<code class="literal">MYSQL_OPT_LOCAL_INFILE</code> オプションを無効または有効にします。 <a class="ulink" href="https://dev.mysql.com/doc/c-api/8.0/en/mysql-options.html" target="_top">mysql_options()</a>を参照してください。 
              </p><a class="indexterm" name="idm46723766177936"></a></li><li class="listitem"><p>
                <span class="command"><strong>mysql</strong></span> クライアントの場合、ローカルデータロード機能は、MySQL クライアントライブラリにコンパイルされたデフォルトで決定されます。 明示的に無効または有効にするには、<code class="option">--local-infile=0</code> または <code class="option">--local-infile[=1]</code>オプションを使用します。 
              </p><a class="indexterm" name="idm46723766172496"></a><a class="indexterm" name="idm46723766170288"></a></li><li class="listitem"><p>
                <span class="command"><strong>mysqlimport</strong></span> クライアントの場合、デフォルトではローカルデータロードは使用されません。 明示的に無効または有効にするには、<code class="option">--local=0</code> または <code class="option">--local[=1]</code>オプションを使用します。 
              </p><a class="indexterm" name="idm46723766165040"></a><a class="indexterm" name="idm46723766162864"></a></li><li class="listitem"><p>
                Perl スクリプトまたはオプションファイルから<code class="literal">[client]</code>グループを読み取る他のプログラムで <code class="literal">LOAD DATA LOCAL</code> を使用する場合は、そのグループに <code class="literal">local-infile</code> オプション設定を追加できます。 このオプションを認識しないプログラムの問題を回避するには、<a class="link" href="programs.html#option-modifiers" title="4.2.2.4 プログラムオプション修飾子"><code class="literal">loose-</code></a> 接頭辞を使用して指定します: 
              </p><pre class="programlisting">[client]
loose-local-infile=0
</pre><p>
                または
              </p><pre class="programlisting">[client]
loose-local-infile=1
</pre></li><li class="listitem"><p>
                いずれの場合も、クライアントによる <code class="literal">LOCAL</code> ロード操作を正常に使用するには、サーバーでローカルロードが許可されている必要があります。
              </p></li></ul></div></li></ul></div><p>
        サーバー側またはクライアント側で <code class="literal">LOCAL</code> 機能が無効になっている場合、<code class="literal">LOAD DATA LOCAL</code> ステートメントを発行しようとするクライアントは次のエラーメッセージを受け取ります:
      </p><pre class="programlisting">ERROR 3950 (42000): Loading local data is disabled; this must be
enabled on both the client and server side
</pre><a class="indexterm" name="idm46723766146896"></a><a class="indexterm" name="idm46723766144208"></a></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="load-data-local-permitted-files"></a>ローカルデータロードに許可されるファイルの制限</h4></div></div></div><p>
        MySQL 8.0.21 の時点で、MySQL クライアントライブラリを使用すると、クライアントアプリケーションはローカルデータロード操作を指定されたディレクトリにあるファイルに制限できます。 特定の MySQL クライアントプログラムは、この機能を利用します。 
      </p><p>
        C API を使用するクライアントプログラムは、<code class="literal">mysql_options()</code> C API 関数の <code class="literal">MYSQL_OPT_LOCAL_INFILE</code> および <code class="literal">MYSQL_OPT_LOAD_DATA_LOCAL_DIR</code> オプションを使用して、データロードを許可するファイルを制御できます (<a class="ulink" href="https://dev.mysql.com/doc/c-api/8.0/en/mysql-options.html" target="_top">mysql_options()</a> を参照)。
      </p><a class="indexterm" name="idm46723766135376"></a><a class="indexterm" name="idm46723766133344"></a><p>
        <code class="literal">MYSQL_OPT_LOAD_DATA_LOCAL_DIR</code> の効果は、<code class="literal">LOCAL</code> データロードが有効か無効かによって異なります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">LOCAL</code> データロードが MySQL クライアントライブラリでデフォルトで有効になっているか、<code class="literal">MYSQL_OPT_LOCAL_INFILE</code> を明示的に有効にしても、<code class="literal">MYSQL_OPT_LOAD_DATA_LOCAL_DIR</code> オプションは無効です。
          </p></li><li class="listitem"><p>
            <code class="literal">LOCAL</code> データロードが無効になっている場合は、デフォルトで MySQL クライアントライブラリで無効になっているか、<code class="literal">MYSQL_OPT_LOCAL_INFILE</code> を明示的に無効にすることによって、<code class="literal">MYSQL_OPT_LOAD_DATA_LOCAL_DIR</code> オプションを使用して、ローカルにロードされるファイルに許可されるディレクトリを指定できます。 この場合、<code class="literal">LOCAL</code> データのロードは許可されますが、指定されたディレクトリにあるファイルに制限されます。 <code class="literal">MYSQL_OPT_LOAD_DATA_LOCAL_DIR</code> 値の解釈は次のとおりです: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                値が NULL ポインタ (デフォルト) の場合、ディレクトリ名は指定されず、<code class="literal">LOCAL</code> データのロードにファイルは許可されません。
              </p></li><li class="listitem"><p>
                値がディレクトリパス名の場合、<code class="literal">LOCAL</code> データのロードは許可されますが、指定されたディレクトリにあるファイルに制限されます。 ディレクトリパス名とロードされるファイルのパス名の比較では、基礎となるファイルシステムの大/小文字の区別に関係なく、大/小文字が区別されます。 
              </p></li></ul></div></li></ul></div><p>
        MySQL クライアントプログラムでは、前述の <code class="literal">mysql_options()</code> オプションを次のように使用します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="command"><strong>mysql</strong></span> クライアントには、ディレクトリパスまたは空の文字列を取る <code class="option">--load-data-local-dir</code> オプションがあります。<span class="command"><strong>mysql</strong></span> は、オプション値を使用して <code class="literal">MYSQL_OPT_LOAD_DATA_LOCAL_DIR</code> オプションを設定します (値を NULL ポインタに設定する空の文字列を使用)。 <code class="option">--load-data-local-dir</code> の効果は、<code class="literal">LOCAL</code> データロードが有効かどうかによって異なります: 
          </p><a class="indexterm" name="idm46723766108272"></a><a class="indexterm" name="idm46723766106064"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">LOCAL</code> データロードが MySQL クライアントライブラリでデフォルトで有効になっている場合、または <code class="option">--local-infile[=1]</code>を指定して有効になっている場合、<code class="option">--load-data-local-dir</code> オプションは無視されます。
              </p></li><li class="listitem"><p>
                <code class="literal">LOCAL</code> のデータロードが無効になっている場合は、MySQL クライアントライブラリでデフォルトで無効になっているか、<code class="option">--local-infile=0</code> を指定すると、<code class="option">--load-data-local-dir</code> オプションが適用されます。
              </p></li></ul></div><p>
            <code class="option">--load-data-local-dir</code> が適用される場合、オプション値は、ローカルデータファイルを配置する必要があるディレクトリを指定します。 ディレクトリパス名とロードされるファイルのパス名の比較では、基礎となるファイルシステムの大/小文字の区別に関係なく、大/小文字が区別されます。 オプション値が空の文字列の場合、ディレクトリ名は指定されず、ローカルデータのロードにファイルは許可されません。 
          </p></li><li class="listitem"><p>
            <span class="command"><strong>mysqlimport</strong></span> は、ファイルを含むディレクトリが許可されたローカルロードディレクトリになるように、処理するファイルごとに <code class="literal">MYSQL_OPT_LOAD_DATA_LOCAL_DIR</code> を設定します。
          </p></li><li class="listitem"><p>
            <code class="literal">LOAD DATA</code> ステートメントに対応するデータロード操作の場合、<span class="command"><strong>mysqlbinlog</strong></span> はバイナリログイベントからファイルを抽出し、一時的なファイルとしてローカルファイルシステムに書き込み、<code class="literal">LOAD DATA LOCAL</code> ステートメントを書き込んでファイルをロードします。 デフォルトでは、<span class="command"><strong>mysqlbinlog</strong></span> はこれらの一時ファイルをオペレーティングシステム固有のディレクトリに書き込みます。 <code class="option">--local-load</code> オプションを使用すると、<span class="command"><strong>mysqlbinlog</strong></span> がローカル一時ファイルを準備するディレクトリを明示的に指定できます。 
          </p><a class="indexterm" name="idm46723766085760"></a><a class="indexterm" name="idm46723766083568"></a><p>
            他のプロセスはデフォルトのシステム固有のディレクトリにファイルを書き込むことができるため、<span class="command"><strong>mysqlbinlog</strong></span> に <code class="option">--local-load</code> オプションを指定してデータファイルに別のディレクトリを指定し、<span class="command"><strong>mysqlbinlog</strong></span> からの出力を処理するときに <span class="command"><strong>mysql</strong></span> に <code class="option">--load-data-local-dir</code> オプションを指定して同じディレクトリを指定することをお薦めします。
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="secure-client-programming"></a>6.1.7 クライアントプログラミングのセキュリティーガイドライン</h3></div></div></div><p>
      MySQL にアクセスするアプリケーションは、ユーザーによって入力されるあらゆるデータを信頼しないようにしてください。ユーザーは Web フォーム、URL、または構築されたあらゆるアプリケーションに特殊文字またはエスケープ文字のシーケンスを入力することによってコードを欺くことを試すことができます。 ユーザーが <code class="literal">; DROP DATABASE mysql;</code> のような入力を行なっても、アプリケーションがセキュアな状態に保たれるようにしてください。 これは極端な例ですが、同様の技術を使用するハッカーに備えていない場合、結果として大規模なセキュリティーリークおよびデータ損失が発生することがあります。 
    </p><p>
      よくある過ちは、文字列データ値のみ保護することです。 数値データも忘れずに検査してください。 ユーザーが <code class="literal">234</code> という値を入力したとき、アプリケーションが <code class="literal">SELECT * FROM table WHERE ID=234</code> のようなクエリーを生成する場合、ユーザーは <code class="literal">234 OR 1=1</code> という値を入力して、<code class="literal">SELECT * FROM table WHERE ID=234 OR 1=1</code> というクエリーをアプリケーションに生成させることができます。 その結果、サーバーはテーブル内のすべての行を取得します。 これはすべての行を公開し、サーバーに過剰な負荷がかかります。 この種類の攻撃から保護するためのもっとも簡単な方法は、数値定数を囲む単一引用符を使用して、<code class="literal">SELECT * FROM table WHERE ID='234'</code> とする方法です。 ユーザーが余分の情報を入力すると、その情報はすべて文字列の一部となります。 数値コンテキストでは、MySQL は自動的にこの文字列を数値に変換し、あとに続く数値以外のすべての文字を取り除きます。 
    </p><p>
      データベースに格納されているデータが公開されているもののみであれば、保護は不要だと思われることもあります。 これは正しくありません。 データベース内のどの行も表示が許可されている場合であっても、サービス妨害攻撃 (前のパラグラフの技術に基づいた、サーバーにリソースを浪費させるものなど) から保護するべきです。 そうしない場合、サーバーは正当なユーザーに対して応答不能になります。 
    </p><p>
      チェックリスト:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          厳密な SQL モードを有効にして、サーバーが受け入れるデータ値の制限を厳しくするようサーバーに指示します。 <a class="xref" href="server-administration.html#sql-mode" title="5.1.11 サーバー SQL モード">セクション5.1.11「サーバー SQL モード」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          すべての Web フォームに一重引用符および二重引用符 (<code class="literal">'</code>および<code class="literal">"</code>) を入力してみてください。 何らかの種類の MySQL エラーが出る場合、すぐに問題を調査してください。 
        </p></li><li class="listitem"><p>
          <code class="literal">%22</code> (<code class="literal">"</code>)、<code class="literal">%23</code> (<code class="literal">#</code>) および <code class="literal">%27</code> (<code class="literal">'</code>) を追加して、動的 URL の変更を試みます。
        </p></li><li class="listitem"><p>
          前の例で示した文字を使用して、動的 URL のデータ型を数値型から文字型に変更してみます。 これらの攻撃や類似の攻撃に対してアプリケーションが安全であるようにしてください。 
        </p></li><li class="listitem"><p>
          数値フィールドに、数値でなく文字、スペース、および特殊記号を入力してみます。 アプリケーションはこれらを MySQL に渡す前にこれらを削除するか、またはエラーを生成します。 検査済みでない値を MySQL に渡すことは非常に危険です。 
        </p></li><li class="listitem"><p>
          データを MySQL に渡す前にデータのサイズを検査してください。
        </p></li><li class="listitem"><p>
          アプリケーションがデータベースに接続するときは、管理目的で使用するものとは異なるユーザー名を使用するようにしてください。 アプリケーションに不要なアクセス権限を付与しないでください。 
        </p></li></ul></div><p>
      多くのアプリケーションプログラミングインタフェースには、データ値の特殊文字をエスケープする手段が備わっています。 適切に使用すれば、これにより、意図とは異なる効果を持つステートメントをアプリケーションに生成させる値を、アプリケーションユーザーが入力できないようにすることができます。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL C API: <code class="literal">mysql_real_escape_string_quote()</code> API コールを使用します。
        </p></li><li class="listitem"><p>
          MySQL++: クエリーストリームに対して <code class="literal">escape</code> および <code class="literal">quote</code> 修飾子を使用してください。
        </p></li><li class="listitem"><p>
          PHP: <code class="literal">mysqli</code> または <code class="literal">pdo_mysql</code> 拡張子を使用し、古い <code class="literal">ext/mysql</code> 拡張子を使用しないでください。 推奨される API は、プレースホルダを持つプリペアドステートメントのほかに、改善された MySQL 認証プロトコルおよびパスワードをサポートします。 <a class="ulink" href="https://dev.mysql.com/doc/apis-php/en/apis-php-mysqlinfo.api.choosing.html" target="_top">Choosing an API</a>も参照してください。 
        </p><p>
          古い <code class="literal">ext/mysql</code> 拡張機能を使用する必要がある場合、エスケープには <code class="literal">mysql_escape_string()</code> または <code class="function">addslashes()</code> ではなく <code class="literal">mysql_real_escape_string_quote()</code> 関数を使用します。これは、<code class="literal">mysql_real_escape_string_quote()</code> のみが文字セット対応であるためです。マルチバイト文字セットを使用している場合は、他の関数を<span class="quote">「<span class="quote">「バイパス」</span>」</span>にできます (無効)。
        </p></li><li class="listitem"><p>
          Perl DBI: プレースホルダまたは <code class="literal">quote()</code> メソッドを使用してください。
        </p></li><li class="listitem"><p>
          Ruby DBI: プレースホルダまたは <code class="literal">quote()</code> メソッドを使用してください。
        </p></li><li class="listitem"><p>
          Java JDBC: <code class="literal">PreparedStatement</code> オブジェクトおよびプレースホルダを使用してください。
        </p></li></ul></div><p>
      ほかのプログラミングインタフェースも似たような機能を持っている場合があります。
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="access-control"></a>6.2 アクセス制御とアカウント管理</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#user-names">6.2.1 アカウントのユーザー名とパスワード</a></span></dt><dt><span class="section"><a href="security.html#privileges-provided">6.2.2 MySQL で提供される権限</a></span></dt><dt><span class="section"><a href="security.html#grant-tables">6.2.3 付与テーブル</a></span></dt><dt><span class="section"><a href="security.html#account-names">6.2.4 アカウント名の指定</a></span></dt><dt><span class="section"><a href="security.html#role-names">6.2.5 ロール名の指定</a></span></dt><dt><span class="section"><a href="security.html#connection-access">6.2.6 アクセス制御、ステージ 1: 接続の検証</a></span></dt><dt><span class="section"><a href="security.html#request-access">6.2.7 アクセス制御、ステージ 2: リクエストの確認</a></span></dt><dt><span class="section"><a href="security.html#creating-accounts">6.2.8 アカウントの追加、権限の割当ておよびアカウントの削除</a></span></dt><dt><span class="section"><a href="security.html#reserved-accounts">6.2.9 予約済アカウント</a></span></dt><dt><span class="section"><a href="security.html#roles">6.2.10 ロールの使用</a></span></dt><dt><span class="section"><a href="security.html#account-categories">6.2.11 アカウントカテゴリ</a></span></dt><dt><span class="section"><a href="security.html#partial-revokes">6.2.12 部分取消しを使用した権限の制限</a></span></dt><dt><span class="section"><a href="security.html#privilege-changes">6.2.13 権限変更が有効化される時期</a></span></dt><dt><span class="section"><a href="security.html#assigning-passwords">6.2.14 アカウントパスワードの割り当て</a></span></dt><dt><span class="section"><a href="security.html#password-management">6.2.15 パスワード管理</a></span></dt><dt><span class="section"><a href="security.html#expired-password-handling">6.2.16 期限切れパスワードのサーバー処理</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication">6.2.17 プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#proxy-users">6.2.18 プロキシユーザー</a></span></dt><dt><span class="section"><a href="security.html#account-locking">6.2.19 アカウントロック</a></span></dt><dt><span class="section"><a href="security.html#user-resources">6.2.20 アカウントリソース制限の設定</a></span></dt><dt><span class="section"><a href="security.html#problems-connecting">6.2.21 MySQL への接続の問題のトラブルシューティング</a></span></dt><dt><span class="section"><a href="security.html#account-activity-auditing">6.2.22 SQL ベースのアカウントアクティビティ監査</a></span></dt></dl></div><a class="indexterm" name="idm46723766027552"></a><a class="indexterm" name="idm46723766026112"></a><a class="indexterm" name="idm46723766024752"></a><a class="indexterm" name="idm46723766023408"></a><a class="indexterm" name="idm46723766022048"></a><a class="indexterm" name="idm46723766021072"></a><a class="indexterm" name="idm46723766019296"></a><a class="indexterm" name="idm46723766017808"></a><a class="indexterm" name="idm46723766016448"></a><a class="indexterm" name="idm46723766014784"></a><p>
    MySQL では、クライアントユーザーがサーバーに接続し、サーバーによって管理されるデータにアクセスできるようにするアカウントを作成できます。 MySQL 権限システムの主な役割は、特定のホストから接続するユーザーを認証すること、およびそのユーザーを、<code class="literal">SELECT</code>、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> などのデータベースにおける権限に関連付けることです。 追加機能には、管理操作の権限を付与する機能が含まれます。 
  </p><p>
    接続できるユーザーを制御するために、各アカウントにパスワードなどの認証資格証明を割り当てることができます。 MySQL アカウントへのユーザーインタフェースは、<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">REVOKE</code> などの SQL ステートメントで構成されます。 <a class="xref" href="sql-statements.html#account-management-statements" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a>を参照してください。 
  </p><p>
    MySQL 権限システムによって、すべてのユーザーは自分に許可された操作のみ実行可能になります。 ユーザーとして MySQL サーバーに接続すると、ユーザーの ID は、<span class="emphasis"><em>接続元のホスト</em></span>および<span class="emphasis"><em>指定したユーザー名</em></span>によって決定されます。 接続後にリクエストを発行すると、システムは、ユーザー ID と <span class="emphasis"><em>ユーザーが行う操作</em></span>に応じて権限を付与します。 
  </p><p>
    MySQL ではホスト名とユーザー名の両方を考慮に入れてユーザーを特定しますが、これは、特定のユーザー名がすべてのホストで同一人物に属すると想定する根拠がないためです。 たとえば、<code class="literal">office.example.com</code> から接続したユーザー <code class="literal">joe</code> は、<code class="literal">home.example.com</code> から接続した <code class="literal">joe</code> と同一人物とは限りません。 MySQL では、たまたま同じ名前を持った異なるホスト上のユーザーを識別できるようにすることによってこれを処理します。つまり、<code class="literal">office.example.com</code> からの <code class="literal">joe</code> による接続に対して 1 つの権限セットを付与し、<code class="literal">home.example.com</code> からの <code class="literal">joe</code> による接続に対して別の権限セットを提供することができます。 特定のアカウントが持つ権限を表示するには、<code class="literal">SHOW GRANTS</code> ステートメントを使用します。 例: 
  </p><pre class="programlisting">SHOW GRANTS FOR 'joe'@'office.example.com';
SHOW GRANTS FOR 'joe'@'home.example.com';
</pre><p>
    内部的に、サーバーは <code class="literal">mysql</code> システムデータベースの付与テーブルに特権情報を格納します。 MySQL サーバーはこれらのテーブルの内容を起動時にメモリーに読み取り、付与テーブルのインメモリーコピーに基づいてアクセス制御を決定します。 
  </p><p>
    サーバーに接続するクライアントプログラムを実行するとき、MySQL アクセス制御には 2 つのステージがあります。
  </p><p>
    <span class="bold"><strong>ステージ 1:</strong></span> サーバーは、ユーザーの ID および正しいパスワードを指定することによって ID を検証できるかどうかに基づいて、接続を受け入れるか拒否します。
  </p><p>
    <span class="bold"><strong>ステージ 2:</strong></span> 接続できる場合、サーバーはユーザーが発行する各ステートメントを検査して、ステートメントを実行するだけの十分な権限をユーザーが持っているかどうかを判別します。 たとえば、データベースのテーブルからレコードを選択したり、データベースのテーブルを削除したりしようとすると、サーバーはユーザーにそのテーブルの <code class="literal">SELECT</code> 権限があるかどうか、またはデータベースの <code class="literal">DROP</code> 権限があるかどうかを検証します。 
  </p><p>
    各ステージで発生する動作の詳細な説明については、<a class="xref" href="security.html#connection-access" title="6.2.6 アクセス制御、ステージ 1: 接続の検証">セクション6.2.6「アクセス制御、ステージ 1: 接続の検証」</a>および<a class="xref" href="security.html#request-access" title="6.2.7 アクセス制御、ステージ 2: リクエストの確認">セクション6.2.7「アクセス制御、ステージ 2: リクエストの確認」</a>を参照してください。 権限に関連した問題の診断についての支援情報は、<a class="xref" href="security.html#problems-connecting" title="6.2.21 MySQL への接続の問題のトラブルシューティング">セクション6.2.21「MySQL への接続の問題のトラブルシューティング」</a>を参照してください。 
  </p><p>
    ユーザーの接続中に (ユーザー自身または別のだれかによって) 権限が変更された場合、それらの変更は、ユーザーが発行する次のステートメントで必ずしもすぐに有効になるわけではありません。 サーバーが付与テーブルをリロードする条件についての詳細は、<a class="xref" href="security.html#privilege-changes" title="6.2.13 権限変更が有効化される時期">セクション6.2.13「権限変更が有効化される時期」</a>を参照してください。 
  </p><p>
    MySQL 権限システムでは実行できないこともあります。
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        特定ユーザーのアクセスを拒否するように明示的に指定することはできません。 つまり、ユーザーを明示的に突き合わせて接続を拒否することはできません。 
      </p></li><li class="listitem"><p>
        ユーザーがデータベースのテーブルを作成または削除できるが、データベース自体の作成または削除はできないような権限をユーザーが持つように指定することはできません。
      </p></li><li class="listitem"><p>
        パスワードはアカウントに対してグローバルに適用されます。 データベース、テーブル、ルーチンなどの特定のオブジェクトにパスワードを関連付けることはできません。 
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="user-names"></a>6.2.1 アカウントのユーザー名とパスワード</h3></div></div></div><a class="indexterm" name="idm46723765972288"></a><a class="indexterm" name="idm46723765970176"></a><p>
      MySQL は、<code class="literal">mysql</code> システムデータベースの <code class="literal">user</code> テーブルにアカウントを格納します。 アカウントは、ユーザー名およびユーザーがサーバーに接続できるクライアントホスト (複数の場合あり) に関して定義されます。 <code class="literal">user</code> テーブルでのアカウントの表示については、<a class="xref" href="security.html#grant-tables" title="6.2.3 付与テーブル">セクション6.2.3「付与テーブル」</a>を参照してください。 
    </p><p>
      アカウントは、パスワードなどの認証資格証明を持つこともできます。 資格証明は、アカウント認証プラグインによって処理されます。 MySQL は、複数の認証プラグインをサポートしています。 これらの中には組込みの認証方式を使用するものもあれば、外部の認証方式を使用した認証を有効にするものもあります。 <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。 
    </p><p>
      MySQL でのユーザー名とパスワードの使用方法とオペレーティングシステムの使用方法には、いくつかの違いがあります:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL で認証目的に使用されるユーザー名と、Windows または Unix で使用されるユーザー名 (ログイン名) とには、まったく関係がありません。 Unix では、ほとんどの MySQL クライアントがデフォルトで、現在の Unix ユーザー名を MySQL ユーザー名として使用してログインを試みますが、これは便宜上の目的に過ぎません。 クライアントプログラムでは、<code class="option">-u</code> または <code class="option">--user</code> オプションを使用して任意のユーザー名を指定することが許可されているため、簡単にデフォルトをオーバーライドできます。 つまり、すべての MySQL アカウントにパスワードがないかぎり、誰でも任意のユーザー名を使用してサーバーへの接続を試みることができるため、どのような方法でもデータベースを保護することはできません。 パスワードのないアカウントのユーザー名を指定したユーザーは、サーバーに正常に接続できます。 
        </p></li><li class="listitem"><p>
          MySQL ユーザー名の長さは最大 32 文字です。 オペレーティングシステムのユーザー名の最大長が異なる場合があります。 
        </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
            MySQL ユーザー名の長さ制限は MySQL サーバーおよびクライアントでハードコードされており、<code class="literal">mysql</code> データベース<span class="emphasis"><em>機能しない</em></span>内のテーブルの定義を変更して回避しようとしています。
          </p><p>
            <code class="literal">mysql</code> データベースのテーブルの構造は、<a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a> で説明されているプロシージャを使用しないかぎり、どのような方法でも変更しないでください。 MySQL システムテーブルを他の方法で再定義しようとすると、未定義でサポートされていない動作が発生します。 これらの変更の結果として誤った形式となった行を、サーバーは随意で無視します。 
          </p></div></li><li class="listitem"><p>
          組込み認証方式を使用するアカウントのクライアント接続を認証するために、サーバーは <code class="literal">user</code> テーブルに格納されているパスワードを使用します。 これらのパスワードは、オペレーティングシステムにログインするためのパスワードとは異なります。 Windows または Unix マシンにログインする際に使用される<span class="quote">「<span class="quote">外部</span>」</span>パスワードと、そのマシン上の MySQL サーバーにアクセスする際に使用されるパスワードとの間には、必要な関係はありません。 
        </p><p>
          サーバーがほかのプラグインを使用してクライアントを認証する場合、プラグインが実装する認証方式は、<code class="literal">user</code> テーブルに格納されているパスワードを使用する場合と使用しない場合があります。 この場合、MySQL サーバーへの認証を行う際に、外部パスワードも使用される可能性があります。 
        </p></li><li class="listitem"><p>
          <code class="literal">user</code> テーブルに格納されているパスワードは、プラグイン固有のアルゴリズムを使用して暗号化されます。
        </p></li><li class="listitem"><p>
          ユーザー名とパスワードに ASCII 文字のみが含まれている場合は、文字セットの設定に関係なくサーバーに接続できます。 ユーザー名またはパスワードに ASCII 以外の文字が含まれている場合に接続を有効にするには、クライアントアプリケーションで、<code class="literal">MYSQL_SET_CHARSET_NAME</code> オプションおよび適切な文字セット名を引数に指定して <code class="literal">mysql_options()</code> C API 関数をコールする必要があります。 これにより、指定された文字セットを使用した認証が実行されます。 そうしないと、サーバーのデフォルト文字セットが認証のデフォルトのエンコーディングと同じでないかぎり、認証は失敗します。 
        </p><p>
          標準の MySQL クライアントプログラムでは、先ほど説明したように、<code class="literal">mysql_options()</code> が呼び出される <code class="option">--default-character-set</code> オプションがサポートされています。 さらに、<a class="xref" href="charset.html#charset-connection" title="10.4 接続文字セットおよび照合順序">セクション10.4「接続文字セットおよび照合順序」</a>で説明したように、文字セットの自動検出もサポートされています。 C API に基づいていないコネクタを使用するプログラムでは、<code class="literal">mysql_options()</code> と同等のものがコネクタで提供されている場合があり、それを代わりに使用できます。 コネクタのドキュメントを確認してください。 
        </p><p>
          前述の注は、クライアントの文字セットとして許可されていない <code class="literal">ucs2</code>、<code class="literal">utf16</code>、および <code class="literal">utf32</code> には適用されません。
        </p></li></ul></div><p>
      MySQL のインストールプロセスでは、<a class="xref" href="installing.html#default-privileges" title="2.10.4 初期 MySQL アカウントの保護">セクション2.10.4「初期 MySQL アカウントの保護」</a> で説明されているように、付与テーブルに初期 <code class="literal">root</code> アカウントが移入されます。このアカウントにパスワードを割り当てる方法についても説明します。 その後、通常は <code class="literal">CREATE USER</code>, <code class="literal">DROP USER</code>, <code class="literal">GRANT</code> や <code class="literal">REVOKE</code> などのステートメントを使用して、MySQL アカウントを設定、変更および削除します。 <a class="xref" href="security.html#creating-accounts" title="6.2.8 アカウントの追加、権限の割当ておよびアカウントの削除">セクション6.2.8「アカウントの追加、権限の割当ておよびアカウントの削除」</a>および<a class="xref" href="sql-statements.html#account-management-statements" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a>を参照してください。 
    </p><p>
      コマンドラインクライアントを使用して MySQL サーバーに接続するには、必要に応じて、使用するアカウントのユーザー名とパスワードのオプションを指定します:
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=finley --password <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      短いオプションを好む場合は、コマンドは次のようになります。
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u finley -p <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      コマンドラインで <code class="option">--password</code> または <code class="option">-p</code> オプションの後にパスワード値を省略すると (図のように)、クライアントからパスワードの入力を求められます。 または、コマンドラインでパスワードを指定できます: 
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=finley --password=<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
shell&gt; <strong class="userinput"><code>mysql -u finley -p<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      <code class="option">-p</code> オプションを使用する場合、<code class="option">-p</code> と次のパスワード値の間に<span class="emphasis"><em>スペースなし</em></span>が存在する必要があります。
    </p><p>
      コマンド行でのパスワード指定は、セキュアでないと考えるべきです。 <a class="xref" href="security.html#password-security-user" title="6.1.2.1 パスワードセキュリティーのためのエンドユーザーガイドライン">セクション6.1.2.1「パスワードセキュリティーのためのエンドユーザーガイドライン」</a>を参照してください。 コマンド行でパスワードを指定しないようにするには、オプションファイルまたはログインパスファイルを使用します。 <a class="xref" href="programs.html#option-files" title="4.2.2.2 オプションファイルの使用">セクション4.2.2.2「オプションファイルの使用」</a>および<a class="xref" href="programs.html#mysql-config-editor" title="4.6.7 mysql_config_editor — MySQL 構成ユーティリティー">セクション4.6.7「mysql_config_editor — MySQL 構成ユーティリティー」</a>を参照してください。 
    </p><p>
      ユーザー名、パスワード、およびその他の接続パラメータの指定に関する追加情報については、<a class="xref" href="programs.html#connecting" title="4.2.4 コマンドオプションを使用した MySQL Server への接続">セクション4.2.4「コマンドオプションを使用した MySQL Server への接続」</a>を参照してください。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="privileges-provided"></a>6.2.2 MySQL で提供される権限</h3></div></div></div><p>
      MySQL アカウントに付与される権限によって、アカウントが実行できる操作が決まります。 MySQL の権限は、適用されるコンテキストと操作のレベルによって異なります: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          管理権限によって、ユーザーは MySQL サーバーの動作を管理できます。 これらの権限は特定のデータベースに固有でないため、グローバルです。 
        </p></li><li class="listitem"><p>
          データベース権限は、データベースおよびデータベース内のすべてのオブジェクトに適用されます。 これらの権限は、特定のデータベースに付与したり、すべてのデータベースに適用されるようにグローバルに付与したりすることができます。 
        </p></li><li class="listitem"><p>
          テーブル、インデックス、ビュー、ストアドルーチンなどのデータベースオブジェクトに対する権限は、データベース内の特定のオブジェクト、データベース内の特定のタイプのすべてのオブジェクト (データベース内のすべてのテーブルなど)、またはすべてのデータベース内の特定のタイプのすべてのオブジェクトに対してグローバルに付与できます。
        </p></li></ul></div><p>
      権限は、静的 (サーバーに組み込まれている) か動的 (実行時に定義される) かによっても異なります。 権限が静的であるか動的であるかは、ユーザーアカウントおよびロールに付与される可用性に影響します。 静的権限と動的権限の違いの詳細は、<a class="xref" href="security.html#static-dynamic-privileges" title="静的権限と動的権限">静的権限と動的権限</a> を参照してください。) 
    </p><p>
      アカウント権限に関する情報は、<code class="literal">mysql</code> システムデータベースの付与テーブルに格納されます。 これらのテーブルの構造および内容の説明は、<a class="xref" href="security.html#grant-tables" title="6.2.3 付与テーブル">セクション6.2.3「付与テーブル」</a> を参照してください。 MySQL サーバーは、起動時に付与テーブルの内容をメモリーに読み取り、<a class="xref" href="security.html#privilege-changes" title="6.2.13 権限変更が有効化される時期">セクション6.2.13「権限変更が有効化される時期」</a> に示されている状況下でそれらをリロードします。 サーバーは、付与テーブルのメモリー内コピーに基づいてアクセス制御の決定を行います。 
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
        一部の MySQL リリースでは、新しい権限または機能を追加するために付与テーブルに変更が導入されています。 新しい機能を確実に利用できるようにするには、MySQL をアップグレードするたびに付与テーブルを現在の構造に更新します。 <a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a>を参照してください。 
      </p></div><p>
      次の各セクションでは、使用可能な権限の概要、各権限の詳細な説明および使用上のガイドラインを示します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#privileges-provided-summary" title="使用可能な権限のサマリー">使用可能な権限のサマリー</a></p></li><li class="listitem"><p><a class="xref" href="security.html#privileges-provided-static" title="静的権限の説明">静的権限の説明</a></p></li><li class="listitem"><p><a class="xref" href="security.html#privileges-provided-dynamic" title="動的権限の説明">動的権限の説明</a></p></li><li class="listitem"><p><a class="xref" href="security.html#privileges-provided-guidelines" title="権限付与のガイドライン">権限付与のガイドライン</a></p></li><li class="listitem"><p><a class="xref" href="security.html#static-dynamic-privileges" title="静的権限と動的権限">静的権限と動的権限</a></p></li><li class="listitem"><p><a class="xref" href="security.html#dynamic-privileges-migration-from-super" title="SUPER から動的権限へのアカウントの移行">SUPER から動的権限へのアカウントの移行</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="privileges-provided-summary"></a>使用可能な権限のサマリー</h4></div></div></div><p>
        次のテーブルに、<code class="literal">GRANT</code> および <code class="literal">REVOKE</code> ステートメントで使用される静的権限名と、付与テーブルの各権限に関連付けられたカラム名および権限が適用されるコンテキストを示します。
      </p><div class="table"><a name="idm46723765884112"></a><p class="title"><b>表 6.2 GRANT および REVOKE に許可される静的権限</b></p><div class="table-contents"><table><col style="width=30%"><col style="width=33%"><col style="width=37%"><thead><tr>
            <th scope="col">権限</th>
            <th scope="col">付与テーブルカラム</th>
            <th scope="col">コンテキスト</th>
          </tr></thead><tbody><tr>
            <th scope="row"><code class="literal">ALL [PRIVILEGES]</code></th>
            <td><span class="quote">「<span class="quote">「すべての権限」</span>」</span>のシノニム</td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">ALTER</code></th>
            <td><code class="literal">Alter_priv</code></td>
            <td>テーブル</td>
          </tr><tr>
            <th scope="row"><code class="literal">ALTER ROUTINE</code></th>
            <td><code class="literal">Alter_routine_priv</code></td>
            <td>ストアドルーチン</td>
          </tr><tr>
            <th scope="row"><code class="literal">CREATE</code></th>
            <td><code class="literal">Create_priv</code></td>
            <td>データベース、テーブルまたはインデックス</td>
          </tr><tr>
            <th scope="row"><code class="literal">CREATE ROLE</code></th>
            <td><code class="literal">Create_role_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">CREATE ROUTINE</code></th>
            <td><code class="literal">Create_routine_priv</code></td>
            <td>ストアドルーチン</td>
          </tr><tr>
            <th scope="row"><code class="literal">CREATE TABLESPACE</code></th>
            <td><code class="literal">Create_tablespace_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">CREATE TEMPORARY TABLES</code></th>
            <td><code class="literal">Create_tmp_table_priv</code></td>
            <td>テーブル</td>
          </tr><tr>
            <th scope="row"><code class="literal">CREATE USER</code></th>
            <td><code class="literal">Create_user_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">CREATE VIEW</code></th>
            <td><code class="literal">Create_view_priv</code></td>
            <td>ビュー</td>
          </tr><tr>
            <th scope="row"><code class="literal">DELETE</code></th>
            <td><code class="literal">Delete_priv</code></td>
            <td>テーブル</td>
          </tr><tr>
            <th scope="row"><code class="literal">DROP</code></th>
            <td><code class="literal">Drop_priv</code></td>
            <td>データベース、テーブルまたはビュー</td>
          </tr><tr>
            <th scope="row"><code class="literal">DROP ROLE</code></th>
            <td><code class="literal">Drop_role_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">EVENT</code></th>
            <td><code class="literal">Event_priv</code></td>
            <td>データベース</td>
          </tr><tr>
            <th scope="row"><code class="literal">EXECUTE</code></th>
            <td><code class="literal">Execute_priv</code></td>
            <td>ストアドルーチン</td>
          </tr><tr>
            <th scope="row"><code class="literal">FILE</code></th>
            <td><code class="literal">File_priv</code></td>
            <td>サーバーホストでのファイルアクセス</td>
          </tr><tr>
            <th scope="row"><code class="literal">GRANT OPTION</code></th>
            <td><code class="literal">Grant_priv</code></td>
            <td>データベース、テーブル、またはストアドルーチン</td>
          </tr><tr>
            <th scope="row"><code class="literal">INDEX</code></th>
            <td><code class="literal">Index_priv</code></td>
            <td>テーブル</td>
          </tr><tr>
            <th scope="row"><code class="literal">INSERT</code></th>
            <td><code class="literal">Insert_priv</code></td>
            <td>テーブルまたはカラム</td>
          </tr><tr>
            <th scope="row"><code class="literal">LOCK TABLES</code></th>
            <td><code class="literal">Lock_tables_priv</code></td>
            <td>データベース</td>
          </tr><tr>
            <th scope="row"><code class="literal">PROCESS</code></th>
            <td><code class="literal">Process_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">PROXY</code></th>
            <td><code class="literal">proxies_priv</code> テーブルを参照</td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">REFERENCES</code></th>
            <td><code class="literal">References_priv</code></td>
            <td>データベースまたはテーブル</td>
          </tr><tr>
            <th scope="row"><code class="literal">RELOAD</code></th>
            <td><code class="literal">Reload_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">REPLICATION CLIENT</code></th>
            <td><code class="literal">Repl_client_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">REPLICATION SLAVE</code></th>
            <td><code class="literal">Repl_slave_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">SELECT</code></th>
            <td><code class="literal">Select_priv</code></td>
            <td>テーブルまたはカラム</td>
          </tr><tr>
            <th scope="row"><code class="literal">SHOW DATABASES</code></th>
            <td><code class="literal">Show_db_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">SHOW VIEW</code></th>
            <td><code class="literal">Show_view_priv</code></td>
            <td>ビュー</td>
          </tr><tr>
            <th scope="row"><code class="literal">SHUTDOWN</code></th>
            <td><code class="literal">Shutdown_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">SUPER</code></th>
            <td><code class="literal">Super_priv</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <th scope="row"><code class="literal">TRIGGER</code></th>
            <td><code class="literal">Trigger_priv</code></td>
            <td>テーブル</td>
          </tr><tr>
            <th scope="row"><code class="literal">UPDATE</code></th>
            <td><code class="literal">Update_priv</code></td>
            <td>テーブルまたはカラム</td>
          </tr><tr>
            <th scope="row"><code class="literal">USAGE</code></th>
            <td><span class="quote">「<span class="quote">権限なし</span>」</span>のシノニムです</td>
            <td>サーバー管理</td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        次のテーブルに、<code class="literal">GRANT</code> および <code class="literal">REVOKE</code> ステートメントで使用される動的権限名と、その権限が適用されるコンテキストを示します。
      </p><div class="table"><a name="idm46723765723312"></a><p class="title"><b>表 6.3 GRANT および REVOKE に許可される動的権限</b></p><div class="table-contents"><table><col style="width=35%"><col style="width=45%"><thead><tr>
            <th>権限</th>
            <th>コンテキスト</th>
          </tr></thead><tbody><tr>
            <td><code class="literal">APPLICATION_PASSWORD_ADMIN</code></td>
            <td>デュアルパスワード管理</td>
          </tr><tr>
            <td><code class="literal">AUDIT_ADMIN</code></td>
            <td>監査ログの管理</td>
          </tr><tr>
            <td><code class="literal">BACKUP_ADMIN</code></td>
            <td>バックアップ管理</td>
          </tr><tr>
            <td><code class="literal">BINLOG_ADMIN</code></td>
            <td>バックアップとレプリケーションの管理</td>
          </tr><tr>
            <td><code class="literal">BINLOG_ENCRYPTION_ADMIN</code></td>
            <td>バックアップとレプリケーションの管理</td>
          </tr><tr>
            <td><code class="literal">CLONE_ADMIN</code></td>
            <td>クローン管理</td>
          </tr><tr>
            <td><code class="literal">CONNECTION_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">ENCRYPTION_KEY_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">FIREWALL_ADMIN</code></td>
            <td>ファイアウォール管理</td>
          </tr><tr>
            <td><code class="literal">FIREWALL_USER</code></td>
            <td>ファイアウォール管理</td>
          </tr><tr>
            <td><code class="literal">FLUSH_OPTIMIZER_COSTS</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">FLUSH_STATUS</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">FLUSH_TABLES</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">FLUSH_USER_RESOURCES</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">GROUP_REPLICATION_ADMIN</code></td>
            <td>レプリケーション管理</td>
          </tr><tr>
            <td><code class="literal">INNODB_REDO_LOG_ARCHIVE</code></td>
            <td>redo ログアーカイブ管理</td>
          </tr><tr>
            <td><code class="literal">NDB_STORED_USER</code></td>
            <td>NDB Cluster</td>
          </tr><tr>
            <td><code class="literal">PERSIST_RO_VARIABLES_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">REPLICATION_APPLIER</code></td>
            <td>レプリケーションチャネル用の <code class="literal">PRIVILEGE_CHECKS_USER</code></td>
          </tr><tr>
            <td><code class="literal">REPLICATION_SLAVE_ADMIN</code></td>
            <td>レプリケーション管理</td>
          </tr><tr>
            <td><code class="literal">RESOURCE_GROUP_ADMIN</code></td>
            <td>リソースグループ管理</td>
          </tr><tr>
            <td><code class="literal">RESOURCE_GROUP_USER</code></td>
            <td>リソースグループ管理</td>
          </tr><tr>
            <td><code class="literal">ROLE_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">SESSION_VARIABLES_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">SET_USER_ID</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">SHOW_ROUTINE</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">SYSTEM_USER</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">SYSTEM_VARIABLES_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">TABLE_ENCRYPTION_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">VERSION_TOKEN_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr><tr>
            <td><code class="literal">XA_RECOVER_ADMIN</code></td>
            <td>サーバー管理</td>
          </tr></tbody></table></div></div><br class="table-break"></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="privileges-provided-static"></a>静的権限の説明</h4></div></div></div><p>
        静的権限は、実行時に定義される動的権限とは対照的に、サーバーに組み込まれます。 次のリストでは、MySQL で使用可能な各静的権限について説明します。 
      </p><p>
        特定の SQL ステートメントには、ここに示されているよりも具体的な権限要件がある場合もあります。 そのような場合、該当するステートメントの説明で詳細を示します。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="priv_all"></a>
            <code class="literal">ALL</code>, <code class="literal">ALL PRIVILEGES</code>
          </p><a class="indexterm" name="idm46723765622256"></a><a class="indexterm" name="idm46723765620544"></a><a class="indexterm" name="idm46723765619088"></a><a class="indexterm" name="idm46723765617424"></a><p>
            これらの権限指定子は、<span class="quote">「<span class="quote">「特定の権限レベルで使用可能なすべての権限」</span>」</span> (<code class="literal">GRANT OPTION</code> を除く) の短縮形です。 たとえば、グローバルレベルまたはテーブルレベルで <code class="literal">ALL</code> を付与すると、すべてのグローバル権限またはすべてのテーブルレベル権限がそれぞれ付与されます。 
          </p></li><li class="listitem"><p><a name="priv_alter"></a>
            <code class="literal">ALTER</code>
          </p><a class="indexterm" name="idm46723765610480"></a><a class="indexterm" name="idm46723765608448"></a><p>
            <code class="literal">ALTER TABLE</code> ステートメントを使用してテーブルの構造を変更できます。 <code class="literal">ALTER TABLE</code> には <code class="literal">CREATE</code> および <code class="literal">INSERT</code> 権限も必要です。 テーブルの名前を変更するには、古いテーブルで <code class="literal">ALTER</code> および <code class="literal">DROP</code> を、新しいテーブルで <code class="literal">CREATE</code> および <code class="literal">INSERT</code> を実行する必要があります。 
          </p></li><li class="listitem"><p><a name="priv_alter-routine"></a>
            <code class="literal">ALTER ROUTINE</code>
          </p><a class="indexterm" name="idm46723765596112"></a><a class="indexterm" name="idm46723765594336"></a><p>
            ストアドルーチン (ストアドプロシージャーおよびストアドファンクション) を変更または削除するステートメントの使用を有効にします。 権限が付与されるスコープ内にあり、ユーザーがルーチン <code class="literal">DEFINER</code> として指定されたユーザーではないルーチンの場合、ルーチン定義以外のルーチンプロパティーへのアクセスも有効になります。 
          </p></li><li class="listitem"><p><a name="priv_create"></a>
            <code class="literal">CREATE</code>
          </p><a class="indexterm" name="idm46723765588704"></a><a class="indexterm" name="idm46723765586928"></a><p>
            新しいデータベースおよびテーブルを作成するステートメントの使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_create-role"></a>
            <code class="literal">CREATE ROLE</code>
          </p><a class="indexterm" name="idm46723765582672"></a><a class="indexterm" name="idm46723765580896"></a><p>
            <code class="literal">CREATE ROLE</code> ステートメントの使用を有効にします。 (<code class="literal">CREATE USER</code> 権限により、<code class="literal">CREATE ROLE</code> ステートメントの使用も可能になります。) <a class="xref" href="security.html#roles" title="6.2.10 ロールの使用">セクション6.2.10「ロールの使用」</a>を参照してください。 
          </p><p>
            <code class="literal">CREATE ROLE</code> および <code class="literal">DROP ROLE</code> 権限は、アカウントの作成および削除にのみ使用できるため、<code class="literal">CREATE USER</code> ほど強力ではありません。 これらは、<code class="literal">CREATE USER</code> でアカウント属性を変更したり、アカウントの名前を変更できるため、使用できません。 <a class="xref" href="security.html#role-user-interchangeability" title="ユーザーとロールの互換性">ユーザーとロールの互換性</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_create-routine"></a>
            <code class="literal">CREATE ROUTINE</code>
          </p><a class="indexterm" name="idm46723765567280"></a><a class="indexterm" name="idm46723765565504"></a><p>
            ストアドルーチン (ストアドプロシージャーとストアドファンクション) を作成するステートメントの使用を有効にします。 権限が付与されるスコープ内にあり、ユーザーがルーチン <code class="literal">DEFINER</code> として指定されたユーザーではないルーチンの場合、ルーチン定義以外のルーチンプロパティーへのアクセスも有効になります。 
          </p></li><li class="listitem"><p><a name="priv_create-tablespace"></a>
            <code class="literal">CREATE TABLESPACE</code>
          </p><a class="indexterm" name="idm46723765559920"></a><a class="indexterm" name="idm46723765558144"></a><p>
            テーブルスペースおよびログファイルグループを作成、変更または削除するステートメントを使用可能にします。
          </p></li><li class="listitem"><p><a name="priv_create-temporary-tables"></a>
            <code class="literal">CREATE TEMPORARY TABLES</code>
          </p><a class="indexterm" name="idm46723765553712"></a><a class="indexterm" name="idm46723765551936"></a><p>
            <code class="literal">CREATE TEMPORARY TABLE</code> ステートメントを使用した一時テーブルの作成を有効にします。
          </p><a class="indexterm" name="idm46723765549024"></a><a class="indexterm" name="idm46723765546848"></a><p>
            セッションが一時テーブルを作成したあと、サーバーはそのテーブルに対するそれ以上の権限チェックを実行しません。 セッションの作成によって、<code class="literal">DROP TABLE</code>、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">SELECT</code> などのあらゆる操作をテーブル上で実行できます。 詳細は、<a class="xref" href="sql-statements.html#create-temporary-table" title="13.1.20.2 CREATE TEMPORARY TABLE ステートメント">セクション13.1.20.2「CREATE TEMPORARY TABLE ステートメント」</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_create-user"></a>
            <code class="literal">CREATE USER</code>
          </p><a class="indexterm" name="idm46723765537520"></a><a class="indexterm" name="idm46723765535744"></a><p>
            <code class="literal">ALTER USER</code>, <code class="literal">CREATE ROLE</code>, <code class="literal">CREATE USER</code>, <code class="literal">DROP ROLE</code>, <code class="literal">DROP USER</code>, <code class="literal">RENAME USER</code> および <code class="literal">REVOKE ALL PRIVILEGES</code> ステートメントの使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_create-view"></a>
            <code class="literal">CREATE VIEW</code>
          </p><a class="indexterm" name="idm46723765524608"></a><a class="indexterm" name="idm46723765522832"></a><p>
            <code class="literal">CREATE VIEW</code> ステートメントの使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_delete"></a>
            <code class="literal">DELETE</code>
          </p><a class="indexterm" name="idm46723765517760"></a><a class="indexterm" name="idm46723765515984"></a><p>
            データベース内のテーブルから行を削除できます。
          </p></li><li class="listitem"><p><a name="priv_drop"></a>
            <code class="literal">DROP</code>
          </p><a class="indexterm" name="idm46723765511936"></a><a class="indexterm" name="idm46723765510160"></a><p>
            既存のデータベース、テーブルおよびビューを削除するステートメントを使用可能にします。 パーティションテーブルで <code class="literal">ALTER TABLE ... DROP PARTITION</code> ステートメントを使用するには、<code class="literal">DROP</code> 権限が必要です。 <code class="literal">DROP</code> 権限は <code class="literal">TRUNCATE TABLE</code> のためにも必要です。 
          </p></li><li class="listitem"><p><a name="priv_drop-role"></a>
            <code class="literal">DROP ROLE</code>
          </p><a class="indexterm" name="idm46723765501968"></a><a class="indexterm" name="idm46723765500192"></a><p>
            <code class="literal">DROP ROLE</code> ステートメントの使用を有効にします。 (<code class="literal">CREATE USER</code> 権限により、<code class="literal">DROP ROLE</code> ステートメントの使用も可能になります。) <a class="xref" href="security.html#roles" title="6.2.10 ロールの使用">セクション6.2.10「ロールの使用」</a>を参照してください。 
          </p><p>
            <code class="literal">CREATE ROLE</code> および <code class="literal">DROP ROLE</code> 権限は、アカウントの作成および削除にのみ使用できるため、<code class="literal">CREATE USER</code> ほど強力ではありません。 これらは、<code class="literal">CREATE USER</code> でアカウント属性を変更したり、アカウントの名前を変更できるため、使用できません。 <a class="xref" href="security.html#role-user-interchangeability" title="ユーザーとロールの互換性">ユーザーとロールの互換性</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_event"></a>
            <code class="literal">EVENT</code>
          </p><a class="indexterm" name="idm46723765486768"></a><a class="indexterm" name="idm46723765484992"></a><p>
            イベントスケジューラのイベントを作成、変更、削除、または表示するステートメントの使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_execute"></a>
            <code class="literal">EXECUTE</code>
          </p><a class="indexterm" name="idm46723765480672"></a><a class="indexterm" name="idm46723765478896"></a><p>
            ストアドルーチン (ストアドプロシージャーとストアドファンクション) を実行するステートメントの使用を有効にします。 権限が付与されるスコープ内にあり、ユーザーがルーチン <code class="literal">DEFINER</code> として指定されたユーザーではないルーチンの場合、ルーチン定義以外のルーチンプロパティーへのアクセスも有効になります。 
          </p></li><li class="listitem"><p><a name="priv_file"></a>
            <code class="literal">FILE</code>
          </p><a class="indexterm" name="idm46723765473344"></a><a class="indexterm" name="idm46723765471568"></a><p>
            次の操作およびサーバーの動作に影響します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">LOAD DATA</code> および <code class="literal">SELECT ... INTO OUTFILE</code> ステートメントと <code class="literal">LOAD_FILE()</code> 関数を使用して、サーバーホスト上のファイルの読取りおよび書込みを有効にします。 <code class="literal">FILE</code> 権限を持つユーザーは、すべてのユーザーから読み取り可能であるか、MySQL サーバーによって読み取り可能なサーバーホスト上のすべてのファイルを読み取ることができます。 (このことは暗黙的に、データベースディレクトリ内のあらゆるファイルにサーバーからアクセスできるため、ユーザーはそれらのすべてのファイルを読み取ることができることを意味します。) 
              </p></li><li class="listitem"><p>
                MySQL サーバーが書込みアクセス権を持つ任意のディレクトリに新しいファイルを作成できます。 これは、権限テーブルを実装するファイルを格納するサーバーのデータディレクトリを含みます。 
              </p></li><li class="listitem"><p>
                <code class="literal">CREATE TABLE</code> ステートメントに <code class="literal">DATA DIRECTORY</code> または <code class="literal">INDEX DIRECTORY</code> テーブルオプションを使用できるようにします。
              </p></li></ul></div><p>
            セキュリティ対策として、サーバーは既存のファイルを上書きしません。
          </p><p>
            ファイルの読取りおよび書込みが可能な場所を制限するには、<code class="literal">secure_file_priv</code> システム変数を特定のディレクトリに設定します。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_grant-option"></a>
            <code class="literal">GRANT OPTION</code>
          </p><a class="indexterm" name="idm46723765453456"></a><a class="indexterm" name="idm46723765451680"></a><p>
            自分が所有する権限を他のユーザーに付与したり、他のユーザーから取り消すことができます。
          </p></li><li class="listitem"><p><a name="priv_index"></a>
            <code class="literal">INDEX</code>
          </p><a class="indexterm" name="idm46723765447392"></a><a class="indexterm" name="idm46723765445616"></a><p>
            インデックスを作成または削除するステートメントの使用を有効にします。 <code class="literal">INDEX</code> は既存のテーブルに適用されます。 テーブルに対する <code class="literal">CREATE</code> 権限を持つ場合、<code class="literal">CREATE TABLE</code> ステートメントにインデックス定義を含めることも可能です。 
          </p></li><li class="listitem"><p><a name="priv_insert"></a>
            <code class="literal">INSERT</code>
          </p><a class="indexterm" name="idm46723765438160"></a><a class="indexterm" name="idm46723765436384"></a><p>
            データベースのテーブルに行を挿入できます。 <code class="literal">ANALYZE TABLE</code>、<code class="literal">OPTIMIZE TABLE</code>、<code class="literal">REPAIR TABLE</code> などのテーブル保守に関するステートメントにも、<code class="literal">INSERT</code> 権限が必要です。 
          </p></li><li class="listitem"><p><a name="priv_lock-tables"></a>
            <code class="literal">LOCK TABLES</code>
          </p><a class="indexterm" name="idm46723765428096"></a><a class="indexterm" name="idm46723765426320"></a><p>
            明示的な <code class="literal">LOCK TABLES</code> ステートメントを使用して、<code class="literal">SELECT</code> 権限を持つテーブルをロックできます。 これには、他のセッションによるロックされたテーブルの読取りを防止する書込みロックの使用が含まれます。 
          </p></li><li class="listitem"><p><a name="priv_process"></a>
            <code class="literal">PROCESS</code>
          </p><a class="indexterm" name="idm46723765419888"></a><a class="indexterm" name="idm46723765418112"></a><p>
            <code class="literal">PROCESS</code> 権限は、サーバー内で実行されているスレッドに関する情報 (セッションによって実行されているステートメントに関する情報) へのアクセスを制御します。 <code class="literal">SHOW PROCESSLIST</code> ステートメント、<span class="command"><strong>mysqladmin processlist</strong></span> コマンド、<code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code> テーブル、およびパフォーマンススキーマ <code class="literal">processlist</code> テーブルを使用して使用可能なスレッド情報には、次のようにアクセスできます: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">PROCESS</code> 権限を持つユーザーは、他のユーザーに属するスレッドも含め、すべてのスレッドに関する情報にアクセスできます。
              </p></li><li class="listitem"><p>
                <code class="literal">PROCESS</code> 権限がない場合、非匿名ユーザーは自分のスレッドに関する情報にアクセスできますが、他のユーザーのスレッドにはアクセスできません。また、匿名ユーザーはスレッド情報にアクセスできません。
              </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              パフォーマンススキーマ <code class="literal">threads</code> テーブルはスレッド情報も提供しますが、テーブルアクセスは別の特権モデルを使用します。 <a class="xref" href="performance-schema.html#performance-schema-threads-table" title="27.12.19.10 スレッドテーブル">セクション27.12.19.10「スレッドテーブル」</a>を参照してください。 
            </p></div><p>
            <code class="literal">PROCESS</code> 権限では、<code class="literal">SHOW ENGINE</code> ステートメントの使用、<code class="literal">INFORMATION_SCHEMA</code> <code class="literal">InnoDB</code> テーブル (<code class="literal">INNODB_</code>で始まる名前を持つテーブル) へのアクセスおよび、(MySQL 8.0.21 の時点で) <code class="literal">INFORMATION_SCHEMA</code> <code class="literal">FILES</code> テーブルへのアクセスも可能です。
          </p></li><li class="listitem"><p><a name="priv_proxy"></a>
            <code class="literal">PROXY</code>
          </p><a class="indexterm" name="idm46723765394640"></a><a class="indexterm" name="idm46723765392864"></a><p>
            あるユーザーが別のユーザーになりすましたり、別のユーザーとして知られるようにします。 <a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_references"></a>
            <code class="literal">REFERENCES</code>
          </p><a class="indexterm" name="idm46723765387904"></a><a class="indexterm" name="idm46723765386128"></a><p>
            外部キー制約を作成するには、親テーブルに対する <code class="literal">REFERENCES</code> 権限が必要です。
          </p></li><li class="listitem"><p><a name="priv_reload"></a>
            <code class="literal">RELOAD</code>
          </p><a class="indexterm" name="idm46723765380944"></a><a class="indexterm" name="idm46723765379168"></a><p>
            <code class="literal">RELOAD</code> では、次の操作が可能です:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">FLUSH</code> ステートメントの使用。
              </p></li><li class="listitem"><p>
                <code class="literal">FLUSH</code> 操作と同等の <span class="command"><strong>mysqladmin</strong></span> コマンドの使用: <code class="literal">flush-hosts</code>, <code class="literal">flush-logs</code>, <code class="literal">flush-privileges</code>, <code class="literal">flush-status</code>, <code class="literal">flush-tables</code>, <code class="literal">flush-threads</code>, <code class="literal">refresh</code> および <code class="literal">reload</code>。
              </p><p>
                <code class="literal">reload</code> コマンドは、付与テーブルをメモリーにリロードするようにサーバーに指示します。<code class="literal">flush-privileges</code> は <code class="literal">reload</code> のシノニムです。 <code class="literal">refresh</code> コマンドは、ログファイルを閉じて再オープンし、すべてのテーブルをフラッシュします。 ほかの <code class="literal">flush-<em class="replaceable"><code>xxx</code></em></code> コマンドは <code class="literal">refresh</code> に類似した機能を実行しますが、より具体的であるため一部の状況では好ましい場合があります。 たとえば、ログファイルだけをフラッシュするときは、<code class="literal">refresh</code> よりも <code class="literal">flush-logs</code> を選択することをお勧めします。 
              </p></li><li class="listitem"><p>
                様々な <code class="literal">FLUSH</code> 操作を実行する <span class="command"><strong>mysqldump</strong></span> オプションの使用: <code class="option">--flush-logs</code> および <code class="option">--master-data</code>。
              </p></li><li class="listitem"><p>
                <code class="literal">RESET MASTER</code> および <code class="literal">RESET REPLICA | SLAVE</code> ステートメントの使用。
              </p></li></ul></div></li><li class="listitem"><p><a name="priv_replication-client"></a>
            <code class="literal">REPLICATION CLIENT</code>
          </p><a class="indexterm" name="idm46723765349280"></a><a class="indexterm" name="idm46723765347504"></a><p>
            <code class="literal">SHOW MASTER STATUS</code>、<code class="literal">SHOW REPLICA | SLAVE STATUS</code> および <code class="literal">SHOW BINARY LOGS</code> ステートメントの使用を有効にします。 レプリカがレプリケーションソースサーバーとして現在のサーバーに接続するために使用するアカウントにこの権限を付与します。 
          </p></li><li class="listitem"><p><a name="priv_replication-slave"></a>
            <code class="literal">REPLICATION SLAVE</code>
          </p><a class="indexterm" name="idm46723765339776"></a><a class="indexterm" name="idm46723765338000"></a><p>
            <code class="literal">SHOW REPLICAS | SHOW SLAVE HOSTS</code>、<code class="literal">SHOW RELAYLOG EVENTS</code> および <code class="literal">SHOW BINLOG EVENTS</code> ステートメントを使用して、レプリケーションソースサーバー上のデータベースに対して行われた更新をアカウントがリクエストできるようにします。 この権限は、<span class="command"><strong>mysqlbinlog</strong></span> オプションの <code class="option">--read-from-remote-server</code> (<code class="option">-R</code>) および <code class="option">--read-from-remote-master</code> を使用する場合にも必要です。 レプリカがレプリケーションソースサーバーとして現在のサーバーに接続するために使用するアカウントにこの権限を付与します。 
          </p></li><li class="listitem"><p><a name="priv_select"></a>
            <code class="literal">SELECT</code>
          </p><a class="indexterm" name="idm46723765327248"></a><a class="indexterm" name="idm46723765325472"></a><p>
            データベース内のテーブルから行を選択できます。 <code class="literal">SELECT</code> ステートメントには、実際にテーブルにアクセスする場合にのみ <code class="literal">SELECT</code> 権限が必要です。 一部の <code class="literal">SELECT</code> ステートメントはテーブルにアクセスしないため、あらゆるデータベースへのアクセス権がなくても実行できます。 たとえば、テーブルを参照しない式を評価するための単純な計算機として <code class="literal">SELECT</code> を使用することができます。 
          </p><pre class="programlisting">SELECT 1+1;
SELECT PI()*2;
</pre><p>
            <code class="literal">SELECT</code> 権限は、カラム値を読み取るほかのステートメントについても必要です。 たとえば、<code class="literal">UPDATE</code> ステートメントの代入 <em class="replaceable"><code>col_name</code></em>=<em class="replaceable"><code>expr</code></em> の右辺で参照されるカラムや、<code class="literal">DELETE</code> または <code class="literal">UPDATE</code> ステートメントの <code class="literal">WHERE</code> 句で指定されるカラムについて、<code class="literal">SELECT</code> が必要です。 
          </p><p>
            <code class="literal">EXPLAIN</code> で使用されるテーブルまたはビュー (ビュー定義の基礎となるテーブルを含む) には、<code class="literal">SELECT</code> 権限が必要です。
          </p></li><li class="listitem"><p><a name="priv_show-databases"></a>
            <code class="literal">SHOW DATABASES</code>
          </p><a class="indexterm" name="idm46723765305600"></a><a class="indexterm" name="idm46723765303824"></a><p>
            <code class="literal">SHOW DATABASE</code> ステートメントを発行して、アカウントがデータベース名を表示できるようにします。 この権限を持たないアカウントには、アカウントが一部の権限を持つデータベースしか表示されず、サーバーが <code class="option">--skip-show-database</code> オプションで起動されている場合はステートメントを一切使用できません。 
          </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注意</div><p>
              静的グローバル権限はすべてのデータベースに対する権限とみなされるため、静的グローバル権限を使用すると、ユーザーは、部分的な取消しによってデータベースレベルで制限されているデータベースを除き、<code class="literal">SHOW DATABASES</code> を使用するか、<code class="literal">INFORMATION_SCHEMA</code> の <code class="literal">SCHEMATA</code> テーブルを調べることで、すべてのデータベース名を表示できます。
            </p></div></li><li class="listitem"><p><a name="priv_show-view"></a>
            <code class="literal">SHOW VIEW</code>
          </p><a class="indexterm" name="idm46723765293424"></a><a class="indexterm" name="idm46723765291648"></a><p>
            <code class="literal">SHOW CREATE VIEW</code> ステートメントの使用を有効にします。 この権限は、<code class="literal">EXPLAIN</code> で使用されるビューにも必要です。 
          </p></li><li class="listitem"><p><a name="priv_shutdown"></a>
            <code class="literal">SHUTDOWN</code>
          </p><a class="indexterm" name="idm46723765285472"></a><a class="indexterm" name="idm46723765283696"></a><p>
            <code class="literal">SHUTDOWN</code> および <code class="literal">RESTART</code> ステートメント、<span class="command"><strong>mysqladmin shutdown</strong></span> コマンドおよび <code class="literal">mysql_shutdown()</code> C API 関数の使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_super"></a>
            <code class="literal">SUPER</code>
          </p><a class="indexterm" name="idm46723765275888"></a><a class="indexterm" name="idm46723765274112"></a><p>
            <code class="literal">SUPER</code> は強力で遠いリカバリ権限であるため、軽く付与しないでください。 アカウントで <code class="literal">SUPER</code> 操作のサブセットのみを実行する必要がある場合は、かわりに 1 つ以上の動的権限を付与することで、必要な権限セットを実現できる場合があり、それぞれがより制限された機能を構成します。 <a class="xref" href="security.html#privileges-provided-dynamic" title="動的権限の説明">動的権限の説明</a>を参照してください。 
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <code class="literal">SUPER</code> は非推奨であり、将来のバージョンの MySQL で削除される予定です。 <a class="xref" href="security.html#dynamic-privileges-migration-from-super" title="SUPER から動的権限へのアカウントの移行">SUPER から動的権限へのアカウントの移行</a>を参照してください。 
            </p></div><p>
            <code class="literal">SUPER</code> は、次の操作およびサーバーの動作に影響します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                実行時のシステム変数の変更を有効にします:
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    <code class="literal">SET GLOBAL</code> および <code class="literal">SET PERSIST</code> を使用して、グローバルシステム変数に対するサーバー構成の変更を有効にします。
                  </p><p>
                    対応する動的権限は <code class="literal">SYSTEM_VARIABLES_ADMIN</code> です。
                  </p></li><li class="listitem"><p>
                    特別な権限を必要とする制限付きセッションシステム変数の設定を有効にします。
                  </p><p>
                    対応する動的権限は <code class="literal">SESSION_VARIABLES_ADMIN</code> です。
                  </p></li></ul></div><p>
                <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 システム変数権限">セクション5.1.9.1「システム変数権限」</a>も参照してください。
              </p></li><li class="listitem"><p>
                グローバルトランザクション特性の変更を有効にします (<a class="xref" href="sql-statements.html#set-transaction" title="13.3.7 SET TRANSACTION ステートメント">セクション13.3.7「SET TRANSACTION ステートメント」</a> を参照)。
              </p><p>
                対応する動的権限は <code class="literal">SYSTEM_VARIABLES_ADMIN</code> です。
              </p></li><li class="listitem"><p>
                グループレプリケーションを含む、レプリケーションを開始および停止するアカウントを有効にします。
              </p><p>
                対応する動的権限は、通常のレプリケーションの場合は <code class="literal">REPLICATION_SLAVE_ADMIN</code>、グループレプリケーションの場合は <code class="literal">GROUP_REPLICATION_ADMIN</code> です。
              </p></li><li class="listitem"><p>
                (MySQL 8.0.23 の)<code class="literal">CHANGE REPLICATION SOURCE TO</code> ステートメント、(MySQL 8.0.23 の前の)<code class="literal">CHANGE MASTER TO</code> ステートメントおよび <code class="literal">CHANGE REPLICATION FILTER</code> ステートメントを使用できます。
              </p><p>
                対応する動的権限は <code class="literal">REPLICATION_SLAVE_ADMIN</code> です。
              </p></li><li class="listitem"><p>
                <code class="literal">PURGE BINARY LOGS</code> および <code class="literal">BINLOG</code> ステートメントを使用してバイナリログ制御を有効にします。
              </p><p>
                対応する動的権限は <code class="literal">BINLOG_ADMIN</code> です。
              </p></li><li class="listitem"><p>
                ビューまたはストアドプログラムの実行時に有効な承認 ID を設定できるようにします。 この権限を持つユーザーは、ビューまたはストアドプログラムの <code class="literal">DEFINER</code> 属性で任意のアカウントを指定できます。 
              </p><p>
                対応する動的権限は <code class="literal">SET_USER_ID</code> です。
              </p></li><li class="listitem"><p>
                <code class="literal">CREATE SERVER</code>、<code class="literal">ALTER SERVER</code> および <code class="literal">DROP SERVER</code> ステートメントの使用を有効にします。
              </p></li><li class="listitem"><p>
                <span class="command"><strong>mysqladmin debug</strong></span> コマンドの使用を有効にします。
              </p></li><li class="listitem"><p>
                <code class="literal">InnoDB</code> 暗号化キーのローテーションを有効にします。
              </p><p>
                対応する動的権限は <code class="literal">ENCRYPTION_KEY_ADMIN</code> です。
              </p></li><li class="listitem"><p>
                バージョントークンのユーザー定義関数の実行を有効にします。
              </p><p>
                対応する動的権限は <code class="literal">VERSION_TOKEN_ADMIN</code> です。
              </p></li><li class="listitem"><p>
                ロールの付与と取消し、<code class="literal">GRANT</code> ステートメントの <code class="literal">WITH ADMIN OPTION</code> 句の使用、および <code class="literal">ROLES_GRAPHML()</code> 関数からの結果の空でない <code class="literal">&lt;graphml&gt;</code> 要素コンテンツを有効にします。
              </p><p>
                対応する動的権限は <code class="literal">ROLE_ADMIN</code> です。
              </p></li><li class="listitem"><p>
                <code class="literal">SUPER</code> 以外のアカウントに対して許可されていないクライアント接続の制御を有効にします:
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    <code class="literal">KILL</code> ステートメントまたは <span class="command"><strong>mysqladmin kill</strong></span> コマンドを使用して、他のアカウントに属するスレッドを強制終了できます。 (アカウントは常に独自のスレッドを強制終了できます。) 
                  </p></li><li class="listitem"><p>
                    サーバーは、<code class="literal">SUPER</code> クライアントの接続時に <code class="literal">init_connect</code> システム変数の内容を実行しません。
                  </p></li><li class="listitem"><p>
                    サーバーは、<code class="literal">max_connections</code> システム変数で構成された接続制限に達した場合でも、<code class="literal">SUPER</code> クライアントからの接続を受け入れます。
                  </p></li><li class="listitem"><p>
                    オフラインモード (<code class="literal">offline_mode</code> が有効) のサーバーは、次のクライアントリクエスト時に <code class="literal">SUPER</code> クライアント接続を終了せず、<code class="literal">SUPER</code> クライアントからの新しい接続を受け入れます。
                  </p></li><li class="listitem"><p>
                    <code class="literal">read_only</code> システム変数が有効な場合でも、更新を実行できます。 これは、明示的なテーブル更新、およびテーブルを暗黙的に更新する <code class="literal">GRANT</code> や <code class="literal">REVOKE</code> などのアカウント管理ステートメントの使用に適用されます。 
                  </p></li></ul></div><p>
                前述の接続制御操作に対応する動的権限は、<code class="literal">CONNECTION_ADMIN</code> です。
              </p></li></ul></div><p>
            <a class="xref" href="stored-objects.html#stored-programs-logging" title="25.7 ストアドプログラムバイナリロギング">セクション25.7「ストアドプログラムバイナリロギング」</a> で説明されているように、バイナリロギングが有効になっている場合は、ストアドファンクションを作成または変更するために <code class="literal">SUPER</code> 権限が必要になることもあります。
          </p></li><li class="listitem"><p><a name="priv_trigger"></a>
            <code class="literal">TRIGGER</code>
          </p><a class="indexterm" name="idm46723765187792"></a><a class="indexterm" name="idm46723765186016"></a><p>
            トリガー操作を有効にします。 テーブルのトリガーを作成、削除、実行または表示するには、そのテーブルに対するこの権限が必要です。 
          </p><p>
            トリガーが (トリガーに関連付けられたテーブルに対して <code class="literal">INSERT</code>、<code class="literal">UPDATE</code> または <code class="literal">DELETE</code> ステートメントを実行する権限を持つユーザーによって) アクティブ化された場合、トリガーの実行には、トリガーを定義したユーザーがそのテーブルに対する <code class="literal">TRIGGER</code> 権限を持っている必要があります。
          </p></li><li class="listitem"><p><a name="priv_update"></a>
            <code class="literal">UPDATE</code>
          </p><a class="indexterm" name="idm46723765176544"></a><a class="indexterm" name="idm46723765174768"></a><p>
            データベース内のテーブルで行を更新できます。
          </p></li><li class="listitem"><p><a name="priv_usage"></a>
            <code class="literal">USAGE</code>
          </p><a class="indexterm" name="idm46723765170624"></a><a class="indexterm" name="idm46723765168848"></a><p>
            この権限指定子は、<span class="quote">「<span class="quote">「権限なし」</span>」</span>を表します。 <code class="literal">GRANT</code> でグローバルレベルで使用され、権限リスト内の特定のアカウント権限に名前を付けずに <code class="literal">WITH GRANT OPTION</code> などの句を指定します。 <code class="literal">SHOW GRANTS</code> には、アカウントに権限レベルの権限がないことを示す <code class="literal">USAGE</code> が表示されます。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="privileges-provided-dynamic"></a>動的権限の説明</h4></div></div></div><p>
        サーバーに組み込まれている静的権限とは対照的に、動的権限は実行時に定義されます。 次のリストでは、MySQL で使用可能な各動的権限について説明します。 
      </p><p>
        ほとんどの動的権限は、サーバーの起動時に定義されます。 その他は、権限の説明に示されているように、特定のコンポーネントまたはプラグインによって定義されます。 このような場合、権限を定義するコンポーネントまたはプラグインが有効になっていないかぎり、権限は使用できません。 
      </p><p>
        特定の SQL ステートメントには、ここに示されているよりも具体的な権限要件がある場合もあります。 そのような場合、該当するステートメントの説明で詳細を示します。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="priv_application-password-admin"></a>
            <code class="literal">APPLICATION_PASSWORD_ADMIN</code> (MySQL 8.0.14 で追加)
          </p><a class="indexterm" name="idm46723765155600"></a><a class="indexterm" name="idm46723765153792"></a><p>
            デュアルパスワード機能の場合、この権限により、自分のアカウントに適用される <code class="literal">ALTER USER</code> ステートメントおよび <code class="literal">SET PASSWORD</code> ステートメントに <code class="literal">RETAIN CURRENT PASSWORD</code> 句および <code class="literal">DISCARD OLD PASSWORD</code> 句を使用できます。 ほとんどのユーザーは 1 つのパスワードのみを必要とするため、自分のセカンダリパスワードを操作するにはこの権限が必要です。 
          </p><p>
            アカウントがすべてのアカウントのセカンダリパスワードの操作を許可される場合は、<code class="literal">APPLICATION_PASSWORD_ADMIN</code> ではなく <code class="literal">CREATE USER</code> 権限を付与する必要があります。
          </p><p>
            デュアルパスワードの使用の詳細は、<a class="xref" href="security.html#password-management" title="6.2.15 パスワード管理">セクション6.2.15「パスワード管理」</a> を参照してください。
          </p></li><li class="listitem"><p><a name="priv_audit-admin"></a>
            <code class="literal">AUDIT_ADMIN</code>
          </p><a class="indexterm" name="idm46723765141616"></a><a class="indexterm" name="idm46723765139840"></a><p>
            監査ログ構成を有効にします。 この権限は、<code class="literal">audit_log</code> プラグインによって定義されます。<a class="xref" href="security.html#audit-log" title="6.4.5 MySQL Enterprise Audit">セクション6.4.5「MySQL Enterprise Audit」</a> を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_backup-admin"></a>
            <code class="literal">BACKUP_ADMIN</code>
          </p><a class="indexterm" name="idm46723765134176"></a><a class="indexterm" name="idm46723765132400"></a><p>
            <code class="literal">LOCK INSTANCE FOR BACKUP</code> ステートメントの実行およびパフォーマンススキーマ <code class="literal">log_status</code> テーブルへのアクセスを有効にします。
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <code class="literal">BACKUP_ADMIN</code> の他に、<code class="literal">log_status</code> テーブルに対する <code class="literal">SELECT</code> 権限もアクセスに必要です。
            </p></div><p>
            以前のバージョンから MySQL 8.0 へのインプレースアップグレードを実行すると、<code class="literal">RELOAD</code> 権限を持つユーザーに <code class="literal">BACKUP_ADMIN</code> 権限が自動的に付与されます。
          </p></li><li class="listitem"><p><a name="priv_binlog-admin"></a>
            <code class="literal">BINLOG_ADMIN</code>
          </p><a class="indexterm" name="idm46723765119664"></a><a class="indexterm" name="idm46723765117888"></a><p>
            <code class="literal">PURGE BINARY LOGS</code> および <code class="literal">BINLOG</code> ステートメントを使用してバイナリログ制御を有効にします。
          </p></li><li class="listitem"><p><a name="priv_binlog-encryption-admin"></a>
            <code class="literal">BINLOG_ENCRYPTION_ADMIN</code>
          </p><a class="indexterm" name="idm46723765111680"></a><a class="indexterm" name="idm46723765109904"></a><p>
            バイナリログファイルおよびリレーログファイルの暗号化をアクティブまたは非アクティブにするシステム変数 <code class="literal">binlog_encryption</code> の設定を有効にします。 この機能は、<code class="literal">BINLOG_ADMIN</code>、<code class="literal">SYSTEM_VARIABLES_ADMIN</code> または <code class="literal">SESSION_VARIABLES_ADMIN</code> 権限では提供されません。 サーバーの再起動時にバイナリログマスターキーを自動的にローテーションする関連システム変数 <code class="literal">binlog_rotate_encryption_master_key_at_startup</code> には、この権限は必要ありません。 
          </p></li><li class="listitem"><p><a name="priv_clone-admin"></a>
            <code class="literal">CLONE_ADMIN</code>
          </p><a class="indexterm" name="idm46723765100080"></a><a class="indexterm" name="idm46723765098304"></a><p>
            <code class="literal">CLONE</code> ステートメントの実行を有効にします。 <code class="literal">BACKUP_ADMIN</code> および <code class="literal">SHUTDOWN</code> 権限が含まれます。 
          </p></li><li class="listitem"><p><a name="priv_connection-admin"></a>
            <code class="literal">CONNECTION_ADMIN</code>
          </p><a class="indexterm" name="idm46723765091472"></a><a class="indexterm" name="idm46723765089696"></a><p>
            <code class="literal">KILL</code> ステートメントまたは <span class="command"><strong>mysqladmin kill</strong></span> コマンドを使用して、他のアカウントに属するスレッドを強制終了できます。 (アカウントは常に独自のスレッドを強制終了できます。) 
          </p><p>
            クライアント接続に関連するシステム変数の設定、またはクライアント接続に関連する制限の回避を有効にします。 <code class="literal">CONNECTION_ADMIN</code> は、次のシステム変数の影響に適用されます: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">init_connect</code>: サーバーは、<code class="literal">CONNECTION_ADMIN</code> クライアントの接続時に <code class="literal">init_connect</code> システム変数の内容を実行しません。
              </p></li><li class="listitem"><p>
                <code class="literal">max_connections</code>: サーバーは、<code class="literal">max_connections</code> システム変数で構成された接続制限に達した場合でも、<code class="literal">CONNECTION_ADMIN</code> クライアントからの接続を受け入れます。
              </p></li><li class="listitem"><p>
                <code class="literal">offline_mode</code>: オフラインモード (<code class="literal">offline_mode</code> が有効) のサーバーは、次のクライアントリクエスト時に <code class="literal">CONNECTION_ADMIN</code> クライアント接続を終了せず、<code class="literal">CONNECTION_ADMIN</code> クライアントからの新しい接続を受け入れます。
              </p></li><li class="listitem"><p>
                <code class="literal">read_only</code>: <code class="literal">read_only</code> システム変数が有効な場合でも、更新を実行できます。 これは、明示的なテーブル更新、およびテーブルを暗黙的に更新する <code class="literal">GRANT</code> や <code class="literal">REVOKE</code> などのアカウント管理ステートメントの使用に適用されます。 
              </p></li></ul></div></li><li class="listitem"><p><a name="priv_encryption-key-admin"></a>
            <code class="literal">ENCRYPTION_KEY_ADMIN</code>
          </p><a class="indexterm" name="idm46723765060496"></a><a class="indexterm" name="idm46723765058720"></a><p>
            <code class="literal">InnoDB</code> 暗号化キーのローテーションを有効にします。
          </p></li><li class="listitem"><p><a name="priv_firewall-admin"></a>
            <code class="literal">FIREWALL_ADMIN</code>
          </p><a class="indexterm" name="idm46723765053936"></a><a class="indexterm" name="idm46723765052160"></a><p>
            ユーザーは、任意のユーザーのファイアウォールルールを管理できます。 この権限は、<code class="literal">MYSQL_FIREWALL</code> プラグインによって定義されます。<a class="xref" href="security.html#firewall" title="6.4.7 MySQL Enterprise Firewall">セクション6.4.7「MySQL Enterprise Firewall」</a> を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_firewall-user"></a>
            <code class="literal">FIREWALL_USER</code>
          </p><a class="indexterm" name="idm46723765046416"></a><a class="indexterm" name="idm46723765044640"></a><p>
            ユーザーが独自のファイアウォールルールを更新できるようにします。 この権限は、<code class="literal">MYSQL_FIREWALL</code> プラグインによって定義されます。<a class="xref" href="security.html#firewall" title="6.4.7 MySQL Enterprise Firewall">セクション6.4.7「MySQL Enterprise Firewall」</a> を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_flush-optimizer-costs"></a>
            <code class="literal">FLUSH_OPTIMIZER_COSTS</code> (MySQL 8.0.23 で追加)
          </p><a class="indexterm" name="idm46723765038672"></a><a class="indexterm" name="idm46723765036896"></a><p>
            <code class="literal">FLUSH OPTIMIZER_COSTS</code> ステートメントの使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_flush-status"></a>
            <code class="literal">FLUSH_STATUS</code> (MySQL 8.0.23 で追加)
          </p><a class="indexterm" name="idm46723765031808"></a><a class="indexterm" name="idm46723765030032"></a><p>
            <code class="literal">FLUSH STATUS</code> ステートメントの使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_flush-tables"></a>
            <code class="literal">FLUSH_TABLES</code> (MySQL 8.0.23 で追加)
          </p><a class="indexterm" name="idm46723765024864"></a><a class="indexterm" name="idm46723765023088"></a><p>
            <code class="literal">FLUSH TABLES</code> ステートメントの使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_flush-user-resources"></a>
            <code class="literal">FLUSH_USER_RESOURCES</code> (MySQL 8.0.23 で追加)
          </p><a class="indexterm" name="idm46723765017904"></a><a class="indexterm" name="idm46723765016128"></a><p>
            <code class="literal">FLUSH USER_RESOURCES</code> ステートメントの使用を有効にします。
          </p></li><li class="listitem"><p><a name="priv_group-replication-admin"></a>
            <code class="literal">GROUP_REPLICATION_ADMIN</code>
          </p><a class="indexterm" name="idm46723765011056"></a><a class="indexterm" name="idm46723765009280"></a><p>
            <code class="literal">START GROUP REPLICATION</code> および <code class="literal">STOP GROUP REPLICATION</code> ステートメントを使用してグループレプリケーションを開始および停止し、<code class="literal">group_replication_consistency</code> システム変数のグローバル設定を変更し、<code class="literal">group_replication_set_write_concurrency()</code> および <code class="literal">group_replication_set_communication_protocol()</code> UDF を使用できるようにします。 レプリケーショングループのメンバーであるサーバーの管理に使用されるアカウントにこの権限を付与します。 
          </p></li><li class="listitem"><p><a name="priv_innodb-redo-log-archive"></a>
            <code class="literal">INNODB_REDO_LOG_ARCHIVE</code>
          </p><a class="indexterm" name="idm46723764999520"></a><a class="indexterm" name="idm46723764997744"></a><p>
            アカウントが redo ログアーカイブをアクティブ化および非アクティブ化できるようにします。
          </p></li><li class="listitem"><p><a name="priv_innodb-redo-log-enable"></a>
            <code class="literal">INNODB_REDO_LOG_ENABLE</code>
          </p><a class="indexterm" name="idm46723764993504"></a><a class="indexterm" name="idm46723764991728"></a><p>
            <code class="literal">ALTER INSTANCE {ENABLE|DISABLE} INNODB REDO_LOG</code> ステートメントを使用して redo ロギングを有効または無効にします。 MySQL 8.0.21 で導入されました。 
          </p><p>
            <a class="xref" href="innodb-storage-engine.html#innodb-disable-redo-logging" title="redo ロギングの無効化">redo ロギングの無効化</a>を参照してください。
          </p></li><li class="listitem"><p><a name="priv_ndb-stored-user"></a>
            <code class="literal">NDB_STORED_USER</code>
          </p><a class="indexterm" name="idm46723764985088"></a><a class="indexterm" name="idm46723764983056"></a><p>
            特定の NDB Cluster に参加するとすぐに、ユーザーまたは役割とその権限をすべての <code class="literal">NDB</code> 対応 MySQL サーバー間で共有および同期できるようにします。 この権限は、<code class="literal">NDB</code> ストレージエンジンが有効になっている場合にのみ使用できます。 
          </p><p>
            指定されたユーザーまたはロールに対して行われた権限の変更または取消しは、接続されているすべての MySQL サーバー (SQL ノード) とただちに同期化されます。 異なる SQL ノードから発生した権限に影響する複数のステートメントが、すべての SQL ノードで同じ順序で実行されることは保証されないことに注意してください。 このため、すべてのユーザー管理は単一の指定された SQL ノードから実行することを強くお薦めします。 
          </p><p>
            <code class="literal">NDB_STORED_USER</code> はグローバル権限であり、<code class="literal">ON *.*</code> を使用して付与または取り消す必要があります。 この権限に他のスコープを設定しようとすると、エラーになります。 この権限は、ほとんどのアプリケーションユーザーおよび管理ユーザーに付与できますが、<code class="literal">mysql.session@localhost</code> や <code class="literal">mysql.infoschema@localhost</code> などのシステム予約アカウントには付与できません。 
          </p><p>
            <code class="literal">NDB_STORED_USER</code> 権限を付与されたユーザーは、この権限を持つロールと同様に、<code class="literal">NDB</code> に格納されます (したがって、すべての SQL ノードで共有されます)。 <code class="literal">NDB_STORED_USER</code> を持つロールのみを付与されたユーザーは、<code class="literal">NDB</code> には格納されません。各 <code class="literal">NDB</code> 格納ユーザーには、権限を明示的に付与する必要があります。 
          </p><p>
            <code class="literal">NDB</code> でのこの動作の詳細は、<a class="xref" href="mysql-cluster.html#mysql-cluster-privilege-distribution" title="23.5.12 NDB_STORED_USER での分散 MySQL 権限">セクション23.5.12「NDB_STORED_USER での分散 MySQL 権限」</a> を参照してください。
          </p><p>
            <code class="literal">NDB_STORED_USER</code> 権限は NDB 8.0.18 以降で使用できます。
          </p></li><li class="listitem"><p><a name="priv_persist-ro-variables-admin"></a>
            <code class="literal">PERSIST_RO_VARIABLES_ADMIN</code>
          </p><a class="indexterm" name="idm46723764963696"></a><a class="indexterm" name="idm46723764961888"></a><p>
            <code class="literal">SYSTEM_VARIABLES_ADMIN</code> も持っているユーザーの場合、<code class="literal">PERSIST_RO_VARIABLES_ADMIN</code> を使用すると、<code class="literal">SET PERSIST_ONLY</code> を使用してグローバルシステム変数をデータディレクトリの <code class="filename">mysqld-auto.cnf</code> オプションファイルに永続化できます。 このステートメントは <code class="literal">SET PERSIST</code> と似ていますが、ランタイムグローバルシステム変数の値は変更されません。 これにより、<code class="literal">SET PERSIST_ONLY</code> は、サーバーの起動時にのみ設定できる読取り専用システム変数の構成に適しています。 
          </p><p>
            <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 システム変数権限">セクション5.1.9.1「システム変数権限」</a>も参照してください。
          </p></li><li class="listitem"><p><a name="priv_replication-applier"></a>
            <code class="literal">REPLICATION_APPLIER</code>
          </p><a class="indexterm" name="idm46723764949280"></a><a class="indexterm" name="idm46723764947504"></a><p>
            アカウントをレプリケーションチャネルの <code class="literal">PRIVILEGE_CHECKS_USER</code> として機能させ、<span class="command"><strong>mysqlbinlog</strong></span> 出力で <code class="literal">BINLOG</code> ステートメントを実行できるようにします。 <code class="literal">CHANGE REPLICATION SOURCE TO</code> (MySQL 8.0.23 から) または <code class="literal">CHANGE MASTER TO</code> (MySQL 8.0.23 より前) を使用して割り当てられたアカウントにこの権限を付与して、レプリケーションチャネルのセキュリティコンテキストを提供し、それらのチャネルでレプリケーションエラーを処理します。 <code class="literal">REPLICATION_APPLIER</code> 権限と同様に、レプリケーションチャネルで受信したトランザクションまたは <span class="command"><strong>mysqlbinlog</strong></span> 出力に含まれるトランザクションを実行するために必要な権限をアカウントに付与して、影響を受けるテーブルを更新する必要があります。 詳細は、<a class="xref" href="replication.html#replication-privilege-checks" title="17.3.3 レプリケーション権限チェック">セクション17.3.3「レプリケーション権限チェック」</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_replication-slave-admin"></a>
            <code class="literal">REPLICATION_SLAVE_ADMIN</code>
          </p><a class="indexterm" name="idm46723764935680"></a><a class="indexterm" name="idm46723764933904"></a><p>
            アカウントがレプリケーションソースサーバーに接続し、<code class="literal">START REPLICA | SLAVE</code> および <code class="literal">STOP REPLICA | SLAVE</code> ステートメントを使用してレプリケーションを開始および停止し、<code class="literal">CHANGE REPLICATION SOURCE TO</code> ステートメント (MySQL 8.0.23 から) または <code class="literal">CHANGE MASTER TO</code> ステートメント (MySQL 8.0.23 より前) および <code class="literal">CHANGE REPLICATION FILTER</code> ステートメントを使用します。 レプリカがレプリケーションソースサーバーとして現在のサーバーに接続するために使用するアカウントにこの権限を付与します。 この権限はグループレプリケーションには適用されません。そのためには <code class="literal">GROUP_REPLICATION_ADMIN</code> を使用します。 
          </p></li><li class="listitem"><p><a name="priv_resource-group-admin"></a>
            <code class="literal">RESOURCE_GROUP_ADMIN</code>
          </p><a class="indexterm" name="idm46723764922432"></a><a class="indexterm" name="idm46723764920656"></a><p>
            リソースグループの作成、変更および削除、およびリソースグループへのスレッドとステートメントの割当てで構成されるリソースグループ管理を有効にします。 この権限を持つユーザーは、リソースグループに関連する操作を実行できます。 
          </p></li><li class="listitem"><p><a name="priv_resource-group-user"></a>
            <code class="literal">RESOURCE_GROUP_USER</code>
          </p><a class="indexterm" name="idm46723764916064"></a><a class="indexterm" name="idm46723764914288"></a><p>
            リソースグループへのスレッドとステートメントの割り当てを有効にします。 この権限を持つユーザーは、<code class="literal">SET RESOURCE GROUP</code> ステートメントおよび <code class="literal">RESOURCE_GROUP</code> オプティマイザヒントを使用できます。 
          </p></li><li class="listitem"><p><a name="priv_role-admin"></a>
            <code class="literal">ROLE_ADMIN</code>
          </p><a class="indexterm" name="idm46723764907872"></a><a class="indexterm" name="idm46723764906096"></a><p>
            ロールの付与と取消し、<code class="literal">GRANT</code> ステートメントの <code class="literal">WITH ADMIN OPTION</code> 句の使用、および <code class="literal">ROLES_GRAPHML()</code> 関数からの結果の空でない <code class="literal">&lt;graphml&gt;</code> 要素コンテンツを有効にします。 <code class="literal">mandatory_roles</code> システム変数の値を設定するために必要です。 
          </p></li><li class="listitem"><p><a name="priv_service-connection-admin"></a>
            <code class="literal">SERVICE_CONNECTION_ADMIN</code>
          </p><a class="indexterm" name="idm46723764897216"></a><a class="indexterm" name="idm46723764895408"></a><p>
            管理接続のみを許可するネットワークインタフェースへの接続を有効にします (<a class="xref" href="server-administration.html#connection-interfaces" title="5.1.12.1 接続インタフェース">セクション5.1.12.1「接続インタフェース」</a> を参照)。
          </p></li><li class="listitem"><p><a name="priv_session-variables-admin"></a>
            <code class="literal">SESSION_VARIABLES_ADMIN</code> (MySQL 8.0.14 で追加)
          </p><a class="indexterm" name="idm46723764890272"></a><a class="indexterm" name="idm46723764888496"></a><p>
            ほとんどのシステム変数では、セッション値の設定に特別な権限は必要なく、すべてのユーザーが現在のセッションに影響を与えることができます。 一部のシステム変数では、セッション値を設定すると、現在のセッションの外部に影響を与える可能性があるため、操作が制限されます。 これらの場合、<code class="literal">SESSION_VARIABLES_ADMIN</code> 権限により、ユーザーはセッション値を設定できます。 
          </p><p>
            システム変数が制限されていて、セッション値を設定するために特別な権限が必要な場合、変数の説明にその制限が示されます。 例として、<code class="literal">binlog_format</code>、<code class="literal">sql_log_bin</code> および <code class="literal">sql_log_off</code> があります。 
          </p><p>
            <code class="literal">SESSION_VARIABLES_ADMIN</code> が追加された MySQL 8.0.14 より前は、<code class="literal">SYSTEM_VARIABLES_ADMIN</code> または <code class="literal">SUPER</code> 権限を持つユーザーのみが制限付きセッションシステム変数を設定できます。
          </p><p>
            <code class="literal">SESSION_VARIABLES_ADMIN</code> 権限は、<code class="literal">SYSTEM_VARIABLES_ADMIN</code> および <code class="literal">SUPER</code> 権限のサブセットです。 これらの権限のいずれかを持つユーザーは、制限付きセッション変数の設定も許可され、効果的には <code class="literal">SESSION_VARIABLES_ADMIN</code> を意味するため、<code class="literal">SESSION_VARIABLES_ADMIN</code> を明示的に付与する必要はありません。 
          </p><p>
            <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 システム変数権限">セクション5.1.9.1「システム変数権限」</a>も参照してください。
          </p></li><li class="listitem"><p><a name="priv_set-user-id"></a>
            <code class="literal">SET_USER_ID</code>
          </p><a class="indexterm" name="idm46723764868384"></a><a class="indexterm" name="idm46723764866608"></a><p>
            ビューまたはストアドプログラムの実行時に有効な承認 ID を設定できるようにします。 この権限を持つユーザーは、ビューまたはストアドプログラムの <code class="literal">DEFINER</code> 属性として任意のアカウントを指定できます。 
          </p><p>
            MySQL 8.0.22 では、<code class="literal">SET_USER_ID</code> を使用して、(おそらく誤って) ストアドオブジェクトが孤立したり、現在孤立しているストアドオブジェクトを採用する原因となる操作を防ぐために設計されたセキュリティチェックをオーバーライドすることもできます。 詳細は、<a class="xref" href="stored-objects.html#stored-objects-security-orphan-objects" title="孤立したストアドオブジェクト">孤立したストアドオブジェクト</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_show-routine"></a>
            <code class="literal">SHOW_ROUTINE</code> (MySQL 8.0.20 で追加)
          </p><a class="indexterm" name="idm46723764858256"></a><a class="indexterm" name="idm46723764856480"></a><p>
            ユーザーがルーチン <code class="literal">DEFINER</code> として指定されていないストアドルーチン (ストアドプロシージャーおよびストアドファンクション) の定義およびプロパティーにアクセスできるようにします。 このアクセスには、次のものが含まれます: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">INFORMATION_SCHEMA.ROUTINES</code> テーブルの内容。
              </p></li><li class="listitem"><p>
                <code class="literal">SHOW CREATE FUNCTION</code> および <code class="literal">SHOW CREATE PROCEDURE</code> ステートメント。
              </p></li><li class="listitem"><p>
                <code class="literal">SHOW FUNCTION CODE</code> および <code class="literal">SHOW PROCEDURE CODE</code> ステートメント。
              </p></li><li class="listitem"><p>
                <code class="literal">SHOW FUNCTION STATUS</code> および <code class="literal">SHOW PROCEDURE STATUS</code> ステートメント。
              </p></li></ul></div><p>
            MySQL 8.0.20 より前では、ユーザーが定義しなかったルーチンの定義にアクセスするには、グローバルな <code class="literal">SELECT</code> 権限が必要です。これは非常に広範です。 8.0.20 の時点では、代わりに、ルーチン定義へのアクセスを許可するより制限されたスコープを持つ特権として <code class="literal">SHOW_ROUTINE</code> を付与できます。 (つまり、管理者は、それを必要としないユーザーからグローバル <code class="literal">SELECT</code> を廃棄し、かわりに <code class="literal">SHOW_ROUTINE</code> を付与できます。) これにより、アカウントは広範囲の権限を必要とせずにストアドルーチンをバックアップできます。 
          </p></li><li class="listitem"><p><a name="priv_system-user"></a>
            <code class="literal">SYSTEM_USER</code> (MySQL 8.0.16 で追加)
          </p><a class="indexterm" name="idm46723764834848"></a><a class="indexterm" name="idm46723764833072"></a><p>
            <code class="literal">SYSTEM_USER</code> 権限は、システムユーザーを通常のユーザーと区別します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">SYSTEM_USER</code> 権限を持つユーザーはシステムユーザーです。
              </p></li><li class="listitem"><p>
                <code class="literal">SYSTEM_USER</code> 権限を持たないユーザーは通常のユーザーです。
              </p></li></ul></div><p>
            <code class="literal">SYSTEM_USER</code> 権限は、特定のユーザーが他の権限を適用できるアカウント、およびそのユーザーが他のアカウントから保護されているかどうかに影響します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                システムユーザーは、システムアカウントと通常アカウントの両方を変更できます。 つまり、通常のアカウントに対して特定の操作を実行する適切な権限を持つユーザーは、システムアカウントに対しても操作を実行するように <code class="literal">SYSTEM_USER</code> を所有することで有効になります。 システムアカウントは、通常のユーザーではなく、適切な権限を持つシステムユーザーのみが変更できます。 
              </p></li><li class="listitem"><p>
                適切な権限を持つ通常のユーザーは通常のアカウントを変更できますが、システムアカウントは変更できません。 通常のアカウントは、適切な権限を持つシステムユーザーと通常のユーザーの両方が変更できます。 
              </p></li></ul></div><p>
            詳細は、<a class="xref" href="security.html#account-categories" title="6.2.11 アカウントカテゴリ">セクション6.2.11「アカウントカテゴリ」</a>を参照してください。
          </p><p>
            <code class="literal">SYSTEM_USER</code> 権限によってシステムアカウントに付与される通常のアカウントによる変更からの保護は、<code class="literal">mysql</code> システムスキーマに対する権限を持つ通常のアカウントには適用されないため、そのスキーマの付与テーブルを直接変更できます。 完全保護のために、<code class="literal">mysql</code> スキーマ権限を通常のアカウントに付与しないでください。 <a class="xref" href="security.html#protecting-system-accounts" title="通常アカウントによる操作からのシステムアカウントの保護">通常アカウントによる操作からのシステムアカウントの保護</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_system-variables-admin"></a>
            <code class="literal">SYSTEM_VARIABLES_ADMIN</code>
          </p><a class="indexterm" name="idm46723764811648"></a><a class="indexterm" name="idm46723764809872"></a><p>
            次の操作およびサーバーの動作に影響します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                実行時のシステム変数の変更を有効にします:
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    <code class="literal">SET GLOBAL</code> および <code class="literal">SET PERSIST</code> を使用して、グローバルシステム変数に対するサーバー構成の変更を有効にします。
                  </p></li><li class="listitem"><p>
                    ユーザーが <code class="literal">PERSIST_RO_VARIABLES_ADMIN</code> も持っている場合、<code class="literal">SET PERSIST_ONLY</code> を使用してグローバルシステム変数に対するサーバー構成の変更を有効にします。
                  </p></li><li class="listitem"><p>
                    特別な権限を必要とする制限付きセッションシステム変数の設定を有効にします。 実際には、<code class="literal">SYSTEM_VARIABLES_ADMIN</code> は、<code class="literal">SESSION_VARIABLES_ADMIN</code> を明示的に付与せずに <code class="literal">SESSION_VARIABLES_ADMIN</code> を暗黙的に意味します。 
                  </p></li></ul></div><p>
                <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 システム変数権限">セクション5.1.9.1「システム変数権限」</a>も参照してください。
              </p></li><li class="listitem"><p>
                グローバルトランザクション特性の変更を有効にします (<a class="xref" href="sql-statements.html#set-transaction" title="13.3.7 SET TRANSACTION ステートメント">セクション13.3.7「SET TRANSACTION ステートメント」</a> を参照)。
              </p></li></ul></div></li><li class="listitem"><p><a name="priv_table-encryption-admin"></a>
            <code class="literal">TABLE_ENCRYPTION_ADMIN</code> (MySQL 8.0.16 で追加)
          </p><a class="indexterm" name="idm46723764789808"></a><a class="indexterm" name="idm46723764788032"></a><p>
            <code class="literal">table_encryption_privilege_check</code> が有効な場合に、ユーザーがデフォルトの暗号化設定をオーバーライドできるようにします。<a class="xref" href="innodb-storage-engine.html#innodb-schema-tablespace-encryption-default" title="スキーマおよび一般テーブルスペースの暗号化デフォルトの定義">スキーマおよび一般テーブルスペースの暗号化デフォルトの定義</a> を参照してください。
          </p></li><li class="listitem"><p><a name="priv_version-token-admin"></a>
            <code class="literal">VERSION_TOKEN_ADMIN</code>
          </p><a class="indexterm" name="idm46723764782016"></a><a class="indexterm" name="idm46723764780240"></a><p>
            バージョントークンのユーザー定義関数の実行を有効にします。 この権限は、<code class="literal">version_tokens</code> プラグインによって定義されます。<a class="xref" href="server-administration.html#version-tokens" title="5.6.6 バージョントークン">セクション5.6.6「バージョントークン」</a> を参照してください。 
          </p></li><li class="listitem"><p><a name="priv_xa-recover-admin"></a>
            <code class="literal">XA_RECOVER_ADMIN</code>
          </p><a class="indexterm" name="idm46723764774512"></a><a class="indexterm" name="idm46723764772736"></a><p>
            <code class="literal">XA RECOVER</code> ステートメントの実行を有効にします。<a class="xref" href="sql-statements.html#xa-statements" title="13.3.8.1 XA トランザクション SQL ステートメント">セクション13.3.8.1「XA トランザクション SQL ステートメント」</a> を参照してください。
          </p><p>
            MySQL 8.0 より前は、すべてのユーザーが <code class="literal">XA RECOVER</code> ステートメントを実行して、未処理の準備済 XA トランザクションの XID 値を検出できたため、XA トランザクションを開始したユーザー以外のユーザーによる XA トランザクションのコミットまたはロールバックが発生する可能性がありました。 MySQL 8.0 では、<code class="literal">XA RECOVER</code> は <code class="literal">XA_RECOVER_ADMIN</code> 権限を持つユーザーにのみ許可されます。これは、それを必要とする管理ユーザーにのみ付与されることが予想されます。 たとえば、XA アプリケーションがクラッシュし、ロールバックできるようにアプリケーションによって開始された未処理のトランザクションを検索する必要がある場合などです。 この権限要件により、ユーザーは自分以外の未処理の準備済 XA トランザクションの XID 値を検出できなくなります。 XA トランザクションを開始したユーザーが XID を認識しているため、XA トランザクションの通常のコミットまたはロールバックには影響しません。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="privileges-provided-guidelines"></a>権限付与のガイドライン</h4></div></div></div><p>
        アカウントには必要な権限のみを付与することをお勧めします。 <code class="literal">FILE</code> 権限と管理権限の付与については十分に注意するようにしてください。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">FILE</code> を使用すると、MySQL サーバーがサーバーホスト上で読み取ることができるファイルをデータベーステーブルに読み込むことができます。 これにはすべてのユーザーが読み取り可能なすべてのファイルと、サーバーのデータディレクトリ内のファイルが含まれます。 そのあと、<code class="literal">SELECT</code> を使用してそのテーブルにアクセスし、テーブルの内容をクライアントホストに送信することができます。 
          </p></li><li class="listitem"><p>
            <code class="literal">GRANT OPTION</code> を使用すると、ユーザーは他のユーザーに権限を付与できます。 異なる権限を持つ 2 人のユーザーが <code class="literal">GRANT OPTION</code> 権限を持っていれば、権限を組み合わせることができます。 
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER</code> を使用すると、テーブルの名前を変更して権限システムを再変換できます。
          </p></li><li class="listitem"><p>
            <code class="literal">SHUTDOWN</code> では、サーバーを終了することで、他のユーザーに対するサービスを完全に拒否できます。
          </p></li><li class="listitem"><p>
            <code class="literal">PROCESS</code> を使用すると、パスワードを設定または変更するステートメントを含む、現在実行中のステートメントのプレーンテキストを表示できます。
          </p></li><li class="listitem"><p>
            <code class="literal">SUPER</code> を使用すると、他のセッションを終了したり、サーバーの動作方法を変更できます。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql</code> システムデータベース自体に付与された権限を使用して、パスワードおよびその他のアクセス権限情報を変更できます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                パスワードは暗号化されて保管されているため、悪意のあるユーザーは単純にそのパスワードを見てプレーンテキストパスワードを知ることはできません。 ただし、<code class="literal">mysql.user</code> システムテーブルの <code class="literal">authentication_string</code> カラムへの書込みアクセス権を持つユーザーは、アカウントパスワードを変更し、そのアカウントを使用して MySQL サーバーに接続できます。 
              </p></li><li class="listitem"><p>
                <code class="literal">mysql</code> システムデータベースに付与された <code class="literal">INSERT</code> または <code class="literal">UPDATE</code> を使用すると、ユーザーはそれぞれ権限を追加したり、既存の権限を変更できます。
              </p></li><li class="listitem"><p>
                <code class="literal">mysql</code> システムデータベース用の <code class="literal">DROP</code> を使用すると、ユーザーはリモート権限テーブルまたはデータベース自体を使用できます。
              </p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="static-dynamic-privileges"></a>静的権限と動的権限</h4></div></div></div><a class="indexterm" name="idm46723764730624"></a><a class="indexterm" name="idm46723764728464"></a><a class="indexterm" name="idm46723764727104"></a><p>
        MySQL では、静的権限および動的権限がサポートされています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            静的権限はサーバーに組み込まれています。 これらは常にユーザーアカウントに付与でき、登録解除できません。 
          </p></li><li class="listitem"><p>
            動的権限は、実行時に登録および登録解除できます。 これは可用性に影響: 登録されていない動的権限は付与できません。 
          </p></li></ul></div><p>
        たとえば、<code class="literal">SELECT</code> および <code class="literal">INSERT</code> 権限は静的で常に使用可能ですが、動的権限は、それを実装するコンポーネントが有効になっている場合にのみ使用可能になります。
      </p><p>
        このセクションの残りの部分では、動的権限が MySQL でどのように機能するかについて説明します。 この説明では、<span class="quote">「<span class="quote">「コンポーネント」</span>」</span>という用語を使用しますが、プラグインにも同様に適用されます。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          サーバー管理者は、動的権限を定義するサーバーコンポーネントに注意する必要があります。 MySQL ディストリビューションの場合、動的権限を定義するコンポーネントのドキュメントには、これらの権限が記載されています。 
        </p><p>
          サードパーティコンポーネントでも動的権限を定義できます。管理者は、これらの権限を理解し、サーバー操作が競合または危険にさらされる可能性のあるコンポーネントをインストールしないでください。 たとえば、両方で同じ名前の権限が定義されている場合、あるコンポーネントが別のコンポーネントと競合します。 コンポーネント開発者は、コンポーネント名に基づいて接頭辞を持つ権限名を選択することで、この発生の可能性を減らすことができます。 
        </p></div><p>
        サーバーは、登録された動的権限のセットをメモリー内に内部的に保持します。 サーバーの停止時に登録解除が発生します。 
      </p><p>
        通常、動的権限を定義するコンポーネントは、インストール時に初期化シーケンス中にそれらを登録します。 アンインストール時に、コンポーネントは登録されている動的権限を登録解除しません。 (これは現在の演習であり、要件ではありません。 つまり、コンポーネントは、登録した権限でいつでも登録解除できますが、できません。) 
      </p><p>
        すでに登録されている動的権限を登録しようとしても、警告やエラーは発生しません。 次の一連のステートメントについて考えてみます: 
      </p><pre class="programlisting">INSTALL COMPONENT 'my_component';
UNINSTALL COMPONENT 'my_component';
INSTALL COMPONENT 'my_component';
</pre><p>
        最初の <code class="literal">INSTALL COMPONENT</code> ステートメントでは、コンポーネント <code class="literal">my_component</code> によって定義された権限は登録されますが、<code class="literal">UNINSTALL COMPONENT</code> では登録解除されません。 2 番目の <code class="literal">INSTALL COMPONENT</code> ステートメントでは、登録するコンポーネント権限はすでに登録されていますが、警告やエラーは発生しません。 
      </p><a class="indexterm" name="idm46723764707040"></a><a class="indexterm" name="idm46723764704816"></a><a class="indexterm" name="idm46723764702704"></a><p>
        動的権限はグローバルレベルでのみ適用されます。 サーバーは、ユーザーアカウントへの動的権限の現在の割当てに関する情報を <code class="literal">mysql.global_grants</code> システムテーブルに格納します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバーは、(<code class="option">--skip-grant-tables</code> オプションが指定されていないかぎり) サーバーの起動時に <code class="literal">global_grants</code> で指定された権限を自動的に登録します。
          </p></li><li class="listitem"><p>
            <code class="literal">GRANT</code> および <code class="literal">REVOKE</code> ステートメントによって、<code class="literal">global_grants</code> の内容が変更されます。
          </p></li><li class="listitem"><p>
            <code class="literal">global_grants</code> にリストされている動的権限割当ては永続的です。 サーバーの停止時には削除されません。 
          </p></li></ul></div><p>
        例: 次のステートメントは、レプリカに対するレプリケーション (グループレプリケーションを含む) の制御およびシステム変数の変更に必要な権限をユーザー <code class="literal">u1</code> に付与します:
      </p><pre class="programlisting">GRANT REPLICATION_SLAVE_ADMIN, GROUP_REPLICATION_ADMIN, BINLOG_ADMIN
ON *.* TO 'u1'@'localhost';
</pre><p>
        付与された動的権限は、<code class="literal">SHOW GRANTS</code> ステートメントおよび <code class="literal">INFORMATION_SCHEMA</code> <code class="literal">USER_PRIVILEGES</code> テーブルからの出力に表示されます。
      </p><p>
        グローバルレベルの <code class="literal">GRANT</code> および <code class="literal">REVOKE</code> の場合、静的として認識されない名前付き権限は、現在登録されている動的権限のセットに対してチェックされ、見つかった場合は付与されます。 それ以外の場合は、不明な権限識別子を示すエラーが発生します。 
      </p><p>
        <code class="literal">GRANT</code> および <code class="literal">REVOKE</code> の場合、グローバルレベルの <code class="literal">ALL [PRIVILEGES]</code>の意味には、すべての静的グローバル権限と、現在登録されているすべての動的権限が含まれます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            グローバルレベルの <code class="literal">GRANT ALL</code> では、すべての静的グローバル権限および現在登録されているすべての動的権限が付与されます。 <code class="literal">GRANT</code> ステートメントの実行後に登録された動的権限は、どのアカウントにも遡及的に付与されません。 
          </p></li><li class="listitem"><p>
            グローバルレベルの <code class="literal">REVOKE ALL</code> は、付与されているすべての静的グローバル権限および付与されているすべての動的権限を取り消します。
          </p></li></ul></div><p>
        <code class="literal">FLUSH PRIVILEGES</code> ステートメントは、動的権限割当てのために <code class="literal">global_grants</code> テーブルを読み取り、そこで見つかった未登録の権限を登録します。
      </p><p>
        MySQL Server によって提供される動的権限および MySQL ディストリビューションに含まれるコンポーネントの詳細は、<a class="xref" href="security.html#privileges-provided" title="6.2.2 MySQL で提供される権限">セクション6.2.2「MySQL で提供される権限」</a> を参照してください。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-privileges-migration-from-super"></a>SUPER から動的権限へのアカウントの移行</h4></div></div></div><p>
        MySQL 8.0 では、以前に <code class="literal">SUPER</code> 権限を必要としていた多くの操作も、より限定された有効範囲の動的権限に関連付けられています。 (これらの権限の詳細は、<a class="xref" href="security.html#privileges-provided" title="6.2.2 MySQL で提供される権限">セクション6.2.2「MySQL で提供される権限」</a> を参照してください。) このような各操作は、<code class="literal">SUPER</code> ではなく、関連付けられた動的権限を付与することで、アカウントに対して許可できます。 この変更により、DBA は <code class="literal">SUPER</code> の付与を回避し、ユーザー権限を許可されている操作により厳密に調整できるため、セキュリティが向上します。 <code class="literal">SUPER</code> は非推奨になりました。将来のバージョンの MySQL で削除される予定です。 
      </p><p>
        <code class="literal">SUPER</code> の削除が発生すると、<code class="literal">SUPER</code> を付与されたアカウントが適切な動的権限に移行されないかぎり、以前は <code class="literal">SUPER</code> を必要としていた操作は失敗します。 次の手順を使用して、<code class="literal">SUPER</code> を削除する前にアカウントの準備が整うようにその目標を達成します: 
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            次のクエリーを実行して、<code class="literal">SUPER</code> が付与されているアカウントを識別します:
          </p><pre class="programlisting">SELECT GRANTEE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE = 'SUPER';
</pre></li><li class="listitem"><p>
            前述のクエリーで識別されたアカウントごとに、<code class="literal">SUPER</code> が必要な操作を決定します。 次に、これらの操作に対応する動的権限を付与し、<code class="literal">SUPER</code> を取り消します。 
          </p><p>
            たとえば、バイナリログのパージおよびシステム変数の変更に<code class="literal">'u1'@'localhost'</code>で <code class="literal">SUPER</code> が必要な場合、次のステートメントによってアカウントに必要な変更が加えられます:
          </p><pre class="programlisting">GRANT BINLOG_ADMIN, SYSTEM_VARIABLES_ADMIN ON *.* TO 'u1'@'localhost';
REVOKE SUPER ON *.* FROM 'u1'@'localhost';
</pre><p>
            適用可能なすべてのアカウントを変更した後、最初のステップの <code class="literal">INFORMATION_SCHEMA</code> クエリーで空の結果セットが生成されます。
          </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="grant-tables"></a>6.2.3 付与テーブル</h3></div></div></div><a class="indexterm" name="idm46723764643728"></a><a class="indexterm" name="idm46723764641584"></a><p>
      <code class="literal">mysql</code> システムデータベースには、ユーザーアカウントおよびそのアカウントが保持する権限に関する情報を含む複数の付与テーブルが含まれています。 このセクションでは、これらのテーブルについて説明します。 システムデータベース内の他のテーブルの詳細は、<a class="xref" href="server-administration.html#system-schema" title="5.3 mysql システムスキーマ">セクション5.3「mysql システムスキーマ」</a> を参照してください。 
    </p><p>
      ここでは付与テーブルの基本構造と、サーバーがクライアントと対話するときに付与テーブルの内容をどのように使用するかについて説明します。 ただし、通常は付与テーブルを直接変更しません。 <code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">REVOKE</code> などのアカウント管理ステートメントを使用してアカウントを設定し、各アカウントで使用可能な権限を制御すると、変更が間接的に行われます。 <a class="xref" href="sql-statements.html#account-management-statements" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a>を参照してください。 このようなステートメントを使用してアカウント操作を実行すると、サーバーはユーザーの代わりに付与テーブルを変更します。 
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        <code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> などのステートメントを使用して付与テーブルを直接変更することはお薦めできません。独自のリスクで実行してください。 これらの変更の結果として誤った形式となった行を、サーバーは随意で無視します。 
      </p><p>
        付与テーブルを変更する操作の場合、サーバーはテーブルが予期された構造を持っているかどうかをチェックし、持っていない場合はエラーを生成します。 テーブルを必要な構造に更新するには、MySQL のアップグレード手順を実行します。 <a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a>を参照してください。 
      </p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#grant-tables-overview" title="付与テーブルの概要">付与テーブルの概要</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-user-db" title="ユーザーおよび DB 付与テーブル">ユーザーおよび DB 付与テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-tables-priv-columns-priv" title="tables_priv および columns_priv の付与テーブル">tables_priv および columns_priv の付与テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-procs-priv" title="procs_priv 付与テーブル">procs_priv 付与テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-proxies-priv" title="proxies_priv 付与テーブル">proxies_priv 付与テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-global-grants" title="global_grants 付与テーブル">global_grants 付与テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-default-roles" title="default_roles 付与テーブル">default_roles 付与テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-role-edges" title="role_edges 付与テーブル">role_edges 付与テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-password-history" title="password_history 付与テーブル">password_history 付与テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-scope-column-properties" title="付与テーブルのスコープカラムのプロパティ">付与テーブルのスコープカラムのプロパティ</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-privilege-column-properties" title="テーブル権限の付与のカラムプロパティ">テーブル権限の付与のカラムプロパティ</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-concurrency" title="テーブル同時実行性の付与">テーブル同時実行性の付与</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-overview"></a>付与テーブルの概要</h4></div></div></div><p>
        次の <code class="literal">mysql</code> データベーステーブルには付与情報が格納されています。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-user-db" title="ユーザーおよび DB 付与テーブル"><code class="literal">user</code></a>: ユーザーアカウント、静的グローバル権限およびその他の非権限カラム。
          </p><a class="indexterm" name="idm46723764608352"></a><a class="indexterm" name="idm46723764606176"></a><a class="indexterm" name="idm46723764604224"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-global-grants" title="global_grants 付与テーブル"><code class="literal">global_grants</code></a>: 動的グローバル権限。
          </p><a class="indexterm" name="idm46723764600048"></a><a class="indexterm" name="idm46723764597872"></a><a class="indexterm" name="idm46723764595760"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-user-db" title="ユーザーおよび DB 付与テーブル"><code class="literal">db</code></a>: Database-level privileges.
          </p><a class="indexterm" name="idm46723764591808"></a><a class="indexterm" name="idm46723764589632"></a><a class="indexterm" name="idm46723764587680"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-tables-priv-columns-priv" title="tables_priv および columns_priv の付与テーブル"><code class="literal">tables_priv</code></a>: Table-level privileges.
          </p><a class="indexterm" name="idm46723764583600"></a><a class="indexterm" name="idm46723764581376"></a><a class="indexterm" name="idm46723764579264"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-tables-priv-columns-priv" title="tables_priv および columns_priv の付与テーブル"><code class="literal">columns_priv</code></a>: Column-level privileges.
          </p><a class="indexterm" name="idm46723764575248"></a><a class="indexterm" name="idm46723764573024"></a><a class="indexterm" name="idm46723764570912"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-procs-priv" title="procs_priv 付与テーブル"><code class="literal">procs_priv</code></a>: ストアドプロシージャおよびファンクション権限。
          </p><a class="indexterm" name="idm46723764566800"></a><a class="indexterm" name="idm46723764564592"></a><a class="indexterm" name="idm46723764562496"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-proxies-priv" title="proxies_priv 付与テーブル"><code class="literal">proxies_priv</code></a>: Proxy-user privileges.
          </p><a class="indexterm" name="idm46723764558496"></a><a class="indexterm" name="idm46723764556272"></a><a class="indexterm" name="idm46723764554160"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-default-roles" title="default_roles 付与テーブル"><code class="literal">default_roles</code></a>: デフォルトのユーザーロール。
          </p><a class="indexterm" name="idm46723764550016"></a><a class="indexterm" name="idm46723764547840"></a><a class="indexterm" name="idm46723764545728"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-role-edges" title="role_edges 付与テーブル"><code class="literal">role_edges</code></a>: ロールサブグラフのエッジ。
          </p><a class="indexterm" name="idm46723764541664"></a><a class="indexterm" name="idm46723764539456"></a><a class="indexterm" name="idm46723764537360"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-password-history" title="password_history 付与テーブル"><code class="literal">password_history</code></a>: パスワード変更履歴。
          </p><a class="indexterm" name="idm46723764533264"></a><a class="indexterm" name="idm46723764531072"></a><a class="indexterm" name="idm46723764528944"></a></li></ul></div><p>
        静的グローバル権限と動的グローバル権限の違いの詳細は、<a class="xref" href="security.html#static-dynamic-privileges" title="静的権限と動的権限">静的権限と動的権限</a> を参照してください。)
      </p><p>
        MySQL 8.0 では、付与テーブルは <code class="literal">InnoDB</code> ストレージエンジンを使用し、トランザクションです。 MySQL 8.0 より前は、付与テーブルは <code class="literal">MyISAM</code> ストレージエンジンを使用しており、非トランザクションでした。 付与テーブルストレージエンジンのこの変更により、<code class="literal">CREATE USER</code> や <code class="literal">GRANT</code> などのアカウント管理ステートメントの動作に付随する変更が可能になります。 以前は、複数のユーザーを指定したアカウント管理ステートメントは、一部のユーザーでは成功し、他のユーザーでは失敗していました。 現在は、各ステートメントはトランザクションに対応し、指定されたすべてのユーザーに対して成功するか、エラーが発生した場合はロールバックされて何の影響も与えなくなりました。 
      </p><p>
        各付与テーブルにはスコープカラムと権限カラムがあります。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            有効範囲カラムは、テーブルの各行の有効範囲、つまり行が適用されるコンテキストを決定します。 たとえば、<code class="literal">Host</code> と <code class="literal">User</code> の値が<code class="literal">'h1.example.net'</code>および<code class="literal">'bob'</code>の <code class="literal">user</code> テーブルの行は、ユーザー名 <code class="literal">bob</code> を指定するクライアントによってホスト <code class="literal">h1.example.net</code> からサーバーに対して行われる認証接続に適用されます。 同様に、<code class="literal">Host</code>、<code class="literal">User</code> および <code class="literal">Db</code> カラムの<code class="literal">'h1.example.net'</code>、<code class="literal">'bob'</code>および<code class="literal">'reports'</code>の値を含む <code class="literal">db</code> テーブルの行は、<code class="literal">bob</code> がホスト <code class="literal">h1.example.net</code> から接続して <code class="literal">reports</code> データベースにアクセスする場合に適用されます。 <code class="literal">tables_priv</code> テーブルおよび <code class="literal">columns_priv</code> テーブルには、それぞれの行に適用されるテーブルまたはテーブルとカラムの組み合わせを示すスコープカラムがあります。 <code class="literal">procs_priv</code> スコープカラムは、それぞれの行に適用されるストアドルーチンを示します。 
          </p></li><li class="listitem"><p>
            権限カラムは、テーブルの行で付与される権限、つまり実行が許可される操作を示します。 サーバーは、さまざまな付与テーブル内の情報を結合して、ユーザー権限の完全な説明を形成します。<a class="xref" href="security.html#request-access" title="6.2.7 アクセス制御、ステージ 2: リクエストの確認">セクション6.2.7「アクセス制御、ステージ 2: リクエストの確認」</a> では、このルールについて説明します。 
          </p></li></ul></div><p>
        また、権限付与テーブルには、スコープまたは権限評価以外の目的で使用されるカラムが含まれる場合があります。
      </p><p>
        サーバーは次の方法で付与テーブルを使用します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">user</code> テーブルのスコープカラムは、入接続を拒否または許可するかを決定します。 許可された接続の場合、<code class="literal">user</code> テーブルで付与された権限は、ユーザーの静的グローバル権限を示します。 このテーブルで付与される権限は、サーバー上の <span class="emphasis"><em>all</em></span> データベースに適用されます。 
          </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注意</div><p>
              静的グローバル権限はすべてのデータベースに対する権限とみなされるため、静的グローバル権限を使用すると、ユーザーは、部分的な取消しによってデータベースレベルで制限されているデータベースを除き、<code class="literal">SHOW DATABASES</code> を使用するか、<code class="literal">INFORMATION_SCHEMA</code> の <code class="literal">SCHEMATA</code> テーブルを調べることで、すべてのデータベース名を表示できます。
            </p></div></li><li class="listitem"><p>
            <code class="literal">global_grants</code> テーブルには、ユーザーアカウントへの動的グローバル権限の現在の割当てがリストされます。 行ごとに、有効範囲カラムによって、権限カラムで指定された権限を持つユーザーが決定されます。 
          </p></li><li class="listitem"><p>
            <code class="literal">db</code> テーブルのスコープカラムは、どのユーザーがどのホストからどのデータベースにアクセスできるかを決定します。 権限カラムによって、許可される操作が決まります。 データベースレベルで付与される権限は、データベースのほかテーブルやストアドプログラムなどのデータベース内のすべてのオブジェクトに適用されます。 
          </p></li><li class="listitem"><p>
            <code class="literal">tables_priv</code> および <code class="literal">columns_priv</code> テーブルは <code class="literal">db</code> テーブルと似ていますが、これらはさらに粒度が細かく、データベースレベルでなくテーブルレベルおよびカラムレベルに適用されます。 テーブルレベルで付与される権限は、テーブルおよびそのすべてのカラムに適用されます。 カラムレベルで付与される権限は、特定のカラムにのみ適用されます。 
          </p></li><li class="listitem"><p>
            <code class="literal">procs_priv</code> テーブルはストアドルーチン (ストアドプロシージャーとストアドファンクション) に適用されます。 ルーチンレベルで付与される権限は、単一のプロシージャまたは関数にのみ適用されます。 
          </p></li><li class="listitem"><p>
            <code class="literal">proxies_priv</code> テーブルには、他のユーザーのプロキシとして機能できるユーザーと、ユーザーが他のユーザーに <code class="literal">PROXY</code> 権限を付与できるかどうかが示されます。
          </p></li><li class="listitem"><p>
            <code class="literal">default_roles</code> テーブルと <code class="literal">role_edges</code> テーブルには、ロール関係に関する情報が含まれています。
          </p></li><li class="listitem"><p>
            <code class="literal">password_history</code> テーブルでは、パスワードの再利用に関する制限を有効にするために、以前に選択したパスワードが保持されます。 <a class="xref" href="security.html#password-management" title="6.2.15 パスワード管理">セクション6.2.15「パスワード管理」</a>を参照してください。 
          </p></li></ul></div><p>
        サーバーは、起動時に付与テーブルの内容をメモリーに読み取ります。 <code class="literal">FLUSH PRIVILEGES</code> ステートメントを発行するか、<span class="command"><strong>mysqladmin flush-privileges</strong></span> または <span class="command"><strong>mysqladmin reload</strong></span> コマンドを実行することによって、テーブルをリロードするようサーバーに指示することができます。 付与テーブルへの変更は、<a class="xref" href="security.html#privilege-changes" title="6.2.13 権限変更が有効化される時期">セクション6.2.13「権限変更が有効化される時期」</a>で示すように反映されます。 
      </p><p>
        アカウントを変更する場合は、変更が意図したとおりの効果を持つことを確認することをお薦めします。 特定のアカウントの権限を確認するには、<code class="literal">SHOW GRANTS</code> ステートメントを使用します。 たとえば、ユーザー名およびホスト名の値がそれぞれ <code class="literal">bob</code> および <code class="literal">pc84.example.com</code> のアカウントに付与された権限を調べるには、次のステートメントを使用します。 
      </p><pre class="programlisting">SHOW GRANTS FOR 'bob'@'pc84.example.com';
</pre><p>
        アカウントの非特権プロパティーを表示するには、<code class="literal">SHOW CREATE USER</code> を使用します:
      </p><pre class="programlisting">SHOW CREATE USER 'bob'@'pc84.example.com';
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-user-db"></a>ユーザーおよび DB 付与テーブル</h4></div></div></div><p>
        サーバーは <code class="literal">mysql</code> データベース内の <code class="literal">user</code> および <code class="literal">db</code> テーブルを、アクセス制御のステージ 1 とステージ 2 の両方で使用します (<a class="xref" href="security.html#access-control" title="6.2 アクセス制御とアカウント管理">セクション6.2「アクセス制御とアカウント管理」</a>を参照してください)。 <code class="literal">user</code> と <code class="literal">db</code> のテーブルのカラムをここで示します。 
      </p><div class="table"><a name="idm46723764456288"></a><p class="title"><b>表 6.4 user テーブルおよび db テーブルのカラム</b></p><div class="table-contents"><table><col style="width=40%"><col style="width=30%"><col style="width=30%"><thead><tr>
            <th scope="col">テーブル名</th>
            <th scope="col"><code class="literal">user</code></th>
            <th scope="col"><code class="literal">db</code></th>
          </tr></thead><tbody><tr>
            <th scope="row"><span class="bold"><strong>スコープカラム</strong></span></th>
            <td><code class="literal">Host</code></td>
            <td><code class="literal">Host</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">User</code></td>
            <td><code class="literal">Db</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td></td>
            <td><code class="literal">User</code></td>
          </tr><tr>
            <th scope="row"><span class="bold"><strong>権限カラム</strong></span></th>
            <td><code class="literal">Select_priv</code></td>
            <td><code class="literal">Select_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Insert_priv</code></td>
            <td><code class="literal">Insert_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Update_priv</code></td>
            <td><code class="literal">Update_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Delete_priv</code></td>
            <td><code class="literal">Delete_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Index_priv</code></td>
            <td><code class="literal">Index_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Alter_priv</code></td>
            <td><code class="literal">Alter_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Create_priv</code></td>
            <td><code class="literal">Create_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Drop_priv</code></td>
            <td><code class="literal">Drop_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Grant_priv</code></td>
            <td><code class="literal">Grant_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Create_view_priv</code></td>
            <td><code class="literal">Create_view_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Show_view_priv</code></td>
            <td><code class="literal">Show_view_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Create_routine_priv</code></td>
            <td><code class="literal">Create_routine_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Alter_routine_priv</code></td>
            <td><code class="literal">Alter_routine_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Execute_priv</code></td>
            <td><code class="literal">Execute_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Trigger_priv</code></td>
            <td><code class="literal">Trigger_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Event_priv</code></td>
            <td><code class="literal">Event_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Create_tmp_table_priv</code></td>
            <td><code class="literal">Create_tmp_table_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Lock_tables_priv</code></td>
            <td><code class="literal">Lock_tables_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">References_priv</code></td>
            <td><code class="literal">References_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Reload_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Shutdown_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Process_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">File_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Show_db_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Super_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Repl_slave_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Repl_client_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Create_user_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Create_tablespace_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Create_role_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Drop_role_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"><span class="bold"><strong>セキュリティーカラム</strong></span></th>
            <td><code class="literal">ssl_type</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">ssl_cipher</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">x509_issuer</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">x509_subject</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">plugin</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">authentication_string</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">password_expired</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">password_last_changed</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">password_lifetime</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">account_locked</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Password_reuse_history</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Password_reuse_time</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Password_require_current</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">User_attributes</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"><span class="bold"><strong>リソース制御カラム</strong></span></th>
            <td><code class="literal">max_questions</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">max_updates</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">max_connections</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">max_user_connections</code></td>
            <td></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        <code class="literal">user</code> テーブルの <code class="literal">plugin</code> カラムおよび <code class="literal">authentication_string</code> カラムには、認証プラグインおよび資格証明情報が格納されます。
      </p><p>
        サーバーは、アカウント行の <code class="literal">plugin</code> カラムで指定されたプラグインを使用して、アカウントの接続試行を認証します。
      </p><p>
        <code class="literal">plugin</code> カラムは空にできません。 起動時および実行時に、<code class="literal">FLUSH PRIVILEGES</code> が実行されると、サーバーは <code class="literal">user</code> テーブルの行をチェックします。 <code class="literal">plugin</code> カラムが空の行の場合、サーバーは次の形式のエラーログに警告を書き込みます: 
      </p><pre class="programlisting">[Warning] User entry '<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>' has an empty plugin
value. The user will be ignored and no one can login with this user
anymore.
</pre><p>
        プラグインがないアカウントにプラグインを割り当てるには、<code class="literal">ALTER USER</code> ステートメントを使用します。
      </p><p>
        <code class="literal">password_expired</code> カラムを使用すると、DBA はアカウントパスワードを期限切れにでき、ユーザーはパスワードをリセットする必要があります。 デフォルトの <code class="literal">password_expired</code> 値は <code class="literal">'N'</code> ですが、<code class="literal">ALTER USER</code> ステートメントを使用して <code class="literal">'Y'</code> に設定できます。 アカウントパスワードが期限切れになると、ユーザーが新しいアカウントパスワードを確立するために <code class="literal">ALTER USER</code> ステートメントを発行するまで、サーバーへの後続の接続でアカウントによって実行されるすべての操作でエラーが発生します。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          期限切れのパスワードは、現在の値に設定することで <span class="quote">「<span class="quote">reset</span>」</span> で使用できますが、適切なポリシーとして、別のパスワードを選択することをお薦めします。 DBA は、適切なパスワード再利用ポリシーを確立することで、非キューを強制できます。 <a class="xref" href="security.html#password-reuse-policy" title="パスワード再利用ポリシー">パスワード再利用ポリシー</a>を参照してください。 
        </p></div><p>
        <code class="literal">password_last_changed</code> は、パスワードが最後に変更された日時を示す <code class="literal">TIMESTAMP</code> カラムです。 この値は、MySQL 組込み認証プラグイン (<code class="literal">mysql_native_password</code>、<code class="literal">sha256_password</code> または <code class="literal">caching_sha2_password</code>) を使用するアカウントに対してのみ <code class="literal">NULL</code> 以外です。 他のアカウント (外部認証システムを使用して認証されたアカウントなど) の場合、値は <code class="literal">NULL</code> です。 
      </p><p>
        <code class="literal">password_last_changed</code> は、<code class="literal">CREATE USER</code>、<code class="literal">ALTER USER</code> および <code class="literal">SET PASSWORD</code> ステートメント、およびアカウントの作成やアカウントパスワードの変更を行う <code class="literal">GRANT</code> ステートメントによって更新されます。
      </p><p>
        <code class="literal">password_lifetime</code> は、アカウントパスワードの存続期間を日数で示します。 パスワードが存続期間を過ぎた場合 (<code class="literal">password_last_changed</code> カラムを使用して評価)、クライアントがアカウントを使用して接続すると、サーバーはパスワードの有効期限が切れたとみなします。 ゼロより大きい <em class="replaceable"><code>N</code></em> の値は、パスワードを <em class="replaceable"><code>N</code></em> 日ごとに変更する必要があることを意味します。 値 0 を指定すると、自動パスワード有効期限が無効になります。 値が <code class="literal">NULL</code> (デフォルト) の場合は、<code class="literal">default_password_lifetime</code> システム変数で定義されているグローバル有効期限ポリシーが適用されます。 
      </p><a class="indexterm" name="idm46723764219344"></a><a class="indexterm" name="idm46723764217856"></a><a class="indexterm" name="idm46723764215776"></a><p>
        <code class="literal">account_locked</code> は、アカウントがロックされているかどうかを示します (<a class="xref" href="security.html#account-locking" title="6.2.19 アカウントロック">セクション6.2.19「アカウントロック」</a> を参照)。
      </p><p>
        <code class="literal">Password_reuse_history</code> は、アカウントの <code class="literal">PASSWORD HISTORY</code> オプションの値、またはデフォルト履歴の <code class="literal">NULL</code> の値です。
      </p><p>
        <code class="literal">Password_reuse_time</code> は、アカウントの <code class="literal">PASSWORD REUSE INTERVAL</code> オプション、またはデフォルト間隔の <code class="literal">NULL</code> の値です。
      </p><p>
        <code class="literal">Password_require_current</code> (MySQL 8.0.13 で追加) は、次のテーブルに示すように、アカウントの <code class="literal">PASSWORD REQUIRE</code> オプションの値に対応します。
      </p><div class="table"><a name="password-require-current-values-table"></a><p class="title"><b>表 6.5 許可される Password_require_current 値</b></p><div class="table-contents"><table summary="Permitted values of the user.Password_require_current column and how they correspond to PASSWORD REQUIRE options."><col style="width=50%"><col style="width=50%"><thead><tr>
            <th>Password_require_current 値</th>
            <th>対応する PASSWORD REQUIRE オプション</th>
          </tr></thead><tbody><tr>
            <td><code class="literal">'Y'</code></td>
            <td><code class="literal">PASSWORD REQUIRE CURRENT</code></td>
          </tr><tr>
            <td><code class="literal">'N'</code></td>
            <td><code class="literal">PASSWORD REQUIRE CURRENT OPTIONAL</code></td>
          </tr><tr>
            <td><code class="literal">NULL</code></td>
            <td><code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        <code class="literal">User_attributes</code> (MySQL 8.0.14 で追加) は、他のカラムに格納されていないアカウント属性を格納する JSON 形式のカラムです:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">additional_password</code>: セカンダリパスワード (存在する場合)。 <a class="xref" href="security.html#dual-passwords" title="デュアルパスワードのサポート">デュアルパスワードのサポート</a>を参照してください。 
          </p></li><li class="listitem"><p>
            <code class="literal">Restrictions</code>: 制限リスト (ある場合)。 制限は、部分失効操作によって追加されます。 属性値は、それぞれ制限されたデータベースの名前とそれに適用可能な制限を示す <code class="literal">Database</code> および <code class="literal">Restrictions</code> キーを持つ要素の配列です (<a class="xref" href="security.html#partial-revokes" title="6.2.12 部分取消しを使用した権限の制限">セクション6.2.12「部分取消しを使用した権限の制限」</a> を参照)。 
          </p></li><li class="listitem"><p>
            <code class="literal">Password_locking</code>: 失敗したログイントラッキングおよび一時アカウントロックの条件 (存在する場合)(<a class="xref" href="security.html#failed-login-tracking" title="失敗したログイントラッキングと一時アカウントロック">失敗したログイントラッキングと一時アカウントロック</a> を参照)。 <code class="literal">Password_locking</code> 属性は、<code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> ステートメントの <code class="literal">FAILED_LOGIN_ATTEMPTS</code> および <code class="literal">PASSWORD_LOCK_TIME</code> オプションに従って更新されます。 属性値は、アカウントに指定されているようなオプションの値を示す <code class="literal">failed_login_attempts</code> および <code class="literal">password_lock_time_days</code> キーを含むハッシュです。 キーがない場合、その値は暗黙的に 0 になります。 キー値が暗黙的または明示的に 0 の場合、対応する機能は無効になります。 この属性は、MySQL 8.0.19 で追加されました。 
          </p></li></ul></div><p>
        適用される属性がない場合、<code class="literal">User_attributes</code> は <code class="literal">NULL</code> です。
      </p><p>
        例: セカンダリパスワードを持ち、部分的に取り消されたデータベース権限を持つアカウントのカラム値には、<code class="literal">additional_password</code> および <code class="literal">Restrictions</code> 属性が含まれます:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT User_attributes FROM mysql.User WHERE User = 'u'\G</code></strong>
*************************** 1. row ***************************
User_attributes: {"Restrictions":
                   [{"Database": "mysql", "Privileges": ["SELECT"]}],
                  "additional_password": "<em class="replaceable"><code>hashed_credentials</code></em>"}
</pre><p>
        存在する属性を確認するには、<code class="literal">JSON_KEYS()</code> 関数を使用します:
      </p><pre class="programlisting">SELECT User, Host, JSON_KEYS(User_attributes)
FROM mysql.user WHERE User_attributes IS NOT NULL;
</pre><p>
        <code class="literal">Restrictions</code> などの特定の属性を抽出するには、次のようにします:
      </p><pre class="programlisting">SELECT User, Host, User_attributes-&gt;&gt;'$.Restrictions'
FROM mysql.user WHERE User_attributes-&gt;&gt;'$.Restrictions' &lt;&gt; '';

</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-tables-priv-columns-priv"></a>tables_priv および columns_priv の付与テーブル</h4></div></div></div><p>
        アクセス制御の第 2 段階で、サーバーはリクエスト検証を実行して、各クライアントが発行するリクエストごとに十分な権限を持っていることを確認します。 <code class="literal">user</code> および <code class="literal">db</code> 付与テーブルに加えて、テーブルに関するリクエストの場合、サーバーは <code class="literal">tables_priv</code> および <code class="literal">columns_priv</code> テーブルを参照することもあります。 後者のテーブルは、テーブルレベルおよびカラムレベルでの細かい権限制御を提供します。 これらには、次の表に示すカラムがあります。 
      </p><div class="table"><a name="idm46723764154912"></a><p class="title"><b>表 6.6 tables_priv テーブルおよび columns_priv テーブルのカラム</b></p><div class="table-contents"><table><col style="width=20%"><col style="width=20%"><col style="width=20%"><thead><tr>
            <th scope="col">テーブル名</th>
            <th scope="col"><code class="literal">tables_priv</code></th>
            <th scope="col"><code class="literal">columns_priv</code></th>
          </tr></thead><tbody><tr>
            <th scope="row"><span class="bold"><strong>スコープカラム</strong></span></th>
            <td><code class="literal">Host</code></td>
            <td><code class="literal">Host</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Db</code></td>
            <td><code class="literal">Db</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">User</code></td>
            <td><code class="literal">User</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Table_name</code></td>
            <td><code class="literal">Table_name</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td></td>
            <td><code class="literal">Column_name</code></td>
          </tr><tr>
            <th scope="row"><span class="bold"><strong>権限カラム</strong></span></th>
            <td><code class="literal">Table_priv</code></td>
            <td><code class="literal">Column_priv</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Column_priv</code></td>
            <td></td>
          </tr><tr>
            <th scope="row"><span class="bold"><strong>その他のカラム</strong></span></th>
            <td><code class="literal">Timestamp</code></td>
            <td><code class="literal">Timestamp</code></td>
          </tr><tr>
            <th scope="row"></th>
            <td><code class="literal">Grantor</code></td>
            <td></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        <code class="literal">Timestamp</code> カラムと <code class="literal">Grantor</code> カラムは、それぞれ現在のタイムスタンプと <code class="literal">CURRENT_USER</code> 値に設定されますが、それ以外の場合は使用されません。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-procs-priv"></a>procs_priv 付与テーブル</h4></div></div></div><p>
        ストアドルーチンに関するリクエストを検証するために、サーバーは <code class="literal">procs_priv</code> テーブルを参照することがあり、このテーブルには次の表に示すカラムがあります。
      </p><div class="table"><a name="idm46723764104880"></a><p class="title"><b>表 6.7 procs_priv テーブルのカラム</b></p><div class="table-contents"><table><col style="width=20%"><col style="width=20%"><thead><tr>
            <th>テーブル名</th>
            <th><code class="literal">procs_priv</code></th>
          </tr></thead><tbody><tr>
            <td><span class="bold"><strong>スコープカラム</strong></span></td>
            <td><code class="literal">Host</code></td>
          </tr><tr>
            <td></td>
            <td><code class="literal">Db</code></td>
          </tr><tr>
            <td></td>
            <td><code class="literal">User</code></td>
          </tr><tr>
            <td></td>
            <td><code class="literal">Routine_name</code></td>
          </tr><tr>
            <td></td>
            <td><code class="literal">Routine_type</code></td>
          </tr><tr>
            <td><span class="bold"><strong>権限カラム</strong></span></td>
            <td><code class="literal">Proc_priv</code></td>
          </tr><tr>
            <td><span class="bold"><strong>その他のカラム</strong></span></td>
            <td><code class="literal">Timestamp</code></td>
          </tr><tr>
            <td></td>
            <td><code class="literal">Grantor</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        <code class="literal">Routine_type</code> カラムは、<code class="literal">'FUNCTION'</code> または <code class="literal">'PROCEDURE'</code> の値を持つ <code class="literal">ENUM</code> カラムであり、その行が示すルーチンのタイプを指します。 このカラムにより、同じ名前を持つ関数とプロシージャーに別々に権限を付与することができます。 
      </p><p>
        <code class="literal">Timestamp</code> カラムおよび <code class="literal">Grantor</code> カラムは未使用です。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-proxies-priv"></a>proxies_priv 付与テーブル</h4></div></div></div><p>
        <code class="literal">proxies_priv</code> テーブルには、プロキシアカウントに関する情報が記録されます。 これには次のカラムがあります。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Host</code>, <code class="literal">User</code>: プロキシアカウント (プロキシアカウントに対する <code class="literal">PROXY</code> 権限を持つアカウント)。
          </p></li><li class="listitem"><p>
            <code class="literal">Proxied_host</code>, <code class="literal">Proxied_user</code>: プロキシされたアカウント。
          </p></li><li class="listitem"><p>
            <code class="literal">Grantor</code>, <code class="literal">Timestamp</code>: Unused.
          </p></li><li class="listitem"><p>
            <code class="literal">With_grant</code>: プロキシアカウントが <code class="literal">PROXY</code> 権限を他のアカウントに付与できるかどうか。
          </p></li></ul></div><p>
        アカウントが <code class="literal">PROXY</code> 権限を他のアカウントに付与できるようにするには、<code class="literal">With_grant</code> が 1 に設定され、<code class="literal">Proxied_host</code> および <code class="literal">Proxied_user</code> が権限を付与できるアカウントを示す行が <code class="literal">proxies_priv</code> テーブルに含まれている必要があります。 たとえば、MySQL のインストール時に作成された<code class="literal">'root'@'localhost'</code>アカウントの <code class="literal">proxies_priv</code> テーブルには、<code class="literal">''@''</code>の <code class="literal">PROXY</code> 権限 (すべてのユーザーおよびすべてのホスト) の付与を可能にする行があります。 これにより、<code class="literal">root</code> はプロキシユーザーを設定したり、プロキシユーザーを設定するための権限をほかのアカウントに委任したりできます。 <a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-global-grants"></a>global_grants 付与テーブル</h4></div></div></div><p>
        <code class="literal">global_grants</code> テーブルには、ユーザーアカウントへの動的グローバル権限の現在の割当てがリストされます。 テーブルには次のカラムがあります。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">USER</code>, <code class="literal">HOST</code>: 権限が付与されるアカウントのユーザー名およびホスト名。
          </p></li><li class="listitem"><p>
            <code class="literal">PRIV</code>: 権限名。
          </p></li><li class="listitem"><p>
            <code class="literal">WITH_GRANT_OPTION</code>: アカウントが他のアカウントに権限を付与できるかどうか。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-default-roles"></a>default_roles 付与テーブル</h4></div></div></div><p>
        <code class="literal">default_roles</code> テーブルには、デフォルトのユーザーロールがリストされます。 これには次のカラムがあります。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">HOST</code>, <code class="literal">USER</code>: デフォルトロールが適用されるアカウントまたはロール。
          </p></li><li class="listitem"><p>
            <code class="literal">DEFAULT_ROLE_HOST</code>, <code class="literal">DEFAULT_ROLE_USER</code>: デフォルトロール。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-role-edges"></a>role_edges 付与テーブル</h4></div></div></div><p>
        <code class="literal">role_edges</code> テーブルには、ロールサブグラフのエッジがリストされます。 これには次のカラムがあります。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">FROM_HOST</code>, <code class="literal">FROM_USER</code>: ロールが付与されているアカウント。
          </p></li><li class="listitem"><p>
            <code class="literal">TO_HOST</code>, <code class="literal">TO_USER</code>: アカウントに付与されるロール。
          </p></li><li class="listitem"><p>
            <code class="literal">WITH_ADMIN_OPTION</code>: アカウントが <code class="literal">WITH ADMIN OPTION</code> を使用して他のアカウントにロールを付与したり、他のアカウントからロールを取り消すことができるかどうか。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-password-history"></a>password_history 付与テーブル</h4></div></div></div><p>
        <code class="literal">password_history</code> テーブルには、パスワード変更に関する情報が含まれています。 これには次のカラムがあります。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Host</code>, <code class="literal">User</code>: パスワード変更が発生したアカウント。
          </p></li><li class="listitem"><p>
            <code class="literal">Password_timestamp</code>: パスワード変更が発生した時刻。
          </p></li><li class="listitem"><p>
            <code class="literal">Password</code>: 新しいパスワードハッシュ値。
          </p></li></ul></div><p>
        <code class="literal">password_history</code> テーブルには、MySQL がアカウントパスワード履歴の長さと再利用間隔の両方に対してチェックを実行できるように、アカウントごとに空でない十分な数のパスワードが蓄積されます。 両方の制限外のエントリの自動プルーニングは、パスワード変更の試行が発生したときに行われます。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          空のパスワードはパスワード履歴にカウントされず、いつでも再利用される可能性があります。
        </p></div><p>
        アカウントの名前が変更されると、一致するようにそのエントリの名前が変更されます。 アカウントが削除されるか、その認証プラグインが変更されると、そのエントリは削除されます。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-scope-column-properties"></a>付与テーブルのスコープカラムのプロパティ</h4></div></div></div><p>
        付与テーブルのスコープカラムには文字列が格納されています。 それぞれのデフォルト値は空の文字列です。 次のテーブルに、各カラムで許可される文字数を示します。 
      </p><div class="table"><a name="idm46723764007824"></a><p class="title"><b>表 6.8 付与テーブルの有効範囲カラム長</b></p><div class="table-contents"><table><col style="width=50%"><col style="width=50%"><thead><tr>
            <th>カラム名</th>
            <th>最大許容文字数</th>
          </tr></thead><tbody><tr>
            <td><code class="literal">Host</code>、<code class="literal">Proxied_host</code></td>
            <td>255 (MySQL 8.0.17 より前の 60)</td>
          </tr><tr>
            <td><code class="literal">User</code>、<code class="literal">Proxied_user</code></td>
            <td>32</td>
          </tr><tr>
            <td><code class="literal">Db</code></td>
            <td>64</td>
          </tr><tr>
            <td><code class="literal">Table_name</code></td>
            <td>64</td>
          </tr><tr>
            <td><code class="literal">Column_name</code></td>
            <td>64</td>
          </tr><tr>
            <td><code class="literal">Routine_name</code></td>
            <td>64</td>
          </tr></tbody></table></div></div><br class="table-break"><a class="indexterm" name="idm46723763985760"></a><a class="indexterm" name="idm46723763983648"></a><p>
        <code class="literal">Host</code> および <code class="literal">Proxied_host</code> の値は、権限付与テーブルに格納される前に小文字に変換されます。
      </p><p>
        アクセスチェックの目的で、<code class="literal">User</code>, <code class="literal">Proxied_user</code>, <code class="literal">authentication_string</code>, <code class="literal">Db</code> と <code class="literal">Table_name</code> の値の比較では大/小文字が区別されます。 <code class="literal">Host</code>, <code class="literal">Proxied_host</code>, <code class="literal">Column_name</code> と <code class="literal">Routine_name</code> の値の比較では、大/小文字は区別されません。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-privilege-column-properties"></a>テーブル権限の付与のカラムプロパティ</h4></div></div></div><p>
        <code class="literal">user</code> テーブルおよび <code class="literal">db</code> テーブルでは、<code class="literal">ENUM('N','Y') DEFAULT 'N'</code>として宣言された個別のカラムに各権限がリストされます。 つまり、各権限は無効または有効にすることができ、デフォルトは無効です。 
      </p><p>
        <code class="literal">tables_priv</code>、<code class="literal">columns_priv</code> および <code class="literal">procs_priv</code> の各テーブルでは、権限カラムを <code class="literal">SET</code> カラムとして宣言します。 これらのカラムの値は、テーブルによって制御されるあらゆる組み合わせの権限を含むことができます。 カラム値にリストされている権限のみが入力されます。 
      </p><div class="table"><a name="idm46723763964560"></a><p class="title"><b>表 6.9 Set タイプ権限のカラム値</b></p><div class="table-contents"><table><col style="width=20%"><col style="width=25%"><col style="width=45%"><thead><tr>
            <th scope="col">テーブル名</th>
            <th scope="col">カラム名</th>
            <th scope="col">可能な Set 要素</th>
          </tr></thead><tbody><tr>
            <th scope="row"><code class="literal">tables_priv</code></th>
            <td><code class="literal">Table_priv</code></td>
            <td><code class="literal">'Select', 'Insert', 'Update', 'Delete', 'Create', 'Drop', 'Grant', 'References', 'Index', 'Alter', 'Create View', 'Show view', 'Trigger'</code></td>
          </tr><tr>
            <th scope="row"><code class="literal">tables_priv</code></th>
            <td><code class="literal">Column_priv</code></td>
            <td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td>
          </tr><tr>
            <th scope="row"><code class="literal">columns_priv</code></th>
            <td><code class="literal">Column_priv</code></td>
            <td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td>
          </tr><tr>
            <th scope="row"><code class="literal">procs_priv</code></th>
            <td><code class="literal">Proc_priv</code></td>
            <td><code class="literal">'Execute', 'Alter Routine', 'Grant'</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        <code class="literal">RELOAD</code>、<code class="literal">SHUTDOWN</code>、<code class="literal">SYSTEM_VARIABLES_ADMIN</code> などの管理権限を指定するのは、<code class="literal">user</code> テーブルおよび <code class="literal">global_grants</code> テーブルのみです。 管理操作はサーバー自体での操作であって、データベース固有でないため、これらの権限をほかの付与テーブルにリストする理由はありません。 したがって、サーバーは、ユーザーが管理操作を実行できるかどうかを判断するために、<code class="literal">user</code> および <code class="literal">global_grants</code> テーブルのみを参照する必要があります。 
      </p><p>
        <code class="literal">FILE</code> 権限も、<code class="literal">user</code> テーブルでのみ指定されます。 このような管理権限ではありませんが、サーバーホスト上のファイルの読取りまたは書込みを行うユーザー権限は、アクセスされるデータベースから独立しています。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="grant-tables-concurrency"></a>テーブル同時実行性の付与</h4></div></div></div><p>
        MySQL 8.0.22 では、MySQL 付与テーブルに対する同時 DML 操作および DDL 操作を許可するために、MySQL 付与テーブルに対して以前に行ロックを取得した読取り操作は、非ロック読取りとして実行されます。 MySQL 付与テーブルで非ロック読み取りとして実行される操作には、次のものがあります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            任意のトランザクション分離レベルを使用して、結合リストおよびサブクエリー (<code class="literal">SELECT ... FOR SHARE</code> ステートメントを含む) を介して付与テーブルからデータを読み取る <code class="literal">SELECT</code> ステートメントおよびその他の読取り専用ステートメント。
          </p></li><li class="listitem"><p>
            任意のトランザクション分離レベルを使用して (結合リストまたはサブクエリーを介して) 付与テーブルからデータを読み取り、変更を伴わない DML 操作。
          </p></li></ul></div><p>
        付与テーブルからデータを読み取るときに行ロックを取得しなくなったステートメントは、ステートメントベースレプリケーションの使用中に実行された場合に警告を報告します。
      </p><p>
        使用時 -<code class="literal">binlog_format=mixed</code>、付与テーブルからデータを読み取る DML 操作は、混合モードのレプリケーションで操作を安全にするために、行イベントとしてバイナリログに書き込まれます。
      </p><p>
        付与テーブルからデータを読み取る <code class="literal">SELECT ... FOR SHARE</code> ステートメントは警告を報告します。 <code class="literal">FOR SHARE</code> 句を使用する場合、読取りロックは付与テーブルではサポートされません。 
      </p><p>
        付与テーブルからデータを読み取り、<code class="literal">SERIALIZABLE</code> 分離レベルを使用して実行される DML 操作では、警告がレポートされます。 <code class="literal">SERIALIZABLE</code> 分離レベルの使用時に通常取得される読取りロックは、付与テーブルではサポートされていません。 
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="account-names"></a>6.2.4 アカウント名の指定</h3></div></div></div><a class="indexterm" name="idm46723763911536"></a><a class="indexterm" name="idm46723763910112"></a><a class="indexterm" name="idm46723763908080"></a><a class="indexterm" name="idm46723763906048"></a><a class="indexterm" name="idm46723763904000"></a><a class="indexterm" name="idm46723763901952"></a><a class="indexterm" name="idm46723763899872"></a><a class="indexterm" name="idm46723763897808"></a><p>
      MySQL アカウント名は、ユーザー名とホスト名で構成されます。これにより、異なるホストから接続する同じユーザー名を持つユーザーに対して個別のアカウントを作成できます。 このセクションでは、特別な値やワイルドカードルールなど、アカウント名の構文について説明します。 
    </p><p>
      ほとんどの点で、アカウント名は MySQL のロール名と似ていますが、<a class="xref" href="security.html#role-names" title="6.2.5 ロール名の指定">セクション6.2.5「ロール名の指定」</a> で説明されているいくつかの違いがあります。
    </p><p>
      アカウント名は、<code class="literal">CREATE USER</code>、<code class="literal">GRANT</code>、<code class="literal">SET PASSWORD</code> などの SQL ステートメントに表示され、次のルールに従います:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アカウント名の構文は<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>です。
        </p></li><li class="listitem"><p>
          <code class="literal">@'<em class="replaceable"><code>host_name</code></em>'</code>部分はオプションです。 ユーザー名のみで構成されるアカウント名は、<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'%'</code> と同等です。 たとえば、<code class="literal">'me'</code> は <code class="literal">'me'@'%'</code> と同等です。 
        </p></li><li class="listitem"><p>
          ユーザー名およびホスト名は、それらが引用符なしの識別子として有効な場合、引用する必要はありません。 <em class="replaceable"><code>user_name</code></em> 文字列に特殊文字 (スペースや <code class="literal">-</code> など) が含まれている場合、または <em class="replaceable"><code>host_name</code></em> 文字列に特殊文字やワイルドカード文字 (<code class="literal">.</code> や <code class="literal">%</code> など) が含まれている場合は、引用符を使用する必要があります。 たとえば、アカウント名<code class="literal">'test-user'@'%.com'</code>では、ユーザー名とホスト名の両方の部分に引用符が必要です。 
        </p></li><li class="listitem"><p>
          バックティック (<code class="literal">`</code>)、一重引用符 (<code class="literal">'</code>) または二重引用符 (<code class="literal">"</code>) を使用して、ユーザー名とホスト名を識別子または文字列として引用符で囲みます。 文字列および識別子として引用符で囲む方法のガイドラインについては、<a class="xref" href="language-structure.html#string-literals" title="9.1.1 文字列リテラル">セクション9.1.1「文字列リテラル」</a>および<a class="xref" href="language-structure.html#identifiers" title="9.2 スキーマオブジェクト名">セクション9.2「スキーマオブジェクト名」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          ユーザー名およびホスト名の部分が引用符で囲まれる場合、別々に囲んでください。 つまり、<code class="literal">'me@localhost'</code>ではなく<code class="literal">'me'@'localhost'</code>と記述します。 後者は、実際には<code class="literal">'me@localhost'@'%'</code>と同等です。 
        </p></li><li class="listitem"><p>
          <code class="literal">CURRENT_USER</code> または <code class="literal">CURRENT_USER()</code> 関数への参照は、現行クライアントのユーザー名およびホスト名の文字を指定することと同等です。
        </p></li></ul></div><p>
      MySQL では、ユーザー名とホスト名の部分に別々のカラムを使用して、アカウント名が <code class="literal">mysql</code> システムデータベースの付与テーブルに格納されます:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">user</code> テーブルにはアカウントごとに 1 行が格納されます。 <code class="literal">User</code> および <code class="literal">Host</code> カラムはユーザー名およびホスト名を格納します。 このテーブルには、アカウントが持つグローバル権限も指定されます。 
        </p></li><li class="listitem"><p>
          ほかの付与テーブルには、データベースおよびデータベース内のオブジェクトに対してアカウントが持つ権限が示されます。 これらのテーブルにはアカウント名を格納するための <code class="literal">User</code> および <code class="literal">Host</code> カラムがあります。 これらのテーブルの各行は、同じ <code class="literal">User</code> および <code class="literal">Host</code> の値を持つ <code class="literal">user</code> テーブル内のアカウントに関連付けられています。 
        </p></li><li class="listitem"><p>
          アクセスチェックの目的で、ユーザー値の比較では大/小文字が区別されます。 ホスト値の比較では、大文字と小文字は区別されません。 
        </p><a class="indexterm" name="idm46723763854608"></a><a class="indexterm" name="idm46723763852448"></a></li></ul></div><p>
      付与テーブルに格納されているユーザー名とホスト名のプロパティー (最大長など) の詳細は、<a class="xref" href="security.html#grant-tables-scope-column-properties" title="付与テーブルのスコープカラムのプロパティ">付与テーブルのスコープカラムのプロパティ</a> を参照してください。
    </p><p>
      ユーザー名およびホスト名は、次に示すような特殊な値が使用されたりワイルドカード規則が適用されたりします。
    </p><p>
      アカウント名のユーザー名部分は、受信接続試行のユーザー名と文字どおり一致する空白以外の値、または任意のユーザー名と一致する空白の値 (空の文字列) です。 ブランクのユーザー名を持つアカウントは匿名ユーザーです。 SQL ステートメントで匿名ユーザーを指定するには、<code class="literal">''@'localhost'</code> のように引用符で囲んだ空のユーザー名部分を使用します。 
    </p><p>
      アカウント名のホスト名部分は多くの形式を持つことができ、ワイルドカードが許可されます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ホスト値はホスト名または IP アドレス (IPv4 または IPv6) とすることができます。 <code class="literal">'localhost'</code> という名前はローカルホストを示します。 IP アドレス <code class="literal">'127.0.0.1'</code> は IPv4 ループバックインタフェースを示します。 IP アドレス <code class="literal">'::1'</code> は、IPv6 ループバックインタフェースを示します。 
        </p></li><li class="listitem"><p>
          <code class="literal">%</code> および<code class="literal">_</code>のワイルドカード文字は、ホスト名または IP アドレスの値に使用できます。 これらは <code class="literal">LIKE</code> 演算子で実行されるパターンマッチング演算と同じ意味を持ちます。 たとえば、<code class="literal">'%'</code>のホスト値は任意のホスト名に一致しますが、<code class="literal">'%.mysql.com'</code>の値は <code class="literal">mysql.com</code> ドメインの任意のホストに一致します。<code class="literal">'198.51.100.%'</code>は、1 つの 98.51.100 クラス C ネットワーク内の任意のホストに一致します。 
        </p><a class="indexterm" name="idm46723763835216"></a><p>
          IP ワイルドカード値はホスト値で許可されているため (たとえば、サブネット上のすべてのホストに一致する<code class="literal">'198.51.100.%'</code>など)、ホストに <code class="literal">198.51.100.somewhere.com</code> という名前を付けてこの機能を利用しようとする可能性があります。 このような試行を行うために、MySQL では、数字とドットで始まるホスト名の照合は実行されません。 たとえば、ホストの名前が <code class="literal">1.2.example.com</code> の場合、その名前はアカウント名のホスト部分と一致しません。 IP ワイルドカード値は、ホスト名でなく IP アドレスのみと一致することができます。 
        </p></li><li class="listitem"><p>
          IPv4 アドレスとして指定されたホスト値の場合、ネットマスクを指定して、ネットワーク番号に使用するアドレスビット数を示すことができます。 ネットマスク表記は IPv6 アドレスについては使用できません。 
        </p><a class="indexterm" name="idm46723763828208"></a><p>
          構文は <code class="literal"><em class="replaceable"><code>host_ip</code></em>/<em class="replaceable"><code>netmask</code></em></code> です。 例: 
        </p><pre class="programlisting">CREATE USER 'david'@'198.51.100.0/255.255.255.0';
</pre><p>
          これにより <code class="literal">david</code> は、次の条件が true となる IP アドレス <em class="replaceable"><code>client_ip</code></em> を持つすべてのクライアントホストから接続できます。
        </p><pre class="programlisting"><em class="replaceable"><code>client_ip</code></em> &amp; <em class="replaceable"><code>netmask</code></em> = <em class="replaceable"><code>host_ip</code></em>
</pre><p>
          つまり、次のような <code class="literal">CREATE USER</code> ステートメントがあるとします。
        </p><pre class="programlisting"><em class="replaceable"><code>client_ip</code></em> &amp; 255.255.255.0 = 198.51.100.0
</pre><p>
          この条件を満たす IP アドレスの範囲は、<code class="literal">198.51.100.0</code> から <code class="literal">198.51.100.255</code> です。
        </p><p>
          ネットマスクは通常、1 に設定されたビットから始まり、0 に設定されたビットが続きます。 例: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">198.0.0.0/255.0.0.0</code>: 198 のクラス A ネットワーク上のすべてのホスト
            </p></li><li class="listitem"><p>
              <code class="literal">198.51.0.0/255.255.0.0</code>: 198.51 のクラス B ネットワーク上のすべてのホスト
            </p></li><li class="listitem"><p>
              <code class="literal">198.51.100.0/255.255.255.0</code>: 198.51.100 のクラス C ネットワーク上のすべてのホスト
            </p></li><li class="listitem"><p>
              <code class="literal">198.51.100.1</code>: この特定の IP アドレスを持つホストのみ
            </p></li></ul></div></li><li class="listitem"><p>
          MySQL 8.0.23 では、IPv4 アドレスとして指定されたホスト値は、<code class="literal">198.51.100.44/24</code> などの CIDR 表記法を使用して書き込むことができます。
        </p><a class="indexterm" name="idm46723763805408"></a></li></ul></div><p>
      サーバーは、クライアントホスト名または IP アドレス用のシステム DNS リゾルバによって返された値を使用して、アカウント名のホスト値の突き合わせをクライアントホストに対して実行します。 アカウントのホスト値がネットマスク表記法を使用して指定されている場合を除き、サーバーは、IP アドレスとして指定されたアカウントのホスト値に対しても、この比較を文字列一致として実行します。 つまり、DNS によって使用されるのと同じ形式でアカウントホスト値を指定しなければならないということを意味します。 留意するべき問題の例を次に示します。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ローカルネットワーク上のホストの完全修飾名が <code class="literal">host1.example.com</code> だとします。 DNS がこのホストの名前参照を <code class="literal">host1.example.com</code> として返す場合、アカウントホスト値にこの名前を使用します。 DNS が <code class="literal">host1</code> のみを返す場合は、かわりに <code class="literal">host1</code> を使用します。 
        </p></li><li class="listitem"><p>
          DNS が特定のホストの IP アドレスを <code class="literal">198.51.100.2</code> として返す場合、<code class="literal">198.51.100.2</code> のアカウントホスト値と一致しますが、<code class="literal">198.051.100.2</code> とは一致しません。 同様に、<code class="literal">198.51.100.%</code> のようなアカウントホストパターンに一致しますが、<code class="literal">198.051.100.%</code> には一致しません。 
        </p></li></ul></div><p>
      このような問題を回避するには、DNS がホスト名とアドレスを返す形式を確認することをお薦めします。 MySQL アカウント名には、同じ形式の値を使用します。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="role-names"></a>6.2.5 ロール名の指定</h3></div></div></div><a class="indexterm" name="idm46723763789824"></a><a class="indexterm" name="idm46723763788368"></a><a class="indexterm" name="idm46723763786336"></a><p>
      MySQL のロール名は、権限の名前付きコレクションであるロールを参照します。 ロールの使用例は、<a class="xref" href="security.html#roles" title="6.2.10 ロールの使用">セクション6.2.10「ロールの使用」</a> を参照してください。 
    </p><p>
      ロール名の構文とセマンティクスは、アカウント名と似ています。<a class="xref" href="security.html#account-names" title="6.2.4 アカウント名の指定">セクション6.2.4「アカウント名の指定」</a> を参照してください。 付与テーブルに格納されているように、<a class="xref" href="security.html#grant-tables-scope-column-properties" title="付与テーブルのスコープカラムのプロパティ">付与テーブルのスコープカラムのプロパティ</a> で説明されているアカウント名と同じプロパティーを持ちます。 
    </p><p>
      ロール名は、次の点でアカウント名と異なります:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ロール名のユーザー部分は空白にできません。 したがって、<span class="quote">「<span class="quote">「匿名ユーザー」</span>」</span>の概念に類似した<span class="quote">「<span class="quote">「匿名ロール」</span>」</span>はありません。 
        </p></li><li class="listitem"><p>
          アカウント名の場合、ロール名のホスト部分を省略すると、<code class="literal">'%'</code>のホスト部分になります。 ただし、アカウント名の<code class="literal">'%'</code>とは異なり、ロール名の<code class="literal">'%'</code>のホスト部分にはワイルドカードプロパティはありません。 たとえば、ロール名として使用される名前<code class="literal">'me'@'%'</code>の場合、ホスト部分 (<code class="literal">'%'</code>) はリテラル値であり、<span class="quote">「<span class="quote">「任意のホスト」</span>」</span>一致プロパティはありません。 
        </p></li><li class="listitem"><p>
          ロール名のホスト部分のネットマスク表記に意味はありません。
        </p></li><li class="listitem"><p>
          アカウント名は、複数のコンテキストで <code class="literal">CURRENT_USER()</code> にすることができます。 ロール名がではありません。 
        </p></li></ul></div><p>
      <code class="literal">mysql.user</code> システムテーブルの行は、アカウントとロールの両方として機能できます。 この場合、プロパティに一致する特別なユーザー名またはホスト名は、名前がロール名として使用されるコンテキストには適用されません。 たとえば、次のステートメントは、<code class="literal">myrole</code> のユーザー部分およびホスト名を持つすべてのロールを使用して現在のセッションロールを設定することを想定して実行できません: 
    </p><pre class="programlisting">SET ROLE 'myrole'@'%';
</pre><p>
      かわりに、このステートメントはセッションのアクティブロールを<code class="literal">'myrole'@'%'</code>という名前のロールに設定します。
    </p><p>
      このため、多くの場合、ロール名はユーザー名部分のみを使用して指定され、ホスト名部分は暗黙的に<code class="literal">'%'</code>になります。 <code class="literal">'%'</code>以外のホスト部分でロールを指定すると、特定のホストからの接続を許可されたユーザーアカウントとしてロールとして機能する名前を作成する場合に役立ちます。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="connection-access"></a>6.2.6 アクセス制御、ステージ 1: 接続の検証</h3></div></div></div><a class="indexterm" name="idm46723763760960"></a><a class="indexterm" name="idm46723763759520"></a><a class="indexterm" name="idm46723763757488"></a><p>
      MySQL サーバーに接続しようとすると、サーバーは次の条件に基づいて接続を受け入れるか拒否します:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アイデンティティ、および適切な資格証明を指定して検証できるかどうか。
        </p></li><li class="listitem"><p>
          アカウントがロックされているかロック解除されているか。
        </p></li></ul></div><p>
      サーバーはまず資格証明をチェックし、次にアカウントのロック状態をチェックします。 いずれかのステップで障害が発生すると、サーバーはユーザーへのアクセスを完全に拒否します。 それ以外の場合、サーバーは接続を受け入れてステージ 2 に進み、リクエストを待機します。 
    </p><p>
      サーバーは、<code class="literal">user</code> テーブルのカラムを使用してアイデンティティと資格証明のチェックを実行し、次の条件を満たしている場合にのみ接続を受け入れます:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          クライアントホスト名およびユーザー名は、一部の <code class="literal">user</code> テーブルの行の <code class="literal">Host</code> および <code class="literal">User</code> のカラムと一致します。 <code class="literal">Host</code> および <code class="literal">User</code> の許容値を制御するルールについては、<a class="xref" href="security.html#account-names" title="6.2.4 アカウント名の指定">セクション6.2.4「アカウント名の指定」</a> を参照してください。 
        </p></li><li class="listitem"><p>
          クライアントは、<code class="literal">authentication_string</code> カラムで示されるように、行で指定された資格証明 (パスワードなど) を提供します。 資格証明は、<code class="literal">plugin</code> カラムで指定された認証プラグインを使用して解釈されます。 
        </p></li><li class="listitem"><p>
          行は、アカウントがロック解除されていることを示します。 ロック状態は <code class="literal">account_locked</code> カラムに記録されます。このカラムの値は<code class="literal">'N'</code>である必要があります。 アカウントのロックは、<code class="literal">CREATE USER</code> ステートメントまたは <code class="literal">ALTER USER</code> ステートメントを使用して設定または変更できます。 
        </p></li></ul></div><p>
      ユーザーの ID は 2 つの部分の情報に基づきます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL ユーザー名
        </p></li><li class="listitem"><p>
          接続元のクライアントホスト
        </p></li></ul></div><a class="indexterm" name="idm46723763733872"></a><p>
      <code class="literal">User</code> カラム値がブランクでない場合、入接続のユーザー名は正確に一致する必要があります。 <code class="literal">User</code> 値がブランクの場合、これはすべてのユーザー名と一致します。 入接続と一致する <code class="literal">user</code> テーブル行のユーザー名がブランクである場合、ユーザーはクライアントが実際に指定した名前を持つユーザーでなく、名前のない匿名ユーザーとみなされます。 つまり、接続期間中の (つまりステージ 2 での) 今後のすべてのアクセスチェックでブランクのユーザー名が使用されることを意味します。 
    </p><p>
      <code class="literal">authentication_string</code> カラムは空白にできます。 これはワイルドカードではなく、あらゆるパスワードが一致するという意味ではありません。 これは、ユーザーはパスワードを指定せずに接続しなければならないことを意味します。 クライアントを認証するプラグインによって実装される認証方法は、<code class="literal">authentication_string</code> カラムのパスワードを使用する場合と使用しない場合があります。 この場合、MySQL サーバーへの認証を行う際に、外部パスワードも使用される可能性があります。 
    </p><p>
      <code class="literal">user</code> テーブルの <code class="literal">authentication_string</code> カラムに格納されている空白以外のパスワード値は暗号化されます。 MySQL では、パスワードはクリアテキストとして格納されず、すべてのユーザーに表示されます。 かわりに、接続しようとしているユーザーが指定したパスワードは暗号化されます (アカウント認証プラグインによって実装されたパスワードハッシュ方式を使用)。 そのあと、暗号化パスワードは、接続プロセス中にパスワードが正しいかどうかをチェックするときに使用されます。 これは、暗号化パスワードが接続を介してやりとりされずに実行されます。 <a class="xref" href="security.html#user-names" title="6.2.1 アカウントのユーザー名とパスワード">セクション6.2.1「アカウントのユーザー名とパスワード」</a>を参照してください。 
    </p><p>
      MySQL から見ると、暗号化パスワードが<span class="emphasis"><em>実際の</em></span>パスワードであるため、暗号化パスワードへのアクセス権限をすべてのユーザーに付与しないようにしてください。 特に、<span class="emphasis"><em>「<code class="literal">mysql</code> システムデータベース内のテーブルへの読取りアクセス権を非管理ユーザーに付与しない」</em></span>です。 
    </p><p>
      次のテーブルに、<code class="literal">user</code> テーブルの <code class="literal">User</code> 値と <code class="literal">Host</code> 値の様々な組合せが着信接続にどのように適用されるかを示します。
    </p><div class="informaltable"><table summary="How various combinations of User and Host values in the user table apply to incoming connections to a MySQL server."><col style="width=15%"><col style="width=35%"><col style="width=50%"><thead><tr>
          <th scope="col"><code class="literal">User</code> 値</th>
          <th scope="col"><code class="literal">Host</code> 値</th>
          <th scope="col">許容される接続</th>
        </tr></thead><tbody><tr>
          <th scope="row"><code class="literal">'fred'</code></th>
          <td><code class="literal">'h1.example.net'</code></td>
          <td><code class="literal">fred</code>, <code class="literal">h1.example.net</code> からの接続</td>
        </tr><tr>
          <th scope="row"><code class="literal">''</code></th>
          <td><code class="literal">'h1.example.net'</code></td>
          <td><code class="literal">h1.example.net</code> から接続する任意のユーザー</td>
        </tr><tr>
          <th scope="row"><code class="literal">'fred'</code></th>
          <td><code class="literal">'%'</code></td>
          <td>任意のホストから接続する <code class="literal">fred</code></td>
        </tr><tr>
          <th scope="row"><code class="literal">''</code></th>
          <td><code class="literal">'%'</code></td>
          <td>任意のホストから接続する任意のユーザー</td>
        </tr><tr>
          <th scope="row"><code class="literal">'fred'</code></th>
          <td><code class="literal">'%.example.net'</code></td>
          <td><code class="literal">fred</code>, <code class="literal">example.net</code> ドメインの任意のホストからの接続</td>
        </tr><tr>
          <th scope="row"><code class="literal">'fred'</code></th>
          <td><code class="literal">'x.example.%'</code></td>
          <td><code class="literal">fred</code>、<code class="literal">x.example.net</code>, <code class="literal">x.example.com</code>, <code class="literal">x.example.edu</code> からの接続など。これはおそらく役に立ちません</td>
        </tr><tr>
          <th scope="row"><code class="literal">'fred'</code></th>
          <td><code class="literal">'198.51.100.177'</code></td>
          <td>IP アドレス <code class="literal">198.51.100.177</code> のホストから接続する <code class="literal">fred</code></td>
        </tr><tr>
          <th scope="row"><code class="literal">'fred'</code></th>
          <td><code class="literal">'198.51.100.%'</code></td>
          <td><code class="literal">198.51.100</code> のクラス C サブネットの任意のホストから接続する <code class="literal">fred</code></td>
        </tr><tr>
          <th scope="row"><code class="literal">'fred'</code></th>
          <td><code class="literal">'198.51.100.0/255.255.255.0'</code></td>
          <td>前の例と同じ</td>
        </tr></tbody></table></div><p>
      入接続のクライアントホスト名およびユーザー名が <code class="literal">user</code> テーブルの複数行と一致することもあります。 前述の一連の例は、これを示しています: 表示されるエントリのいくつかは、<code class="literal">fred</code> による <code class="literal">h1.example.net</code> からの接続と一致します。 
    </p><p>
      複数の一致が可能な場合、サーバーはいずれを使用するかを決定する必要があります。 この問題は、次のように解決されます。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーが <code class="literal">user</code> テーブルをメモリーに読み取るとき、行を毎回ソートします。
        </p></li><li class="listitem"><p>
          クライアントが接続しようとすると、サーバーは行をソート順に参照します。
        </p></li><li class="listitem"><p>
          サーバーは、クライアントホスト名およびユーザー名が一致した最初の行を使用します。
        </p></li></ul></div><p>
      サーバーは、特定の <code class="literal">Host</code> 値が最も多い行から順に並べ替えるソートルールを使用します:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          リテラル IP アドレスとホスト名は最も具体的です。
        </p></li><li class="listitem"><p>
          MySQL 8.0.23 より前は、リテラル IP アドレスの特異性はネットマスクがあるかどうかの影響を受けないため、<code class="literal">198.51.100.13</code> と <code class="literal">198.51.100.0/255.255.255.0</code> は同等とみなされます。 MySQL 8.0.23 の時点では、ホスト部分に IP アドレスを持つアカウントには次のような特異性があります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              ホスト部分が IP アドレスとして指定されているアカウント:
            </p><pre class="programlisting">CREATE USER '<em class="replaceable"><code>user_name</code></em>'@'127.0.0.1';
CREATE USER '<em class="replaceable"><code>user_name</code></em>'@'198.51.100.44';
</pre></li><li class="listitem"><p>
              CIDR 表記を使用して IP アドレスとして指定されたホスト部分を持つアカウント:
            </p><pre class="programlisting">CREATE USER '<em class="replaceable"><code>user_name</code></em>'@'192.0.2.21/8';
CREATE USER '<em class="replaceable"><code>user_name</code></em>'@'198.51.100.44/16';
</pre></li><li class="listitem"><p>
              ホスト部分が IP アドレスとしてサブネットマスクとともに指定されているアカウント:
            </p><pre class="programlisting">CREATE USER '<em class="replaceable"><code>user_name</code></em>'@'192.0.2.0/255.255.255.0';
CREATE USER '<em class="replaceable"><code>user_name</code></em>'@'198.51.0.0/255.255.0.0';
</pre></li></ul></div></li><li class="listitem"><p>
          パターン <code class="literal">'%'</code> は<span class="quote">「<span class="quote">任意のホスト</span>」</span>を意味するため、具体性はもっとも低くなります。
        </p></li><li class="listitem"><p>
          空の文字列 <code class="literal">''</code> も<span class="quote">「<span class="quote">任意のホスト</span>」</span>を意味しますが、<code class="literal">'%'</code> のあとにソートされます。
        </p></li></ul></div><p>
      非 TCP (ソケットファイル、名前付きパイプおよび共有メモリー) 接続は、ローカル接続として扱われ、そのようなアカウントがある場合は <code class="literal">localhost</code> のホスト部分と照合され、そうでない場合は <code class="literal">localhost</code> と一致するワイルドカードを持つホスト部分と照合されます (たとえば、<code class="literal">local%</code>, <code class="literal">l%</code>, <code class="literal">%</code>)。
    </p><p>
      同じ <code class="literal">Host</code> 値を持つ行は、最も固有の <code class="literal">User</code> 値から順に並べられます。 空白の <code class="literal">User</code> 値は<span class="quote">「<span class="quote">「任意のユーザー」</span>」</span>を意味し、最も限定的ではないため、同じ <code class="literal">Host</code> 値を持つ行の場合、匿名でないユーザーは匿名ユーザーの前にソートされます。 
    </p><p>
      <code class="literal">Host</code> と <code class="literal">User</code> の値が等しい行の場合、順序は非決定的です。
    </p><p>
      <code class="literal">user</code> テーブルが次の内容であると仮定して、これがどのように作用するかを説明します。
    </p><pre class="programlisting">+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| %         | root     | ...
| %         | jeffrey  | ...
| localhost | root     | ...
| localhost |          | ...
+-----------+----------+-
</pre><p>
      サーバーがテーブルをメモリーに読み取るとき、サーバーは前に記載したルールを使用して行をソートします。 ソート後の結果は次のようになります。 
    </p><pre class="programlisting">+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| localhost | root     | ...
| localhost |          | ...
| %         | jeffrey  | ...
| %         | root     | ...
+-----------+----------+-
</pre><a class="indexterm" name="idm46723763619120"></a><a class="indexterm" name="idm46723763616976"></a><a class="indexterm" name="idm46723763614944"></a><p>
      クライアントが接続しようとすると、サーバーはソート済みの行を参照し、見つかった最初の一致を使用します。 <code class="literal">jeffrey</code> による <code class="literal">localhost</code> からの接続の場合、テーブルの 2 つの行が一致し、すなわち <code class="literal">Host</code> および <code class="literal">User</code> 値が <code class="literal">'localhost'</code> および <code class="literal">''</code> であるものと、値が <code class="literal">'%'</code> および <code class="literal">'jeffrey'</code> であるものが一致します。 ソート順では <code class="literal">'localhost'</code> 行が最初になるため、サーバーはこの行を使用します。 
    </p><p>
      次に別の例を示します。 <code class="literal">user</code> テーブルが次のようになっていると仮定します。 
    </p><pre class="programlisting">+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| %              | jeffrey  | ...
| h1.example.net |          | ...
+----------------+----------+-
</pre><p>
      ソート済みテーブルは次のようになります。
    </p><pre class="programlisting">+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| h1.example.net |          | ...
| %              | jeffrey  | ...
+----------------+----------+-
</pre><p>
      最初の行は <code class="literal">h1.example.net</code> の任意のユーザーによる接続と一致し、2 番目の行は任意のホストの <code class="literal">jeffrey</code> による接続と一致します。
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        よくある誤解として、ある特定のユーザー名についてサーバーが接続に対する一致を検出しようとしたとき、そのユーザーの名前を明示的に指定するすべての行が最初に使用されるという認識があります。 これは正しくありません。 前述の例は、<code class="literal">jeffrey</code> による <code class="literal">h1.example.net</code> からの接続が、<code class="literal">User</code> カラム値として<code class="literal">'jeffrey'</code>を含む行ではなく、ユーザー名のない行によって最初に照合されることを示しています。 その結果、<code class="literal">jeffrey</code> は接続するときにユーザー名を指定したにもかかわらず、匿名ユーザーとして認証されます。 
      </p></div><p>
      サーバーに接続できても権限が期待したものとは異なる場合、おそらくほかのアカウントとして認証されています。 サーバーがユーザーの認識に使用したアカウントを見つけるには、<code class="literal">CURRENT_USER()</code> 関数を使用します。 (<a class="xref" href="functions.html#information-functions" title="12.16 情報関数">セクション12.16「情報関数」</a>を参照してください。) これは、一致する <code class="literal">user</code> テーブル行の <code class="literal">User</code> および <code class="literal">Host</code> 値を示す、<code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の値を返します。 たとえば、<code class="literal">jeffrey</code> が接続して、次のクエリーを発行したとします。 
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT CURRENT_USER();</code></strong>
+----------------+
| CURRENT_USER() |
+----------------+
| @localhost     |
+----------------+
</pre><p>
      ここで表示された結果は、一致した <code class="literal">user</code> テーブル行の <code class="literal">User</code> カラム値がブランクであることを示しています。 つまり、サーバーは <code class="literal">jeffrey</code> を匿名ユーザーとして扱っています。 
    </p><p>
      認証の問題を診断するための別の方法は、<code class="literal">user</code> テーブルを出力し、テーブルを手作業でソートして、最初の一致が行われた行を確認する方法です。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="request-access"></a>6.2.7 アクセス制御、ステージ 2: リクエストの確認</h3></div></div></div><p>
      サーバーは接続を受け入れると、アクセス制御のステージ 2 に入ります。 接続を介して発行するリクエストごとに、実行する操作がサーバーによって決定され、権限が十分かどうかがチェックされます。 ここで、付与テーブルの権限カラムが役立ちます。 これらの権限は、<code class="literal">user</code>, <code class="literal">global_grants</code>, <code class="literal">db</code>, <code class="literal">tables_priv</code>, <code class="literal">columns_priv</code> テーブルまたは <code class="literal">procs_priv</code> テーブルのいずれかから取得できます。 (各付与テーブルに存在するカラムを一覧表示する <a class="xref" href="security.html#grant-tables" title="6.2.3 付与テーブル">セクション6.2.3「付与テーブル」</a> を参照すると役立つ場合があります。) 
    </p><a class="indexterm" name="idm46723763572880"></a><p>
      <code class="literal">user</code> テーブルおよび <code class="literal">global_grants</code> テーブルは、グローバル権限を付与します。 特定のアカウントのこれらのテーブルの行は、デフォルトデータベースが何であるかに関係なく、グローバルに適用されるアカウント権限を示します。 たとえば、<code class="literal">user</code> テーブルで <code class="literal">DELETE</code> 権限が付与されている場合、サーバーホスト上の任意のデータベース内の任意のテーブルから行を削除できます。 <code class="literal">user</code> テーブルの権限は、データベース管理者などの権限を必要とするユーザーに対してのみ付与するのが賢明です。 他のユーザーの場合は、<code class="literal">user</code> テーブルのすべての権限を<code class="literal">'N'</code>に設定したままにし、より具体的なレベルでのみ権限を付与します (特定のデータベース、テーブル、カラムまたはルーチンの場合)。 データベース権限をグローバルに付与することもできますが、部分的な取消しを使用して、特定のデータベースでの実行を制限します (<a class="xref" href="security.html#partial-revokes" title="6.2.12 部分取消しを使用した権限の制限">セクション6.2.12「部分取消しを使用した権限の制限」</a> を参照)。 
    </p><a class="indexterm" name="idm46723763563408"></a><a class="indexterm" name="idm46723763561968"></a><p>
      <code class="literal">db</code> テーブルは、データベース固有の権限を付与します。 このテーブルのスコープカラムの値は、次の形式を取ることができます。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ブランクの <code class="literal">User</code> 値は匿名ユーザーに一致します。 ブランク以外の値は文字どおりに一致し、ユーザー名にワイルドカードはありません。 
        </p></li><li class="listitem"><p>
          ワイルドカード文字 <code class="literal">%</code> および<code class="literal">_</code>は、<code class="literal">Host</code> カラムおよび <code class="literal">Db</code> カラムで使用できます。 これらは <code class="literal">LIKE</code> 演算子で実行されるパターンマッチング演算と同じ意味を持ちます。 権限を付与するときにいずれかの文字を文字どおりに使用する場合、文字をバックスラッシュでエスケープする必要があります。 たとえば、アンダースコア文字 (<code class="literal">_</code>) をデータベース名の一部として含めるには、<code class="literal">GRANT</code> ステートメントで<code class="literal">\_</code>として指定します。 
        </p></li><li class="listitem"><p>
          <code class="literal">'%'</code> またはブランクの <code class="literal">Host</code> 値は、<span class="quote">「<span class="quote">任意のホスト</span>」</span>を意味します。
        </p></li><li class="listitem"><p>
          <code class="literal">'%'</code> またはブランクの <code class="literal">Db</code> 値は、<span class="quote">「<span class="quote">任意のデータベース</span>」</span>を意味します。
        </p></li></ul></div><a class="indexterm" name="idm46723763543152"></a><a class="indexterm" name="idm46723763541008"></a><a class="indexterm" name="idm46723763538976"></a><p>
      サーバーは <code class="literal">user</code> テーブルを読み取るのと同時に、<code class="literal">db</code> テーブルをメモリーに読み取ってソートします。 サーバーは、<code class="literal">Host</code>、<code class="literal">Db</code>、および <code class="literal">User</code> スコープカラムに基づき <code class="literal">db</code> テーブルをソートします。 <code class="literal">user</code> テーブルと同様に、ソートでは最も固有の値が最初に、最も固有の値が最後に配置され、サーバーで一致する行が検索されると、最初に検出された一致が使用されます。 
    </p><a class="indexterm" name="idm46723763530864"></a><a class="indexterm" name="idm46723763528656"></a><a class="indexterm" name="idm46723763526560"></a><p>
      <code class="literal">tables_priv</code>、<code class="literal">columns_priv</code>、および <code class="literal">procs_priv</code> テーブルは、テーブル固有、カラム固有、およびルーチン固有の権限を付与します。 これらのテーブルのスコープカラムの値は、次の形式を取ることができます。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ワイルドカード文字 <code class="literal">%</code> および<code class="literal">_</code>を <code class="literal">Host</code> カラムで使用できます。 これらは <code class="literal">LIKE</code> 演算子で実行されるパターンマッチング演算と同じ意味を持ちます。 
        </p></li><li class="listitem"><p>
          <code class="literal">'%'</code> またはブランクの <code class="literal">Host</code> 値は、<span class="quote">「<span class="quote">任意のホスト</span>」</span>を意味します。
        </p></li><li class="listitem"><p>
          <code class="literal">Db</code>、<code class="literal">Table_name</code>、<code class="literal">Column_name</code>、および <code class="literal">Routine_name</code> カラムは、ワイルドカードを含めたり、ブランクにしたりすることができません。
        </p></li></ul></div><p>
      サーバーは、<code class="literal">Host</code>、<code class="literal">Db</code>、および <code class="literal">User</code> カラムに基づき、<code class="literal">tables_priv</code>、<code class="literal">columns_priv</code>、および <code class="literal">procs_priv</code> テーブルをソートします。 これは <code class="literal">db</code> テーブルのソートと同様ですが、<code class="literal">Host</code> カラムのみワイルドカードを含めることができるため、よりシンプルです。 
    </p><p>
      サーバーはソート済みテーブルを使用して、サーバーが受け取るリクエストを検証します。 <code class="literal">SHUTDOWN</code> や <code class="literal">RELOAD</code> などの管理権限を必要とするリクエストの場合、サーバーは <code class="literal">user</code> テーブルと <code class="literal">global_privilege</code> テーブルのみをチェックします。これらは管理権限を指定する唯一のテーブルであるためです。 サーバーは、それらのテーブル内のアカウントの行がリクエストされた操作を許可し、それ以外の場合はアクセスを拒否する場合にアクセス権を付与します。 たとえば、ユーザーが <span class="command"><strong>mysqladmin shutdown</strong></span> を実行したいが、<code class="literal">user</code> テーブル行によって <code class="literal">SHUTDOWN</code> 権限がユーザーに付与されていない場合、サーバーは <code class="literal">db</code> テーブルさえもチェックせずにアクセスを拒否します。 (後者のテーブルには <code class="literal">Shutdown_priv</code> カラムが含まれていないため、チェックする必要はありません。) 
    </p><p>
      データベース関連のリクエスト (<code class="literal">INSERT</code>、<code class="literal">UPDATE</code> など) の場合、サーバーはまず <code class="literal">user</code> テーブルの行のユーザーグローバル権限をチェックします (部分的な取消しによる権限制限は少なくなります)。 リクエストされた操作が行で許可されている場合、アクセス権限が付与されます。 <code class="literal">user</code> テーブルのグローバル権限が不十分な場合、サーバーは <code class="literal">db</code> テーブルからユーザーデータベース固有の権限を判別します: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーは、<code class="literal">db</code> テーブルを参照し <code class="literal">Host</code>、<code class="literal">Db</code>、および <code class="literal">User</code> カラムの一致がないかチェックします。
        </p></li><li class="listitem"><p>
          <code class="literal">Host</code> および <code class="literal">User</code> カラムは、接続するユーザーのホスト名および MySQL ユーザー名に突き合わせされます。
        </p></li><li class="listitem"><p>
          <code class="literal">Db</code> カラムは、ユーザーがアクセスしようとしているデータベースに突き合わせされます。
        </p></li><li class="listitem"><p>
          <code class="literal">Host</code> および <code class="literal">User</code> に該当する行がない場合、アクセスは拒否されます。
        </p></li></ul></div><p>
      <code class="literal">db</code> テーブルの行によって付与されたデータベース固有の権限を確認すると、サーバーは、<code class="literal">user</code> テーブルによって付与されたグローバル権限にそれらを追加します。 その結果、リクエストされた操作が許可される場合、アクセス権限が付与されます。 そうでない場合、サーバーは続けて <code class="literal">tables_priv</code> および <code class="literal">columns_priv</code> テーブル内でユーザーのテーブル権限およびカラム権限をチェックし、これらをユーザーの権限に追加し、結果に基づいてアクセスを許可または拒否します。 ストアドルーチン操作の場合、サーバーは <code class="literal">tables_priv</code> および <code class="literal">columns_priv</code> の代わりに <code class="literal">procs_priv</code> テーブルを使用します。 
    </p><p>
      ブール条件によって表現すると、ユーザーの権限を計算する方法についての前述の説明は、次のように要約できます。
    </p><pre class="programlisting">global privileges
OR database privileges
OR table privileges
OR column privileges
OR routine privileges
</pre><p>
      グローバル権限が最初にリクエストされた操作に対して不十分であることがわかった場合、サーバーはこれらの権限を後でデータベース、テーブルおよびカラムの権限に追加する理由は明らかではありません。 この理由は、1 つのリクエストが複数のタイプの権限を必要とすることがあるためです。 たとえば、<code class="literal">INSERT INTO ... SELECT</code> ステートメントを実行する場合、<code class="literal">INSERT</code> および <code class="literal">SELECT</code> 権限が両方必要です。 <code class="literal">user</code> テーブルの行が一方の権限をグローバルに付与し、<code class="literal">db</code> テーブルの行が他方の権限を関連データベース専用に付与するような権限の場合があります。 この場合、リクエストを実行するために必要な権限を持っていますが、サーバーはグローバル権限またはデータベース権限のみからそれを通知できません。 結合された権限に基づいてアクセス制御を決定する必要があります。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="creating-accounts"></a>6.2.8 アカウントの追加、権限の割当ておよびアカウントの削除</h3></div></div></div><a class="indexterm" name="idm46723763462272"></a><a class="indexterm" name="idm46723763460784"></a><a class="indexterm" name="idm46723763458864"></a><a class="indexterm" name="idm46723763457344"></a><a class="indexterm" name="idm46723763455424"></a><a class="indexterm" name="idm46723763453920"></a><a class="indexterm" name="idm46723763452000"></a><a class="indexterm" name="idm46723763450480"></a><a class="indexterm" name="idm46723763448560"></a><a class="indexterm" name="idm46723763446416"></a><a class="indexterm" name="idm46723763444352"></a><a class="indexterm" name="idm46723763442320"></a><a class="indexterm" name="idm46723763440256"></a><a class="indexterm" name="idm46723763438208"></a><a class="indexterm" name="idm46723763436144"></a><p>
      MySQL アカウントを管理するには、その目的の SQL ステートメントを使用します:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">CREATE USER</code> および <code class="literal">DROP USER</code> は、アカウントを作成および削除します。
        </p></li><li class="listitem"><p>
          <code class="literal">GRANT</code> および <code class="literal">REVOKE</code> は、アカウントに対する権限の割当ておよび取消しを行います。
        </p></li><li class="listitem"><p>
          <code class="literal">SHOW GRANTS</code> にアカウント権限の割当てが表示されます。
        </p></li></ul></div><p>
      アカウント管理ステートメントを使用すると、サーバーは基礎となる付与テーブルに適切な変更を加えます。これらについては、<a class="xref" href="security.html#grant-tables" title="6.2.3 付与テーブル">セクション6.2.3「付与テーブル」</a> で説明します。
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        <code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> などのステートメントを使用して付与テーブルを直接変更することはお薦めできません。独自のリスクで実行してください。 これらの変更の結果として誤った形式となった行を、サーバーは随意で無視します。 
      </p><p>
        付与テーブルを変更する操作の場合、サーバーはテーブルが予期された構造を持っているかどうかをチェックし、持っていない場合はエラーを生成します。 テーブルを必要な構造に更新するには、MySQL のアップグレード手順を実行します。 <a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a>を参照してください。 
      </p></div><p>
      アカウントを作成するためのもう 1 つのオプションは、GUI ツール MySQL Workbench を使用する方法です。 また、いくつかのサードパーティプログラムには、MySQL アカウント管理用の機能が用意されています。<code class="literal">phpMyAdmin</code> はそのようなプログラムです。 
    </p><p>
      このセクションでは、次のトピックについて説明します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#creating-accounts-granting-privileges" title="アカウントの作成および権限の付与">アカウントの作成および権限の付与</a></p></li><li class="listitem"><p><a class="xref" href="security.html#checking-account-privileges" title="アカウントの権限およびプロパティの確認">アカウントの権限およびプロパティの確認</a></p></li><li class="listitem"><p><a class="xref" href="security.html#revoking-account-privileges" title="アカウント権限の取消し">アカウント権限の取消し</a></p></li><li class="listitem"><p><a class="xref" href="security.html#dropping-accounts" title="アカウントの削除">アカウントの削除</a></p></li></ul></div><p>
      ここで説明するステートメントの詳細は、<a class="xref" href="sql-statements.html#account-management-statements" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a> を参照してください。
    </p><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="creating-accounts-granting-privileges"></a>アカウントの作成および権限の付与</h4></div></div></div><p>
        次の例では、<span class="command"><strong>mysql</strong></span> クライアントプログラムを使用して、新しいアカウントを設定する方法を示します。 これらの例では、MySQL <code class="literal">root</code> アカウントに <code class="literal">CREATE USER</code> 権限と、他のアカウントに付与されているすべての権限があることを前提としています。 
      </p><p>
        コマンドラインで、MySQL <code class="literal">root</code> ユーザーとしてサーバーに接続し、パスワードプロンプトで適切なパスワードを指定します:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u root -p</code></strong>
Enter password: <em class="replaceable"><code>(enter root password here)</code></em>
</pre><p>
        サーバーに接続した後、新しいアカウントを追加できます。 次の例では、<code class="literal">CREATE USER </code>および <code class="literal">GRANT</code> ステートメントを使用して 4 つのアカウントを設定します (<code class="literal">'<em class="replaceable"><code>password</code></em>'</code>が表示されている場合は、適切なパスワードを置き換えます): 
      </p><pre class="programlisting">CREATE USER 'finley'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL
  ON *.*
  TO 'finley'@'localhost'
  WITH GRANT OPTION;

CREATE USER 'finley'@'%.example.com'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL
  ON *.*
  TO 'finley'@'%.example.com'
  WITH GRANT OPTION;

CREATE USER 'admin'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT RELOAD,PROCESS
  ON *.*
  TO 'admin'@'localhost';

CREATE USER 'dummy'@'localhost';
</pre><p>
        これらのステートメントによって作成されるアカウントには、次のプロパティがあります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            2 つのアカウントのユーザー名は <code class="literal">finley</code> です。 どちらも、すべてを実行するための完全なグローバル権限を持つスーパーユーザーアカウントです。 <code class="literal">'finley'@'localhost'</code>アカウントは、ローカルホストから接続する場合にのみ使用できます。 <code class="literal">'finley'@'%.example.com'</code>アカウントは、ホスト部分で<code class="literal">'%'</code>ワイルドカードを使用するため、<code class="literal">example.com</code> ドメイン内の任意のホストからの接続に使用できます。 
          </p><p>
            <code class="literal">'finley'@'localhost'</code>アカウントは、<code class="literal">localhost</code> の匿名ユーザーアカウントがある場合に必要です。 <code class="literal">'finley'@'localhost'</code>アカウントがない場合、その匿名ユーザーアカウントは、<code class="literal">finley</code> がローカルホストから接続し、<code class="literal">finley</code> が匿名ユーザーとして処理されるときに優先されます。 これは、匿名ユーザーアカウントには<code class="literal">'finley'@'%'</code>アカウントよりも具体的な <code class="literal">Host</code> カラム値があるため、<code class="literal">user</code> テーブルのソート順が早いためです。 (<code class="literal">user</code> テーブルのソートの詳細は、<a class="xref" href="security.html#connection-access" title="6.2.6 アクセス制御、ステージ 1: 接続の検証">セクション6.2.6「アクセス制御、ステージ 1: 接続の検証」</a> を参照してください。) 
          </p></li><li class="listitem"><p>
            <code class="literal">'admin'@'localhost'</code>アカウントは、ローカルホストから接続するために <code class="literal">admin</code> でのみ使用できます。 <code class="literal">RELOAD</code> および <code class="literal">PROCESS</code> のグローバル管理権限が付与されます。 これらの権限を持つ <code class="literal">admin</code> ユーザーは、<span class="command"><strong>mysqladmin reload</strong></span>、<span class="command"><strong>mysqladmin refresh</strong></span>、<span class="command"><strong>mysqladmin flush-<em class="replaceable"><code>xxx</code></em></strong></span> コマンド、および <span class="command"><strong>mysqladmin processlist</strong></span> を実行できます。 任意のデータベースにアクセスするための権限は付与されません。 このような権限は、<code class="literal">GRANT</code> ステートメントを使用して追加できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">'dummy'@'localhost'</code>アカウントにパスワードがありません (セキュアでないため、お薦めしません)。 このアカウントは、ローカルホストから接続する際にのみ使用できます。 権限は付与されません。 <code class="literal">GRANT</code> ステートメントを使用してアカウントに特定の権限を付与することを前提としています。 
          </p></li></ul></div><p>
        前の例では、グローバルレベルで権限を付与しています。 次の例では、3 つのアカウントを作成し、下位レベル、つまりデータベース内の特定のデータベースまたはオブジェクトへのアクセス権を付与します。 各アカウントのユーザー名は <code class="literal">custom</code> ですが、ホスト名の部分は異なります: 
      </p><pre class="programlisting">CREATE USER 'custom'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL
  ON bankaccount.*
  TO 'custom'@'localhost';

CREATE USER 'custom'@'host47.example.com'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
  ON expenses.*
  TO 'custom'@'host47.example.com';

CREATE USER 'custom'@'%.example.com'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
  ON customer.addresses
  TO 'custom'@'%.example.com';
</pre><p>
        3 つのアカウントは、次のように使用できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">'custom'@'localhost'</code>アカウントには、<code class="literal">bankaccount</code> データベースにアクセスするためのすべてのデータベースレベルの権限があります。 アカウントを使用してサーバーに接続できるのは、ローカルホストからのみです。 
          </p></li><li class="listitem"><p>
            <code class="literal">'custom'@'host47.example.com'</code>アカウントには、<code class="literal">expenses</code> データベースにアクセスするための特定のデータベースレベル権限があります。 このアカウントは、ホスト <code class="literal">host47.example.com</code> からのみサーバーに接続するために使用できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">'custom'@'%.example.com'</code>アカウントには、<code class="literal">example.com</code> ドメイン内の任意のホストから <code class="literal">customer</code> データベース内の <code class="literal">addresses</code> テーブルにアクセスするための特定のテーブルレベルの権限があります。 アカウント名のホスト部分に <code class="literal">%</code> ワイルドカード文字が使用されているため、アカウントを使用してドメイン内のすべてのマシンからサーバーに接続できます。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="checking-account-privileges"></a>アカウントの権限およびプロパティの確認</h4></div></div></div><a class="indexterm" name="idm46723763350160"></a><a class="indexterm" name="idm46723763348016"></a><p>
        アカウントの権限を表示するには、<code class="literal">SHOW GRANTS</code> を使用します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'admin'@'localhost';</code></strong>
+-----------------------------------------------------+
| Grants for admin@localhost                          |
+-----------------------------------------------------+
| GRANT RELOAD, PROCESS ON *.* TO 'admin'@'localhost' |
+-----------------------------------------------------+
</pre><p>
        アカウントの非特権プロパティーを表示するには、<code class="literal">SHOW CREATE USER</code> を使用します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET print_identified_with_as_hex = ON;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW CREATE USER 'admin'@'localhost'\G</code></strong>
*************************** 1. row ***************************
CREATE USER for admin@localhost: CREATE USER 'admin'@'localhost'
IDENTIFIED WITH 'caching_sha2_password'
AS 0x24412430303524301D0E17054E2241362B1419313C3E44326F294133734B30792F436E77764270373039612E32445250786D43594F45354532324B6169794F47457852796E32
REQUIRE NONE PASSWORD EXPIRE DEFAULT ACCOUNT UNLOCK
PASSWORD HISTORY DEFAULT
PASSWORD REUSE INTERVAL DEFAULT
PASSWORD REQUIRE CURRENT DEFAULT
</pre><p>
        <code class="literal">print_identified_with_as_hex</code> システム変数 (MySQL 8.0.17 で使用可能) を有効にすると、<code class="literal">SHOW CREATE USER</code> では、印刷できない文字を含むハッシュ値が、通常の文字列リテラルとしてではなく 16 進数文字列として表示されます。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="revoking-account-privileges"></a>アカウント権限の取消し</h4></div></div></div><a class="indexterm" name="idm46723763334112"></a><a class="indexterm" name="idm46723763331968"></a><p>
        アカウント権限を取り消すには、<code class="literal">REVOKE</code> ステートメントを使用します。 権限は、異なるレベルで付与できるのと同様に、異なるレベルで取り消すことができます。 
      </p><p>
        グローバル権限を取り消します:
      </p><pre class="programlisting">REVOKE ALL
  ON *.*
  FROM 'finley'@'%.example.com';

REVOKE RELOAD
  ON *.*
  FROM 'admin'@'localhost';
</pre><p>
        データベースレベルの権限を取り消します:
      </p><pre class="programlisting">REVOKE CREATE,DROP
  ON expenses.*
  FROM 'custom'@'host47.example.com';
</pre><p>
        テーブルレベルの権限を取り消します:
      </p><pre class="programlisting">REVOKE INSERT,UPDATE,DELETE
  ON customer.addresses
  FROM 'custom'@'%.example.com';
</pre><p>
        権限取消しの影響を確認するには、<code class="literal">SHOW GRANTS</code> を使用します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'admin'@'localhost';</code></strong>
+---------------------------------------------+
| Grants for admin@localhost                  |
+---------------------------------------------+
| GRANT PROCESS ON *.* TO 'admin'@'localhost' |
+---------------------------------------------+
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="dropping-accounts"></a>アカウントの削除</h4></div></div></div><a class="indexterm" name="idm46723763318880"></a><a class="indexterm" name="idm46723763316880"></a><a class="indexterm" name="idm46723763314848"></a><a class="indexterm" name="idm46723763312704"></a><p>
        アカウントを削除するには、<code class="literal">DROP USER</code> ステートメントを使用します。 たとえば、以前に作成したアカウントの一部を削除するには、次のようにします: 
      </p><pre class="programlisting">DROP USER 'finley'@'localhost';
DROP USER 'finley'@'%.example.com';
DROP USER 'admin'@'localhost';
DROP USER 'dummy'@'localhost';
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="reserved-accounts"></a>6.2.9 予約済アカウント</h3></div></div></div><a class="indexterm" name="idm46723763306544"></a><a class="indexterm" name="idm46723763305072"></a><a class="indexterm" name="idm46723763303120"></a><p>
      MySQL のインストールプロセスの一部として、データディレクトリの初期化があります (<a class="xref" href="installing.html#data-directory-initialization" title="2.10.1 データディレクトリの初期化">セクション2.10.1「データディレクトリの初期化」</a> を参照)。 データディレクトリの初期化中に、MySQL は予約済とみなす必要があるユーザーアカウントを作成します: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">'root'@'localhost</code>: 管理目的で使用されます。 このアカウントにはすべての権限があり、システムアカウントであり、任意の操作を実行できます。 
        </p><p>
          厳密に言うと、このアカウント名は予約されていません。一部のインストールでは、よく知られた名前を持つ特権の高いアカウントが公開されないように、<code class="literal">root</code> アカウントの名前が別の名前に変更されます。
        </p></li><li class="listitem"><p>
          <code class="literal">'mysql.sys'@'localhost'</code>: <code class="literal">sys</code> スキーマオブジェクトの <code class="literal">DEFINER</code> として使用されます。 <code class="literal">mysql.sys</code> アカウントを使用すると、DBA が <code class="literal">root</code> アカウントの名前を変更または削除した場合に発生する問題を回避できます。 このアカウントは、クライアント接続に使用できないようにロックされています。 
        </p></li><li class="listitem"><p>
          <code class="literal">'mysql.session'@'localhost'</code>: サーバーにアクセスするためにプラグインによって内部的に使用されます。 このアカウントは、クライアント接続に使用できないようにロックされています。 アカウントはシステムアカウントです。 
        </p></li><li class="listitem"><p>
          <code class="literal">'mysql.infoschema'@'localhost'</code>: <code class="literal">INFORMATION_SCHEMA</code> ビューの <code class="literal">DEFINER</code> として使用されます。 <code class="literal">mysql.infoschema</code> アカウントを使用すると、DBA が root アカウントの名前を変更または削除した場合に発生する問題を回避できます。 このアカウントは、クライアント接続に使用できないようにロックされています。 
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="roles"></a>6.2.10 ロールの使用</h3></div></div></div><a class="indexterm" name="idm46723763282848"></a><p>
      MySQL ロールは、権限の名前付きコレクションです。 ユーザーアカウントと同様に、ロールには付与された権限と取り消された権限があります。 
    </p><p>
      ユーザーアカウントには、各ロールに関連付けられた権限をアカウントに付与するロールを付与できます。 これにより、アカウントへの一連の権限の割当てが可能になり、必要な権限割当てを概念化して実装するために、個々の権限を付与するかわりに便利です。 
    </p><p>
      次のリストに、MySQL が提供するロール管理機能の概要を示します:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">CREATE ROLE</code> および <code class="literal">DROP ROLE</code> は、ロールを作成および削除します。
        </p></li><li class="listitem"><p>
          <code class="literal">GRANT</code> および <code class="literal">REVOKE</code> は、ユーザーアカウントおよびロールから権限を取り消す権限を割り当てます。
        </p></li><li class="listitem"><p>
          <code class="literal">SHOW GRANTS</code> には、ユーザーアカウントおよびロールの権限およびロールの割当てが表示されます。
        </p></li><li class="listitem"><p>
          <code class="literal">SET DEFAULT ROLE</code> では、デフォルトでアクティブなアカウントロールを指定します。
        </p></li><li class="listitem"><p>
          <code class="literal">SET ROLE</code> は、現在のセッション内のアクティブなロールを変更します。
        </p></li><li class="listitem"><p>
          <code class="literal">CURRENT_ROLE()</code> 関数は、現在のセッション内のアクティブなロールを表示します。
        </p></li><li class="listitem"><p>
          <code class="literal">mandatory_roles</code> および <code class="literal">activate_all_roles_on_login</code> システム変数を使用すると、ユーザーがサーバーにログインするときに、必須ロールを定義し、付与されたロールを自動的にアクティブ化できます。
        </p></li></ul></div><p>
      個々のロール操作ステートメント (それらの使用に必要な権限を含む) の詳細は、<a class="xref" href="sql-statements.html#account-management-statements" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a> を参照してください。 次の説明では、ロールの使用例を示します。 特に指定がないかぎり、ここに示す SQL ステートメントは、<code class="literal">root</code> アカウントなどの十分な管理権限を持つ MySQL アカウントを使用して実行する必要があります。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#roles-creating-granting" title="ロールの作成およびロールへの権限の付与">ロールの作成およびロールへの権限の付与</a></p></li><li class="listitem"><p><a class="xref" href="security.html#mandatory-roles" title="必須ロールの定義">必須ロールの定義</a></p></li><li class="listitem"><p><a class="xref" href="security.html#roles-checking" title="ロール権限の確認">ロール権限の確認</a></p></li><li class="listitem"><p><a class="xref" href="security.html#roles-activating" title="ロールのアクティブ化">ロールのアクティブ化</a></p></li><li class="listitem"><p><a class="xref" href="security.html#roles-revoking" title="ロールまたはロール権限の取消し">ロールまたはロール権限の取消し</a></p></li><li class="listitem"><p><a class="xref" href="security.html#roles-dropping" title="ロールの削除">ロールの削除</a></p></li><li class="listitem"><p><a class="xref" href="security.html#role-user-interchangeability" title="ユーザーとロールの互換性">ユーザーとロールの互換性</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="roles-creating-granting"></a>ロールの作成およびロールへの権限の付与</h4></div></div></div><p>
        次のシナリオを考えてみます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            アプリケーションは、<code class="literal">app_db</code> という名前のデータベースを使用します。
          </p></li><li class="listitem"><p>
            アプリケーションに関連付けられている場合、アプリケーションを作成および保守する開発者、およびアプリケーションと対話するユーザーのアカウントが存在する可能性があります。
          </p></li><li class="listitem"><p>
            開発者には、データベースへの完全なアクセス権が必要です。 一部のユーザーには読取りアクセスのみが必要で、その他のユーザーには読取り/書込みアクセスが必要です。 
          </p></li></ul></div><p>
        多くのユーザーアカウントに権限を個別に付与しないようにするには、必要な権限セットの名前としてロールを作成します。 これにより、適切なロールを付与することで、必要な権限をユーザーアカウントに簡単に付与できます。 
      </p><p>
        ロールを作成するには、<code class="literal">CREATE ROLE</code> ステートメントを使用します:
      </p><pre class="programlisting">CREATE ROLE 'app_developer', 'app_read', 'app_write';
</pre><p>
        ロール名はユーザーアカウント名とよく似ており、<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>形式のユーザー部分とホスト部分で構成されます。 ホスト部分を省略すると、デフォルトで<code class="literal">'%'</code>に設定されます。 ユーザー部分とホスト部分は、<code class="literal">-</code> や <code class="literal">%</code> などの特殊文字が含まれていないかぎり、引用符で囲むことはできません。 アカウント名とは異なり、ロール名のユーザー部分は空白にできません。 追加情報については <a class="xref" href="security.html#role-names" title="6.2.5 ロール名の指定">セクション6.2.5「ロール名の指定」</a>を参照してください。 
      </p><p>
        ロールに権限を割り当てるには、ユーザーアカウントに権限を割り当てる場合と同じ構文を使用して <code class="literal">GRANT</code> ステートメントを実行します:
      </p><pre class="programlisting">GRANT ALL ON app_db.* TO 'app_developer';
GRANT SELECT ON app_db.* TO 'app_read';
GRANT INSERT, UPDATE, DELETE ON app_db.* TO 'app_write';
</pre><p>
        最初に、1 つの開発者アカウント、読取り専用アクセスを必要とする 2 つのユーザーアカウント、および読取り/書込みアクセスを必要とする 1 つのユーザーアカウントが必要であるとします。 <code class="literal">CREATE USER</code> を使用してアカウントを作成します: 
      </p><pre class="programlisting">CREATE USER 'dev1'@'localhost' IDENTIFIED BY 'dev1pass';
CREATE USER 'read_user1'@'localhost' IDENTIFIED BY 'read_user1pass';
CREATE USER 'read_user2'@'localhost' IDENTIFIED BY 'read_user2pass';
CREATE USER 'rw_user1'@'localhost' IDENTIFIED BY 'rw_user1pass';
</pre><p>
        各ユーザーアカウントに必要な権限を割り当てるには、前述と同じ形式の <code class="literal">GRANT</code> ステートメントを使用できますが、ユーザーごとに個別の権限を列挙する必要があります。 かわりに、権限ではなくロールの付与を許可する代替の <code class="literal">GRANT</code> 構文を使用します: 
      </p><pre class="programlisting">GRANT 'app_developer' TO 'dev1'@'localhost';
GRANT 'app_read' TO 'read_user1'@'localhost', 'read_user2'@'localhost';
GRANT 'app_read', 'app_write' TO 'rw_user1'@'localhost';
</pre><p>
        <code class="literal">rw_user1</code> アカウントの <code class="literal">GRANT</code> ステートメントは、読取りおよび書込みロールを付与します。このロールを組み合せて、必要な読取りおよび書込み権限を提供します。
      </p><p>
        アカウントにロールを付与するための <code class="literal">GRANT</code> 構文は、権限を付与するための構文とは異なります: 権限を割り当てる <code class="literal">ON</code> 句はありますが、ロールを割り当てる <code class="literal">ON</code> 句はありません。 構文は異なるため、同じステートメントで権限とロールの割当てを混在させることはできません。 (権限とロールの両方をアカウントに割り当てることはできますが、付与する内容に適した構文を持つ個別の <code class="literal">GRANT</code> ステートメントを使用する必要があります。) MySQL 8.0.16 では、匿名ユーザーにロールを付与できません。 
      </p><p>
        作成されたロールはロックされ、パスワードがなく、デフォルトの認証プラグインが割り当てられます。 (これらのロール属性は、後で <code class="literal">ALTER USER</code> ステートメントを使用して、グローバル <code class="literal">CREATE USER</code> 権限を持つユーザーが変更できます。) 
      </p><p>
        ロック中は、ロールを使用してサーバーに対する認証を行うことはできません。 ロックが解除されている場合は、ロールを使用して認証できます。 これは、ロールとユーザーの両方が認可識別子であり、それらを区別することはほとんどなく共通であるためです。 <a class="xref" href="security.html#role-user-interchangeability" title="ユーザーとロールの互換性">ユーザーとロールの互換性</a>も参照してください。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="mandatory-roles"></a>必須ロールの定義</h4></div></div></div><p>
        <code class="literal">mandatory_roles</code> システム変数の値でロールに名前を付けることで、ロールを必須として指定できます。 サーバーは必須ロールをすべてのユーザーに付与されたものとして処理するため、アカウントに明示的に付与する必要はありません。 
      </p><p>
        サーバーの起動時に必須ロールを指定するには、サーバーの <code class="filename">my.cnf</code> ファイルで <code class="literal">mandatory_roles</code> を定義します:
      </p><pre class="programlisting">[mysqld]
mandatory_roles='role1,role2@localhost,r3@%.example.com'
</pre><p>
        実行時に <code class="literal">mandatory_roles</code> を設定および永続化するには、次のようなステートメントを使用します:
      </p><pre class="programlisting">SET PERSIST mandatory_roles = 'role1,role2@localhost,r3@%.example.com';
</pre><p>
        <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、値が保存され、その後のサーバーの再起動に引き継がれます。 後続の再起動に引き継ぐことなく、実行中の MySQL インスタンスの値を変更するには、<code class="literal">PERSIST</code> ではなく <code class="literal">GLOBAL</code> キーワードを使用します。 <a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a>を参照してください。 
      </p><p>
        <code class="literal">mandatory_roles</code> を設定するには、グローバルシステム変数を設定するために通常必要な <code class="literal">SYSTEM_VARIABLES_ADMIN</code> 権限 (または非推奨の <code class="literal">SUPER</code> 権限) に加えて、<code class="literal">ROLE_ADMIN</code> 権限が必要です。
      </p><p>
        明示的に付与されたロールと同様に、必須ロールはアクティブ化されるまで有効になりません (<a class="xref" href="security.html#roles-activating" title="ロールのアクティブ化">ロールのアクティブ化</a> を参照)。 ログイン時に、<code class="literal">activate_all_roles_on_login</code> システム変数が有効になっている場合は付与されているすべてのロールに対して、それ以外の場合はデフォルトロールとして設定されているロールに対してロールのアクティブ化が行われます。 実行時に、<code class="literal">SET ROLE</code> によってロールがアクティブ化されます。 
      </p><p>
        <code class="literal">mandatory_roles</code> の値で指定されたロールは、<code class="literal">REVOKE</code> で取り消すことも、<code class="literal">DROP ROLE</code> または <code class="literal">DROP USER</code> で削除することもできません。
      </p><p>
        セッションがデフォルトでシステムセッションにならないようにするには、<code class="literal">SYSTEM_USER</code> 権限を持つロールを <code class="literal">mandatory_roles</code> システム変数の値にリストできません:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">SYSTEM_USER</code> 権限を持つロールが起動時に <code class="literal">mandatory_roles</code> に割り当てられた場合、サーバーはエラーログにメッセージを書き込み、終了します。
          </p></li><li class="listitem"><p>
            <code class="literal">SYSTEM_USER</code> 権限を持つロールが実行時に <code class="literal">mandatory_roles</code> に割り当てられた場合、エラーが発生し、<code class="literal">mandatory_roles</code> 値は変更されません。
          </p></li></ul></div><p>
        <code class="literal">mandatory_roles</code> で指定されたロールが <code class="literal">mysql.user</code> システムテーブルに存在しない場合、そのロールはユーザーに付与されません。 サーバーは、ユーザーに対してロールのアクティブ化を試行しても、存在しないロールを必須として処理せず、エラーログに警告を書き込みます。 ロールが後で作成されて有効になった場合は、<code class="literal">FLUSH PRIVILEGES</code> でサーバーに必須として処理させる必要がある場合があります。 
      </p><p>
        <code class="literal">SHOW GRANTS</code> では、<a class="xref" href="sql-statements.html#show-grants" title="13.7.7.21 SHOW GRANTS ステートメント">セクション13.7.7.21「SHOW GRANTS ステートメント」</a> で説明されているルールに従って必須ロールが表示されます。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="roles-checking"></a>ロール権限の確認</h4></div></div></div><p>
        アカウントに割り当てられた権限を確認するには、<code class="literal">SHOW GRANTS</code> を使用します。 例: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'dev1'@'localhost';</code></strong>
+-------------------------------------------------+
| Grants for dev1@localhost                       |
+-------------------------------------------------+
| GRANT USAGE ON *.* TO `dev1`@`localhost`        |
| GRANT `app_developer`@`%` TO `dev1`@`localhost` |
+-------------------------------------------------+
</pre><p>
        ただし、<span class="quote">「<span class="quote">「展開」</span>」</span>なしで付与された各ロールは、そのロールが表す権限に表示されます。 ロール権限も表示するには、権限を表示する付与されたロールを指定する <code class="literal">USING</code> 句を追加します: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'dev1'@'localhost' USING 'app_developer';</code></strong>
+----------------------------------------------------------+
| Grants for dev1@localhost                                |
+----------------------------------------------------------+
| GRANT USAGE ON *.* TO `dev1`@`localhost`                 |
| GRANT ALL PRIVILEGES ON `app_db`.* TO `dev1`@`localhost` |
| GRANT `app_developer`@`%` TO `dev1`@`localhost`          |
+----------------------------------------------------------+
</pre><p>
        他のタイプのユーザーを同様に検証します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'read_user1'@'localhost' USING 'app_read';</code></strong>
+--------------------------------------------------------+
| Grants for read_user1@localhost                        |
+--------------------------------------------------------+
| GRANT USAGE ON *.* TO `read_user1`@`localhost`         |
| GRANT SELECT ON `app_db`.* TO `read_user1`@`localhost` |
| GRANT `app_read`@`%` TO `read_user1`@`localhost`       |
+--------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'rw_user1'@'localhost' USING 'app_read', 'app_write';</code></strong>
+------------------------------------------------------------------------------+
| Grants for rw_user1@localhost                                                |
+------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `rw_user1`@`localhost`                                 |
| GRANT SELECT, INSERT, UPDATE, DELETE ON `app_db`.* TO `rw_user1`@`localhost` |
| GRANT `app_read`@`%`,`app_write`@`%` TO `rw_user1`@`localhost`               |
+------------------------------------------------------------------------------+
</pre><p>
        <code class="literal">SHOW GRANTS</code> では、<a class="xref" href="sql-statements.html#show-grants" title="13.7.7.21 SHOW GRANTS ステートメント">セクション13.7.7.21「SHOW GRANTS ステートメント」</a> で説明されているルールに従って必須ロールが表示されます。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="roles-activating"></a>ロールのアクティブ化</h4></div></div></div><p>
        ユーザーアカウントに付与されるロールは、アカウントセッション内でアクティブまたは非アクティブにできます。 付与されたロールがセッション内でアクティブな場合は、その権限が適用されます。それ以外の場合は適用されません。 現在のセッション内でアクティブなロールを判別するには、<code class="literal">CURRENT_ROLE()</code> 関数を使用します。 
      </p><p>
        デフォルトでは、アカウントにロールを付与したり、<code class="literal">mandatory_roles</code> システム変数値に名前を付けたりしても、アカウントセッション内でロールが自動的にアクティブになることはありません。 たとえば、前述の説明では <code class="literal">rw_user1</code> ロールがアクティブ化されていないため、<code class="literal">rw_user1</code> としてサーバーに接続し、<code class="literal">CURRENT_ROLE()</code> 関数を起動すると、結果は <code class="literal">NONE</code> (アクティブなロールなし) になります: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| NONE           |
+----------------+
</pre><p>
        ユーザーがサーバーに接続して認証するたびにアクティブにするロールを指定するには、<code class="literal">SET DEFAULT ROLE</code> を使用します。 以前に作成した各アカウントに割り当てられたすべてのロールにデフォルトを設定するには、次のステートメントを使用します: 
      </p><pre class="programlisting">SET DEFAULT ROLE ALL TO
  'dev1'@'localhost',
  'read_user1'@'localhost',
  'read_user2'@'localhost',
  'rw_user1'@'localhost';
</pre><p>
        <code class="literal">rw_user1</code> として接続すると、<code class="literal">CURRENT_ROLE()</code> の初期値に新しいデフォルトのロール割当てが反映されます:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT CURRENT_ROLE();</code></strong>
+--------------------------------+
| CURRENT_ROLE()                 |
+--------------------------------+
| `app_read`@`%`,`app_write`@`%` |
+--------------------------------+
</pre><p>
        ユーザーがサーバーに接続したときに、明示的に付与されたロールと必須ロールがすべて自動的にアクティブ化されるようにするには、<code class="literal">activate_all_roles_on_login</code> システム変数を有効にします。 デフォルトでは、自動ロールアクティブ化は無効になっています。 
      </p><p>
        セッション内で、ユーザーは <code class="literal">SET ROLE</code> を実行してアクティブなロールのセットを変更できます。 たとえば、<code class="literal">rw_user1</code> の場合は次のようになります: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET ROLE NONE; SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| NONE           |
+----------------+
mysql&gt; <strong class="userinput"><code>SET ROLE ALL EXCEPT 'app_write'; SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| `app_read`@`%` |
+----------------+
mysql&gt; <strong class="userinput"><code>SET ROLE DEFAULT; SELECT CURRENT_ROLE();</code></strong>
+--------------------------------+
| CURRENT_ROLE()                 |
+--------------------------------+
| `app_read`@`%`,`app_write`@`%` |
+--------------------------------+
</pre><p>
        最初の <code class="literal">SET ROLE</code> ステートメントは、すべてのロールを非アクティブ化します。 次に、<code class="literal">rw_user1</code> を事実上読取り専用にします。 3 つ目はデフォルトのロールをリストアします。 
      </p><a class="indexterm" name="idm46723763127728"></a><a class="indexterm" name="idm46723763125552"></a><a class="indexterm" name="idm46723763123600"></a><a class="indexterm" name="idm46723763121456"></a><p>
        ストアドプログラムおよびビューオブジェクトの有効なユーザーは、<code class="literal">DEFINER</code> および <code class="literal">SQL SECURITY</code> 属性の影響を受けます。これらの属性は、実行者コンテキストまたは定義者コンテキストのどちらで実行されるかを決定します (<a class="xref" href="stored-objects.html#stored-objects-security" title="25.6 ストアドオブジェクトのアクセス制御">セクション25.6「ストアドオブジェクトのアクセス制御」</a> を参照):
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            起動側コンテキストで実行されるストアドプログラムおよびビューオブジェクトは、現在のセッション内でアクティブなロールで実行されます。
          </p></li><li class="listitem"><p>
            定義者コンテキストで実行されるストアドプログラムおよびビューオブジェクトは、<code class="literal">DEFINER</code> 属性で指定されたユーザーのデフォルトロールで実行されます。 <code class="literal">activate_all_roles_on_login</code> が有効な場合、このようなオブジェクトは、<code class="literal">DEFINER</code> ユーザーに付与されたすべてのロール (必須ロールを含む) で実行されます。 ストアドプログラムでは、デフォルトとは異なるロールで実行する必要がある場合、プログラム本体は <code class="literal">SET ROLE</code> を実行して必要なロールをアクティブ化する必要があります。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="roles-revoking"></a>ロールまたはロール権限の取消し</h4></div></div></div><p>
        ロールは、アカウントに付与できるのと同様に、アカウントから取り消すことができます:
      </p><pre class="programlisting">REVOKE <em class="replaceable"><code>role</code></em> FROM <em class="replaceable"><code>user</code></em>;
</pre><p>
        <code class="literal">mandatory_roles</code> システム変数値で指定されたロールは取り消すことができません。
      </p><p>
        <code class="literal">REVOKE</code> をロールに適用して、付与された権限を変更することもできます。 これは、ロール自体だけでなく、そのロールを付与されたアカウントにも影響します。 すべてのアプリケーションユーザーを一時的に読取り専用にするとします。 これを行うには、<code class="literal">REVOKE</code> を使用して、<code class="literal">app_write</code> ロールから変更権限を取り消します: 
      </p><pre class="programlisting">REVOKE INSERT, UPDATE, DELETE ON app_db.* FROM 'app_write';
</pre><p>
        これが発生すると、<code class="literal">SHOW GRANTS</code> を使用して表示できるように、権限のないロールのままになります (これは、このステートメントをユーザーだけでなくロールで使用できることを示しています):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'app_write';</code></strong>
+---------------------------------------+
| Grants for app_write@%                |
+---------------------------------------+
| GRANT USAGE ON *.* TO `app_write`@`%` |
+---------------------------------------+
</pre><p>
        ロールから権限を取り消すと、変更されたロールが割り当てられているユーザーの権限に影響するため、<code class="literal">rw_user1</code> にはテーブルの変更権限がなくなりました (<code class="literal">INSERT</code>、<code class="literal">UPDATE</code> および <code class="literal">DELETE</code> は存在しません):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'rw_user1'@'localhost'</code></strong>
       <strong class="userinput"><code>USING 'app_read', 'app_write';</code></strong>
+----------------------------------------------------------------+
| Grants for rw_user1@localhost                                  |
+----------------------------------------------------------------+
| GRANT USAGE ON *.* TO `rw_user1`@`localhost`                   |
| GRANT SELECT ON `app_db`.* TO `rw_user1`@`localhost`           |
| GRANT `app_read`@`%`,`app_write`@`%` TO `rw_user1`@`localhost` |
+----------------------------------------------------------------+
</pre><p>
        実際には、<code class="literal">rw_user1</code> の読取り/書込みユーザーが読取り専用ユーザーになりました。 これは、<code class="literal">app_write</code> ロールが付与されている他のアカウントに対しても発生し、ロールの使用によって個々のアカウントの権限を変更する必要がなくなる方法を示します。 
      </p><p>
        変更権限をロールにリストアするには、変更権限を再度付与します:
      </p><pre class="programlisting">GRANT INSERT, UPDATE, DELETE ON app_db.* TO 'app_write';
</pre><p>
        <code class="literal">app_write</code> ロールを付与された他のアカウントと同様に、<code class="literal">rw_user1</code> にも変更権限があります。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="roles-dropping"></a>ロールの削除</h4></div></div></div><p>
        ロールを削除するには、<code class="literal">DROP ROLE</code> を使用します:
      </p><pre class="programlisting">DROP ROLE 'app_read', 'app_write';
</pre><p>
        ロールを削除すると、そのロールが付与されたすべてのアカウントからロールが取り消されます。
      </p><p>
        <code class="literal">mandatory_roles</code> システム変数値で指定されたロールは削除できません。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="role-user-interchangeability"></a>ユーザーとロールの互換性</h4></div></div></div><p>
        以前に <code class="literal">SHOW GRANTS</code> についてヒントされていたように、ユーザーアカウントまたはロールに対する権限が表示されるため、アカウントおよびロールは同じ意味で使用できます。
      </p><p>
        ロールとユーザーの違いの 1 つは、<code class="literal">CREATE ROLE</code> ではデフォルトでロックされる認可識別子が作成されるのに対し、<code class="literal">CREATE USER</code> ではデフォルトでロック解除される認可識別子が作成されることです。 ただし、適切な権限を持つユーザーは、作成後にロールまたはユーザーをロックまたはロック解除できるため、区別は不変ではありません。 
      </p><p>
        データベース管理者が、特定の認可識別子をロールにする必要があるというプリファレンスを持っている場合は、名前スキームを使用してこの意図を伝達できます。 たとえば、ロールにするすべての認可識別子に <code class="literal">r_</code>接頭辞を使用でき、それ以外には使用できません。 
      </p><p>
        ロールとユーザーの別の違いは、それらの管理に使用できる権限にあります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">CREATE ROLE</code> および <code class="literal">DROP ROLE</code> 権限では、それぞれ <code class="literal">CREATE ROLE</code> および <code class="literal">DROP ROLE</code> ステートメントのみを使用できます。
          </p></li><li class="listitem"><p>
            <code class="literal">CREATE USER</code> 権限を使用すると、<code class="literal">ALTER USER</code>, <code class="literal">CREATE ROLE</code>, <code class="literal">CREATE USER</code>, <code class="literal">DROP ROLE</code>, <code class="literal">DROP USER</code>, <code class="literal">RENAME USER</code> ステートメントおよび <code class="literal">REVOKE ALL PRIVILEGES</code> ステートメントを使用できます。
          </p></li></ul></div><p>
        したがって、<code class="literal">CREATE ROLE</code> および <code class="literal">DROP ROLE</code> 権限は <code class="literal">CREATE USER</code> ほど強力ではなく、ロールの作成および削除のみを許可し、より一般的なアカウント操作を実行しないユーザーに付与できます。
      </p><p>
        ユーザーおよびロールの権限および互換性に関して、ユーザーアカウントをロールのように扱い、そのアカウントを別のユーザーまたはロールに付与できます。 その結果、他のユーザーまたはロールにアカウント権限およびロールが付与されます。 
      </p><p>
        次の一連のステートメントは、ユーザーにユーザー、ユーザーにロール、ロールにユーザーまたはロールを付与できることを示しています:
      </p><pre class="programlisting">CREATE USER 'u1';
CREATE ROLE 'r1';
GRANT SELECT ON db1.* TO 'u1';
GRANT SELECT ON db2.* TO 'r1';
CREATE USER 'u2';
CREATE ROLE 'r2';
GRANT 'u1', 'r1' TO 'u2';
GRANT 'u1', 'r1' TO 'r2';
</pre><p>
        いずれの場合も、付与されたオブジェクトに関連付けられた権限が権限受領者オブジェクトに付与されます。 これらのステートメントを実行すると、ユーザー (<code class="literal">u1</code>) およびロール (<code class="literal">r1</code>) から各 <code class="literal">u2</code> および <code class="literal">r2</code> に権限が付与されます: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'u2' USING 'u1', 'r1';</code></strong>
+-------------------------------------+
| Grants for u2@%                     |
+-------------------------------------+
| GRANT USAGE ON *.* TO `u2`@`%`      |
| GRANT SELECT ON `db1`.* TO `u2`@`%` |
| GRANT SELECT ON `db2`.* TO `u2`@`%` |
| GRANT `u1`@`%`,`r1`@`%` TO `u2`@`%` |
+-------------------------------------+
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'r2' USING 'u1', 'r1';</code></strong>
+-------------------------------------+
| Grants for r2@%                     |
+-------------------------------------+
| GRANT USAGE ON *.* TO `r2`@`%`      |
| GRANT SELECT ON `db1`.* TO `r2`@`%` |
| GRANT SELECT ON `db2`.* TO `r2`@`%` |
| GRANT `u1`@`%`,`r1`@`%` TO `r2`@`%` |
+-------------------------------------+
</pre><p>
        前述の例は単なる説明ですが、ユーザーアカウントとロールの互換性には、次のような実用的なアプリケーションがあります: レガシーアプリケーション開発プロジェクトが MySQL でロールが追加される前に開始されたため、プロジェクトに関連付けられているすべてのユーザーアカウントに権限が直接付与されているとします (ロールの付与によって権限が付与されるのではなく)。 これらのアカウントの 1 つは、次のように最初に権限を付与された開発者アカウントです: 
      </p><pre class="programlisting">CREATE USER 'old_app_dev'@'localhost' IDENTIFIED BY 'old_app_devpass';
GRANT ALL ON old_app.* TO 'old_app_dev'@'localhost';
</pre><p>
        この開発者がプロジェクトを終了した場合は、権限を別のユーザーに割り当てるか、開発アクティビティが展開されている場合は複数のユーザーに割り当てる必要があります。 次に、この問題を処理する方法をいくつか示します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            ロールを使用しない: 元の開発者が使用できないようにアカウントパスワードを変更し、かわりに新しい開発者がそのアカウントを使用するようにします:
          </p><pre class="programlisting">ALTER USER 'old_app_dev'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>new_password</code></em>';
</pre></li><li class="listitem"><p>
            ロールの使用: アカウントをロックして、誰もがそのアカウントを使用してサーバーに接続できないようにします:
          </p><pre class="programlisting">ALTER USER 'old_app_dev'@'localhost' ACCOUNT LOCK;
</pre><p>
            次に、アカウントをロールとして扱います。 プロジェクトの新規開発者ごとに、新規アカウントを作成し、元の開発者アカウントを付与します: 
          </p><pre class="programlisting">CREATE USER 'new_app_dev1'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>new_password</code></em>';
GRANT 'old_app_dev'@'localhost' TO 'new_app_dev1'@'localhost';
</pre><p>
            その結果、元の開発者アカウント権限が新しいアカウントに割り当てられます。
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="account-categories"></a>6.2.11 アカウントカテゴリ</h3></div></div></div><a class="indexterm" name="idm46723763026400"></a><a class="indexterm" name="idm46723763024224"></a><a class="indexterm" name="idm46723763022128"></a><a class="indexterm" name="idm46723763020752"></a><a class="indexterm" name="idm46723763019088"></a><p>
      MySQL 8.0.16 では、MySQL に、<code class="literal">SYSTEM_USER</code> 権限に基づいてユーザーアカウントカテゴリの概念が組み込まれています。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#system-user-accounts" title="システムアカウントと通常アカウント">システムアカウントと通常アカウント</a></p></li><li class="listitem"><p><a class="xref" href="security.html#system-user-operations" title="SYSTEM_USER 権限の影響を受ける操作">SYSTEM_USER 権限の影響を受ける操作</a></p></li><li class="listitem"><p><a class="xref" href="security.html#system-user-sessions" title="システムおよび通常のセッション">システムおよび通常のセッション</a></p></li><li class="listitem"><p><a class="xref" href="security.html#protecting-system-accounts" title="通常アカウントによる操作からのシステムアカウントの保護">通常アカウントによる操作からのシステムアカウントの保護</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="system-user-accounts"></a>システムアカウントと通常アカウント</h4></div></div></div><p>
        MySQL には、ユーザーアカウントカテゴリの概念が組み込まれており、システムユーザーと通常のユーザーは <code class="literal">SYSTEM_USER</code> 権限を持っているかどうかによって区別されます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">SYSTEM_USER</code> 権限を持つユーザーはシステムユーザーです。
          </p></li><li class="listitem"><p>
            <code class="literal">SYSTEM_USER</code> 権限を持たないユーザーは通常のユーザーです。
          </p></li></ul></div><p>
        <code class="literal">SYSTEM_USER</code> 権限は、特定のユーザーが他の権限を適用できるアカウント、およびそのユーザーが他のアカウントから保護されているかどうかに影響します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            システムユーザーは、システムアカウントと通常アカウントの両方を変更できます。 つまり、通常のアカウントに対して特定の操作を実行する適切な権限を持つユーザーは、システムアカウントに対しても操作を実行するように <code class="literal">SYSTEM_USER</code> を所有することで有効になります。 システムアカウントは、通常のユーザーではなく、適切な権限を持つシステムユーザーのみが変更できます。 
          </p></li><li class="listitem"><p>
            適切な権限を持つ通常のユーザーは通常のアカウントを変更できますが、システムアカウントは変更できません。 通常のアカウントは、適切な権限を持つシステムユーザーと通常のユーザーの両方が変更できます。 
          </p></li></ul></div><p>
        ユーザーが通常のアカウントに対して特定の操作を実行するための適切な権限を持っている場合、<code class="literal">SYSTEM_USER</code> を使用すると、ユーザーはシステムアカウントに対しても操作を実行できます。 <code class="literal">SYSTEM_USER</code> は他の権限を意味しないため、特定のアカウント操作を実行する機能は、他の必要な権限を所有するための述語のままです。 たとえば、ユーザーが <code class="literal">SELECT</code> および <code class="literal">UPDATE</code> 権限を通常のアカウントに付与できる場合、<code class="literal">SYSTEM_USER</code> では、ユーザーは <code class="literal">SELECT</code> および <code class="literal">UPDATE</code> をシステムアカウントに付与することもできます。 
      </p><p>
        システムアカウントと通常のアカウントの区別により、<code class="literal">SYSTEM_USER</code> 権限を持つアカウントを権限を持たないアカウントから保護することで、特定のアカウント管理の問題をより適切に制御できます。 たとえば、<code class="literal">CREATE USER</code> 権限では、新しいアカウントの作成のみでなく、既存のアカウントの変更および削除も可能です。 システムユーザーの概念がない場合、<code class="literal">CREATE USER</code> 権限を持つユーザーは、<code class="literal">root</code> アカウントを含む既存のアカウントを変更または削除できます。 システムユーザーの概念により、システムユーザーのみが行うことができるように、<code class="literal">root</code> アカウント (それ自体はシステムアカウント) への変更を制限できます。 <code class="literal">CREATE USER</code> 権限を持つ通常のユーザーは、既存のアカウントを変更または削除できますが、通常のアカウントのみです。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="system-user-operations"></a>SYSTEM_USER 権限の影響を受ける操作</h4></div></div></div><p>
        <code class="literal">SYSTEM_USER</code> 権限は、次の操作に影響します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            アカウント操作。
          </p><p>
            アカウント操作には、アカウントの作成と削除、権限の付与と取消し、資格証明や認証プラグインなどのアカウント認証特性の変更、およびパスワード有効期限ポリシーなどの他のアカウント特性の変更が含まれます。
          </p><p>
            <code class="literal">CREATE USER</code> や <code class="literal">GRANT</code> などのアカウント管理ステートメントを使用してシステムアカウントを操作するには、<code class="literal">SYSTEM_USER</code> 権限が必要です。 この方法でアカウントがシステムアカウントを変更できないようにするには、<code class="literal">SYSTEM_USER</code> 権限を付与しないで、通常のアカウントにします。 (ただし、システムアカウントを通常のアカウントから完全に保護するには、<code class="literal">mysql</code> システムスキーマの変更権限を通常のアカウントから源泉徴収する必要もあります。 <a class="xref" href="security.html#protecting-system-accounts" title="通常アカウントによる操作からのシステムアカウントの保護">通常アカウントによる操作からのシステムアカウントの保護</a>を参照してください。) 
          </p></li><li class="listitem"><p>
            現在のセッションおよびその中で実行されているステートメントを強制終了します。
          </p><p>
            <code class="literal">SYSTEM_USER</code> 権限で実行されているセッションまたはステートメントを強制終了するには、他の必要な権限 (<code class="literal">CONNECTION_ADMIN</code> または非推奨の <code class="literal">SUPER</code> 権限) に加えて、自分のセッションに <code class="literal">SYSTEM_USER</code> 権限が必要です。
          </p><p>
            MySQL 8.0.16 より前は、セッションまたはステートメントを強制終了するには <code class="literal">CONNECTION_ADMIN</code> 権限 (または非推奨の <code class="literal">SUPER</code> 権限) で十分です。
          </p></li><li class="listitem"><p>
            ストアドオブジェクトの <code class="literal">DEFINER</code> 属性を設定します。
          </p><p>
            ストアドオブジェクトの <code class="literal">DEFINER</code> 属性を <code class="literal">SYSTEM_USER</code> 権限を持つアカウントに設定するには、他の必要な権限 (<code class="literal">SET_USER_ID</code> または非推奨の <code class="literal">SUPER</code> 権限) に加えて、<code class="literal">SYSTEM_USER</code> 権限が必要です。
          </p><p>
            MySQL 8.0.16 より前は、<code class="literal">SET_USER_ID</code> 権限 (または非推奨の <code class="literal">SUPER</code> 権限) を使用して、ストアドオブジェクトの <code class="literal">DEFINER</code> 値を指定するだけで十分です。
          </p></li><li class="listitem"><p>
            必須ロールの指定。
          </p><p>
            <code class="literal">SYSTEM_USER</code> 権限を持つロールは、<code class="literal">mandatory_roles</code> システム変数の値にリストできません。
          </p><p>
            MySQL 8.0.16 より前は、<code class="literal">mandatory_roles</code> に任意のロールをリストできます。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="system-user-sessions"></a>システムおよび通常のセッション</h4></div></div></div><a class="indexterm" name="idm46723762944736"></a><a class="indexterm" name="idm46723762942608"></a><a class="indexterm" name="idm46723762940512"></a><p>
        サーバー内で実行されているセッションは、システムユーザーと通常のユーザーの区別と同様に、システムセッションまたは通常のセッションと区別されます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">SYSTEM_USER</code> 権限を持つセッションはシステムセッションです。
          </p></li><li class="listitem"><p>
            <code class="literal">SYSTEM_USER</code> 権限を持たないセッションは通常のセッションです。
          </p></li></ul></div><p>
        通常のセッションは、通常のユーザーに許可されている操作のみを実行できます。 システムセッションは、システムユーザーにのみ許可される操作を追加で実行できます。 
      </p><p>
        セッションによって所有される権限は、基礎となるアカウントに直接付与される権限と、セッション内で現在アクティブなすべてのロールに付与される権限です。 したがって、そのアカウントに <code class="literal">SYSTEM_USER</code> 権限が直接付与されているか、セッションで <code class="literal">SYSTEM_USER</code> 権限を持つロールがアクティブ化されているため、セッションはシステムセッションである可能性があります。 セッション内でアクティブでないアカウントに付与されたロールは、セッション権限には影響しません。 
      </p><p>
        ロールをアクティブ化および非アクティブ化すると、セッションが所有する権限が変更される可能性があるため、セッションは通常のセッションからシステムセッションに、またはその逆に変更される可能性があります。 セッションが <code class="literal">SYSTEM_USER</code> 権限を持つロールをアクティブ化または非アクティブ化すると、通常のセッションとシステムセッションの間の適切な変更は、そのセッションに対してのみ即時に行われます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            通常のセッションが <code class="literal">SYSTEM_USER</code> 権限を持つロールをアクティブ化すると、そのセッションはシステムセッションになります。
          </p></li><li class="listitem"><p>
            システムセッションが <code class="literal">SYSTEM_USER</code> 権限を持つロールを非アクティブ化した場合、<code class="literal">SYSTEM_USER</code> 権限を持つ他のロールがアクティブなままでないかぎり、そのセッションは通常のセッションになります。
          </p></li></ul></div><p>
        これらの操作は、既存のセッションには影響しません:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">SYSTEM_USER</code> 権限がアカウントに対して付与または取り消された場合、そのアカウントの既存のセッションは通常のセッションとシステムセッションの間で変更されません。 付与または取消し操作は、アカウントによる後続の接続のセッションにのみ影響します。 
          </p></li><li class="listitem"><p>
            セッション内で呼び出されたストアドオブジェクトによって実行されるステートメントは、オブジェクトの <code class="literal">DEFINER</code> 属性がシステムアカウントを指定している場合でも、親セッションのシステムステータスまたは通常のステータスで実行されます。
          </p></li></ul></div><p>
        ロールのアクティブ化はセッションにのみ影響し、アカウントには影響しないため、<code class="literal">SYSTEM_USER</code> 権限を持つロールを通常のアカウントに付与しても、そのアカウントは通常のユーザーから保護されません。 このロールは、ロールがアクティブ化されているアカウントのセッションのみを保護し、通常のセッションによる強制終了からのみセッションを保護します。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="protecting-system-accounts"></a>通常アカウントによる操作からのシステムアカウントの保護</h4></div></div></div><p>
        アカウント操作には、アカウントの作成と削除、権限の付与と取消し、資格証明や認証プラグインなどのアカウント認証特性の変更、およびパスワード有効期限ポリシーなどの他のアカウント特性の変更が含まれます。
      </p><p>
        アカウント操作は、次の 2 つの方法で実行できます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">CREATE USER</code> や <code class="literal">GRANT</code> などのアカウント管理ステートメントを使用します。 これが推奨される方法です。 
          </p></li><li class="listitem"><p>
            <code class="literal">INSERT</code> や <code class="literal">UPDATE</code> などのステートメントを使用して権限テーブルを直接変更します。 この方法はお薦めしませんが、付与テーブルを含む <code class="literal">mysql</code> システムスキーマに対する適切な権限を持つユーザーにはお薦めします。 
          </p></li></ul></div><p>
        特定のアカウントによる変更からシステムアカウントを完全に保護するには、通常のアカウントにし、<code class="literal">mysql</code> スキーマに対する変更権限を付与しないでください:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            account-management ステートメントを使用してシステムアカウントを操作するには、<code class="literal">SYSTEM_USER</code> 権限が必要です。 この方法でアカウントがシステムアカウントを変更できないようにするには、<code class="literal">SYSTEM_USER</code> を付与しないで、通常のアカウントにします。 これには、アカウントに付与されたロールへの <code class="literal">SYSTEM_USER</code> の付与は含まれません。 
          </p></li><li class="listitem"><p>
            <code class="literal">mysql</code> スキーマの権限を使用すると、変更するアカウントが通常のアカウントであっても、権限付与テーブルを直接変更することでシステムアカウントを操作できます。 通常のアカウントによるシステムアカウントの不正な直接変更を制限するには、<code class="literal">mysql</code> スキーマの変更権限をアカウント (またはアカウントに付与されたロール) に付与しないでください。 通常のアカウントに、すべてのスキーマに適用されるグローバル権限が必要な場合は、部分的な取消しを使用して課される権限制限を使用して、<code class="literal">mysql</code> スキーマの変更を防止できます。 <a class="xref" href="security.html#partial-revokes" title="6.2.12 部分取消しを使用した権限の制限">セクション6.2.12「部分取消しを使用した権限の制限」</a>を参照してください。 
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">SYSTEM_USER</code> 権限を源泉徴収することで、アカウントがシステムアカウントを変更できなくなりますが、通常のアカウントは変更できなくなりますが、<code class="literal">mysql</code> スキーマ権限を源泉徴収することで、アカウントは通常のアカウントと同様にシステムアカウントを変更できなくなります。 前述のように、直接付与テーブルの変更はお薦めしないため、これは問題ではありません。 
        </p></div><p>
        すべてのスキーマに対するすべての権限を持つユーザー <code class="literal">u1</code> を作成するとします。ただし、<code class="literal">u1</code> はシステムアカウントを変更できない通常のユーザーである必要があります。 <code class="literal">partial_revokes</code> システム変数が有効になっている場合は、次のように <code class="literal">u1</code> を構成します: 
      </p><pre class="programlisting">CREATE USER u1 IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';

GRANT ALL ON *.* TO u1 WITH GRANT OPTION;
-- GRANT ALL includes SYSTEM_USER, so at this point
-- u1 can manipulate system or regular accounts

REVOKE SYSTEM_USER ON *.* FROM u1;
-- Revoking SYSTEM_USER makes u1 a regular user;
-- now u1 can use account-management statements
-- to manipulate only regular accounts

REVOKE ALL ON mysql.* FROM u1;
-- This partial revoke prevents u1 from directly
-- modifying grant tables to manipulate accounts
</pre><p>
        アカウントによるすべての <code class="literal">mysql</code> システムスキーマへのアクセスを防止するには、次に示すように、<code class="literal">mysql</code> スキーマに対するすべての権限を取り消します。 読取り専用アクセスなどの部分的な <code class="literal">mysql</code> スキーマアクセスを許可することもできます。 次の例では、<code class="literal">SELECT</code>, <code class="literal">INSERT</code>, <code class="literal">UPDATE</code> および <code class="literal">DELETE</code> 権限を持つアカウントをすべてのスキーマに対してグローバルに作成しますが、<code class="literal">mysql</code> スキーマに対しては <code class="literal">SELECT</code> のみを作成します: 
      </p><pre class="programlisting">CREATE USER u2 IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO u2;
REVOKE INSERT, UPDATE, DELETE ON mysql.* FROM u2;
</pre><p>
        また、すべての <code class="literal">mysql</code> スキーマ権限を取り消し、特定の <code class="literal">mysql</code> テーブルまたはカラムへのアクセス権を付与することもできます。 これは、<code class="literal">mysql</code> で部分的な取消しを使用しても実行できます。 次のステートメントは、<code class="literal">mysql</code> スキーマ内の <code class="literal">u1</code> への読取り専用アクセスを有効にしますが、<code class="literal">user</code> テーブルの <code class="literal">db</code> テーブル、<code class="literal">Host</code> カラムおよび <code class="literal">User</code> カラムに対してのみ有効にします: 
      </p><pre class="programlisting">CREATE USER u3 IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL ON *.* TO u3;
REVOKE ALL ON mysql.* FROM u3;
GRANT SELECT ON mysql.db TO u3;
GRANT SELECT(Host,User) ON mysql.user TO u3;
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="partial-revokes"></a>6.2.12 部分取消しを使用した権限の制限</h3></div></div></div><a class="indexterm" name="idm46723762863328"></a><a class="indexterm" name="idm46723762861888"></a><p>
      MySQL 8.0.16 より前は、特定のスキーマを除き、グローバルに適用される権限を付与することはできません。 MySQL 8.0.16 では、これは <code class="literal">partial_revokes</code> システム変数が有効な場合に可能です。 具体的には、グローバルレベルの権限を持つユーザーの場合、<code class="literal">partial_revokes</code> では、特定のスキーマの権限を取り消しながら、他のスキーマの権限をそのままにすることができます。 したがって、権限の制限は、グローバル権限を持つが、特定のスキーマへのアクセスを許可しないアカウントの管理に役立つ場合があります。 たとえば、<code class="literal">mysql</code> システムスキーマ内のテーブルを除く任意のテーブルの変更をアカウントに許可できます。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#partial-revokes-usage" title="部分失効の使用">部分失効の使用</a></p></li><li class="listitem"><p><a class="xref" href="security.html#partial-revokes-versus-schema-grants" title="部分的な取消しと明示的なスキーマ付与">部分的な取消しと明示的なスキーマ付与</a></p></li><li class="listitem"><p><a class="xref" href="security.html#partial-revokes-disabling" title="部分失効の無効化">部分失効の無効化</a></p></li><li class="listitem"><p><a class="xref" href="security.html#partial-revokes-replication" title="部分的な取消しとレプリケーション">部分的な取消しとレプリケーション</a></p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        簡潔にするために、ここに示す <code class="literal">CREATE USER</code> ステートメントにはパスワードは含まれていません。 本番で使用する場合は、常にアカウントパスワードを割り当てます。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="partial-revokes-usage"></a>部分失効の使用</h4></div></div></div><p>
        <code class="literal">partial_revokes</code> システム変数は、アカウントに権限制限を設定できるかどうかを制御します。 デフォルトでは、<code class="literal">partial_revokes</code> は無効になっており、グローバル権限を部分的に取り消そうとするとエラーが発生します: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT, INSERT ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON world.* FROM u1;</code></strong>
ERROR 1141 (42000): There is no such grant defined for user 'u1' on host '%'
</pre><p>
        <code class="literal">REVOKE</code> 操作を許可するには、<code class="literal">partial_revokes</code> を有効にします:
      </p><pre class="programlisting">SET PERSIST partial_revokes = ON;
</pre><p>
        <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、値が保存され、その後のサーバーの再起動に引き継がれます。 後続の再起動に引き継ぐことなく、実行中の MySQL インスタンスの値を変更するには、<code class="literal">PERSIST</code> ではなく <code class="literal">GLOBAL</code> キーワードを使用します。 <a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a>を参照してください。 
      </p><p>
        <code class="literal">partial_revokes</code> が有効になっている場合、部分的な取消しは成功します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON world.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+------------------------------------------+
| Grants for u1@%                          |
+------------------------------------------+
| GRANT SELECT, INSERT ON *.* TO `u1`@`%`  |
| REVOKE INSERT ON `world`.* FROM `u1`@`%` |
+------------------------------------------+
</pre><p>
        <code class="literal">SHOW GRANTS</code> の出力には、部分的な取消しが <code class="literal">REVOKE</code> ステートメントとしてリストされます。 この結果は、<code class="literal">world</code> スキーマのテーブルに対して <code class="literal">INSERT</code> を実行できないことを除き、<code class="literal">u1</code> にグローバルな <code class="literal">SELECT</code> および <code class="literal">INSERT</code> 権限があることを示しています。 つまり、<code class="literal">u1</code> による <code class="literal">world</code> テーブルへのアクセスは読取り専用です。 
      </p><p>
        サーバーは、部分的な取消しによって実装された権限制限を <code class="literal">mysql.user</code> システムテーブルに記録します。 アカウントに部分的な失効がある場合、その <code class="literal">User_attributes</code> カラム値には <code class="literal">Restrictions</code> 属性があります: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT User, Host, User_attributes-&gt;&gt;'$.Restrictions'</code></strong>
       <strong class="userinput"><code>FROM mysql.user WHERE User_attributes-&gt;&gt;'$.Restrictions' &lt;&gt; '';</code></strong>
+------+------+------------------------------------------------------+
| User | Host | User_attributes-&gt;&gt;'$.Restrictions'                   |
+------+------+------------------------------------------------------+
| u1   | %    | [{"Database": "world", "Privileges": ["INSERT"]}] |
+------+------+------------------------------------------------------+
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          部分的な取消しは任意のスキーマに適用できますが、<code class="literal">mysql</code> システムスキーマに対する権限制限は、通常のアカウントがシステムアカウントを変更できないようにする戦略の一環として特に役立ちます。 <a class="xref" href="security.html#protecting-system-accounts" title="通常アカウントによる操作からのシステムアカウントの保護">通常アカウントによる操作からのシステムアカウントの保護</a>を参照してください。 
        </p></div><p>
        部分的な取消し操作には、次の条件があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            部分的な取消しでは、スキーマに文字どおりの名前を付ける必要があります。 <code class="literal">%</code> または<code class="literal">_</code> SQL ワイルドカード文字 (<code class="literal">myschema%</code> など) を含むスキーマ名は使用できません。 
          </p></li><li class="listitem"><p>
            部分的な取消しを使用して、存在しないスキーマに制限を設定できますが、取り消す権限がグローバルに付与されている場合のみです。 権限がグローバルに付与されていない場合、存在しないスキーマに対して権限を取り消すとエラーが発生します。 
          </p></li><li class="listitem"><p>
            部分的な取消しはスキーマレベルでのみ適用されます。 部分取消しは、グローバルにのみ適用される権限 (<code class="literal">FILE</code>、<code class="literal">BINLOG_ADMIN</code> など)、またはテーブル、カラムまたはルーチン権限には使用できません。 
          </p></li></ul></div><p>
        前述のように、スキーマレベルの権限の部分的な取消しは、<code class="literal">SHOW GRANTS</code> 出力に <code class="literal">REVOKE</code> ステートメントとして表示されます。 これは、<code class="literal">SHOW GRANTS</code> が<span class="quote">「<span class="quote">「プレーン」</span>」</span>スキーマレベルの権限を表す方法とは異なります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            付与されると、スキーマレベルの権限は、出力内の独自の <code class="literal">GRANT</code> ステートメントによって表されます:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT UPDATE ON mysql.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT DELETE ON world.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------+
| Grants for u1@%                       |
+---------------------------------------+
| GRANT USAGE ON *.* TO `u1`@`%`        |
| GRANT UPDATE ON `mysql`.* TO `u1`@`%` |
| GRANT DELETE ON `world`.* TO `u1`@`%` |
+---------------------------------------+
</pre></li><li class="listitem"><p>
            取り消すと、スキーマレベルの権限は単に出力から消えます。 これらは <code class="literal">REVOKE</code> ステートメントとしては表示されません: 
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>REVOKE UPDATE ON mysql.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE DELETE ON world.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+--------------------------------+
| Grants for u1@%                |
+--------------------------------+
| GRANT USAGE ON *.* TO `u1`@`%` |
+--------------------------------+
</pre></li></ul></div><p>
        ユーザーが権限を付与すると、権限受領者がその権限を持たない権限をすでに持っていないかぎり、権限受領者はその権限を継承します。 次の 2 人のユーザーについて考えてみます。いずれかのユーザーにグローバル <code class="literal">SELECT</code> 権限があります: 
      </p><pre class="programlisting">CREATE USER u1, u2;
GRANT SELECT ON *.* TO u2;
</pre><p>
        管理ユーザー <code class="literal">admin</code> に、グローバルだが部分的に取り消された <code class="literal">SELECT</code> 権限があるとします:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER admin;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT ON *.* TO admin WITH GRANT OPTION;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE SELECT ON mysql.* FROM admin;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR admin;</code></strong>
+------------------------------------------------------+
| Grants for admin@%                                   |
+------------------------------------------------------+
| GRANT SELECT ON *.* TO `admin`@`%` WITH GRANT OPTION |
| REVOKE SELECT ON `mysql`.* FROM `admin`@`%`          |
+------------------------------------------------------+
</pre><p>
        <code class="literal">admin</code> によって <code class="literal">SELECT</code> が <code class="literal">u1</code> および <code class="literal">u2</code> にグローバルに付与される場合、結果はユーザーごとに異なります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">admin</code> が <code class="literal">SELECT</code> 権限を持たない <code class="literal">u1</code> に <code class="literal">SELECT</code> をグローバルに付与する場合、<code class="literal">u1</code> は <code class="literal">admin</code> 権限制限を継承します:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>GRANT SELECT ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+------------------------------------------+
| Grants for u1@%                          |
+------------------------------------------+
| GRANT SELECT ON *.* TO `u1`@`%`          |
| REVOKE SELECT ON `mysql`.* FROM `u1`@`%` |
+------------------------------------------+
</pre></li><li class="listitem"><p>
            一方、<code class="literal">u2</code> は制限なしでグローバル <code class="literal">SELECT</code> 権限をすでに保持しています。 <code class="literal">GRANT</code> は、権限受領者の既存の権限にのみ追加でき、権限を減らすことはできないため、<code class="literal">admin</code> が <code class="literal">SELECT</code> を <code class="literal">u2</code> にグローバルに付与する場合、<code class="literal">u2</code> は <code class="literal">admin</code> の制限を継承しません: 
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>GRANT SELECT ON *.* TO u2;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u2;</code></strong>
+---------------------------------+
| Grants for u2@%                 |
+---------------------------------+
| GRANT SELECT ON *.* TO `u2`@`%` |
+---------------------------------+
</pre></li></ul></div><p>
        <code class="literal">GRANT</code> ステートメントに <code class="literal">AS <em class="replaceable"><code>user</code></em></code> 句が含まれている場合、適用される権限制限は、ステートメントを実行するユーザーではなく、句で指定されたユーザー/ロールの組合せに対する権限制限です。 <code class="literal">AS</code> 句の詳細は、<a class="xref" href="sql-statements.html#grant" title="13.7.1.6 GRANT ステートメント">セクション13.7.1.6「GRANT ステートメント」</a> を参照してください。 
      </p><p>
        アカウントに付与される新しい権限の制限は、そのアカウントの既存の制限に追加されます:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON mysql.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------------------------+
| Grants for u1@%                                         |
+---------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%` |
| REVOKE INSERT ON `mysql`.* FROM `u1`@`%`                |
+---------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>REVOKE DELETE, UPDATE ON db2.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------------------------+
| Grants for u1@%                                         |
+---------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%` |
| REVOKE UPDATE, DELETE ON `db2`.* FROM `u1`@`%`          |
| REVOKE INSERT ON `mysql`.* FROM `u1`@`%`                |
+---------------------------------------------------------+
</pre><p>
        権限制限の集計は、権限が明示的に明示的に取り消された場合 (前述のとおり)、およびステートメントを実行するユーザーまたは <code class="literal">AS <em class="replaceable"><code>user</code></em></code> 句に指定されたユーザーから制限が暗黙的に継承された場合の両方に適用されます。
      </p><p>
        アカウントにスキーマに対する権限制限がある場合:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            アカウントは、制限付きスキーマまたはその中のオブジェクトに対する権限を他のアカウントに付与することはできません。
          </p></li><li class="listitem"><p>
            制限のない別のアカウントは、制限付きスキーマまたはその中のオブジェクトの制限付きアカウントに権限を付与できます。 無制限のユーザーが次のステートメントを実行するとします: 
          </p><pre class="programlisting">CREATE USER u1;
GRANT SELECT, INSERT, UPDATE ON *.* TO u1;
REVOKE SELECT, INSERT, UPDATE ON mysql.* FROM u1;
GRANT SELECT ON mysql.user TO u1;          -- grant table privilege
GRANT SELECT(Host,User) ON mysql.db TO u1; -- grant column privileges
</pre><p>
            結果のアカウントには次の権限があり、制限付きスキーマ内で制限付き操作を実行できます:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+-----------------------------------------------------------+
| Grants for u1@%                                           |
+-----------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE ON *.* TO `u1`@`%`           |
| REVOKE SELECT, INSERT, UPDATE ON `mysql`.* FROM `u1`@`%`  |
| GRANT SELECT (`Host`, `User`) ON `mysql`.`db` TO `u1`@`%` |
| GRANT SELECT ON `mysql`.`user` TO `u1`@`%`                |
+-----------------------------------------------------------+
</pre></li></ul></div><p>
        アカウントにグローバル権限の制限がある場合、その制限は次のいずれかのアクションによって削除されます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            権限に対する制限のないアカウントによるアカウントへの権限のグローバルな付与。
          </p></li><li class="listitem"><p>
            スキーマレベルでの権限の付与。
          </p></li><li class="listitem"><p>
            権限をグローバルに取り消します。
          </p></li></ul></div><p>
        複数の権限をグローバルに保持しているが、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code> および <code class="literal">DELETE</code> に制限があるユーザー <code class="literal">u1</code> について考えてみます:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE INSERT, UPDATE, DELETE ON mysql.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+----------------------------------------------------------+
| Grants for u1@%                                          |
+----------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%`  |
| REVOKE INSERT, UPDATE, DELETE ON `mysql`.* FROM `u1`@`%` |
+----------------------------------------------------------+
</pre><p>
        制限のないアカウントから <code class="literal">u1</code> にグローバルに権限を付与すると、権限制限が削除されます。 たとえば、<code class="literal">INSERT</code> の制限を削除するには: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>GRANT INSERT ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------------------------+
| Grants for u1@%                                         |
+---------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%` |
| REVOKE UPDATE, DELETE ON `mysql`.* FROM `u1`@`%`        |
+---------------------------------------------------------+
</pre><p>
        スキーマレベルで <code class="literal">u1</code> に権限を付与すると、権限の制限がなくなります。 たとえば、<code class="literal">UPDATE</code> の制限を削除するには: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>GRANT UPDATE ON mysql.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------------------------+
| Grants for u1@%                                         |
+---------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%` |
| REVOKE DELETE ON `mysql`.* FROM `u1`@`%`                |
+---------------------------------------------------------+
</pre><p>
        グローバル権限を取り消すと、その権限に対する制限も含めて権限が削除されます。 たとえば、<code class="literal">DELETE</code> の制限を削除するには、次のようにします (すべての <code class="literal">DELETE</code> アクセスを削除します): 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>REVOKE DELETE ON *.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+-------------------------------------------------+
| Grants for u1@%                                 |
+-------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE ON *.* TO `u1`@`%` |
+-------------------------------------------------+
</pre><p>
        アカウントにグローバルレベルとスキーマレベルの両方の権限がある場合、部分的な取消しを有効にするには、スキーマレベルで 2 回取り消す必要があります。 <code class="literal">u1</code> に次の権限があり、<code class="literal">INSERT</code> がグローバルおよび <code class="literal">world</code> スキーマの両方で保持されているとします: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT, INSERT ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT INSERT ON world.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+-----------------------------------------+
| Grants for u1@%                         |
+-----------------------------------------+
| GRANT SELECT, INSERT ON *.* TO `u1`@`%` |
| GRANT INSERT ON `world`.* TO `u1`@`%`   |
+-----------------------------------------+
</pre><p>
        <code class="literal">world</code> で <code class="literal">INSERT</code> を取り消すと、スキーマレベルの権限が取り消されます (<code class="literal">SHOW GRANTS</code> にはスキーマレベルの <code class="literal">GRANT</code> ステートメントは表示されなくなります):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON world.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+-----------------------------------------+
| Grants for u1@%                         |
+-----------------------------------------+
| GRANT SELECT, INSERT ON *.* TO `u1`@`%` |
+-----------------------------------------+
</pre><p>
        <code class="literal">world</code> で <code class="literal">INSERT</code> を再度取り消すと、グローバル権限の部分的な取消しが実行されます (<code class="literal">SHOW GRANTS</code> にはスキーマレベルの <code class="literal">REVOKE</code> ステートメントが含まれるようになりました):
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON world.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+------------------------------------------+
| Grants for u1@%                          |
+------------------------------------------+
| GRANT SELECT, INSERT ON *.* TO `u1`@`%`  |
| REVOKE INSERT ON `world`.* FROM `u1`@`%` |
+------------------------------------------+
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="partial-revokes-versus-schema-grants"></a>部分的な取消しと明示的なスキーマ付与</h4></div></div></div><p>
        一部のスキーマのアカウントへのアクセスを提供し、他のスキーマのアカウントへのアクセスを提供するために、部分的な取消しでは、グローバル権限を付与せずにスキーマレベルのアクセス権を明示的に付与する方法の代替方法が提供されます。 2 つのアプローチには、長所と短所があります。 
      </p><p>
        グローバル権限ではなく、スキーマレベルの権限を付与します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            新規スキーマの追加: デフォルトでは、スキーマには既存のアカウントからアクセスできません。 スキーマにアクセスできるアカウントの場合、DBA はスキーマレベルのアクセス権を付与する必要があります。 
          </p></li><li class="listitem"><p>
            新規アカウントの追加: DBA は、アカウントがアクセスできるスキーマごとにスキーマレベルのアクセス権を付与する必要があります。
          </p></li></ul></div><p>
        部分的な取消しと組み合せたグローバル権限の付与:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            新規スキーマの追加: スキーマは、グローバル権限を持つ既存のアカウントからアクセスできます。 スキーマにアクセスできないアカウントの場合、DBA は部分的な取消しを追加する必要があります。 
          </p></li><li class="listitem"><p>
            新規アカウントの追加: DBA は、グローバル権限に加えて、各制限付きスキーマに対する部分的な取消しを付与する必要があります。
          </p></li></ul></div><p>
        明示的なスキーマレベルの付与を使用するアプローチは、アクセスがいくつかのスキーマに制限されているアカウントでは便利です。 部分的な取消しを使用するアプローチは、少数を除くすべてのスキーマへの広範なアクセス権を持つアカウントではより便利です。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="partial-revokes-disabling"></a>部分失効の無効化</h4></div></div></div><p>
        一度有効にすると、アカウントに権限制限がある場合は <code class="literal">partial_revokes</code> を無効にできません。 そのようなアカウントが存在する場合、<code class="literal">partial_revokes</code> の無効化は失敗します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            起動時に <code class="literal">partial_revokes</code> を無効にしようとすると、サーバーはエラーメッセージをログに記録し、<code class="literal">partial_revokes</code> を有効にします。
          </p></li><li class="listitem"><p>
            実行時に <code class="literal">partial_revokes</code> を無効にしようとすると、エラーが発生し、<code class="literal">partial_revokes</code> 値は変更されません。
          </p></li></ul></div><p>
        制限が存在する場合に <code class="literal">partial_revokes</code> を無効にするには、最初に制限を削除する必要があります:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            部分的な失効があるアカウントを判別します:
          </p><pre class="programlisting">SELECT User, Host, User_attributes-&gt;&gt;'$.Restrictions'
FROM mysql.user WHERE User_attributes-&gt;&gt;'$.Restrictions' &lt;&gt; '';
</pre></li><li class="listitem"><p>
            このようなアカウントごとに、その権限制限を削除します。 前のステップで、アカウント <code class="literal">u1</code> に次の制限があるとします: 
          </p><pre class="programlisting">[{"Database": "world", "Privileges": ["INSERT", "DELETE"]
</pre><p>
            制限の削除は様々な方法で実行できます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                制限なしで権限をグローバルに付与します:
              </p><pre class="programlisting">GRANT INSERT, DELETE ON *.* TO u1;
</pre></li><li class="listitem"><p>
                スキーマレベルで権限を付与します:
              </p><pre class="programlisting">GRANT INSERT, DELETE ON world.* TO u1;
</pre></li><li class="listitem"><p>
                権限をグローバルに取り消します (不要になった場合):
              </p><pre class="programlisting">REVOKE INSERT, DELETE ON *.* FROM u1;
</pre></li><li class="listitem"><p>
                アカウント自体を削除します (不要になった場合):
              </p><pre class="programlisting">DROP USER u1;
</pre></li></ul></div></li></ol></div><p>
        すべての権限制限を削除した後、部分的な取消しを無効にできます:
      </p><pre class="programlisting">SET PERSIST partial_revokes = OFF;
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="partial-revokes-replication"></a>部分的な取消しとレプリケーション</h4></div></div></div><p>
        レプリケーションシナリオでは、<code class="literal">partial_revokes</code> が任意のホストで有効になっている場合、すべてのホストで有効にする必要があります。 それ以外の場合、グローバル権限を部分的に取り消す <code class="literal">REVOKE</code> ステートメントは、レプリケーションが発生するすべてのホストで同じ効果がないため、レプリケーションの不整合またはエラーが発生する可能性があります。 
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="privilege-changes"></a>6.2.13 権限変更が有効化される時期</h3></div></div></div><a class="indexterm" name="idm46723762639952"></a><a class="indexterm" name="idm46723762637840"></a><p>
      <code class="option">--skip-grant-tables</code> オプションを指定せずに <span class="command"><strong>mysqld</strong></span> サーバーを起動すると、起動シーケンス中にすべての付与テーブルの内容がメモリーに読み込まれます。 インメモリーテーブルは、その時点でアクセス制御に有効になります。 
    </p><p>
      account-management ステートメントを使用して付与テーブルを間接的に変更すると、サーバーはこれらの変更に気付き、付与テーブルをすぐにメモリーに再度ロードします。 アカウント管理ステートメントについては、<a class="xref" href="sql-statements.html#account-management-statements" title="13.7.1 アカウント管理ステートメント">セクション13.7.1「アカウント管理ステートメント」</a> を参照してください。 たとえば、<code class="literal">GRANT</code>, <code class="literal">REVOKE</code>, <code class="literal">SET PASSWORD</code> や <code class="literal">RENAME USER</code> などです。 
    </p><p>
      <code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> (非推奨) などのステートメントを使用して付与テーブルを直接変更した場合、その変更は、テーブルをリロードするか再起動するようにサーバーに指示するまで、権限チェックには影響しません。 したがって、付与テーブルを直接変更してもリロードを忘れた場合、サーバーを再起動するまで変更には<span class="emphasis"><em>影響なし</em></span>が含まれます。 このため、変更したのに違いが現れないことを不思議に思うことがあるかもしれません。 
    </p><p>
      付与テーブルをリロードするようサーバーに指示するには、フラッシュ権限操作を実行します。 これは、<code class="literal">FLUSH PRIVILEGES</code> ステートメントを発行するか、<span class="command"><strong>mysqladmin flush-privileges</strong></span> または <span class="command"><strong>mysqladmin reload</strong></span> コマンドを実行することによって行うことができます。 
    </p><p>
      付与テーブルのリロードは、次のように既存の各クライアントセッションの権限に影響します:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          テーブルおよびカラムの権限の変更は、クライアントの次回のリクエストで有効になります。
        </p></li><li class="listitem"><p>
          データベース権限の変更は、クライアントが次回 <code class="literal">USE <em class="replaceable"><code>db_name</code></em></code> ステートメントを実行したときに有効になります。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            クライアントアプリケーションはデータベース名をキャッシュできます。そのため、実際に別のデータベースに変更しないと、この効果が表示されない場合があります。
          </p></div></li><li class="listitem"><p>
          接続済みクライアントについてのグローバルな権限およびパスワードは影響されません。 これらの変更は、後続の接続のセッションでのみ有効になります。 
        </p></li></ul></div><p>
      セッション内のアクティブなロールのセットに対する変更は、そのセッションに対してのみ即時に有効になります。 <code class="literal">SET ROLE</code> ステートメントは、セッションロールのアクティブ化および非アクティブ化を実行します (<a class="xref" href="sql-statements.html#set-role" title="13.7.1.11 SET ROLE ステートメント">セクション13.7.1.11「SET ROLE ステートメント」</a> を参照)。 
    </p><p>
      サーバーが <code class="option">--skip-grant-tables</code> オプションを指定して起動された場合、サーバーは付与テーブルを読み取ったりアクセス制御を実装したりしません。 すべてのユーザーが<span class="emphasis"><em>セキュアでない</em></span>に接続し、任意の操作を実行できます。 そのように起動されたサーバーが、テーブルを読み取ってアクセスチェックを有効にするようにするには、権限をフラッシュします。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="assigning-passwords"></a>6.2.14 アカウントパスワードの割り当て</h3></div></div></div><a class="indexterm" name="idm46723762607600"></a><a class="indexterm" name="idm46723762606112"></a><a class="indexterm" name="idm46723762604704"></a><a class="indexterm" name="idm46723762602672"></a><p>
      MySQL サーバーに接続するクライアントに必要な証明書には、パスワードを含めることができます。 このセクションでは、MySQL アカウントにパスワードを割り当てる方法について説明します。 
    </p><p>
      MySQL は、<code class="literal">mysql</code> システムデータベースの <code class="literal">user</code> テーブルに資格証明を格納します。 パスワードを割り当てたり変更したりする操作は、<code class="literal">CREATE USER</code> 権限を持つユーザー、または <code class="literal">mysql</code> データベースに対する権限 (新しいアカウントを作成するための <code class="literal">INSERT</code> 権限、既存のアカウントを変更するための <code class="literal">UPDATE</code> 権限) にのみ許可されます。 <code class="literal">read_only</code> システム変数が有効になっている場合、<code class="literal">CREATE USER</code> や <code class="literal">ALTER USER</code> などのアカウント変更ステートメントを使用するには、<code class="literal">CONNECTION_ADMIN</code> 権限 (または非推奨の <code class="literal">SUPER</code> 権限) も必要です。 
    </p><p>
      ここでは、最も一般的なパスワード割当てステートメントの構文のみをまとめています。 その他の可能性の詳細は、<a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a>、<a class="xref" href="sql-statements.html#alter-user" title="13.7.1.1 ALTER USER ステートメント">セクション13.7.1.1「ALTER USER ステートメント」</a> および <a class="xref" href="sql-statements.html#set-password" title="13.7.1.10 SET PASSWORD ステートメント">セクション13.7.1.10「SET PASSWORD ステートメント」</a> を参照してください。 
    </p><p>
      MySQL は、プラグインを使用してクライアント認証を実行します。<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a> を参照してください。 パスワード割当てステートメントでは、アカウントに関連付けられた認証プラグインは、指定されたクリアテキストパスワードに必要なハッシュを実行します。 これにより、MySQL では、パスワードを <code class="literal">mysql.user</code> システムテーブルに格納する前に不明瞭化できます。 ここで説明するステートメントでは、MySQL は指定されたパスワードを自動的にハッシュします。 <code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> には、ハッシュ値を文字どおりに指定できる構文もあります。 詳細は、これらのステートメントの説明を参照してください。 
    </p><p>
      新しいアカウントの作成時にパスワードを割り当てるには、<code class="literal">CREATE USER</code> を使用して <code class="literal">IDENTIFIED BY</code> 句を含めます:
    </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
      <code class="literal">CREATE USER</code> は、アカウント認証プラグインを指定するための構文もサポートしています。 <a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a>を参照してください。 
    </p><p>
      既存のアカウントのパスワードを割り当てたり変更したりするには、<code class="literal">IDENTIFIED BY</code> 句を含む <code class="literal">ALTER USER</code> ステートメントを使用します:
    </p><pre class="programlisting">ALTER USER 'jeffrey'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
      匿名ユーザーとして接続していない場合は、自分のアカウントに文字どおりに名前を付けずに自分のパスワードを変更できます:
    </p><pre class="programlisting">ALTER USER USER() IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
      コマンドラインからアカウントパスワードを変更するには、<span class="command"><strong>mysqladmin</strong></span> コマンドを使用します:
    </p><pre class="programlisting">mysqladmin -u <em class="replaceable"><code>user_name</code></em> -h <em class="replaceable"><code>host_name</code></em> password "<em class="replaceable"><code>password</code></em>"
</pre><p>
      このコマンドでパスワードを設定するアカウントは、<code class="literal">User</code> カラムに <em class="replaceable"><code>user_name</code></em> が、<code class="literal">Host</code> カラムにクライアントホスト<span class="emphasis"><em>接続元</em></span>が一致する <code class="literal">mysql.user</code> システムテーブルの行を持つアカウントです。
    </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
        <span class="command"><strong>mysqladmin</strong></span> を使用してパスワードを設定する場合は、<span class="emphasis"><em>セキュアでない</em></span>とみなす必要があります。 一部のシステムでは、使用しているパスワードが、コマンド行を表示するためにほかのユーザーによって起動できる <span class="command"><strong>ps</strong></span> などのシステムステータスプログラムによって表示可能になります。 MySQL クライアントは通常、クライアントの初期化シーケンス中にコマンド行パスワード引数をゼロで上書きします。 ただし、まだ値が表示可能な短い期間があります。 また、一部のシステムではこの上書きの方法には効果がなく、パスワードは <span class="command"><strong>ps</strong></span> から表示可能になったままになります。 (SystemV Unix システムおよびおそらくほかのシステムでもこの問題の影響があります。) 
      </p></div><p>
      MySQL レプリケーションを使用している場合は、現在、<code class="literal">CHANGE REPLICATION SOURCE TO</code> ステートメント (MySQL 8.0.23 の場合) または <code class="literal">CHANGE MASTER TO</code> ステートメント (MySQL 8.0.23 の場合) の一部としてレプリカによって使用されるパスワードの長さが事実上 32 文字に制限されていることに注意してください。パスワードが長い場合は、余分な文字が切り捨てられます。 これは通常、MySQL Server によって課される制限によるものではなく、MySQL レプリケーションに固有の問題です。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="password-management"></a>6.2.15 パスワード管理</h3></div></div></div><a class="indexterm" name="idm46723762551632"></a><p>
      MySQL は、次のパスワード管理機能をサポートしています:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          パスワードの有効期限。パスワードを定期的に変更する必要があります。
        </p></li><li class="listitem"><p>
          古いパスワードが再度選択されないようにするためのパスワード再利用の制限。
        </p></li><li class="listitem"><p>
          パスワードの検証。パスワードの変更を要求するには、置換する現在のパスワードも指定します。
        </p></li><li class="listitem"><p>
          デュアルパスワード。クライアントがプライマリパスワードまたはセカンダリパスワードを使用して接続できるようにします。
        </p></li><li class="listitem"><p>
          強力なパスワードを要求するためのパスワード強度評価。
        </p></li><li class="listitem"><p>
          ランダムパスワード生成。明示的な管理者指定のリテラルパスワードを要求するかわりに使用します。
        </p></li><li class="listitem"><p>
          パスワードの失敗を追跡して、連続するパスワードログインの失敗が多すぎる場合に一時アカウントロックを有効にします。
        </p></li></ul></div><p>
      次の各セクションでは、<code class="literal">validate_password</code> コンポーネントを使用して実装され、<a class="xref" href="security.html#validate-password" title="6.4.3 パスワード検証コンポーネント">セクション6.4.3「パスワード検証コンポーネント」</a> で説明されているパスワード強度評価を除き、これらの機能について説明します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#internal-versus-external-credentials" title="内部資格証明記憶域と外部資格証明記憶域">内部資格証明記憶域と外部資格証明記憶域</a></p></li><li class="listitem"><p><a class="xref" href="security.html#password-expiration-policy" title="パスワード有効期限ポリシー">パスワード有効期限ポリシー</a></p></li><li class="listitem"><p><a class="xref" href="security.html#password-reuse-policy" title="パスワード再利用ポリシー">パスワード再利用ポリシー</a></p></li><li class="listitem"><p><a class="xref" href="security.html#password-reverification-policy" title="パスワード検証必須ポリシー">パスワード検証必須ポリシー</a></p></li><li class="listitem"><p><a class="xref" href="security.html#dual-passwords" title="デュアルパスワードのサポート">デュアルパスワードのサポート</a></p></li><li class="listitem"><p><a class="xref" href="security.html#random-password-generation" title="ランダムパスワード生成">ランダムパスワード生成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#failed-login-tracking" title="失敗したログイントラッキングと一時アカウントロック">失敗したログイントラッキングと一時アカウントロック</a></p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
        MySQL は、<code class="literal">mysql</code> システムデータベースのテーブルを使用してパスワード管理機能を実装します。 MySQL を以前のバージョンからアップグレードする場合、システムテーブルが最新でない可能性があります。 その場合、サーバーは起動プロセス中に次のようなメッセージをエラーログに書き込みます (正確な数値は異なる場合があります): 
      </p><pre class="programlisting">[ERROR] Column count of mysql.user is wrong. Expected
49, found 47. The table is probably corrupted
[Warning] ACL table mysql.password_history missing.
Some operations may fail.
</pre><p>
        この問題を修正するには、MySQL のアップグレード手順を実行します。 <a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a>を参照してください。 これが完了するまで、<span class="emphasis"><em>パスワードは変更できません</em></span>は次のようになります。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="internal-versus-external-credentials"></a>内部資格証明記憶域と外部資格証明記憶域</h4></div></div></div><p>
        一部の認証プラグインでは、アカウント資格証明が <code class="literal">mysql.user</code> システムテーブルの MySQL に内部的に格納されます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mysql_native_password</code>
          </p></li><li class="listitem"><p>
            <code class="literal">caching_sha2_password</code>
          </p></li><li class="listitem"><p>
            <code class="literal">sha256_password</code>
          </p></li></ul></div><p>
        ここで説明するほとんどのパスワード管理機能は、MySQL 自体で処理される内部資格証明記憶域に基づいているため、このセクションのほとんどの説明はこのような認証プラグインに適用されます。 その他の認証プラグインは、MySQL の外部にアカウント資格証明を格納します。 外部資格証明システムに対して認証を実行するプラグインを使用するアカウントの場合、パスワード管理もそのシステムに対して外部で処理する必要があります。 
      </p><p>
        例外は、内部資格証明記憶域を使用するアカウントのみでなく、失敗したログイン追跡および一時アカウントロックのオプションがすべてのアカウントに適用されることです。これは、MySQL では、内部資格証明記憶域を使用するか外部資格証明記憶域を使用するかに関係なく、任意のアカウントのログイン試行のステータスを評価できるためです。
      </p><p>
        個々の認証プラグインの詳細は、<a class="xref" href="security.html#authentication-plugins" title="6.4.1 認証プラグイン">セクション6.4.1「認証プラグイン」</a> を参照してください。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="password-expiration-policy"></a>パスワード有効期限ポリシー</h4></div></div></div><p>
        MySQL を使用すると、データベース管理者はアカウントパスワードを手動で期限切れにしたり、自動パスワード期限切れのポリシーを設定できます。 有効期限ポリシーはグローバルに設定でき、個々のアカウントは、グローバルポリシーに従うか、特定のアカウントごとの動作でグローバルポリシーをオーバーライドするように設定できます。 
      </p><p>
        アカウントパスワードを手動で期限切れにするには、<code class="literal">ALTER USER</code> ステートメントを使用します:
      </p><pre class="programlisting">ALTER USER 'jeffrey'@'localhost' PASSWORD EXPIRE;
</pre><p>
        この操作は、<code class="literal">mysql.user</code> システムテーブルの対応する行でパスワードを期限切れとマークします。
      </p><p>
        ポリシーに従ったパスワードの有効期限は自動的に設定され、特定のアカウントのパスワード有効期限は、最新のパスワード変更の日時から評価されます。 <code class="literal">mysql.user</code> システムテーブルには、各アカウントのパスワードが最後に変更された時間が示され、その有効期間が許容される存続期間を超えると、サーバーはクライアント接続時にパスワードを期限切れとして自動的に処理します。 これは、明示的な手動パスワード有効期限なしで機能します。 
      </p><p>
        自動パスワード失効ポリシーをグローバルに確立するには、<code class="literal">default_password_lifetime</code> システム変数を使用します。 デフォルト値は 0 で、自動パスワード有効期限は無効になります。 <code class="literal">default_password_lifetime</code> の値が正の整数の <em class="replaceable"><code>N</code></em> である場合、パスワードを <em class="replaceable"><code>N</code></em> 日ごとに変更する必要があるように、許可されたパスワードの存続期間を示します。 
      </p><p>
        例:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            パスワードの存続期間が約 6 か月であるグローバルポリシーを確立するには、サーバー <code class="filename">my.cnf</code> ファイルで次の行を使用してサーバーを起動します:
          </p><pre class="programlisting">[mysqld]
default_password_lifetime=180
</pre></li><li class="listitem"><p>
            パスワードが期限切れにならないようにグローバルポリシーを設定するには、<code class="literal">default_password_lifetime</code> を 0 に設定します:
          </p><pre class="programlisting">[mysqld]
default_password_lifetime=0
</pre></li><li class="listitem"><p>
            <code class="literal">default_password_lifetime</code> は、実行時に設定および永続化することもできます:
          </p><pre class="programlisting">SET PERSIST default_password_lifetime = 180;
SET PERSIST default_password_lifetime = 0;
</pre><p>
            <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、後続のサーバー再起動に引き継ぐための値も保存されます。<a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a> を参照してください。 後続の再起動に引き継ぐことなく、実行中の MySQL インスタンスの値を変更するには、<code class="literal">PERSIST</code> ではなく <code class="literal">GLOBAL</code> キーワードを使用します。 
          </p></li></ul></div><p>
        グローバルパスワード失効ポリシーは、オーバーライドするように設定されていないすべてのアカウントに適用されます。 個々のアカウントのポリシーを設定するには、<code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> ステートメントの <code class="literal">PASSWORD EXPIRE</code> オプションを使用します。 <a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a>および<a class="xref" href="sql-statements.html#alter-user" title="13.7.1.1 ALTER USER ステートメント">セクション13.7.1.1「ALTER USER ステートメント」</a>を参照してください。 
      </p><p>
        アカウント固有のステートメントの例:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            90 日ごとにパスワードを変更する必要があります:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;
ALTER USER 'jeffrey'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;
</pre><p>
            この有効期限オプションは、ステートメントで指定されたすべてのアカウントのグローバルポリシーをオーバーライドします。
          </p></li><li class="listitem"><p>
            パスワードの有効期限の無効化:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' PASSWORD EXPIRE NEVER;
ALTER USER 'jeffrey'@'localhost' PASSWORD EXPIRE NEVER;
</pre><p>
            この有効期限オプションは、ステートメントで指定されたすべてのアカウントのグローバルポリシーをオーバーライドします。
          </p></li><li class="listitem"><p>
            ステートメントで指定されたすべてのアカウントのグローバルな有効期限ポリシーに従います:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' PASSWORD EXPIRE DEFAULT;
ALTER USER 'jeffrey'@'localhost' PASSWORD EXPIRE DEFAULT;
</pre></li></ul></div><p>
        クライアントが正常に接続すると、サーバーはアカウントパスワードの有効期限が切れているかどうかを判断します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバーは、パスワードが手動で期限切れになっているかどうかを確認します。
          </p></li><li class="listitem"><p>
            それ以外の場合、サーバーは、自動パスワード有効期限ポリシーに従って、パスワードの有効期間が許可された存続期間を超えているかどうかを確認します。 その場合、サーバーはパスワードの有効期限が切れたとみなします。 
          </p></li></ul></div><p>
        パスワードの有効期限が切れた場合 (手動か自動かに関係なく)、サーバーはクライアントを切断するか、許可されている操作を制限します (<a class="xref" href="security.html#expired-password-handling" title="6.2.16 期限切れパスワードのサーバー処理">セクション6.2.16「期限切れパスワードのサーバー処理」</a> を参照)。 制限付きクライアントによって実行される操作は、ユーザーが新しいアカウントパスワードを確立するまでエラーになります: 
      </p><a class="indexterm" name="idm46723762471152"></a><a class="indexterm" name="idm46723762469632"></a><a class="indexterm" name="idm46723762467616"></a><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT 1;</code></strong>
ERROR 1820 (HY000): You must reset your password using ALTER USER
statement before executing this statement.

mysql&gt; <strong class="userinput"><code>ALTER USER USER() IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>SELECT 1;</code></strong>
+---+
| 1 |
+---+
| 1 |
+---+
1 row in set (0.00 sec)
</pre><p>
        クライアントがパスワードをリセットすると、サーバーはセッションの通常のアクセスと、そのアカウントを使用する後続の接続をリストアします。 管理ユーザーがアカウントパスワードをリセットすることもできますが、そのアカウントの既存の制限付きセッションは制限されたままになります。 アカウントを使用するクライアントは、ステートメントを正常に実行する前に切断して再接続する必要があります。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          期限切れのパスワードは、現在の値に設定することで <span class="quote">「<span class="quote">reset</span>」</span> で使用できますが、適切なポリシーとして、別のパスワードを選択することをお薦めします。 DBA は、適切なパスワード再利用ポリシーを確立することで、非キューを強制できます。 <a class="xref" href="security.html#password-reuse-policy" title="パスワード再利用ポリシー">パスワード再利用ポリシー</a>を参照してください。 
        </p></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="password-reuse-policy"></a>パスワード再利用ポリシー</h4></div></div></div><p>
        MySQL では、以前のパスワードの再利用に制限を適用できます。 再利用制限は、パスワード変更の数、経過時間、またはその両方に基づいて設定できます。 再利用ポリシーはグローバルに確立でき、個々のアカウントはグローバルポリシーに従うように設定することも、特定のアカウントごとの動作でグローバルポリシーをオーバーライドするように設定することもできます。 
      </p><p>
        アカウントのパスワード履歴は、過去に割り当てられたパスワードで構成されます。 MySQL では、新しいパスワードがこの履歴から選択されないように制限できます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            アカウントがパスワード変更数に基づいて制限されている場合、指定された数の最新のパスワードから新しいパスワードを選択することはできません。 たとえば、パスワード変更の最小数が 3 に設定されている場合、新しいパスワードは最新の 3 つのパスワードと同じにできません。 
          </p></li><li class="listitem"><p>
            経過時間に基づいてアカウントが制限されている場合、履歴内の指定した日数より新しいパスワードから新しいパスワードを選択することはできません。 たとえば、パスワードの再利用間隔が 60 に設定されている場合、新しいパスワードは過去 60 日以内に選択されたパスワードの中にあってはなりません。 
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          空のパスワードはパスワード履歴にカウントされず、いつでも再利用される可能性があります。
        </p></div><p>
        パスワード再利用ポリシーをグローバルに確立するには、<code class="literal">password_history</code> および <code class="literal">password_reuse_interval</code> システム変数を使用します。
      </p><p>
        例:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            365 日より新しい過去 6 つのパスワードまたはパスワードの再利用を禁止するには、サーバーの <code class="filename">my.cnf</code> ファイルに次の行を挿入します:
          </p><pre class="programlisting">[mysqld]
password_history=6
password_reuse_interval=365
</pre></li><li class="listitem"><p>
            実行時に変数を設定して永続化するには、次のようなステートメントを使用します:
          </p><pre class="programlisting">SET PERSIST password_history = 6;
SET PERSIST password_reuse_interval = 365;
</pre><p>
            <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、後続のサーバー再起動に引き継ぐための値も保存されます。<a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a> を参照してください。 後続の再起動に引き継ぐことなく、実行中の MySQL インスタンスの値を変更するには、<code class="literal">PERSIST</code> ではなく <code class="literal">GLOBAL</code> キーワードを使用します。 
          </p></li></ul></div><p>
        グローバルパスワード再利用ポリシーは、オーバーライドするように設定されていないすべてのアカウントに適用されます。 個々のアカウントのポリシーを設定するには、<code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> ステートメントの <code class="literal">PASSWORD HISTORY</code> および <code class="literal">PASSWORD REUSE INTERVAL</code> オプションを使用します。 <a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a>および<a class="xref" href="sql-statements.html#alter-user" title="13.7.1.1 ALTER USER ステートメント">セクション13.7.1.1「ALTER USER ステートメント」</a>を参照してください。 
      </p><p>
        アカウント固有のステートメントの例:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            再利用を許可する前に、少なくとも 5 つのパスワード変更が必要です:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' PASSWORD HISTORY 5;
ALTER USER 'jeffrey'@'localhost' PASSWORD HISTORY 5;
</pre><p>
            この履歴長オプションは、ステートメントで指定されたすべてのアカウントのグローバルポリシーをオーバーライドします。
          </p></li><li class="listitem"><p>
            再利用を許可する前に 365 日以上経過する必要があります:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' PASSWORD REUSE INTERVAL 365 DAY;
ALTER USER 'jeffrey'@'localhost' PASSWORD REUSE INTERVAL 365 DAY;
</pre><p>
            この time-elapsed オプションは、ステートメントで指定されたすべてのアカウントのグローバルポリシーをオーバーライドします。
          </p></li><li class="listitem"><p>
            両方のタイプの再利用制限を組み合せるには、<code class="literal">PASSWORD HISTORY</code> と <code class="literal">PASSWORD REUSE INTERVAL</code> を組み合せて使用します:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost'
  PASSWORD HISTORY 5
  PASSWORD REUSE INTERVAL 365 DAY;
ALTER USER 'jeffrey'@'localhost'
  PASSWORD HISTORY 5
  PASSWORD REUSE INTERVAL 365 DAY;
</pre><p>
            これらのオプションは、ステートメントで指定されたすべてのアカウントのグローバルポリシー再利用制限をオーバーライドします。
          </p></li><li class="listitem"><p>
            両方のタイプの再利用制限について、グローバルポリシーに従います:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost'
  PASSWORD HISTORY DEFAULT
  PASSWORD REUSE INTERVAL DEFAULT;
ALTER USER 'jeffrey'@'localhost'
  PASSWORD HISTORY DEFAULT
  PASSWORD REUSE INTERVAL DEFAULT;
</pre></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="password-reverification-policy"></a>パスワード検証必須ポリシー</h4></div></div></div><p>
        MySQL 8.0.13 の時点では、置換する現在のパスワードを指定して、アカウントパスワードの変更の試行を検証する必要があります。 これにより、DBA は、現在のパスワードを知らなくてもユーザーがパスワードを変更できないようにできます。 このような変更は、たとえば、あるユーザーがログアウトせずに一時的に端末セッションから離れると、悪質なユーザーが元のユーザー MySQL パスワードを変更するためにセッションを使用した場合に発生する可能性があります。 これには、次のような不適切な結果が生じる可能性があります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            管理者がアカウントパスワードをリセットするまで、元のユーザーは MySQL にアクセスできなくなります。
          </p></li><li class="listitem"><p>
            パスワードのリセットが発生するまで、悪質なユーザーは無害なユーザー変更の資格証明を使用して MySQL にアクセスできます。
          </p></li></ul></div><p>
        パスワード検証ポリシーはグローバルに確立でき、個々のアカウントは、グローバルポリシーに従うか、特定のアカウントごとの動作でグローバルポリシーをオーバーライドするように設定できます。
      </p><p>
        アカウントごとに、その <code class="literal">mysql.user</code> 行は、パスワード変更試行のために現在のパスワードの検証を必要とするアカウント固有の設定があるかどうかを示します。 この設定は、<code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> ステートメントの <code class="literal">PASSWORD REQUIRE</code> オプションによって確立されます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            アカウント設定が <code class="literal">PASSWORD REQUIRE CURRENT</code> の場合、パスワード変更では現在のパスワードを指定する必要があります。
          </p></li><li class="listitem"><p>
            アカウント設定が <code class="literal">PASSWORD REQUIRE CURRENT OPTIONAL</code> の場合、パスワードの変更では現在のパスワードを指定する必要はありません。
          </p></li><li class="listitem"><p>
            アカウント設定が <code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code> の場合、<code class="literal">password_require_current</code> システム変数によってアカウントの検証必須ポリシーが決定されます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">password_require_current</code> が有効な場合、パスワード変更では現在のパスワードを指定する必要があります。
              </p></li><li class="listitem"><p>
                <code class="literal">password_require_current</code> が無効になっている場合、パスワードの変更では現在のパスワードを指定する必要はありません。
              </p></li></ul></div></li></ul></div><p>
        つまり、アカウント設定が <code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code> でない場合、アカウント設定は <code class="literal">password_require_current</code> システム変数によって設定されたグローバルポリシーよりも優先されます。 それ以外の場合、アカウントは <code class="literal">password_require_current</code> 設定に従います。 
      </p><p>
        デフォルトでは、パスワード検証はオプションです: <code class="literal">password_require_current</code> が無効になり、<code class="literal">PASSWORD REQUIRE</code> オプションなしで作成されたアカウントは <code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code> にデフォルト設定されます。
      </p><p>
        次のテーブルは、アカウントごとの設定が <code class="literal">password_require_current</code> システム変数値とどのように相互作用して、アカウントパスワードの検証が必要なポリシーを決定するかを示しています。
      </p><div class="table"><a name="password-verification-policy-table"></a><p class="title"><b>表 6.10 パスワード検証ポリシー</b></p><div class="table-contents"><table summary="Interaction of mysql.user table and password_require_current system variable for password-verification policy."><col style="width=40%"><col style="width=30%"><col style="width=30%"><thead><tr>
            <th scope="col">アカウントごとの設定</th>
            <th scope="col">password_require_current システム変数</th>
            <th scope="col">パスワードの変更には現在のパスワードが必要ですか。</th>
          </tr></thead><tbody><tr>
            <th scope="row"><code class="literal">PASSWORD REQUIRE CURRENT</code></th>
            <td><code class="literal">OFF</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row"><code class="literal">PASSWORD REQUIRE CURRENT</code></th>
            <td><code class="literal">ON</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row"><code class="literal">PASSWORD REQUIRE CURRENT OPTIONAL</code></th>
            <td><code class="literal">OFF</code></td>
            <td>いいえ</td>
          </tr><tr>
            <th scope="row"><code class="literal">PASSWORD REQUIRE CURRENT OPTIONAL</code></th>
            <td><code class="literal">ON</code></td>
            <td>いいえ</td>
          </tr><tr>
            <th scope="row"><code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code></th>
            <td><code class="literal">OFF</code></td>
            <td>いいえ</td>
          </tr><tr>
            <th scope="row"><code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code></th>
            <td><code class="literal">ON</code></td>
            <td>はい</td>
          </tr></tbody></table></div></div><br class="table-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          特権ユーザーは、検証必須ポリシーに関係なく、現在のパスワードを指定せずに任意のアカウントパスワードを変更できます。 特権ユーザーは、<code class="literal">mysql</code> システムデータベースに対するグローバル <code class="literal">CREATE USER</code> 権限または <code class="literal">UPDATE</code> 権限を持つユーザーです。 
        </p></div><p>
        パスワード検証ポリシーをグローバルに確立するには、<code class="literal">password_require_current</code> システム変数を使用します。 デフォルト値は <code class="literal">OFF</code> であるため、アカウントパスワードの変更で現在のパスワードを指定する必要はありません。 
      </p><p>
        例:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            パスワード変更で現在のパスワードを指定する必要があるグローバルポリシーを確立するには、サーバー <code class="filename">my.cnf</code> ファイルで次の行を使用してサーバーを起動します:
          </p><pre class="programlisting">[mysqld]
password_require_current=ON
</pre></li><li class="listitem"><p>
            実行時に <code class="literal">password_require_current</code> を設定および永続化するには、次のいずれかのステートメントを使用します:
          </p><pre class="programlisting">SET PERSIST password_require_current = ON;
SET PERSIST password_require_current = OFF;
</pre><p>
            <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、後続のサーバー再起動に引き継ぐための値も保存されます。<a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a> を参照してください。 後続の再起動に引き継ぐことなく、実行中の MySQL インスタンスの値を変更するには、<code class="literal">PERSIST</code> ではなく <code class="literal">GLOBAL</code> キーワードを使用します。 
          </p></li></ul></div><p>
        グローバルパスワード検証必須ポリシーは、オーバーライドするように設定されていないすべてのアカウントに適用されます。 個々のアカウントのポリシーを設定するには、<code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> ステートメントの <code class="literal">PASSWORD REQUIRE</code> オプションを使用します。 <a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a>および<a class="xref" href="sql-statements.html#alter-user" title="13.7.1.1 ALTER USER ステートメント">セクション13.7.1.1「ALTER USER ステートメント」</a>を参照してください。 
      </p><p>
        アカウント固有のステートメントの例:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            パスワードの変更で現在のパスワードを指定する必要があります:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT;
ALTER USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT;
</pre><p>
            この検証オプションは、ステートメントで指定されたすべてのアカウントのグローバルポリシーをオーバーライドします。
          </p></li><li class="listitem"><p>
            パスワードの変更で現在のパスワードを指定する必要はありません (現在のパスワードを指定する必要はあります):
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT OPTIONAL;
ALTER USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT OPTIONAL;
</pre><p>
            この検証オプションは、ステートメントで指定されたすべてのアカウントのグローバルポリシーをオーバーライドします。
          </p></li><li class="listitem"><p>
            ステートメントで指定されたすべてのアカウントのグローバルパスワード検証必須ポリシーに従います:
          </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT DEFAULT;
ALTER USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT DEFAULT;
</pre></li></ul></div><p>
        ユーザーが <code class="literal">ALTER USER</code> または <code class="literal">SET PASSWORD</code> ステートメントを使用してパスワードを変更すると、現在のパスワードの検証が行われます。 この例では、<code class="literal">SET PASSWORD</code> よりも優先される <code class="literal">ALTER USER</code> を使用していますが、ここで説明する原則は両方のステートメントで同じです。 
      </p><p>
        password-change ステートメントでは、置換する現在のパスワードを <code class="literal">REPLACE</code> 句で指定します。 例: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            現在のユーザーパスワードを変更します:
          </p><pre class="programlisting">ALTER USER USER() IDENTIFIED BY '<em class="replaceable"><code>auth_string</code></em>' REPLACE '<em class="replaceable"><code>current_auth_string</code></em>';
</pre></li><li class="listitem"><p>
            名前付きユーザーのパスワードを変更します:
          </p><pre class="programlisting">ALTER USER 'jeffrey'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>auth_string</code></em>'
  REPLACE '<em class="replaceable"><code>current_auth_string</code></em>';
</pre></li><li class="listitem"><p>
            名前付きユーザー認証プラグインおよびパスワードを変更します:
          </p><pre class="programlisting">ALTER USER 'jeffrey'@'localhost'
  IDENTIFIED WITH caching_sha2_password BY '<em class="replaceable"><code>auth_string</code></em>'
  REPLACE '<em class="replaceable"><code>current_auth_string</code></em>';
</pre></li></ul></div><p>
        <code class="literal">REPLACE</code> 句は次のように機能します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            現在のパスワードを指定するためにアカウントのパスワード変更が必要な場合は、変更しようとしているユーザーが実際に現在のパスワードを知っていることを確認するために、<code class="literal">REPLACE</code> を指定する必要があります。
          </p></li><li class="listitem"><p>
            アカウントのパスワード変更で現在のパスワードを指定する必要がない場合、<code class="literal">REPLACE</code> はオプションです。
          </p></li><li class="listitem"><p>
            <code class="literal">REPLACE</code> が指定されている場合は、正しい現在のパスワードを指定する必要があります。そうしないと、エラーが発生します。 これは、<code class="literal">REPLACE</code> がオプションの場合でも当てはまります。 
          </p></li><li class="listitem"><p>
            <code class="literal">REPLACE</code> は、現在のユーザーのアカウントパスワードを変更する場合にのみ指定できます。 (つまり、前述の例では、現在のユーザーが <code class="literal">jeffrey</code> でないかぎり、<code class="literal">jeffrey</code> のアカウントを明示的に指定するステートメントは失敗します。) これは、特権ユーザーが別のユーザーに対して変更を試みた場合でも当てはまりますが、そのようなユーザーは <code class="literal">REPLACE</code> を指定せずに任意のパスワードを変更できます。 
          </p></li><li class="listitem"><p>
            クリアテキストパスワードが書き込まれないように、バイナリログから <code class="literal">REPLACE</code> が省略されています。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="dual-passwords"></a>デュアルパスワードのサポート</h4></div></div></div><a class="indexterm" name="idm46723762291680"></a><a class="indexterm" name="idm46723762289504"></a><a class="indexterm" name="idm46723762288128"></a><a class="indexterm" name="idm46723762286752"></a><p>
        MySQL 8.0.14 の時点では、ユーザーアカウントは、プライマリパスワードおよびセカンダリパスワードとして指定されたデュアルパスワードを持つことができます。 デュアルパスワード機能により、次のようなシナリオで資格証明の変更をシームレスに実行できます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            システムには多数の MySQL サーバーがあり、レプリケーションが含まれる可能性があります。
          </p></li><li class="listitem"><p>
            複数のアプリケーションが異なる MySQL サーバーに接続します。
          </p></li><li class="listitem"><p>
            定期的な資格証明の変更は、アプリケーションがサーバーに接続するために使用するアカウントに対して行う必要があります。
          </p></li></ul></div><p>
        アカウントが単一のパスワードのみを許可されている場合に、前述のタイプのシナリオで資格証明の変更を実行する方法を検討してください。 この場合、アカウントパスワードが変更されてすべてのサーバーに伝播されるタイミング、およびアカウントを使用するすべてのアプリケーションが新しいパスワードを使用するように更新されるタイミングには、緊密な連携が必要です。 このプロセスには、サーバーまたはアプリケーションを使用できない停止時間が含まれる場合があります。 
      </p><p>
        デュアルパスワードを使用すると、資格証明の変更をフェーズでより簡単に行うことができ、密接な連携や停止時間なしで行うことができます:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            影響を受けるアカウントごとに、現在のパスワードをセカンダリパスワードとして保持して、サーバーに新しいプライマリパスワードを設定します。 これにより、サーバーは各アカウントのプライマリパスワードまたはセカンダリパスワードを認識できますが、アプリケーションは以前と同じパスワード (現在はセカンダリパスワード) を使用して引き続きサーバーに接続できます。 
          </p></li><li class="listitem"><p>
            パスワード変更がすべてのサーバーに伝播されたら、影響を受けるアカウントを使用するアプリケーションを変更し、アカウントプライマリパスワードを使用して接続します。
          </p></li><li class="listitem"><p>
            すべてのアプリケーションがセカンダリパスワードからプライマリパスワードに移行されると、セカンダリパスワードは不要になり、破棄できます。 この変更がすべてのサーバーに伝播された後は、各アカウントのプライマリパスワードのみを使用して接続できます。 資格証明の変更が完了しました。 
          </p></li></ol></div><p>
        MySQL には、セカンダリパスワードを保存および破棄する構文を使用したデュアルパスワード機能が実装されています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ALTER USER</code> および <code class="literal">SET PASSWORD</code> ステートメントの <code class="literal">RETAIN CURRENT PASSWORD</code> 句では、新しいプライマリパスワードを割り当てるときに、アカウントの現在のパスワードがセカンダリパスワードとして保存されます。
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER USER</code> の <code class="literal">DISCARD OLD PASSWORD</code> 句では、アカウントセカンダリパスワードが破棄され、プライマリパスワードのみが残されます。
          </p></li></ul></div><p>
        前述の資格証明変更シナリオでは、アプリケーションがサーバーに接続するために<code class="literal">'appuser1'@'host1.example.com'</code>という名前のアカウントを使用し、アカウントパスワードを<code class="literal">'<em class="replaceable"><code>password_a</code></em>'</code>から<code class="literal">'<em class="replaceable"><code>password_b</code></em>'</code>に変更するとします。
      </p><p>
        この資格証明の変更を実行するには、次のように <code class="literal">ALTER USER</code> を使用します:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            レプリカではない各サーバーで、<code class="literal">'<em class="replaceable"><code>password_b</code></em>'</code>を新しい <code class="literal">appuser1</code> プライマリパスワードとして確立し、現在のパスワードをセカンダリパスワードとして保持します:
          </p><pre class="programlisting">ALTER USER 'appuser1'@'host1.example.com'
  IDENTIFIED BY '<em class="replaceable"><code>password_b</code></em>'
  RETAIN CURRENT PASSWORD;
</pre></li><li class="listitem"><p>
            パスワード変更がシステム全体ですべてのレプリカにレプリケートされるのを待ちます。
          </p></li><li class="listitem"><p>
            <code class="literal">'<em class="replaceable"><code>password_a</code></em>'</code>ではなく<code class="literal">'<em class="replaceable"><code>password_b</code></em>'</code>のパスワードを使用してサーバーに接続するように、<code class="literal">appuser1</code> アカウントを使用する各アプリケーションを変更します。
          </p></li><li class="listitem"><p>
            この時点で、セカンダリパスワードは不要になりました。 レプリカではない各サーバーで、セカンダリパスワードを破棄します: 
          </p><pre class="programlisting">ALTER USER 'appuser1'@'host1.example.com'
  DISCARD OLD PASSWORD;
</pre></li><li class="listitem"><p>
            廃棄パスワードの変更がすべてのレプリカにレプリケートされると、資格証明の変更が完了します。
          </p></li></ol></div><p>
        <code class="literal">RETAIN CURRENT PASSWORD</code> 句および <code class="literal">DISCARD OLD PASSWORD</code> 句には、次の効果があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">RETAIN CURRENT PASSWORD</code> は、アカウントの現在のパスワードをセカンダリパスワードとして保持し、既存のセカンダリパスワードを置き換えます。 新しいパスワードはプライマリパスワードになりますが、クライアントはアカウントを使用して、プライマリパスワードまたはセカンダリパスワードのいずれかを使用してサーバーに接続できます。 (例外: <code class="literal">ALTER USER</code> ステートメントまたは <code class="literal">SET PASSWORD</code> ステートメントで指定された新しいパスワードが空の場合、<code class="literal">RETAIN CURRENT PASSWORD</code> が指定されていてもセカンダリパスワードも空になります。) 
          </p></li><li class="listitem"><p>
            プライマリパスワードが空のアカウントに <code class="literal">RETAIN CURRENT PASSWORD</code> を指定すると、ステートメントは失敗します。
          </p></li><li class="listitem"><p>
            アカウントにセカンダリパスワードがあり、<code class="literal">RETAIN CURRENT PASSWORD</code> を指定せずにプライマリパスワードを変更した場合、セカンダリパスワードは変更されません。
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER USER</code> の場合、アカウントに割り当てられた認証プラグインを変更すると、セカンダリパスワードは破棄されます。 認証プラグインを変更し、<code class="literal">RETAIN CURRENT PASSWORD</code> も指定すると、ステートメントは失敗します。 
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER USER</code> では、セカンダリパスワードが存在する場合、<code class="literal">DISCARD OLD PASSWORD</code> は破棄します。 アカウントはプライマリパスワードのみを保持し、クライアントはプライマリパスワードのみを使用してサーバーに接続するためにアカウントを使用できます。 
          </p></li></ul></div><p>
        セカンダリパスワードを変更するステートメントには、次の権限が必要です:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            自分のアカウントに適用される <code class="literal">ALTER USER</code> および <code class="literal">SET PASSWORD</code> ステートメントに <code class="literal">RETAIN CURRENT PASSWORD</code> または <code class="literal">DISCARD OLD PASSWORD</code> 句を使用するには、<code class="literal">APPLICATION_PASSWORD_ADMIN</code> 権限が必要です。 ほとんどのユーザーは 1 つのパスワードのみを必要とするため、自分のセカンダリパスワードを操作するには権限が必要です。 
          </p></li><li class="listitem"><p>
            アカウントがすべてのアカウントのセカンダリパスワードの操作を許可される場合は、<code class="literal">APPLICATION_PASSWORD_ADMIN</code> ではなく <code class="literal">CREATE USER</code> 権限を付与する必要があります。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="random-password-generation"></a>ランダムパスワード生成</h4></div></div></div><p>
        MySQL 8.0.18 では、<code class="literal">CREATE USER</code>、<code class="literal">ALTER USER</code> および <code class="literal">SET PASSWORD</code> ステートメントに、明示的に管理者指定のリテラルパスワードを要求するかわりに、ユーザーアカウントのランダムパスワードを生成する機能があります。 構文の詳細は、各ステートメントの説明を参照してください。 このセクションでは、生成されるランダムパスワードに共通する特性について説明します。 
      </p><p>
        デフォルトでは、生成されるランダムパスワードの長さは 20 文字です。 この長さは、5 から 255 の範囲の <code class="literal">generated_random_password_length</code> システム変数によって制御されます。 
      </p><p>
        ステートメントがランダムなパスワードを生成するアカウントごとに、このステートメントは、アカウント認証プラグイン用に適切にハッシュされたパスワードを <code class="literal">mysql.user</code> システムテーブルに格納します。 このステートメントは、ステートメントを実行するユーザーまたはアプリケーションが使用できるように、結果セットの行にクリアテキストのパスワードも返します。 結果セットカラムの名前は <code class="literal">user</code>、<code class="literal">host</code> および <code class="literal">generated password</code> で、<code class="literal">mysql.user</code> システムテーブルの影響を受ける行を識別するユーザー名とホスト名の値、およびクリアテキストで生成されたパスワードを示します。 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER</code></strong>
       <strong class="userinput"><code>'u1'@'localhost' IDENTIFIED BY RANDOM PASSWORD,</code></strong>
       <strong class="userinput"><code>'u2'@'%.example.com' IDENTIFIED BY RANDOM PASSWORD,</code></strong>
       <strong class="userinput"><code>'u3'@'%.org' IDENTIFIED BY RANDOM PASSWORD;</code></strong>
+------+---------------+----------------------+
| user | host          | generated password   |
+------+---------------+----------------------+
| u1   | localhost     | BA;42VpXqQ@i+y{&amp;TDFF |
| u2   | %.example.com | YX5&gt;XRAJRP@&gt;sn9azmD4 |
| u3   | %.org         | ;GfD44l,)C}PI/6)4TwZ |
+------+---------------+----------------------+
mysql&gt; <strong class="userinput"><code>ALTER USER</code></strong>
       <strong class="userinput"><code>'u1'@'localhost' IDENTIFIED BY RANDOM PASSWORD,</code></strong>
       <strong class="userinput"><code>'u2'@'%.example.com' IDENTIFIED BY RANDOM PASSWORD;</code></strong>
+------+---------------+----------------------+
| user | host          | generated password   |
+------+---------------+----------------------+
| u1   | localhost     | yhXBrBp.;Y6abB)e_UWr |
| u2   | %.example.com | &gt;M-vmjp9DTY6}hkp,RcC |
+------+---------------+----------------------+
mysql&gt; <strong class="userinput"><code>SET PASSWORD FOR 'u3'@'%.org' TO RANDOM;</code></strong>
+------+-------+----------------------+
| user | host  | generated password   |
+------+-------+----------------------+
| u3   | %.org | o(._oNn)d;FC&lt;vJIDg9M |
+------+-------+----------------------+
</pre><p>
        アカウントのランダムパスワードを生成する <code class="literal">CREATE USER</code>、<code class="literal">ALTER USER</code> または <code class="literal">SET PASSWORD</code> ステートメントは、<code class="literal">IDENTIFIED WITH <em class="replaceable"><code>auth_plugin</code></em> AS '<em class="replaceable"><code>auth_string</code></em>'</code>句を含む <code class="literal">CREATE USER</code> または <code class="literal">ALTER USER</code> ステートメントとしてバイナリログに書き込まれます。<em class="replaceable"><code>auth_plugin</code></em> はアカウント認証プラグインで、<code class="literal">'<em class="replaceable"><code>auth_string</code></em>'</code>はアカウントのハッシュパスワード値です。
      </p><p>
        <code class="literal">validate_password</code> コンポーネントがインストールされている場合、実装されているポリシーは生成されたパスワードに影響しません。 (パスワード検証の目的は、人間がより適切なパスワードを作成できるようにすることです。) 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="failed-login-tracking"></a>失敗したログイントラッキングと一時アカウントロック</h4></div></div></div><p>
        MySQL 8.0.19 の時点では、管理者は、連続するログイン失敗が多すぎると一時アカウントロックが発生するようにユーザーアカウントを構成できます。
      </p><p>
        このコンテキストの<span class="quote">「<span class="quote">「ログイン失敗」</span>」</span>は、接続試行中にクライアントが正しいパスワードを指定できないことを意味します。 不明なユーザーまたはネットワークの問題などの理由で接続に失敗することは含まれません。 デュアルパスワードを持つアカウント (<a class="xref" href="security.html#dual-passwords" title="デュアルパスワードのサポート">デュアルパスワードのサポート</a> を参照) の場合、どちらのアカウントパスワードも正しいものとしてカウントされます。 
      </p><p>
        必要なログイン失敗の数とロック時間は、<code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> ステートメントの <code class="literal">FAILED_LOGIN_ATTEMPTS</code> および <code class="literal">PASSWORD_LOCK_TIME</code> オプションを使用してアカウントごとに構成できます。 例: 
      </p><pre class="programlisting">CREATE USER 'u1'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>'
  FAILED_LOGIN_ATTEMPTS 3 PASSWORD_LOCK_TIME 3;

ALTER USER 'u2'@'localhost'
  FAILED_LOGIN_ATTEMPTS 4 PASSWORD_LOCK_TIME UNBOUNDED;
</pre><p>
        連続したログイン失敗が多すぎる場合、クライアントは次のようなエラーを受け取ります:
      </p><pre class="programlisting">ERROR 3957 (HY000): Access denied for user <em class="replaceable"><code>user</code></em>.
Account is blocked for <em class="replaceable"><code>D</code></em> day(s) (<em class="replaceable"><code>R</code></em> day(s) remaining)
due to <em class="replaceable"><code>N</code></em> consecutive failed logins.
</pre><p>
        次のオプションを使用します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">FAILED_LOGIN_ATTEMPTS <em class="replaceable"><code>N</code></em></code>
          </p><p>
            このオプションは、不正なパスワードを指定するアカウントログイン試行を追跡するかどうかを示します。 <em class="replaceable"><code>N</code></em> の数には、一時的なアカウントロックを引き起こす連続した不正なパスワードの数を指定します。 
          </p></li><li class="listitem"><p>
            <code class="literal">PASSWORD_LOCK_TIME {<em class="replaceable"><code>N</code></em> | UNBOUNDED}</code>
          </p><p>
            このオプションは、連続して何回もログインしようとすると間違ったパスワードが提供された後に、アカウントをロックする期間を示します。 値は、アカウントがロックされたままになる日数を指定する <em class="replaceable"><code>N</code></em> の数値、またはアカウントが一時的にロックされた状態になるとその状態の期間が無制限になり、アカウントがロック解除されるまで終了しないことを指定する <code class="literal">UNBOUNDED</code> です。 ロック解除が行われる条件については、後で説明します。 
          </p></li></ul></div><p>
        各オプションに許可される <em class="replaceable"><code>N</code></em> の値は、0 から 32767 の範囲です。 値 0 を指定すると、オプションが無効になります。 
      </p><p>
        ログイン失敗トラッキングと一時アカウントロックには、次の特性があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            失敗したログイン追跡および一時ロックをアカウントに対して実行するには、その <code class="literal">FAILED_LOGIN_ATTEMPTS</code> オプションと <code class="literal">PASSWORD_LOCK_TIME</code> オプションの両方をゼロ以外にする必要があります。
          </p></li><li class="listitem"><p>
            <code class="literal">CREATE USER</code> では、<code class="literal">FAILED_LOGIN_ATTEMPTS</code> または <code class="literal">PASSWORD_LOCK_TIME</code> が指定されていない場合、ステートメントで指定されたすべてのアカウントの暗黙的なデフォルト値は 0 です。 これは、失敗したログイントラッキングおよび一時アカウントロックが無効であることを意味します。 (これらの暗黙的なデフォルトは、失敗したログイン追跡の導入前に作成されたアカウントにも適用されます。) 
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER USER</code> では、<code class="literal">FAILED_LOGIN_ATTEMPTS</code> または <code class="literal">PASSWORD_LOCK_TIME</code> が指定されていない場合、ステートメントで指定されたすべてのアカウントの値は変更されません。
          </p></li><li class="listitem"><p>
            一時アカウントロックを実行するには、パスワード障害が連続して発生する必要があります。 失敗したログインの <code class="literal">FAILED_LOGIN_ATTEMPTS</code> 値に達する前に正常にログインすると、失敗カウントがリセットされます。 たとえば、<code class="literal">FAILED_LOGIN_ATTEMPTS</code> が 4 で、3 つの連続したパスワード障害が発生した場合、ロックを開始するにはさらに障害が発生する必要があります。 ただし、次回のログインが成功した場合は、ロックに 4 つの連続した失敗が再度必要になるように、アカウントの失敗ログインカウントがリセットされます。 
          </p></li><li class="listitem"><p>
            一時ロックが開始されると、ロック期間が経過するか、次の説明に示す account-reset メソッドのいずれかによってアカウントのロックが解除されるまで、正しいパスワードを使用してもログインは成功しません。
          </p></li></ul></div><p>
        サーバーは、付与テーブルを読み取るときに、失敗したログイン追跡が有効かどうか、現在アカウントが一時的にロックされているかどうか、ロックが開始された場合はロックが開始された場合、およびアカウントがロックされていない場合に一時的なロックが発生するまでの失敗数に関する状態情報をアカウントごとに初期化します。
      </p><p>
        アカウント状態情報をリセットできます。つまり、失敗したログイン数がリセットされ、アカウントが現在一時的にロックされている場合はロック解除されます。 アカウントのリセットは、すべてのアカウントに対してグローバルにすることも、アカウントごとに行うこともできます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            すべてのアカウントのグローバルリセットは、次のいずれかの状況で発生します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                サーバーの再起動。
              </p></li><li class="listitem"><p>
                <code class="literal">FLUSH PRIVILEGES</code> の実行。 (<code class="option">--skip-grant-tables</code> を使用してサーバーを起動すると、付与テーブルが読み取られず、失敗したログイン追跡が無効になります。 この場合、<code class="literal">FLUSH PRIVILEGES</code> を最初に実行すると、すべてのアカウントのリセットに加えて、サーバーが付与テーブルを読み取り、失敗したログイン追跡を有効にします。) 
              </p></li></ul></div></li><li class="listitem"><p>
            アカウントごとのリセットは、次のいずれかの状況で発生します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                アカウントのログインに成功しました。
              </p></li><li class="listitem"><p>
                ロック期間が経過します。 この場合、ログイン失敗回数は次回のログイン試行時にリセットされます。 
              </p></li><li class="listitem"><p>
                <code class="literal">FAILED_LOGIN_ATTEMPTS</code> または <code class="literal">PASSWORD_LOCK_TIME</code> (あるいはその両方) を任意の値 (現在のオプション値を含む) に設定するアカウントに対する <code class="literal">ALTER USER</code> ステートメントの実行、またはアカウントに対する <code class="literal">ALTER USER ... UNLOCK</code> ステートメントの実行。
              </p><p>
                アカウントの他の <code class="literal">ALTER USER</code> ステートメントは、現在の失敗ログイン数またはロック状態には影響しません。
              </p></li></ul></div></li></ul></div><p>
        失敗したログイントラッキングは、資格証明のチェックに使用されるログインアカウントに関連付けられます。 ユーザープロキシが使用されている場合、プロキシユーザーではなくプロキシユーザーに対してトラッキングが行われます。 つまり、トラッキングは、<code class="literal">CURRENT_USER()</code> で示されるアカウントではなく、<code class="literal">USER()</code> で示されるアカウントに関連付けられます。 プロキシユーザーとプロキシユーザーの区別の詳細は、<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照してください。 
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expired-password-handling"></a>6.2.16 期限切れパスワードのサーバー処理</h3></div></div></div><a class="indexterm" name="idm46723762123712"></a><a class="indexterm" name="idm46723762122304"></a><a class="indexterm" name="idm46723762120640"></a><a class="indexterm" name="idm46723762118496"></a><p>
      MySQL にはパスワードの有効期限機能が用意されており、データベース管理者はパスワードのリセットをユーザーに要求できます。 パスワードは手動で期限切れにすることも、自動期限切れのポリシーに基づいて期限切れにすることもできます (<a class="xref" href="security.html#password-management" title="6.2.15 パスワード管理">セクション6.2.15「パスワード管理」</a> を参照)。 
    </p><p>
      <code class="literal">ALTER USER</code> ステートメントは、アカウントパスワードの有効期限を有効にします。 例: 
    </p><pre class="programlisting">ALTER USER 'myuser'@'localhost' PASSWORD EXPIRE;
</pre><p>
      期限切れのパスワードを持つアカウントを使用する接続ごとに、サーバーはクライアントを切断するか、クライアントを<span class="quote">「<span class="quote">「サンドボックスモード、」</span>」</span>に制限します。<span class="quote">「<span class="quote">「サンドボックスモード、」</span>」</span>では、クライアントは期限切れのパスワードのリセットに必要な操作のみを実行できます。 サーバーによって実行されるアクションは、後で説明するように、クライアントとサーバーの両方の設定によって異なります。 
    </p><p>
      サーバーがクライアントを切断すると、<code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code> エラーが返されます。
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u myuser -p</code></strong>
Password: <strong class="userinput"><code>******</code></strong>
ERROR 1862 (HY000): Your password has expired. To log in you must
change it using a client that supports expired passwords.
</pre><p>
      サーバーがクライアントをサンドボックスモードに制限する場合、クライアントセッション内では次の操作が許可されます:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          クライアントは、<code class="literal">ALTER USER</code> または <code class="literal">SET PASSWORD</code> を使用してアカウントパスワードをリセットできます。 これが完了すると、サーバーはセッションおよびアカウントを使用する後続の接続の通常のアクセスをリストアします。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            期限切れのパスワードは、現在の値に設定することで <span class="quote">「<span class="quote">reset</span>」</span> で使用できますが、適切なポリシーとして、別のパスワードを選択することをお薦めします。 DBA は、適切なパスワード再利用ポリシーを確立することで、非キューを強制できます。 <a class="xref" href="security.html#password-reuse-policy" title="パスワード再利用ポリシー">パスワード再利用ポリシー</a>を参照してください。 
          </p></div></li><li class="listitem"><p>
          クライアントは <code class="literal">SET</code> ステートメントを使用できます。
        </p></li></ul></div><p>
      セッション内で許可されていない操作の場合、サーバーは <code class="literal">ER_MUST_CHANGE_PASSWORD</code> エラーを返します。
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>USE performance_schema;</code></strong>
ERROR 1820 (HY000): You must reset your password using ALTER USER
statement before executing this statement.

mysql&gt; <strong class="userinput"><code>SELECT 1;</code></strong>
ERROR 1820 (HY000): You must reset your password using ALTER USER
statement before executing this statement.
</pre><p>
      このような呼出しはデフォルトでサンドボックスモードになるため、通常は <span class="command"><strong>mysql</strong></span> クライアントの対話型呼出しで行われます。 通常の機能を再開するには、新しいパスワードを選択します。 
    </p><p>
      <span class="command"><strong>mysql</strong></span> クライアントの非対話型呼出し (バッチモードなど) の場合、パスワードが期限切れになると、サーバーは通常クライアントを切断します。 (サンドボックスモードで許可されたステートメントを使用して) パスワードを変更できるように、非対話型の <span class="command"><strong>mysql</strong></span> 呼出しが接続されたままになるようにするには、<span class="command"><strong>mysql</strong></span> コマンドに <code class="option">--connect-expired-password</code> オプションを追加します。 
    </p><p>
      前述のように、サーバーが期限切れパスワードクライアントを切断するか、サンドボックスモードに制限するかは、クライアントとサーバーの設定の組合せによって決まります。 次の説明では、関連する設定と、それらがどのように相互作用するのかについて記述します。 
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        この説明は、パスワードが期限切れのアカウントにのみ適用されます。 クライアントが期限切れでないパスワードを使用して接続すれば、サーバーはクライアントを通常どおりに処理します。 
      </p></div><p>
      クライアント側では、特定のクライアントが期限切れパスワードに対してサンドボックスモードを処理できるかどうかを示します。 C クライアントライブラリを使用するクライアントの場合、これを実行するための方法が 2 つあります。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          接続前に <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> フラグを <code class="literal">mysql_options()</code> に渡します。
        </p><pre class="programlisting">bool arg = 1;
mysql_options(mysql,
              MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS,
              &amp;arg);
</pre><p>
          これは <span class="command"><strong>mysql</strong></span> クライアント内で使用される手法であり、対話形式または <code class="option">--connect-expired-password</code> オプションを使用して <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> を呼び出すことができます。
        </p></li><li class="listitem"><p>
          接続時に <code class="literal">CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS</code> フラグを <code class="literal">mysql_real_connect()</code> に渡します:
        </p><pre class="programlisting">MYSQL mysql;
mysql_init(&amp;mysql);
if (!mysql_real_connect(&amp;mysql,
                        host, user, password, db,
                        port, unix_socket,
                        CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS))
{
  ... handle error ...
}
</pre></li></ul></div><p>
      その他の MySQL コネクタには、サンドボックスモードを処理する準備ができていることを示す独自の規則が用意されています。 目的のコネクタのドキュメントを参照してください。 
    </p><p>
      サーバー側では、クライアントが期限切れパスワードを処理できることを示している場合、サーバーはサンドボックスモードに移行します。
    </p><p>
      クライアントが期限切れパスワードを処理できることを示していない場合 (または、そのように示すことができない古いバージョンのクライアントライブラリを使用している場合)、サーバーのアクションは <code class="literal">disconnect_on_expired_password</code> システム変数の値によって異なります。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">disconnect_on_expired_password</code> が有効になっている (デフォルト) 場合、サーバーはクライアントを切断し、<code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code> エラーを返します。
        </p></li><li class="listitem"><p>
          <code class="literal">disconnect_on_expired_password</code> が無効になっている場合、サーバーはクライアントをサンドボックスモードに移行します。
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="pluggable-authentication"></a>6.2.17 プラガブル認証</h3></div></div></div><p>
      クライアントが MySQL サーバーに接続すると、サーバーはクライアントおよびクライアントホストによって指定されたユーザー名を使用して、<code class="literal">mysql.user</code> システムテーブルから適切なアカウント行を選択します。 次に、サーバーはクライアントを認証し、どの認証プラグインがクライアントに適用されるかをアカウント行から決定します: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーがプラグインを検出できない場合は、エラーが発生し、接続の試行は拒否されます。
        </p></li><li class="listitem"><p>
          それ以外の場合、サーバーはそのプラグインを呼び出してユーザーを認証し、ユーザーが正しいパスワードを指定して接続を許可されているかどうかを示すステータスをサーバーに返します。
        </p></li></ul></div><p>
      プラガブル認証により、次の重要な機能が有効になります:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b>認証方式の選択. </b>
            プラガブル認証を使用すると、DBA は個々の MySQL アカウントに使用される認証方式を簡単に選択および変更できます。
          </p></li><li class="listitem"><p><b>外部認証. </b>
            プラガブル認証を使用すると、クライアントは、<code class="literal">mysql.user</code> システムテーブル以外の場所に資格証明を格納する認証方法に適した資格証明を使用して MySQL サーバーに接続できます。 たとえば、PAM、Windows のログイン ID、LDAP、Kerberos などの外部認証方式を使用するプラグインを作成できます。 
          </p></li><li class="listitem"><p><b>プロキシユーザー: </b>
            ユーザーが接続を許可されている場合、認証プラグインは接続ユーザーの名前とは異なるユーザー名をサーバーに返して、接続ユーザーが別のユーザー (プロキシユーザー) のプロキシであることを示すことができます。 接続が継続している間、プロキシユーザーはアクセス制御のためにプロキシユーザーの権限を持つものとして扱われます。 実際に、あるユーザーは別のユーザーを偽装します。 詳細については、<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください。 
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        <code class="option">--skip-grant-tables</code> オプションを付けてサーバーを起動した場合、サーバーはクライアント認証を実行せず、任意のクライアントが接続することを許可するため、認証プラグインはロードされたとしても使用されません。 これはセキュアではないため、<code class="option">--skip-grant-tables</code> オプションを使用してサーバーを起動すると、<code class="literal">skip_networking</code> を有効にしてリモート接続も無効になります。 
      </p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-available-plugins" title="使用可能な認証プラグイン">使用可能な認証プラグイン</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-usage" title="認証プラグインの使用">認証プラグインの使用</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-compatibility" title="認証プラグインクライアント/サーバーの互換性">認証プラグインクライアント/サーバーの互換性</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-connector-writing" title="認証プラグインコネクタ - 書込みに関する考慮事項">認証プラグインコネクタ - 書込みに関する考慮事項</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-restrictions" title="プラガブルな認証の制約">プラガブルな認証の制約</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="pluggable-authentication-available-plugins"></a>使用可能な認証プラグイン</h4></div></div></div><p>
        MySQL 8.0 には次の認証プラグインが用意されています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            ネイティブ認証を実行するプラグイン。つまり、MySQL でプラガブル認証が導入される前から使用されているパスワードハッシュ方式に基づく認証です。 <code class="literal">mysql_native_password</code> プラグインは、このネイティブパスワードハッシュ方式に基づいて認証を実装します。 <a class="xref" href="security.html#native-pluggable-authentication" title="6.4.1.1 ネイティブプラガブル認証">セクション6.4.1.1「ネイティブプラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            SHA-256 パスワードハッシュを使用して認証を実行するプラグイン。 これは、ネイティブ認証で実現できるよりも強力な暗号化です。 <a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.3 SHA-256 プラガブル認証">セクション6.4.1.3「SHA-256 プラガブル認証」</a>および<a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.2 SHA-2 プラガブル認証のキャッシュ">セクション6.4.1.2「SHA-2 プラガブル認証のキャッシュ」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            ハッシュ化または暗号化を行わずに、サーバーにパスワードを送信するクライアント側のプラグイン。 このプラグインは、クライアントユーザーが指定したパスワードに正確にアクセスする必要があるサーバー側プラグインと組み合わせて使用されます。 <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 クライアント側クリアテキストプラガブル認証">セクション6.4.1.4「クライアント側クリアテキストプラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            PAM (Pluggable Authentication Modules) を使用して外部認証を実行し、MySQL Server が PAM を使用して MySQL ユーザーを認証できるようにするプラグイン。 このプラグインでは、プロキシユーザーもサポートされています。 <a class="xref" href="security.html#pam-pluggable-authentication" title="6.4.1.5 PAM プラガブル認証">セクション6.4.1.5「PAM プラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            Windows で外部認証を実行するプラグイン。これを使用すると、MySQL サーバーがネイティブの Windows サービスを使用して、クライアント接続を認証できます。 Windows にログインしたユーザーは、追加のパスワードを指定せずに、自分の環境内の情報に基づいて MySQL クライアントプログラムからサーバーに接続できます。 このプラグインでは、プロキシユーザーもサポートされています。 <a class="xref" href="security.html#windows-pluggable-authentication" title="6.4.1.6 Windows プラガブル認証">セクション6.4.1.6「Windows プラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            LDAP (Lightweight Directory Access Protocol) を使用して認証を実行し、X.500 などのディレクトリサービスにアクセスして MySQL ユーザーを認証するプラグイン。 これらのプラグインは、プロキシユーザーもサポートしています。 <a class="xref" href="security.html#ldap-pluggable-authentication" title="6.4.1.7 LDAP プラガブル認証">セクション6.4.1.7「LDAP プラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            それを使用するアカウントへのすべてのクライアント接続を妨げるプラグイン。 このプラグインのユースケースには、直接ログインを許可しないが、通常のユーザーに権限を公開せずに昇格された権限を持つストアドプログラムおよびビューを実行できる必要があるプロキシアカウントおよびアカウントを介してのみアクセスされるプロキシアカウントが含まれます。 <a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 ログインなしのプラガブル認証">セクション6.4.1.8「ログインなしのプラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            Unix ソケットファイルを使用してローカルホストから接続するクライアントを認証するプラグイン。 <a class="xref" href="security.html#socket-pluggable-authentication" title="6.4.1.9 ソケットピア資格証明プラガブル認証">セクション6.4.1.9「ソケットピア資格証明プラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            アカウント資格証明をチェックし、成功または失敗をサーバーエラーログに記録するテストプラグイン。 このプラグインは、テストおよび開発のために、認証プラグインを作成する方法を示す例として使用されます。 <a class="xref" href="security.html#test-pluggable-authentication" title="6.4.1.10 プラガブル認証のテスト">セクション6.4.1.10「プラガブル認証のテスト」</a>を参照してください。 
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          プラガブル認証の使用に対する現在の制約 (どのコネクタがどのプラグインをサポートしているのかなど) については、<a class="xref" href="security.html#pluggable-authentication-restrictions" title="プラガブルな認証の制約">プラガブルな認証の制約</a>を参照してください。
        </p><p>
          サードパーティー製コネクタの開発者は、コネクタがプラガブル認証機能を活用できる範囲と、より準拠させるために実行する手順を確認するために、そのセクションを読むべきです。
        </p></div><p>
        独自の認証プラグインを作成することに関心がある場合は、<a class="ulink" href="https://dev.mysql.com/doc/extending-mysql/8.0/en/writing-authentication-plugins.html" target="_top">Writing Authentication Plugins</a>を参照してください。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="pluggable-authentication-usage"></a>認証プラグインの使用</h4></div></div></div><p>
        このセクションでは、認証プラグインをインストールおよび使用するための一般的な手順を示します。 特定のプラグインに固有の手順については、<a class="xref" href="security.html#authentication-plugins" title="6.4.1 認証プラグイン">セクション6.4.1「認証プラグイン」</a> でそのプラグインについて説明しているセクションを参照してください。 
      </p><p>
        通常、プラガブル認証では、サーバー側とクライアント側で対応するプラグインのペアが使用されるため、次のような特定の認証方法を使用します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            必要に応じて、適切なプラグインを含むプラグインライブラリをインストールします。 サーバーがサーバーホストを使用してクライアント接続を認証できるように、サーバー側プラグインを含むライブラリをインストールします。 同様に、クライアントホストごとに、クライアントプログラムで使用するクライアント側プラグインを含むライブラリをインストールします。 組込みの認証プラグインをインストールする必要はありません。 
          </p></li><li class="listitem"><p>
            作成する MySQL アカウントごとに、認証に使用する適切なサーバー側プラグインを指定します。 アカウントがデフォルトの認証プラグインを使用する場合、account-creation ステートメントでプラグインを明示的に指定する必要はありません。 <code class="literal">default_authentication_plugin</code> システム変数は、デフォルトの認証プラグインを構成します。 
          </p></li><li class="listitem"><p>
            クライアントが接続すると、サーバー側プラグインはクライアントプログラムに認証に使用するクライアント側プラグインを通知します。
          </p></li></ul></div><p>
        アカウントがサーバーとクライアントプログラムの両方のデフォルトの認証方式を使用している場合、サーバーはクライアント側のプラグインが使用するクライアントと通信する必要はなく、クライアント/サーバーのネゴシエーションでラウンドトリップを回避できます。
      </p><p>
        <span class="command"><strong>mysql</strong></span> や <span class="command"><strong>mysqladmin</strong></span> などの標準 MySQL クライアントの場合、<code class="option">--default-auth=<em class="replaceable"><code>plugin_name</code></em></code> オプションは、プログラムが使用できるクライアント側プラグインに関するヒントとしてコマンド行で指定できますが、ユーザーアカウントに関連付けられたサーバー側プラグインが異なるクライアント側プラグインを必要とする場合、サーバーはこれをオーバーライドします。
      </p><p>
        クライアントプログラムがクライアント側プラグインライブラリファイルを見つけられない場合は、プラグインライブラリディレクトリの場所を示す <code class="option">--plugin-dir=<em class="replaceable"><code>dir_name</code></em></code> オプションを指定します。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="pluggable-authentication-compatibility"></a>認証プラグインクライアント/サーバーの互換性</h4></div></div></div><a class="indexterm" name="idm46723761994080"></a><p>
        プラガブル認証を使用すると、MySQL アカウントの認証方式を柔軟に選択できますが、クライアントとサーバー間の認証プラグインの非互換性のためにクライアント接続を確立できない場合があります。
      </p><p>
        特定のサーバー上の特定のアカウントへのクライアント接続を成功させるための一般的な互換性の原則は、クライアントとサーバーの両方がアカウントに必要な認証 <span class="emphasis"><em>method</em></span> をサポートしている必要があることです。 認証方式は認証プラグインによって実装されるため、クライアントとサーバーは両方ともアカウントに必要な認証 <span class="emphasis"><em>plugin</em></span> をサポートする必要があります。 
      </p><p>
        認証プラグインの非互換性は様々な方法で発生する可能性があります。 例: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            5.7.22 以下の MySQL 5.7 クライアントを使用して、<code class="literal">caching_sha2_password</code> で認証される MySQL 8.0 サーバーアカウントに接続します。 MySQL 8.0 で導入されたプラグインが 5.7 クライアントで認識されないため、これは失敗します。 (この問題は、<code class="literal">caching_sha2_password</code> クライアント側サポートが MySQL クライアントライブラリおよびクライアントプログラムに追加されたときに、5.7.23 の時点で MySQL 5.7 で対処されます。) 
          </p></li><li class="listitem"><p>
            MySQL 5.5 クライアントを使用して、<code class="literal">sha256_password</code> で認証される MySQL 5.6 サーバーアカウントに接続します。 MySQL 5.6 で導入されたプラグインが 5.5 クライアントで認識されないため、これは失敗します。 
          </p></li><li class="listitem"><p>
            MySQL 5.7 クライアントを使用して、<code class="literal">mysql_old_password</code> で認証する 5.7 より前のサーバーアカウントに接続します。 これは、複数の理由で失敗します。 まず、このような接続には <code class="option">--secure-auth=0</code> が必要ですが、これはサポートされなくなりました。 サポートされていても、5.7 クライアントは MySQL 5.7 で削除されたため、プラグインを認識しません。 
          </p></li><li class="listitem"><p>
            Community ディストリビューションの MySQL 5.7 クライアントを使用して、エンタープライズ専用 LDAP 認証プラグインのいずれかを使用して認証する MySQL 5.7 Enterprise サーバーアカウントに接続します。 Community クライアントに Enterprise プラグインへのアクセス権がないため、これは失敗します。 
          </p></li></ul></div><p>
        一般に、これらの互換性の問題は、同じ MySQL ディストリビューションのクライアントとサーバー間で接続が確立された場合には発生しません。 異なる MySQL シリーズのクライアントとサーバーの間で接続が行われると、問題が発生する可能性があります。 これらの問題は、MySQL で新しい認証プラグインが導入されたとき、または古い認証プラグインが削除されたときに、開発プロセスに固有です。 非互換性の可能性を最小限に抑えるには、サーバー、クライアントおよびコネクタを適時に定期的にアップグレードします。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="pluggable-authentication-connector-writing"></a>認証プラグインコネクタ - 書込みに関する考慮事項</h4></div></div></div><a class="indexterm" name="idm46723761975216"></a><p>
        MySQL クライアント/サーバープロトコルの様々な実装が存在します。 <code class="literal">libmysqlclient</code> C API クライアントライブラリは実装の一例です。 一部の MySQL コネクタ (通常は C で記述されていないコネクタ) では、独自の実装が提供されます。 ただし、すべてのプロトコル実装が同じ方法でプラグイン認証を処理するわけではありません。 このセクションでは、プロトコル実装者が考慮する必要がある認証の問題について説明します。 
      </p><p>
        クライアント/サーバープロトコルでは、サーバーはデフォルトとみなす認証プラグインをクライアントに接続するように指示します。 クライアントが使用するプロトコル実装がデフォルトのプラグインをロードしようとし、そのプラグインがクライアント側に存在しない場合、ロード操作は失敗します。 これは、デフォルトのプラグインが、クライアントが接続しようとしているアカウントに実際に必要なプラグインではない場合、不要な障害です。 
      </p><p>
        クライアント/サーバープロトコルの実装にデフォルトの認証プラグインの独自の概念がなく、サーバーによって指定されたデフォルトのプラグインを常にロードしようとすると、そのプラグインが使用できない場合はエラーで失敗します。
      </p><p>
        この問題を回避するには、クライアントで使用されるプロトコル実装に独自のデフォルトプラグインがあり、最初の選択肢として使用する必要があります (または、サーバーで指定されたデフォルトプラグインのロードに失敗した場合は、このデフォルトにフォールバックします)。 例: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL 5.7 では、<code class="literal">libmysqlclient</code> は <code class="literal">mysql_native_password</code> または <code class="literal">mysql_options()</code> の <code class="literal">MYSQL_DEFAULT_AUTH</code> オプションで指定されたプラグインのいずれかをデフォルトの選択として使用します。
          </p></li><li class="listitem"><p>
            5.7 クライアントが 8.0 サーバーに接続しようとすると、サーバーは <code class="literal">caching_sha2_password</code> をデフォルトの認証プラグインとして指定しますが、クライアントは <code class="literal">mysql_native_password</code> または <code class="literal">MYSQL_DEFAULT_AUTH</code> を介して指定された資格証明の詳細を送信します。
          </p></li><li class="listitem"><p>
            クライアントがサーバーによって指定されたプラグインをロードするのは変更プラグインリクエストの場合のみですが、その場合はユーザーアカウントに応じて任意のプラグインを使用できます。 この場合、クライアントはプラグインのロードを試みる必要があり、そのプラグインが使用できない場合、エラーはオプションではありません。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="pluggable-authentication-restrictions"></a>プラガブルな認証の制約</h4></div></div></div><a class="indexterm" name="idm46723761955776"></a><a class="indexterm" name="idm46723761953600"></a><p>
        このセクションの最初の部分では、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>で説明しているプラガブルな認証フレームワークの適用基準に関する一般的な制約について説明します。 2 番目の部分では、サードパーティーコネクタ開発者が、コネクタがプラガブルな認証機能を利用できる範囲と、対応性を高めるために行うステップについて判断する方法について説明します。 
      </p><p>
        ここで使用する<span class="quote">「<span class="quote">「ネイティブ認証」</span>」</span>という用語は、<code class="literal">mysql.user</code> システムテーブルに格納されているパスワードに対する認証を指します。 これは、プラガブルな認証が実装される前に古い MySQL Server で提供されていたものと同じ認証方法です。 <span class="quote">「<span class="quote">Windows ネイティブ認証</span>」</span>とは、Windows ネイティブ認証プラグイン (<span class="quote">「<span class="quote">Windows プラグイン</span>」</span>と略します) で実装された、すでに Windows にログインしているユーザーの資格証明を使用した認証を示します。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-restrictions-general" title="一般的なプラガブルな認証の制約">一般的なプラガブルな認証の制約</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-restrictions-third-party-connectors" title="プラガブルな認証とサードパーティーコネクタ">プラガブルな認証とサードパーティーコネクタ</a></p></li></ul></div><h5><a name="pluggable-authentication-restrictions-general"></a>一般的なプラガブルな認証の制約</h5><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="bold"><strong>Connector/C++:</strong></span> このコネクタを使用するクライアントは、ネイティブ認証を使用するアカウントを介してのみサーバーに接続できます。
          </p><p>
            例外: コネクタは、<code class="literal">libmysqlclient</code> に (静的ではなく) 動的にリンクするように構築された場合にプラガブルな認証をサポートし、最新バージョンの <code class="literal">libmysqlclient</code> がインストールされている場合、またはコネクタが最新の <code class="literal">libmysqlclient</code> に対してリンクするようにソースから再コンパイルされている場合にそのバージョンをロードします。
          </p><p>
            サーバーからのデフォルトのサーバー側認証プラグインに関する情報を処理するコネクタの記述については、<a class="xref" href="security.html#pluggable-authentication-connector-writing" title="認証プラグインコネクタ - 書込みに関する考慮事項">認証プラグインコネクタ - 書込みに関する考慮事項</a> を参照してください。
          </p></li><li class="listitem"><p>
            <span class="bold"><strong>Connector/NET:</strong></span> Connector/NET を使用するクライアントは、ネイティブ認証または Windows ネイティブ認証を使用するアカウントを介してサーバーに接続できます。
          </p></li><li class="listitem"><p>
            <span class="bold"><strong>Connector/PHP:</strong></span> このコネクタを使用するクライアントは、PHP 用の MySQL ネイティブドライバ (<code class="literal">mysqlnd</code>) を使用してコンパイルされている場合、ネイティブ認証を使用するアカウントを通じてのみサーバーに接続できます。
          </p></li><li class="listitem"><p>
            <span class="bold"><strong>Windows ネイティブ認証:</strong></span> Windows プラグインを使用するアカウントを通じた接続は、Windows Domain セットアップを必要とします。 これがない場合、NTLM 認証が使用され、ローカル接続だけが可能になります。つまり、クライアントとサーバーを同じコンピュータ上で実行する必要があります。 
          </p></li><li class="listitem"><p>
            <span class="bold"><strong>プロキシユーザー:</strong></span> プロキシユーザーサポートは、プロキシユーザー機能を実装するプラグイン (つまり、接続しているユーザーの名前と異なるユーザー名を返す場合があるプラグイン) で認証されたアカウントを通じて、クライアントが接続できる範囲まで利用できます。 たとえば、PAM および Windows プラグインはプロキシユーザーをサポートしています。 <code class="literal">mysql_native_password</code> および <code class="literal">sha256_password</code> 認証プラグインは、デフォルトではプロキシユーザーをサポートしていませんが、これを行うように構成できます。<a class="xref" href="security.html#proxy-users-server-user-mapping" title="プロキシユーザーマッピングのサーバーサポート">プロキシユーザーマッピングのサーバーサポート</a> を参照してください。 
          </p></li><li class="listitem"><p>
            <span class="bold"><strong>レプリケーション</strong></span>: レプリカは、ネイティブ認証を使用してレプリケーションユーザーアカウントを採用するだけでなく、必要なクライアント側プラグインが使用可能な場合は、非ネイティブ認証を使用するレプリケーションユーザーアカウントを介して接続することもできます。 プラグインは、<code class="literal">libmysqlclient</code> に組み込まれている場合、デフォルトで利用できます。 それ以外の場合は、レプリカ <code class="literal">plugin_dir</code> システム変数で指定されたディレクトリのレプリカ側にプラグインをインストールする必要があります。 
          </p></li><li class="listitem"><p>
            <span class="bold"><strong><code class="literal">FEDERATED</code> テーブル:</strong></span> <code class="literal">FEDERATED</code> テーブルは、ネイティブ認証を使用するリモートサーバー上のアカウントを通じてのみリモートテーブルにアクセスできます。
          </p></li></ul></div><h5><a name="pluggable-authentication-restrictions-third-party-connectors"></a>プラガブルな認証とサードパーティーコネクタ</h5><p>
        サードパーティーコネクタ開発者は、次のガイドラインを使用して、プラガブルな認証機能を利用するためのコネクタの準備と、対応性を高めるために行うステップについて判断できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            変更が行われていない既存のコネクタは、ネイティブ認証を使用し、このコネクタを使用するクライアントは、ネイティブ認証を使用するアカウントを通じてのみサーバーに接続できます。 <span class="emphasis"><em>ただし、最新バージョンのサーバーに対してコネクタをテストして、このような接続が引き続き問題なく機能することを検証する必要があります。</em></span> 
          </p><p>
            例外: コネクタは、(静的ではなく) 動的に <code class="literal">libmysqlclient</code> にリンクしている場合に、変更せずにプラガブルな認証を処理でき、最新バージョンの <code class="literal">libmysqlclient</code> がインストールされている場合に、このバージョンをロードします。
          </p></li><li class="listitem"><p>
            プラガブルな認証機能を利用するには、<code class="literal">libmysqlclient</code> ベースのコネクタを、最新バージョンの <code class="literal">libmysqlclient</code> に対して再リンクする必要があります。 これにより、コネクタは、現在 <code class="literal">libmysqlclient</code> に組み込まれているクライアント側のプラグイン (PAM 認証に必要な平文プラグインや Windows ネイティブ認証に必要な Windows プラグインなど) を必要とするアカウントを通じた接続をサポートできるようになります。 現在の <code class="literal">libmysqlclient</code> とのリンクによっても、コネクタは、デフォルトの MySQL プラグインディレクトリ (通常、ローカルサーバーの <code class="literal">plugin_dir</code> システム変数のデフォルト値で指名されたディレクトリ) にインストールされたクライアント側にアクセスできるようになります。 
          </p><p>
            コネクタが動的に <code class="literal">libmysqlclient</code> にリンクする場合、より新しいバージョンの <code class="literal">libmysqlclient</code> がクライアントホストにインストールされていることと、コネクタが実行時にそれをロードすることを確認する必要があります。
          </p></li><li class="listitem"><p>
            コネクタが特定の認証方式をサポートする別の方法は、クライアント/サーバープロトコルに直接実装することです。Connector/NET は、このアプローチを使用して Windows ネイティブ認証をサポートします。
          </p></li><li class="listitem"><p>
            コネクタが、デフォルトのプラグインディレクトリとは異なるディレクトリから、クライアント側のプラグインをロードできる必要がある場合、クライアントユーザーがそのディレクトリを指定するための手段を実装する必要があります。 この候補としては、コネクタがディレクトリ名を取得できるコマンド行オプションまたは環境変数などがあります。 <span class="command"><strong>mysql</strong></span> や <span class="command"><strong>mysqladmin</strong></span> などの標準 MySQL クライアントプログラムは、<code class="option">--plugin-dir</code> オプションを実装します。 <a class="ulink" href="https://dev.mysql.com/doc/c-api/8.0/en/c-api-plugin-interface.html" target="_top">C API Client Plugin Interface</a>も参照してください。 
          </p></li><li class="listitem"><p>
            コネクタでのプロキシユーザーのサポートは、このセクションで前述したように、コネクタがサポートする認証方式がプロキシユーザーを許可するかどうかによって異なります。
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="proxy-users"></a>6.2.18 プロキシユーザー</h3></div></div></div><a class="indexterm" name="idm46723761892128"></a><p>
      MySQL サーバーは、認証プラグインを使用してクライアント接続を認証します。 特定の接続を認証するプラグインは、特権チェックのために接続 (外部) ユーザーを別のユーザーとして扱うようにリクエストする場合があります。 これにより、外部ユーザーを 2 人目のユーザーのプロキシにできます。つまり、2 人目のユーザーの権限を引き受けることができます: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          外部ユーザーは<span class="quote">「<span class="quote">「プロキシユーザー」</span>」</span> (別のユーザーとして偽装または認識できるユーザー) です。
        </p></li><li class="listitem"><p>
          2 番目のユーザーは<span class="quote">「<span class="quote">「プロキシユーザー」</span>」</span> (プロキシユーザーがアイデンティティと権限を引き受けることができるユーザー) です。
        </p></li></ul></div><p>
      このセクションでは、プロキシユーザー機能の動作について説明します。 認証プラグインに関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。 特定のプラグインの詳細は、<a class="xref" href="security.html#authentication-plugins" title="6.4.1 認証プラグイン">セクション6.4.1「認証プラグイン」</a> を参照してください。 プロキシユーザーをサポートする認証プラグインの記述の詳細は、<a class="ulink" href="https://dev.mysql.com/doc/extending-mysql/8.0/en/writing-authentication-plugins-proxy-users.html" target="_top">Implementing Proxy User Support in Authentication Plugins</a> を参照してください。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#proxy-users-support-requirements" title="プロキシユーザーサポートの要件">プロキシユーザーサポートの要件</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-example" title="単純なプロキシユーザーの例">単純なプロキシユーザーの例</a></p></li><li class="listitem"><p><a class="xref" href="security.html#preventing-proxied-account-direct-login" title="プロキシアカウントへの直接ログインの防止">プロキシアカウントへの直接ログインの防止</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-granting-proxy-privilege" title="PROXY 権限の付与および取消し">PROXY 権限の付与および取消し</a></p></li><li class="listitem"><p><a class="xref" href="security.html#default-proxy-users" title="デフォルトのプロキシユーザー">デフォルトのプロキシユーザー</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-conflicts" title="デフォルトのプロキシユーザーと匿名ユーザーの競合">デフォルトのプロキシユーザーと匿名ユーザーの競合</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-server-user-mapping" title="プロキシユーザーマッピングのサーバーサポート">プロキシユーザーマッピングのサーバーサポート</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-system-variables" title="プロキシユーザーのシステム変数">プロキシユーザーのシステム変数</a></p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        プロキシによって得られる管理上の利点の 1 つは、DBA が一連の権限を持つ単一のアカウントを設定し、それらの各ユーザーに権限を個別に割り当てることなく、複数のプロキシユーザーがそれらの権限を持つことができることです。 プロキシユーザーのかわりに、DBA は、ユーザーを特定の名前付き権限セットにマップするための適切な方法をロールが提供する場合があります。 各ユーザーには、特定の単一のロールを付与して、実際には適切な権限セットを付与できます。 <a class="xref" href="security.html#roles" title="6.2.10 ロールの使用">セクション6.2.10「ロールの使用」</a>を参照してください。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="proxy-users-support-requirements"></a>プロキシユーザーサポートの要件</h4></div></div></div><p>
        特定の認証プラグインに対してプロキシを実行するには、次の条件を満たす必要があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            プロキシは、プラグイン自体またはプラグインのかわりに MySQL サーバーによってサポートされている必要があります。 後者の場合、サーバーサポートを明示的に有効にする必要がある場合があります。<a class="xref" href="security.html#proxy-users-server-user-mapping" title="プロキシユーザーマッピングのサーバーサポート">プロキシユーザーマッピングのサーバーサポート</a> を参照してください。 
          </p></li><li class="listitem"><p>
            プラグインによって認証されるように外部プロキシユーザーのアカウントを設定する必要があります。 <code class="literal">CREATE USER</code> ステートメントを使用してアカウントを認証プラグインに関連付けるか、<code class="literal">ALTER USER</code> を使用してそのプラグインを変更します。 
          </p></li><li class="listitem"><p>
            プロキシユーザーのアカウントが存在し、プロキシユーザーが想定する権限が付与されている必要があります。 これには、<code class="literal">CREATE USER</code> および <code class="literal">GRANT</code> ステートメントを使用します。 
          </p></li><li class="listitem"><p>
            通常、プロキシユーザーは、プロキシシナリオでのみ使用でき、直接ログインには使用できないように構成されます。
          </p></li><li class="listitem"><p>
            プロキシユーザーアカウントには、プロキシ設定されたアカウントに対する <code class="literal">PROXY</code> 権限が必要です。 これを行うには、<code class="literal">GRANT</code> ステートメントを使用します。 
          </p></li><li class="listitem"><p>
            プロキシアカウントに接続しているクライアントをプロキシユーザーとして処理するには、認証プラグインがクライアントユーザー名とは異なるユーザー名を返して、プロキシユーザーが想定する権限を定義するプロキシアカウントのユーザー名を示す必要があります。
          </p><p>
            または、サーバーによってプロキシマッピングが提供されるプラグインの場合、プロキシユーザーはプロキシユーザーが保持する <code class="literal">PROXY</code> 権限から決定されます。
          </p></li></ul></div><p>
        プロキシメカニズムでは、外部クライアントユーザー名のみをプロキシユーザー名にマップできます。 ホスト名をマッピングするためのプロビジョニングはありません: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            クライアントがサーバーに接続すると、サーバーはクライアントプログラムによって渡されたユーザー名とクライアントの接続元のホストに基づいて適切なアカウントを決定します。
          </p></li><li class="listitem"><p>
            そのアカウントがプロキシアカウントである場合、サーバーは、認証プラグインによって返されたユーザー名とプロキシアカウントのホスト名を使用してプロキシアカウントの一致を検索することで、適切なプロキシアカウントを決定しようとします。 プロキシ設定されたアカウントのホスト名は無視されます。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="proxy-users-example"></a>単純なプロキシユーザーの例</h4></div></div></div><p>
        次のアカウント定義について考えてみます:
      </p><pre class="programlisting">-- create proxy account
CREATE USER 'employee_ext'@'localhost'
  IDENTIFIED WITH my_auth_plugin
  AS '<em class="replaceable"><code>my_auth_string</code></em>';

-- create proxied account and grant its privileges;
-- use mysql_no_login plugin to prevent direct login
CREATE USER 'employee'@'localhost'
  IDENTIFIED WITH mysql_no_login;
GRANT ALL
  ON employees.*
  TO 'employee'@'localhost';

-- grant to proxy account the
-- PROXY privilege for proxied account
GRANT PROXY
  ON 'employee'@'localhost'
  TO 'employee_ext'@'localhost';
</pre><p>
        クライアントがローカルホストから <code class="literal">employee_ext</code> として接続すると、MySQL は <code class="literal">my_auth_plugin</code> という名前のプラグインを使用して認証を実行します。 <code class="literal">my_auth_plugin</code> が、<code class="literal">'<em class="replaceable"><code>my_auth_string</code></em>'</code>の内容に基づいて、外部認証システムを参照することで、<code class="literal">employee</code> のユーザー名をサーバーに返すとします。 <code class="literal">employee</code> という名前は <code class="literal">employee_ext</code> とは異なるため、<code class="literal">employee</code> を返すことは、権限チェックの目的で <code class="literal">employee_ext</code> 外部ユーザーを <code class="literal">employee</code> ローカルユーザーとして処理するためのリクエストとして機能します。 
      </p><p>
        この場合、<code class="literal">employee_ext</code> はプロキシユーザーで、<code class="literal">employee</code> はプロキシユーザーです。
      </p><p>
        サーバーは、<code class="literal">employee_ext</code> (プロキシユーザー) が <code class="literal">employee</code> (プロキシユーザー) に対する <code class="literal">PROXY</code> 権限を持っているかどうかを確認することで、<code class="literal">employee_ext</code> ユーザーに対して <code class="literal">employee</code> のプロキシ認証が可能であることを検証します。 この権限が付与されていない場合は、エラーが発生します。 それ以外の場合、<code class="literal">employee_ext</code> は <code class="literal">employee</code> の権限を引き継ぎます。 サーバーは、<code class="literal">employee_ext</code> によってクライアントセッション中に実行されたステートメントを、<code class="literal">employee</code> に付与された権限に対してチェックします。 この場合、<code class="literal">employee_ext</code> は <code class="literal">employees</code> データベースのテーブルにアクセスできます。 
      </p><p>
        プロキシ設定されたアカウント <code class="literal">employee</code> は、<code class="literal">mysql_no_login</code> 認証プラグインを使用して、クライアントがアカウントを使用して直接ログインできないようにします。 (これは、プラグインがインストールされていることを前提としています。 手順については、<a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 ログインなしのプラガブル認証">セクション6.4.1.8「ログインなしのプラガブル認証」</a> を参照してください。) プロキシ設定されたアカウントを直接使用しないように保護する別の方法については、<a class="xref" href="security.html#preventing-proxied-account-direct-login" title="プロキシアカウントへの直接ログインの防止">プロキシアカウントへの直接ログインの防止</a> を参照してください。 
      </p><p>
        プロキシが発生すると、<code class="literal">USER()</code> および <code class="literal">CURRENT_USER()</code> の機能を使用して、接続ユーザー (プロキシユーザー) と、現在のセッション中に権限が適用されるアカウント (プロキシユーザー) の違いを確認できます。 先ほど説明した例では、これらの関数は次の値を返します。 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------------+--------------------+
| USER()                 | CURRENT_USER()     |
+------------------------+--------------------+
| employee_ext@localhost | employee@localhost |
+------------------------+--------------------+
</pre><p>
        プロキシユーザーアカウントを作成する <code class="literal">CREATE USER</code> ステートメントでは、プロキシサポート認証プラグインを指定する <code class="literal">IDENTIFIED WITH</code> 句のあとに、オプションで、ユーザーの接続時にサーバーがプラグインに渡す文字列を指定する <code class="literal">AS '<em class="replaceable"><code>auth_string</code></em>'</code>句が続きます。 存在する場合、この文字列は、プロキシ (外部) クライアントユーザー名をプロキシユーザー名にマップする方法をプラグインが決定するのに役立つ情報を提供します。 <code class="literal">AS</code> 句が必要かどうかは、プラグインごとに異なります。 その場合、認証文字列の形式は、プラグインがそれをどのように使用するかによって異なります。 許可される認証文字列の値については、特定のプラグインに関するドキュメントを参照してください。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="preventing-proxied-account-direct-login"></a>プロキシアカウントへの直接ログインの防止</h4></div></div></div><p>
        プロキシアカウントは通常、プロキシアカウントによってのみ使用されます。 つまり、クライアントはプロキシアカウントを使用して接続し、適切なプロキシユーザーの権限にマップされて引き受けます。 
      </p><p>
        プロキシ設定されたアカウントを直接使用できないようにするには、複数の方法があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            アカウントを <code class="literal">mysql_no_login</code> 認証プラグインに関連付けます。 この場合、アカウントはどのような状況でも直接ログインには使用できません。 これは、プラグインがインストールされていることを前提としています。 その手順は、<a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 ログインなしのプラガブル認証">セクション6.4.1.8「ログインなしのプラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            アカウントの作成時に <code class="literal">ACCOUNT LOCK</code> オプションを含めます。 <a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a>を参照してください。 この方法では、アカウントが後でロック解除された場合にパスワードなしでアクセスできないように、パスワードも含めます。 (<code class="literal">validate_password</code> コンポーネントが有効な場合、アカウントがロックされていても、パスワードなしのアカウントの作成は許可されません。 <a class="xref" href="security.html#validate-password" title="6.4.3 パスワード検証コンポーネント">セクション6.4.3「パスワード検証コンポーネント」</a>を参照してください。) 
          </p></li><li class="listitem"><p>
            パスワードを使用してアカウントを作成しますが、他のユーザーにはパスワードを通知しません。 アカウントのパスワードを誰にも知らない場合、クライアントはそれを使用して MySQL サーバーに直接接続できません。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="proxy-users-granting-proxy-privilege"></a>PROXY 権限の付与および取消し</h4></div></div></div><a class="indexterm" name="idm46723761797504"></a><p>
        外部ユーザーが別のユーザーとして接続し、別のユーザーの権限を持つことができるようにするには、<code class="literal">PROXY</code> 権限が必要です。 この権限を付与するには、<code class="literal">GRANT</code> ステートメントを使用します。 例: 
      </p><pre class="programlisting">GRANT PROXY ON '<em class="replaceable"><code>proxied_user</code></em>' TO '<em class="replaceable"><code>proxy_user</code></em>';
</pre><a class="indexterm" name="idm46723761791088"></a><a class="indexterm" name="idm46723761788944"></a><p>
        このステートメントは、<code class="literal">mysql.proxies_priv</code> 付与テーブルに行を作成します。
      </p><p>
        接続時に、<em class="replaceable"><code>proxy_user</code></em> は有効な外部認証 MySQL ユーザーを表し、<em class="replaceable"><code>proxied_user</code></em> は有効なローカル認証ユーザーを表す必要があります。 そうでない場合、接続は失敗します。 
      </p><p>
        対応する <code class="literal">REVOKE</code> 構文は次のとおりです。
      </p><pre class="programlisting">REVOKE PROXY ON '<em class="replaceable"><code>proxied_user</code></em>' FROM '<em class="replaceable"><code>proxy_user</code></em>';
</pre><p>
        MySQL <code class="literal">GRANT</code> および <code class="literal">REVOKE</code> 構文の拡張機能は、通常どおりに動作します。 例: 
      </p><pre class="programlisting">-- grant PROXY to multiple accounts
GRANT PROXY ON 'a' TO 'b', 'c', 'd';

-- revoke PROXY from multiple accounts
REVOKE PROXY ON 'a' FROM 'b', 'c', 'd';

-- grant PROXY to an account and enable the account to grant
-- PROXY to the proxied account
GRANT PROXY ON 'a' TO 'd' WITH GRANT OPTION;

-- grant PROXY to default proxy account
GRANT PROXY ON 'a' TO ''@'';
</pre><p>
        次のような場合に、<code class="literal">PROXY</code> 権限を付与できます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <em class="replaceable"><code>proxied_user</code></em> に対する <code class="literal">GRANT PROXY ... WITH GRANT OPTION</code> を持つユーザーによる。
          </p></li><li class="listitem"><p>
            自分で <em class="replaceable"><code>proxied_user</code></em> による: アカウント名のユーザー名とホスト名の両方の部分で、<code class="literal">USER()</code> の値が <code class="literal">CURRENT_USER()</code> および <em class="replaceable"><code>proxied_user</code></em> と完全に一致する必要があります。
          </p></li></ul></div><p>
        MySQL のインストール中に作成された最初の <code class="literal">root</code> アカウントには、<code class="literal">''@''</code>(すべてのユーザーおよびすべてのホスト) に対する <code class="literal">PROXY ... WITH GRANT OPTION</code> 権限があります。 これにより、<code class="literal">root</code> はプロキシユーザーを設定したり、プロキシユーザーを設定するための権限をほかのアカウントに委任したりできます。 たとえば、<code class="literal">root</code> は次の操作を実行できます。 
      </p><pre class="programlisting">CREATE USER 'admin'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>admin_password</code></em>';
GRANT PROXY
  ON ''@''
  TO 'admin'@'localhost'
  WITH GRANT OPTION;
</pre><p>
        これらのステートメントによって、すべての <code class="literal">GRANT PROXY</code> マッピングを管理できる <code class="literal">admin</code> ユーザーが作成されます。 たとえば、<code class="literal">admin</code> は次の操作を実行できます。 
      </p><pre class="programlisting">GRANT PROXY ON sally TO joe;
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="default-proxy-users"></a>デフォルトのプロキシユーザー</h4></div></div></div><a class="indexterm" name="idm46723761756976"></a><a class="indexterm" name="idm46723761754768"></a><p>
        一部またはすべてのユーザーが特定の認証プラグインを使用して接続する必要があることを指定するには、空のユーザー名とホスト名 (<code class="literal">''@''</code>) で<span class="quote">「<span class="quote">「空白」</span>」</span> MySQL アカウントを作成し、それをそのプラグインに関連付けて、プラグインが実際の認証済ユーザー名を返すようにします (空白のユーザーと異なる場合)。 LDAP 認証を実装し、接続ユーザーを開発者またはマネージャアカウントにマップする <code class="literal">ldap_auth</code> という名前のプラグインが存在するとします。 これらのアカウントに対するユーザーのプロキシを設定するには、次のステートメントを使用します: 
      </p><pre class="programlisting">-- create default proxy account
CREATE USER ''@''
  IDENTIFIED WITH ldap_auth
  AS 'O=Oracle, OU=MySQL';

-- create proxied accounts; use
-- mysql_no_login plugin to prevent direct login
CREATE USER 'developer'@'localhost'
  IDENTIFIED WITH mysql_no_login;
CREATE USER 'manager'@'localhost'
  IDENTIFIED WITH mysql_no_login;

-- grant to default proxy account the
-- PROXY privilege for proxied accounts
GRANT PROXY
  ON 'manager'@'localhost'
  TO ''@'';
GRANT PROXY
  ON 'developer'@'localhost'
  TO ''@'';
</pre><p>
        ここで、クライアントが次のように接続するとします:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=myuser --password ...</code></strong>
Enter password: <em class="replaceable"><code>myuser_password</code></em>
</pre><p>
        サーバーは MySQL ユーザーとして定義された <code class="literal">myuser</code> を検出しませんが、クライアントユーザー名およびホスト名と一致する空白のユーザーアカウント (<code class="literal">''@''</code>) があるため、サーバーはそのアカウントに対してクライアントを認証します。 サーバーは <code class="literal">ldap_auth</code> 認証プラグインを呼び出し、<code class="literal">myuser</code> および <em class="replaceable"><code>myuser_password</code></em> をユーザー名とパスワードとして渡します。 
      </p><p>
        <em class="replaceable"><code>myuser_password</code></em> が <code class="literal">myuser</code> の正しいパスワードではないことが LDAP ディレクトリで <code class="literal">ldap_auth</code> プラグインによって検出された場合、認証は失敗し、サーバーは接続を拒否します。
      </p><p>
        パスワードが正しく、<code class="literal">ldap_auth</code> によって <code class="literal">myuser</code> が開発者であることが検出された場合は、MySQL サーバーに <code class="literal">myuser</code> ではなく、<code class="literal">developer</code> というユーザー名が返されます。 <code class="literal">myuser</code> のクライアントユーザー名とは異なるユーザー名を返すと、<code class="literal">myuser</code> をプロキシとして扱う必要があることがサーバーに通知されます。 サーバーは、<code class="literal">''@''</code>が <code class="literal">developer</code> として認証できることを検証し (<code class="literal">''@''</code>にはそれを行う <code class="literal">PROXY</code> 権限があるため)、接続を受け入れます。 セッションは、<code class="literal">developer</code> プロキシユーザーの権限を持つ <code class="literal">myuser</code> に進みます。 (これらの権限は、DBA が <code class="literal">GRANT</code> ステートメントを使用して設定するべきですが、表示されません。) <code class="literal">USER()</code> および <code class="literal">CURRENT_USER()</code> 関数は、次の値を返します。 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------+---------------------+
| USER()           | CURRENT_USER()      |
+------------------+---------------------+
| myuser@localhost | developer@localhost |
+------------------+---------------------+
</pre><p>
        かわりに、LDAP ディレクトリで <code class="literal">myuser</code> がマネージャであることが検出されると、ユーザー名として <code class="literal">manager</code> が返され、セッションは <code class="literal">manager</code> プロキシユーザーの権限を持つ <code class="literal">myuser</code> で続行されます。
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------+-------------------+
| USER()           | CURRENT_USER()    |
+------------------+-------------------+
| myuser@localhost | manager@localhost |
+------------------+-------------------+
</pre><p>
        単純にするために、外部認証はマルチレベルで実行できません。前述の例では、<code class="literal">developer</code> の証明書も、<code class="literal">manager</code> の証明書も考慮されません。 ただし、クライアントが <code class="literal">developer</code> または <code class="literal">manager</code> アカウントとして直接接続および認証しようとする場合は、これらのプロキシアカウントを直接ログインから保護する必要があります (<a class="xref" href="security.html#preventing-proxied-account-direct-login" title="プロキシアカウントへの直接ログインの防止">プロキシアカウントへの直接ログインの防止</a> を参照)。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="proxy-users-conflicts"></a>デフォルトのプロキシユーザーと匿名ユーザーの競合</h4></div></div></div><a class="indexterm" name="idm46723761711904"></a><p>
        デフォルトのプロキシユーザーを作成する場合は、デフォルトのプロキシユーザーよりも優先される他の既存の<span class="quote">「<span class="quote">「いずれかのユーザーに一致」</span>」</span>アカウントを確認します。これは、そのユーザーが意図したとおりに作業できない可能性があるためです。
      </p><p>
        前述の説明で、デフォルトのプロキシユーザーアカウントのホスト部分には、任意のホストと一致する<code class="literal">''</code>があります。 デフォルトのプロキシユーザーを設定する場合は、ホスト部分に同じユーザー部分と<code class="literal">'%'</code>を持つ非プロキシアカウントが存在するかどうかも注意して確認してください。これは、<code class="literal">'%'</code>も任意のホストに一致しますが、サーバーがアカウント行を内部的にソートするために使用するルールによって<code class="literal">''</code>よりも優先されるためです (<a class="xref" href="security.html#connection-access" title="6.2.6 アクセス制御、ステージ 1: 接続の検証">セクション6.2.6「アクセス制御、ステージ 1: 接続の検証」</a> を参照)。 
      </p><p>
        MySQL のインストールに、次の 2 つのアカウントが含まれていると仮定します。
      </p><pre class="programlisting">-- create default proxy account
CREATE USER ''@''
  IDENTIFIED WITH some_plugin
  AS '<em class="replaceable"><code>some_auth_string</code></em>';
-- create anonymous account
CREATE USER ''@'%'
  IDENTIFIED BY '<em class="replaceable"><code>anon_user_password</code></em>';
</pre><p>
        最初のアカウント (<code class="literal">''@''</code>) はデフォルトのプロキシユーザーとして使用され、それ以外の場合はより特定のアカウントと一致しないユーザーの接続を認証するために使用されます。 2 つ目のアカウント (<code class="literal">''@'%'</code>) は匿名ユーザーアカウントで、たとえば、独自のアカウントを持たないユーザーが匿名で接続できるようにするために作成された可能性があります。 
      </p><p>
        両方のアカウントに同じユーザー部分 (<code class="literal">''</code>) があり、これは任意のユーザーに一致します。 各アカウントには、任意のホストと一致するホスト部分があります。 ただし、一致ルールは<code class="literal">''</code>の前に<code class="literal">'%'</code>のホストをソートするため、接続試行のアカウント照合には優先度があります。 他の特定のアカウントと一致しないアカウントの場合、サーバーは<code class="literal">''@''</code> (デフォルトのプロキシユーザー) ではなく、<code class="literal">''@'%'</code> (匿名ユーザー) に対して認証を試みます。 その結果、デフォルトのプロキシアカウントは使用されません。 
      </p><p>
        この問題を回避するには、次のいずれかの方法を使用します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            匿名アカウントを削除して、デフォルトのプロキシユーザーと競合しないようにします。
          </p></li><li class="listitem"><p>
            匿名ユーザーの前に一致する特定のデフォルトプロキシユーザーを使用します。 たとえば、<code class="literal">localhost</code> プロキシ接続のみを許可するには、<code class="literal">''@'localhost'</code>を使用します: 
          </p><pre class="programlisting">CREATE USER ''@'localhost'
  IDENTIFIED WITH some_plugin
  AS '<em class="replaceable"><code>some_auth_string</code></em>';
</pre><p>
            また、<code class="literal">GRANT PROXY</code> ステートメントを変更して、<code class="literal">''@''</code>ではなく<code class="literal">''@'localhost'</code>をプロキシユーザーとして指定します。
          </p><p>
            この戦略により、<code class="literal">localhost</code> からの匿名ユーザー接続が防止されることに注意してください。
          </p></li><li class="listitem"><p>
            匿名のデフォルトアカウントではなく、名前付きのデフォルトアカウントを使用します。 この方法の例については、<code class="literal">authentication_windows</code> プラグインを使用する手順を参照してください。 <a class="xref" href="security.html#windows-pluggable-authentication" title="6.4.1.6 Windows プラガブル認証">セクション6.4.1.6「Windows プラガブル認証」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            複数のプロキシユーザーを作成します。1 つはローカル接続用、もう 1 つは<span class="quote">「<span class="quote">「その他すべて」</span>」</span>用です (リモート接続)。 これは、特にローカルユーザーがリモートユーザーとは異なる権限を持つ必要がある場合に役立ちます。 
          </p><p>
            プロキシユーザーを作成します:
          </p><pre class="programlisting">-- create proxy user for local connections
CREATE USER ''@'localhost'
  IDENTIFIED WITH some_plugin
  AS '<em class="replaceable"><code>some_auth_string</code></em>';
-- create proxy user for remote connections
CREATE USER ''@'%'
  IDENTIFIED WITH some_plugin
  AS '<em class="replaceable"><code>some_auth_string</code></em>';
</pre><p>
            プロキシユーザーを作成します:
          </p><pre class="programlisting">-- create proxied user for local connections
CREATE USER 'developer'@'localhost'
  IDENTIFIED WITH mysql_no_login;
-- create proxied user for remote connections
CREATE USER 'developer'@'%'
  IDENTIFIED WITH mysql_no_login;
</pre><p>
            各プロキシアカウントに、対応するプロキシアカウントの <code class="literal">PROXY</code> 権限を付与します:
          </p><pre class="programlisting">GRANT PROXY
  ON 'developer'@'localhost'
  TO ''@'localhost';
GRANT PROXY
  ON 'developer'@'%'
  TO ''@'%';
</pre><p>
            最後に、ローカルおよびリモートのプロキシユーザーに適切な権限を付与します (表示されていません)。
          </p><p>
            <code class="literal">some_plugin</code>/<code class="literal">'<em class="replaceable"><code>some_auth_string</code></em>'</code>の組合せによって、<code class="literal">some_plugin</code> がクライアントユーザー名を <code class="literal">developer</code> にマップするとします。 ローカル接続は、<code class="literal">'developer'@'localhost'</code>プロキシユーザーにマップされる<code class="literal">''@'localhost'</code>プロキシユーザーと一致します。 リモート接続は、<code class="literal">'developer'@'%'</code>プロキシユーザーにマップされる<code class="literal">''@'%'</code>プロキシユーザーと一致します。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="proxy-users-server-user-mapping"></a>プロキシユーザーマッピングのサーバーサポート</h4></div></div></div><a class="indexterm" name="idm46723761663824"></a><p>
        一部の認証プラグインは、プロキシユーザーマッピングを実装しています (PAM や Windows 認証プラグインなど)。 その他の認証プラグインは、デフォルトではプロキシユーザーをサポートしていません。 その中には、付与されたプロキシ権限に従って、MySQL サーバー自体がプロキシユーザーをマップするようにリクエストできるものがあります: <code class="literal">mysql_native_password</code>、<code class="literal">sha256_password</code>。 <code class="literal">check_proxy_users</code> システム変数が有効になっている場合、サーバーは、このようなリクエストを行う認証プラグインに対してプロキシユーザーマッピングを実行します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            デフォルトでは、<code class="literal">check_proxy_users</code> は無効になっているため、サーバーはプロキシユーザーのサーバーサポートをリクエストする認証プラグインに対してもプロキシユーザーマッピングを実行しません。
          </p><a class="indexterm" name="idm46723761655728"></a><a class="indexterm" name="idm46723761654176"></a></li><li class="listitem"><p>
            <code class="literal">check_proxy_users</code> が有効になっている場合は、サーバープロキシユーザーマッピングのサポートを利用するために、プラグイン固有のシステム変数を有効にする必要がある場合もあります:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">mysql_native_password</code> プラグインの場合は、<code class="literal">mysql_native_password_proxy_users</code> を有効にします。
              </p><a class="indexterm" name="idm46723761647280"></a><a class="indexterm" name="idm46723761645680"></a></li><li class="listitem"><p>
                <code class="literal">sha256_password</code> プラグインの場合は、<code class="literal">sha256_password_proxy_users</code> を有効にします。
              </p><a class="indexterm" name="idm46723761641104"></a><a class="indexterm" name="idm46723761639536"></a></li></ul></div></li></ul></div><p>
        たとえば、前述のすべての機能を有効にするには、<code class="filename">my.cnf</code> ファイルで次の行を使用してサーバーを起動します:
      </p><pre class="programlisting">[mysqld]
check_proxy_users=ON
mysql_native_password_proxy_users=ON
sha256_password_proxy_users=ON
</pre><p>
        関連するシステム変数が有効になっている場合は、<code class="literal">CREATE USER</code> を使用して通常どおりにプロキシユーザーを作成し、プロキシユーザーとして扱われる単一の他のアカウントに <code class="literal">PROXY</code> 権限を付与します。 サーバーは、プロキシユーザーに対する正常な接続リクエストを受信すると、そのユーザーに <code class="literal">PROXY</code> 権限があることを確認し、それを使用して適切なプロキシユーザーを決定します。 
      </p><pre class="programlisting">-- create proxy account
CREATE USER 'proxy_user'@'localhost'
  IDENTIFIED WITH mysql_native_password
  BY '<em class="replaceable"><code>password</code></em>';

-- create proxied account and grant its privileges;
-- use mysql_no_login plugin to prevent direct login
CREATE USER 'proxied_user'@'localhost'
  IDENTIFIED WITH mysql_no_login;
-- grant privileges to proxied account
GRANT ...
  ON ...
  TO 'proxied_user'@'localhost';

-- grant to proxy account the
-- PROXY privilege for proxied account
GRANT PROXY
  ON 'proxied_user'@'localhost'
  TO 'proxy_user'@'localhost';
</pre><p>
        プロキシアカウントを使用するには、名前とパスワードを使用してサーバーに接続します:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u proxy_user -p</code></strong>
Enter password: <em class="replaceable"><code>(enter proxy_user password here)</code></em>
</pre><p>
        認証に成功すると、サーバーは <code class="literal">proxy_user</code> に <code class="literal">proxied_user</code> に対する <code class="literal">PROXY</code> 権限があることを検出し、セッションは <code class="literal">proxied_user</code> の権限を持つ <code class="literal">proxy_user</code> に進みます。
      </p><p>
        サーバーによって実行されるプロキシユーザーマッピングには、次の制限事項があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            関連付けられた <code class="literal">PROXY</code> 権限が付与されている場合でも、サーバーは匿名ユーザーとの間でプロキシを行いません。
          </p></li><li class="listitem"><p>
            単一のアカウントに複数のプロキシアカウントのプロキシ権限が付与されている場合、サーバープロキシユーザーマッピングは非決定的です。 したがって、複数のプロキシアカウントに対する単一アカウントのプロキシ権限への付与はお薦めしません。 
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="proxy-users-system-variables"></a>プロキシユーザーのシステム変数</h4></div></div></div><a class="indexterm" name="idm46723761615216"></a><p>
        次の 2 つのシステム変数は、プロキシのログインプロセスをトレースする際に役立ちます。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">proxy_user</code>: プロキシ処理が使用されていない場合、この値は <code class="literal">NULL</code> です。 それ以外の場合は、プロキシユーザーのアカウントを示します。 たとえば、クライアントが<code class="literal">''@''</code>プロキシアカウントを介して認証する場合、この変数は次のように設定されます: 
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT @@proxy_user;</code></strong>
+--------------+
| @@proxy_user |
+--------------+
| ''@''        |
+--------------+
</pre></li><li class="listitem"><p>
            <code class="literal">external_user</code>: 認証プラグインは外部ユーザーを使用して、MySQL サーバーへの認証を行うことがあります。 たとえば、Windows のネイティブ認証を使用するときは、Windows の API を使用して認証するプラグインに、ログイン ID を渡す必要がありません。 ただし、認証には引き続き Windows ユーザ ID が使用されます。 このプラグインは、読み取り専用のセッション変数 <code class="literal">external_user</code> を使用して、この外部ユーザー ID (または最初の 512 UTF-8 バイト) をサーバーに返すことがあります。 プラグインがこの変数を設定しない場合、その値は <code class="literal">NULL</code> です。 
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="account-locking"></a>6.2.19 アカウントロック</h3></div></div></div><a class="indexterm" name="idm46723761601344"></a><p>
      MySQL では、<code class="literal">CREATE USER</code> および <code class="literal">ALTER USER</code> ステートメントの <code class="literal">ACCOUNT LOCK</code> 句および <code class="literal">ACCOUNT UNLOCK</code> 句を使用したユーザーアカウントのロックおよびロック解除がサポートされています:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          これらの句を <code class="literal">CREATE USER</code> とともに使用すると、新しいアカウントの初期ロック状態を指定できます。 どちらの句もない場合、アカウントはロック解除された状態で作成されます。 
        </p><p>
          <code class="literal">validate_password</code> コンポーネントが有効な場合、アカウントがロックされていても、パスワードなしでのアカウントの作成は許可されません。 <a class="xref" href="security.html#validate-password" title="6.4.3 パスワード検証コンポーネント">セクション6.4.3「パスワード検証コンポーネント」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          これらの句を <code class="literal">ALTER USER</code> とともに使用すると、既存のアカウントの新しいロック状態を指定できます。 どちらの句もない場合、アカウントのロック状態は変更されません。 
        </p><p>
          MySQL 8.0.19 の時点では、ログインの失敗回数が多すぎるために一時的にロックされているステートメントで指定されたアカウントは、<code class="literal">ALTER USER ... UNLOCK</code> によってロック解除されます。 <a class="xref" href="security.html#password-management" title="6.2.15 パスワード管理">セクション6.2.15「パスワード管理」</a>を参照してください。 
        </p></li></ul></div><p>
      アカウントのロック状態は、<code class="literal">mysql.user</code> システムテーブルの <code class="literal">account_locked</code> カラムに記録されます。 <code class="literal">SHOW CREATE USER</code> からの出力には、アカウントがロックされているかロック解除されているかが示されます。 
    </p><p>
      クライアントがロックされたアカウントに接続しようとすると、試行は失敗します。 サーバーは、ロックされたアカウントへの接続試行回数を示す <code class="literal">Locked_connects</code> ステータス変数を増分し、<code class="literal">ER_ACCOUNT_HAS_BEEN_LOCKED</code> エラーを返して、エラーログにメッセージを書き込みます: 
    </p><pre class="programlisting">Access denied for user '<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'.
Account is locked.
</pre><p>
      アカウントをロックしても、ロックされたアカウントのアイデンティティを想定するプロキシユーザーを使用して接続できることには影響しません。 また、ロックされたアカウントを指定する <code class="literal">DEFINER</code> 属性を持つストアドプログラムまたはビューを実行する機能にも影響しません。 つまり、プロキシ設定されたアカウント、ストアドプログラムまたはビューを使用する機能は、アカウントをロックしても影響を受けません。 
    </p><p>
      アカウントロック機能は、<code class="literal">mysql.user</code> システムテーブルに <code class="literal">account_locked</code> カラムが存在するかどうかによって異なります。 5.7.6 より古い MySQL バージョンからのアップグレードの場合は、MySQL のアップグレード手順を実行して、このカラムが存在することを確認します。 <a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a>を参照してください。 <code class="literal">account_locked</code> カラムがないアップグレードされていないインストールの場合、サーバーはすべてのアカウントをロック解除済として扱い、<code class="literal">ACCOUNT LOCK</code> 句または <code class="literal">ACCOUNT UNLOCK</code> 句を使用するとエラーが発生します。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="user-resources"></a>6.2.20 アカウントリソース制限の設定</h3></div></div></div><a class="indexterm" name="idm46723761568896"></a><a class="indexterm" name="idm46723761566736"></a><a class="indexterm" name="idm46723761564656"></a><a class="indexterm" name="idm46723761563424"></a><a class="indexterm" name="idm46723761562080"></a><a class="indexterm" name="idm46723761560704"></a><p>
      MySQL サーバーリソースのクライアント使用を制限する方法の 1 つは、グローバル <code class="literal">max_user_connections</code> システム変数をゼロ以外の値に設定することです。 これにより、任意の特定のアカウントで実行できる同時接続の数が制限されますが、一度クライアントが接続したら、実行内容には制限が課されません。 さらに、<code class="literal">max_user_connections</code> を設定しても、各アカウントの管理は有効になりません。 どちらのタイプの制御も、MySQL 管理者にとって重要です。 
    </p><p>
      このような問題に対処するために、MySQL では、次のサーバーリソースの使用に関する個々のアカウントの制限を許可しています:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          アカウントが発行できるクエリーの数/時間
        </p></li><li class="listitem"><p>
          アカウントが発行できる更新の数/時間
        </p></li><li class="listitem"><p>
          アカウントが 1 時間ごとにサーバーに接続できる回数
        </p></li><li class="listitem"><p>
          アカウントによるサーバーへの同時接続の数
        </p></li></ul></div><p>
      クライアントがクエリー制限に対してカウントを発行できるステートメント。 更新制限に対して、データベースまたはテーブルを変更するステートメントのみがカウントされます。 
    </p><p>
      このコンテキストの <span class="quote">「<span class="quote">account</span>」</span> は、<code class="literal">mysql.user</code> システムテーブルの行に対応します。 つまり、接続に適用される <code class="literal">user</code> テーブル行内の <code class="literal">User</code> および <code class="literal">Host</code> 値に対して、接続が評価されます。 たとえば、アカウント <code class="literal">'usera'@'%.example.com'</code> は、<code class="literal">example.com</code> ドメイン内の任意のホストから接続することを <code class="literal">usera</code> に許可するために、<code class="literal">usera</code> および <code class="literal">%.example.com</code> の <code class="literal">User</code> および <code class="literal">Host</code> 値を持つ <code class="literal">user</code> テーブル内の行に対応しています。 この場合、このような接続ではすべて同じアカウントが使用されるため、サーバーは、<code class="literal">usera</code> による <code class="literal">example.com</code> ドメイン内の任意のホストからのすべての接続に、この行のリソース制限をまとめて適用します。 
    </p><p>
      MySQL 5.0 よりも前では、ユーザーの接続元である実際のホストに対して、<span class="quote">「<span class="quote">アカウント</span>」</span>が評価されていました。 この古いアカウンティング方法は、<code class="option">--old-style-user-limits</code> オプションを使用してサーバーを起動することで選択できます。 この場合、<code class="literal">usera</code> が <code class="literal">host1.example.com</code> と <code class="literal">host2.example.com</code> から同時に接続すると、サーバーは各接続に個別にアカウントリソースの制限を適用します。 <code class="literal">usera</code> が <code class="literal">host1.example.com</code> から再度接続すると、サーバーはそのホストからの既存の接続とともに、その接続に対する制限を適用します。 
    </p><p>
      アカウントの作成時にアカウントのリソース制限を確立するには、<code class="literal">CREATE USER</code> ステートメントを使用します。 既存のアカウントの制限を変更するには、<code class="literal">ALTER USER</code> を使用します。 制限される各リソースの名前を指定する <code class="literal">WITH</code> 句を指定します。 各制限のデフォルト値は、ゼロ (制限なし) です。 たとえば、制限された方法でのみ <code class="literal">customer</code> データベースにアクセスできる新しいアカウントを作成するには、次のようなステートメントを発行します。 
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER 'francis'@'localhost' IDENTIFIED BY 'frank'</code></strong>
    -&gt; <strong class="userinput"><code>    WITH MAX_QUERIES_PER_HOUR 20</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_UPDATES_PER_HOUR 10</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_CONNECTIONS_PER_HOUR 5</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_USER_CONNECTIONS 2;</code></strong>
</pre><p>
      制限タイプの名前をすべて <code class="literal">WITH</code> 句に指定する必要はありませんが、名前を指定したものは任意の順序で表示できます。 1 時間ごとの各制限の値は、1 時間当たりの回数を表す整数にするようにしてください。 <code class="literal">MAX_USER_CONNECTIONS</code> では、制限はアカウントによる同時接続の最大数を表す整数です。 この制限がゼロに設定されている場合は、グローバルな <code class="literal">max_user_connections</code> システム変数の値によって同時接続の数が決定されます。 <code class="literal">max_user_connections</code> もゼロである場合は、アカウントに制限がありません。 
    </p><p>
      既存のアカウントの制限を変更するには、<code class="literal">ALTER USER</code> ステートメントを使用します。 次のステートメントは、<code class="literal">francis</code> に対するクエリー制限を 100 に変更します。 
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER USER 'francis'@'localhost' WITH MAX_QUERIES_PER_HOUR 100;</code></strong>
</pre><p>
      このステートメントは、指定された制限値のみを変更し、それ以外のアカウントは未変更のままにします。
    </p><p>
      制限を削除するには、その値をゼロに設定します。 たとえば、<code class="literal">francis</code> が接続できる 1 時間当たりの回数に対する制限を削除するには、次のステートメントを使用します。 
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER USER 'francis'@'localhost' WITH MAX_CONNECTIONS_PER_HOUR 0;</code></strong>
</pre><p>
      すでに説明したように、アカウントに対する同時接続の制限は、<code class="literal">MAX_USER_CONNECTIONS</code> 制限および <code class="literal">max_user_connections</code> システム変数によって決定されます。 グローバル <code class="literal">max_user_connections</code> 値が 10 で、3 つのアカウントに次のように個別のリソース制限が指定されているとします: 
    </p><pre class="programlisting">ALTER USER 'user1'@'localhost' WITH MAX_USER_CONNECTIONS 0;
ALTER USER 'user2'@'localhost' WITH MAX_USER_CONNECTIONS 5;
ALTER USER 'user3'@'localhost' WITH MAX_USER_CONNECTIONS 20;
</pre><p>
      <code class="literal">user1</code> の接続制限は、<code class="literal">MAX_USER_CONNECTIONS</code> 制限がゼロであるため、10 (グローバル <code class="literal">max_user_connections</code> 値) です。<code class="literal">user2</code> および <code class="literal">user3</code> には、ゼロ以外の <code class="literal">MAX_USER_CONNECTIONS</code> 制限があるため、それぞれ接続制限は 5 および 20 です。
    </p><p>
      サーバーはアカウントに対応する <code class="literal">user</code> テーブル行に、アカウントに対するリソース制限を格納します。 <code class="literal">max_questions</code>、<code class="literal">max_updates</code>、または <code class="literal">max_connections</code> カラムには、1 時間当たりの制限が格納され、<code class="literal">max_user_connections</code> カラムには、<code class="literal">MAX_USER_CONNECTIONS</code> の制限が格納されます。 (<a class="xref" href="security.html#grant-tables" title="6.2.3 付与テーブル">セクション6.2.3「付与テーブル」</a>を参照してください。) 
    </p><p>
      任意のアカウントによるリソースのいずれかの使用に対してゼロ以外の制限が設定されている場合は、リソース使用のカウントが発生します。
    </p><p>
      サーバーが実行されると、各アカウントがリソースを使用する回数がカウントされます。 アカウントが過去 1 時間以内の接続数の制限に達した場合、サーバーはその時間が稼働するまでアカウントのそれ以上の接続を拒否します。 同様に、アカウントがクエリーまたは更新の数の制限に達した場合、サーバーは時間が稼働するまでそれ以上のクエリーまたは更新を拒否します。 このような場合、サーバーは適切なエラーメッセージを発行します。 
    </p><p>
      リソースカウントは、クライアントごとではなく、アカウントごとに行われます。 たとえば、アカウントのクエリー制限が 50 である場合は、サーバーへの 2 つの同時クライアント接続を作成しても、制限を 100 に増加できません。 両方の接続で発行されたクエリーは、まとめてカウントされます。 
    </p><p>
      現在の 1 時間ごとのリソース使用のカウントは、すべてのアカウントに対してグローバルにリセットすることも、特定のアカウントごとに個別にリセットすることもできます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          すべてのアカウントに対して現在のカウントをゼロにリセットするには、<code class="literal">FLUSH USER_RESOURCES</code> ステートメント発行します。 また、(たとえば、<code class="literal">FLUSH PRIVILEGES</code> ステートメントまたは <span class="command"><strong>mysqladmin reload</strong></span> コマンドを使用して) 付与テーブルを再ロードして、カウントをリセットすることもできます。 
        </p></li><li class="listitem"><p>
          個々のアカウントのカウントは、制限のいずれかを再度設定することでゼロにリセットできます。 アカウントに現在割り当てられている値と等しい制限値を指定します。 
        </p></li></ul></div><p>
      時間ごとのカウンタのリセットは、<code class="literal">MAX_USER_CONNECTIONS</code> の制限には影響しません。
    </p><p>
      すべてのカウントは、サーバーの起動時にゼロから始まります。 カウントはサーバーの再起動を引き継ぎません。 
    </p><p>
      <code class="literal">MAX_USER_CONNECTIONS</code> の制限では、アカウントが許可されている接続の最大数を現在開いている場合に、エッジケースが発生する可能性があります。接続が発生する時点までにサーバーで切断が完全に処理されていない場合に、切断後にすぐに接続すると、エラー (<code class="literal">ER_TOO_MANY_USER_CONNECTIONS</code> または <code class="literal">ER_USER_LIMIT_REACHED</code>) が発生する可能性があります。 サーバーが切断処理を終了すると、別の接続が許可されます。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="problems-connecting"></a>6.2.21 MySQL への接続の問題のトラブルシューティング</h3></div></div></div><a class="indexterm" name="idm46723761476336"></a><a class="indexterm" name="idm46723761475024"></a><a class="indexterm" name="idm46723761472832"></a><p>
      MySQL サーバーへの接続を試行したときに問題が発生した場合に問題を修正するために実行できる一連のアクションについて、次の項目で説明します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          サーバーが実行中であることを確認します。 そうでない場合、クライアントは接続できません。 たとえば、サーバーに接続しようとして次のいずれかのようなメッセージで失敗した場合、サーバーが実行中でないことが 1 つの原因であることがあります。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql</code></strong>
ERROR 2003: Can't connect to MySQL server on '<em class="replaceable"><code>host_name</code></em>' (111)
shell&gt; <strong class="userinput"><code>mysql</code></strong>
ERROR 2002: Can't connect to local MySQL server through socket
'/tmp/mysql.sock' (111)
</pre></li><li class="listitem"><p>
          サーバーは実行しているが、サーバーが待機しているのと異なる TCP/IP ポート、名前付きパイプ、または Unix ソケットファイルを使用して接続しようとしている場合もあります。 これを修正するには、クライアントプログラムを呼び出すときに、適切なポート番号を指すように <code class="option">--port</code> オプションを指定するか、<code class="option">--socket</code> で適切な名前付きパイプまたは Unix ソケットファイルを指定します。 ソケットファイルがある場所を見つけるには、次のコマンドを使用できます。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>netstat -ln | grep mysql</code></strong>
</pre></li><li class="listitem"><p>
          サーバーがネットワーク接続を無視するように構成されていないこと、または (リモート側から接続しようとする場合に) サーバーのネットワークインタフェース上でローカル側でのみ待機するように構成されていないことを確認します。 <code class="literal">skip_networking</code> システム変数を有効にしてサーバーを起動した場合、TCP/IP 接続は受け入れられません。 <code class="literal">bind_address</code> システム変数を <code class="literal">127.0.0.1</code> に設定してサーバーを起動した場合、サーバーはループバックインタフェースでローカルでのみ TCP/IP 接続をリスニングし、リモート接続を受け入れません。 
        </p></li><li class="listitem"><p>
          ファイアウォールが MySQL へのアクセスをブロックしていないか確認します。 ファイアウォールは、実行中のアプリケーションまたは MySQL によって通信用に使用されるポート番号 (デフォルトは 3306) を基準として構成されることがあります。 Linux または Unix の場合、IP テーブル (または同様の機能の) 構成を調べてポートがブロックされていないことを確認します。 Windows では、ZoneAlarm や Windows ファイアウォールなどのアプリケーションを、MySQL ポートをブロックしないように構成する必要がある場合があります。 
        </p></li><li class="listitem"><p>
          付与テーブルが適切にセットアップされており、サーバーがこれをアクセス制御に使用できるようになっていることが必要です。 一部の配布タイプ (Windows でのバイナリ配布、Linux での RPM および DEB 配布など) では、インストールプロセスによって、付与テーブルを含む <code class="literal">mysql</code> システムデータベースを含む MySQL データディレクトリが初期化されます。 これを行わない配布の場合は、データディレクトリを手動で初期化する必要があります。 詳細は、<a class="xref" href="installing.html#postinstallation" title="2.10 インストール後のセットアップとテスト">セクション2.10「インストール後のセットアップとテスト」</a>を参照してください。 
        </p><p>
          付与テーブルの初期化が必要かどうかを判別するには、データディレクトリの下にある <code class="filename">mysql</code> ディレクトリを参照します。 (通常、データディレクトリは <code class="filename">data</code> または <code class="filename">var</code> という名前で、MySQL のインストールディレクトリの下にあります。) <code class="filename">mysql</code> データベースディレクトリに <code class="filename">user.MYD</code> という名前のファイルがあることを確認してください。 そうでない場合は、データディレクトリを初期化します。 これを行ってサーバーを起動すると、サーバーに接続できるようになります。 
        </p></li><li class="listitem"><p>
          新規インストールの後、パスワードを使用せずに <code class="literal">root</code> としてサーバーにログオンしようとすると、次のエラーメッセージが表示されることがあります。
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u root </code></strong>
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
</pre><p>
          これは、インストール時に root パスワードがすでに割り当てられており、指定する必要があることを意味します。 パスワードが割り当てられている様々な方法、およびパスワードの検索方法については、<a class="xref" href="installing.html#default-privileges" title="2.10.4 初期 MySQL アカウントの保護">セクション2.10.4「初期 MySQL アカウントの保護」</a> を参照してください。 root パスワードをリセットする必要がある場合は、<a class="xref" href="error-handling.html#resetting-permissions" title="B.3.3.2 root のパスワードをリセットする方法">セクションB.3.3.2「root のパスワードをリセットする方法」</a> の手順を参照してください。 パスワードを検出またはリセットした後、<code class="option">--password</code> (または <code class="option">-p</code>) オプションを使用して <code class="literal">root</code> として再度ログオンします: 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u root -p</code></strong>
Enter password:
</pre><p>
          ただし、<span class="command"><strong>mysqld --initialize-insecure</strong></span> を使用して MySQL を初期化した場合、サーバーはパスワードを使用せずに <code class="literal">root</code> として接続できます (詳細は <a class="xref" href="installing.html#data-directory-initialization" title="2.10.1 データディレクトリの初期化">セクション2.10.1「データディレクトリの初期化」</a> を参照)。 これはセキュリティ上のリスクであるため、<code class="literal">root</code> アカウントのパスワードを設定する必要があります。手順は、<a class="xref" href="installing.html#default-privileges" title="2.10.4 初期 MySQL アカウントの保護">セクション2.10.4「初期 MySQL アカウントの保護」</a> を参照してください。 
        </p></li><li class="listitem"><p>
          既存の MySQL インストールを新しいバージョンに更新した場合、MySQL のアップグレード手順を実行しましたか。 行なっていない場合は実行します。 付与テーブルの構造は、新機能が追加されるときにしばしば変更されるため、アップグレードしたあとは常に、テーブルの構造が最新であることを確認することをお勧めします。 その手順は、<a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          クライアントプログラムが接続しようとしたときに次のエラーメッセージを受け取る場合、サーバーはクライアントが生成可能なものよりも新しい形式のパスワードを予期していることを意味します。
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql</code></strong>
Client does not support authentication protocol requested
by server; consider upgrading MySQL client
</pre></li><li class="listitem"><p>
          <a class="indexterm" name="idm46723761424768"></a> <a class="indexterm" name="idm46723761423280"></a> <a class="indexterm" name="idm46723761421920"></a> <a class="indexterm" name="idm46723761420560"></a> <a class="indexterm" name="idm46723761419152"></a>クライアントプログラムは、オプションファイルまたは環境変数で指定された接続パラメータを使用することに注意してください。 コマンド行に接続パラメータを指定しないときにクライアントプログラムが間違ったデフォルトの接続パラメータを送信していると思われる場合、該当するオプションファイルおよび環境を確認してください。 たとえば、オプションなしでクライアントを実行するときに <code class="literal">Access denied</code> を受け取る場合、いずれかのオプションファイルで古いパスワードを指定していないか確認してください。 
        </p><p>
          <code class="option">--no-defaults</code> を指定してクライアントプログラムを呼び出すことによって、オプションファイルの使用をクライアントプログラムによって抑制することができます。 例: 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin --no-defaults -u root version</code></strong>
</pre><p>
          クライアントが使用するオプションファイルの一覧は、<a class="xref" href="programs.html#option-files" title="4.2.2.2 オプションファイルの使用">セクション4.2.2.2「オプションファイルの使用」</a>にあります。 環境変数の一覧は、<a class="xref" href="programs.html#environment-variables" title="4.9 環境変数">セクション4.9「環境変数」</a>にあります。 
        </p></li><li class="listitem"><p>
          次のエラーが出る場合、誤った <code class="literal">root</code> パスワードを使用していることを示しています。
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> ver</code></strong>
Access denied for user 'root'@'localhost' (using password: YES)
</pre><p>
          パスワードを指定していないのに前述のエラーが発生する場合、いずれかのオプションファイルに間違ったパスワードがリストされていることを意味します。 前述の項目で説明したように、<code class="option">--no-defaults</code> オプションを試してみてください。 
        </p><p>
          パスワードの変更に関する情報は、<a class="xref" href="security.html#assigning-passwords" title="6.2.14 アカウントパスワードの割り当て">セクション6.2.14「アカウントパスワードの割り当て」</a>を参照してください。
        </p><p>
          <code class="literal">root</code> パスワードを紛失したか忘れた場合、<a class="xref" href="error-handling.html#resetting-permissions" title="B.3.3.2 root のパスワードをリセットする方法">セクションB.3.3.2「root のパスワードをリセットする方法」</a>を参照してください。
        </p></li><li class="listitem"><p>
          <code class="literal">localhost</code> はローカルホスト名のシノニムで、ホストを明示的に指定しない場合にクライアントが接続を試行するデフォルトホストでもあります。
        </p><p>
          <code class="option">--host=127.0.0.1</code> オプションを使用して、サーバーホストに明示的に名前を付けることができます。 これにより、ローカル <span class="command"><strong>mysqld</strong></span> サーバーへの TCP/IP 接続が発生します。 また、ローカルホストの実際のホスト名を使用する <code class="option">--host</code> オプションを指定することによって TCP/IP を使用することもできます。 この場合、サーバーと同じホスト上でクライアントプログラムを実行していても、ホスト名がサーバーホスト上の <code class="literal">user</code> テーブル行に指定されていなければなりません。 
        </p></li><li class="listitem"><p>
          <code class="literal">Access denied</code> というエラーメッセージは、ログインしようとしているユーザー名、接続を試行しているクライアントホスト、およびパスワードを使用したかどうかを通知します。 通常では、エラーメッセージ内で指定されたホスト名およびユーザー名に正確に一致する 1 つの行を <code class="literal">user</code> テーブル内に持つようにします。 たとえば、<code class="literal">using password: NO</code> というメッセージを含むエラーメッセージを受け取る場合、パスワードなしでログインしようとしたことを意味します。 
        </p></li><li class="listitem"><p>
          <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em></code> を使用してデータベースに接続しようとしたときに <code class="literal">Access denied</code> エラーを受け取った場合、<code class="literal">user</code> テーブルにおそらく問題があります。 これをチェックするには、<code class="literal">mysql -u root mysql</code> を実行し、次の SQL ステートメントを発行します。 
        </p><pre class="programlisting">SELECT * FROM user;
</pre><p>
          この結果には、クライアントのホスト名および使用中の MySQL ユーザー名に一致する <code class="literal">Host</code> および <code class="literal">User</code> カラムを持つ行が含まれているはずです。
        </p></li><li class="listitem"><p>
          MySQL サーバーを実行しているホストではないホストから接続しようとして次のエラーが発生する場合、クライアントホストと一致する <code class="literal">Host</code> 値を持つ行が <code class="literal">user</code> テーブルにないということを意味しています。
        </p><pre class="programlisting">Host ... is not allowed to connect to this MySQL server
</pre><p>
          これは、接続しようとするときに使用するクライアントホスト名およびユーザー名の組み合わせに対するアカウントをセットアップすることによって修正できます。
        </p><p>
          接続元のマシンの IP アドレスまたはホスト名がわからない場合、<code class="literal">Host</code> カラム値が <code class="literal">'%'</code> の行を <code class="literal">user</code> テーブル内に作成するようにします。 そして、そのクライアントマシンから接続しようとしたあとで、<code class="literal">SELECT USER()</code> クエリーを使用して、実際にどのように接続したかを確認します。 そのあと、<code class="literal">user</code> テーブル行の <code class="literal">'%'</code> を、ログに表示されている実際のホスト名に変更します。 そうしない場合、特定のユーザー名について任意のホストからの接続が可能になるため、システムはセキュアでない状態のままになります。 
        </p><p>
          Linux では、このエラーが発生する可能性がある別の理由として、使用中のバージョンとは異なるバージョンの <code class="literal">glibc</code> ライブラリでコンパイルされたバイナリ MySQL バージョンを使用しているということがあります。 この場合、オペレーティングシステムまたは <code class="literal">glibc</code> をアップグレードするか、MySQL のソース配布バージョンをダウンロードして自分でコンパイルします。 ソース RPM のコンパイルおよびインストールは通常簡単であるため、これは大きな問題ではありません。 
        </p></li><li class="listitem"><p>
          接続しようとしたときにホスト名を指定したが、ホスト名が非表示または IP アドレスとなっているエラーメッセージを受け取った場合、MySQL サーバーはクライアントホストの IP アドレスを名前に解決しようとしたときにエラーを受け取ったことを意味します。
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> -h <em class="replaceable"><code>some_hostname</code></em> ver</code></strong>
Access denied for user 'root'@'' (using password: YES)
</pre><p>
          <code class="literal">root</code> として接続しようとして次のエラーを受け取った場合、<code class="literal">User</code> カラム値が <code class="literal">'root'</code> の行が <code class="literal">user</code> テーブルになく、<span class="command"><strong>mysqld</strong></span> がクライアントに対してホスト名を解決できないことを意味します。
        </p><pre class="programlisting">Access denied for user ''@'unknown'
</pre><p>
          これらのエラーは DNS の問題を示しています。 これを修正するには、<span class="command"><strong>mysqladmin flush-hosts</strong></span> を実行して内部 DNS ホストキャッシュをリセットします。 <a class="xref" href="server-administration.html#host-cache" title="5.1.12.3 DNS ルックアップとホストキャッシュ">セクション5.1.12.3「DNS ルックアップとホストキャッシュ」</a>を参照してください。 
        </p><p>
          いくつかの永続的な解決策を次に示します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              DNS サーバーの問題を判別して修正します。
            </p></li><li class="listitem"><p>
              MySQL 付与テーブルにホスト名の代わりに IP アドレスを指定します。
            </p></li><li class="listitem"><p>
              クライアントマシン名に対するエントリを、Unix の場合は <code class="filename">/etc/hosts</code> に、Windows の場合は <code class="filename">\windows\hosts</code> に配置します。
            </p></li><li class="listitem"><p>
              <code class="literal">skip_name_resolve</code> システム変数を有効にして <span class="command"><strong>mysqld</strong></span> を起動します。
            </p></li><li class="listitem"><p>
              <span class="command"><strong>mysqld</strong></span> を <code class="option">--skip-host-cache</code> オプションで起動します。
            </p></li><li class="listitem"><p>
              Unix で、サーバーとクライアントを同じマシンで実行している場合、<code class="literal">localhost</code> に接続します。 <code class="literal">localhost</code> への接続の場合、MySQL プログラムは、クライアントが TCP/IP 接続を確立するための接続パラメータが指定されていないかぎり、Unix ソケットファイルを使用してローカルサーバーへの接続を試みます。 詳細は、<a class="xref" href="programs.html#connecting" title="4.2.4 コマンドオプションを使用した MySQL Server への接続">セクション4.2.4「コマンドオプションを使用した MySQL Server への接続」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              Windows で、サーバーとクライアントを同じマシンで実行していて、サーバーが名前付きパイプ接続をサポートしている場合、ホスト名 <code class="literal">.</code> (ピリオド) に接続します。 <code class="literal">.</code> への接続には、TCP/IP ではなく名前付きパイプが使用されます。 
            </p></li></ul></div></li><li class="listitem"><p>
          <code class="literal">mysql -u root</code> は動作するが、<code class="literal">mysql -h <em class="replaceable"><code>your_hostname</code></em> -u root</code> によって <code class="literal">Access denied</code> (<em class="replaceable"><code>your_hostname</code></em> はローカルホストの実際のホスト名) が生成される場合、<code class="literal">user</code> テーブルにホストの正しい名前がない可能性があります。 このときよくある問題として、<code class="literal">user</code> テーブル行の <code class="literal">Host</code> 値は、修飾されていないホスト名を指定しているが、システムの名前解決ルーチンは完全修飾ドメイン名を返すということ (またはその逆) があります。 たとえば、<code class="literal">user</code> テーブルにホスト<code class="literal">'pluto'</code>を含む行があり、ホスト名が<code class="literal">'pluto.example.com'</code>であることを DNS が MySQL に通知した場合、その行は機能しません。 ホストの IP アドレスを <code class="literal">Host</code> カラム値として含む行を <code class="literal">user</code> テーブルに追加してみます。 (または、ワイルドカードを含む <code class="literal">Host</code> 値 (<code class="literal">'pluto.%'</code>など) を使用して、<code class="literal">user</code> テーブルに行を追加できます。 ただし、<code class="literal">%</code>で終わる <code class="literal">Host</code> 値を使用することは<span class="emphasis"><em>安全でない</em></span>ため推奨<span class="emphasis"><em>されません</em></span>。) 
        </p></li><li class="listitem"><p>
          <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em></code> は動作するが、<code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>some_db</code></em></code> は動作しない場合、<em class="replaceable"><code>some_db</code></em> という名前のデータベースに対する特定のユーザーへのアクセス権を付与していません。
        </p></li><li class="listitem"><p>
          <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em></code> をサーバーホスト上で実行したときに動作するが、<code class="literal">mysql -h <em class="replaceable"><code>host_name</code></em> -u <em class="replaceable"><code>user_name</code></em></code> をリモートクライアントホスト上で実行したときに動作しない場合、特定のユーザー名についてリモートホストからサーバーへのアクセスを有効にしていません。
        </p></li><li class="listitem"><p>
          <code class="literal">Access denied</code> を取得する理由がわからない場合は、ワイルドカード (<code class="literal">'%'</code>または<code class="literal">'_'</code>文字を含む行) を含む <code class="literal">Host</code> 値を持つすべての行を <code class="literal">user</code> テーブルから削除します。 非常に一般的なエラーは、<code class="literal">Host</code> = <code class="literal">'%'</code>および <code class="literal">User</code> = <code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code>を使用して新しい行を挿入することです。これにより、<code class="literal">localhost</code> を指定して同じマシンから接続できると考えられます。 これが機能しない理由は、デフォルトの権限に <code class="literal">Host</code> = <code class="literal">'localhost'</code>および <code class="literal">User</code> = <code class="literal">''</code>の行が含まれているためです。 その行には<code class="literal">'%'</code>よりも具体的な <code class="literal">Host</code> 値<code class="literal">'localhost'</code>があるため、<code class="literal">localhost</code> から接続するときに新しい行よりも優先して使用されます。 正しい手順は、<code class="literal">Host</code> = <code class="literal">'localhost'</code>および <code class="literal">User</code>=<code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code>を使用して 2 行目を挿入するか、<code class="literal">Host</code> = <code class="literal">'localhost'</code>および <code class="literal">User</code> = <code class="literal">''</code>を使用して行を削除することです。 行を削除した後は、必ず <code class="literal">FLUSH PRIVILEGES</code> ステートメントを発行して付与テーブルをリロードしてください。 <a class="xref" href="security.html#connection-access" title="6.2.6 アクセス制御、ステージ 1: 接続の検証">セクション6.2.6「アクセス制御、ステージ 1: 接続の検証」</a>も参照してください。 
        </p></li><li class="listitem"><p>
          MySQL サーバーに接続できても、<code class="literal">SELECT ... INTO OUTFILE</code> または <code class="literal">LOAD DATA</code> ステートメントを発行するたびに <code class="literal">Access denied</code> メッセージが表示される場合、<code class="literal">user</code> テーブルの行で <code class="literal">FILE</code> 権限が有効になっていません。
        </p></li><li class="listitem"><p>
          付与テーブルを直接 (たとえば、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、または <code class="literal">DELETE</code> ステートメントを使用して) 変更し、変更が無視されたように思われる場合、サーバーに権限テーブルをリロードさせるために <code class="literal">FLUSH PRIVILEGES</code> ステートメントまたは <span class="command"><strong>mysqladmin flush-privileges</strong></span> コマンドを実行する必要があることを覚えておいてください。 そうしない場合、サーバーが次回再起動するまで変更の影響はありません。 <code class="literal">UPDATE</code> ステートメントを使用して <code class="literal">root</code> のパスワードを変更した後は、権限をフラッシュするまで新しいパスワードを指定する必要はありません。これは、パスワードを変更するまでサーバーが認識しないためです。 
        </p></li><li class="listitem"><p>
          セッションの最中に権限が変更されたと思われる場合、MySQL 管理者によって権限が変更された可能性があります。 付与テーブルのリロードは、新しいクライアント接続に影響しますが、<a class="xref" href="security.html#privilege-changes" title="6.2.13 権限変更が有効化される時期">セクション6.2.13「権限変更が有効化される時期」</a>に示すように既存の接続にも影響します。 
        </p></li><li class="listitem"><p>
          Perl、PHP、Python または ODBC プログラムでアクセスの問題が発生した場合は、<code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>db_name</code></em></code> または <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em> -p<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code> を使用してサーバーに接続してみてください。 <span class="command"><strong>mysql</strong></span> クライアントを使用して接続できる場合、問題はアクセス権限ではなくプログラムにあります。 (<code class="option">-p</code> とパスワードの間に空白はありません。<code class="option">--password=<em class="replaceable"><code>password</code></em></code> 構文を使用してパスワードを指定することもできます。 <code class="option">-p</code> または <code class="option">--password</code> オプションを使用してパスワード値を指定しない場合、MySQL はパスワードを要求します。) 
        </p></li><li class="listitem"><p>
          テスト目的で、<code class="option">--skip-grant-tables</code> オプションを指定して <span class="command"><strong>mysqld</strong></span> サーバーを起動します。 これにより、MySQL 付与テーブルを変更でき、<code class="literal">SHOW GRANTS</code> ステートメントを使用して、変更による望ましい影響があるかどうかを確認することができます。 変更に満足したら、<span class="command"><strong>mysqladmin flush-privileges</strong></span> を実行して、権限をリロードするよう <span class="command"><strong>mysqld</strong></span> サーバーに指示します。 これにより、サーバーを停止して再起動することなく新しい付与テーブルの内容の使用を開始することができます。 
        </p></li><li class="listitem"><p>
          すべてが失敗する場合、<span class="command"><strong>mysqld</strong></span> サーバーをデバッグオプション (<code class="option">--debug=d,general,query</code> など) で起動します。 これによって、発行された各コマンドに関する情報のほかに、試行された接続についてのホストおよびユーザー情報が出力されます。 <a class="xref" href="server-administration.html#dbug-package" title="5.9.4 DBUG パッケージ">セクション5.9.4「DBUG パッケージ」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          MySQL 付与テーブルにその他の問題があり、<a class="ulink" href="https://mysqlcommunity.slack.com/" target="_top">MySQL Community Slack</a> で確認する場合は、常に MySQL 付与テーブルのダンプを提供してください。 <span class="command"><strong>mysqldump mysql</strong></span> コマンドでテーブルをダンプできます。 バグレポートを提出するには、<a class="xref" href="introduction.html#bug-reports" title="1.6 質問またはバグをレポートする方法">セクション1.6「質問またはバグをレポートする方法」</a>の説明を参照してください。 <span class="command"><strong>mysqldump</strong></span> を実行するには <code class="option">--skip-grant-tables</code> を指定して <span class="command"><strong>mysqld</strong></span> を再起動することが必要な場合もあります。 
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="account-activity-auditing"></a>6.2.22 SQL ベースのアカウントアクティビティ監査</h3></div></div></div><p>
      アプリケーションは次のガイドラインを使用することで、データベースアクティビティーを MySQL アカウントに関連付ける SQL ベースの監査を実行できます。
    </p><p>
      MySQL アカウントは、<code class="literal">mysql.user</code> システムテーブルの行に対応します。 クライアントが正常に接続すると、サーバーはこのテーブル内の特定の行にアクセスするクライアントを認証します。 この行の <code class="literal">User</code> および <code class="literal">Host</code> カラムの値は、アカウントを一意に識別し、アカウント名が SQL ステートメントに書き込まれる <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code> 形式に対応します。 
    </p><p>
      クライアントを認証する際に使用されるアカウントによって、クライアントが持っている権限が特定されます。 通常、<code class="literal">CURRENT_USER()</code> 関数を呼び出すと、このアカウントがどのクライアントユーザー用であるかを特定できます。 その値は、アカウントの <code class="literal">user</code> テーブル行の <code class="literal">User</code> および <code class="literal">Host</code> カラムで構成されています。 
    </p><p>
      ただし、<code class="literal">CURRENT_USER()</code> 値がクライアントユーザーではなく、別のアカウントに対応するという状況もあります。 これは、権限チェックがクライアントのアカウントに基づいて実行されないコンテキストで発生します。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">SQL SECURITY DEFINER</code> 特性を使用して定義されたストアドルーチン (プロシージャーおよび関数)
        </p></li><li class="listitem"><p>
          <code class="literal">SQL SECURITY DEFINER</code> 特性を使用して定義されたビュー
        </p></li><li class="listitem"><p>
          トリガーとイベント
        </p></li></ul></div><p>
      このようなコンテキストでは、権限チェックは <code class="literal">DEFINER</code> アカウントと照合して実行され、<code class="literal">CURRENT_USER()</code> はそのアカウントを参照し、ストアドルーチンまたはビューを呼び出したクライアント、またはトリガーをアクティブにしたクライアントのアカウントは参照しません。 クライアントおよびクライアントの接続元ホストによって指定された実際のユーザー名を示す値を返す <code class="literal">USER()</code> 関数を呼び出すと、呼び出し元のユーザーを特定できます。 ただし、<code class="literal">USER()</code> の値にはワイルドカードが含まれない一方で、(<code class="literal">CURRENT_USER()</code> によって返される) アカウントの値にはユーザー名およびホスト名のワイルドカードが含まれる可能性があるため、この値は必ずしも、<code class="literal">user</code> テーブル内のアカウントに直接対応するとはかぎりません。 
    </p><p>
      たとえば、空白のユーザー名は任意のユーザーに一致するため、<code class="literal">''@'localhost'</code> のアカウントを使用すると、クライアントは任意のユーザー名を持つローカルホストから匿名ユーザーとして接続できます。 この場合、クライアントがローカルホストから <code class="literal">user1</code> として接続すると、<code class="literal">USER()</code> と <code class="literal">CURRENT_USER()</code> は異なる値を返します: 
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+-----------------+----------------+
| USER()          | CURRENT_USER() |
+-----------------+----------------+
| user1@localhost | @localhost     |
+-----------------+----------------+
</pre><p>
      アカウントのホスト名部分にワイルドカードを含めることもできます。 ホスト名に<code class="literal">'%'</code>または<code class="literal">'_'</code>パターン文字が含まれているか、ネットマスク表記法を使用している場合、アカウントは複数のホストから接続しているクライアントに使用でき、<code class="literal">CURRENT_USER()</code> 値はどちらかを示しません。 たとえば、アカウント <code class="literal">'user2'@'%.example.com'</code> を使用すると、<code class="literal">user2</code> が <code class="literal">example.com</code> ドメイン内の任意のホストから接続できます。 <code class="literal">user2</code> が <code class="literal">remote.example.com</code> から接続すると、<code class="literal">USER()</code> と <code class="literal">CURRENT_USER()</code> は別々の値を返します。 
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+--------------------------+---------------------+
| USER()                   | CURRENT_USER()      |
+--------------------------+---------------------+
| user2@remote.example.com | user2@%.example.com |
+--------------------------+---------------------+
</pre><p>
      アプリケーションがユーザーを監査するために <code class="literal">USER()</code> を呼び出す必要があるが (たとえば、トリガー内から監査を実行する場合)、<code class="literal">USER()</code> の値を <code class="literal">user</code> テーブル内のアカウントに関連付けることができる必要もある場合は、アカウントの <code class="literal">User</code> または <code class="literal">Host</code> カラムにワイルドカードが含まれることを回避する必要があります。 特に、<code class="literal">User</code> を (匿名のユーザーアカウントが作成される) 空にすることは許可しないでください。また、<code class="literal">Host</code> の値に、パターン文字またはネットマスク表記を使用することも許可しないでください。 すべてのアカウントには、空でない <code class="literal">User</code> 値とリテラルの <code class="literal">Host</code> 値を含める必要があります。 
    </p><p>
      前述の例に関しては、ワイルドカードが使用されないように <code class="literal">''@'localhost'</code> および <code class="literal">'user2'@'%.example.com'</code> アカウントを変更するようにしてください。
    </p><pre class="programlisting">RENAME USER ''@'localhost' TO 'user1'@'localhost';
RENAME USER 'user2'@'%.example.com' TO 'user2'@'remote.example.com';
</pre><p>
      <code class="literal">user2</code> が <code class="literal">example.com</code> ドメイン内の複数のホストから接続できる必要がある場合は、ホストごとに個別のアカウントにするべきです。
    </p><p>
      <code class="literal">CURRENT_USER()</code> または <code class="literal">USER()</code> の値からユーザー名またはホスト名の部分を抽出するには、<code class="literal">SUBSTRING_INDEX()</code> 関数を使用します。
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',1);</code></strong>
+---------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',1) |
+---------------------------------------+
| user1                                 |
+---------------------------------------+

mysql&gt; <strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',-1);</code></strong>
+----------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',-1) |
+----------------------------------------+
| localhost                              |
+----------------------------------------+
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="encrypted-connections"></a>6.3 暗号化された接続の使用</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#using-encrypted-connections">6.3.1 暗号化接続を使用するための MySQL の構成</a></span></dt><dt><span class="section"><a href="security.html#encrypted-connection-protocols-ciphers">6.3.2 暗号化された接続 TLS プロトコルおよび暗号</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-rsa-files">6.3.3 SSL および RSA 証明書とキーの作成</a></span></dt><dt><span class="section"><a href="security.html#windows-and-ssh">6.3.4 SSH を使用した Windows から MySQL へのリモート接続</a></span></dt></dl></div><a class="indexterm" name="idm46723761190144"></a><a class="indexterm" name="idm46723761188704"></a><a class="indexterm" name="idm46723761187344"></a><a class="indexterm" name="idm46723761186432"></a><a class="indexterm" name="idm46723761185408"></a><a class="indexterm" name="idm46723761184320"></a><p>
    MySQL クライアントとサーバー間の暗号化されていない接続では、ネットワークへのアクセス権を持つユーザーがすべてのトラフィックを監視し、クライアントとサーバー間で送受信されるデータを検査できます。
  </p><a class="indexterm" name="idm46723761181232"></a><p>
    セキュアな方法でネットワーク経由で情報を移動する必要がある場合、暗号化されていない接続は受け入れられません。 あらゆる種類のデータを読み取れないようにするには、暗号化を使用します。 暗号化されたメッセージの順序を変更したり、データを 2 回再生したりするなどの、多くの種類の既知の攻撃に対抗するために、暗号化アルゴリズムには、セキュリティー要素を含める必要があります。 
  </p><p>
    MySQL では、TLS (トランスポート層セキュリティ) プロトコルを使用したクライアントとサーバー間の暗号化された接続をサポートしています。 TLS は SSL (Secure Sockets Layer) と呼ばれることもありますが、暗号化が弱いため、MySQL は実際には暗号化された接続に SSL プロトコルを使用しません (<a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.2 暗号化された接続 TLS プロトコルおよび暗号">セクション6.3.2「暗号化された接続 TLS プロトコルおよび暗号」</a> を参照)。 
  </p><p>
    TLS は暗号化アルゴリズムを使用して、パブリックネットワーク経由で受信したデータを確実に信頼できるようにします。 データの変更、損失またはリプレイを検出するメカニズムがあります。 TLS には、X.509 標準を使用したアイデンティティ検証を提供するアルゴリズムも組み込まれています。 
  </p><a class="indexterm" name="idm46723761176176"></a><p>
    X.509 インターネット上のユーザーを識別できるようにします。 基本的な用語には、必要とするすべてのユーザーに電子証明書を割り当てる<span class="quote">「<span class="quote">認証局</span>」</span> (CA) と呼ばれるエンティティーがいくつか存在するはずです。 証明書は、2 つの暗号化鍵 (公開鍵と秘密鍵) を持つ非対称の暗号化アルゴリズムに依存しています。 証明書の所有者は、別のパーティにアイデンティティ証明として証明書を提示できます。 証明書は、所有者の公開鍵で構成されます。 この公開キーを使用して暗号化されたデータは、証明書の所有者によって保持されている対応する秘密キーを使用してのみ復号化できます。 
  </p><p>
    MySQL での暗号化された接続のサポートは、OpenSSL を使用して提供されます。 OpenSSL でサポートされている暗号化プロトコルおよび暗号の詳細は、<a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.2 暗号化された接続 TLS プロトコルおよび暗号">セクション6.3.2「暗号化された接続 TLS プロトコルおよび暗号」</a> を参照してください。 
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
      MySQL 8.0.11 から 8.0.17 に、OpenSSL のかわりに wolfSSL を使用して MySQL をコンパイルできました。 MySQL 8.0.18 では、wolfSSL のサポートは削除され、すべての MySQL ビルドで OpenSSL が使用されます。 
    </p><a class="indexterm" name="idm46723761170256"></a></div><p>
    デフォルトでは、サーバーが暗号化された接続をサポートしている場合、MySQL プログラムは暗号化を使用して接続を試み、暗号化された接続を確立できない場合は暗号化されていない接続にフォールバックします。 暗号化された接続の使用に影響するオプションの詳細は、<a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a> および <a class="xref" href="programs.html#encrypted-connection-options" title="暗号化接続のコマンドオプション">暗号化接続のコマンドオプション</a> を参照してください。 
  </p><p>
    MySQL は接続ごとに暗号化を実行し、特定のユーザーの暗号化の使用はオプションまたは必須にできます。 これにより、個々のアプリケーションの要件に従って、暗号化された接続または暗号化されていない接続を選択できます。 暗号化された接続の使用をユーザーに要求する方法の詳細は、<a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a> の <code class="literal">CREATE USER</code> ステートメントの <code class="literal">REQUIRE</code> 句に関する説明を参照してください。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a> の <code class="literal">require_secure_transport</code> システム変数の説明も参照してください 
  </p><p>
    暗号化された接続は、ソースサーバーとレプリカサーバー間で使用できます。 <a class="xref" href="replication.html#replication-solutions-encrypted-connections" title="17.3.1 暗号化接続を使用するためのレプリケーションの設定">セクション17.3.1「暗号化接続を使用するためのレプリケーションの設定」</a>を参照してください。 
  </p><p>
    MySQL C API からの暗号化された接続の使用の詳細は、<a class="ulink" href="https://dev.mysql.com/doc/c-api/8.0/en/c-api-encrypted-connections.html" target="_top">Support for Encrypted Connections</a> を参照してください。
  </p><p>
    SSH 接続内から MySQL サーバーホストに暗号化を使用して接続することもできます。 例については、<a class="xref" href="security.html#windows-and-ssh" title="6.3.4 SSH を使用した Windows から MySQL へのリモート接続">セクション6.3.4「SSH を使用した Windows から MySQL へのリモート接続」</a>を参照してください。 
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="using-encrypted-connections"></a>6.3.1 暗号化接続を使用するための MySQL の構成</h3></div></div></div><a class="indexterm" name="idm46723761155408"></a><a class="indexterm" name="idm46723761153984"></a><a class="indexterm" name="idm46723761152000"></a><p>
      暗号化された接続を使用するかどうかを示し、適切な証明書およびキーファイルを指定するために、いくつかの構成パラメータを使用できます。 このセクションでは、暗号化された接続のためのサーバーおよびクライアントの構成に関する一般的なガイダンスを示します: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#using-encrypted-connections-server-side-startup-configuration" title="暗号化された接続のサーバー側の起動構成">暗号化された接続のサーバー側の起動構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#using-encrypted-connections-server-side-runtime-configuration" title="サーバー側のランタイム構成および暗号化された接続の監視">サーバー側のランタイム構成および暗号化された接続の監視</a></p></li><li class="listitem"><p><a class="xref" href="security.html#using-encrypted-connections-client-side-configuration" title="暗号化された接続のクライアント側の構成">暗号化された接続のクライアント側の構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#mandatory-encrypted-connections" title="暗号化された接続の必須としての構成">暗号化された接続の必須としての構成</a></p></li></ul></div><p>
      暗号化された接続は次のコンテキストでも使用できます:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ソースおよびレプリカレプリケーションサーバー間。 <a class="xref" href="replication.html#replication-solutions-encrypted-connections" title="17.3.1 暗号化接続を使用するためのレプリケーションの設定">セクション17.3.1「暗号化接続を使用するためのレプリケーションの設定」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          グループレプリケーションサーバー間。 <a class="xref" href="group-replication.html#group-replication-secure-socket-layer-support-ssl" title="18.5.2 Secure Socket Layer (SSL) を使用したグループ通信接続の保護">セクション18.5.2「Secure Socket Layer (SSL) を使用したグループ通信接続の保護」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          MySQL C API に基づくクライアントプログラム。 <a class="ulink" href="https://dev.mysql.com/doc/c-api/8.0/en/c-api-encrypted-connections.html" target="_top">Support for Encrypted Connections</a>を参照してください。 
        </p></li></ul></div><p>
      必要な証明書およびキーファイルを作成する手順は、<a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 SSL および RSA 証明書とキーの作成">セクション6.3.3「SSL および RSA 証明書とキーの作成」</a> で入手できます。
    </p><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="using-encrypted-connections-server-side-startup-configuration"></a>暗号化された接続のサーバー側の起動構成</h4></div></div></div><p>
        サーバー側では、<code class="option">--ssl</code> オプションは、サーバーが暗号化された接続を許可するが必要としないことを指定します。 このオプションはデフォルトで有効になっているため、明示的に指定する必要はありません。 
      </p><p>
        クライアントが暗号化された接続を使用して接続することを要求するには、<code class="literal">require_secure_transport</code> システム変数を有効にします。 <a class="xref" href="security.html#mandatory-encrypted-connections" title="暗号化された接続の必須としての構成">暗号化された接続の必須としての構成</a>を参照してください。 
      </p><p>
        サーバー側の次のシステム変数は、クライアントに暗号化された接続の確立を許可するときにサーバーが使用する証明書および鍵ファイルを指定します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ssl_ca</code>: 認証局 (CA) 証明書ファイルのパス名。(<code class="literal">ssl_capath</code> は類似していますが、CA 証明書ファイルのディレクトリのパス名を指定します。)
          </p></li><li class="listitem"><p>
            <code class="literal">ssl_cert</code>: サーバー公開キー証明書ファイルのパス名。 この証明書はクライアントに送信し、クライアントが持っている CA 証明書に対して認証できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">ssl_key</code>: サーバー秘密キーファイルのパス名。
          </p></li></ul></div><p>
        たとえば、サーバーで暗号化された接続を有効にするには、<code class="filename">my.cnf</code> ファイルの次の行でサーバーを起動し、必要に応じてファイル名を変更します:
      </p><pre class="programlisting">[mysqld]
ssl_ca=ca.pem
ssl_cert=server-cert.pem
ssl_key=server-key.pem
</pre><p>
        暗号化された接続を使用するためにクライアントが必要であることを指定するには、<code class="literal">require_secure_transport</code> システム変数を有効にします:
      </p><pre class="programlisting">[mysqld]
ssl_ca=ca.pem
ssl_cert=server-cert.pem
ssl_key=server-key.pem
require_secure_transport=ON
</pre><p>
        各証明書およびキーシステム変数は、PEM 形式のファイルに名前を付けます。 必要な証明書およびキーファイルを作成する必要がある場合は、<a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 SSL および RSA 証明書とキーの作成">セクション6.3.3「SSL および RSA 証明書とキーの作成」</a> を参照してください。 OpenSSL を使用してコンパイルされた MySQL サーバーは、起動時に欠落している証明書およびキーファイルを自動的に生成できます。 <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 MySQL を使用した SSL および RSA 証明書とキーの作成">セクション6.3.3.1「MySQL を使用した SSL および RSA 証明書とキーの作成」</a>を参照してください。 または、MySQL ソース配布がある場合は、その <code class="filename">mysql-test/std_data</code> ディレクトリにあるデモンストレーション証明書およびキーファイルを使用して設定をテストできます。 
      </p><p>
        サーバーは証明書と鍵ファイルの自動検出を実行します。 暗号化された接続を構成するために、<code class="option">--ssl</code> 以外の明示的な encrypted-connection オプションが (<code class="literal">ssl_cipher</code> とともに) 指定されていない場合、サーバーは起動時に自動的に encrypted-connection サポートを有効にしようとします: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバーは、<code class="filename">ca.pem</code>、<code class="filename">server-cert.pem</code> および <code class="filename">server-key.pem</code> という名前の有効な証明書およびキーファイルをデータディレクトリで検出すると、クライアントによる暗号化された接続のサポートを有効にします。 (ファイルは自動的に生成されている必要はありません。これらの名前を持ち、有効であることが重要です。) 
          </p></li><li class="listitem"><p>
            有効な証明書およびキーファイルがデータディレクトリに見つからない場合、サーバーは実行を続行しますが、暗号化された接続はサポートしません。
          </p></li></ul></div><p>
        サーバーが自動的に暗号化された接続サポートを有効にすると、エラーログにノートが書き込まれます。 CA 証明書が自己署名証明書であることがサーバーで検出されると、エラーログに警告が書き込まれます。 (サーバーによって自動的に作成された場合、または <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> を使用して手動で作成された場合、証明書は自己署名されます。) 
      </p><p>
        MySQL には、サーバー側の暗号化された接続制御用の次のシステム変数も用意されています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ssl_cipher</code>: 接続の暗号化に許可される暗号のリスト。
          </p></li><li class="listitem"><p>
            <code class="literal">ssl_crl</code>: 証明書失効リストを含むファイルのパス名。(<code class="literal">ssl_crlpath</code> は類似していますが、証明書失効リストファイルのディレクトリのパス名を指定します。)
          </p></li><li class="listitem"><p>
            <code class="literal">tls_version</code>, <code class="literal">tls_ciphersuites</code>: サーバーが暗号化された接続に対して許可する暗号化プロトコルおよび暗号スイート。<a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.2 暗号化された接続 TLS プロトコルおよび暗号">セクション6.3.2「暗号化された接続 TLS プロトコルおよび暗号」</a> を参照してください。 たとえば、クライアントがセキュアでないプロトコルを使用できないように <code class="literal">tls_version</code> を設定できます。 
          </p></li></ul></div><p>
        サーバーがサーバー側の暗号化された接続制御用のシステム変数から有効な TLS コンテキストを作成できない場合、サーバーは暗号化された接続をサポートしません。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="using-encrypted-connections-server-side-runtime-configuration"></a>サーバー側のランタイム構成および暗号化された接続の監視</h4></div></div></div><p>
        MySQL 8.0.16 より前は、暗号化された接続サポートを構成する <code class="literal">tls_<em class="replaceable"><code>xxx</code></em></code> および <code class="literal">ssl_<em class="replaceable"><code>xxx</code></em></code> システム変数は、サーバーの起動時にのみ設定できます。 したがって、これらのシステム変数は、サーバーがすべての新しい接続に使用する TLS コンテキストを決定します。 
      </p><p>
        MySQL 8.0.16 の時点では、<code class="literal">tls_<em class="replaceable"><code>xxx</code></em></code> および <code class="literal">ssl_<em class="replaceable"><code>xxx</code></em></code> システム変数は動的であり、起動時だけでなく実行時に設定できます。 <code class="literal">SET GLOBAL</code> を使用して変更した場合、新しい値はサーバーが再起動するまで適用されません。 <code class="literal">SET PERSIST</code> を使用して変更した場合、新しい値も後続のサーバーの再起動に引き継がれます。 <a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a>を参照してください。 ただし、このセクションの後半で説明するように、これらの変数を実行時に変更しても、新しい接続の TLS コンテキストにすぐには影響しません。 
      </p><p>
        TLS コンテキスト関連のシステム変数に対する実行時の変更を可能にする MySQL 8.0.16 の変更に加えて、サーバーは、新しい接続に使用される実際の TLS コンテキストに対する実行時の更新を可能にします。 この機能は、SSL 証明書が期限切れになるまで実行されている MySQL サーバーを再起動しないようにする場合などに役立ちます。 
      </p><p>
        初期 TLS コンテキストを作成するために、サーバーは起動時にコンテキスト関連のシステム変数が持つ値を使用します。 コンテキスト値を公開するために、サーバーは対応するステータス変数のセットも初期化します。 次のテーブルに、TLS コンテキストを定義するシステム変数と、現在アクティブなコンテキスト値を公開する対応するステータス変数を示します。 
      </p><div class="table"><a name="tls-context-variables-table"></a><p class="title"><b>表 6.11 サーバーメイン接続インタフェース TLS コンテキストのシステム変数およびステータス変数</b></p><div class="table-contents"><table summary="The system variables that define the server TLS context and the corresponding status variables that expose active context values."><col style="width=45%"><col style="width=55%"><thead><tr>
            <th>システム変数名</th>
            <th>対応するステータス変数名</th>
          </tr></thead><tbody><tr>
            <td><code class="literal">ssl_ca</code></td>
            <td><code class="literal">Current_tls_ca</code></td>
          </tr><tr>
            <td><code class="literal">ssl_capath</code></td>
            <td><code class="literal">Current_tls_capath</code></td>
          </tr><tr>
            <td><code class="literal">ssl_cert</code></td>
            <td><code class="literal">Current_tls_cert</code></td>
          </tr><tr>
            <td><code class="literal">ssl_cipher</code></td>
            <td><code class="literal">Current_tls_cipher</code></td>
          </tr><tr>
            <td><code class="literal">ssl_crl</code></td>
            <td><code class="literal">Current_tls_crl</code></td>
          </tr><tr>
            <td><code class="literal">ssl_crlpath</code></td>
            <td><code class="literal">Current_tls_crlpath</code></td>
          </tr><tr>
            <td><code class="literal">ssl_key</code></td>
            <td><code class="literal">Current_tls_key</code></td>
          </tr><tr>
            <td><code class="literal">tls_ciphersuites</code></td>
            <td><code class="literal">Current_tls_ciphersuites</code></td>
          </tr><tr>
            <td><code class="literal">tls_version</code></td>
            <td><code class="literal">Current_tls_version</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        実行時に TLS コンテキストを再構成するには、次の手順を使用します:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            変更する必要がある TLS コンテキスト関連のシステム変数については、それらを新しい値に設定します。
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER INSTANCE RELOAD TLS</code> を実行します。 このステートメントは、TLS コンテキスト関連のシステム変数の現在の値からアクティブな TLS コンテキストを再構成します。 また、新しいアクティブなコンテキスト値を反映するようにコンテキスト関連のステータス変数を設定します。 ステートメントには <code class="literal">CONNECTION_ADMIN</code> 権限が必要です。 
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER INSTANCE RELOAD TLS</code> の実行後に確立された新しい接続は、新しい TLS コンテキストを使用します。 既存の接続は影響を受けません。 既存の接続を終了する場合は、<code class="literal">KILL</code> ステートメントを使用します。 
          </p></li></ol></div><p>
        システム変数とステータス変数の各ペアのメンバーは、再構成手順の動作によって一時的に異なる値を持つ場合があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ALTER INSTANCE RELOAD TLS</code> より前のシステム変数を変更しても、TLS コンテキストは変更されません。 この時点では、これらの変更は新しい接続には影響せず、対応するコンテキスト関連のシステム変数とステータス変数の値が異なる場合があります。 これにより、個々のシステム変数に必要な変更を加え、すべてのシステム変数の変更が行われた後に、<code class="literal">ALTER INSTANCE RELOAD TLS</code> を使用してアクティブな TLS コンテキストを原子的に更新できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">ALTER INSTANCE RELOAD TLS</code> の後、対応するシステム変数とステータス変数の値は同じになります。 これは、次にシステム変数が変更されるまで当てはまります。 
          </p></li></ul></div><p>
        場合によっては、システム変数を変更せずに TLS コンテキストを再構成するには、<code class="literal">ALTER INSTANCE RELOAD TLS</code> 自体で十分です。 <code class="literal">ssl_cert</code> によって指定されたファイル内の証明書の有効期限が切れているとします。 既存のファイルの内容を期限切れでない証明書に置き換え、<code class="literal">ALTER INSTANCE RELOAD TLS</code> を実行して新しいファイルの内容を読み取り、新しい接続に使用するだけで十分です。 
      </p><p>
        MySQL 8.0.21 の時点では、サーバーは管理接続インタフェースの独立した接続暗号化構成を実装します。 <a class="xref" href="server-administration.html#administrative-interface-encrypted-connections" title="暗号化された接続に対する管理インタフェースのサポート">暗号化された接続に対する管理インタフェースのサポート</a>を参照してください。 また、TLS コンテキストをリロードするチャネル (インタフェース) を指定できる <code class="literal">FOR CHANNEL</code> 句を使用して、<code class="literal">ALTER INSTANCE RELOAD TLS</code> が拡張されます。 <a class="xref" href="sql-statements.html#alter-instance" title="13.1.5 ALTER INSTANCE ステートメント">セクション13.1.5「ALTER INSTANCE ステートメント」</a>を参照してください。 管理インタフェース TLS コンテキストを公開するステータス変数はありませんが、パフォーマンススキーマ <code class="literal">tls_channel_status</code> テーブルはメインインタフェースと管理インタフェースの両方の TLS プロパティーを公開します。 <a class="xref" href="performance-schema.html#performance-schema-tls-channel-status-table" title="27.12.19.11 tls_channel_status テーブル">セクション27.12.19.11「tls_channel_status テーブル」</a>を参照してください。 
      </p><p>
        メインインタフェース TLS コンテキストを更新すると、次の効果があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            更新により、メイン接続インタフェース上の新しい接続に使用される TLS コンテキストが変更されます。
          </p></li><li class="listitem"><p>
            この更新では、インタフェースにデフォルト以外の TLS パラメータ値が構成されていないかぎり、管理インタフェース上の新しい接続に使用される TLS コンテキストも変更されます。
          </p></li><li class="listitem"><p>
            この更新は、ほかの有効なサーバープラグインまたはグループレプリケーションや X プラグイン などのコンポーネントで使用される TLS コンテキストには影響しません:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                サーバー TLS コンテキスト関連のシステム変数から設定を取得する Group Replication グループ通信接続にメインインタフェース再構成を適用するには、<code class="literal">STOP GROUP_REPLICATION</code> の後に <code class="literal">START GROUP_REPLICATION</code> を実行して Group Replication を停止および再起動する必要があります。
              </p></li><li class="listitem"><p>
                X プラグイン は、<a class="xref" href="document-store.html#x-plugin-encrypted-connections" title="20.5.3 X プラグイン での暗号化接続の使用">セクション20.5.3「X プラグイン での暗号化接続の使用」</a> で説明されているように、プラグインの初期化時に TLS コンテキストを初期化します。 その後、このコンテキストは変更されません。 
              </p></li></ul></div></li></ul></div><p>
        デフォルトでは、<code class="literal">RELOAD TLS</code> アクションはエラーでロールバックされ、構成値で新しい TLS コンテキストの作成が許可されていない場合は影響しません。 以前のコンテキスト値は、引き続き新しい接続に使用されます。 オプションの <code class="literal">NO ROLLBACK ON ERROR</code> 句が指定され、新しいコンテキストを作成できない場合、ロールバックは発生しません。 代わりに、警告が生成され、ステートメントが適用されるインタフェース上の新しい接続の暗号化が無効になります。 
      </p><p>
        接続インタフェースで暗号化された接続を有効または無効にするオプションは、起動時にのみ有効になります。 たとえば、<code class="option">--ssl</code> および <code class="option">--admin-ssl</code> オプションは、メインインタフェースと管理インタフェースが暗号化された接続をサポートしているかどうかにかかわらず、起動時にのみ影響します。 このようなオプションは無視され、実行時の <code class="literal">ALTER INSTANCE RELOAD TLS</code> の操作には影響しません。 たとえば、<code class="option">--ssl=OFF</code> を使用して、メインインタフェースで暗号化された接続を無効にしてサーバーを起動し、TLS を再構成して <code class="literal">ALTER INSTANCE RELOAD TLS</code> を実行し、実行時に暗号化された接続を有効にできます。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="using-encrypted-connections-client-side-configuration"></a>暗号化された接続のクライアント側の構成</h4></div></div></div><p>
        暗号化された接続の確立に関連するクライアントオプションの完全なリストは、<a class="xref" href="programs.html#encrypted-connection-options" title="暗号化接続のコマンドオプション">暗号化接続のコマンドオプション</a> を参照してください。
      </p><p>
        デフォルトでは、サーバーが暗号化された接続をサポートしている場合、MySQL クライアントプログラムは暗号化された接続を確立しようとし、<code class="option">--ssl-mode</code> オプションを使用してさらに制御できます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="option">--ssl-mode</code> オプションがない場合、クライアントは暗号化を使用して接続を試み、暗号化された接続を確立できない場合は暗号化されていない接続にフォールバックします。 これは、明示的な <code class="option">--ssl-mode=PREFFERED</code> オプションでの動作でもあります。 
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-mode=REQUIRED</code> では、クライアントは暗号化された接続を必要とし、確立できない場合は失敗します。
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-mode=DISABLED</code> では、クライアントは暗号化されていない接続を使用します。
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-mode=VERIFY_CA</code> または <code class="option">--ssl-mode=VERIFY_IDENTITY</code> では、クライアントは暗号化された接続を必要とし、サーバー CA 証明書および (<code class="literal">VERIFY_IDENTITY</code> を使用して) 証明書内のサーバーホスト名に対しても検証を実行します。
          </p></li></ul></div><p>
        サーバー側で <code class="literal">require_secure_transport</code> システム変数が有効になっていて、サーバーが暗号化された接続を要求する場合、暗号化されていない接続を確立しようとすると失敗します。 <a class="xref" href="security.html#mandatory-encrypted-connections" title="暗号化された接続の必須としての構成">暗号化された接続の必須としての構成</a>を参照してください。 
      </p><p>
        クライアント側の次のオプションは、クライアントがサーバーへの暗号化された接続を確立するときに使用する証明書および鍵ファイルを識別します。 これらは、サーバー側で使用される <code class="literal">ssl_ca</code>、<code class="literal">ssl_cert</code> および <code class="literal">ssl_key</code> システム変数に似ていますが、<code class="option">--ssl-cert</code> および <code class="option">--ssl-key</code> はクライアントの公開キーと秘密キーを識別します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="option">--ssl-ca</code>: 認証局 (CA) 証明書ファイルのパス名。 このオプションを使用する場合は、サーバーで使用されるものと同じ証明書を指定する必要があります。(<code class="option">--ssl-capath</code> は類似していますが、CA 証明書ファイルのディレクトリのパス名を指定します。) 
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-cert</code>: クライアント公開キー証明書ファイルのパス名。
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-key</code>: クライアント秘密キーファイルのパス名。
          </p></li></ul></div><p>
        デフォルトの暗号化で提供されるものと比較してセキュリティを強化するために、クライアントはサーバーで使用されるものと一致する CA 証明書を提供し、ホスト名のアイデンティティ検証を有効にできます。 このようにして、サーバーとクライアントは同じ CA 証明書に信頼を配置し、クライアントは接続先のホストが意図したものであることを確認します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            CA 証明書を指定するには、<code class="option">--ssl-ca</code> (または <code class="option">--ssl-capath</code>) を使用し、<code class="option">--ssl-mode=VERIFY_CA</code> を指定します。
          </p></li><li class="listitem"><p>
            ホスト名アイデンティティ検証も有効にするには、<code class="option">--ssl-mode=VERIFY_CA</code> ではなく <code class="option">--ssl-mode=VERIFY_IDENTITY</code> を使用します。
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">VERIFY_IDENTITY</code> を使用したホスト名アイデンティティ検証は、サーバーによって自動的に作成された自己署名証明書、または <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> を使用して手動で作成された自己署名証明書では機能しません (<a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 MySQL を使用した SSL および RSA 証明書とキーの作成">セクション6.3.3.1「MySQL を使用した SSL および RSA 証明書とキーの作成」</a> を参照)。 このような自己署名証明書には、共通名の値としてサーバー名は含まれません。 
        </p><p>
          MySQL 8.0.12 より前では、ホスト名のアイデンティティ検証は、ワイルドカードを使用して共通名を指定する証明書でも機能しません。これは、その名前がサーバー名と比較されるためです。
        </p></div><p>
        MySQL には、クライアント側の SSL 制御用に次のオプションも用意されています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="option">--ssl-cipher</code>: 接続の暗号化に許可される暗号のリスト。
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-crl</code>: 証明書失効リストを含むファイルのパス名。(<code class="option">--ssl-crlpath</code> は類似していますが、証明書失効リストファイルのディレクトリのパス名を指定します。)
          </p></li><li class="listitem"><p>
            <code class="option">--tls-version</code>, <code class="option">--tls-ciphersuites</code>: 許可されている暗号化プロトコルおよび暗号スイート。<a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.2 暗号化された接続 TLS プロトコルおよび暗号">セクション6.3.2「暗号化された接続 TLS プロトコルおよび暗号」</a> を参照してください。
          </p></li></ul></div><p>
        クライアントで使用される MySQL アカウントの暗号化要件によっては、クライアントは、暗号化を使用して MySQL サーバーに接続するための特定のオプションを指定する必要がある場合があります。
      </p><p>
        特別な暗号化要件がないアカウント、または <code class="literal">REQUIRE SSL</code> 句を含む <code class="literal">CREATE USER</code> ステートメントを使用して作成されたアカウントを使用して接続するとします。 サーバーが暗号化された接続をサポートしていると仮定すると、クライアントは <code class="option">--ssl-mode</code> オプションなしで暗号化を使用して、または明示的な <code class="option">--ssl-mode=PREFFERED</code> オプションを使用して接続できます: 
      </p><pre class="programlisting">mysql
</pre><p>
        または:
      </p><pre class="programlisting">mysql --ssl-mode=PREFERRED
</pre><p>
        <code class="literal">REQUIRE SSL</code> 句を使用して作成されたアカウントでは、暗号化された接続を確立できない場合、接続の試行は失敗します。 特別な暗号化要件のないアカウントの場合、暗号化された接続を確立できないと、暗号化されていない接続にフォールバックしようとします。 暗号化された接続を取得できない場合にフォールバックおよび失敗を防ぐには、次のように接続します: 
      </p><pre class="programlisting">mysql --ssl-mode=REQUIRED
</pre><p>
        アカウントのセキュリティ要件が厳しい場合は、暗号化された接続を確立するために他のオプションを指定する必要があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">REQUIRE X509</code> 句を使用して作成されたアカウントの場合、クライアントは少なくとも <code class="option">--ssl-cert</code> および <code class="option">--ssl-key</code> を指定する必要があります。 また、サーバーによって提供される公開証明書を検証できるように、<code class="option">--ssl-ca</code> (または <code class="option">--ssl-capath</code>) をお薦めします。 次に例を示します (単一行にコマンドを入力します): 
          </p><pre class="programlisting">mysql --ssl-ca=ca.pem
      --ssl-cert=client-cert.pem
      --ssl-key=client-key.pem
</pre></li><li class="listitem"><p>
            <code class="literal">REQUIRE ISSUER</code> または <code class="literal">REQUIRE SUBJECT</code> 句を使用して作成されたアカウントの場合、暗号化要件は <code class="literal">REQUIRE X509</code> の場合と同じですが、証明書はそれぞれアカウント定義で指定された問題またはサブジェクトと一致する必要があります。
          </p></li></ul></div><p>
        <code class="literal">REQUIRE</code> 句の詳細は、<a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a> を参照してください。
      </p><p>
        暗号化の使用を防止し、他の <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> オプションをオーバーライドするには、<code class="option">--ssl-mode=DISABLED</code> を使用してクライアントプログラムを起動します:
      </p><pre class="programlisting">mysql --ssl-mode=DISABLED
</pre><p>
        サーバーとの現在の接続で暗号化が使用されているかどうかを確認するには、<code class="literal">Ssl_cipher</code> ステータス変数のセッション値を確認します。 値が空の場合、接続は暗号化されません。 それ以外の場合、接続は暗号化され、値は暗号化暗号を示します。 例: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW SESSION STATUS LIKE 'Ssl_cipher';</code></strong>
+---------------+---------------------------+
| Variable_name | Value                     |
+---------------+---------------------------+
| Ssl_cipher    | DHE-RSA-AES128-GCM-SHA256 |
+---------------+---------------------------+
</pre><p>
        <span class="command"><strong>mysql</strong></span> クライアントの場合は、代わりに <code class="literal">STATUS</code> または <code class="literal">\s</code> コマンドを使用して、<code class="literal">SSL</code> 行をチェックすることもできます。
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>\s</code></strong>
...
SSL: Not in use
...
</pre><p>
        または:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>\s</code></strong>
...
SSL: Cipher in use is DHE-RSA-AES128-GCM-SHA256
...
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="mandatory-encrypted-connections"></a>暗号化された接続の必須としての構成</h4></div></div></div><a class="indexterm" name="idm46723760909008"></a><p>
        一部の MySQL デプロイメントでは、暗号化された接続を使用することが望ましいだけでなく、(規制要件を満たすためなどに) 必須である場合があります。 このセクションでは、これを可能にする構成設定について説明します。 次のレベルの制御を使用できます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            クライアントが暗号化された接続を使用して接続することを要求するようにサーバーを構成できます。
          </p></li><li class="listitem"><p>
            個々のクライアントプログラムを起動して、サーバーで許可されているが暗号化が必要ない場合でも、暗号化された接続を要求できます。
          </p></li><li class="listitem"><p>
            暗号化された接続でのみ使用できるように個々の MySQL アカウントを構成できます。
          </p></li></ul></div><p>
        クライアントが暗号化された接続を使用して接続することを要求するには、<code class="literal">require_secure_transport</code> システム変数を有効にします。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルに次の行を挿入します: 
      </p><pre class="programlisting">[mysqld]
require_secure_transport=ON
</pre><p>
        または、実行時に値を設定して永続化するには、次のステートメントを使用します:
      </p><pre class="programlisting">SET PERSIST require_secure_transport=ON;
</pre><p>
        <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、値が保存され、それ以降のサーバーの再起動にも使用されます。 <a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a>を参照してください。 
      </p><p>
        <code class="literal">require_secure_transport</code> を有効にすると、なんらかの形式のセキュアなトランスポートを使用するためにサーバーへのクライアント接続が必要になり、SSL を使用する TCP/IP 接続、またはソケットファイル (Unix の場合) または共有メモリー (Windows の場合) を使用する接続のみがサーバーで許可されます。 サーバーはセキュアでない接続試行を拒否し、<code class="literal">ER_SECURE_TRANSPORT_REQUIRED</code> エラーで失敗します。 
      </p><p>
        サーバーで暗号化が必要かどうかにかかわらず暗号化された接続を必要とするようにクライアントプログラムを起動するには、<code class="literal">REQUIRED</code>、<code class="literal">VERIFY_CA</code> または <code class="literal">VERIFY_IDENTITY</code> の <code class="option">--ssl-mode</code> オプション値を使用します。 例: 
      </p><pre class="programlisting">mysql --ssl-mode=REQUIRED
mysqldump --ssl-mode=VERIFY_CA
mysqladmin --ssl-mode=VERIFY_IDENTITY
</pre><p>
        暗号化された接続でのみ使用できるように MySQL アカウントを構成するには、アカウントを作成する <code class="literal">CREATE USER</code> ステートメントに <code class="literal">REQUIRE</code> 句を含め、その句に必要な暗号化特性を指定します。 たとえば、暗号化された接続と有効な X.509 証明書の使用を要求するには、<code class="literal">REQUIRE X509</code> を使用します: 
      </p><pre class="programlisting">CREATE USER 'jeffrey'@'localhost' REQUIRE X509;
</pre><p>
        <code class="literal">REQUIRE</code> 句の詳細は、<a class="xref" href="sql-statements.html#create-user" title="13.7.1.3 CREATE USER ステートメント">セクション13.7.1.3「CREATE USER ステートメント」</a> を参照してください。
      </p><p>
        暗号化要件のない既存のアカウントを変更するには、<code class="literal">ALTER USER</code> ステートメントを使用します。
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="encrypted-connection-protocols-ciphers"></a>6.3.2 暗号化された接続 TLS プロトコルおよび暗号</h3></div></div></div><p>
      MySQL では、複数の TLS プロトコルおよび暗号がサポートされており、暗号化された接続を許可するプロトコルおよび暗号を構成できます。 現在のセッションで使用されているプロトコルおよび暗号を判別することもできます。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#encrypted-connection-supported-protocols" title="サポートされている接続 TLS プロトコル">サポートされている接続 TLS プロトコル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#encrypted-connection-protocol-configuration" title="接続 TLS プロトコル構成">接続 TLS プロトコル構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#encrypted-connection-cipher-configuration" title="接続暗号構成">接続暗号構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#encrypted-connection-protocol-negotiation" title="接続 TLS プロトコルネゴシエーション">接続 TLS プロトコルネゴシエーション</a></p></li><li class="listitem"><p><a class="xref" href="security.html#encrypted-connection-protocol-monitoring" title="現在のクライアントセッション TLS プロトコルおよび暗号のモニタリング">現在のクライアントセッション TLS プロトコルおよび暗号のモニタリング</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="encrypted-connection-supported-protocols"></a>サポートされている接続 TLS プロトコル</h4></div></div></div><p>
        MySQL では、TLSv1、TLSv1.1、TLSv1.2 および TLSv1.3 プロトコルを使用して暗号化された接続がサポートされており、安全性の低いものから安全性の高いものの順にリストされています。 接続に対して実際に許可されるプロトコルのセットは、複数の要因に従います: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL configuration. 許可された TLS プロトコルは、サーバー側とクライアント側の両方で、サポートされている TLS プロトコルのサブセットのみを含むように構成できます。 両側の設定には、共通のプロトコルが少なくとも 1 つ含まれている必要があります。含まれていないと、接続を試行しても使用するプロトコルをネゴシエートできません。 詳細は、<a class="xref" href="security.html#encrypted-connection-protocol-negotiation" title="接続 TLS プロトコルネゴシエーション">接続 TLS プロトコルネゴシエーション</a>を参照してください。 
          </p></li><li class="listitem"><p>
            システム全体のホスト構成。 ホストシステムでは特定の TLS プロトコルのみが許可される場合があります。つまり、MySQL 自体で許可されている場合でも、MySQL 接続では許可されていないプロトコルを使用できません: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                MySQL 構成では TLSv1、TLSv1.1 および TLSv1.2 が許可されていますが、ホストシステム構成では TLSv1.2 以上を使用する接続のみが許可されているとします。 この場合、TLSv1 または TLSv1.1 を使用する MySQL 接続は、ホストシステムで許可されていないため、MySQL がそれらを許可するように構成されていても確立できません。 
              </p></li><li class="listitem"><p>
                MySQL 構成で TLSv1、TLSv1.1 および TLSv1.2 が許可されているが、ホストシステム構成では TLSv1.3 以上を使用する接続のみが許可されている場合は、MySQL で許可されているプロトコルがホストシステムで許可されていないため、MySQL 接続を確立できません。
              </p></li></ul></div><p>
            この問題の回避策は次のとおりです:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                システム全体のホスト構成を変更して、追加の TLS プロトコルを許可します。 手順については、オペレーティングシステムのドキュメントを参照してください。 たとえば、TLS プロトコルを TLSv1.2 以上に制限するために、システムに次の行を含む<code class="literal">/etc/ssl/openssl.cnf</code> ファイルがあるとします: 
              </p><pre class="programlisting">[system_default_sect]
MinProtocol = TLSv1.2
</pre><p>
                値を低いプロトコルバージョンまたは <code class="literal">None</code> に変更すると、システムがより許可されます。 この回避策には、低い (安全性の低い) プロトコルを許可するというデメリットがあり、セキュリティに悪影響を与える可能性があります。 
              </p></li><li class="listitem"><p>
                ホストシステムの TLS 構成を変更できない場合や変更したくない場合は、ホストシステムで許可されているより高い (よりセキュアな) TLS プロトコルを使用するように MySQL アプリケーションを変更します。 これは、より低いプロトコルバージョンのみをサポートする古いバージョンの MySQL では不可能な場合があります。 たとえば、TLSv1 は MySQL 5.6.46 より前にサポートされていた唯一のプロトコルであるため、5.6.46 より前のサーバーへの接続の試行は、クライアントがより高いプロトコルバージョンをサポートするより新しい MySQL バージョンからのものであっても失敗します。 このような場合は、追加の TLS バージョンをサポートする MySQL のバージョンへのアップグレードが必要になることがあります。 
              </p></li></ul></div></li><li class="listitem"><p>
            SSL ライブラリ。 SSL ライブラリが特定のプロトコルをサポートしていない場合、MySQL もサポートせず、そのプロトコルを指定する次の説明の一部も適用されません。 
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              TLSv1.3 プロトコルのサポートは、MySQL 8.0.16 (Group Replication コンポーネントの MySQL 8.0.18 時点) で使用できます。 また、TLSv1.3 を使用するには、MySQL サーバーとクライアントアプリケーションの両方を OpenSSL 1.1.1 以上を使用してコンパイルする必要があります。 
            </p></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="encrypted-connection-protocol-configuration"></a>接続 TLS プロトコル構成</h4></div></div></div><p>
        サーバー側では、<code class="literal">tls_version</code> システム変数の値によって、MySQL サーバーが暗号化された接続に対して許可する TLS プロトコルが決まります。 <code class="literal">tls_version</code> の値は、クライアントからの接続、このサーバーインスタンスがソースである通常のソース/レプリカレプリケーション接続、グループレプリケーショングループ通信接続、およびこのサーバーインスタンスがドナーであるグループレプリケーション分散リカバリ接続に適用されます。 変数値は、このリストの 1 つ以上のカンマ区切りプロトコルバージョンのリストです (大/小文字は区別されません): TLSv1、TLSv1.1、TLSv1.2、および TLSV1.3 (使用可能な場合)。 デフォルトでは、この変数は、MySQL のコンパイルに使用される SSL ライブラリでサポートされているすべてのプロトコルをリストします。 実行時に <code class="literal">tls_version</code> の値を確認するには、次のステートメントを使用します: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GLOBAL VARIABLES LIKE 'tls_version';</code></strong>
+---------------+-----------------------+
| Variable_name | Value                 |
+---------------+-----------------------+
| tls_version   | TLSv1,TLSv1.1,TLSv1.2 |
+---------------+-----------------------+
</pre><p>
        <code class="literal">tls_version</code> の値を変更するには、サーバーの起動時に設定します。 たとえば、TLSv1.1 または TLSv1.2 プロトコルを使用するが、セキュアでない TLSv1 プロトコルを使用する接続を禁止するには、サーバー <code class="filename">my.cnf</code> ファイルで次の行を使用します: 
      </p><pre class="programlisting">[mysqld]
tls_version=TLSv1.1,TLSv1.2
</pre><p>
        さらに限定的にして TLSv1.2 接続のみを許可するには、次のように <code class="literal">tls_version</code> を設定します:
      </p><pre class="programlisting">[mysqld]
tls_version=TLSv1.2
</pre><p>
        MySQL 8.0.16 では、<code class="literal">tls_version</code> を実行時に変更することもできます。 <a class="xref" href="security.html#using-encrypted-connections-server-side-runtime-configuration" title="サーバー側のランタイム構成および暗号化された接続の監視">サーバー側のランタイム構成および暗号化された接続の監視</a>を参照してください。 
      </p><p>
        クライアント側では、<code class="option">--tls-version</code> オプションは、クライアントプログラムがサーバーへの接続を許可する TLS プロトコルを指定します。 オプション値の形式は、前述の <code class="literal">tls_version</code> システム変数 (プロトコルバージョンのカンマ区切りリスト) と同じです。 
      </p><p>
        このサーバーインスタンスがレプリカであるソース/レプリカレプリケーション接続の場合、<code class="literal">CHANGE REPLICATION SOURCE TO</code> ステートメント (MySQL 8.0.23 より前) または <code class="literal">CHANGE MASTER TO</code> ステートメント (MySQL 8.0.23 より前) の <code class="literal">SOURCE_TLS_VERSION</code> | <code class="literal">MASTER_TLS_VERSION</code> オプションで、レプリカがソースへの接続を許可する TLS プロトコルを指定します。 オプション値の形式は、前述の <code class="literal">tls_version</code> システム変数の場合と同じです。 <a class="xref" href="replication.html#replication-solutions-encrypted-connections" title="17.3.1 暗号化接続を使用するためのレプリケーションの設定">セクション17.3.1「暗号化接続を使用するためのレプリケーションの設定」</a>を参照してください。 
      </p><p>
        <code class="literal">SOURCE_TLS_VERSION</code> | <code class="literal">MASTER_TLS_VERSION</code> に指定できるプロトコルは、SSL ライブラリによって異なります。 このオプションは、サーバーの <code class="literal">tls_version</code> 値に依存せず、影響を受けません。 たとえば、レプリカとして機能するサーバーは、<code class="literal">tls_version</code> を TLSv1.3 に設定して、TLSv1.3 を使用する受信接続のみを許可するように構成できますが、<code class="literal">SOURCE_TLS_VERSION</code> | <code class="literal">MASTER_TLS_VERSION</code> を TLSv1.2 に設定して、ソースへの送信レプリカ接続に TLSv1.2 のみを許可するように構成することもできます。 
      </p><p>
        このサーバーインスタンスが分散リカバリを開始する結合メンバー (つまり、クライアント) である Group Replication 分散リカバリ接続の場合、<code class="literal">group_replication_recovery_tls_version</code> システム変数は、クライアントで許可されるプロトコルを指定します。 このオプションは、このサーバーインスタンスがドナーである場合に適用されるサーバー <code class="literal">tls_version</code> 値に依存せず、影響を受けません。 グループレプリケーションサーバーは、通常、そのグループメンバーシップの過程でドナーとしても参加メンバーとしても分散リカバリに参加するため、これら両方のシステム変数を設定する必要があります。 <a class="xref" href="group-replication.html#group-replication-secure-socket-layer-support-ssl" title="18.5.2 Secure Socket Layer (SSL) を使用したグループ通信接続の保護">セクション18.5.2「Secure Socket Layer (SSL) を使用したグループ通信接続の保護」</a>を参照してください。 
      </p><p>
        TLS プロトコル構成は、<a class="xref" href="security.html#encrypted-connection-protocol-negotiation" title="接続 TLS プロトコルネゴシエーション">接続 TLS プロトコルネゴシエーション</a> で説明されているように、特定の接続が使用するプロトコルに影響します。
      </p><p>
        <span class="quote">「<span class="quote">「穴」</span>」</span>をリストに残さないなど、許可されたプロトコルを選択する必要があります。 たとえば、次のサーバー構成値には穴がありません: 
      </p><pre class="programlisting">tls_version=TLSv1,TLSv1.1,TLSv1.2,TLSv1.3
tls_version=TLSv1.1,TLSv1.2,TLSv1.3
tls_version=TLSv1.2,TLSv1.3
tls_version=TLSv1.3
</pre><p>
        これらの値には穴があり、使用しないでください:
      </p><pre class="programlisting">tls_version=TLSv1,TLSv1.2       <em class="replaceable"><code>(TLSv1.1 is missing)</code></em>
tls_version=TLSv1.1,TLSv1.3     <em class="replaceable"><code>(TLSv1.2 is missing)</code></em>
</pre><p>
        穴の禁止は、クライアントやレプリカなどの他の構成コンテキストでも適用されます。
      </p><p>
        許可されたプロトコルのリストは空にできません。 TLS バージョンパラメータを空の文字列に設定すると、暗号化された接続を確立できません: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">tls_version</code>: サーバーは暗号化された着信接続を許可しません。
          </p></li><li class="listitem"><p>
            <code class="option">--tls-version</code>: クライアントは、サーバーへの暗号化された送信接続を許可しません。
          </p></li><li class="listitem"><p>
            <code class="literal">MASTER_TLS_VERSION</code>: レプリカでは、ソースへの暗号化された送信接続は許可されません。
          </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="encrypted-connection-cipher-configuration"></a>接続暗号構成</h4></div></div></div><p>
        暗号のデフォルトセットは暗号化された接続に適用され、これは許可された暗号を明示的に構成することでオーバーライドできます。 接続の確立時には、接続の両側で共通の暗号が許可されている必要があります。許可されていない場合、接続は失敗します。 SSL ライブラリは、両側に共通の許可された暗号のうち、優先度が最も高い指定された証明書でサポートされている暗号を選択します。 
      </p><p>
        TLSv1.2 までの TLS プロトコルを使用する暗号化された接続に適用可能な暗号を指定するには:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー側で <code class="literal">ssl_cipher</code> システム変数を設定し、クライアントプログラムに <code class="option">--ssl-cipher</code> オプションを使用します。
          </p></li><li class="listitem"><p>
            このサーバーインスタンスがソースである通常のソース/レプリカレプリケーション接続の場合は、<code class="literal">ssl_cipher</code> システム変数を設定します。 このサーバーインスタンスがレプリカである場合、<code class="literal">CHANGE REPLICATION SOURCE TO</code> ステートメント (MySQL 8.0.23) または <code class="literal">CHANGE MASTER TO</code> ステートメント (MySQL 8.0.23 より前) に <code class="literal">SOURCE_SSL_CIPHER</code> | <code class="literal">MASTER_SSL_CIPHER</code> オプションを使用します。 <a class="xref" href="replication.html#replication-solutions-encrypted-connections" title="17.3.1 暗号化接続を使用するためのレプリケーションの設定">セクション17.3.1「暗号化接続を使用するためのレプリケーションの設定」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            グループレプリケーショングループメンバーの場合、グループレプリケーショングループ通信接続、およびこのサーバーインスタンスがドナーであるグループレプリケーション分散リカバリ接続の場合は、<code class="literal">ssl_cipher</code> システム変数を設定します。 このサーバーインスタンスが参加メンバーであるグループレプリケーション分散リカバリ接続の場合は、<code class="literal">group_replication_recovery_ssl_cipher</code> システム変数を使用します。 <a class="xref" href="group-replication.html#group-replication-secure-socket-layer-support-ssl" title="18.5.2 Secure Socket Layer (SSL) を使用したグループ通信接続の保護">セクション18.5.2「Secure Socket Layer (SSL) を使用したグループ通信接続の保護」</a>を参照してください。 
          </p></li></ul></div><p>
        TLSv1.3 を使用する暗号化された接続の場合、OpenSSL 1.1.1 以上では次の暗号スイートがサポートされており、最初の 3 つはデフォルトで有効になっています:
      </p><pre class="programlisting">TLS_AES_128_GCM_SHA256
TLS_AES_256_GCM_SHA384
TLS_CHACHA20_POLY1305_SHA256
TLS_AES_128_CCM_SHA256
TLS_AES_128_CCM_8_SHA256
</pre><p>
        許可された TLSv1.3 暗号スイートを明示的に構成するには、次のパラメータを設定します。 いずれの場合も、構成値はコロンで区切られたゼロ個以上の暗号スイート名のリストです。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー側では、<code class="literal">tls_ciphersuites</code> システム変数を使用します。 この変数が設定されていない場合、デフォルト値は <code class="literal">NULL</code> です。つまり、サーバーは暗号スイートのデフォルトセットを許可します。 変数が空の文字列に設定されている場合、暗号スイートは有効にならず、暗号化された接続を確立できません。 
          </p></li><li class="listitem"><p>
            クライアント側では、<code class="option">--tls-ciphersuites</code> オプションを使用します。 このオプションが設定されていない場合、クライアントは暗号化方式群のデフォルトセットを許可します。 このオプションが空の文字列に設定されている場合、暗号スイートは有効にならず、暗号化された接続を確立できません。 
          </p></li><li class="listitem"><p>
            このサーバーインスタンスがソースである通常のソース/レプリカレプリケーション接続には、<code class="literal">tls_ciphersuites</code> システム変数を使用します。 このサーバーインスタンスがレプリカである場合、<code class="literal">CHANGE REPLICATION SOURCE TO</code> ステートメント (MySQL 8.0.23) または <code class="literal">CHANGE MASTER TO</code> ステートメント (MySQL 8.0.23 より前) に <code class="literal">SOURCE_TLS_CIPHERSUITES</code> | <code class="literal">MASTER_TLS_CIPHERSUITES</code> オプションを使用します。 <a class="xref" href="replication.html#replication-solutions-encrypted-connections" title="17.3.1 暗号化接続を使用するためのレプリケーションの設定">セクション17.3.1「暗号化接続を使用するためのレプリケーションの設定」</a>を参照してください。 
          </p></li><li class="listitem"><p>
            グループレプリケーショングループメンバーの場合、グループレプリケーショングループ通信接続、およびこのサーバーインスタンスがドナーであるグループレプリケーション分散リカバリ接続には、<code class="literal">tls_ciphersuites</code> システム変数を使用します。 このサーバーインスタンスが参加メンバーであるグループレプリケーション分散リカバリ接続の場合は、<code class="literal">group_replication_recovery_tls_ciphersuites</code> システム変数を使用します。 <a class="xref" href="group-replication.html#group-replication-secure-socket-layer-support-ssl" title="18.5.2 Secure Socket Layer (SSL) を使用したグループ通信接続の保護">セクション18.5.2「Secure Socket Layer (SSL) を使用したグループ通信接続の保護」</a>を参照してください。 
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          暗号スイートのサポートは MySQL 8.0.16 で使用できますが、MySQL サーバーとクライアントアプリケーションの両方が OpenSSL 1.1.1 以上を使用してコンパイルされている必要があります。
        </p><p>
          MySQL 8.0.16 から 8.0.18 では、<code class="literal">group_replication_recovery_tls_ciphersuites</code> システム変数および <code class="literal">CHANGE REPLICATION SOURCE TO</code> ステートメント (MySQL 8.0.23 から) の <code class="literal">SOURCE_TLS_CIPHERSUITES</code> | <code class="literal">MASTER_TLS_CIPHERSUITES</code> オプション、または <code class="literal">CHANGE MASTER TO</code> ステートメント (MySQL 8.0.23 より前) は使用できません。 これらのリリースでは、TLSv1.3 がソース/レプリカレプリケーション接続に使用されている場合、または分散リカバリ (MySQL 8.0.18 からサポートされている) のグループレプリケーションで使用されている場合、レプリケーションソースまたはグループレプリケーションドナーのサーバーは、デフォルトで有効になっている TLSv1.3 暗号スイートの使用を許可する必要があります。 MySQL 8.0.19 から、オプションを使用して、必要に応じてデフォルト以外の暗号スイートのみを含む任意の暗号スイートのクライアントサポートを構成できます。 
        </p></div><p>
        特定の暗号は、TLS プロトコルネゴシエーションプロセスに影響する特定の TLS プロトコルでのみ機能します。 <a class="xref" href="security.html#encrypted-connection-protocol-negotiation" title="接続 TLS プロトコルネゴシエーション">接続 TLS プロトコルネゴシエーション</a>を参照してください。 
      </p><p>
        特定のサーバーがサポートする暗号を判別するには、<code class="literal">Ssl_cipher_list</code> ステータス変数のセッション値を確認します:
      </p><pre class="programlisting">SHOW SESSION STATUS LIKE 'Ssl_cipher_list';
</pre><p>
        <code class="literal">Ssl_cipher_list</code> ステータス変数には、使用可能な SSL 暗号がリストされます (非 SSL 接続の場合は空)。 MySQL が TLSv1.3 をサポートしている場合、この値には使用可能な TLSv1.3 暗号スイートが含まれます。 
      </p><p>
        TLS.v 1.3 を使用する暗号化された接続の場合、MySQL は SSL ライブラリのデフォルトの暗号化スイートリストを使用します。
      </p><p>
        TLSv1.2 を介して TLS プロトコルを使用する暗号化された接続の場合、MySQL は次のデフォルトの暗号リストを SSL ライブラリに渡します。
      </p><pre class="programlisting">ECDHE-ECDSA-AES128-GCM-SHA256
ECDHE-ECDSA-AES256-GCM-SHA384
ECDHE-RSA-AES128-GCM-SHA256
ECDHE-RSA-AES256-GCM-SHA384
ECDHE-ECDSA-AES128-SHA256
ECDHE-RSA-AES128-SHA256
ECDHE-ECDSA-AES256-SHA384
ECDHE-RSA-AES256-SHA384
DHE-RSA-AES128-GCM-SHA256
DHE-DSS-AES128-GCM-SHA256
DHE-RSA-AES128-SHA256
DHE-DSS-AES128-SHA256
DHE-DSS-AES256-GCM-SHA384
DHE-RSA-AES256-SHA256
DHE-DSS-AES256-SHA256
ECDHE-RSA-AES128-SHA
ECDHE-ECDSA-AES128-SHA
ECDHE-RSA-AES256-SHA
ECDHE-ECDSA-AES256-SHA
DHE-DSS-AES128-SHA
DHE-RSA-AES128-SHA
TLS_DHE_DSS_WITH_AES_256_CBC_SHA
DHE-RSA-AES256-SHA
AES128-GCM-SHA256
DH-DSS-AES128-GCM-SHA256
ECDH-ECDSA-AES128-GCM-SHA256
AES256-GCM-SHA384
DH-DSS-AES256-GCM-SHA384
ECDH-ECDSA-AES256-GCM-SHA384
AES128-SHA256
DH-DSS-AES128-SHA256
ECDH-ECDSA-AES128-SHA256
AES256-SHA256
DH-DSS-AES256-SHA256
ECDH-ECDSA-AES256-SHA384
AES128-SHA
DH-DSS-AES128-SHA
ECDH-ECDSA-AES128-SHA
AES256-SHA
DH-DSS-AES256-SHA
ECDH-ECDSA-AES256-SHA
DHE-RSA-AES256-GCM-SHA384
DH-RSA-AES128-GCM-SHA256
ECDH-RSA-AES128-GCM-SHA256
DH-RSA-AES256-GCM-SHA384
ECDH-RSA-AES256-GCM-SHA384
DH-RSA-AES128-SHA256
ECDH-RSA-AES128-SHA256
DH-RSA-AES256-SHA256
ECDH-RSA-AES256-SHA384
ECDHE-RSA-AES128-SHA
ECDHE-ECDSA-AES128-SHA
ECDHE-RSA-AES256-SHA
ECDHE-ECDSA-AES256-SHA
DHE-DSS-AES128-SHA
DHE-RSA-AES128-SHA
TLS_DHE_DSS_WITH_AES_256_CBC_SHA
DHE-RSA-AES256-SHA
AES128-SHA
DH-DSS-AES128-SHA
ECDH-ECDSA-AES128-SHA
AES256-SHA
DH-DSS-AES256-SHA
ECDH-ECDSA-AES256-SHA
DH-RSA-AES128-SHA
ECDH-RSA-AES128-SHA
DH-RSA-AES256-SHA
ECDH-RSA-AES256-SHA
DES-CBC3-SHA
</pre><p>
        次の暗号制限が適用されます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            次の暗号は永続的に制限されています:
          </p><pre class="programlisting">!DHE-DSS-DES-CBC3-SHA
!DHE-RSA-DES-CBC3-SHA
!ECDH-RSA-DES-CBC3-SHA
!ECDH-ECDSA-DES-CBC3-SHA
!ECDHE-RSA-DES-CBC3-SHA
!ECDHE-ECDSA-DES-CBC3-SHA
</pre></li><li class="listitem"><p>
            次のカテゴリの暗号は永続的に制限されています:
          </p><pre class="programlisting">!aNULL
!eNULL
!EXPORT
!LOW
!MD5
!DES
!RC2
!RC4
!PSK
!SSLv3
</pre></li></ul></div><p>
        前述の制限付き暗号または暗号カテゴリのいずれかを使用する証明書に <code class="literal">ssl_cert</code> システム変数を設定してサーバーを起動すると、サーバーは暗号化された接続のサポートを無効にして起動します。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="encrypted-connection-protocol-negotiation"></a>接続 TLS プロトコルネゴシエーション</h4></div></div></div><p>
        MySQL での接続試行では、プロトコル互換暗号が両側で使用可能な両側で使用可能な最上位 TLS プロトコルバージョンの使用がネゴシエーションされます。 ネゴシエーションプロセスは、サーバーとクライアントのコンパイルに使用される SSL ライブラリ、TLS プロトコルと暗号化暗号構成、使用されるキーサイズなどの要因によって異なります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            接続を正常に試行するには、サーバーとクライアントの TLS プロトコル構成で一部のプロトコルを共通に許可する必要があります。
          </p></li><li class="listitem"><p>
            同様に、サーバーとクライアントの暗号化の構成では、一部の暗号を共通に許可する必要があります。 特定の暗号は特定の TLS プロトコルでのみ機能するため、互換性のある暗号がないかぎり、ネゴシエーションプロセスで使用可能なプロトコルは選択されません。 
          </p></li><li class="listitem"><p>
            TLSv1.3 が使用可能な場合は、可能であれば使用されます。 (つまり、サーバーとクライアントの両方の構成で TLSv1.3 が許可されている必要があり、両方で一部の TLSv1.3 互換暗号も許可されている必要があります。) それ以外の場合、MySQL は、可能であれば TLSv1.2 などを使用して、使用可能なプロトコルのリストを続行します。 ネゴシエーションは、よりセキュアなプロトコルからよりセキュアでないプロトコルに進みます。 ネゴシエーション順序は、プロトコルが構成されている順序とは無関係です。 たとえば、ネゴシエーション順序は、<code class="literal">tls_version</code> の値が <code class="literal">TLSv1,TLSv1.1,TLSv1.2,TLSv1.3</code> であるか <code class="literal">TLSv1.3,TLSv1.2,TLSv1.1,TLSv1</code> であるかに関係なく同じです。 
          </p></li><li class="listitem"><p>
            TLSv1.2 は、512 ビット以下のキーサイズのすべての暗号で機能するわけではありません。 このようなキーでこのプロトコルを使用するには、サーバー側で <code class="literal">ssl_cipher</code> システム変数を設定するか、<code class="option">--ssl-cipher</code> クライアントオプションを使用して暗号名を明示的に指定します: 
          </p><pre class="programlisting">AES128-SHA
AES128-SHA256
AES256-SHA
AES256-SHA256
CAMELLIA128-SHA
CAMELLIA256-SHA
DES-CBC3-SHA
DHE-RSA-AES256-SHA
RC4-MD5
RC4-SHA
SEED-SHA
</pre></li><li class="listitem"><p>
            セキュリティを向上させるには、RSA キーサイズが 2048 ビット以上の証明書を使用します。
          </p></li></ul></div><p>
        サーバーとクライアントに共通の許可されたプロトコルがなく、共通のプロトコル互換暗号がある場合、サーバーは接続リクエストを終了します。 例: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバーが <code class="literal">tls_version=TLSv1.1,TLSv1.2</code> で構成されている場合:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="option">--tls-version=TLSv1</code> を使用して起動されたクライアント、および TLSv1 のみをサポートする古いクライアントの接続試行は失敗します。
              </p></li><li class="listitem"><p>
                同様に、<code class="literal">MASTER_TLS_VERSION = 'TLSv1'</code>を使用して構成されたレプリカ、および TLSv1 のみをサポートする古いレプリカの接続試行も失敗します。
              </p></li></ul></div></li><li class="listitem"><p>
            サーバーが <code class="literal">tls_version=TLSv1</code> で構成されているか、TLSv1 のみをサポートする古いサーバーである場合:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="option">--tls-version=TLSv1.1,TLSv1.2</code> で起動されたクライアントの接続試行が失敗します。
              </p></li><li class="listitem"><p>
                同様に、<code class="literal">MASTER_TLS_VERSION = 'TLSv1.1,TLSv1.2'</code>で構成されたレプリカの接続試行も失敗します。
              </p></li></ul></div></li></ul></div><p>
        MySQL では、サポートするプロトコルのリストを指定できます。 このリストは、基礎となる SSL ライブラリに直接渡され、最終的には、提供されたリストから実際に有効にするプロトコルがそのライブラリになります。 SSL ライブラリによる処理方法の詳細は、MySQL ソースコードおよび OpenSSL <a class="ulink" href="https://www.openssl.org/docs/man1.1.0/ssl/SSL_CTX_new.html" target="_top"><code class="literal">SSL_CTX_new()</code></a> のドキュメントを参照してください。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="encrypted-connection-protocol-monitoring"></a>現在のクライアントセッション TLS プロトコルおよび暗号のモニタリング</h4></div></div></div><p>
        現在のクライアントセッションが使用する暗号化 TLS プロトコルと暗号を判別するには、<code class="literal">Ssl_version</code> および <code class="literal">Ssl_cipher</code> ステータス変数のセッション値を確認します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM performance_schema.session_status</code></strong>
       <strong class="userinput"><code>WHERE VARIABLE_NAME IN ('Ssl_version','Ssl_cipher');</code></strong>
+---------------+---------------------------+
| VARIABLE_NAME | VARIABLE_VALUE            |
+---------------+---------------------------+
| Ssl_cipher    | DHE-RSA-AES128-GCM-SHA256 |
| Ssl_version   | TLSv1.2                   |
+---------------+---------------------------+
</pre><p>
        接続が暗号化されていない場合、両方の変数の値は空になります。
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="creating-ssl-rsa-files"></a>6.3.3 SSL および RSA 証明書とキーの作成</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#creating-ssl-rsa-files-using-mysql">6.3.3.1 MySQL を使用した SSL および RSA 証明書とキーの作成</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-files-using-openssl">6.3.3.2 openssl を使用した SSL 証明書およびキーの作成</a></span></dt><dt><span class="section"><a href="security.html#creating-rsa-files-using-openssl">6.3.3.3 openssl を使用した RSA キーの作成</a></span></dt></dl></div><p>
      次の説明では、MySQL での SSL および RSA サポートに必要なファイルの作成方法について説明します。 ファイルの作成は、MySQL 自体が提供する機能を使用するか、<span class="command"><strong>openssl</strong></span> コマンドを直接起動することで実行できます。 
    </p><p>
      SSL 証明書およびキーファイルを使用すると、MySQL で SSL を使用した暗号化された接続をサポートできます。 <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a>を参照してください。 
    </p><p>
      RSA キーファイルを使用すると、MySQL は、<code class="literal">sha256_password</code> または <code class="literal">caching_sha2_password</code> プラグインによって認証されたアカウントに対して、暗号化されていない接続を介したセキュアなパスワード交換をサポートできます。 <a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.3 SHA-256 プラガブル認証">セクション6.4.1.3「SHA-256 プラガブル認証」</a>および<a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.2 SHA-2 プラガブル認証のキャッシュ">セクション6.4.1.2「SHA-2 プラガブル認証のキャッシュ」</a>を参照してください。 
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="creating-ssl-rsa-files-using-mysql"></a>6.3.3.1 MySQL を使用した SSL および RSA 証明書とキーの作成</h4></div></div></div><p>
        MySQL では、SSL を使用した暗号化された接続をサポートするために必要な SSL 証明書およびキーファイルと RSA キーペアファイル、および暗号化されていない接続を介した RSA を使用したセキュアなパスワード交換 (これらのファイルがない場合) を作成するために、次の方法が提供されます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            MySQL ディストリビューションの場合、サーバーは起動時にこれらのファイルを自動生成できます。
          </p></li><li class="listitem"><p>
            ユーザーは <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> ユーティリティを手動で起動できます。
          </p></li><li class="listitem"><p>
            RPM パッケージや DEB パッケージなどの一部の配布タイプでは、データディレクトリの初期化中に <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> の起動が発生します。 この場合、<span class="command"><strong>openssl</strong></span> コマンドが使用可能であれば、OpenSSL を使用して MySQL ディストリビューションをコンパイルする必要はありません。 
          </p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          サーバーの自動生成および <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> は、必要なファイルを簡単に生成できるようにすることで、SSL を使用したバリアの低減に役立ちます。 ただし、これらの方法で生成された証明書は自己署名されているため、あまりセキュアでない可能性があります。 このようなファイルの使用経験がある場合は、登録された認証局から証明書/キーデータを取得することを検討してください。 
        </p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql-automatic" title="SSL および RSA ファイルの自動生成">SSL および RSA ファイルの自動生成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql-manual-using-mysql-ssl-rsa-setup" title="mysql_ssl_rsa_setup を使用した SSL および RSA ファイルの手動生成">mysql_ssl_rsa_setup を使用した SSL および RSA ファイルの手動生成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql-ssl-and-rsa-file-characteristics" title="SSL および RSA ファイルの特性">SSL および RSA ファイルの特性</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-automatic"></a>SSL および RSA ファイルの自動生成</h5></div></div></div><p>
          OpenSSL を使用してコンパイルされた MySQL ディストリビューションの場合、MySQL サーバーには、起動時に欠落している SSL および RSA ファイルを自動的に生成する機能があります。 <code class="literal">auto_generate_certs</code>、<code class="literal">sha256_password_auto_generate_rsa_keys</code> および <code class="literal">caching_sha2_password_auto_generate_rsa_keys</code> システム変数は、これらのファイルの自動生成を制御します。 これらの変数はデフォルトで有効になっています。 これらは起動時に有効化して検査できますが、実行時には設定できません。 
        </p><p>
          起動時に、<code class="literal">auto_generate_certs</code> システム変数が有効で、<code class="option">--ssl</code> 以外の SSL オプションが指定されておらず、サーバー側の SSL ファイルがデータディレクトリから欠落している場合、サーバーはサーバー側およびクライアント側の SSL 証明書とキーファイルをデータディレクトリに自動的に生成します。 これらのファイルにより、SSL を使用した暗号化されたクライアント接続が可能になります。<a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a> を参照してください。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              サーバーは、次の名前の SSL ファイルのデータディレクトリをチェックします:
            </p><pre class="programlisting">ca.pem
server-cert.pem
server-key.pem
</pre></li><li class="listitem"><p>
              これらのファイルのいずれかが存在する場合、サーバーは SSL ファイルを作成しません。 それ以外の場合は、それらに加えて追加のファイルが作成されます: 
            </p><pre class="programlisting">ca.pem               Self-signed CA certificate
ca-key.pem           CA private key
server-cert.pem      Server certificate
server-key.pem       Server private key
client-cert.pem      Client certificate
client-key.pem       Client private key
</pre></li><li class="listitem"><p>
              サーバーが SSL ファイルを自動生成する場合は、<code class="filename">ca.pem</code>、<code class="filename">server-cert.pem</code> および <code class="filename">server-key.pem</code> ファイルの名前を使用して、対応するシステム変数 (<code class="literal">ssl_ca</code>, <code class="literal">ssl_cert</code>, <code class="literal">ssl_key</code>) を設定します。
            </p></li></ol></div><p>
          これらの条件がすべて満たされている場合、サーバーは起動時に RSA 秘密キー/公開キーのペアファイルをデータディレクトリに自動的に生成: <code class="literal">sha256_password_auto_generate_rsa_keys</code> または <code class="literal">caching_sha2_password_auto_generate_rsa_keys</code> システム変数が有効になっており、RSA オプションが指定されていません。RSA ファイルがデータディレクトリにありません。 これらのキーペアファイルを使用すると、<code class="literal">sha256_password</code> または <code class="literal">caching_sha2_password</code> プラグインによって認証されたアカウントに対して、暗号化されていない RSA 接続を使用したセキュアなパスワード交換が可能になります。<a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.3 SHA-256 プラガブル認証">セクション6.4.1.3「SHA-256 プラガブル認証」</a> および <a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.2 SHA-2 プラガブル認証のキャッシュ">セクション6.4.1.2「SHA-2 プラガブル認証のキャッシュ」</a> を参照してください。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              サーバーは、RSA ファイルのデータディレクトリを次の名前でチェックします:
            </p><pre class="programlisting">private_key.pem      Private member of private/public key pair
public_key.pem       Public member of private/public key pair
</pre></li><li class="listitem"><p>
              これらのファイルのいずれかが存在する場合、サーバーは RSA ファイルを作成しません。 それ以外の場合は、作成されます。 
            </p></li><li class="listitem"><p>
              サーバーは RSA ファイルを自動生成する場合、その名前を使用して、対応するシステム変数 (<code class="literal">sha256_password_private_key_path</code> および <code class="literal">sha256_password_public_key_path</code>、<code class="literal">caching_sha2_password_private_key_path</code> および <code class="literal">caching_sha2_password_public_key_path</code>) を設定します。
            </p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-manual-using-mysql-ssl-rsa-setup"></a>mysql_ssl_rsa_setup を使用した SSL および RSA ファイルの手動生成</h5></div></div></div><p>
          MySQL ディストリビューションには、SSL および RSA ファイルを生成するために手動で起動できる <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> ユーティリティが含まれています。 このユーティリティはすべての MySQL ディストリビューションに含まれていますが、<span class="command"><strong>openssl</strong></span> コマンドを使用できる必要があります。 使用手順については、<a class="xref" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — SSL/RSA ファイルの作成">セクション4.4.3「mysql_ssl_rsa_setup — SSL/RSA ファイルの作成」</a> を参照してください。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-ssl-and-rsa-file-characteristics"></a>SSL および RSA ファイルの特性</h5></div></div></div><p>
          サーバーまたは <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> の起動によって自動的に作成される SSL および RSA ファイルには、次の特性があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              SSL および RSA キーのサイズは 2048 ビットです。
            </p></li><li class="listitem"><p>
              SSL CA 証明書は自己署名されています。
            </p></li><li class="listitem"><p>
              SSL サーバーおよびクライアント証明書は、<code class="literal">sha256WithRSAEncryption</code> 署名アルゴリズムを使用して CA 証明書およびキーで署名されます。
            </p></li><li class="listitem"><p>
              SSL 証明書は、適切な証明書タイプ (CA、サーバー、クライアント) で次の共通名 (CN) 値を使用します:
            </p><pre class="programlisting">ca.pem:         MySQL_Server_<em class="replaceable"><code>suffix</code></em>_Auto_Generated_CA_Certificate
server-cert.pm: MySQL_Server_<em class="replaceable"><code>suffix</code></em>_Auto_Generated_Server_Certificate
client-cert.pm: MySQL_Server_<em class="replaceable"><code>suffix</code></em>_Auto_Generated_Client_Certificate
</pre><p>
              <em class="replaceable"><code>suffix</code></em> の値は、MySQL のバージョン番号に基づきます。 <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> によって生成されたファイルの場合、<code class="option">--suffix</code> オプションを使用して接尾辞を明示的に指定できます。 
            </p><p>
              サーバーによって生成されたファイルの場合、CN 値が 64 文字を超えると、名前の<code class="literal">_<em class="replaceable"><code>suffix</code></em></code> 部分は省略されます。
            </p></li><li class="listitem"><p>
              SSL ファイルには、国 (C)、都道府県 (ST)、組織 (O)、組織単位名 (OU) および電子メールアドレスの空白値があります。
            </p></li><li class="listitem"><p>
              サーバーまたは <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> によって作成された SSL ファイルは、生成後 10 年間有効です。
            </p></li><li class="listitem"><p>
              RSA ファイルは期限切れになりません。
            </p></li><li class="listitem"><p>
              SSL ファイルには、証明書とキーのペアごとに異なるシリアル番号があります (CA の場合は 1、サーバーの場合は 2、クライアントの場合は 3)。
            </p></li><li class="listitem"><p>
              サーバーによって自動的に作成されたファイルは、サーバーを実行するアカウントによって所有されます。 <span class="command"><strong>mysql_ssl_rsa_setup</strong></span> を使用して作成されたファイルは、そのプログラムを起動したユーザーが所有します。 これは、プログラムが <code class="literal">root</code> によって起動され、ファイルを所有するユーザーを指定する <code class="option">--uid</code> オプションが指定されている場合に、<code class="literal">chown()</code> システムコールをサポートするシステムで変更できます。 
            </p></li><li class="listitem"><p>
              Unix および Unix に似たシステムでは、ファイルアクセスモードは、証明書ファイルの場合は 644 (ワールド読取り可能) で、キーファイルの場合は 600 (つまり、サーバーを実行するアカウントによってのみアクセス可能) です。
            </p></li></ul></div><p>
          SSL 証明書の内容を確認するには (たとえば、有効な日付の範囲を確認するには)、<span class="command"><strong>openssl</strong></span> を直接起動します:
        </p><pre class="programlisting">openssl x509 -text -in ca.pem
openssl x509 -text -in server-cert.pem
openssl x509 -text -in client-cert.pem
</pre><p>
          次の SQL ステートメントを使用して SSL 証明書の有効期限情報を確認することもできます:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Ssl_server_not%';</code></strong>
+-----------------------+--------------------------+
| Variable_name         | Value                    |
+-----------------------+--------------------------+
| Ssl_server_not_after  | Apr 28 14:16:39 2027 GMT |
| Ssl_server_not_before | May  1 14:16:39 2017 GMT |
+-----------------------+--------------------------+
</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="creating-ssl-files-using-openssl"></a>6.3.3.2 openssl を使用した SSL 証明書およびキーの作成</h4></div></div></div><p>
        このセクションでは、<span class="command"><strong>openssl</strong></span> コマンドを使用して、MySQL サーバーおよびクライアントで使用する SSL 証明書およびキーファイルを設定する方法について説明します。 1 番目の例は、コマンド行から使用する場合などの単純化された手順を示しています。 2 番目では、より詳細なものを含むスクリプトを示します。 最初の 2 つの例は、Unix で使用するためのものであり、どちらの例でも OpenSSL の一部である <span class="command"><strong>openssl</strong></span> コマンドが使用されます。 3 番目の例では、Windows 上で SSL ファイルを設定する方法について説明します。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          ここで説明する手順よりも SSL に必要なファイルを生成する方が簡単です: サーバーで自動生成するか、<span class="command"><strong>mysql_ssl_rsa_setup</strong></span> プログラムを使用します。 <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 MySQL を使用した SSL および RSA 証明書とキーの作成">セクション6.3.3.1「MySQL を使用した SSL および RSA 証明書とキーの作成」</a>を参照してください。 
        </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          証明書および鍵ファイルを生成する際にどの方法を使用するのかには関係なく、サーバーおよびクライアントの証明書と鍵で使用される Common Name の値はそれぞれ、CA 証明書で使用されている Common Name の値と異なる必要があります。 そうしないと、OpenSSL を使用してコンパイルされたサーバーで証明書およびキーファイルが機能しません。 この場合の一般的なエラーは、次のとおりです。 
        </p><pre class="programlisting">ERROR 2026 (HY000): SSL connection error:
error:00000001:lib(0):func(0):reason(1)
</pre></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-files-using-openssl-unix-command-line" title="例 1: Unix でコマンド行から SSL ファイルを作成する">例 1: Unix でコマンド行から SSL ファイルを作成する</a></p></li><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-files-using-openssl-unix-script" title="例 2: Unix でスクリプトを使用して SSL ファイルを作成する">例 2: Unix でスクリプトを使用して SSL ファイルを作成する</a></p></li><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-files-using-openssl-windows" title="例 3: Windows で SSL ファイルを作成する">例 3: Windows で SSL ファイルを作成する</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="creating-ssl-files-using-openssl-unix-command-line"></a>例 1: Unix でコマンド行から SSL ファイルを作成する</h5></div></div></div><p>
          次の例には、MySQL サーバーおよびクライアントの証明書および鍵ファイルを作成するためのコマンドセットを示します。 <span class="command"><strong>openssl</strong></span> コマンドでは、複数のプロンプトに応答する必要があります。 すべてのプロンプトに対して Enter キーを押せば、テストファイルを生成できます。 本番環境用のファイルを生成するには、空でない回答を提供するようにしてください。 
        </p><pre class="programlisting"># Create clean environment
rm -rf newcerts
mkdir newcerts &amp;&amp; cd newcerts

# Create CA certificate
openssl genrsa 2048 &gt; ca-key.pem
openssl req -new -x509 -nodes -days 3600 \
        -key ca-key.pem -out ca.pem

# Create server certificate, remove passphrase, and sign it
# server-cert.pem = public key, server-key.pem = private key
openssl req -newkey rsa:2048 -days 3600 \
        -nodes -keyout server-key.pem -out server-req.pem
openssl rsa -in server-key.pem -out server-key.pem
openssl x509 -req -in server-req.pem -days 3600 \
        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem

# Create client certificate, remove passphrase, and sign it
# client-cert.pem = public key, client-key.pem = private key
openssl req -newkey rsa:2048 -days 3600 \
        -nodes -keyout client-key.pem -out client-req.pem
openssl rsa -in client-key.pem -out client-key.pem
openssl x509 -req -in client-req.pem -days 3600 \
        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out client-cert.pem
</pre><p>
          証明書が生成されたら、それらを確認します。
        </p><pre class="programlisting">openssl verify -CAfile ca.pem server-cert.pem client-cert.pem
</pre><p>
          次のようなレスポンスが表示されます:
        </p><pre class="programlisting">server-cert.pem: OK
client-cert.pem: OK
</pre><p>
          証明書の内容を表示するには (たとえば、証明書が有効な日付の範囲を確認するには)、次のように <span class="command"><strong>openssl</strong></span> を起動します:
        </p><pre class="programlisting">openssl x509 -text -in ca.pem
openssl x509 -text -in server-cert.pem
openssl x509 -text -in client-cert.pem
</pre><p>
          この時点で、次のようなファイルセットを使用できます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">ca.pem</code>: これを使用して、サーバー側で <code class="literal">ssl_ca</code> システム変数を設定し、クライアント側で <code class="option">--ssl-ca</code> オプションを設定します。 (CA 証明書を使用する場合は、両側で同じものを指定する必要があります。) 
            </p></li><li class="listitem"><p>
              <code class="filename">server-cert.pem</code>, <code class="filename">server-key.pem</code>: これらを使用して、サーバー側で <code class="literal">ssl_cert</code> および <code class="literal">ssl_key</code> システム変数を設定します。
            </p></li><li class="listitem"><p>
              <code class="filename">client-cert.pem</code>, <code class="filename">client-key.pem</code>: これらは、クライアント側の <code class="option">--ssl-cert</code> および <code class="option">--ssl-key</code> オプションの引数として使用します。
            </p></li></ul></div><p>
          その他の使用手順については、<a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a> を参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="creating-ssl-files-using-openssl-unix-script"></a>例 2: Unix でスクリプトを使用して SSL ファイルを作成する</h5></div></div></div><p>
          次に、MySQL に SSL 証明書および鍵ファイルを設定する方法を示したサンプルスクリプトを示します。 スクリプトの実行後、<a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a> の説明に従って SSL 接続用のファイルを使用します。 
        </p><pre class="programlisting">DIR=`pwd`/openssl
PRIV=$DIR/private

mkdir $DIR $PRIV $DIR/newcerts
cp /usr/share/ssl/openssl.cnf $DIR
replace ./demoCA $DIR -- $DIR/openssl.cnf

# Create necessary files: $database, $serial and $new_certs_dir
# directory (optional)

touch $DIR/index.txt
echo "01" &gt; $DIR/serial

#
# Generation of Certificate Authority(CA)
#

openssl req -new -x509 -keyout $PRIV/cakey.pem -out $DIR/ca.pem \
    -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/jones/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ................++++++
# .........++++++
# writing new private key to '/home/jones/openssl/private/cakey.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information to be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL admin
# Email Address []:

#
# Create server request and key
#
openssl req -new -keyout $DIR/server-key.pem -out \
    $DIR/server-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/jones/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ..++++++
# ..........++++++
# writing new private key to '/home/jones/openssl/server-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL server
# Email Address []:
#
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key
#
openssl rsa -in $DIR/server-key.pem -out $DIR/server-key.pem

#
# Sign server cert
#
openssl ca -cert $DIR/ca.pem -policy policy_anything \
    -out $DIR/server-cert.pem -config $DIR/openssl.cnf \
    -infiles $DIR/server-req.pem

# Sample output:
# Using configuration from /home/jones/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL admin'
# Certificate is to be certified until Sep 13 14:22:46 2003 GMT
# (365 days)
# Sign the certificate? [y/n]:y
#
#
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create client request and key
#
openssl req -new -keyout $DIR/client-key.pem -out \
    $DIR/client-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/jones/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# .....................................++++++
# .............................................++++++
# writing new private key to '/home/jones/openssl/client-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL user
# Email Address []:
#
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key
#
openssl rsa -in $DIR/client-key.pem -out $DIR/client-key.pem

#
# Sign client cert
#

openssl ca -cert $DIR/ca.pem -policy policy_anything \
    -out $DIR/client-cert.pem -config $DIR/openssl.cnf \
    -infiles $DIR/client-req.pem

# Sample output:
# Using configuration from /home/jones/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL user'
# Certificate is to be certified until Sep 13 16:45:17 2003 GMT
# (365 days)
# Sign the certificate? [y/n]:y
#
#
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create a my.cnf file that you can use to test the certificates
#

cat &lt;&lt;EOF &gt; $DIR/my.cnf
[client]
ssl-ca=$DIR/ca.pem
ssl-cert=$DIR/client-cert.pem
ssl-key=$DIR/client-key.pem
[mysqld]
ssl_ca=$DIR/ca.pem
ssl_cert=$DIR/server-cert.pem
ssl_key=$DIR/server-key.pem
EOF
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="creating-ssl-files-using-openssl-windows"></a>例 3: Windows で SSL ファイルを作成する</h5></div></div></div><p>
          Windows 用の OpenSSL がシステムにインストールされていない場合は、それをダウンロードします。 次に、使用可能なパッケージの概要を示します。 
        </p><pre class="programlisting"><a class="ulink" href="http://www.slproweb.com/products/Win32OpenSSL.html" target="_top">http://www.slproweb.com/products/Win32OpenSSL.html</a>
</pre><p>
          アーキテクチャー (32 ビットまたは 64 ビット) に応じて、Win32 OpenSSL Light または Win64 OpenSSL Light パッケージを選択します。 デフォルトのインストール場所は、ダウンロードしたパッケージに応じて <code class="literal">C:\OpenSSL-Win32</code> または <code class="literal">C:\OpenSSL-Win64</code> です。 次の手順では、デフォルトの場所が <code class="literal">C:\OpenSSL-Win32</code> であることが前提となっています。 64 ビットのパッケージを使用している場合は、必要に応じて、これを変更します。 
        </p><p>
          設定中に<code class="literal">「...critical component is missing: Microsoft Visual C++ 2008 Redistributables」</code>というメッセージが発生した場合は、設定を取り消し、アーキテクチャー (32 ビットまたは 64 ビット) に応じて、次のパッケージのいずれかをダウンロードします。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Visual C++ 2008 Redistributables (x86) (次の場所で入手可能):
            </p><pre class="programlisting"><a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF" target="_top">http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF</a>
</pre></li><li class="listitem"><p>
              Visual C++ 2008 Redistributables (x64) (次の場所で入手可能):
            </p><pre class="programlisting"><a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6" target="_top">http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6</a>
</pre></li></ul></div><p>
          追加のパッケージをインストールしたら、OpenSSL の設定手順を再開します。
        </p><p>
          インストール時に、インストールパスとしてデフォルトの <code class="filename">C:\OpenSSL-Win32</code> のままにして、デフォルトの<code class="literal">「Copy OpenSSL DLL files to the Windows system directory」</code>オプションも選択されたままにします。
        </p><p>
          インストールが完了したら、<code class="filename">C:\OpenSSL-Win32\bin</code> をサーバーの Windows システムパス変数に追加します (Windows のバージョンによっては、次のパス設定手順が若干異なる場合があります):
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Windows デスクトップで、<span class="guiicon">「マイコンピュータ」</span> アイコンを右クリックして<span class="guimenuitem">「プロパティ」</span>を選択します。
            </p></li><li class="listitem"><p>
              表示された<span class="guimenu">「システムのプロパティ」</span>メニューから<span class="guimenuitem">「詳細設定」</span>タブを選択し、<span class="guibutton">「環境変数」</span>ボタンをクリックします。
            </p></li><li class="listitem"><p>
              <span class="guilabel">「システム変数」</span>で<span class="guimenuitem">「パス」</span>を選択してから、<span class="guibutton">「編集」</span>ボタンをクリックします。 <span class="guimenu">「システム変数の編集」</span>のダイアログが表示されます。 
            </p></li><li class="listitem"><p>
              末尾に<code class="literal">「;C:\OpenSSL-Win32\bin」</code>を追加します (セミコロンに注意してください)。
            </p></li><li class="listitem"><p>
              「OK」を 3 回押します。
            </p></li><li class="listitem"><p>
              新しいコマンドコンソール (<span class="command"><strong>Start&gt;Run&gt;cmd.exe</strong></span>) を開いて、OpenSSL が使用可能であることを確認することで、OpenSSL が Path 変数に正しく統合されたことをチェックします。
            </p><pre class="programlisting">Microsoft Windows [Version ...]
Copyright (c) 2006 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;<strong class="userinput"><code>cd \</code></strong>

C:\&gt;<strong class="userinput"><code>openssl</code></strong>
OpenSSL&gt; <strong class="userinput"><code>exit</code></strong> &lt;&lt;&lt; If you see the OpenSSL prompt, installation was successful.

C:\&gt;
</pre></li></ol></div><p>
          OpenSSL がインストールされたら、(このセクションの前半で示した) 例 1 と同様の手順を次のように変更して使用します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              次のように Unix コマンドを変更します。
            </p><pre class="programlisting"># Create clean environment
rm -rf newcerts
mkdir newcerts &amp;&amp; cd newcerts
</pre><p>
              Windows では、代わりに次のコマンドを使用します。
            </p><pre class="programlisting"># Create clean environment
md c:\newcerts
cd c:\newcerts
</pre></li><li class="listitem"><p>
              コマンド行の末尾に<code class="literal">「\」</code>文字が表示されたら、この<code class="literal">「\」</code>文字を削除し、コマンド行をすべて 1 行で入力する必要があります。
            </p></li></ul></div><p>
          証明書およびキーファイルを生成した後、それらを SSL 接続に使用するには、<a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a> を参照してください。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="creating-rsa-files-using-openssl"></a>6.3.3.3 openssl を使用した RSA キーの作成</h4></div></div></div><p>
        このセクションでは、<span class="command"><strong>openssl</strong></span> コマンドを使用して RSA キーファイルを設定する方法について説明します。RSA キーファイルを使用すると、MySQL は、<code class="literal">sha256_password</code> および <code class="literal">caching_sha2_password</code> プラグインによって認証されたアカウントの暗号化されていない接続を介したセキュアなパスワード交換をサポートできます。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          RSA に必要なファイルを生成する方法は、ここで説明する手順よりも簡単です: サーバーで自動生成するか、<span class="command"><strong>mysql_ssl_rsa_setup</strong></span> プログラムを使用します。 <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 MySQL を使用した SSL および RSA 証明書とキーの作成">セクション6.3.3.1「MySQL を使用した SSL および RSA 証明書とキーの作成」</a>を参照してください。 
        </p></div><p>
        RSA 秘密キーと公開キーのペアのファイルを作成するには、MySQL サーバーの実行に使用されたシステムアカウントにログインして、そのアカウントがファイルを所有するように、次のコマンドを実行します:
      </p><pre class="programlisting">openssl genrsa -out private_key.pem 2048
openssl rsa -in private_key.pem -pubout -out public_key.pem
</pre><p>
        これらのコマンドでは、2,048 ビットの鍵が作成されます。 より強力なキーを作成するには、大きい値を使用します。 
      </p><p>
        次に、鍵ファイルのアクセスモードを設定します。 秘密鍵は、サーバーからのみ読み取り可能にするべきです。一方で、公開鍵は、クライアントユーザーに自由に配布できます。 
      </p><pre class="programlisting">chmod 400 private_key.pem
chmod 444 public_key.pem
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="windows-and-ssh"></a>6.3.4 SSH を使用した Windows から MySQL へのリモート接続</h3></div></div></div><a class="indexterm" name="idm46723760493728"></a><a class="indexterm" name="idm46723760492480"></a><a class="indexterm" name="idm46723760490320"></a><p>
      このセクションでは、SSH を使用してリモート MySQL サーバーへの暗号化された接続を取得する方法について説明します。 この情報は、David Carlson <code class="email">&lt;<a class="email" href="mailto:dcarlson@mplcomm.com">dcarlson@mplcomm.com</a>&gt;</code> によって提供されました。 
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Windows マシン上に SSH クライアントをインストールします。 SSH クライアントの比較については、<a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</a>を参照してください。 
        </p></li><li class="listitem"><p>
          Windows SSH クライアントを起動します。 <code class="literal">Host_Name = <em class="replaceable"><code>yourmysqlserver_URL_or_IP</code></em></code> を設定します。 サーバーにログインする <code class="literal">userid=<em class="replaceable"><code>your_userid</code></em></code> を設定します。 この <code class="literal">userid</code> 値は、MySQL アカウントのユーザー名と同じでない可能性があります。 
        </p></li><li class="listitem"><p>
          ポートフォワーディングを設定します。 リモート転送 (<code class="literal">local_port: 3306</code>、<code class="literal">remote_host: <em class="replaceable"><code>yourmysqlservername_or_ip</code></em></code>、<code class="literal">remote_port: 3306</code> を設定します) とローカル転送 (<code class="literal">port: 3306</code>、<code class="literal">host: localhost</code>、<code class="literal">remote port: 3306</code> を設定します) のいずれかを実行します。 
        </p></li><li class="listitem"><p>
          すべて保存します。保存しない場合は、次回再実行する必要があります。
        </p></li><li class="listitem"><p>
          作成した SSH セッションを使用して、サーバーにログインします。
        </p></li><li class="listitem"><p>
          Windows マシン上で、いくつかの ODBC アプリケーション (Access など) を起動します。
        </p></li><li class="listitem"><p>
          通常と同じ方法で、Windows で新しいファイルを作成し、ODBC ドライバを使用して MySQL へのリンクを作成します。ただし、MySQL ホストサーバーでは、<em class="replaceable"><code>yourmysqlservername</code></em> ではなく、<code class="literal">localhost</code> に入力します。
        </p></li></ol></div><p>
      この時点で、MySQL への ODBC 接続が SSH を使用して暗号化されているはずです。
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-plugins"></a>6.4 セキュリティコンポーネントおよびプラグイン</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#authentication-plugins">6.4.1 認証プラグイン</a></span></dt><dt><span class="section"><a href="security.html#connection-control">6.4.2 Connection-Control プラグイン</a></span></dt><dt><span class="section"><a href="security.html#validate-password">6.4.3 パスワード検証コンポーネント</a></span></dt><dt><span class="section"><a href="security.html#keyring">6.4.4 MySQL キーリング</a></span></dt><dt><span class="section"><a href="security.html#audit-log">6.4.5 MySQL Enterprise Audit</a></span></dt><dt><span class="section"><a href="security.html#audit-api-message-emit">6.4.6 監査メッセージコンポーネント</a></span></dt><dt><span class="section"><a href="security.html#firewall">6.4.7 MySQL Enterprise Firewall</a></span></dt></dl></div><a class="indexterm" name="idm46723760467792"></a><a class="indexterm" name="idm46723760465680"></a><a class="indexterm" name="idm46723760463648"></a><a class="indexterm" name="idm46723760461728"></a><p>
    MySQL には、セキュリティ機能を実装するいくつかのコンポーネントおよびプラグインが含まれています:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        クライアントによる MySQL Server への接続試行を認証するためのプラグイン。 プラグインは、複数の認証プロトコルで使用できます。 認証プロセスの概要は、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a> を参照してください。 特定の認証プラグインの特性については、<a class="xref" href="security.html#authentication-plugins" title="6.4.1 認証プラグイン">セクション6.4.1「認証プラグイン」</a> を参照してください。 
      </p></li><li class="listitem"><p>
        パスワード強度ポリシーを実装し、潜在的なパスワードの強度を評価するためのパスワード検証コンポーネント。 <a class="xref" href="security.html#validate-password" title="6.4.3 パスワード検証コンポーネント">セクション6.4.3「パスワード検証コンポーネント」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        機密情報用のセキュアなストレージを提供するキーリングプラグイン。 <a class="xref" href="security.html#keyring" title="6.4.4 MySQL キーリング">セクション6.4.4「MySQL キーリング」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        (MySQL Enterprise Edition のみ) サーバープラグインを使用して実装された MySQL Enterprise Audit は、オープン MySQL 監査 API を使用して、特定の MySQL サーバーで実行された接続およびクエリーアクティビティの標準のポリシーベースの監視およびロギングを有効にします。 MySQL Enterprise Audit は、Oracle 監査仕様を満たすように設計されており、内部および外部の規制ガイドラインによって管理されるアプリケーションに対して、すぐに使用できる監査およびコンプライアンスソリューションを提供します。 <a class="xref" href="security.html#audit-log" title="6.4.5 MySQL Enterprise Audit">セクション6.4.5「MySQL Enterprise Audit」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        ユーザー定義関数を使用すると、アプリケーションで独自のメッセージイベントを監査ログに追加できます。 <a class="xref" href="security.html#audit-api-message-emit" title="6.4.6 監査メッセージコンポーネント">セクション6.4.6「監査メッセージコンポーネント」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        (MySQL Enterprise Edition のみ) MySQL Enterprise Firewall は、データベース管理者が受け入れられたステートメントパターンのリストに対する照合に基づいて SQL ステートメントの実行を許可または拒否できるようにするアプリケーションレベルのファイアウォールです。 これにより、SQL インジェクションなどの攻撃や、正当なクエリーワークロード特性の外部でアプリケーションを使用することで、アプリケーションを利用しようとする攻撃に対して MySQL Server を強化できます。 <a class="xref" href="security.html#firewall" title="6.4.7 MySQL Enterprise Firewall">セクション6.4.7「MySQL Enterprise Firewall」</a>を参照してください。 
      </p></li><li class="listitem"><p>
        (MySQL Enterprise Edition のみ) プラグインおよび一連のユーザー定義関数を含むプラグインライブラリとして実装される MySQL Enterprise Data Masking and De-Identification。 データマスキングでは、実際の値を置換で置換することで機密情報が非表示になります。MySQL Enterprise Data Masking and De-Identification 関数を使用すると、不明瞭化 (識別特性の削除)、フォーマットされたランダムデータの生成、データの置換または置換など、いくつかの方法を使用して既存のデータをマスキングできます。 <a class="xref" href="security.html#data-masking" title="6.5 MySQL Enterprise Data Masking and De-Identification">セクション6.5「MySQL Enterprise Data Masking and De-Identification」</a>を参照してください。 
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="authentication-plugins"></a>6.4.1 認証プラグイン</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#native-pluggable-authentication">6.4.1.1 ネイティブプラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#caching-sha2-pluggable-authentication">6.4.1.2 SHA-2 プラガブル認証のキャッシュ</a></span></dt><dt><span class="section"><a href="security.html#sha256-pluggable-authentication">6.4.1.3 SHA-256 プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#cleartext-pluggable-authentication">6.4.1.4 クライアント側クリアテキストプラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#pam-pluggable-authentication">6.4.1.5 PAM プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#windows-pluggable-authentication">6.4.1.6 Windows プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#ldap-pluggable-authentication">6.4.1.7 LDAP プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#no-login-pluggable-authentication">6.4.1.8 ログインなしのプラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#socket-pluggable-authentication">6.4.1.9 ソケットピア資格証明プラガブル認証</a></span></dt><dt><span class="section"><a href="security.html#test-pluggable-authentication">6.4.1.10 プラガブル認証のテスト</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication-system-variables">6.4.1.11 プラガブル認証システム変数</a></span></dt></dl></div><p>
      次の各セクションでは、MySQL で使用可能なプラガブル認証方式と、これらの方式を実装するプラグインについて説明します。 認証プロセスの概要は、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a> を参照してください。 
    </p><p>
      デフォルトのプラグインは、<code class="literal">default_authentication_plugin</code> システム変数の値で示されます。
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="native-pluggable-authentication"></a>6.4.1.1 ネイティブプラガブル認証</h4></div></div></div><a class="indexterm" name="idm46723760437792"></a><a class="indexterm" name="idm46723760436240"></a><p>
        MySQL には、ネイティブ認証 (プラガブル認証の導入前から使用されていたパスワードハッシュ方式に基づく認証) を実装する <code class="literal">mysql_native_password</code> プラグインが含まれています。
      </p><p>
        次の表に、サーバー側とクライアント側のプラグイン名を示します。
      </p><div class="table"><a name="idm46723760432128"></a><p class="title"><b>表 6.12 ネイティブパスワード認証用のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for native password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td><code class="literal">mysql_native_password</code></td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td><code class="literal">mysql_native_password</code></td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td>なし (プラグインは組み込み済み)</td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        次の各セクションでは、ネイティブプラガブル認証に固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#native-pluggable-authentication-installation" title="ネイティブプラガブル認証のインストール">ネイティブプラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#native-pluggable-authentication-usage" title="ネイティブプラガブル認証の使用">ネイティブプラガブル認証の使用</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="native-pluggable-authentication-installation"></a>ネイティブプラガブル認証のインストール</h5></div></div></div><p>
          <code class="literal">mysql_native_password</code> プラグインは、サーバーおよびクライアントフォームに存在します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              サーバー側のプラグインはサーバーに組み込まれているため、明示的にロードする必要はなく、アンロードしても無効にすることができません。
            </p></li><li class="listitem"><p>
              クライアント側プラグインは <code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれており、<code class="literal">libmysqlclient</code> に対してリンクされているすべてのプログラムで使用できます。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="native-pluggable-authentication-usage"></a>ネイティブプラガブル認証の使用</h5></div></div></div><p>
          MySQL クライアントプログラムでは、デフォルトで <code class="literal">mysql_native_password</code> が使用されます。 <code class="option">--default-auth</code> オプションは、プログラムがどのクライアント側プラグインを使用できるかに関するヒントとして使用できます: 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --default-auth=mysql_native_password ...</code></strong>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="caching-sha2-pluggable-authentication"></a>6.4.1.2 SHA-2 プラガブル認証のキャッシュ</h4></div></div></div><a class="indexterm" name="idm46723760400992"></a><a class="indexterm" name="idm46723760399440"></a><p>
        MySQL には、ユーザーアカウントパスワードの SHA-256 ハッシングを実装する次の 2 つの認証プラグインが用意されています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">sha256_password</code>: 基本 SHA-256 認証を実装します。
          </p></li><li class="listitem"><p>
            <code class="literal">caching_sha2_password</code>: SHA-256 認証 (<code class="literal">sha256_password</code> など) を実装しますが、パフォーマンスを向上させるためにサーバー側でキャッシュを使用し、適用性を高めるための追加機能を備えています。
          </p></li></ul></div><p>
        このセクションでは、キャッシュ SHA-2 認証プラグインについて説明します。 元の基本 (非キャッシュ) プラグインの詳細は、<a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.3 SHA-256 プラガブル認証">セクション6.4.1.3「SHA-256 プラガブル認証」</a> を参照してください。 
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          MySQL 8.0 では、<code class="literal">caching_sha2_password</code> が <code class="literal">mysql_native_password</code> ではなくデフォルトの認証プラグインです。 サーバー操作に対するこの変更の影響、およびサーバーとクライアントおよびコネクタとの互換性の詳細は、<a class="xref" href="installing.html#upgrade-caching-sha2-password" title="優先認証プラグインとしての caching_sha2_password">優先認証プラグインとしての caching_sha2_password</a> を参照してください。 
        </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          <code class="literal">caching_sha2_password</code> プラグインで認証されるアカウントを使用してサーバーに接続するには、このセクションで後述するように、RSA キーペアを使用したパスワード交換をサポートするセキュアな接続または暗号化されていない接続を使用する必要があります。 どちらの方法でも、<code class="literal">caching_sha2_password</code> プラグインは MySQL 暗号化機能を使用します。 <a class="xref" href="security.html#encrypted-connections" title="6.3 暗号化された接続の使用">セクション6.3「暗号化された接続の使用」</a>を参照してください。 
        </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">sha256_password</code> という名前の <span class="quote">「<span class="quote">sha256</span>」</span> は、プラグインが暗号化に使用する 256 ビットのダイジェスト長を表します。 <code class="literal">caching_sha2_password</code> という名前では、<span class="quote">「<span class="quote">sha2</span>」</span> はより一般的に暗号化アルゴリズムの SHA-2 クラスを指し、256 ビット暗号化は 1 つのインスタンスです。 後者の名前を選択すると、プラグイン名を変更せずに、可能性のあるダイジェスト長を将来拡張するための領域が残されます。 
        </p></div><p>
        <code class="literal">caching_sha2_password</code> プラグインには、<code class="literal">sha256_password</code> と比較して次の利点があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー側では、インメモリーキャッシュを使用すると、再接続時に以前に接続したユーザーの再認証を高速化できます。
          </p></li><li class="listitem"><p>
            RSA ベースのパスワード交換は、MySQL がリンクされている SSL ライブラリに関係なく使用できます。
          </p></li><li class="listitem"><p>
            Unix ソケットファイルおよび共有メモリープロトコルを使用するクライアント接続のサポートが提供されます。
          </p></li></ul></div><p>
        次の表に、サーバー側とクライアント側のプラグイン名を示します。
      </p><div class="table"><a name="idm46723760373312"></a><p class="title"><b>表 6.13 SHA-2 認証用のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for SHA-2 password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td><code class="literal">caching_sha2_password</code></td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td><code class="literal">caching_sha2_password</code></td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td>なし (プラグインは組み込み済み)</td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        次の各セクションでは、SHA-2 プラガブル認証のキャッシュに固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#caching-sha2-pluggable-authentication-installation" title="SHA-2 プラガブル認証のインストール">SHA-2 プラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#caching-sha2-pluggable-authentication-usage" title="SHA-2 プラガブル認証の使用">SHA-2 プラガブル認証の使用</a></p></li><li class="listitem"><p><a class="xref" href="security.html#caching-sha2-pluggable-authentication-cache-operation" title="SHA-2 プラガブル認証のキャッシュ操作">SHA-2 プラガブル認証のキャッシュ操作</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="caching-sha2-pluggable-authentication-installation"></a>SHA-2 プラガブル認証のインストール</h5></div></div></div><p>
          <code class="literal">caching_sha2_password</code> プラグインは、サーバーおよびクライアントフォームに存在します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              サーバー側のプラグインはサーバーに組み込まれているため、明示的にロードする必要はなく、アンロードしても無効にすることができません。
            </p></li><li class="listitem"><p>
              クライアント側プラグインは <code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれており、<code class="literal">libmysqlclient</code> に対してリンクされているすべてのプログラムで使用できます。
            </p></li></ul></div><p>
          サーバー側プラグインは、<code class="literal">sha2_cache_cleaner</code> 監査プラグインをヘルパーとして使用して、パスワードキャッシュ管理を実行します。<code class="literal">caching_sha2_password</code> と同様に、<code class="literal">sha2_cache_cleaner</code> は組み込まれており、インストールする必要はありません。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="caching-sha2-pluggable-authentication-usage"></a>SHA-2 プラガブル認証の使用</h5></div></div></div><p>
          SHA-256 パスワードハッシュ用の <code class="literal">caching_sha2_password</code> プラグインを使用するアカウントを設定するには、次のステートメントを使用します。ここで、<em class="replaceable"><code>password</code></em> は目的のアカウントパスワードです:
        </p><pre class="programlisting">CREATE USER 'sha2user'@'localhost'
IDENTIFIED WITH caching_sha2_password BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          サーバーは <code class="literal">caching_sha2_password</code> プラグインをアカウントに割り当て、それを使用して SHA-256 を使用してパスワードを暗号化し、<code class="literal">mysql.user</code> システムテーブルの <code class="literal">plugin</code> および <code class="literal">authentication_string</code> カラムにそれらの値を格納します。
        </p><p>
          前述の手順では、<code class="literal">caching_sha2_password</code> がデフォルトの認証プラグインであると想定していません。 <code class="literal">caching_sha2_password</code> がデフォルトの認証プラグインである場合は、より単純な <code class="literal">CREATE USER</code> 構文を使用できます。 
        </p><p>
          デフォルトの認証プラグインを <code class="literal">caching_sha2_password</code> に設定してサーバーを起動するには、サーバーオプションファイルに次の行を入力します:
        </p><pre class="programlisting">[mysqld]
default_authentication_plugin=caching_sha2_password
</pre><p>
          これにより、<code class="literal">caching_sha2_password</code> プラグインが新しいアカウントにデフォルトで使用されます。 その結果、プラグインに明示的に名前を付けずに、アカウントを作成してそのパスワードを設定できます: 
        </p><pre class="programlisting">CREATE USER 'sha2user'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          <code class="literal">default_authentication_plugin</code> を <code class="literal">caching_sha2_password</code> に設定した場合の別の結果は、アカウントの作成に他のプラグインを使用するには、そのプラグインを明示的に指定する必要があることです。 たとえば、<code class="literal">mysql_native_password</code> プラグインを使用するには、次のステートメントを使用します: 
        </p><pre class="programlisting">CREATE USER 'nativeuser'@'localhost'
IDENTIFIED WITH mysql_native_password BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          <code class="literal">caching_sha2_password</code> は、セキュアなトランスポートを介した接続をサポートしています。 このセクションで後述する RSA の構成手順に従うと、暗号化されていない RSA 接続を介した暗号化されたパスワード交換もサポートされます。 RSA サポートには、次の特性があります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              サーバー側では、RSA 秘密キーペアファイルと公開キーペアファイルに 2 つのシステム変数が指定されます: <code class="literal">caching_sha2_password_private_key_path</code> および <code class="literal">caching_sha2_password_public_key_path</code>。 使用するキーファイルの名前がシステム変数のデフォルト値と異なる場合、データベース管理者はサーバーの起動時にこれらの変数を設定する必要があります。 
            </p></li><li class="listitem"><p>
              サーバーは、<code class="literal">caching_sha2_password_auto_generate_rsa_keys</code> システム変数を使用して RSA キーペアファイルを自動的に生成するかどうかを決定します。 <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 SSL および RSA 証明書とキーの作成">セクション6.3.3「SSL および RSA 証明書とキーの作成」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">Caching_sha2_password_rsa_public_key</code> ステータス変数には、<code class="literal">caching_sha2_password</code> 認証プラグインで使用される RSA 公開キーの値が表示されます。
            </p></li><li class="listitem"><p>
              RSA 公開鍵を所有しているクライアントは、あとで説明するように、接続プロセス中にサーバーと RSA 鍵ペアベースのパスワード交換を実行できます。
            </p></li><li class="listitem"><p>
              <code class="literal">caching_sha2_password</code> および RSA 鍵ペアベースのパスワード交換で認証されるアカウントによる接続の場合、サーバーはデフォルトで RSA 公開鍵をクライアントに送信しません。 クライアントは、必要な公開キーのクライアント側コピーを使用するか、サーバーから公開キーをリクエストできます。 
            </p><p>
              公開キーの信頼できるローカルコピーを使用すると、クライアントはクライアント/サーバープロトコルでラウンドトリップを回避でき、サーバーから公開キーをリクエストするよりも安全です。 一方、サーバーから公開キーをリクエストする方が便利で (クライアント側ファイルの管理は不要)、セキュアなネットワーク環境で受け入れられる場合があります。 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  コマンドラインクライアントの場合は、<code class="option">--server-public-key-path</code> オプションを使用して RSA 公開キーファイルを指定します。 <code class="option">--get-server-public-key</code> オプションを使用して、サーバーから公開キーをリクエストします。 次のプログラムは、2 つのオプションをサポートしています: <span class="command"><strong>mysql</strong></span>, <span class="command"><strong>mysqlsh</strong></span>, <span class="command"><strong>mysqladmin</strong></span>, <span class="command"><strong>mysqlbinlog</strong></span>, <span class="command"><strong>mysqlcheck</strong></span>, <span class="command"><strong>mysqldump</strong></span>, <span class="command"><strong>mysqlimport</strong></span>, <span class="command"><strong>mysqlpump</strong></span>, <span class="command"><strong>mysqlshow</strong></span>, <span class="command"><strong>mysqlslap</strong></span>, <span class="command"><strong>mysqltest</strong></span>, <span class="command"><strong>mysql_upgrade</strong></span>。 
                </p></li><li class="listitem"><p>
                  C API を使用するプログラムの場合は、<code class="literal">mysql_options()</code> をコールして、<code class="literal">MYSQL_SERVER_PUBLIC_KEY</code> オプションとファイル名を渡して RSA 公開キーファイルを指定するか、<code class="literal">MYSQL_OPT_GET_SERVER_PUBLIC_KEY</code> オプションを渡してサーバーから公開キーをリクエストします。
                </p></li><li class="listitem"><p>
                  For replicas, use the <code class="literal">CHANGE REPLICATION SOURCE TO</code> statement (from MySQL 8.0.23) or <code class="literal">CHANGE MASTER TO</code> statement (before MySQL 8.0.23) with the <code class="literal">SOURCE_PUBLIC_KEY_PATH</code> | <code class="literal">MASTER_PUBLIC_KEY_PATH</code> option to specify the RSA public key file, or the <code class="literal">GET_SOURCE_PUBLIC_KEY</code> | <code class="literal">GET_MASTER_PUBLIC_KEY</code> option to request the public key from the source. グループレプリケーションの場合、<code class="literal">group_replication_recovery_public_key_path</code> および <code class="literal">group_replication_recovery_get_public_key</code> システム変数は同じ目的で使用されます。 
                </p></li></ul></div><p>
              いずれの場合も、有効な公開キーファイルを指定するオプションが指定されている場合は、サーバーから公開キーをリクエストするオプションよりも優先されます。
            </p></li></ul></div><p>
          <code class="literal">caching_sha2_password</code> プラグインを使用するクライアントの場合、サーバーへの接続時にパスワードがクリアテキストとして公開されることはありません。 パスワード転送の方法は、セキュアな接続と RSA 暗号化のどちらを使用するかによって異なります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              接続がセキュアな場合、RSA キーペアは不要であり、使用されません。 これは、TLS を使用して暗号化された TCP 接続と、Unix ソケットファイルおよび共有メモリー接続に適用されます。 パスワードはクリアテキストとして送信されますが、接続がセキュアであるためスヌープできません。 
            </p></li><li class="listitem"><p>
              接続がセキュアでない場合は、RSA キーペアが使用されます。 これは、TLS および名前付きパイプ接続なしで暗号化されない TCP 接続に適用されます。 RSA は、パスワードのスヌーピングを防ぐために、クライアントとサーバー間のパスワード交換にのみ使用されます。 サーバーは、暗号化されたパスワードを受信すると復号化します。 繰り返し攻撃を防ぐために、スクランブルが暗号化で使用されます。 
            </p></li></ul></div><p>
          クライアント接続プロセス中にパスワード交換に RSA キーペアを使用できるようにするには、次の手順を使用します:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 SSL および RSA 証明書とキーの作成">セクション6.3.3「SSL および RSA 証明書とキーの作成」</a> の手順を使用して RSA 秘密キーと公開キーのペアのファイルを作成します。
            </p></li><li class="listitem"><p>
              秘密キーファイルと公開キーファイルがデータディレクトリにあり、<code class="filename">private_key.pem</code> および <code class="filename">public_key.pem</code> (<code class="literal">caching_sha2_password_private_key_path</code> および <code class="literal">caching_sha2_password_public_key_path</code> システム変数のデフォルト値) という名前である場合、サーバーはそれらを起動時に自動的に使用します。
            </p><p>
              それ以外の場合、キーファイルに明示的に名前を付けるには、システム変数をサーバーオプションファイルのキーファイル名に設定します。 ファイルがサーバーデータディレクトリにある場合、ファイルのフルパス名を指定する必要はありません: 
            </p><pre class="programlisting">[mysqld]
caching_sha2_password_private_key_path=myprivkey.pem
caching_sha2_password_public_key_path=mypubkey.pem
</pre><p>
              キーファイルがデータディレクトリに配置されていない場合、またはキーファイルの場所をシステム変数値で明示的にする場合は、フルパス名を使用します:
            </p><pre class="programlisting">[mysqld]
caching_sha2_password_private_key_path=/usr/local/mysql/myprivkey.pem
caching_sha2_password_public_key_path=/usr/local/mysql/mypubkey.pem
</pre></li><li class="listitem"><p>
              パスワード生成時に <code class="literal">caching_sha2_password</code> で使用されるハッシュ丸めの数を変更する場合は、<code class="literal">caching_sha2_password_digest_rounds</code> システム変数を設定します。 例: 
            </p><pre class="programlisting">[mysqld]
caching_sha2_password_digest_rounds=10000
</pre></li><li class="listitem"><p>
              サーバーを再起動してから接続し、<code class="literal">Caching_sha2_password_rsa_public_key</code> ステータス変数値を確認します。 実際に表示される値は、次に示す値とは異なりますが、空でない必要があります: 
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Caching_sha2_password_rsa_public_key'\G</code></strong>
*************************** 1. row ***************************
Variable_name: Caching_sha2_password_rsa_public_key
        Value: -----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO9nRUDd+KvSZgY7cNBZMNpwX6
MvE1PbJFXO7u18nJ9lwc99Du/E7lw6CVXw7VKrXPeHbVQUzGyUNkf45Nz/ckaaJa
aLgJOBCIDmNVnyU54OT/1lcs2xiyfaDMe8fCJ64ZwTnKbY2gkt1IMjUAB5Ogd5kJ
g8aV7EtKwyhHb0c30QIDAQAB
-----END PUBLIC KEY-----
</pre><p>
              値が空の場合は、鍵ファイルに関するいくつかの問題がサーバーで見つかっています。 エラーログをチェックして、診断情報を確認してください。 
            </p></li></ol></div><p>
          RSA キーファイルを使用してサーバーを構成した後、<code class="literal">caching_sha2_password</code> プラグインで認証されるアカウントには、これらのキーファイルを使用してサーバーに接続するオプションがあります。 前述のように、このようなアカウントでは、セキュアな接続 (RSA が使用されない場合) または RSA を使用してパスワード交換を実行する暗号化されていない接続のいずれかを使用できます。 暗号化されていない接続が使用されるとします。 例: 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha2user -p</code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          <code class="literal">sha2user</code> によるこの接続試行の場合、サーバーは <code class="literal">caching_sha2_password</code> が適切な認証プラグインであると判断し、それを呼び出します (<code class="literal">CREATE USER</code> 時に指定されたプラグインであるため)。 プラグインは、接続が暗号化されていないことを検出したため、RSA 暗号化を使用してパスワードを送信する必要があります。 ただし、サーバーは公開鍵をクライアントに送信せず、クライアントは公開鍵を提供しなかったため、パスワードを暗号化できず、接続に失敗します: 
        </p><pre class="programlisting">ERROR 2061 (HY000): Authentication plugin 'caching_sha2_password'
reported error: Authentication requires secure connection.
</pre><p>
          RSA 公開キーをサーバーにリクエストするには、<code class="option">--get-server-public-key</code> オプションを指定します:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha2user -p --get-server-public-key</code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          この場合、サーバーは RSA 公開鍵をクライアントに送信し、クライアントはこの鍵を使用してパスワードを暗号化し、その結果をサーバーに返します。 プラグインは、サーバー側で RSA 秘密キーを使用してパスワードを復号化し、パスワードが正しいかどうかに基づいて接続を受け入れるか拒否します。 
        </p><p>
          または、サーバーで必要な RSA 公開キーのローカルコピーを含むファイルがクライアントにある場合は、<code class="option">--server-public-key-path</code> オプションを使用してファイルを指定できます:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha2user -p --server-public-key-path=<em class="replaceable"><code>file_name</code></em></code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          この場合、クライアントは公開キーを使用してパスワードを暗号化し、結果をサーバーに返します。 プラグインは、サーバー側で RSA 秘密キーを使用してパスワードを復号化し、パスワードが正しいかどうかに基づいて接続を受け入れるか拒否します。 
        </p><p>
          <code class="option">--server-public-key-path</code> オプションで指定されたファイル内の公開キー値は、<code class="literal">caching_sha2_password_public_key_path</code> システム変数で指定されたサーバー側ファイル内のキー値と同じである必要があります。 鍵ファイルに有効な公開鍵値が含まれているが、その値が正しくない場合は、アクセス拒否のエラーが発生します。 鍵ファイルに有効な公開鍵が含まれていない場合は、その鍵をクライアントプログラムで使用できません。 
        </p><p>
          クライアントユーザーは、次の 2 つの方法で RSA 公開キーを取得できます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              データベース管理者は、公開鍵ファイルのコピーを提供できます。
            </p></li><li class="listitem"><p>
              他の方法でサーバーに接続できるクライアントユーザーは、<code class="literal">SHOW STATUS LIKE 'Caching_sha2_password_rsa_public_key'</code>ステートメントを使用して、返されたキー値をファイルに保存できます。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="caching-sha2-pluggable-authentication-cache-operation"></a>SHA-2 プラガブル認証のキャッシュ操作</h5></div></div></div><a class="indexterm" name="idm46723760230688"></a><a class="indexterm" name="idm46723760229200"></a><p>
          サーバー側では、<code class="literal">caching_sha2_password</code> プラグインはメモリー内キャッシュを使用して、以前に接続したクライアントの認証を高速化します。 エントリは、account-name/password-hash のペアで構成されます。 キャッシュは次のように機能します: 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              クライアントが接続すると、<code class="literal">caching_sha2_password</code> はクライアントとパスワードが一部のキャッシュエントリと一致するかどうかを確認します。 その場合、認証は成功します。 
            </p></li><li class="listitem"><p>
              一致するキャッシュエントリがない場合、プラグインは <code class="literal">mysql.user</code> システムテーブルの資格証明と照合してクライアントの検証を試みます。 これが成功すると、<code class="literal">caching_sha2_password</code> はクライアントのエントリをハッシュに追加します。 それ以外の場合、認証は失敗し、接続は拒否されます。 
            </p></li></ol></div><p>
          このように、クライアントが最初に接続すると、<code class="literal">mysql.user</code> システムテーブルに対する認証が行われます。 その後、クライアントが接続すると、キャッシュに対する認証が高速になります。 
        </p><p>
          エントリの追加以外のパスワードキャッシュ操作は、<code class="literal">caching_sha2_password</code> の代わりに次のアクションを実行する <code class="literal">sha2_cache_cleaner</code> 監査プラグインによって処理されます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              名前が変更または削除されたアカウント、または資格証明または認証プラグインが変更されたアカウントのキャッシュエントリがクリアされます。
            </p></li><li class="listitem"><p>
              <code class="literal">FLUSH PRIVILEGES</code> ステートメントの実行時にキャッシュを空にします。
            </p></li><li class="listitem"><p>
              サーバーの停止時にキャッシュを空にします。 (これは、サーバーの再起動後もキャッシュが永続しないことを意味します。) 
            </p></li></ul></div><p>
          キャッシュのクリア操作は、後続のクライアント接続の認証要件に影響します。 ユーザーアカウントごとに、次のいずれかの操作後のユーザーの最初のクライアント接続では、セキュアな接続 (TLS 資格証明、Unix ソケットファイルまたは共有メモリーを使用して TCP を使用して確立) または RSA キーペアベースのパスワード交換を使用する必要があります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              アカウントの作成後。
            </p></li><li class="listitem"><p>
              アカウントのパスワード変更後。
            </p></li><li class="listitem"><p>
              アカウントの <code class="literal">RENAME USER</code> の後。
            </p></li><li class="listitem"><p>
              <code class="literal">FLUSH PRIVILEGES</code> の後。
            </p></li></ul></div><p>
          <code class="literal">FLUSH PRIVILEGES</code> はキャッシュ全体をクリアし、<code class="literal">caching_sha2_password</code> プラグインを使用するすべてのアカウントに影響します。 その他の操作では、特定のキャッシュエントリがクリアされ、操作の一部であるアカウントにのみ影響します。 
        </p><p>
          ユーザーが正常に認証されると、アカウントに影響する別のキャッシュクリアイベントが発生するまで、アカウントはキャッシュに入力され、後続の接続にセキュアな接続または RSA キーペアは必要ありません。 (キャッシュを使用できる場合、サーバーはクリアテキストパスワード転送を使用せず、セキュアな接続を必要としないチャレンジレスポンスメカニズムを使用します。) 
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sha256-pluggable-authentication"></a>6.4.1.3 SHA-256 プラガブル認証</h4></div></div></div><a class="indexterm" name="idm46723760199104"></a><a class="indexterm" name="idm46723760197552"></a><p>
        MySQL には、ユーザーアカウントパスワードの SHA-256 ハッシングを実装する次の 2 つの認証プラグインが用意されています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">sha256_password</code>: 基本 SHA-256 認証を実装します。
          </p></li><li class="listitem"><p>
            <code class="literal">caching_sha2_password</code>: SHA-256 認証 (<code class="literal">sha256_password</code> など) を実装しますが、パフォーマンスを向上させるためにサーバー側でキャッシュを使用し、適用性を高めるための追加機能を備えています。
          </p></li></ul></div><p>
        このセクションでは、元の非キャッシュ SHA-2 認証プラグインについて説明します。 キャッシングプラグインの詳細は、<a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.2 SHA-2 プラガブル認証のキャッシュ">セクション6.4.1.2「SHA-2 プラガブル認証のキャッシュ」</a> を参照してください。 
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          MySQL 8.0 では、<code class="literal">caching_sha2_password</code> が <code class="literal">mysql_native_password</code> ではなくデフォルトの認証プラグインです。 サーバー操作に対するこの変更の影響、およびサーバーとクライアントおよびコネクタとの互換性の詳細は、<a class="xref" href="installing.html#upgrade-caching-sha2-password" title="優先認証プラグインとしての caching_sha2_password">優先認証プラグインとしての caching_sha2_password</a> を参照してください。 
        </p><p>
          <code class="literal">caching_sha2_password</code> は MySQL 8.0 のデフォルトの認証プラグインであり、<code class="literal">sha256_password</code> 認証プラグインの機能のスーパーセットを提供するため、<code class="literal">sha256_password</code> は非推奨になりました。将来のバージョンの MySQL で削除される予定です。 <code class="literal">sha256_password</code> を使用して認証する MySQL アカウントは、かわりに <code class="literal">caching_sha2_password</code> を使用するように移行する必要があります。 
        </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          <code class="literal">sha256_password</code> プラグインで認証されるアカウントを使用してサーバーに接続するには、このセクションで後述するように、RSA キーペアを使用したパスワード交換をサポートする TLS 接続または暗号化されていない接続を使用する必要があります。 どちらの方法でも、<code class="literal">sha256_password</code> プラグインは MySQL 暗号化機能を使用します。 <a class="xref" href="security.html#encrypted-connections" title="6.3 暗号化された接続の使用">セクション6.3「暗号化された接続の使用」</a>を参照してください。 
        </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">sha256_password</code> という名前の <span class="quote">「<span class="quote">sha256</span>」</span> は、プラグインが暗号化に使用する 256 ビットのダイジェスト長を表します。 <code class="literal">caching_sha2_password</code> という名前では、<span class="quote">「<span class="quote">sha2</span>」</span> はより一般的に暗号化アルゴリズムの SHA-2 クラスを指し、256 ビット暗号化は 1 つのインスタンスです。 後者の名前を選択すると、プラグイン名を変更せずに、可能性のあるダイジェスト長を将来拡張するための領域が残されます。 
        </p></div><p>
        次の表に、サーバー側とクライアント側のプラグイン名を示します。
      </p><div class="table"><a name="idm46723760172464"></a><p class="title"><b>表 6.14 SHA-256 認証用のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for SHA-256 password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td><code class="literal">sha256_password</code></td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td><code class="literal">sha256_password</code></td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td>なし (プラグインは組み込み済み)</td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        次の各セクションでは、SHA-256 プラガブル認証に固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#sha256-pluggable-authentication-installation" title="SHA-256 プラガブル認証のインストール">SHA-256 プラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#sha256-pluggable-authentication-usage" title="SHA-256 プラガブル認証の使用">SHA-256 プラガブル認証の使用</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="sha256-pluggable-authentication-installation"></a>SHA-256 プラガブル認証のインストール</h5></div></div></div><p>
          <code class="literal">sha256_password</code> プラグインは、サーバーおよびクライアントフォームに存在します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              サーバー側のプラグインはサーバーに組み込まれているため、明示的にロードする必要はなく、アンロードしても無効にすることができません。
            </p></li><li class="listitem"><p>
              クライアント側プラグインは <code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれており、<code class="literal">libmysqlclient</code> に対してリンクされているすべてのプログラムで使用できます。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="sha256-pluggable-authentication-usage"></a>SHA-256 プラガブル認証の使用</h5></div></div></div><p>
          SHA-256 パスワードハッシュ用の <code class="literal">sha256_password</code> プラグインを使用するアカウントを設定するには、次のステートメントを使用します。ここで、<em class="replaceable"><code>password</code></em> は目的のアカウントパスワードです:
        </p><pre class="programlisting">CREATE USER 'sha256user'@'localhost'
IDENTIFIED WITH sha256_password BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          サーバーは <code class="literal">sha256_password</code> プラグインをアカウントに割り当て、それを使用して SHA-256 を使用してパスワードを暗号化し、<code class="literal">mysql.user</code> システムテーブルの <code class="literal">plugin</code> および <code class="literal">authentication_string</code> カラムにそれらの値を格納します。
        </p><p>
          前述の手順では、<code class="literal">sha256_password</code> がデフォルトの認証プラグインであると想定していません。 <code class="literal">sha256_password</code> がデフォルトの認証プラグインである場合は、より単純な <code class="literal">CREATE USER</code> 構文を使用できます。 
        </p><p>
          デフォルトの認証プラグインを <code class="literal">sha256_password</code> に設定してサーバーを起動するには、サーバーオプションファイルに次の行を入力します:
        </p><pre class="programlisting">[mysqld]
default_authentication_plugin=sha256_password
</pre><p>
          これにより、<code class="literal">sha256_password</code> プラグインが新しいアカウントにデフォルトで使用されます。 その結果、プラグインに明示的に名前を付けずに、アカウントを作成してそのパスワードを設定できます: 
        </p><pre class="programlisting">CREATE USER 'sha256user'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          <code class="literal">default_authentication_plugin</code> を <code class="literal">sha256_password</code> に設定した場合の別の結果は、アカウントの作成に他のプラグインを使用するには、そのプラグインを明示的に指定する必要があることです。 たとえば、<code class="literal">mysql_native_password</code> プラグインを使用するには、次のステートメントを使用します: 
        </p><pre class="programlisting">CREATE USER 'nativeuser'@'localhost'
IDENTIFIED WITH mysql_native_password BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          <code class="literal">sha256_password</code> は、セキュアなトランスポートを介した接続をサポートしています。<code class="literal">sha256_password</code> では、MySQL が OpenSSL を使用してコンパイルされ、接続先の MySQL サーバーが RSA をサポートするように構成されている場合 (このセクションの後半で説明する RSA 構成手順を使用)、RSA over unencrypted 接続を使用した暗号化パスワード交換もサポートされます。
        </p><p>
          RSA サポートには、次の特性があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              サーバー側では、RSA 秘密キーペアファイルと公開キーペアファイルに 2 つのシステム変数が指定されます: <code class="literal">sha256_password_private_key_path</code> および <code class="literal">sha256_password_public_key_path</code>。 使用するキーファイルの名前がシステム変数のデフォルト値と異なる場合、データベース管理者はサーバーの起動時にこれらの変数を設定する必要があります。 
            </p></li><li class="listitem"><p>
              サーバーは、<code class="literal">sha256_password_auto_generate_rsa_keys</code> システム変数を使用して RSA キーペアファイルを自動的に生成するかどうかを決定します。 <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 SSL および RSA 証明書とキーの作成">セクション6.3.3「SSL および RSA 証明書とキーの作成」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">Rsa_public_key</code> ステータス変数には、<code class="literal">sha256_password</code> 認証プラグインで使用される RSA 公開キーの値が表示されます。
            </p></li><li class="listitem"><p>
              RSA 公開鍵を所有しているクライアントは、あとで説明するように、接続プロセス中にサーバーと RSA 鍵ペアベースのパスワード交換を実行できます。
            </p></li><li class="listitem"><p>
              <code class="literal">sha256_password</code> および RSA 公開キーペアベースのパスワード交換で認証されるアカウントによる接続の場合、サーバーは必要に応じて RSA 公開キーをクライアントに送信します。 ただし、公開鍵のコピーがクライアントホストで使用可能な場合、クライアントはそれを使用してラウンドトリップをクライアント/サーバープロトコルに保存できます: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  これらのコマンドラインクライアントでは、<code class="option">--server-public-key-path</code> オプションを使用して RSA 公開キーファイルを指定: <span class="command"><strong>mysql</strong></span>, <span class="command"><strong>mysqladmin</strong></span>, <span class="command"><strong>mysqlbinlog</strong></span>, <span class="command"><strong>mysqlcheck</strong></span>, <span class="command"><strong>mysqldump</strong></span>, <span class="command"><strong>mysqlimport</strong></span>, <span class="command"><strong>mysqlpump</strong></span>, <span class="command"><strong>mysqlshow</strong></span>, <span class="command"><strong>mysqlslap</strong></span>, <span class="command"><strong>mysqltest</strong></span>, <span class="command"><strong>mysql_upgrade</strong></span>。
                </p></li><li class="listitem"><p>
                  C API を使用するプログラムの場合は、<code class="literal">mysql_options()</code> をコールし、<code class="literal">MYSQL_SERVER_PUBLIC_KEY</code> オプションとファイル名を渡して RSA 公開キーファイルを指定します。
                </p></li><li class="listitem"><p>
                  レプリカの場合は、<code class="literal">SOURCE_PUBLIC_KEY_PATH</code> | <code class="literal">MASTER_PUBLIC_KEY_PATH</code> オプションを指定して (MySQL 8.0.23 の) <code class="literal">CHANGE REPLICATION SOURCE TO</code> ステートメントまたは (MySQL 8.0.23 の前の) <code class="literal">CHANGE MASTER TO</code> ステートメントを使用し、RSA 公開キーファイルを指定します。 Group Replication の場合、<code class="literal">group_replication_recovery_get_public_key</code> システム変数は同じ目的で機能します。 
                </p></li></ul></div></li></ul></div><p>
          <code class="literal">sha256_password</code> プラグインを使用するクライアントでは、サーバーへの接続時にパスワードがクリアテキストとして公開されません。 パスワード転送の方法は、セキュアな接続と RSA 暗号化のどちらを使用するかによって異なります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              接続がセキュアな場合、RSA キーペアは不要であり、使用されません。 これは TLS を使用して暗号化された接続に適用されます。 パスワードはクリアテキストとして送信されますが、接続がセキュアであるためスヌープできません。 
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                <code class="literal">caching_sha2_password</code> とは異なり、共有メモリートランスポートはデフォルトでセキュアですが、<code class="literal">sha256_password</code> プラグインは共有メモリー接続をセキュアとして扱いません。
              </p></div></li><li class="listitem"><p>
              接続がセキュアでなく、RSA キーペアが使用可能な場合、接続は暗号化されません。 これは TLS を使用して暗号化されていない接続に適用されます。 RSA は、パスワードのスヌーピングを防ぐために、クライアントとサーバー間のパスワード交換にのみ使用されます。 サーバーは、暗号化されたパスワードを受信すると復号化します。 繰り返し攻撃を防ぐために、スクランブルが暗号化で使用されます。 
            </p></li><li class="listitem"><p>
              セキュアな接続が使用されておらず、RSA 暗号化が使用できない場合、クリアテキストとして公開されていないとパスワードを送信できないため、接続の試行は失敗します。
            </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            RSA パスワード暗号化を <code class="literal">sha256_password</code> で使用するには、クライアントとサーバーの両方が、いずれか一方のみでなく、OpenSSL を使用してコンパイルされている必要があります。
          </p></div><p>
          MySQL が OpenSSL を使用してコンパイルされている場合は、次の手順を使用して、クライアント接続プロセス中にパスワード交換に RSA キーペアを使用できるようにします:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 SSL および RSA 証明書とキーの作成">セクション6.3.3「SSL および RSA 証明書とキーの作成」</a> の手順を使用して RSA 秘密キーと公開キーのペアのファイルを作成します。
            </p></li><li class="listitem"><p>
              秘密キーファイルと公開キーファイルがデータディレクトリにあり、<code class="filename">private_key.pem</code> および <code class="filename">public_key.pem</code> (<code class="literal">sha256_password_private_key_path</code> および <code class="literal">sha256_password_public_key_path</code> システム変数のデフォルト値) という名前である場合、サーバーはそれらを起動時に自動的に使用します。
            </p><p>
              それ以外の場合、キーファイルに明示的に名前を付けるには、システム変数をサーバーオプションファイルのキーファイル名に設定します。 ファイルがサーバーデータディレクトリにある場合、ファイルのフルパス名を指定する必要はありません: 
            </p><pre class="programlisting">[mysqld]
sha256_password_private_key_path=myprivkey.pem
sha256_password_public_key_path=mypubkey.pem
</pre><p>
              キーファイルがデータディレクトリに配置されていない場合、またはキーファイルの場所をシステム変数値で明示的にする場合は、フルパス名を使用します:
            </p><pre class="programlisting">[mysqld]
sha256_password_private_key_path=/usr/local/mysql/myprivkey.pem
sha256_password_public_key_path=/usr/local/mysql/mypubkey.pem
</pre></li><li class="listitem"><p>
              サーバーを再起動してから、それに接続し、<code class="literal">Rsa_public_key</code> ステータス変数の値をチェックします。 実際に表示される値は、次に示す値とは異なりますが、空でない必要があります: 
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Rsa_public_key'\G</code></strong>
*************************** 1. row ***************************
Variable_name: Rsa_public_key
        Value: -----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO9nRUDd+KvSZgY7cNBZMNpwX6
MvE1PbJFXO7u18nJ9lwc99Du/E7lw6CVXw7VKrXPeHbVQUzGyUNkf45Nz/ckaaJa
aLgJOBCIDmNVnyU54OT/1lcs2xiyfaDMe8fCJ64ZwTnKbY2gkt1IMjUAB5Ogd5kJ
g8aV7EtKwyhHb0c30QIDAQAB
-----END PUBLIC KEY-----
</pre><p>
              値が空の場合は、鍵ファイルに関するいくつかの問題がサーバーで見つかっています。 エラーログをチェックして、診断情報を確認してください。 
            </p></li></ol></div><p>
          RSA キーファイルを使用してサーバーを構成した後、<code class="literal">sha256_password</code> プラグインで認証されるアカウントには、これらのキーファイルを使用してサーバーに接続するオプションがあります。 前述のように、このようなアカウントでは、セキュアな接続 (RSA が使用されない場合) または RSA を使用してパスワード交換を実行する暗号化されていない接続のいずれかを使用できます。 暗号化されていない接続が使用されるとします。 例: 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha256user -p</code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          <code class="literal">sha256user</code> によるこの接続試行の場合、サーバーは <code class="literal">sha256_password</code> が適切な認証プラグインであると判断し、それを呼び出します (<code class="literal">CREATE USER</code> 時に指定されたプラグインであるため)。 プラグインは、接続が暗号化されていないことを検出したため、RSA 暗号化を使用してパスワードを送信する必要があります。 この場合、プラグインは RSA 公開鍵をクライアントに送信し、クライアントはこの鍵を使用してパスワードを暗号化し、その結果をサーバーに返します。 プラグインは、サーバー側で RSA 秘密キーを使用してパスワードを復号化し、パスワードが正しいかどうかに基づいて接続を受け入れるか拒否します。 
        </p><p>
          サーバーは、必要に応じて RSA 公開鍵をクライアントに送信します。 ただし、サーバーで必要な RSA 公開キーのローカルコピーを含むファイルがクライアントにある場合は、<code class="option">--server-public-key-path</code> オプションを使用してファイルを指定できます: 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha256user -p --server-public-key-path=<em class="replaceable"><code>file_name</code></em></code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          <code class="option">--server-public-key-path</code> オプションで指定されたファイル内の公開鍵値は、<code class="literal">sha256_password_public_key_path</code> システム変数で指定されたサーバー側のファイル内の鍵値と同じにするようにしてください。 鍵ファイルに有効な公開鍵値が含まれているが、その値が正しくない場合は、アクセス拒否のエラーが発生します。 鍵ファイルに有効な公開鍵が含まれていない場合は、その鍵をクライアントプログラムで使用できません。 この場合、<code class="literal">sha256_password</code> プラグインは、<code class="option">--server-public-key-path</code> オプションが指定されていないかのように公開鍵をクライアントに送信します。 
        </p><p>
          クライアントユーザーは、次の 2 つの方法で RSA 公開キーを取得できます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              データベース管理者は、公開鍵ファイルのコピーを提供できます。
            </p></li><li class="listitem"><p>
              その他の方法でサーバーに接続できるクライアントユーザーは、<code class="literal">SHOW STATUS LIKE 'Rsa_public_key'</code> ステートメントを使用し、返された鍵値をファイル内に保存できます。
            </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="cleartext-pluggable-authentication"></a>6.4.1.4 クライアント側クリアテキストプラガブル認証</h4></div></div></div><a class="indexterm" name="idm46723760041136"></a><a class="indexterm" name="idm46723760039584"></a><p>
        クライアント側の認証プラグインを使用すると、クライアントはハッシュや暗号化を行わずにクリアテキストでサーバーにパスワードを送信できます。 このプラグインは、MySQL クライアントライブラリに組み込まれています。 
      </p><p>
        次の表に、プラグイン名を示します。
      </p><div class="table"><a name="idm46723760036144"></a><p class="title"><b>表 6.15 クリアテキスト認証用のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for cleartext password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td>なし (説明を参照してください)</td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td><code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td>なし (プラグインは組み込み済みです)</td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        クライアント側の認証プラグインの多くは、パスワードをサーバーに送信する前にハッシュ化または暗号化を実行します。 これにより、クライアントはクリアテキストとしてパスワードを送信しないようにできます。 
      </p><p>
        クライアント側で入力されたパスワードをサーバーが受信する必要がある認証スキームでは、ハッシングまたは暗号化を実行できません。 このような場合、クライアント側の <code class="literal">mysql_clear_password</code> プラグインが使用され、クライアントはクリアテキストとしてパスワードをサーバーに送信できます。 対応するサーバー側のプラグインはありません。 かわりに、クリアテキストパスワードを必要とするサーバー側プラグインと組み合せて、<code class="literal">mysql_clear_password</code> をクライアント側で使用できます。 (PAM および単純な LDAP 認証プラグインなどがあります。<a class="xref" href="security.html#pam-pluggable-authentication" title="6.4.1.5 PAM プラガブル認証">セクション6.4.1.5「PAM プラガブル認証」</a> および <a class="xref" href="security.html#ldap-pluggable-authentication" title="6.4.1.7 LDAP プラガブル認証">セクション6.4.1.7「LDAP プラガブル認証」</a> を参照してください。) 
      </p><p>
        次の説明では、クリアテキストプラガブル認証に固有の使用方法について説明します。 MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          クリアテキストでパスワードを送信すると、一部の構成でセキュリティ上の問題が発生する可能性があります。 パスワードが傍受される可能性がある場合に問題を回避するには、クライアントはパスワードが保護される方式を使用して、MySQL サーバーに接続するようにしてください。 SSL (<a class="xref" href="security.html#encrypted-connections" title="6.3 暗号化された接続の使用">セクション6.3「暗号化された接続の使用」</a>を参照)、IPsec、またはプライベートネットワークでも発生する可能性があります。 
        </p></div><p>
        <code class="literal">mysql_clear_password</code> プラグインを誤って使用する可能性を低くするには、MySQL クライアントで明示的に有効にする必要があります。 これはいくつかの方法で実行できます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">LIBMYSQL_ENABLE_CLEARTEXT_PLUGIN</code> 環境変数を <code class="literal">1</code>、<code class="literal">Y</code>、または <code class="literal">y</code> で始まる値に設定します。 これにより、すべてのクライアント接続でプラグインが有効になります。 
          </p></li><li class="listitem"><p>
            <span class="command"><strong>mysql</strong></span>, <span class="command"><strong>mysqladmin</strong></span>, <span class="command"><strong>mysqlcheck</strong></span>, <span class="command"><strong>mysqldump</strong></span>, <span class="command"><strong>mysqlshow</strong></span> および <span class="command"><strong>mysqlslap</strong></span> クライアントプログラムは、プラグインを呼び出しごとに有効にする <code class="option">--enable-cleartext-plugin</code> オプションをサポートしています。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql_options()</code> C API 関数では、接続するたびにプラグインを有効にする <code class="literal">MYSQL_ENABLE_CLEARTEXT_PLUGIN</code> オプションがサポートされています。 また、クライアントライブラリによって読み取られるオプショングループ内に <code class="literal">enable-cleartext-plugin</code> を含めると、<code class="literal">libmysqlclient</code> を使用し、オプションファイルを読み取る任意のプログラムでプラグインを有効にすることができます。 
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="pam-pluggable-authentication"></a>6.4.1.5 PAM プラガブル認証</h4></div></div></div><a class="indexterm" name="idm46723759996432"></a><a class="indexterm" name="idm46723759994880"></a><a class="indexterm" name="idm46723759992992"></a><a class="indexterm" name="idm46723759991008"></a><a class="indexterm" name="idm46723759988912"></a><a class="indexterm" name="idm46723759987904"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          PAM プラガブル認証は、商用製品である MySQL Enterprise Edition に含まれる拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
        </p></div><p>
        MySQL Enterprise Edition は、MySQL Server が PAM (Pluggable Authentication Module) を使用して MySQL ユーザーを認証できるようにする認証方式をサポートしています。 PAM を使用すると、システムは標準インタフェースを使用して、従来の Unix パスワードや LDAP ディレクトリなどのさまざまな種類の認証方式にアクセスできます。 
      </p><p>
        PAM プラガブル認証は、次の機能を提供します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            外部認証: PAM 認証を使用すると、MySQL Server は、MySQL 付与テーブルの外部で定義され、PAM でサポートされている方法を使用して認証するユーザーからの接続を受け入れることができます。
          </p></li><li class="listitem"><p>
            プロキシユーザーのサポート: PAM 認証は、外部ユーザーがメンバーになっている PAM グループと指定された認証文字列に基づいて、クライアントプログラムによって渡された外部ユーザー名とは異なるユーザー名を MySQL に返すことができます。 つまり、このプラグインは、外部 PAM で認証されたユーザーが持つべき権限を定義する MySQL ユーザーを返すことができます。 たとえば、<code class="literal">joe</code> というオペレーティングシステムユーザーは、<code class="literal">developer</code> という MySQL ユーザーに接続して権限を持つことができます。 
          </p></li></ul></div><p>
        PAM プラガブル認証は、Linux および macOS でテストされています。
      </p><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。 ファイル名のサフィクスは、システムによって異なる場合があります。 ファイルは、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリに配置する必要があります。 インストールに関する情報については、<a class="xref" href="security.html#pam-pluggable-authentication-installation" title="PAM プラガブル認証のインストール">PAM プラガブル認証のインストール</a>を参照してください。 
      </p><div class="table"><a name="idm46723759973968"></a><p class="title"><b>表 6.16 PAM 認証用のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for PAM password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td><code class="literal">authentication_pam</code></td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td><code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td><code class="filename">authentication_pam.so</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        サーバー側 PAM プラグインと通信するクライアント側 <code class="literal">mysql_clear_password</code> クリアテキストプラグインは、<code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれており、コミュニティー配布を含むすべての配布に含まれます。 すべての MySQL ディストリビューションにクライアント側のクリアテキストプラグインを含めると、任意のディストリビューションのクライアントが、サーバー側 PAM プラグインがロードされているサーバーに接続できるようになります。 
      </p><p>
        次の各セクションでは、PAM プラガブル認証に固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-how-it-works" title="MySQL ユーザーの PAM 認証の仕組み">MySQL ユーザーの PAM 認証の仕組み</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-installation" title="PAM プラガブル認証のインストール">PAM プラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-uninstallation" title="PAM プラガブル認証のアンインストール">PAM プラガブル認証のアンインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-usage" title="PAM プラガブル認証の使用">PAM プラガブル認証の使用</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-authentication-unix-without-proxy" title="プロキシユーザーを使用しない PAM Unix パスワード認証">プロキシユーザーを使用しない PAM Unix パスワード認証</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-authentication-ldap-without-proxy" title="プロキシユーザーを使用しない PAM LDAP 認証">プロキシユーザーを使用しない PAM LDAP 認証</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-authentication-unix-with-proxy" title="プロキシユーザーとグループマッピングを使用した PAM Unix パスワード認証">プロキシユーザーとグループマッピングを使用した PAM Unix パスワード認証</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-authentication-unix-password-store" title="Unix パスワードストアへの PAM 認証アクセス">Unix パスワードストアへの PAM 認証アクセス</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-debugging" title="PAM 認証のデバッグ">PAM 認証のデバッグ</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。 <code class="literal">mysql_clear_password</code> プラグインの詳細は、<a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 クライアント側クリアテキストプラガブル認証">セクション6.4.1.4「クライアント側クリアテキストプラガブル認証」</a> を参照してください。 プロキシユーザーについては、<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください。 
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-pluggable-authentication-how-it-works"></a>MySQL ユーザーの PAM 認証の仕組み</h5></div></div></div><p>
          このセクションでは、MySQL と PAM が連携して MySQL ユーザーを認証する方法の概要について説明します。 特定の PAM サービスを使用するように MySQL アカウントを設定する方法を示す例については、<a class="xref" href="security.html#pam-pluggable-authentication-usage" title="PAM プラガブル認証の使用">PAM プラガブル認証の使用</a> を参照してください。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              クライアントプログラムとサーバーは通信し、クライアントはサーバーにクライアントユーザー名 (デフォルトではオペレーティングシステムのユーザー名) とパスワードを送信します:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  クライアントユーザー名は外部ユーザー名です。
                </p></li><li class="listitem"><p>
                  PAM サーバー側認証プラグインを使用するアカウントの場合、対応するクライアント側プラグインは <code class="literal">mysql_clear_password</code> です。 このクライアント側プラグインはパスワードハッシュを実行せず、その結果、クライアントはパスワードをクリアテキストとしてサーバーに送信します。 
                </p></li></ul></div></li><li class="listitem"><p>
              サーバーは、外部ユーザー名とクライアントの接続元のホストに基づいて、一致する MySQL アカウントを検索します。 PAM プラグインは、MySQL Server によって渡された情報 (ユーザー名、ホスト名、パスワード、認証文字列など) を使用します。 PAM を使用して認証する MySQL アカウントを定義する場合、認証文字列には次のものが含まれます: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  PAM サービス名。システム管理者が特定のアプリケーションの認証方式を参照するために使用できる名前です。 単一のデータベースサーバーインスタンスに複数のアプリケーションを関連付けることができるため、サービス名の選択は SQL アプリケーション開発者に任されます。 
                </p></li><li class="listitem"><p>
                  オプションで、プロキシを使用する場合は、PAM グループから MySQL ユーザー名へのマッピング。
                </p></li></ul></div></li><li class="listitem"><p>
              プラグインは、認証文字列で指定された PAM サービスを使用してユーザー資格証明を確認し、<code class="literal">'Authentication succeeded, Username is <em class="replaceable"><code>user_name</code></em>'</code>または<code class="literal">'Authentication failed'</code>を返します。 パスワードは、PAM サービスで使用されるパスワードストアに適している必要があります。 例: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  従来の Unix パスワードの場合、サービスは<code class="filename">/etc/shadow</code> ファイルに格納されているパスワードを検索します。
                </p></li><li class="listitem"><p>
                  LDAP の場合、サービスは LDAP ディレクトリに格納されているパスワードを検索します。
                </p></li></ul></div><p>
              資格証明チェックが失敗すると、サーバーは接続を拒否します。
            </p></li><li class="listitem"><p>
              それ以外の場合、認証文字列はプロキシが発生するかどうかを示します。 文字列に PAM グループマッピングが含まれていない場合、プロキシは発生しません。 この場合、MySQL ユーザー名は外部ユーザー名と同じです。 
            </p></li><li class="listitem"><p>
              それ以外の場合、プロキシは PAM グループマッピングに基づいて示され、MySQL ユーザー名はマッピングリスト内の最初に一致するグループに基づいて決定されます。 <span class="quote">「<span class="quote">「PAM グループ」</span>」</span>の意味は PAM サービスによって異なります。 例: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  従来の Unix パスワードの場合、グループは<code class="filename">/etc/group</code> ファイルで定義された Unix グループで、<code class="filename">/etc/security/group.conf</code> などのファイル内の追加 PAM 情報を補足する可能性があります。
                </p></li><li class="listitem"><p>
                  LDAP の場合、グループは LDAP ディレクトリで定義された LDAP グループです。
                </p></li></ul></div><p>
              プロキシユーザー (外部ユーザー) がプロキシ設定された MySQL ユーザー名に対する <code class="literal">PROXY</code> 権限を持っている場合、プロキシ設定は、プロキシ設定されたユーザーがプロキシ設定されたユーザーの権限を引き受けた状態で行われます。
            </p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-pluggable-authentication-installation"></a>PAM プラガブル認証のインストール</h5></div></div></div><p>
          このセクションでは、PAM 認証プラグインをインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
        </p><p>
          サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
        </p><p>
          プラグインライブラリファイルのベース名は <code class="literal">authentication_pam</code> です。 ファイル名の接尾辞は、プラットフォームごとに異なります (たとえば、<code class="filename">.so</code> for Unix and Unix-like systems, <code class="filename">.dll</code> for Windows)。 
        </p><p>
          サーバーの起動時にプラグインをロードするには、<code class="option">--plugin-load-add</code> オプションを使用して、プラグインを含むライブラリファイルに名前を付けます。 このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルに次の行を入力し、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します: 
        </p><pre class="programlisting">[mysqld]
plugin-load-add=authentication_pam.so
</pre><p>
          <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
        </p><p>
          または、実行時にプラグインをロードするには、次のステートメントを使用して、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します:
        </p><pre class="programlisting">INSTALL PLUGIN authentication_pam SONAME 'authentication_pam.so';
</pre><p>
          <code class="literal">INSTALL PLUGIN</code> はプラグインをただちにロードし、<code class="literal">mysql.plugins</code> システムテーブルにも登録して、<code class="option">--plugin-load-add</code> を必要とせずに後続の通常の起動のたびにサーバーがプラグインをロードするようにします。
        </p><p>
          プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%pam%';</code></strong>
+--------------------+---------------+
| PLUGIN_NAME        | PLUGIN_STATUS |
+--------------------+---------------+
| authentication_pam | ACTIVE        |
+--------------------+---------------+
</pre><p>
          プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
        </p><p>
          MySQL アカウントを PAM プラグインに関連付けるには、<a class="xref" href="security.html#pam-pluggable-authentication-usage" title="PAM プラガブル認証の使用">PAM プラガブル認証の使用</a> を参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-pluggable-authentication-uninstallation"></a>PAM プラガブル認証のアンインストール</h5></div></div></div><p>
          PAM 認証プラグインのアンインストールに使用される方法は、インストール方法によって異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="option">--plugin-load-add</code> オプションを使用してサーバーの起動時にプラグインをインストールした場合は、オプションなしでサーバーを再起動します。
            </p></li><li class="listitem"><p>
              <code class="literal">INSTALL PLUGIN</code> ステートメントを使用して実行時にプラグインをインストールした場合、サーバーの再起動後もインストールされたままになります。 アンインストールするには、<code class="literal">UNINSTALL PLUGIN</code> を使用します: 
            </p><pre class="programlisting">UNINSTALL PLUGIN authentication_pam;
</pre></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-pluggable-authentication-usage"></a>PAM プラガブル認証の使用</h5></div></div></div><p>
          このセクションでは、PAM 認証プラグインを使用して MySQL クライアントプログラムからサーバーに接続する一般的な用語について説明します。 次のセクションでは、PAM 認証を特定の方法で使用する手順について説明します。 <a class="xref" href="security.html#pam-pluggable-authentication-installation" title="PAM プラガブル認証のインストール">PAM プラガブル認証のインストール</a> で説明されているように、サーバーがサーバー側 PAM プラグインを有効にして実行されていることを前提としています。 
        </p><p>
          <code class="literal">CREATE USER</code> ステートメントの <code class="literal">IDENTIFIED WITH</code> 句で PAM 認証プラグインを参照するには、<code class="literal">authentication_pam</code> という名前を使用します。 例: 
        </p><pre class="programlisting">CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_pam
  AS '<em class="replaceable"><code>auth_string</code></em>';
</pre><p>
          認証文字列には、次のタイプの情報が指定されます。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              PAM サービス名 (<a class="xref" href="security.html#pam-pluggable-authentication-how-it-works" title="MySQL ユーザーの PAM 認証の仕組み">MySQL ユーザーの PAM 認証の仕組み</a> を参照)。 次の説明の例では、従来の Unix パスワードを使用した認証に <code class="literal">mysql-unix</code> のサービス名を使用し、LDAP を使用した認証に <code class="literal">mysql-ldap</code> を使用します。 
            </p></li><li class="listitem"><p>
              プロキシサポートのために、PAM は、クライアントプログラムがサーバーに接続するときに渡される外部ユーザー名以外の MySQL ユーザー名を PAM モジュールがサーバーに返す方法を提供します。 認証文字列を使用して、外部ユーザー名から MySQL ユーザー名へのマッピングを制御します。 プロキシユーザーの機能を活用するには、この種類のマッピングを認証文字列に含める必要があります。 
            </p></li></ul></div><p>
          たとえば、アカウントが <code class="literal">mysql-unix</code> PAM サービス名を使用し、<code class="literal">root</code> および <code class="literal">users</code> PAM グループのオペレーティングシステムユーザーを <code class="literal">developer</code> および <code class="literal">data_entry</code> MySQL ユーザーにそれぞれマップする必要がある場合は、次のようなステートメントを使用します:
        </p><pre class="programlisting">CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_pam
  AS 'mysql-unix, root=developer, users=data_entry';
</pre><p>
          PAM 認証プラグインでの認証文字列の構文は、次のようなルールに従っています。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              文字列は PAM サービス名で構成され、オプションで PAM グループマッピングリストが続きます。PAM グループマッピングリストは、PAM グループ名と MySQL ユーザー名を指定する 1 つ以上のキーワードと値のペアで構成されます:
            </p><pre class="programlisting"><em class="replaceable"><code>pam_service_name</code></em>[,<em class="replaceable"><code>pam_group_name</code></em>=<em class="replaceable"><code>mysql_user_name</code></em>]...
</pre><p>
              プラグインは、アカウントを使用する各接続試行の認証文字列を解析します。 オーバーヘッドを最小限に抑えるには、できるだけ文字列を短く保ちます。 
            </p></li><li class="listitem"><p>
              各 <code class="literal"><em class="replaceable"><code>pam_group_name</code></em>=<em class="replaceable"><code>mysql_user_name</code></em></code> ペアの前にカンマを付ける必要があります。
            </p></li><li class="listitem"><p>
              二重引用符で囲まれていない先頭および末尾の空白文字は、無視されます。
            </p></li><li class="listitem"><p>
              引用符で囲まれていない <em class="replaceable"><code>pam_service_name</code></em>、<em class="replaceable"><code>pam_group_name</code></em> および <em class="replaceable"><code>mysql_user_name</code></em> の値には、等号、カンマまたは空白以外の任意の値を含めることができます。
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>pam_service_name</code></em>、<em class="replaceable"><code>pam_group_name</code></em> または <em class="replaceable"><code>mysql_user_name</code></em> の値が二重引用符で囲まれている場合、引用符の間のすべてが値の一部になります。 たとえば、値に空白文字が含まれている場合は、これが必要です。 二重引用符およびバックスラッシュ (<code class="literal">\</code>) を除くすべての文字は有効です。 どちらかの文字を含めるには、バックスラッシュを使用してエスケープします。 
            </p></li></ul></div><p>
          プラグインが外部ユーザー名 (クライアントから渡された名前) を正常に認証すると、認証文字列内で PAM グループマッピングリストが検索され、存在する場合は、それを使用して、外部ユーザーがメンバーになっている PAM グループに基づいて別の MySQL ユーザー名が MySQL サーバーに返されます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              認証文字列に PAM グループマッピングリストが含まれていない場合、プラグインは外部名を返します。
            </p></li><li class="listitem"><p>
              認証文字列に PAM グループマッピングリストが含まれている場合、プラグインはリスト内の各 <code class="literal"><em class="replaceable"><code>pam_group_name</code></em>=<em class="replaceable"><code>mysql_user_name</code></em></code> ペアを左から右に検査し、認証されたユーザーに割り当てられたグループの non-MySQL ディレクトリ内で <em class="replaceable"><code>pam_group_name</code></em> 値の一致を見つけようとし、見つかった最初の一致について <em class="replaceable"><code>mysql_user_name</code></em> を返します。 どの PAM グループにも一致するものが見つからない場合、プラグインは外部名を返します。 プラグインは、ディレクトリ内のグループを検索できない場合、PAM グループマッピングリストを無視して外部名を返します。 
            </p></li></ul></div><p>
          次のセクションでは、PAM 認証プラグインを使用するいくつかの認証シナリオを設定する方法について説明します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              プロキシユーザーなし。 ここでは、ログイン名とパスワードをチェックする際にのみ PAM が使用されます。 MySQL Server への接続を許可されたすべての外部ユーザーには、PAM 認証を使用するように定義された一致する MySQL アカウントが必要です。 (<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>の MySQL アカウントが外部ユーザーと一致するには、<em class="replaceable"><code>user_name</code></em> が外部ユーザー名であり、<em class="replaceable"><code>host_name</code></em> がクライアントの接続元のホストと一致する必要があります。) PAM でサポートされているさまざまな方式で、認証を実行できます。 後で、従来の Unix パスワードおよび LDAP のパスワードを使用してクライアント資格証明を認証する方法について説明します。 
            </p><p>
              PAM 認証は、プロキシユーザーまたは PAM グループを介して行われない場合、MySQL ユーザー名がオペレーティングシステムユーザー名と同じである必要があります。 MySQL ユーザー名は 32 文字に制限され (<a class="xref" href="security.html#grant-tables" title="6.2.3 付与テーブル">セクション6.2.3「付与テーブル」</a> を参照)、PAM 非プロキシ認証は最大 32 文字の名前を持つ Unix アカウントに制限されます。 
            </p></li><li class="listitem"><p>
              プロキシユーザーのみ (PAM グループマッピングを使用)。 このシナリオでは、異なる権限セットを定義する 1 つ以上の MySQL アカウントを作成します。 (理想的には、これらのアカウントを使用して誰も接続しないでください。) 次に、PAM を介して認証するデフォルトユーザーを定義します。PAM は、なんらかのマッピングスキーム (通常、ユーザーがメンバーになっている外部 PAM グループに基づく) を使用して、すべての外部ユーザー名を、権限セットを保持する少数の MySQL アカウントにマップします。 クライアントユーザー名として外部ユーザー名を接続および指定するクライアントは、いずれかの MySQL アカウントにマップされ、その権限を使用します。 ここでは、従来の Unix パスワードを使用してこれを設定する方法を示しますが、LDAP などのほかの PAM 方法を代わりに使用することもできます。 
            </p></li></ul></div><p>
          これらのシナリオには、次のバリエーションがあります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              一部のユーザーは (プロキシを使用せずに) 直接ログインできますが、他のユーザーはプロキシアカウントを介して接続する必要があります。
            </p></li><li class="listitem"><p>
              PAM 認証アカウント間で異なる PAM サービス名を使用することで、ある PAM 認証方法を一部のユーザーに使用し、別の方法を他のユーザーに使用できます。 たとえば、一部のユーザーには <code class="literal">mysql-unix</code> PAM サービスを使用し、その他のユーザーには <code class="literal">mysql-ldap</code> を使用できます。 
            </p></li></ul></div><p>
          この例は、次のことが前提となっています。 システムが異なる方法で設定されている場合は、多少の調整が必要になることもあります。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              ログイン名とパスワードは、それぞれ <code class="literal">antonio</code> と <em class="replaceable"><code>antonio_password</code></em> です。 これらを、認証するユーザーに対応するように変更します。 
            </p></li><li class="listitem"><p>
              PAM 構成ディレクトリは <code class="filename">/etc/pam.d</code> です。
            </p></li><li class="listitem"><p>
              PAM サービス名は、認証方式 (この説明では <code class="literal">mysql-unix</code> または <code class="literal">mysql-ldap</code>) に対応します。 特定の PAM サービスを使用するには、PAM 構成ディレクトリに同じ名前の PAM ファイルを設定する必要があります (ファイルが存在しない場合は作成します)。 また、PAM サービスを使用して認証するアカウントの場合は、<code class="literal">CREATE USER</code> ステートメントの認証文字列に PAM サービスを指定する必要があります。 
            </p></li></ul></div><p>
          PAM 認証プラグインは、サーバーの起動環境で <code class="literal">AUTHENTICATION_PAM_LOG</code> 環境値が設定されているかどうかを初期化時にチェックします。 その場合、プラグインを使用すると、標準出力への診断メッセージのロギングが有効になります。 サーバーの起動方法によっては、コンソールまたはエラーログにメッセージが表示される場合があります。 これらのメッセージは、プラグインが認証を実行するときに発生する PAM 関連の問題のデバッグに役立ちます。 詳細は、<a class="xref" href="security.html#pam-pluggable-authentication-debugging" title="PAM 認証のデバッグ">PAM 認証のデバッグ</a>を参照してください。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-authentication-unix-without-proxy"></a>プロキシユーザーを使用しない PAM Unix パスワード認証</h5></div></div></div><p>
          この認証シナリオでは、PAM を使用して、プロキシを使用せずに、オペレーティングシステムユーザー名および Unix パスワードに関して定義された外部ユーザーをチェックします。 MySQL Server への接続を許可されたすべての外部ユーザーには、従来の Unix パスワードストアを介した PAM 認証を使用するように定義された、一致する MySQL アカウントが必要です。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            従来の Unix パスワードは、<code class="filename">/etc/shadow</code> ファイルを使用してチェックされます。 このファイルに関連して発生する可能性のある問題の詳細は、<a class="xref" href="security.html#pam-authentication-unix-password-store" title="Unix パスワードストアへの PAM 認証アクセス">Unix パスワードストアへの PAM 認証アクセス</a> を参照してください。 
          </p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Unix 認証で、ユーザー名が <code class="literal">antonio</code> でパスワードが <em class="replaceable"><code>antonio_password</code></em> のオペレーティングシステムへのログインが許可されていることを確認します。
            </p></li><li class="listitem"><p>
              <code class="filename">/etc/pam.d/mysql-unix</code> という名前の <code class="literal">mysql-unix</code> PAM サービスファイルを作成して、従来の Unix パスワードを使用して MySQL 接続を認証するように PAM を設定します。 ファイルの内容はシステムに依存するため、<code class="filename">/etc/pam.d</code> ディレクトリ内の既存のログイン関連ファイルをチェックして、それらがどのように表示されるかを確認します。 Linux では、<code class="filename">mysql-unix</code> ファイルは次のようになります: 
            </p><pre class="programlisting">#%PAM-1.0
auth            include         password-auth
account         include         password-auth
</pre><p>
              macOS の場合は、<code class="literal">password-auth</code> ではなく <code class="literal">login</code> を使用します。
            </p><p>
              PAM ファイル形式は、一部のシステムで異なる場合があります。 たとえば、Ubuntu およびその他の Debian ベースのシステムでは、かわりに次のファイルコンテンツを使用します: 
            </p><pre class="programlisting">@include common-auth
@include common-account
@include common-session-noninteractive
</pre></li><li class="listitem"><p>
              オペレーティングシステムユーザー名と同じユーザー名で MySQL アカウントを作成し、PAM プラグインおよび <code class="literal">mysql-unix</code> PAM サービスを使用して認証するように定義します:
            </p><pre class="programlisting">CREATE USER 'antonio'@'localhost'
  IDENTIFIED WITH authentication_pam
  AS 'mysql-unix';
GRANT ALL PRIVILEGES
  ON mydb.*
  TO 'antonio'@'localhost';
</pre><p>
              ここで、認証文字列には PAM サービス名 (<code class="literal">mysql-unix</code>) のみが含まれており、これによって Unix パスワードが認証されます。
            </p></li><li class="listitem"><p>
              <span class="command"><strong>mysql</strong></span> コマンドラインクライアントを使用して、<code class="literal">antonio</code> として MySQL サーバーに接続します。 例: 
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=antonio --password --enable-cleartext-plugin</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>antonio_password</code></em></code></strong>
</pre><p>
              サーバーは接続を許可する必要があり、次のクエリーは次のような出力を返します:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+-------------------+--------------+
| USER()            | CURRENT_USER()    | @@proxy_user |
+-------------------+-------------------+--------------+
| antonio@localhost | antonio@localhost | NULL         |
+-------------------+-------------------+--------------+
</pre><p>
              これは、<code class="literal">antonio</code> MySQL ユーザーに付与された権限を持つように <code class="literal">antonio</code> オペレーティングシステムユーザーが認証され、プロキシが発生していないことを示しています。
            </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            クライアント側の <code class="literal">mysql_clear_password</code> 認証プラグインでは、パスワードはそのまま残されるため、クライアントプログラムはクリアテキストとして MySQL サーバーに送信します。 これにより、パスワードをそのまま PAM に渡すことができます。 サーバー側 PAM ライブラリを使用するにはクリアテキストのパスワードが必要ですが、一部の構成でセキュリティーの問題が発生する可能性があります。 これらのメジャーにより、リスクが最小限に抑えられます: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">mysql_clear_password</code> プラグインを誤って使用する可能性を低くするには、MySQL クライアントで明示的に有効にする必要があります (たとえば、<code class="option">--enable-cleartext-plugin</code> オプションを使用)。 <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 クライアント側クリアテキストプラガブル認証">セクション6.4.1.4「クライアント側クリアテキストプラガブル認証」</a>を参照してください。 
              </p></li><li class="listitem"><p>
                <code class="literal">mysql_clear_password</code> プラグインを有効にしてパスワードの公開を回避するには、MySQL クライアントは暗号化された接続を使用して MySQL サーバーに接続する必要があります。 <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a>を参照してください。 
              </p></li></ul></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-authentication-ldap-without-proxy"></a>プロキシユーザーを使用しない PAM LDAP 認証</h5></div></div></div><p>
          この認証シナリオでは、PAM を使用して、プロキシを使用せずに、オペレーティングシステムのユーザー名および LDAP パスワードに関して定義された外部ユーザーをチェックします。 MySQL Server への接続を許可されたすべての外部ユーザーには、LDAP を介した PAM 認証を使用するように定義された一致する MySQL アカウントが必要です。 
        </p><p>
          MySQL で PAM LDAP プラガブル認証を使用するには、次の前提条件を満たす必要があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              PAM LDAP サービスが通信するには、LDAP サーバーが使用可能である必要があります。
            </p></li><li class="listitem"><p>
              MySQL によって認証される LDAP ユーザーは、LDAP サーバーによって管理されるディレクトリに存在する必要があります。
            </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            MySQL ユーザー認証に LDAP を使用する別の方法は、LDAP 固有の認証プラグインを使用することです。 <a class="xref" href="security.html#ldap-pluggable-authentication" title="6.4.1.7 LDAP プラガブル認証">セクション6.4.1.7「LDAP プラガブル認証」</a>を参照してください。 
          </p></div><p>
          PAM LDAP 認証用の MySQL を次のように構成します:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Unix 認証で、ユーザー名が <code class="literal">antonio</code> でパスワードが <em class="replaceable"><code>antonio_password</code></em> のオペレーティングシステムへのログインが許可されていることを確認します。
            </p></li><li class="listitem"><p>
              <code class="filename">/etc/pam.d/mysql-ldap</code> という名前の <code class="literal">mysql-ldap</code> PAM サービスファイルを作成して、LDAP を使用して MySQL 接続を認証するように PAM を設定します。 ファイルの内容はシステムに依存するため、<code class="filename">/etc/pam.d</code> ディレクトリ内の既存のログイン関連ファイルをチェックして、それらがどのように表示されるかを確認します。 Linux では、<code class="filename">mysql-ldap</code> ファイルは次のようになります: 
            </p><pre class="programlisting">#%PAM-1.0
auth        required    pam_ldap.so
account     required    pam_ldap.so
</pre><p>
              PAM オブジェクトファイルのサフィクスがシステム上の <code class="filename">.so</code> と異なる場合は、正しいサフィクスに置き換えてください。
            </p><p>
              PAM ファイル形式は、一部のシステムで異なる場合があります。
            </p></li><li class="listitem"><p>
              オペレーティングシステムユーザー名と同じユーザー名で MySQL アカウントを作成し、PAM プラグインおよび <code class="literal">mysql-ldap</code> PAM サービスを使用して認証するように定義します:
            </p><pre class="programlisting">CREATE USER 'antonio'@'localhost'
  IDENTIFIED WITH authentication_pam
  AS 'mysql-ldap';
GRANT ALL PRIVILEGES
  ON mydb.*
  TO 'antonio'@'localhost';
</pre><p>
              ここで、認証文字列には PAM サービス名 <code class="literal">mysql-ldap</code> のみが含まれ、LDAP を使用して認証されます。
            </p></li><li class="listitem"><p>
              サーバーへの接続は、<a class="xref" href="security.html#pam-authentication-unix-without-proxy" title="プロキシユーザーを使用しない PAM Unix パスワード認証">プロキシユーザーを使用しない PAM Unix パスワード認証</a> で説明されている接続と同じです。
            </p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-authentication-unix-with-proxy"></a>プロキシユーザーとグループマッピングを使用した PAM Unix パスワード認証</h5></div></div></div><a class="indexterm" name="idm46723759741568"></a><p>
          ここで説明する認証スキームでは、プロキシと PAM グループのマッピングを使用して、PAM を使用して認証する接続 MySQL ユーザーを、異なる特権セットを定義するほかの MySQL アカウントにマップします。 ユーザーは、権限を定義するアカウントを使用して直接接続しません。 かわりに、PAM を使用して認証されたデフォルトのプロキシアカウントを介して接続し、すべての外部ユーザーが権限を保持する MySQL アカウントにマップされるようにします。 プロキシアカウントを使用して接続するユーザーは、外部ユーザーに許可されるデータベース操作を決定する権限である、これらの MySQL アカウントのいずれかにマップされます。 
        </p><p>
          ここに示す手順では、Unix パスワード認証が使用されます。 代わりに LDAP を使用するには、前半で示した<a class="xref" href="security.html#pam-authentication-ldap-without-proxy" title="プロキシユーザーを使用しない PAM LDAP 認証">プロキシユーザーを使用しない PAM LDAP 認証</a>の手順を参照してください。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            従来の Unix パスワードは、<code class="filename">/etc/shadow</code> ファイルを使用してチェックされます。 このファイルに関連して発生する可能性のある問題の詳細は、<a class="xref" href="security.html#pam-authentication-unix-password-store" title="Unix パスワードストアへの PAM 認証アクセス">Unix パスワードストアへの PAM 認証アクセス</a> を参照してください。 
          </p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Unix 認証で、ユーザー名が <code class="literal">antonio</code> でパスワードが <em class="replaceable"><code>antonio_password</code></em> のオペレーティングシステムへのログインが許可されていることを確認します。
            </p></li><li class="listitem"><p>
              <code class="literal">antonio</code> が <code class="literal">root</code> または <code class="literal">users</code> PAM グループのメンバーであることを確認します。
            </p></li><li class="listitem"><p>
              <code class="filename">/etc/pam.d/mysql-unix</code> という名前のファイルを作成して、オペレーティングシステムユーザーを介して <code class="literal">mysql-unix</code> PAM サービスを認証するように PAM を設定します。 ファイルの内容はシステムに依存するため、<code class="filename">/etc/pam.d</code> ディレクトリ内の既存のログイン関連ファイルをチェックして、それらがどのように表示されるかを確認します。 Linux では、<code class="filename">mysql-unix</code> ファイルは次のようになります: 
            </p><pre class="programlisting">#%PAM-1.0
auth            include         password-auth
account         include         password-auth
</pre><p>
              macOS の場合は、<code class="literal">password-auth</code> ではなく <code class="literal">login</code> を使用します。
            </p><p>
              PAM ファイル形式は、一部のシステムで異なる場合があります。 たとえば、Ubuntu およびその他の Debian ベースのシステムでは、かわりに次のファイルコンテンツを使用します: 
            </p><pre class="programlisting">@include common-auth
@include common-account
@include common-session-noninteractive
</pre></li><li class="listitem"><p>
              外部 PAM ユーザーをプロキシ設定されたアカウントにマップするデフォルトプロキシユーザー (<code class="literal">''@''</code>) を作成します:
            </p><pre class="programlisting">CREATE USER ''@''
  IDENTIFIED WITH authentication_pam
  AS 'mysql-unix, root=developer, users=data_entry';
</pre><p>
              ここで、認証文字列には PAM サービス名 (<code class="literal">mysql-unix</code>) が含まれており、Unix パスワードを認証します。 また、認証文字列は、<code class="literal">root</code> および <code class="literal">users</code> PAM グループ内の外部ユーザーを、それぞれ <code class="literal">developer</code> および <code class="literal">data_entry</code> MySQL ユーザー名にマップします。 
            </p><p>
              プロキシユーザーを設定するときは、PAM サービス名のあとに PAM グループマッピングリストが必要です。 そうしないと、プラグインは、外部ユーザー名から適切なプロキシ MySQL ユーザー名へのマッピングの実行方法を認識できません。 
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                MySQL インストールに匿名ユーザーが含まれている場合、デフォルトのプロキシユーザーと競合する可能性があります。 この問題とその対処方法の詳細は、<a class="xref" href="security.html#proxy-users-conflicts" title="デフォルトのプロキシユーザーと匿名ユーザーの競合">デフォルトのプロキシユーザーと匿名ユーザーの競合</a> を参照してください。 
              </p></div></li><li class="listitem"><p>
              プロキシ設定されたアカウントを作成し、各アカウントに次の権限を付与します:
            </p><pre class="programlisting">CREATE USER 'developer'@'localhost'
  IDENTIFIED WITH mysql_no_login;
CREATE USER 'data_entry'@'localhost'
  IDENTIFIED WITH mysql_no_login;

GRANT ALL PRIVILEGES
  ON mydevdb.*
  TO 'developer'@'localhost';
GRANT ALL PRIVILEGES
  ON mydb.*
  TO 'data_entry'@'localhost';
</pre><p>
              プロキシ設定されたアカウントは、<code class="literal">mysql_no_login</code> 認証プラグインを使用して、クライアントがアカウントを使用して MySQL サーバーに直接ログインできないようにします。 代わりに、PAM を使用して認証するユーザーは、PAM グループに基づいてプロキシによって <code class="literal">developer</code> または <code class="literal">data_entry</code> アカウントを使用することが期待されます。 (これは、プラグインがインストールされていることを前提としています。 手順については、<a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 ログインなしのプラガブル認証">セクション6.4.1.8「ログインなしのプラガブル認証」</a> を参照してください。) プロキシ設定されたアカウントを直接使用しないように保護する別の方法については、<a class="xref" href="security.html#preventing-proxied-account-direct-login" title="プロキシアカウントへの直接ログインの防止">プロキシアカウントへの直接ログインの防止</a> を参照してください。 
            </p></li><li class="listitem"><p>
              プロキシされた各アカウントの <code class="literal">PROXY</code> 権限をプロキシアカウントに付与します:
            </p><pre class="programlisting">GRANT PROXY
  ON 'developer'@'localhost'
  TO ''@'';
GRANT PROXY
  ON 'data_entry'@'localhost'
  TO ''@'';
</pre></li><li class="listitem"><p>
              <span class="command"><strong>mysql</strong></span> コマンドラインクライアントを使用して、<code class="literal">antonio</code> として MySQL サーバーに接続します。
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=antonio --password --enable-cleartext-plugin</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>antonio_password</code></em></code></strong>
</pre><p>
              サーバーは、デフォルトの<code class="literal">''@''</code>プロキシアカウントを使用して接続を認証します。 結果として生成される <code class="literal">antonio</code> の権限は、<code class="literal">antonio</code> がメンバーになっている PAM グループによって異なります。 <code class="option">antonio</code> が <code class="literal">root</code> PAM グループのメンバーである場合、PAM プラグインは、<code class="literal">developer</code> MySQL ユーザー名に <code class="literal">root</code> をマップし、その名前をサーバーに返します。 サーバーは、<code class="literal">''@''</code>が <code class="literal">developer</code> に対する <code class="literal">PROXY</code> 権限を持っていることを確認し、接続を許可します。 次のクエリーは、次に示すような出力を返します: 
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+---------------------+--------------+
| USER()            | CURRENT_USER()      | @@proxy_user |
+-------------------+---------------------+--------------+
| antonio@localhost | developer@localhost | ''@''        |
+-------------------+---------------------+--------------+
</pre><p>
              これは、<code class="literal">antonio</code> オペレーティングシステムユーザーが <code class="literal">developer</code> MySQL ユーザーに付与された権限を持つように認証され、プロキシがデフォルトのプロキシアカウントを介して行われることを示しています。
            </p><p>
              <code class="literal">antonio</code> が <code class="literal">root</code> PAM グループのメンバーではなく、<code class="literal">users</code> PAM グループのメンバーである場合、同様のプロセスが発生しますが、プラグインは <code class="literal">user</code> PAM グループメンバーシップを <code class="literal">data_entry</code> MySQL ユーザー名にマップし、その名前をサーバーに返します:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+----------------------+--------------+
| USER()            | CURRENT_USER()       | @@proxy_user |
+-------------------+----------------------+--------------+
| antonio@localhost | data_entry@localhost | ''@''        |
+-------------------+----------------------+--------------+
</pre><p>
              これは、<code class="literal">antonio</code> オペレーティングシステムユーザーが <code class="literal">data_entry</code> MySQL ユーザーの権限を持つように認証され、そのプロキシがデフォルトのプロキシアカウントを介して行われることを示しています。
            </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            クライアント側の <code class="literal">mysql_clear_password</code> 認証プラグインでは、パスワードはそのまま残されるため、クライアントプログラムはクリアテキストとして MySQL サーバーに送信します。 これにより、パスワードをそのまま PAM に渡すことができます。 サーバー側 PAM ライブラリを使用するにはクリアテキストのパスワードが必要ですが、一部の構成でセキュリティーの問題が発生する可能性があります。 これらのメジャーにより、リスクが最小限に抑えられます: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">mysql_clear_password</code> プラグインを誤って使用する可能性を低くするには、MySQL クライアントで明示的に有効にする必要があります (たとえば、<code class="option">--enable-cleartext-plugin</code> オプションを使用)。 <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 クライアント側クリアテキストプラガブル認証">セクション6.4.1.4「クライアント側クリアテキストプラガブル認証」</a>を参照してください。 
              </p></li><li class="listitem"><p>
                <code class="literal">mysql_clear_password</code> プラグインを有効にしてパスワードの公開を回避するには、MySQL クライアントは暗号化された接続を使用して MySQL サーバーに接続する必要があります。 <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a>を参照してください。 
              </p></li></ul></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-authentication-unix-password-store"></a>Unix パスワードストアへの PAM 認証アクセス</h5></div></div></div><p>
          一部のシステムでは、Unix 認証は、通常はアクセス権限が制限されているファイルである<code class="filename">/etc/shadow</code> などのパスワードストアを使用します。 これにより、MySQL PAM ベースの認証が失敗する可能性があります。 残念ながら、PAM 実装では、<span class="quote">「<span class="quote">「パスワードが一致しません」</span>」</span>との<span class="quote">「<span class="quote">「パスワードを確認できませんでした」</span>」</span>の区別 (たとえば、<code class="filename">/etc/shadow</code> を読み取れないため) は許可されていません。 PAM 認証に Unix パスワードストアを使用している場合は、次のいずれかの方法を使用して MySQL からパスワードストアへのアクセスを有効にできます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MySQL サーバーが <code class="literal">mysql</code> オペレーティングシステムアカウントから実行されている場合は、<code class="filename">/etc/shadow</code> アクセス権を持つ <code class="literal">shadow</code> グループにそのアカウントを配置します:
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                  <code class="filename">/etc/group</code> で <code class="literal">shadow</code> グループを作成します。
                </p></li><li class="listitem"><p>
                  <code class="literal">mysql</code> オペレーティングシステムユーザーを<code class="filename">/etc/group</code> の <code class="literal">shadow</code> グループに追加します。
                </p></li><li class="listitem"><p>
                  <code class="filename">/etc/group</code> を <code class="literal">shadow</code> グループに割り当て、グループの読取り権限を有効にします:
                </p><pre class="programlisting">chgrp shadow /etc/shadow
chmod g+r /etc/shadow
</pre></li><li class="listitem"><p>
                  MySQL Server を再起動します。
                </p></li></ol></div></li><li class="listitem"><p>
              <code class="literal">pam_unix</code> モジュールおよび <span class="command"><strong>unix_chkpwd</strong></span> ユーティリティを使用している場合は、次のようにパスワードストアへのアクセスを有効にします:
            </p><pre class="programlisting">chmod u-s /usr/sbin/unix_chkpwd
setcap cap_dac_read_search+ep /usr/sbin/unix_chkpwd
</pre><p>
              プラットフォームに応じて、<span class="command"><strong>unix_chkpwd</strong></span> へのパスを調整します。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="pam-pluggable-authentication-debugging"></a>PAM 認証のデバッグ</h5></div></div></div><a class="indexterm" name="idm46723759636032"></a><a class="indexterm" name="idm46723759634496"></a><p>
          PAM 認証プラグインは、初期化時に <code class="literal">AUTHENTICATION_PAM_LOG</code> 環境の値が設定されているかどうかをチェックします (値は問題ありません)。 その場合、プラグインを使用すると、標準出力への診断メッセージのロギングが有効になります。 これらのメッセージは、プラグインが認証を実行するときに発生する PAM 関連の問題のデバッグに役立つ場合があります。 
        </p><p>
          一部のメッセージには、PAM プラグインソースファイルと行番号への参照が含まれています。これを使用すると、プラグインアクションをそれが発生するコード内の場所に、より緊密に関連付けることができます。
        </p><p>
          接続障害をデバッグし、接続試行中に何が起こっているかを判断する別の手法は、PAM 認証を構成してすべての接続を許可し、システムログファイルを確認することです。 この方法は <span class="emphasis"><em>temporary</em></span> ベースでのみ使用し、本番サーバーでは使用しないでください。 
        </p><p>
          <code class="filename">/etc/pam.d/mysql-any-password</code> という PAM サービスファイルを次の内容で構成します (一部のシステムでは形式が異なる場合があります):
        </p><pre class="programlisting">#%PAM-1.0
auth        required    pam_permit.so
account     required    pam_permit.so
</pre><p>
          PAM プラグインを使用するアカウントを作成し、<code class="literal">mysql-any-password</code> PAM サービスに名前を付けます:
        </p><pre class="programlisting">CREATE USER 'testuser'@'localhost'
  IDENTIFIED WITH authentication_pam
  AS 'mysql-any-password';
</pre><p>
          <code class="literal">mysql-any-password</code> サービスファイルを使用すると、不正なパスワードの場合でも、認証試行で true が返されます。 認証の試行が失敗した場合は、構成の問題が MySQL 側にあることを示します。 それ以外の場合は、オペレーティングシステム/PAM 側で問題が発生します。 何が起こっているかを確認するには、<code class="filename">/var/log/secure</code>, <code class="filename">/var/log/audit.log</code>, <code class="filename">/var/log/syslog</code> や<code class="filename">/var/log/messages</code> などのシステムログファイルを確認します。 
        </p><p>
          問題点を特定したら、<code class="filename">mysql-any-password</code> PAM サービスファイルを削除して any-password アクセスを無効にします。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="windows-pluggable-authentication"></a>6.4.1.6 Windows プラガブル認証</h4></div></div></div><a class="indexterm" name="idm46723759615936"></a><a class="indexterm" name="idm46723759614368"></a><a class="indexterm" name="idm46723759612480"></a><a class="indexterm" name="idm46723759610896"></a><a class="indexterm" name="idm46723759608928"></a><a class="indexterm" name="idm46723759606880"></a><a class="indexterm" name="idm46723759604720"></a><a class="indexterm" name="idm46723759603712"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          Windows プラガブル認証は、商用製品である MySQL Enterprise Edition に含まれている拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
        </p></div><p>
        MySQL Enterprise Edition for Windows は、Windows で外部認証を実行する認証方式をサポートしているため、MySQL Server はネイティブ Windows サービスを使用してクライアント接続を認証できます。 Windows にログインしたユーザーは、追加のパスワードを指定せずに、自分の環境内の情報に基づいて MySQL クライアントプログラムからサーバーに接続できます。 
      </p><p>
        クライアントとサーバーは、認証ハンドシェイクでデータパケットを交換します。 この交換の結果として、サーバーは Windows OS 内のクライアントのアイデンティティーを表すセキュリティーコンテキストオブジェクトを作成します。 このアイデンティティーには、クライアントアカウントの名前が含まれています。 Windows プラガブル認証では、クライアントの ID を使用して、クライアントが特定のアカウントであるかグループのメンバーであるかを確認します。 デフォルトでは、認証のネゴシエーションに Kerberos が使用されます。Kerberos が使用できない場合は、NTLM が使用されます。 
      </p><p>
        Windows プラガブル認証には、次の機能があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            外部認証: Windows 認証を使用すると、MySQL Server は、Windows にログインした MySQL 付与テーブルの外部で定義されたユーザーからの接続を受け入れることができます。
          </p></li><li class="listitem"><p>
            プロキシユーザーのサポート: Windows 認証は、クライアントプログラムによって渡された外部ユーザー名とは異なるユーザー名を MySQL に返すことができます。 つまり、このプラグインは、外部の Windows で認証されたユーザーが持つべき権限を定義する MySQL ユーザーを返すことができます。 たとえば、<code class="literal">joe</code> という名前の Windows ユーザーは、<code class="literal">developer</code> という名前の MySQL ユーザーに接続して権限を持つことができます。 
          </p></li></ul></div><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。 ファイルは、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリに配置する必要があります。 
      </p><div class="table"><a name="idm46723759589616"></a><p class="title"><b>表 6.17 Windows 認証用のプラグインとライブラリの名前</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for Windows password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td><code class="literal">authentication_windows</code></td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td><code class="literal">authentication_windows_client</code></td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td><code class="filename">authentication_windows.dll</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        ライブラリファイルには、サーバー側のプラグインのみが含まれています。 クライアント側のプラグインは、<code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれています。 
      </p><p>
        サーバー側 Windows 認証プラグインは、MySQL Enterprise Edition にのみ含まれています。 MySQL コミュニティー配布には含まれていません。 クライアント側のプラグインは、コミュニティー配布を含むすべての配布に含まれています。 これにより、任意の配布から、サーバー側のプラグインがロードされたサーバーに接続することがクライアントに許可されます。 
      </p><p>
        Windows 認証プラグインは、MySQL 8.0 でサポートされている任意のバージョンの Windows でサポートされています (<a class="ulink" href="https://www.mysql.com/support/supportedplatforms/database.html" target="_top">https://www.mysql.com/support/supportedplatforms/database.html</a>を参照してください)。
      </p><p>
        次の各セクションでは、Windows プラガブル認証に固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#windows-pluggable-authentication-installation" title="Windows プラガブル認証のインストール">Windows プラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#windows-pluggable-authentication-uninstallation" title="Windows プラガブル認証のアンインストール">Windows プラガブル認証のアンインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#windows-pluggable-authentication-usage" title="Windows プラガブル認証の使用">Windows プラガブル認証の使用</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。 プロキシユーザーについては、<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください。 
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="windows-pluggable-authentication-installation"></a>Windows プラガブル認証のインストール</h5></div></div></div><p>
          このセクションでは、Windows 認証プラグインをインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
        </p><p>
          サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
        </p><p>
          サーバーの起動時にプラグインをロードするには、<code class="option">--plugin-load-add</code> オプションを使用して、プラグインを含むライブラリファイルに名前を付けます。 このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルに次の行を挿入します: 
        </p><pre class="programlisting">[mysqld]
plugin-load-add=authentication_windows.dll
</pre><p>
          <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
        </p><p>
          または、実行時にプラグインをロードするには、次のステートメントを使用します:
        </p><pre class="programlisting">INSTALL PLUGIN authentication_windows SONAME 'authentication_windows.dll';
</pre><p>
          <code class="literal">INSTALL PLUGIN</code> はプラグインをただちにロードし、<code class="literal">mysql.plugins</code> システムテーブルにも登録して、<code class="option">--plugin-load-add</code> を必要とせずに後続の通常の起動のたびにサーバーがプラグインをロードするようにします。
        </p><p>
          プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%windows%';</code></strong>
+------------------------+---------------+
| PLUGIN_NAME            | PLUGIN_STATUS |
+------------------------+---------------+
| authentication_windows | ACTIVE        |
+------------------------+---------------+
</pre><p>
          プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
        </p><p>
          MySQL アカウントを Windows 認証プラグインに関連付けるには、<a class="xref" href="security.html#windows-pluggable-authentication-usage" title="Windows プラガブル認証の使用">Windows プラガブル認証の使用</a> を参照してください。 追加のプラグイン制御は、<code class="literal">authentication_windows_use_principal_name</code> および <code class="literal">authentication_windows_log_level</code> システム変数によって提供されます。 <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 サーバーシステム変数">セクション5.1.8「サーバーシステム変数」</a>を参照してください。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="windows-pluggable-authentication-uninstallation"></a>Windows プラガブル認証のアンインストール</h5></div></div></div><p>
          Windows 認証プラグインのアンインストールに使用する方法は、インストール方法によって異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="option">--plugin-load-add</code> オプションを使用してサーバーの起動時にプラグインをインストールした場合は、オプションなしでサーバーを再起動します。
            </p></li><li class="listitem"><p>
              <code class="literal">INSTALL PLUGIN</code> ステートメントを使用して実行時にプラグインをインストールした場合、サーバーの再起動後もインストールされたままになります。 アンインストールするには、<code class="literal">UNINSTALL PLUGIN</code> を使用します: 
            </p><pre class="programlisting">UNINSTALL PLUGIN authentication_windows;
</pre></li></ul></div><p>
          また、Windows プラグイン関連のシステム変数を設定する起動オプションも削除します。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="windows-pluggable-authentication-usage"></a>Windows プラガブル認証の使用</h5></div></div></div><p>
          Windows 認証プラグインでは、Windows にログインしたユーザーが追加のパスワードを指定しなくても、MySQL サーバーに接続できるように、MySQL アカウントの使用がサポートされています。 <a class="xref" href="security.html#windows-pluggable-authentication-installation" title="Windows プラガブル認証のインストール">Windows プラガブル認証のインストール</a> で説明されているように、サーバーがサーバー側プラグインを有効にして実行されていることを前提としています。 DBA がサーバー側のプラグインを有効にして、それを使用するようにアカウントを設定すると、クライアントは自分の側でその他の設定を行う必要なしで、これらのアカウントを使用して接続できます。 
        </p><p>
          <code class="literal">CREATE USER</code> ステートメントの <code class="literal">IDENTIFIED WITH</code> 句で Windows 認証プラグインを参照するには、<code class="literal">authentication_windows</code> という名前を使用します。 <code class="literal">Rafal</code> と <code class="literal">Tasha</code> という Windows ユーザー、および <code class="literal">Administrators</code> または <code class="literal">Power Users</code> グループ内の任意のユーザーが MySQL への接続が許可されるべきであると仮定します。 このように設定するには、Windows プラグインを使用して認証する <code class="literal">sql_admin</code> という名前の MySQL アカウントを作成します。 
        </p><pre class="programlisting">CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal, Tasha, Administrators, "Power Users"';
</pre><p>
          プラグイン名は <code class="literal">authentication_windows</code> です。 <code class="literal">AS</code> キーワードに続く文字列は、認証文字列です。 <code class="literal">Rafal</code> または <code class="literal">Tasha</code> という名前の Windows ユーザー、および <code class="literal">Administrators</code> または <code class="literal">Power Users</code> グループ内の任意の Windows ユーザーが MySQL ユーザー <code class="literal">sql_admin</code> として、サーバーへの認証が許可されるように指定されます。 後者のグループ名には空白文字が含まれているため、二重引用符で囲む必要があります。 
        </p><p>
          <code class="literal">sql_admin</code> アカウントを作成したあとは、Windows にログインしたユーザーはそのアカウントを使用して、サーバーへの接続を試みることができます。
        </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>mysql --user=sql_admin</code></strong>
</pre><p>
          ここでは、パスワードは必要ありません。 <code class="literal">authentication_windows</code> プラグインは Windows のセキュリティー API を使用して、接続中の Windows ユーザーをチェックします。 そのユーザーの名前が <code class="literal">Rafal</code> または <code class="literal">Tasha</code> であるか、<code class="literal">Administrators</code> または <code class="literal">Power Users</code> グループのメンバーである場合、サーバーはアクセス権を付与し、クライアントは <code class="literal">sql_admin</code> として認証され、<code class="literal">sql_admin</code> アカウントに付与されている権限を持ちます。 それ以外の場合、サーバーはアクセスを拒否します。 
        </p><p>
          Windows 認証プラグインでの認証文字列の構文は、次のようなルールに従っています。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              文字列は、カンマで区切られた 1 つ以上のユーザーマッピングで構成されます。
            </p></li><li class="listitem"><p>
              各ユーザーマッピングによって、Windows ユーザー名またはグループ名が MySQL ユーザー名に関連付けられます。
            </p><pre class="programlisting"><em class="replaceable"><code>win_user_or_group_name=mysql_user_name</code></em>
<em class="replaceable"><code>win_user_or_group_name</code></em>
</pre><p>
              後者の構文では、<em class="replaceable"><code>mysql_user_name</code></em> 値が指定されていない場合、暗黙的な値は <code class="literal">CREATE USER</code> ステートメントによって作成された MySQL ユーザーです。 したがって、次のステートメントは同等です。 
            </p><pre class="programlisting">CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal, Tasha, Administrators, "Power Users"';

CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal=sql_admin, Tasha=sql_admin, Administrators=sql_admin,
      "Power Users"=sql_admin';
</pre></li><li class="listitem"><p>
              バックスラッシュは MySQL 文字列のエスケープ文字であるため、値の各バックスラッシュ文字 (<code class="literal">\</code>) は二重にする必要があります。
            </p></li><li class="listitem"><p>
              二重引用符で囲まれていない先頭および末尾の空白文字は、無視されます。
            </p></li><li class="listitem"><p>
              引用符で囲まれていない <em class="replaceable"><code>win_user_or_group_name</code></em> および <em class="replaceable"><code>mysql_user_name</code></em> の値には、等号、カンマまたは空白以外の任意の値を含めることができます。
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>win_user_or_group_name</code></em> または <em class="replaceable"><code>mysql_user_name</code></em>(あるいはその両方) の値が二重引用符で囲まれている場合、引用符の間のすべてが値の一部になります。 たとえば、名前に空白文字が含まれている場合は、これが必要です。 二重引用符およびバックスラッシュを除く、二重引用符内のすべての文字が有効です。 どちらかの文字を含めるには、バックスラッシュを使用してエスケープします。 
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>win_user_or_group_name</code></em> 値では、Windows 主体 (ローカルまたはドメイン内) 用の従来の構文が使用されます。 例 (バックスラッシュを二重にすることに注意してください): 
            </p><pre class="programlisting">domain\\user
.\\user
domain\\group
.\\group
BUILTIN\\WellKnownGroup
</pre></li></ul></div><p>
          クライアントを認証するためにサーバーから呼び出されると、プラグインは認証文字列を左から右へとスキャンして、Windows ユーザーとのユーザーまたはグループの一致があるかどうかを確認します。 一致する場合、プラグインは対応する <em class="replaceable"><code>mysql_user_name</code></em> を MySQL サーバーに返します。 一致がない場合は、認証に失敗します。 
        </p><p>
          ユーザー名の一致は、グループ名の一致よりも優先されます。 <code class="literal">win_user</code> という名前の Windows ユーザーが <code class="literal">win_group</code> のメンバーであり、認証文字列が次のとおりであると仮定します。 
        </p><pre class="programlisting">'win_group = sql_user1, win_user = sql_user2'
</pre><p>
          <code class="literal">win_user</code> が MySQL サーバーに接続すると、<code class="literal">win_group</code> と <code class="literal">win_user</code> の両方への一致があります。 グループが認証文字列の最初に一覧表示されますが、より具体的なユーザーの一致がグループの一致よりも優先されるため、プラグインは <code class="literal">sql_user2</code> としてユーザーを認証します。 
        </p><p>
          サーバーが実行されているものと同じコンピュータからの接続では、Windows 認証は常に機能します。 コンピュータ間の接続では、両方のコンピュータを Windows Active Directory に登録する必要があります。 同じ Windows ドメイン内にある場合は、ドメイン名を指定する必要はありません。 次の例に示すように、別のドメインからの接続を許可することもできます。 
        </p><pre class="programlisting">CREATE USER sql_accounting
  IDENTIFIED WITH authentication_windows
  AS 'SomeDomain\\Accounting';
</pre><p>
          ここで、<code class="literal">SomeDomain</code> は別のドメインの名前です。 バックスラッシュ文字は文字列内の MySQL エスケープ文字であるため、二重に入力されています。 
        </p><a class="indexterm" name="idm46723759471072"></a><p>
          MySQL では、クライアントは 1 つのアカウントを使用して MySQL サーバーに接続して認証できるが、接続されると別のアカウントの権限を持つというプロキシユーザーの概念がサポートされています (<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください)。 次のように、Windows ユーザーは単一のユーザー名を使用して接続するが、Windows ユーザー名およびグループ名に基づいて特定の MySQL アカウント上にマップされると仮定します。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">local_user</code> および <code class="literal">MyDomain\domain_user</code> というローカルおよびドメインの Windows ユーザーは、<code class="literal">local_wlad</code> MySQL アカウントにマップするべきです。
            </p></li><li class="listitem"><p>
              <code class="literal">MyDomain\Developers</code> ドメイングループ内のユーザーは、<code class="literal">local_dev</code> MySQL アカウントにマップするべきです。
            </p></li><li class="listitem"><p>
              ローカルマシンの管理者は、<code class="literal">local_admin</code> MySQL アカウントにマップするべきです。
            </p></li></ul></div><p>
          このように設定するには、接続先の Windows ユーザーのプロキシアカウントを作成し、ユーザーとグループが適切な MySQL アカウント (<code class="literal">local_wlad</code>、<code class="literal">local_dev</code>、<code class="literal">local_admin</code>) にマップされるように、このアカウントを構成します。 さらに、実行する必要がある操作に適した権限を MySQL アカウントに付与します。 次の手順では、プロキシアカウントとして <code class="literal">win_proxy</code> が使用され、プロキシ対象アカウントとして <code class="literal">local_wlad</code>、<code class="literal">local_dev</code>、および <code class="literal">local_admin</code> が使用されています。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              プロキシ MySQL アカウントを作成します。
            </p><pre class="programlisting">CREATE USER win_proxy
  IDENTIFIED WITH  authentication_windows
  AS 'local_user = local_wlad,
      MyDomain\\domain_user = local_wlad,
      MyDomain\\Developers = local_dev,
      BUILTIN\\Administrators = local_admin';
</pre></li><li class="listitem"><p>
              プロキシ処理が動作するには、プロキシ対象アカウントが存在する必要があるため、次のように作成します。
            </p><pre class="programlisting">CREATE USER local_wlad
  IDENTIFIED WITH mysql_no_login;
CREATE USER local_dev
  IDENTIFIED WITH mysql_no_login;
CREATE USER local_admin
  IDENTIFIED WITH mysql_no_login;
</pre><p>
              プロキシ設定されたアカウントは、<code class="literal">mysql_no_login</code> 認証プラグインを使用して、クライアントがアカウントを使用して MySQL サーバーに直接ログインできないようにします。 かわりに、Windows を使用して認証するユーザーは、<code class="literal">win_proxy</code> プロキシアカウントを使用する必要があります。 (これは、プラグインがインストールされていることを前提としています。 手順については、<a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 ログインなしのプラガブル認証">セクション6.4.1.8「ログインなしのプラガブル認証」</a> を参照してください。) プロキシ設定されたアカウントを直接使用しないように保護する別の方法については、<a class="xref" href="security.html#preventing-proxied-account-direct-login" title="プロキシアカウントへの直接ログインの防止">プロキシアカウントへの直接ログインの防止</a> を参照してください。 
            </p><p>
              また、各プロキシアカウントに MySQL アクセスに必要な権限を付与する <code class="literal">GRANT</code> ステートメント (表示されていません) も実行する必要があります。
            </p></li><li class="listitem"><p>
              プロキシされた各アカウントの <code class="literal">PROXY</code> 権限をプロキシアカウントに付与します:
            </p><pre class="programlisting">GRANT PROXY ON local_wlad TO win_proxy;
GRANT PROXY ON local_dev TO win_proxy;
GRANT PROXY ON local_admin TO win_proxy;
</pre></li></ol></div><p>
          これで、Windows ユーザー <code class="literal">local_user</code> および <code class="literal">MyDomain\domain_user</code> は <code class="literal">win_proxy</code> として MySQL サーバーに接続でき、認証時に認証文字列で指定されたアカウント (この場合は <code class="literal">local_wlad</code>) の権限を持つようになります。 <code class="literal">win_proxy</code> として接続する <code class="literal">MyDomain\Developers</code> グループ内のユーザーは、<code class="literal">local_dev</code> アカウントの権限を持っています。 <code class="literal">BUILTIN\Administrators</code> グループ内のユーザーは、<code class="literal">local_admin</code> アカウントの権限を持っています。 
        </p><p>
          独自の MySQL アカウントを持たないすべての Windows ユーザーがプロキシアカウントを経由するように認証を構成するには、前述の手順で <code class="literal">win_proxy</code> のデフォルトのプロキシアカウント (<code class="literal">''@''</code>) に置き換えます。 デフォルトのプロキシアカウントの詳細は、<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照してください。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            MySQL インストールに匿名ユーザーが含まれている場合、デフォルトのプロキシユーザーと競合する可能性があります。 この問題とその対処方法の詳細は、<a class="xref" href="security.html#proxy-users-conflicts" title="デフォルトのプロキシユーザーと匿名ユーザーの競合">デフォルトのプロキシユーザーと匿名ユーザーの競合</a> を参照してください。 
          </p></div><p>
          Connector/NET 6.4.4 以上の Connector/NET 接続文字列で Windows 認証プラグインを使用するには、<a class="ulink" href="https://dev.mysql.com/doc/connector-net/en/connector-net-programming-authentication-windows-native.html" target="_top">Using the Windows Native Authentication Plugin</a> を参照してください。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ldap-pluggable-authentication"></a>6.4.1.7 LDAP プラガブル認証</h4></div></div></div><a class="indexterm" name="idm46723759422656"></a><a class="indexterm" name="idm46723759420656"></a><a class="indexterm" name="idm46723759418576"></a><a class="indexterm" name="idm46723759416496"></a><a class="indexterm" name="idm46723759414448"></a><a class="indexterm" name="idm46723759413328"></a><a class="indexterm" name="idm46723759411232"></a><a class="indexterm" name="idm46723759409456"></a><a class="indexterm" name="idm46723759407680"></a><a class="indexterm" name="idm46723759405904"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          LDAP プラガブル認証は、商用製品である MySQL Enterprise Edition に含まれる拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
        </p></div><p>
        MySQL Enterprise Edition は、MySQL Server が LDAP (Lightweight Directory Access Protocol) を使用して X.500 などのディレクトリサービスにアクセスすることで MySQL ユーザーを認証できるようにする認証方式をサポートしています。 MySQL は、LDAP を使用してユーザー、資格証明およびグループ情報をフェッチします。 
      </p><p>
        LDAP プラガブル認証は、次の機能を提供します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            外部認証: LDAP 認証を使用すると、MySQL Server は LDAP ディレクトリ内の MySQL 付与テーブルの外部で定義されたユーザーからの接続を受け入れることができます。
          </p></li><li class="listitem"><p>
            プロキシユーザーのサポート: LDAP 認証は、外部ユーザーがメンバーになっている LDAP グループに基づいて、クライアントプログラムによって渡される外部ユーザー名とは異なるユーザー名を MySQL に返すことができます。 つまり、LDAP プラグインは、外部 LDAP 認証ユーザーが持つべき権限を定義する MySQL ユーザーを返すことができます。 たとえば、<code class="literal">joe</code> の LDAP グループが <code class="literal">developer</code> の場合、<code class="literal">joe</code> という名前の LDAP ユーザーは <code class="literal">developer</code> という名前の MySQL ユーザーに接続して権限を持つことができます。 
          </p></li><li class="listitem"><p>
            セキュリティ: TLS を使用すると、LDAP サーバーへの接続をセキュリティー保護できます。
          </p></li></ul></div><p>
        次のテーブルに、単純および SASL ベースの LDAP 認証用のプラグインおよびライブラリファイル名を示します。 ファイル名のサフィクスは、システムによって異なる場合があります。 ファイルは、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリに配置する必要があります。 
      </p><div class="table"><a name="idm46723759391392"></a><p class="title"><b>表 6.18 簡易 LDAP 認証のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for simple LDAP password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側のプラグイン名</td>
            <td><code class="literal">authentication_ldap_simple</code></td>
          </tr><tr>
            <td>クライアント側のプラグイン名</td>
            <td><code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td>ライブラリファイル名</td>
            <td><code class="filename">authentication_ldap_simple.so</code></td>
          </tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="idm46723759377872"></a><p class="title"><b>表 6.19 SASL ベースの LDAP 認証用のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for SASL-based LDAP password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側のプラグイン名</td>
            <td><code class="literal">authentication_ldap_sasl</code></td>
          </tr><tr>
            <td>クライアント側のプラグイン名</td>
            <td><code class="literal">authentication_ldap_sasl_client</code></td>
          </tr><tr>
            <td>ライブラリファイル名</td>
            <td><code class="filename">authentication_ldap_sasl.so</code>, <code class="filename">authentication_ldap_sasl_client.so</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        ライブラリファイルには、<code class="literal">authentication_ldap_<em class="replaceable"><code>XXX</code></em></code> 認証プラグインのみが含まれます。 クライアント側の <code class="literal">mysql_clear_password</code> プラグインは、<code class="literal">libmysqlclient</code> クライアントライブラリに組み込まれています。 
      </p><p>
        各サーバー側 LDAP プラグインは、特定のクライアント側プラグインで動作します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            サーバー側 <code class="literal">authentication_ldap_simple</code> プラグインは、単純な LDAP 認証を実行します。 このプラグインを使用するアカウントによる接続の場合、クライアントプログラムはクライアント側の <code class="literal">mysql_clear_password</code> プラグインを使用します。このプラグインは、パスワードをクリアテキストとしてサーバーに送信します。 パスワードのハッシュ化または暗号化は使用されないため、パスワードの公開を防ぐために、MySQL クライアントとサーバー間のセキュアな接続をお薦めします。 
          </p></li><li class="listitem"><p>
            サーバー側の <code class="literal">authentication_ldap_sasl</code> プラグインは、SASL ベースの LDAP 認証を実行します。 このプラグインを使用するアカウントによる接続の場合、クライアントプログラムはクライアント側の <code class="literal">authentication_ldap_sasl_client</code> プラグインを使用します。 クライアント側およびサーバー側 SASL LDAP プラグインは、SASL メッセージを使用して LDAP プロトコル内での資格証明のセキュアな転送を行い、MySQL クライアントとサーバー間でクリアテキストパスワードが送信されないようにします。 
          </p></li></ul></div><p>
        次の各セクションでは、LDAP プラガブル認証に固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-prerequisites" title="LDAP プラガブル認証の前提条件">LDAP プラガブル認証の前提条件</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-how-it-works" title="MySQL ユーザーの LDAP 認証の仕組み">MySQL ユーザーの LDAP 認証の仕組み</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-installation" title="LDAP プラガブル認証のインストール">LDAP プラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-uninstallation" title="LDAP プラガブル認証のアンインストール">LDAP プラガブル認証のアンインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-ldap-conf" title="LDAP プラガブル認証および ldap.conf">LDAP プラガブル認証および ldap.conf</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage" title="LDAP プラガブル認証の使用">LDAP プラガブル認証の使用</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-simple" title="簡易 LDAP 認証">簡易 LDAP 認証</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-sasl" title="SASL ベースの LDAP 認証">SASL ベースの LDAP 認証</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="プロキシを使用した LDAP 認証">プロキシを使用した LDAP 認証</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-group-mapping" title="LDAP 認証グループプリファレンスとマッピングの指定">LDAP 認証グループプリファレンスとマッピングの指定</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-user-dn-suffix" title="LDAP 認証ユーザー DN 接尾辞">LDAP 認証ユーザー DN 接尾辞</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-auth-methods" title="LDAP 認証方式">LDAP 認証方式</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-gssapi" title="GSSAPI/Kerberos 認証方式">GSSAPI/Kerberos 認証方式</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-ldap-referral" title="LDAP 検索照会">LDAP 検索照会</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。 <code class="literal">mysql_clear_password</code> プラグインの詳細は、<a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 クライアント側クリアテキストプラガブル認証">セクション6.4.1.4「クライアント側クリアテキストプラガブル認証」</a> を参照してください。 プロキシユーザーについては、<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          システムが PAM をサポートし、PAM 認証方式として LDAP を許可する場合、MySQL ユーザー認証に LDAP を使用する別の方法は、サーバー側の <code class="literal">authentication_pam</code> プラグインを使用することです。 <a class="xref" href="security.html#pam-pluggable-authentication" title="6.4.1.5 PAM プラガブル認証">セクション6.4.1.5「PAM プラガブル認証」</a>を参照してください。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-prerequisites"></a>LDAP プラガブル認証の前提条件</h5></div></div></div><p>
          MySQL で LDAP プラガブル認証を使用するには、次の前提条件を満たす必要があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              LDAP 認証プラグインが通信するには、LDAP サーバーが使用可能である必要があります。
            </p></li><li class="listitem"><p>
              MySQL によって認証される LDAP ユーザーは、LDAP サーバーによって管理されるディレクトリに存在する必要があります。
            </p></li><li class="listitem"><p>
              LDAP クライアントライブラリは、サーバー側の <code class="literal">authentication_ldap_sasl</code> または <code class="literal">authentication_ldap_simple</code> プラグインが使用されているシステムで使用可能である必要があります。 現在サポートされているライブラリは、Windows ネイティブ LDAP ライブラリ、または Windows 以外のシステムの OpenLDAP ライブラリです。 
            </p></li><li class="listitem"><p>
              SASL ベースの LDAP 認証を使用するには:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  LDAP サーバーは SASL サーバーと通信するように構成する必要があります。
                </p></li><li class="listitem"><p>
                  SASL クライアントライブラリは、クライアント側の <code class="literal">authentication_ldap_sasl_client</code> プラグインが使用されているシステムで使用可能である必要があります。 現在サポートされているライブラリは Cyrus SASL ライブラリのみです。 
                </p></li><li class="listitem"><p>
                  特定の SASL 認証方式を使用するには、その方式で必要なその他のサービスが使用可能である必要があります。 たとえば、GSSAPI/Kerberos を使用するには、GSSAPI ライブラリおよび Kerberos サービスが使用可能である必要があります。 
                </p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-how-it-works"></a>MySQL ユーザーの LDAP 認証の仕組み</h5></div></div></div><p>
          このセクションでは、MySQL と LDAP が連携して MySQL ユーザーを認証する方法の概要を示します。 特定の LDAP 認証プラグインを使用するように MySQL アカウントを設定する方法を示す例は、<a class="xref" href="security.html#ldap-pluggable-authentication-usage" title="LDAP プラガブル認証の使用">LDAP プラガブル認証の使用</a> を参照してください。 LDAP プラグインで使用可能な認証方式については、<a class="xref" href="security.html#ldap-pluggable-authentication-auth-methods" title="LDAP 認証方式">LDAP 認証方式</a> を参照してください。 
        </p><p>
          クライアントは MySQL サーバーに接続し、MySQL クライアントユーザー名とパスワードを指定します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              単純な LDAP 認証の場合、クライアント側およびサーバー側のプラグインはパスワードをクリアテキストとして通信します。 パスワードの公開を防ぐために、MySQL クライアントとサーバー間のセキュアな接続をお薦めします。 
            </p></li><li class="listitem"><p>
              SASL ベースの LDAP 認証の場合、クライアント側とサーバー側のプラグインは、MySQL クライアントとサーバー間でクリアテキストのパスワードを送信しないようにします。 たとえば、プラグインは SASL メッセージを使用して、LDAP プロトコル内での資格証明のセキュアな転送を行うことができます。 GSSAPI 認証方式の場合、クライアント側およびサーバー側のプラグインは、LDAP メッセージを直接使用せずに Kerberos を使用してセキュアに通信します。 
            </p></li></ul></div><p>
          クライアントユーザー名とホスト名が MySQL アカウントと一致しない場合、接続は拒否されます。
        </p><p>
          一致する MySQL アカウントがある場合は、LDAP に対する認証が行われます。 LDAP サーバーは、ユーザーと一致するエントリを検索し、LDAP パスワードに対してエントリを認証します: 
        </p><a class="indexterm" name="idm46723759306864"></a><a class="indexterm" name="idm46723759304720"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MySQL アカウントが LDAP ユーザー識別名 (DN) を指定している場合、LDAP 認証はその値とクライアントによって提供された LDAP パスワードを使用します。 (LDAP ユーザー DN を MySQL アカウントに関連付けるには、アカウントを作成する <code class="literal">CREATE USER</code> ステートメントに認証文字列を指定する <code class="literal">BY</code> 句を含めます。) 
            </p></li><li class="listitem"><p>
              MySQL アカウントに LDAP ユーザー DN が指定されていない場合、LDAP 認証ではクライアントから提供されたユーザー名と LDAP パスワードが使用されます。 この場合、認証プラグインはまずルート DN とパスワードを資格証明として使用して LDAP サーバーにバインドし、クライアントユーザー名に基づいてユーザー DN を検索してから、LDAP パスワードに対してそのユーザー DN を認証します。 ルート DN およびパスワードが正しくない値に設定されているか、空 (設定されていない) で LDAP サーバーが匿名接続を許可していない場合、ルート資格証明を使用したこのバインドは失敗します。 
            </p></li></ul></div><p>
          LDAP サーバーが一致または複数の一致を検出しなかった場合、認証は失敗し、クライアント接続は拒否されます。
        </p><p>
          LDAP サーバーが単一の一致を検出した場合、LDAP 認証は成功し (パスワードが正しいと想定)、LDAP サーバーは LDAP エントリを返し、認証プラグインはそのエントリに基づいて認証されたユーザーの名前を決定します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              LDAP エントリにグループ属性 (デフォルトでは <code class="literal">cn</code> 属性) がある場合、プラグインはその値を認証されたユーザー名として返します。
            </p></li><li class="listitem"><p>
              LDAP エントリに group 属性がない場合、認証プラグインは、認証されたユーザー名としてクライアントユーザー名を返します。
            </p></li></ul></div><p>
          MySQL サーバーは、クライアントユーザー名と認証済ユーザー名を比較して、クライアントセッションでプロキシが発生するかどうかを判断します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              名前が同じ場合、プロキシは発生しません: クライアントユーザー名と一致する MySQL アカウントが権限チェックに使用されます。
            </p></li><li class="listitem"><p>
              名前が異なる場合、プロキシが発生: MySQL は、認証されたユーザー名と一致するアカウントを検索します。 そのアカウントはプロキシユーザーになり、権限チェックに使用されます。 クライアントユーザー名に一致する MySQL アカウントは、外部プロキシユーザーとして扱われます。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-installation"></a>LDAP プラガブル認証のインストール</h5></div></div></div><p>
          このセクションでは、LDAP 認証プラグインをインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
        </p><p>
          サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
        </p><p>
          サーバー側のプラグインライブラリファイルのベース名は、<code class="literal">authentication_ldap_simple</code> および <code class="literal">authentication_ldap_sasl</code> です。 ファイル名の接尾辞は、プラットフォームごとに異なります (たとえば、<code class="filename">.so</code> for Unix and Unix-like systems, <code class="filename">.dll</code> for Windows)。 
        </p><p>
          サーバーの起動時にプラグインをロードするには、<code class="option">--plugin-load-add</code> オプションを使用して、プラグインを含むライブラリファイルに名前を付けます。 このプラグインのロード方法では、サーバーが起動するたびにオプションを指定する必要があります。 また、構成するプラグイン提供のシステム変数の値を指定します。 
        </p><p>
          各サーバー側 LDAP プラグインは、その操作の構成を可能にする一連のシステム変数を公開します。 これらのほとんどはオプションですが、LDAP バインド操作の LDAP サーバーホストを指定する変数 (プラグインが接続先を認識できるようにするため)、およびベース識別名を設定する必要があります (検索の範囲を制限してより高速な検索を取得するため)。 すべての LDAP システム変数の詳細は、<a class="xref" href="security.html#pluggable-authentication-system-variables" title="6.4.1.11 プラガブル認証システム変数">セクション6.4.1.11「プラガブル認証システム変数」</a> を参照してください。 
        </p><p>
          プラグインをロードし、LDAP バインド操作の LDAP サーバーホストおよびベース識別名を設定するには、<code class="filename">my.cnf</code> ファイルに次のような行を入力し、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します:
        </p><pre class="programlisting">[mysqld]
plugin-load-add=authentication_ldap_simple.so
authentication_ldap_simple_server_host=127.0.0.1
authentication_ldap_simple_bind_base_dn="dc=example,dc=com"
plugin-load-add=authentication_ldap_sasl.so
authentication_ldap_sasl_server_host=127.0.0.1
authentication_ldap_sasl_bind_base_dn="dc=example,dc=com"
</pre><p>
          <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
        </p><p>
          または、実行時にプラグインをロードするには、次のステートメントを使用して、プラットフォームの <code class="filename">.so</code> 接尾辞を必要に応じて調整します:
        </p><pre class="programlisting">INSTALL PLUGIN authentication_ldap_simple
  SONAME 'authentication_ldap_simple.so';
INSTALL PLUGIN authentication_ldap_sasl
  SONAME 'authentication_ldap_sasl.so';
</pre><p>
          <code class="literal">INSTALL PLUGIN</code> はプラグインをただちにロードし、<code class="literal">mysql.plugins</code> システムテーブルにも登録して、<code class="option">--plugin-load-add</code> を必要とせずに後続の通常の起動のたびにサーバーがプラグインをロードするようにします。
        </p><p>
          実行時にプラグインをインストールすると、そのシステム変数が使用可能になり、それらの設定を <code class="filename">my.cnf</code> ファイルに追加して、その後の再起動のためにプラグインを構成できます。 例: 
        </p><pre class="programlisting">[mysqld]
authentication_ldap_simple_server_host=127.0.0.1
authentication_ldap_simple_bind_base_dn="dc=example,dc=com"
authentication_ldap_sasl_server_host=127.0.0.1
authentication_ldap_sasl_bind_base_dn="dc=example,dc=com"
</pre><p>
          <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
        </p><p>
          または、実行時に値を設定して永続化するには、次のステートメントを使用します:
        </p><pre class="programlisting">SET PERSIST authentication_ldap_simple_server_host='127.0.0.1';
SET PERSIST authentication_ldap_simple_bind_base_dn='dc=example,dc=com';
SET PERSIST authentication_ldap_sasl_server_host='127.0.0.1';
SET PERSIST authentication_ldap_sasl_bind_base_dn='dc=example,dc=com';
</pre><p>
          <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、値が保存され、その後のサーバーの再起動に引き継がれます。 後続の再起動に引き継ぐことなく、実行中の MySQL インスタンスの値を変更するには、<code class="literal">PERSIST</code> ではなく <code class="literal">GLOBAL</code> キーワードを使用します。 <a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a>を参照してください。 
        </p><p>
          プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%ldap%';</code></strong>
+----------------------------+---------------+
| PLUGIN_NAME                | PLUGIN_STATUS |
+----------------------------+---------------+
| authentication_ldap_sasl   | ACTIVE        |
| authentication_ldap_simple | ACTIVE        |
+----------------------------+---------------+
</pre><p>
          プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
        </p><p>
          MySQL アカウントを LDAP プラグインに関連付けるには、<a class="xref" href="security.html#ldap-pluggable-authentication-usage" title="LDAP プラガブル認証の使用">LDAP プラガブル認証の使用</a> を参照してください。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">SELinux の追加ノート</div><a class="indexterm" name="idm46723759243776"></a><p>
            SELinux が有効になっている EL6 または EL を実行しているシステムでは、MySQL LDAP プラグインが LDAP サービスと通信できるように SELinux ポリシーを変更する必要があります:
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                次の内容のファイル <code class="filename">mysqlldap.te</code> を作成します:
              </p><pre class="programlisting">module mysqlldap 1.0;

require {
        type ldap_port_t;
        type mysqld_t;
        class tcp_socket name_connect;
}

#============= mysqld_t ==============

allow mysqld_t ldap_port_t:tcp_socket name_connect;
</pre></li><li class="listitem"><p>
                セキュリティポリシーモジュールをバイナリ表現にコンパイルします:
              </p><pre class="programlisting">checkmodule -M -m mysqlldap.te -o mysqlldap.mod
</pre></li><li class="listitem"><p>
                SELinux ポリシーモジュールパッケージを作成します:
              </p><pre class="programlisting">semodule_package -m mysqlldap.mod  -o mysqlldap.pp
</pre></li><li class="listitem"><p>
                モジュールパッケージをインストールします:
              </p><pre class="programlisting">semodule -i mysqlldap.pp
</pre></li><li class="listitem"><p>
                SELinux ポリシーが変更されたら、MySQL サーバーを再起動します:
              </p><pre class="programlisting">service mysqld restart
</pre></li></ol></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-uninstallation"></a>LDAP プラガブル認証のアンインストール</h5></div></div></div><p>
          LDAP 認証プラグインのアンインストールに使用する方法は、インストール方法によって異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="option">--plugin-load-add</code> オプションを使用してサーバーの起動時にプラグインをインストールした場合は、それらのオプションを指定せずにサーバーを再起動します。
            </p></li><li class="listitem"><p>
              <code class="literal">INSTALL PLUGIN</code> を使用して実行時にプラグインをインストールした場合、それらはサーバーの再起動後もインストールされたままです。 これらをアンインストールするには、<code class="literal">UNINSTALL PLUGIN</code> を使用します: 
            </p><pre class="programlisting">UNINSTALL PLUGIN authentication_ldap_simple;
UNINSTALL PLUGIN authentication_ldap_sasl;
</pre></li></ul></div><p>
          また、LDAP プラグイン関連のシステム変数を設定する起動オプションを <code class="filename">my.cnf</code> ファイルから削除します。 <code class="literal">SET PERSIST</code> を使用して LDAP システム変数を永続化した場合は、<code class="literal">RESET PERSIST</code> を使用して設定を削除します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-ldap-conf"></a>LDAP プラガブル認証および ldap.conf</h5></div></div></div><a class="indexterm" name="idm46723759215536"></a><a class="indexterm" name="idm46723759214064"></a><p>
          OpenLDAP を使用するインストールの場合、<code class="filename">ldap.conf</code> ファイルは LDAP クライアントのグローバルデフォルトを提供します。 このファイルでオプションを設定して、LDAP 認証プラグインを含む LDAP クライアントに影響を与えることができます。 OpenLDAP では、次の優先順位で構成オプションが使用されます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              LDAP クライアントによって指定された構成。
            </p></li><li class="listitem"><p>
              <code class="filename">ldap.conf</code> ファイルで指定された構成。 このファイルの使用を無効にするには、<code class="literal">LDAPNOINIT</code> 環境変数を設定します。 
            </p><a class="indexterm" name="idm46723759206704"></a><a class="indexterm" name="idm46723759205200"></a></li><li class="listitem"><p>
              OpenLDAP ライブラリの組込みデフォルト。
            </p></li></ul></div><p>
          ライブラリのデフォルト値または <code class="filename">ldap.conf</code> 値で適切なオプション値が得られない場合は、LDAP 認証プラグインで関連する変数を設定して LDAP 構成に直接影響を与えることができます。 たとえば、LDAP プラグインは、次のようなパラメータの <code class="filename">ldap.conf</code> をオーバーライドできます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              TLS 構成: TLS を有効にして CA 構成を制御するためにシステム変数を使用できます。単純な LDAP 認証の場合は <code class="literal">authentication_ldap_simple_tls</code> および <code class="literal">authentication_ldap_simple_ca_path</code> など、および、SASL LDAP 認証の場合は <code class="literal">authentication_ldap_sasl_tls</code> および <code class="literal">authentication_ldap_sasl_ca_path</code> などです。
            </p></li><li class="listitem"><p>
              LDAP 参照。 <a class="xref" href="security.html#ldap-pluggable-authentication-ldap-referral" title="LDAP 検索照会">LDAP 検索照会</a>を参照してください。 
            </p></li></ul></div><p>
          <code class="filename">ldap.conf</code> の詳細は、<code class="literal">ldap.conf(5)</code> のマニュアルページを参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-usage"></a>LDAP プラガブル認証の使用</h5></div></div></div><p>
          このセクションでは、MySQL アカウントが LDAP プラガブル認証を使用して MySQL サーバーに接続できるようにする方法について説明します。 <a class="xref" href="security.html#ldap-pluggable-authentication-installation" title="LDAP プラガブル認証のインストール">LDAP プラガブル認証のインストール</a> で説明されているように、サーバーが適切なサーバー側プラグインを有効にして実行されており、適切なクライアント側プラグインがクライアントホストで使用可能であることを前提としています。 
        </p><p>
          このセクションでは、LDAP の構成または管理については説明しません。 これらのトピックを理解していることを前提としています。 
        </p><p>
          2 つのサーバー側 LDAP プラグインは、それぞれ特定のクライアント側プラグインで動作します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              サーバー側 <code class="literal">authentication_ldap_simple</code> プラグインは、単純な LDAP 認証を実行します。 このプラグインを使用するアカウントによる接続の場合、クライアントプログラムはクライアント側の <code class="literal">mysql_clear_password</code> プラグインを使用します。このプラグインは、パスワードをクリアテキストとしてサーバーに送信します。 パスワードのハッシュ化または暗号化は使用されないため、パスワードの公開を防ぐために、MySQL クライアントとサーバー間のセキュアな接続をお薦めします。 
            </p></li><li class="listitem"><p>
              サーバー側の <code class="literal">authentication_ldap_sasl</code> プラグインは、SASL ベースの LDAP 認証を実行します。 このプラグインを使用するアカウントによる接続の場合、クライアントプログラムはクライアント側の <code class="literal">authentication_ldap_sasl_client</code> プラグインを使用します。 クライアント側およびサーバー側 SASL LDAP プラグインは、SASL メッセージを使用して LDAP プロトコル内での資格証明のセキュアな転送を行い、MySQL クライアントとサーバー間でクリアテキストパスワードが送信されないようにします。 
            </p></li></ul></div><p>
          MySQL ユーザーの LDAP 認証の全体的な要件:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              認証されるユーザーごとに LDAP ディレクトリエントリが必要です。
            </p></li><li class="listitem"><p>
              サーバー側の LDAP 認証プラグインを指定し、オプションで関連する LDAP ユーザー識別名 (DN) を指定する MySQL ユーザーアカウントが必要です。 (LDAP ユーザー DN を MySQL アカウントに関連付けるには、アカウントを作成する <code class="literal">CREATE USER</code> ステートメントに <code class="literal">BY</code> 句を含めます。) アカウント名に LDAP 文字列がない場合、LDAP 認証はクライアントによって指定されたユーザー名を使用して LDAP エントリを検索します。 
            </p></li><li class="listitem"><p>
              クライアントプログラムは、MySQL アカウントが使用するサーバー側認証プラグインに適した接続方法を使用して接続します。 LDAP 認証の場合、接続には MySQL ユーザー名と LDAP パスワードが必要です。 また、サーバー側の <code class="literal">authentication_ldap_simple</code> プラグインを使用するアカウントの場合は、<code class="option">--enable-cleartext-plugin</code> オプションを指定してクライアントプログラムを呼び出し、クライアント側の <code class="literal">mysql_clear_password</code> プラグインを有効にします。 
            </p></li></ul></div><p>
          ここでの手順は、次のシナリオを前提としています:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MySQL ユーザー <code class="literal">betsy</code> および <code class="literal">boris</code> は、それぞれ <code class="literal">betsy_ldap</code> および <code class="literal">boris_ldap</code> の LDAP エントリに対して認証を行います。 (MySQL と LDAP のユーザー名が異なる必要はありません。 この説明で異なる名前を使用すると、操作コンテキストが MySQL か LDAP かを明確にするのに役立ちます。) 
            </p></li><li class="listitem"><p>
              LDAP エントリは、<code class="literal">uid</code> 属性を使用してユーザー名を指定します。 これは LDAP サーバーによって異なる場合があります。 一部の LDAP サーバーでは、<code class="literal">uid</code> ではなく <code class="literal">cn</code> 属性をユーザー名に使用します。 属性を変更するには、<code class="literal">authentication_ldap_simple_user_search_attr</code> または <code class="literal">authentication_ldap_sasl_user_search_attr</code> システム変数を適切に変更します。 
            </p></li><li class="listitem"><p>
              これらの LDAP エントリは、各ユーザーを一意に識別する識別名値を提供するために、LDAP サーバーによって管理されるディレクトリで使用できます:
            </p><pre class="programlisting">uid=betsy_ldap,ou=People,dc=example,dc=com
uid=boris_ldap,ou=People,dc=example,dc=com
</pre></li><li class="listitem"><p>
              MySQL アカウントを作成する <code class="literal">CREATE USER</code> ステートメントは、MySQL アカウントの認証対象となる LDAP エントリを示すために、<code class="literal">BY</code> 句で LDAP ユーザーを指定します。
            </p></li></ul></div><p>
          LDAP 認証を使用するアカウントを設定する手順は、使用するサーバー側 LDAP プラグインによって異なります。 次の各セクションでは、いくつかの使用シナリオについて説明します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-usage-simple"></a>簡易 LDAP 認証</h5></div></div></div><p>
          単純な LDAP 認証用に MySQL アカウントを構成するには、<code class="literal">CREATE USER</code> ステートメントで <code class="literal">authentication_ldap_simple</code> プラグインを指定し、オプションで LDAP ユーザー識別名 (DN) を指定します:
        </p><pre class="programlisting">CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_ldap_simple
  [BY '<em class="replaceable"><code>LDAP user DN</code></em>'];
</pre><p>
          MySQL ユーザー <code class="literal">betsy</code> の LDAP ディレクトリに次のエントリがあるとします:
        </p><pre class="programlisting">uid=betsy_ldap,ou=People,dc=example,dc=com
</pre><p>
          その後、<code class="literal">betsy</code> の MySQL アカウントを作成するステートメントは次のようになります:
        </p><pre class="programlisting">CREATE USER 'betsy'@'localhost'
  IDENTIFIED WITH authentication_ldap_simple
  AS 'uid=betsy_ldap,ou=People,dc=example,dc=com';
</pre><p>
          <code class="literal">BY</code> 句で指定された認証文字列に LDAP パスワードが含まれていません。 これは、接続時にクライアントユーザーが指定する必要があります。 
        </p><p>
          クライアントは、MySQL ユーザー名と LDAP パスワードを指定し、クライアント側の <code class="literal">mysql_clear_password</code> プラグインを有効にすることによって、MySQL サーバーに接続します:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=betsy --password --enable-cleartext-plugin</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>betsy_password</code></em></code></strong> <em class="replaceable"><code>(betsy_ldap LDAP password)</code></em>
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            クライアント側の <code class="literal">mysql_clear_password</code> 認証プラグインでは、パスワードはそのまま残されるため、クライアントプログラムはクリアテキストとして MySQL サーバーに送信します。 これにより、パスワードをそのまま LDAP サーバーに渡すことができます。 SASL なしでサーバー側 LDAP ライブラリを使用するにはクリアテキストパスワードが必要ですが、一部の構成でセキュリティの問題が発生する可能性があります。 これらのメジャーにより、リスクが最小限に抑えられます: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">mysql_clear_password</code> プラグインを誤って使用する可能性を低くするには、MySQL クライアントで明示的に有効にする必要があります (たとえば、<code class="option">--enable-cleartext-plugin</code> オプションを使用)。 <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 クライアント側クリアテキストプラガブル認証">セクション6.4.1.4「クライアント側クリアテキストプラガブル認証」</a>を参照してください。 
              </p></li><li class="listitem"><p>
                <code class="literal">mysql_clear_password</code> プラグインを有効にしてパスワードの公開を回避するには、MySQL クライアントは暗号化された接続を使用して MySQL サーバーに接続する必要があります。 <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 暗号化接続を使用するための MySQL の構成">セクション6.3.1「暗号化接続を使用するための MySQL の構成」</a>を参照してください。 
              </p></li></ul></div></div><p>
          認証プロセスは次のように実行されます:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              クライアント側プラグインは、<code class="literal">betsy</code> および <em class="replaceable"><code>betsy_password</code></em> をクライアントユーザー名および LDAP パスワードとして MySQL サーバーに送信します。
            </p></li><li class="listitem"><p>
              接続試行は<code class="literal">'betsy'@'localhost'</code>アカウントと一致します。 サーバー側 LDAP プラグインは、このアカウントに、LDAP ユーザー DN を指定するための<code class="literal">'uid=betsy_ldap,ou=People,dc=example,dc=com'</code>の認証文字列があることを検出します。 プラグインは、この文字列と LDAP パスワードを LDAP サーバーに送信します。 
            </p></li><li class="listitem"><p>
              LDAP サーバーは <code class="literal">betsy_ldap</code> の LDAP エントリを検出し、パスワードが一致するため、LDAP 認証は成功します。
            </p></li><li class="listitem"><p>
              LDAP エントリにはグループ属性がないため、サーバー側プラグインは認証されたユーザーとしてクライアントユーザー名 (<code class="literal">betsy</code>) を返します。 これはクライアントによって提供されるユーザー名と同じであるため、プロキシは発生せず、クライアントセッションは権限チェックに<code class="literal">'betsy'@'localhost'</code>アカウントを使用します。 
            </p></li></ol></div><p>
          一致する LDAP エントリにグループ属性が含まれている場合、その属性値は認証されたユーザー名になり、値が <code class="literal">betsy</code> と異なる場合はプロキシが発生します。 group 属性の使用例については、<a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="プロキシを使用した LDAP 認証">プロキシを使用した LDAP 認証</a> を参照してください。 
        </p><p>
          <code class="literal">betsy_ldap</code> LDAP 識別名を指定する <code class="literal">BY</code> 句が <code class="literal">CREATE USER</code> ステートメントに含まれていない場合、認証の試行ではクライアントによって提供されたユーザー名 (この場合は <code class="literal">betsy</code>) が使用されます。 <code class="literal">betsy</code> の LDAP エントリがない場合、認証は失敗します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-usage-sasl"></a>SASL ベースの LDAP 認証</h5></div></div></div><p>
          SASL LDAP 認証用に MySQL アカウントを構成するには、<code class="literal">CREATE USER</code> ステートメントで <code class="literal">authentication_ldap_sasl</code> プラグインを指定し、オプションで LDAP ユーザー識別名 (DN) を指定します:
        </p><pre class="programlisting">CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_ldap_sasl
  [BY '<em class="replaceable"><code>LDAP user DN</code></em>'];
</pre><p>
          MySQL ユーザー <code class="literal">boris</code> の LDAP ディレクトリに次のエントリがあるとします:
        </p><pre class="programlisting">uid=boris_ldap,ou=People,dc=example,dc=com
</pre><p>
          その後、<code class="literal">boris</code> の MySQL アカウントを作成するステートメントは次のようになります:
        </p><pre class="programlisting">CREATE USER 'boris'@'localhost'
  IDENTIFIED WITH authentication_ldap_sasl
  AS 'uid=boris_ldap,ou=People,dc=example,dc=com';
</pre><p>
          <code class="literal">BY</code> 句で指定された認証文字列に LDAP パスワードが含まれていません。 これは、接続時にクライアントユーザーが指定する必要があります。 
        </p><p>
          クライアントは、MySQL ユーザー名と LDAP パスワードを指定して MySQL サーバーに接続します:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=boris --password</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>boris_password</code></em></code></strong> <em class="replaceable"><code>(boris_ldap LDAP password)</code></em>
</pre><p>
          サーバー側 <code class="literal">authentication_ldap_sasl</code> プラグインの場合、クライアントはクライアント側 <code class="literal">authentication_ldap_sasl_client</code> プラグインを使用します。 クライアントプログラムがクライアント側プラグインを見つけられない場合は、プラグインライブラリファイルがインストールされているディレクトリの名前を指定する <code class="option">--plugin-dir</code> オプションを指定します。 
        </p><p>
          <code class="literal">boris</code> の認証プロセスは、クライアント側とサーバー側の SASL LDAP プラグインが SASL メッセージを使用して LDAP プロトコル内の資格証明をセキュアに送信し、MySQL クライアントとサーバー間のクリアテキストパスワードの送信を回避する点を除き、単純な LDAP 認証を使用した <code class="literal">betsy</code> の場合と同様です。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-usage-proxying"></a>プロキシを使用した LDAP 認証</h5></div></div></div><a class="indexterm" name="idm46723759087024"></a><p>
          LDAP 認証プラグインはプロキシをサポートしているため、ユーザーはあるユーザーとして MySQL サーバーに接続できますが、別のユーザーの権限を引き受けます。 このセクションでは、LDAP プラグインの基本的なプロキシサポートについて説明します。 LDAP プラグインは、グループプリファレンスおよびプロキシユーザーマッピングの指定もサポートしています。<a class="xref" href="security.html#ldap-pluggable-authentication-usage-group-mapping" title="LDAP 認証グループプリファレンスとマッピングの指定">LDAP 認証グループプリファレンスとマッピングの指定</a> を参照してください。 
        </p><p>
          ここで説明するプロキシ実装は、LDAP を使用して認証する MySQL ユーザーを、様々な権限セットを定義する他の MySQL アカウントにマップするための LDAP グループ属性値の使用に基づいています。 ユーザーは、権限を定義するアカウントを使用して直接接続しません。 かわりに、すべての外部ログインが権限を保持するプロキシ MySQL アカウントにマップされるように、LDAP で認証されたデフォルトのプロキシアカウントを介して接続します。 プロキシアカウントを使用して接続するユーザーは、プロキシ設定された MySQL アカウントのいずれか (外部ユーザーに許可されるデータベース操作を決定する権限) にマップされます。 
        </p><p>
          ここでの手順は、次のシナリオを前提としています:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              LDAP エントリは、<code class="literal">uid</code> 属性と <code class="literal">cn</code> 属性を使用して、それぞれユーザー名とグループ値を指定します。 異なるユーザーおよびグループ属性名を使用するには、適切なプラグイン固有のシステム変数を設定します: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">authentication_ldap_simple</code> プラグインの場合: <code class="literal">authentication_ldap_simple_user_search_attr</code> および <code class="literal">authentication_ldap_simple_group_search_attr</code> を設定します。
                </p></li><li class="listitem"><p>
                  <code class="literal">authentication_ldap_sasl</code> プラグインの場合: <code class="literal">authentication_ldap_sasl_user_search_attr</code> および <code class="literal">authentication_ldap_sasl_group_search_attr</code> を設定します。
                </p></li></ul></div></li><li class="listitem"><p>
              これらの LDAP エントリは、各ユーザーを一意に識別する識別名値を提供するために、LDAP サーバーによって管理されるディレクトリで使用できます:
            </p><pre class="programlisting">uid=basha,ou=People,dc=example,dc=com,cn=accounting
uid=basil,ou=People,dc=example,dc=com,cn=front_office
</pre><p>
              接続時に、グループ属性値は認証されたユーザー名になるため、<code class="literal">accounting</code> および <code class="literal">front_office</code> プロキシアカウントに名前が付けられます。
            </p></li><li class="listitem"><p>
              この例では、SASL LDAP 認証を使用することを前提としています。 単純な LDAP 認証に対して適切な調整を行います。 
            </p></li></ul></div><p>
          デフォルトのプロキシ MySQL アカウントを作成します:
        </p><pre class="programlisting">CREATE USER ''@'%'
  IDENTIFIED WITH authentication_ldap_sasl;
</pre><p>
          プロキシアカウント定義には、LDAP ユーザー DN を指定する <code class="literal">AS '<em class="replaceable"><code>auth_string</code></em>'</code>句がありません。 したがって、次のようになります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              クライアントが接続すると、クライアントユーザー名が検索対象の LDAP ユーザー名になります。
            </p></li><li class="listitem"><p>
              一致する LDAP エントリには、クライアントが保持する必要がある権限を定義するプロキシ設定された MySQL アカウントを指定するグループ属性が含まれている必要があります。
            </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            MySQL インストールに匿名ユーザーが含まれている場合、デフォルトのプロキシユーザーと競合する可能性があります。 この問題とその対処方法の詳細は、<a class="xref" href="security.html#proxy-users-conflicts" title="デフォルトのプロキシユーザーと匿名ユーザーの競合">デフォルトのプロキシユーザーと匿名ユーザーの競合</a> を参照してください。 
          </p></div><p>
          プロキシ設定されたアカウントを作成し、各アカウントに次の権限を付与します:
        </p><pre class="programlisting">CREATE USER 'accounting'@'localhost'
  IDENTIFIED WITH mysql_no_login;
CREATE USER 'front_office'@'localhost'
  IDENTIFIED WITH mysql_no_login;

GRANT ALL PRIVILEGES
  ON accountingdb.*
  TO 'accounting'@'localhost';
GRANT ALL PRIVILEGES
  ON frontdb.*
  TO 'front_office'@'localhost';
</pre><p>
          プロキシ設定されたアカウントは、<code class="literal">mysql_no_login</code> 認証プラグインを使用して、クライアントがアカウントを使用して MySQL サーバーに直接ログインできないようにします。 かわりに、LDAP を使用して認証するユーザーは、デフォルトの<code class="literal">''@'%'</code>プロキシアカウントを使用する必要があります。 (これは、<code class="literal">mysql_no_login</code> プラグインがインストールされていることを前提としています。 手順については、<a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 ログインなしのプラガブル認証">セクション6.4.1.8「ログインなしのプラガブル認証」</a> を参照してください。) プロキシ設定されたアカウントを直接使用しないように保護する別の方法については、<a class="xref" href="security.html#preventing-proxied-account-direct-login" title="プロキシアカウントへの直接ログインの防止">プロキシアカウントへの直接ログインの防止</a> を参照してください。 
        </p><p>
          プロキシされた各アカウントの <code class="literal">PROXY</code> 権限をプロキシアカウントに付与します:
        </p><pre class="programlisting">GRANT PROXY
  ON 'accounting'@'localhost'
  TO ''@'%';
GRANT PROXY
  ON 'front_office'@'localhost'
  TO ''@'%';
</pre><p>
          <span class="command"><strong>mysql</strong></span> コマンドラインクライアントを使用して、<code class="literal">basha</code> として MySQL サーバーに接続します。
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=basha --password</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>basha_password</code></em></code></strong> <em class="replaceable"><code>(basha LDAP password)</code></em>
</pre><p>
          認証は次のように行われます:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              サーバーは、クライアントユーザー <code class="literal">basha</code> のデフォルトの<code class="literal">''@'%'</code>プロキシアカウントを使用して接続を認証します。
            </p></li><li class="listitem"><p>
              一致する LDAP エントリは次のとおりです:
            </p><pre class="programlisting">uid=basha,ou=People,dc=example,dc=com,cn=accounting
</pre></li><li class="listitem"><p>
              一致する LDAP エントリにはグループ属性 <code class="literal">cn=accounting</code> があるため、<code class="literal">accounting</code> が認証済プロキシユーザーになります。
            </p></li><li class="listitem"><p>
              認証されたユーザーはクライアントユーザー名 <code class="literal">basha</code> とは異なりますが、その結果、<code class="literal">basha</code> は <code class="literal">accounting</code> のプロキシとして扱われ、<code class="literal">basha</code> はプロキシされた <code class="literal">accounting</code> アカウントの権限を引き継ぎます。 次のクエリーは、次に示すような出力を返します: 
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-----------------+----------------------+--------------+
| USER()          | CURRENT_USER()       | @@proxy_user |
+-----------------+----------------------+--------------+
| basha@localhost | accounting@localhost | ''@'%'       |
+-----------------+----------------------+--------------+
</pre></li></ol></div><p>
          これは、<code class="literal">basha</code> がプロキシ設定された <code class="literal">accounting</code> MySQL アカウントに付与された権限を使用し、プロキシ設定がデフォルトのプロキシユーザーアカウントを介して行われることを示しています。
        </p><p>
          かわりに、<code class="literal">basil</code> として接続します:
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=basil --password</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>basil_password</code></em></code></strong> <em class="replaceable"><code>(basil LDAP password)</code></em>
</pre><p>
          <code class="literal">basil</code> の認証プロセスは、前述の <code class="literal">basha</code> の認証プロセスと似ています:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              サーバーは、クライアントユーザー <code class="literal">basil</code> のデフォルトの<code class="literal">''@'%'</code>プロキシアカウントを使用して接続を認証します。
            </p></li><li class="listitem"><p>
              一致する LDAP エントリは次のとおりです:
            </p><pre class="programlisting">uid=basil,ou=People,dc=example,dc=com,cn=front_office
</pre></li><li class="listitem"><p>
              一致する LDAP エントリにはグループ属性 <code class="literal">cn=front_office</code> があるため、<code class="literal">front_office</code> が認証済プロキシユーザーになります。
            </p></li><li class="listitem"><p>
              認証されたユーザーはクライアントユーザー名 <code class="literal">basil</code> とは異なりますが、その結果、<code class="literal">basil</code> は <code class="literal">front_office</code> のプロキシとして扱われ、<code class="literal">basil</code> はプロキシされた <code class="literal">front_office</code> アカウントの権限を引き継ぎます。 次のクエリーは、次に示すような出力を返します: 
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-----------------+------------------------+--------------+
| USER()          | CURRENT_USER()         | @@proxy_user |
+-----------------+------------------------+--------------+
| basil@localhost | front_office@localhost | ''@'%'       |
+-----------------+------------------------+--------------+
</pre></li></ol></div><p>
          これは、<code class="literal">basil</code> がプロキシ設定された <code class="literal">front_office</code> MySQL アカウントに付与された権限を使用し、プロキシ設定がデフォルトのプロキシユーザーアカウントを介して行われることを示しています。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-usage-group-mapping"></a>LDAP 認証グループプリファレンスとマッピングの指定</h5></div></div></div><a class="indexterm" name="idm46723758999536"></a><a class="indexterm" name="idm46723758997360"></a><p>
          <a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="プロキシを使用した LDAP 認証">プロキシを使用した LDAP 認証</a> で説明されているように、基本的な LDAP 認証プロキシは、LDAP サーバーから返された最初のグループ名を MySQL プロキシユーザーアカウント名としてプラグインが使用する原則によって機能します。 この単純な機能では、LDAP サーバーが複数のグループ名を返す場合、またはプロキシユーザー名としてグループ名以外の名前を指定する場合、使用するグループ名に関するプリファレンスを指定できません。 
        </p><p>
          MySQL 8.0.14 では、LDAP 認証を使用する MySQL アカウントの場合、認証文字列で次の情報を指定して、プロキシの柔軟性を高めることができます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              プラグインが LDAP サーバーから返されたグループと一致するリスト内の最初のグループ名を使用するように、優先順位の高いグループのリスト。
            </p></li><li class="listitem"><p>
              グループ名からプロキシ設定されたユーザー名へのマッピング。これにより、一致したグループ名は、プロキシ設定されたユーザーとして使用するために指定された名前を提供できます。 これにより、プロキシユーザーとしてグループ名を使用するかわりに使用できます。 
            </p></li></ul></div><p>
          次の MySQL プロキシアカウント定義について考えてみます:
        </p><pre class="programlisting">CREATE USER ''@'%'
  IDENTIFIED WITH authentication_ldap_sasl
  AS '+ou=People,dc=example,dc=com#grp1=usera,grp2,grp3=userc';
</pre><p>
          認証文字列には、<code class="literal">+</code> 文字が接頭辞として付いたユーザー DN 接尾辞 <code class="literal">ou=People,dc=example,dc=com</code> があります。 したがって、<a class="xref" href="security.html#ldap-pluggable-authentication-usage-user-dn-suffix" title="LDAP 認証ユーザー DN 接尾辞">LDAP 認証ユーザー DN 接尾辞</a> で説明されているように、完全なユーザー DN は、指定されたユーザー DN 接尾辞と、<code class="literal">uid</code> 属性としてのクライアントユーザー名から構成されます。 
        </p><p>
          認証文字列の残りの部分は、グループプリファレンスおよびマッピング情報の開始を示す<code class="literal">#</code>で始まります。 認証文字列のこの部分には、グループ名が <code class="literal">grp1</code>, <code class="literal">grp2</code>, <code class="literal">grp3</code> の順序でリストされます。 LDAP プラグインは、そのリストを LDAP サーバーから返されたグループ名のセットと比較し、リストの順序で返された名前との一致を探します。 プラグインは最初の一致を使用します。一致するものがない場合、認証は失敗します。 
        </p><p>
          LDAP サーバーがグループ <code class="literal">grp3</code>、<code class="literal">grp2</code> および <code class="literal">grp7</code> を返すとします。 LDAP プラグインは、LDAP サーバーによって返される最初のグループではなくても、一致する認証文字列の最初のグループであるため、<code class="literal">grp2</code> を使用します。 LDAP サーバーが <code class="literal">grp4</code>、<code class="literal">grp2</code> および <code class="literal">grp1</code> を返す場合、<code class="literal">grp2</code> も一致していても、プラグインは <code class="literal">grp1</code> を使用します。<code class="literal">grp1</code> は、認証文字列の前半にリストされているため、<code class="literal">grp2</code> よりも優先されます。 
        </p><p>
          プラグインは、一致するグループ名を検出すると、そのグループ名から MySQL プロキシユーザー名へのマッピングを実行します (存在する場合)。 プロキシアカウントの例では、マッピングは次のように行われます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              一致するグループ名が <code class="literal">grp1</code> または <code class="literal">grp3</code> の場合、それらは認証文字列内でユーザー名 <code class="literal">usera</code> および <code class="literal">userc</code> にそれぞれ関連付けられます。 プラグインは、対応する関連ユーザー名をプロキシユーザー名として使用します。 
            </p></li><li class="listitem"><p>
              一致するグループ名が <code class="literal">grp2</code> の場合、認証文字列に関連付けられたユーザー名はありません。 プラグインは、プロキシユーザー名として <code class="literal">grp2</code> を使用します。 
            </p></li></ul></div><p>
          LDAP サーバーが DN 形式でグループを返す場合、LDAP プラグインはグループ DN を解析してグループ名を抽出します。
        </p><p>
          LDAP グループプリファレンスおよびマッピング情報を指定するには、次の原則が適用されます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              グループプリファレンスおよび認証文字列のマッピング部分を<code class="literal">#</code>接頭辞文字で開始します。
            </p></li><li class="listitem"><p>
              グループプリファレンスとマッピングの指定は、カンマで区切られた 1 つ以上のアイテムのリストです。 各アイテムの形式は、<code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>user_name</code></em></code> または <em class="replaceable"><code>group_name</code></em> です。 アイテムは、グループ名のプリファレンス順にリストする必要があります。 LDAP サーバーによって返されるグループ名のセットと一致するものとしてプラグインによって選択されたグループ名の場合、次の 2 つの構文が有効に異なります: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>user_name</code></em></code> (ユーザー名付き) として指定されたアイテムの場合、グループ名は MySQL プロキシユーザー名として使用されるユーザー名にマップされます。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>group_name</code></em> (ユーザー名なし) として指定されたアイテムの場合、グループ名は MySQL プロキシユーザー名として使用されます。
                </p></li></ul></div></li><li class="listitem"><p>
              スペースなどの特殊文字を含むグループまたはユーザー名を引用符で囲むには、二重引用符 (<code class="literal">"</code>) 文字で囲みます。 たとえば、アイテムのグループ名とユーザー名が <code class="literal">my group name</code> および <code class="literal">my user name</code> の場合は、引用符を使用してグループマッピングに記述する必要があります: 
            </p><pre class="programlisting">"my group name"="my user name"
</pre><p>
              アイテムに <code class="literal">my_group_name</code> および <code class="literal">my_user_name</code> のグループ名およびユーザー名 (特殊文字を含まない) がある場合、引用符を使用して記述する必要はありません。 次のいずれかが有効です: 
            </p><pre class="programlisting">my_group_name=my_user_name
my_group_name="my_user_name"
"my_group_name"=my_user_name
"my_group_name"="my_user_name"
</pre></li><li class="listitem"><p>
              文字をエスケープするには、その前にバックスラッシュ (<code class="literal">\</code>) を付けます。 これは、リテラルの二重引用符またはバックスラッシュを含める場合に特に便利です。それ以外の場合は、リテラルの二重引用符またはバックスラッシュは含まれません。 
            </p></li><li class="listitem"><p>
              ユーザー DN は認証文字列に存在する必要はありませんが、存在する場合は、グループプリファレンスおよびマッピング部分の前に存在する必要があります。 ユーザー DN は、完全なユーザー DN または <code class="literal">+</code> 接頭辞文字を含むユーザー DN 接尾辞として指定できます。 (<a class="xref" href="security.html#ldap-pluggable-authentication-usage-user-dn-suffix" title="LDAP 認証ユーザー DN 接尾辞">LDAP 認証ユーザー DN 接尾辞</a>を参照してください。) 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-usage-user-dn-suffix"></a>LDAP 認証ユーザー DN 接尾辞</h5></div></div></div><p>
          LDAP 認証プラグインでは、ユーザー DN 情報を提供する認証文字列を <code class="literal">+</code> 接頭辞文字で始めることができます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">+</code> 文字がない場合、認証文字列値は変更されずにそのまま処理されます。
            </p></li><li class="listitem"><p>
              認証文字列が <code class="literal">+</code> で始まる場合、プラグインは、(<code class="literal">+</code> を削除して) 認証文字列で指定された DN とともに、クライアントによって送信されたユーザー名から完全なユーザー DN 値を構成します。 構築された DN では、クライアントユーザー名は LDAP ユーザー名を指定する属性の値になります。 これはデフォルトでは <code class="literal">uid</code> です。属性を変更するには、適切なシステム変数 (<code class="literal">authentication_ldap_simple_user_search_attr</code> または <code class="literal">authentication_ldap_sasl_user_search_attr</code>) を変更します。 認証文字列は、<code class="literal">mysql.user</code> システムテーブルに指定されているとおりに格納され、完全なユーザー DN は認証前に即時に構成されます。 
            </p></li></ul></div><p>
          このアカウント認証文字列の先頭には <code class="literal">+</code> がないため、完全なユーザー DN とみなされます:
        </p><pre class="programlisting">CREATE USER 'baldwin'
  IDENTIFIED WITH authentication_ldap_simple
  AS 'uid=admin,ou=People,dc=example,dc=com';
</pre><p>
          クライアントは、アカウント (<code class="literal">baldwin</code>) で指定されたユーザー名で接続します。 この場合、認証文字列に接頭辞がなく、ユーザー DN を完全に指定するため、その名前は使用されません。 
        </p><p>
          このアカウント認証文字列の先頭には <code class="literal">+</code> があるため、ユーザー DN の一部として取得されます:
        </p><pre class="programlisting">CREATE USER 'accounting'
  IDENTIFIED WITH authentication_ldap_simple
  AS '+ou=People,dc=example,dc=com';
</pre><p>
          クライアントは、アカウント (<code class="literal">accounting</code>) で指定されたユーザー名で接続します。この場合、ユーザー DN を構成するための認証文字列とともに <code class="literal">uid</code> 属性として使用されます: <code class="literal">uid=accounting,ou=People,dc=example,dc=com</code>
        </p><p>
          前述の例のアカウントには空でないユーザー名が含まれているため、クライアントは常にアカウント定義で指定されたのと同じ名前を使用して MySQL サーバーに接続します。 <a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="プロキシを使用した LDAP 認証">プロキシを使用した LDAP 認証</a> で説明されているデフォルトの匿名<code class="literal">''@'%'</code>プロキシアカウントなど、アカウントのユーザー名が空の場合、クライアントは様々なユーザー名で MySQL サーバーに接続することがあります。 ただし、原則は同じです: 認証文字列が <code class="literal">+</code> で始まる場合、プラグインはクライアントから送信されたユーザー名と認証文字列を使用してユーザー DN を構築します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-auth-methods"></a>LDAP 認証方式</h5></div></div></div><p>
          LDAP 認証プラグインは、構成可能な認証方式を使用します。 適切なシステム変数および使用可能なメソッドの選択肢は、プラグイン固有です: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">authentication_ldap_simple</code> プラグインの場合: メソッドを構成するには、<code class="literal">authentication_ldap_simple_auth_method_name</code> システム変数を設定します。 許可される選択肢は、<code class="literal">SIMPLE</code> および <code class="literal">AD-FOREST</code> です。 
            </p></li><li class="listitem"><p>
              <code class="literal">authentication_ldap_sasl</code> プラグインの場合: メソッドを構成するには、<code class="literal">authentication_ldap_sasl_auth_method_name</code> システム変数を設定します。 許可される選択肢は、<code class="literal">SCRAM-SHA-1</code>、<code class="literal">SCRAM-SHA-256</code> および <code class="literal">GSSAPI</code> です。 (ホストシステムで実際に使用可能な SASL LDAP メソッドを判別するには、<code class="literal">Authentication_ldap_sasl_supported_methods</code> ステータス変数の値を確認します。) 
            </p></li></ul></div><p>
          許可される各メソッドの詳細は、システム変数の説明を参照してください。 また、方法によっては、次の各セクションで説明するように、追加の構成が必要になる場合があります。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-gssapi"></a>GSSAPI/Kerberos 認証方式</h5></div></div></div><a class="indexterm" name="idm46723758898592"></a><a class="indexterm" name="idm46723758896464"></a><a class="indexterm" name="idm46723758894400"></a><a class="indexterm" name="idm46723758892336"></a><p>
          Generic Security Service Application Program Interface (GSSAPI) は、セキュリティ抽象化インタフェースです。 Kerberos は、その抽象インタフェースを介して使用できる特定のセキュリティプロトコルのインスタンスです。 GSSAPI を使用すると、アプリケーションは Kerberos に対して認証を行い、サービス資格を取得してから、それらの資格を使用してほかのサービスへのセキュアなアクセスを有効にします。 
        </p><p>
          そのようなサービスの 1 つは LDAP で、クライアント側とサーバー側の SASL LDAP 認証プラグインによって使用されます。 <code class="literal">authentication_ldap_sasl_auth_method_name</code> システム変数が <code class="literal">GSSAPI</code> に設定されている場合、これらのプラグインは GSSAPI/Kerberos 認証方式を使用します。 この場合、プラグインは LDAP メッセージを直接使用せずに Kerberos を使用して安全に通信します。 次に、サーバー側プラグインは LDAP サーバーと通信して、LDAP 認証メッセージを解釈し、LDAP グループを取得します。 
        </p><p>
          GSSAPI/Kerberos は、Linux 上の MySQL クライアントおよびサーバーの認証方式としてのみサポートされます。 これは、Kerberos がデフォルトで有効になっている Microsoft Active Directory を使用してアプリケーションが LDAP にアクセスする Linux 環境で役立ちます。 
        </p><p>
          次の説明では、GSSAPI メソッドを使用するための構成要件について説明します。 次の一般的な Kerberos 用語など、Kerberos の概念および操作に精通していることを前提としています: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              プリンシパル = ユーザーやサービスなどの名前付きエンティティ。
            </p></li><li class="listitem"><p>
              KDC = AS および TGS で構成されるキー配布センター。
            </p></li><li class="listitem"><p>
              AS = KDC の一部である認証サーバー。 TGT の取得に必要な初期チケットを提供します。 
            </p></li><li class="listitem"><p>
              TGS = KDC の一部であるチケット認可サービス。
            </p></li><li class="listitem"><p>
              TGT = チケット認可チケット。TGS に提示され、サービスアクセス用のサービスチケットを取得します。
            </p></li></ul></div><p>
          Kerberos 認証には KDC サーバーと LDAP サーバーの両方が必要です。 この要件は、様々な方法で満たすことができます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Active Directory には両方のサーバーが含まれており、Kerberos 認証は Active Directory LDAP サーバーでデフォルトで有効になっています。
            </p></li><li class="listitem"><p>
              OpenLDAP には LDAP サーバーが用意されていますが、別の KDC サーバーが必要になる場合があり、追加の Kerberos 設定が必要です。
            </p></li></ul></div><p>
          Kerberos はクライアントホストでも使用可能である必要があります。 クライアントは、TGT を取得するためにパスワードを使用して AS に接続します。 その後、クライアントは TGT を使用して TGS から LDAP などの他のサービスへのアクセスを取得します。 
        </p><p>
          次のセクションでは、MySQL で SASL LDAP 認証に GSSAPI/Kerberos を使用するための構成ステップについて説明します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#ldap-gssapi-kerberos-setup" title="Kerberos 設定の確認">Kerberos 設定の確認</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-gssapi-ldap-setup" title="GSSAPI/Kerberos 用のサーバー側 SASL LDAP 認証プラグインの構成">GSSAPI/Kerberos 用のサーバー側 SASL LDAP 認証プラグインの構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-gssapi-mysql-account-setup" title="GSSAPI/Kerberos を使用する MySQL アカウントの作成">GSSAPI/Kerberos を使用する MySQL アカウントの作成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-gssapi-mysql-client-usage" title="MySQL アカウントを使用した MySQL Server への接続">MySQL アカウントを使用した MySQL Server への接続</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-gssapi-mysql-client-krb5-conf" title="/etc/krb5.conf クライアント構成パラメータ">/etc/krb5.conf クライアント構成パラメータ</a></p></li></ul></div><h6><a name="ldap-gssapi-kerberos-setup"></a>Kerberos 設定の確認</h6><p>
          次の例は、Active Directory で Kerberos の可用性をテストする方法を示しています。 この例では、次のことを想定しています: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Active Directory は、IP アドレス <code class="literal">198.51.100.10</code> の <code class="literal">ldap_auth.example.com</code> という名前のホストで実行されています。
            </p></li><li class="listitem"><p>
              <code class="literal">MYSQL.LOCAL</code> ドメインは、MySQL-related Kerberos 認証および LDAP 検索に使用されます。
            </p></li><li class="listitem"><p>
              <code class="literal">bredon@MYSQL.LOCAL</code> という名前の主体が KDC に登録されます。 (後で説明しますが、このプリンシパル名は GSSAPI/Kerberos を使用して MySQL サーバーに対する認証を行う MySQL ユーザーにも使用されます。) 
            </p></li></ul></div><p>
          これらの前提条件を満たしている場合は、次の手順に従います:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Kerberos ライブラリがオペレーティングシステムに正しくインストールおよび構成されていることを確認します。 たとえば、MySQL 認証中に使用する <code class="literal">MYSQL.LOCAL</code> ドメインを構成するには、Kerberos 構成ファイル<code class="filename">/etc/krb5.conf</code> に次のような内容を含める必要があります: 
            </p><a class="indexterm" name="idm46723758855040"></a><a class="indexterm" name="idm46723758852864"></a><pre class="programlisting">[realms]
  MYSQL.LOCAL = {
    kdc = ldap_auth.example.com
    admin_server = ldap_auth.example.com
    default_domain = MYSQL.LOCAL
  }
</pre></li><li class="listitem"><p>
              サーバーホストの<code class="filename">/etc/hosts</code> にエントリを追加する必要がある場合があります:
            </p><pre class="programlisting">198.51.100.10 ldap_auth ldap_auth.example.com
</pre></li><li class="listitem"><p>
              Kerberos 認証が正しく機能するかどうかを確認します:
            </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
                  <span class="command"><strong>kinit</strong></span> を使用して、Kerberos に対する認証を行います:
                </p><pre class="programlisting">kinit bredon@MYSQL.LOCAL
</pre><p>
                  このコマンドは、<code class="literal">bredon@MYSQL.LOCAL</code> という名前の Kerberos 主体の認証を行います。 入力を求めるプロンプトが表示されたら、プリンシパルパスワードを入力します。 KDC は、ほかの Kerberos-aware アプリケーションで使用するためにクライアント側にキャッシュされた TGT を返します。 
                </p></li><li class="listitem"><p>
                  <span class="command"><strong>klist</strong></span> を使用して TGT が正しく取得されたかどうかを確認します。 出力は次のようになります: 
                </p><pre class="programlisting">Ticket cache: FILE:/tmp/krb5cc_244306
Default principal: bredon@MYSQL.LOCAL

Valid starting       Expires              Service principal
03/23/2020 08:18:33  03/23/2020 18:18:33  krbtgt/MYSQL.LOCAL@MYSQL.LOCAL
</pre></li></ol></div></li><li class="listitem"><p>
              <code class="literal">MYSQL.LOCAL</code> ドメイン内のユーザーを検索する次のコマンドを使用して、<span class="command"><strong>ldapsearch</strong></span> が Kerberos TGT と連携するかどうかを確認します:
            </p><pre class="programlisting">ldapsearch -h 198.51.100.10 -Y GSSAPI -b "dc=MYSQL,dc=LOCAL"
</pre></li></ol></div><h6><a name="ldap-gssapi-ldap-setup"></a>GSSAPI/Kerberos 用のサーバー側 SASL LDAP 認証プラグインの構成</h6><p>
          前述のように、LDAP サーバーが Kerberos を介してアクセス可能であると仮定して、GSSAPI/Kerberos 認証方式を使用するようにサーバー側 SASL LDAP 認証プラグインを構成します。 (LDAP プラグインの一般的なインストール情報については、<a class="xref" href="security.html#ldap-pluggable-authentication-installation" title="LDAP プラガブル認証のインストール">LDAP プラガブル認証のインストール</a> を参照してください。) 次に、サーバー <code class="filename">my.cnf</code> ファイルに含まれるプラグイン関連の設定の例を示します: 
        </p><pre class="programlisting">[mysqld]
plugin-load-add=authentication_ldap_sasl.so
authentication_ldap_sasl_auth_method_name="GSSAPI"
authentication_ldap_sasl_server_host=198.51.100.10
authentication_ldap_sasl_server_port=389
authentication_ldap_sasl_bind_root_dn="cn=admin,cn=users,dc=MYSQL,dc=LOCAL"
authentication_ldap_sasl_bind_root_pwd="<em class="replaceable"><code>password</code></em>"
authentication_ldap_sasl_bind_base_dn="cn=users,dc=MYSQL,dc=LOCAL"
authentication_ldap_sasl_user_search_attr="sAMAccountName"
</pre><p>
          これらのオプションファイルの設定では、SASL LDAP プラグインを次のように構成します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="option">--plugin-load-add</code> オプションはプラグインをロードします (必要に応じて、プラットフォームの <code class="filename">.so</code> 接尾辞を調整します)。 以前に <code class="literal">INSTALL PLUGIN</code> ステートメントを使用してプラグインをロードした場合、このオプションは不要です。 
            </p></li><li class="listitem"><p>
              GSSAPI/Kerberos を SASL LDAP 認証方式として使用するには、<code class="literal">authentication_ldap_sasl_auth_method_name</code> を <code class="literal">GSSAPI</code> に設定する必要があります。
            </p></li><li class="listitem"><p>
              <code class="literal">authentication_ldap_sasl_server_host</code> および <code class="literal">authentication_ldap_sasl_server_port</code> は、認証用の Active Directory サーバーホストの IP アドレスとポート番号を示します。
            </p></li><li class="listitem"><p>
              <code class="literal">authentication_ldap_sasl_bind_root_dn</code> および <code class="literal">authentication_ldap_sasl_bind_root_pwd</code> は、グループ検索機能のルート DN およびパスワードを構成します。 この機能は必須ですが、ユーザーには検索権限がない可能性があります。 このような場合は、ルート DN 情報を指定する必要があります: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  DN オプション値では、<code class="literal">admin</code> はユーザー検索を実行する権限を持つ管理 LDAP アカウントの名前である必要があります。
                </p></li><li class="listitem"><p>
                  パスワードオプションの値で、<em class="replaceable"><code>password</code></em> は <code class="literal">admin</code> アカウントのパスワードである必要があります。
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">authentication_ldap_sasl_bind_base_dn</code> は、<code class="literal">MYSQL.LOCAL</code> ドメイン内のユーザーを検索するためのユーザー DN ベースパスを示します。
            </p></li><li class="listitem"><p>
              <code class="literal">authentication_ldap_sasl_user_search_attr</code> では、標準の Active Directory 検索属性 <code class="literal">sAMAccountName</code> が指定されています。 この属性は、ログオン名を照合するために検索で使用されます。属性値はユーザー DN 値と同じではありません。 
            </p></li></ul></div><h6><a name="ldap-gssapi-mysql-account-setup"></a>GSSAPI/Kerberos を使用する MySQL アカウントの作成</h6><p>
          GSSAPI/Kerberos メソッドで SASL LDAP 認証プラグインを使用した MySQL 認証は、Kerberos 主体であるユーザーに基づいています。 次の説明では、このユーザーとして <code class="literal">bredon@MYSQL.LOCAL</code> という名前のプリンシパルを使用します。これは複数の場所に登録する必要があります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Kerberos 管理者は、ユーザー名を Kerberos プリンシパルとして登録する必要があります。 この名前にはドメイン名を含める必要があります。 プリンシパル名とパスワードは、クライアントが Kerberos で認証し、TGT を取得するために使用されます。 
            </p></li><li class="listitem"><p>
              LDAP 管理者は、LDAP エントリにユーザー名を登録する必要があります。 例: 
            </p><pre class="programlisting">uid=bredon,dc=MYSQL,dc=LOCAL
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                Active Directory (デフォルトの認証方法として Kerberos を使用) では、ユーザーを作成すると、Kerberos プリンシパルと LDAP エントリの両方が作成されます。
              </p></div></li><li class="listitem"><p>
              MySQL DBA は、ユーザー名として Kerberos プリンシパル名を持ち、SASL LDAP プラグインを使用して認証するアカウントを作成する必要があります。
            </p></li></ul></div><p>
          Kerberos 主体と LDAP エントリが適切なサービス管理者によって登録されており、前述の <code class="filename">my.cnf</code> 設定を使用して MySQL サーバーが起動されていると仮定して、ドメイン名を含む Kerberos 主体名に対応する MySQL アカウントを作成します。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            SASL LDAP プラグインは、Kerberos 認証に一定のユーザー DN を使用し、MySQL から構成されたユーザー DN を無視します。 これには、次のような影響があります: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                GSSAPI/Kerberos 認証を使用する MySQL アカウントの場合、<code class="literal">CREATE USER</code> ステートメントまたは <code class="literal">ALTER USER</code> ステートメントの認証文字列にはユーザー DN が含まれていない必要があります。これは効果がないためです。
              </p></li><li class="listitem"><p>
                認証文字列にはユーザー DN が含まれていないため、必要なプロキシユーザーにマップされたプロキシユーザーとしてユーザーを処理できるように、グループマッピング情報を含める必要があります。 LDAP 認証プラグインによるプロキシの詳細は、<a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="プロキシを使用した LDAP 認証">プロキシを使用した LDAP 認証</a> を参照してください。 
              </p></li></ul></div></div><p>
          次のステートメントは、<code class="literal">proxied_krb_usr</code> という名前のプロキシユーザーの権限を引き受ける <code class="literal">bredon@MYSQL.LOCAL</code> という名前のプロキシユーザーを作成します。 同じ特権を持つほかの GSSAPI/Kerberos ユーザーも、同じプロキシユーザーのプロキシユーザーとして同様に作成できます。 
        </p><pre class="programlisting">-- create proxy account
CREATE USER 'bredon@MYSQL.LOCAL'
  IDENTIFIED WITH authentication_ldap_sasl
  BY '#krb_grp=proxied_krb_user';

-- create proxied account and grant its privileges;
-- use mysql_no_login plugin to prevent direct login
CREATE USER 'proxied_krb_user'
  IDENTIFIED WITH mysql_no_login;
GRANT ALL
  ON krb_user_db.*
  TO 'proxied_krb_user';

-- grant to proxy account the
-- PROXY privilege for proxied account
GRANT PROXY
  ON 'proxied_krb_user'
  TO 'bredon@MYSQL.LOCAL';
</pre><p>
          最初の <code class="literal">CREATE USER</code> ステートメントと <code class="literal">GRANT PROXY</code> ステートメントでプロキシアカウント名の引用符をよく確認します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              ほとんどの MySQL アカウントでは、ユーザーとホストはアカウント名の別々の部分であるため、<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>とは別に引用符で囲まれます。
            </p></li><li class="listitem"><p>
              Kerberos 認証の場合、アカウント名のユーザー部分にはプリンシパルドメインが含まれるため、<code class="literal">'bredon@MYSQL.LOCAL'</code>は単一の値として引用符で囲まれます。 ホスト部分が指定されていないため、完全な MySQL アカウント名ではデフォルトの<code class="literal">'%'</code>がホスト部分として使用されます: <code class="literal">'bredon@MYSQL.LOCAL'@'%'</code> 
            </p></li></ul></div><p>
          プロキシ設定されたアカウントは、<code class="literal">mysql_no_login</code> 認証プラグインを使用して、クライアントがアカウントを使用して MySQL サーバーに直接ログインできないようにします。 かわりに、LDAP を使用して認証するユーザーは <code class="literal">bredon@MYSQL.LOCAL</code> プロキシアカウントを使用する必要があります。 (これは、<code class="literal">mysql_no_login</code> プラグインがインストールされていることを前提としています。 手順については、<a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 ログインなしのプラガブル認証">セクション6.4.1.8「ログインなしのプラガブル認証」</a> を参照してください。) プロキシ設定されたアカウントを直接使用しないように保護する別の方法については、<a class="xref" href="security.html#preventing-proxied-account-direct-login" title="プロキシアカウントへの直接ログインの防止">プロキシアカウントへの直接ログインの防止</a> を参照してください。 
        </p><h6><a name="ldap-gssapi-mysql-client-usage"></a>MySQL アカウントを使用した MySQL Server への接続</h6><p>
          GSSAPI/Kerberos を使用する MySQL アカウントが設定されると、クライアントは Kerberos に対して認証を行い、そのアカウントを使用して MySQL サーバーに接続できます。 Kerberos 認証は、MySQL クライアントプログラムの起動前または起動時に実行できます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              クライアントユーザーは、MySQL クライアントプログラムを起動する前に、MySQL とは別に TGT を取得できます。 たとえば、クライアントユーザーは、Kerberos プリンシパル名とプリンシパルパスワードを指定して、<span class="command"><strong>kinit</strong></span> を使用して Kerberos への認証を行うことができます。 TGT はキャッシュされ、クライアント側 SASL LDAP 認証プラグインなどの他の Kerberos-aware アプリケーションで使用できるようになります。 この場合、MySQL クライアントプログラムは TGT を使用して MySQL サーバーに対する認証を行うため、ユーザー名またはパスワードを指定せずにクライアントを呼び出します: 
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>kinit bredon@MYSQL.LOCAL</code></strong>
Password for bredon@MYSQL.LOCAL: <em class="replaceable"><code>(enter password here)</code></em>
shell&gt; <strong class="userinput"><code>mysql --default-auth=authentication_ldap_sasl_client</code></strong>
</pre><p>
              MySQL クライアントコマンドに資格証明が含まれている場合は、次のように処理されます:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  コマンドにユーザー名が含まれている場合、TGT 内のプリンシパル名と一致しないと認証は失敗します。
                </p></li><li class="listitem"><p>
                  コマンドにパスワードが含まれている場合、パスワードは無視されます。 認証は TGT に基づいているため、<span class="emphasis"><em>ユーザーが指定したパスワードが正しくない場合でも</em></span>を成功させることができます。 このため、パスワードが無視される原因となる有効な TGT が見つかった場合、プラグインは警告を生成します。 
                </p></li></ul></div></li><li class="listitem"><p>
              TGT が存在しない場合、クライアント側 SASL LDAP 認証プラグイン自体が KDC から TGT を取得できます。 この場合、クライアントを起動するには、MySQL アカウントに関連付けられた Kerberos プリンシパルの名前とパスワードを指定します (コマンドを単一行で入力し、プロンプトでプリンシパルパスワードを入力します): 
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --default-auth=authentication_ldap_sasl_client</code></strong>
         <strong class="userinput"><code>--user=bredon@MYSQL.LOCAL</code></strong>
         <strong class="userinput"><code>--password</code></strong>
Enter password: <em class="replaceable"><code>(enter password here)</code></em>
</pre></li><li class="listitem"><p>
              client コマンドで主体名がユーザー名として指定されておらず、TGT が存在しないためにクライアント側プラグインが Kerberos キャッシュを空にした場合、認証は失敗します。
            </p></li></ul></div><p>
          TGT が存在するかどうかが不明な場合は、<span class="command"><strong>klist</strong></span> を使用して確認できます。
        </p><p>
          認証は次のように行われます:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              クライアントは TGT を使用して Kerberos を使用して認証します。
            </p></li><li class="listitem"><p>
              サーバーはプリンシパルの LDAP エントリを検索し、それを使用して <code class="literal">bredon@MYSQL.LOCAL</code> MySQL プロキシアカウントの接続を認証します。
            </p></li><li class="listitem"><p>
              プロキシアカウント認証文字列 (<code class="literal">'#krb_grp=proxied_krb_user'</code>) のグループマッピング情報は、認証されたプロキシユーザーが <code class="literal">proxied_krb_user</code> である必要があることを示します。
            </p></li><li class="listitem"><p>
              <code class="literal">bredon@MYSQL.LOCAL</code> は <code class="literal">proxied_krb_user</code> のプロキシとして扱われ、次のクエリーは次のような出力を返します:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+------------------------------+--------------------+--------------------------+
| USER()                       | CURRENT_USER()     | @@proxy_user             |
+------------------------------+--------------------+--------------------------+
| bredon@MYSQL.LOCAL@localhost | proxied_krb_user@% | 'bredon@MYSQL.LOCAL'@'%' |
+------------------------------+--------------------+--------------------------+
</pre><p>
              <code class="literal">USER()</code> 値は、クライアントコマンド (<code class="literal">bredon@MYSQL.LOCAL</code>) およびクライアントの接続元ホスト (<code class="literal">localhost</code>) に使用されるユーザー名を示します。
            </p><p>
              <code class="literal">CURRENT_USER()</code> 値は、プロキシ設定されたユーザーアカウントのフルネームで、<code class="literal">proxied_krb_user</code> ユーザー部分と <code class="literal">%</code> ホスト部分で構成されます。
            </p><p>
              <code class="literal">@@proxy_user</code> 値は、MySQL サーバーへの接続に使用されるアカウントのフルネームを示します。これは、<code class="literal">bredon@MYSQL.LOCAL</code> ユーザー部分と <code class="literal">%</code> ホスト部分で構成されます。
            </p><p>
              これは、プロキシが <code class="literal">bredon@MYSQL.LOCAL</code> プロキシユーザーアカウントを介して発生し、<code class="literal">bredon@MYSQL.LOCAL</code> が <code class="literal">proxied_krb_user</code> プロキシユーザーアカウントに付与された権限を引き受けることを示しています。
            </p></li></ol></div><p>
          取得された TGT はクライアント側にキャッシュされ、パスワードを再度指定せずに期限切れになるまで使用できます。 ただし、TGT が取得されると、クライアント側プラグインはそれを使用してサービスチケットを取得し、サーバー側プラグインと通信します。 
        </p><p>
          クライアント側プラグイン自体が TGT を取得する場合、クライアントユーザーは TGT を再利用しないようにすることができます。 <a class="xref" href="security.html#ldap-gssapi-mysql-client-krb5-conf" title="/etc/krb5.conf クライアント構成パラメータ">/etc/krb5.conf クライアント構成パラメータ</a> で説明されているように、ローカル<code class="literal">/etc/krb5.conf</code> ファイルを使用すると、クライアント側プラグインが TGT の処理を完了したときに TGT を破棄できます。 
        </p><p>
          サーバー側プラグインは TGT 自体または TGT の取得に使用される Kerberos パスワードにアクセスできません。
        </p><p>
          LDAP 認証プラグインはキャッシュメカニズム (ローカルファイル内、メモリー内などの記憶域) を制御しませんが、<span class="command"><strong>kswitch</strong></span> などの Kerberos ユーティリティをこの目的で使用できます。
        </p><h6><a name="ldap-gssapi-mysql-client-krb5-conf"></a>/etc/krb5.conf クライアント構成パラメータ</h6><p>
          クライアント側 SASL LDAP プラグインは、ローカル<code class="filename">/etc/krb5.conf</code> ファイルを読み取ります。 このファイルが欠落しているかアクセスできない場合は、エラーが発生します。 ファイルがアクセス可能であると仮定すると、オプションの<code class="literal">[appdefaults]</code>グループを使用して、プラグインで使用される情報を提供できます。 このような情報は、グループの <code class="literal">MySQL</code> セクションに配置します。 例: 
        </p><a class="indexterm" name="idm46723758713808"></a><a class="indexterm" name="idm46723758711648"></a><a class="indexterm" name="idm46723758709552"></a><a class="indexterm" name="idm46723758707456"></a><pre class="programlisting">[appdefaults]
  MySQL = {
    ldap_server_host = "ldap_host.example.com"
    ldap_destroy_tgt = true
  }
</pre><p>
          クライアント側プラグインは、<code class="literal">MySQL</code> セクションの次のパラメータを認識します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">ldap_server_host</code> 値は LDAP サーバーホストを指定し、そのホストが<code class="literal">[realms]</code>グループで指定された KDC サーバーホストと異なる場合に役立ちます。 デフォルトでは、プラグインは KDC サーバーホストを LDAP サーバーホストとして使用します。 
            </p></li><li class="listitem"><p>
              <code class="literal">ldap_destroy_tgt</code> 値は、クライアント側プラグインが TGT を取得して使用したあとに破棄するかどうかを示します。 デフォルトでは、<code class="literal">ldap_destroy_tgt</code> は <code class="literal">false</code> ですが、TGT の再利用を避けるために <code class="literal">true</code> に設定できます。 (この設定は、クライアント側プラグインによって作成された TGT にのみ適用され、MySQL の外部で作成された TGT には適用されません。) 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="ldap-pluggable-authentication-ldap-referral"></a>LDAP 検索照会</h5></div></div></div><p>
          LDAP サーバーは、LDAP 検索を別の LDAP サーバー (LDAP リフェラルと呼ばれる機能) に委任するように構成できます。 サーバー <code class="literal">a.example.com</code> が<code class="literal">"dc=example,dc=com"</code>ルート DN を保持し、別のサーバー <code class="literal">b.example.com</code> に検索を委任するとします。 これを有効にするために、<code class="literal">a.example.com</code> は次の属性を持つ名前付き参照オブジェクトで構成されます: 
        </p><pre class="programlisting">dn: dc=subtree,dc=example,dc=com
objectClass: referral
objectClass: extensibleObject
dc: subtree
ref: ldap://b.example.com/dc=subtree,dc=example,dc=com
</pre><p>
          LDAP 参照を有効にする問題は、検索ベース DN がルート DN で、参照オブジェクトが設定されていない場合に、検索が LDAP 操作エラーで失敗する可能性があることです。 LDAP リフェラルが <code class="filename">ldap.conf</code> 構成ファイルでグローバルに設定されている場合でも、MySQL DBA は LDAP 認証プラグインでこのようなリフェラルエラーを回避できます。 各プラグインとの通信時に LDAP サーバーが LDAP リフェラルを使用するかどうかをプラグイン固有のベースで構成するには、<code class="literal">authentication_ldap_simple_referral</code> および <code class="literal">authentication_ldap_sasl_referral</code> システム変数を設定します。 変数を <code class="literal">ON</code> または <code class="literal">OFF</code> に設定すると、対応する LDAP 認証プラグインによって、MySQL 認証時にリフェラルを使用するかどうかが LDAP サーバーに通知されます。 各変数にはプラグイン固有の効果があり、LDAP サーバーと通信する他のアプリケーションには影響しません。 デフォルトでは、どちらの変数も <code class="literal">OFF</code> です。 
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="no-login-pluggable-authentication"></a>6.4.1.8 ログインなしのプラガブル認証</h4></div></div></div><a class="indexterm" name="idm46723758681088"></a><a class="indexterm" name="idm46723758679536"></a><p>
        <code class="literal">mysql_no_login</code> サーバー側認証プラグインは、それを使用するアカウントへのすべてのクライアント接続を防ぎます。 このプラグインのユースケースは次のとおりです: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            通常のユーザーに権限を公開せずに、昇格された権限を持つストアドプログラムおよびビューを実行できる必要があるアカウント。
          </p></li><li class="listitem"><p>
            直接ログインを許可しないが、プロキシアカウントを介してのみアクセスすることを目的としたプロキシアカウント。
          </p></li></ul></div><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。 ファイル名のサフィクスは、システムによって異なる場合があります。 ファイルは、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリに配置する必要があります。 
      </p><div class="table"><a name="idm46723758671376"></a><p class="title"><b>表 6.20 ログインなし認証のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for no-login password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td><code class="literal">mysql_no_login</code></td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td>なし</td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td><code class="filename">mysql_no_login.so</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        次の各セクションでは、ログインなしのプラガブル認証に固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#no-login-pluggable-authentication-installation" title="ログインなしのプラガブル認証のインストール">ログインなしのプラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#no-login-pluggable-authentication-uninstallation" title="ログインなしのプラガブル認証のアンインストール">ログインなしのプラガブル認証のアンインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#no-login-pluggable-authentication-usage" title="ログインなしのプラガブル認証の使用">ログインなしのプラガブル認証の使用</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。 プロキシユーザーについては、<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください。 
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="no-login-pluggable-authentication-installation"></a>ログインなしのプラガブル認証のインストール</h5></div></div></div><p>
          このセクションでは、ログインなしの認証プラグインをインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
        </p><p>
          サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
        </p><p>
          プラグインライブラリファイルのベース名は <code class="literal">mysql_no_login</code> です。 ファイル名の接尾辞は、プラットフォームごとに異なります (たとえば、<code class="filename">.so</code> for Unix and Unix-like systems, <code class="filename">.dll</code> for Windows)。 
        </p><p>
          サーバーの起動時にプラグインをロードするには、<code class="option">--plugin-load-add</code> オプションを使用して、プラグインを含むライブラリファイルに名前を付けます。 このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルに次の行を入力し、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します: 
        </p><pre class="programlisting">[mysqld]
plugin-load-add=mysql_no_login.so
</pre><p>
          <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
        </p><p>
          または、実行時にプラグインをロードするには、次のステートメントを使用して、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します:
        </p><pre class="programlisting">INSTALL PLUGIN mysql_no_login SONAME 'mysql_no_login.so';
</pre><p>
          <code class="literal">INSTALL PLUGIN</code> はプラグインをただちにロードし、<code class="literal">mysql.plugins</code> システムテーブルにも登録して、<code class="option">--plugin-load-add</code> を必要とせずに後続の通常の起動のたびにサーバーがプラグインをロードするようにします。
        </p><p>
          プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%login%';</code></strong>
+----------------+---------------+
| PLUGIN_NAME    | PLUGIN_STATUS |
+----------------+---------------+
| mysql_no_login | ACTIVE        |
+----------------+---------------+
</pre><p>
          プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
        </p><p>
          MySQL アカウントを非ログインプラグインに関連付けるには、<a class="xref" href="security.html#no-login-pluggable-authentication-usage" title="ログインなしのプラガブル認証の使用">ログインなしのプラガブル認証の使用</a> を参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="no-login-pluggable-authentication-uninstallation"></a>ログインなしのプラガブル認証のアンインストール</h5></div></div></div><p>
          ログインなしの認証プラグインのアンインストールに使用される方法は、インストール方法によって異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="option">--plugin-load-add</code> オプションを使用してサーバーの起動時にプラグインをインストールした場合は、オプションなしでサーバーを再起動します。
            </p></li><li class="listitem"><p>
              <code class="literal">INSTALL PLUGIN</code> ステートメントを使用して実行時にプラグインをインストールした場合、サーバーの再起動後もインストールされたままになります。 アンインストールするには、<code class="literal">UNINSTALL PLUGIN</code> を使用します: 
            </p><pre class="programlisting">UNINSTALL PLUGIN mysql_no_login;
</pre></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="no-login-pluggable-authentication-usage"></a>ログインなしのプラガブル認証の使用</h5></div></div></div><p>
          このセクションでは、ログインなしの認証プラグインを使用して、MySQL クライアントプログラムからサーバーへの接続にアカウントが使用されないようにする方法について説明します。 <a class="xref" href="security.html#no-login-pluggable-authentication-installation" title="ログインなしのプラガブル認証のインストール">ログインなしのプラガブル認証のインストール</a> で説明されているように、ログインなしプラグインを有効にしてサーバーが実行されていることを前提としています。 
        </p><p>
          <code class="literal">CREATE USER</code> ステートメントの <code class="literal">IDENTIFIED WITH</code> 句でログインなしの認証プラグインを参照するには、<code class="literal">mysql_no_login</code> という名前を使用します。
        </p><p>
          <code class="literal">mysql_no_login</code> を使用して認証するアカウントは、ストアドプログラムおよびビューオブジェクトの <code class="literal">DEFINER</code> として使用できます。 このようなオブジェクト定義に <code class="literal">SQL SECURITY DEFINER</code> も含まれている場合は、そのアカウント権限で実行されます。 DBA は、この動作を使用して、適切に制御されたインタフェースを介してのみ公開される機密データまたは機密データにアクセスできます。 
        </p><p>
          次の例は、これらの原則を示しています。 クライアント接続を許可しないアカウントを定義し、<code class="literal">mysql.user</code> システムテーブルの特定のカラムのみを公開するビューに関連付けます: 
        </p><pre class="programlisting">CREATE DATABASE nologindb;
CREATE USER 'nologin'@'localhost'
  IDENTIFIED WITH mysql_no_login;
GRANT ALL ON nologindb.*
  TO 'nologin'@'localhost';
GRANT SELECT ON mysql.user
  TO 'nologin'@'localhost';
CREATE DEFINER = 'nologin'@'localhost'
  SQL SECURITY DEFINER
  VIEW nologindb.myview
  AS SELECT User, Host FROM mysql.user;
</pre><p>
          ビューへの保護されたアクセスを通常のユーザーに提供するには、次の手順を実行します:
        </p><pre class="programlisting">GRANT SELECT ON nologindb.myview
  TO 'ordinaryuser'@'localhost';
</pre><p>
          これで、通常のユーザーはビューを使用して、表示される制限された情報にアクセスできます:
        </p><pre class="programlisting">SELECT * FROM nologindb.myview;
</pre><p>
          ユーザーがビューによって公開されているカラム以外のカラムにアクセスしようとすると、アクセス権を付与されていないユーザーがビューから選択しようとするため、エラーが発生します。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            <code class="literal">nologin</code> アカウントは直接使用できないため、使用するオブジェクトの設定に必要な操作は、<code class="literal">root</code> またはオブジェクトの作成および <code class="literal">DEFINER</code> 値の設定に必要な権限を持つ同様のアカウントによって実行される必要があります。
          </p></div><p>
          <code class="literal">mysql_no_login</code> プラグインは、プロキシシナリオでも役立ちます。 (プロキシに関連する概念については、<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照してください。) <code class="literal">mysql_no_login</code> を使用して認証するアカウントは、プロキシアカウントのプロキシユーザーとして使用できます: 
        </p><pre class="programlisting">-- create proxied account
CREATE USER 'proxied_user'@'localhost'
  IDENTIFIED WITH mysql_no_login;
-- grant privileges to proxied account
GRANT ...
  ON ...
  TO 'proxied_user'@'localhost';
-- permit proxy_user to be a proxy account for proxied account
GRANT PROXY
  ON 'proxied_user'@'localhost'
  TO 'proxy_user'@'localhost';
</pre><p>
          これにより、クライアントはプロキシアカウント (<code class="literal">proxy_user</code>) を介して MySQL にアクセスできますが、プロキシユーザー (<code class="literal">proxied_user</code>) として直接接続してプロキシメカニズムをバイパスすることはできません。 <code class="literal">proxy_user</code> アカウントを使用して接続するクライアントには <code class="literal">proxied_user</code> アカウントの権限がありますが、<code class="literal">proxied_user</code> 自体を使用して接続することはできません。 
        </p><p>
          プロキシ設定されたアカウントを直接使用しないように保護する別の方法については、<a class="xref" href="security.html#preventing-proxied-account-direct-login" title="プロキシアカウントへの直接ログインの防止">プロキシアカウントへの直接ログインの防止</a> を参照してください。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="socket-pluggable-authentication"></a>6.4.1.9 ソケットピア資格証明プラガブル認証</h4></div></div></div><a class="indexterm" name="idm46723758582256"></a><a class="indexterm" name="idm46723758580720"></a><p>
        サーバー側 <code class="literal">auth_socket</code> 認証プラグインは、Unix ソケットファイルを介してローカルホストから接続するクライアントを認証します。 このプラグインは <code class="literal">SO_PEERCRED</code> ソケットオプションを使用して、クライアントプログラムを実行しているユーザーに関する情報を取得します。 したがって、プラグインは、Linux など、<code class="literal">SO_PEERCRED</code> オプションをサポートするシステムでのみ使用できます。 
      </p><p>
        このプラグインのソースコードは、ロード可能な認証プラグインを記述する方法を示す比較的単純な例として調査できます。
      </p><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。 ファイルは、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリに配置する必要があります。 
      </p><div class="table"><a name="idm46723758572720"></a><p class="title"><b>表 6.21 ソケットピア資格証明認証のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for socket peer-credential password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td><code class="literal">auth_socket</code></td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td>なし (説明を参照してください)</td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td><code class="filename">auth_socket.so</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        次の各セクションでは、ソケットプラガブル認証に固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#socket-pluggable-authentication-installation" title="ソケットプラガブル認証のインストール">ソケットプラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#socket-pluggable-authentication-uninstallation" title="ソケットプラガブル認証のアンインストール">ソケットプラガブル認証のアンインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#socket-pluggable-authentication-usage" title="ソケットプラガブル認証の使用">ソケットプラガブル認証の使用</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="socket-pluggable-authentication-installation"></a>ソケットプラガブル認証のインストール</h5></div></div></div><p>
          このセクションでは、ソケット認証プラグインをインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
        </p><p>
          サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
        </p><p>
          サーバーの起動時にプラグインをロードするには、<code class="option">--plugin-load-add</code> オプションを使用して、プラグインを含むライブラリファイルに名前を付けます。 このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルに次の行を挿入します: 
        </p><pre class="programlisting">[mysqld]
plugin-load-add=auth_socket.so
</pre><p>
          <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
        </p><p>
          または、実行時にプラグインをロードするには、次のステートメントを使用します:
        </p><pre class="programlisting">INSTALL PLUGIN auth_socket SONAME 'auth_socket.so';
</pre><p>
          <code class="literal">INSTALL PLUGIN</code> はプラグインをただちにロードし、<code class="literal">mysql.plugins</code> システムテーブルにも登録して、<code class="option">--plugin-load-add</code> を必要とせずに後続の通常の起動のたびにサーバーがプラグインをロードするようにします。
        </p><p>
          プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%socket%';</code></strong>
+-------------+---------------+
| PLUGIN_NAME | PLUGIN_STATUS |
+-------------+---------------+
| auth_socket | ACTIVE        |
+-------------+---------------+
</pre><p>
          プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
        </p><p>
          MySQL アカウントをソケットプラグインに関連付けるには、<a class="xref" href="security.html#socket-pluggable-authentication-usage" title="ソケットプラガブル認証の使用">ソケットプラガブル認証の使用</a> を参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="socket-pluggable-authentication-uninstallation"></a>ソケットプラガブル認証のアンインストール</h5></div></div></div><p>
          ソケット認証プラグインのアンインストールに使用する方法は、インストール方法によって異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="option">--plugin-load-add</code> オプションを使用してサーバーの起動時にプラグインをインストールした場合は、オプションなしでサーバーを再起動します。
            </p></li><li class="listitem"><p>
              <code class="literal">INSTALL PLUGIN</code> ステートメントを使用して実行時にプラグインをインストールした場合、サーバーの再起動後もインストールされたままになります。 アンインストールするには、<code class="literal">UNINSTALL PLUGIN</code> を使用します: 
            </p><pre class="programlisting">UNINSTALL PLUGIN auth_socket;
</pre></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="socket-pluggable-authentication-usage"></a>ソケットプラガブル認証の使用</h5></div></div></div><p>
          ソケットプラグインは、ソケットユーザー名 (オペレーティングシステムユーザー名) がクライアントプログラムによって指定された MySQL ユーザー名とサーバーと一致するかどうかをチェックします。 名前が一致しない場合、プラグインはソケットユーザー名が <code class="literal">mysql.user</code> システムテーブルの行の <code class="literal">authentication_string</code> カラムで指定された名前と一致するかどうかを確認します。 一致が見つかった場合、プラグインは接続を許可します。 <code class="literal">authentication_string</code> 値は、<code class="literal">CREATE USER</code> または <code class="literal">ALTER USER</code> で <code class="literal">IDENTIFIED ...AS</code> 句を使用して指定できます。 
        </p><p>
          ソケットファイルを介してローカルホストから接続するために <code class="literal">auth_socket</code> プラグインによって認証される <code class="literal">valerie</code> というオペレーティングシステムユーザーに対して、MySQL アカウントが作成されているとします:
        </p><pre class="programlisting">CREATE USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket;
</pre><p>
          <code class="literal">stefanie</code> というログイン名を持つローカルホスト上のユーザーが <code class="option">--user=valerie</code> オプションを付けて <span class="command"><strong>mysql</strong></span> を呼び出して、ソケットファイル経由で接続する場合、サーバーは <code class="literal">auth_socket</code> を使用してクライアントを認証します。 このプラグインは、<code class="option">--user</code> オプションの値 (<code class="literal">valerie</code>) がクライアントユーザー名 (<code class="literal">stephanie</code>) とは異なると判断し、接続を拒否します。 <code class="literal">valerie</code> という名前のユーザーが同じことを試みた場合、プラグインはユーザー名と MySQL ユーザー名が両方とも <code class="literal">valerie</code> であると判断し、接続を許可します。 ただし、TCP/IP などの別のプロトコルを使用して接続されると、<code class="literal">valerie</code> の場合でもプラグインは接続を拒否します。 
        </p><p>
          <code class="literal">valerie</code> と <code class="literal">stephanie</code> の両方のオペレーティングシステムユーザーが、アカウントを使用するソケットファイル接続を介して MySQL にアクセスできるようにするには、次の 2 つの方法があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              アカウント作成時に両方のユーザーに名前を付けます。一方は <code class="literal">CREATE USER</code> に従い、もう一方は認証文字列になります:
            </p><pre class="programlisting">CREATE USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket AS 'stephanie';
</pre></li><li class="listitem"><p>
              すでに <code class="literal">CREATE USER</code> を使用して単一ユーザーのアカウントを作成している場合は、<code class="literal">ALTER USER</code> を使用して 2 番目のユーザーを追加します:
            </p><pre class="programlisting">CREATE USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket;
ALTER USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket AS 'stephanie';
</pre></li></ul></div><p>
          アカウントにアクセスするには、<code class="literal">valerie</code> と <code class="literal">stephanie</code> の両方で、接続時に <code class="option">--user=valerie</code> を指定します。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="test-pluggable-authentication"></a>6.4.1.10 プラガブル認証のテスト</h4></div></div></div><a class="indexterm" name="idm46723758488144"></a><a class="indexterm" name="idm46723758486592"></a><a class="indexterm" name="idm46723758484656"></a><a class="indexterm" name="idm46723758483104"></a><p>
        MySQL には、アカウント資格証明をチェックし、成功または失敗をサーバーエラーログに記録するテストプラグインが含まれています。 これは (組込みではなく) ロード可能なプラグインであり、使用する前にインストールする必要があります。 
      </p><p>
        テストプラグインのソースコードは組み込みのネイティブプラグインとは異なり、サーバーソースとは別々のものであるため、ロード可能な認証プラグインを記述する方法を示す比較的単純な例として調査できます。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          このプラグインはテストおよび開発を目的としており、本番環境やパブリックネットワークに公開されているサーバーでは使用できません。
        </p></div><p>
        次の表には、プラグインおよびライブラリファイルの名前を示します。 ファイル名のサフィクスは、システムによって異なる場合があります。 ファイルは、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリに配置する必要があります。 
      </p><div class="table"><a name="idm46723758475888"></a><p class="title"><b>表 6.22 テスト認証用のプラグインおよびライブラリ名</b></p><div class="table-contents"><table summary="Names for the plugins and library file used for test password authentication."><col style="width=30%"><col style="width=70%"><thead><tr>
            <th>プラグインまたはファイル</th>
            <th>プラグインまたはファイル名</th>
          </tr></thead><tbody><tr>
            <td>サーバー側プラグイン</td>
            <td><code class="literal">test_plugin_server</code></td>
          </tr><tr>
            <td>クライアント側プラグイン</td>
            <td><code class="literal">auth_test_plugin</code></td>
          </tr><tr>
            <td>ライブラリファイル</td>
            <td><code class="filename">auth_test_plugin.so</code></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        次の各セクションでは、プラガブル認証のテストに固有のインストールおよび使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#test-pluggable-authentication-installation" title="テストプラガブル認証のインストール">テストプラガブル認証のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#test-pluggable-authentication-uninstallation" title="テストプラガブル認証のアンインストール">テストプラガブル認証のアンインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#test-pluggable-authentication-usage" title="テストプラガブル認証の使用">テストプラガブル認証の使用</a></p></li></ul></div><p>
        MySQL のプラガブル認証に関する一般的な情報については、<a class="xref" href="security.html#pluggable-authentication" title="6.2.17 プラガブル認証">セクション6.2.17「プラガブル認証」</a>を参照してください。
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="test-pluggable-authentication-installation"></a>テストプラガブル認証のインストール</h5></div></div></div><p>
          このセクションでは、テスト認証プラグインをインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
        </p><p>
          サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
        </p><p>
          サーバーの起動時にプラグインをロードするには、<code class="option">--plugin-load-add</code> オプションを使用して、プラグインを含むライブラリファイルに名前を付けます。 このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルに次の行を入力し、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します: 
        </p><pre class="programlisting">[mysqld]
plugin-load-add=auth_test_plugin.so
</pre><p>
          <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
        </p><p>
          または、実行時にプラグインをロードするには、次のステートメントを使用して、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します:
        </p><pre class="programlisting">INSTALL PLUGIN test_plugin_server SONAME 'auth_test_plugin.so';
</pre><p>
          <code class="literal">INSTALL PLUGIN</code> はプラグインをただちにロードし、<code class="literal">mysql.plugins</code> システムテーブルにも登録して、<code class="option">--plugin-load-add</code> を必要とせずに後続の通常の起動のたびにサーバーがプラグインをロードするようにします。
        </p><p>
          プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%test_plugin%';</code></strong>
+--------------------+---------------+
| PLUGIN_NAME        | PLUGIN_STATUS |
+--------------------+---------------+
| test_plugin_server | ACTIVE        |
+--------------------+---------------+
</pre><p>
          プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
        </p><p>
          MySQL アカウントをテストプラグインに関連付けるには、<a class="xref" href="security.html#test-pluggable-authentication-usage" title="テストプラガブル認証の使用">テストプラガブル認証の使用</a> を参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="test-pluggable-authentication-uninstallation"></a>テストプラガブル認証のアンインストール</h5></div></div></div><p>
          テスト認証プラグインのアンインストールに使用する方法は、インストール方法によって異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="option">--plugin-load-add</code> オプションを使用してサーバーの起動時にプラグインをインストールした場合は、オプションなしでサーバーを再起動します。
            </p></li><li class="listitem"><p>
              <code class="literal">INSTALL PLUGIN</code> ステートメントを使用して実行時にプラグインをインストールした場合、サーバーの再起動後もインストールされたままになります。 アンインストールするには、<code class="literal">UNINSTALL PLUGIN</code> を使用します: 
            </p><pre class="programlisting">UNINSTALL PLUGIN test_plugin_server;
</pre></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="test-pluggable-authentication-usage"></a>テストプラガブル認証の使用</h5></div></div></div><p>
          テスト認証プラグインを使用するには、<code class="literal">IDENTIFIED WITH</code> 句でアカウントを作成し、そのプラグインに名前を付けます:
        </p><pre class="programlisting">CREATE USER 'testuser'@'localhost'
IDENTIFIED WITH test_plugin_server
BY '<em class="replaceable"><code>testpassword</code></em>';
</pre><p>
          次に、サーバーへの接続時に、そのアカウントの <code class="option">--user</code> および <code class="option">--password</code> オプションを指定します。 例: 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql --user=testuser --password</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>testpassword</code></em></code></strong>
</pre><p>
          プラグインは、クライアントから受信したパスワードをフェッチし、<code class="literal">mysql.user</code> システムテーブルのアカウント行の <code class="literal">authentication_string</code> カラムに格納されている値と比較します。 2 つの値が一致する場合、プラグインは新しい実効ユーザー ID として <code class="literal">authentication_string</code> 値を返します。 
        </p><p>
          サーバーエラーログで、認証が成功したかどうかを示すメッセージを確認できます (パスワードが <span class="quote">「<span class="quote">user</span>」</span> として報告されることに注意してください):
        </p><pre class="programlisting">[Note] Plugin test_plugin_server reported:
'successfully authenticated user <em class="replaceable"><code>testpassword</code></em>'
</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="pluggable-authentication-system-variables"></a>6.4.1.11 プラガブル認証システム変数</h4></div></div></div><p>
        これらの変数は、適切なサーバー側プラグインがインストールされていないかぎり使用できません:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">authentication_ldap_sasl_<em class="replaceable"><code>xxx</code></em></code> という形式の名前を持つシステム変数の <code class="literal">authentication_ldap_sasl</code>
          </p></li><li class="listitem"><p>
            <code class="literal">authentication_ldap_simple_<em class="replaceable"><code>xxx</code></em></code> という形式の名前を持つシステム変数の <code class="literal">authentication_ldap_simple</code>
          </p></li></ul></div><div class="table"><a name="idm46723758400112"></a><p class="title"><b>表 6.23 「認証プラグインシステム変数サマリー」</b></p><div class="table-contents"><table frame="box" rules="all" summary="「認証プラグインのシステム変数のリファレンス。」"><col style="width=20%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><thead><tr><th scope="col">名前</th>
<th scope="col">コマンド行</th>
<th scope="col">オプションファイル</th>
<th scope="col">システム変数</th>
<th scope="col">ステータス変数</th>
<th scope="col">変数スコープ</th>
<th scope="col">動的</th>
</tr></thead><tbody><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_auth_method_name">authentication_ldap_sasl_auth_method_name</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_base_dn">authentication_ldap_sasl_bind_base_dn</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_dn">authentication_ldap_sasl_bind_root_dn</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_pwd">authentication_ldap_sasl_bind_root_pwd</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_ca_path">authentication_ldap_sasl_ca_path</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_attr">authentication_ldap_sasl_group_search_attr</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_filter">authentication_ldap_sasl_group_search_filter</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_init_pool_size">authentication_ldap_sasl_init_pool_size</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_log_status">authentication_ldap_sasl_log_status</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size">authentication_ldap_sasl_max_pool_size</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_referral">authentication_ldap_sasl_referral</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_host">authentication_ldap_sasl_server_host</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_port">authentication_ldap_sasl_server_port</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_tls">authentication_ldap_sasl_tls</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr">authentication_ldap_sasl_user_search_attr</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_auth_method_name">authentication_ldap_simple_auth_method_name</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_base_dn">authentication_ldap_simple_bind_base_dn</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_dn">authentication_ldap_simple_bind_root_dn</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_pwd">authentication_ldap_simple_bind_root_pwd</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_ca_path">authentication_ldap_simple_ca_path</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_attr">authentication_ldap_simple_group_search_attr</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_filter">authentication_ldap_simple_group_search_filter</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_init_pool_size">authentication_ldap_simple_init_pool_size</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_log_status">authentication_ldap_simple_log_status</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size">authentication_ldap_simple_max_pool_size</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_referral">authentication_ldap_simple_referral</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_server_host">authentication_ldap_simple_server_host</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_server_port">authentication_ldap_simple_server_port</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_tls">authentication_ldap_simple_tls</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr">authentication_ldap_simple_user_search_attr</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#sysvar_authentication_windows_log_level">authentication_windows_log_level</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="server-administration.html#sysvar_authentication_windows_use_principal_name">authentication_windows_use_principal_name</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr></tbody></table></div></div><br class="table-break"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_auth_method_name"></a>
            <code class="literal">authentication_ldap_sasl_auth_method_name</code>
          </p><a class="indexterm" name="idm46723758151408"></a><a class="indexterm" name="idm46723758149792"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_auth_method_name"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-auth-method-name=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_auth_method_name">authentication_ldap_sasl_auth_method_name</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">SCRAM-SHA-1</code></td>
</tr><tr><th>有効な値 (≥ 8.0.23)</th>
<td><p class="valid-value"><code class="literal">SCRAM-SHA-1</code></p><p class="valid-value"><code class="literal">SCRAM-SHA-256</code></p><p class="valid-value"><code class="literal">GSSAPI</code></p></td>
</tr><tr><th>有効な値 (≥ 8.0.20, ≤ 8.0.22)</th>
<td><p class="valid-value"><code class="literal">SCRAM-SHA-1</code></p><p class="valid-value"><code class="literal">GSSAPI</code></p></td>
</tr><tr><th>有効な値 (≤ 8.0.19)</th>
<td><code class="literal">SCRAM-SHA-1</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、認証方式名。 認証プラグインと LDAP サーバー間の通信は、パスワードのセキュリティーを確保するために、この認証方式に従って行われます。 
          </p><p>
            次の認証方式の値が許可されます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">SCRAM-SHA-1</code>: SASL チャレンジレスポンスメカニズムを使用します。
              </p><p>
                クライアント側 <code class="literal">authentication_ldap_sasl_client</code> プラグインは、チャレンジを作成して SASL リクエストバッファを取得するためのパスワードを使用して SASL サーバーと通信し、このバッファをサーバー側 <code class="literal">authentication_ldap_sasl</code> プラグインに渡します。 クライアント側およびサーバー側 SASL LDAP プラグインは、SASL メッセージを使用して LDAP プロトコル内での資格証明のセキュアな転送を行い、MySQL クライアントとサーバー間でクリアテキストパスワードが送信されないようにします。 
              </p></li><li class="listitem"><p>
                <code class="literal">SCRAM-SHA-256</code>: SASL チャレンジレスポンスメカニズムを使用します。
              </p><p>
                この方法は <code class="literal">SCRAM-SHA-1</code> と似ていますが、よりセキュアです。 MySQL 8.0.23 以上で使用できます。 Cyrus SASL 2.1.27 以上を使用して構築された OpenLDAP サーバーが必要です。 
              </p></li><li class="listitem"><p>
                <code class="literal">GSSAPI</code>: パスワードなしおよびチケットベースのプロトコルである Kerberos を使用します。
              </p><p>
                GSSAPI/Kerberos は、Linux 上の MySQL クライアントおよびサーバーの認証方式としてのみサポートされます。 これは、Kerberos がデフォルトで有効になっている Microsoft Active Directory を使用してアプリケーションが LDAP にアクセスする Linux 環境で役立ちます。 
              </p><p>
                クライアント側 <code class="literal">authentication_ldap_sasl_client</code> プラグインは、チケット認可チケット (TGT) を使用して Kerberos からサービスチケットを取得しますが、LDAP サービスは直接使用しません。 サーバー側 <code class="literal">authentication_ldap_sasl</code> プラグインは、Kerberos メッセージをクライアント側プラグインと LDAP サーバーの間でルーティングします。 このように取得された資格証明を使用して、サーバー側プラグインは LDAP サーバーと通信し、LDAP 認証メッセージを解釈して LDAP グループを取得します。 
              </p></li></ul></div></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_base_dn"></a>
            <code class="literal">authentication_ldap_sasl_bind_base_dn</code>
          </p><a class="indexterm" name="idm46723758098912"></a><a class="indexterm" name="idm46723758097312"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_base_dn"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-bind-base-dn=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_base_dn">authentication_ldap_sasl_bind_base_dn</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、ベース識別名 (DN)。 この変数を使用すると、検索ツリー内の特定の場所 (<span class="quote">「<span class="quote">base</span>」</span>) に検索範囲を固定することで、検索範囲を制限できます。 
          </p><p>
            LDAP ユーザーエントリのセットのメンバーがそれぞれ次の形式であるとします:
          </p><pre class="programlisting">uid=<em class="replaceable"><code>user_name</code></em>,ou=People,dc=example,dc=com
</pre><p>
            また、LDAP ユーザーエントリの別のセットのメンバーは、それぞれ次の形式になります:
          </p><pre class="programlisting">uid=<em class="replaceable"><code>user_name</code></em>,ou=Admin,dc=example,dc=com
</pre><p>
            検索は、異なるベース DN 値に対して次のように機能します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                ベース DN が <code class="literal">ou=People,dc=example,dc=com</code> の場合: 検索では、最初のセットのユーザーエントリのみが検索されます。
              </p></li><li class="listitem"><p>
                ベース DN が <code class="literal">ou=Admin,dc=example,dc=com</code> の場合: 検索では、2 番目のセット内のユーザエントリだけが検索されます。
              </p></li><li class="listitem"><p>
                ベース DN が <code class="literal">ou=dc=example,dc=com</code> の場合: 検索では、1 番目または 2 番目のセット内のユーザエントリが検索されます。
              </p></li></ul></div><p>
            一般に、より具体的なベース DN 値を使用すると、検索範囲が制限されるため、検索速度が向上します。
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_root_dn"></a>
            <code class="literal">authentication_ldap_sasl_bind_root_dn</code>
          </p><a class="indexterm" name="idm46723758060512"></a><a class="indexterm" name="idm46723758058912"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_root_dn"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-bind-root-dn=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_dn">authentication_ldap_sasl_bind_root_dn</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、ルート識別名 (DN)。 この変数は、検索を実行する目的で LDAP サーバーに対して認証するための資格証明として <code class="literal">authentication_ldap_sasl_bind_root_pwd</code> とともに使用されます。 認証では、MySQL アカウントが LDAP ユーザー DN を指定しているかどうかに応じて、次のいずれかまたは 2 つの LDAP バインド操作を使用します: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                アカウントがユーザー DN を指定していない場合: <code class="literal">authentication_ldap_sasl</code> は、<code class="literal">authentication_ldap_sasl_bind_root_dn</code> および <code class="literal">authentication_ldap_sasl_bind_root_pwd</code> を使用して初期 LDAP バインディングを実行します。 (これらは両方ともデフォルトで空であるため、設定しない場合、LDAP サーバーは匿名接続を許可する必要があります。) 生成されたバインド LDAP ハンドルは、クライアントユーザー名に基づいてユーザー DN を検索するために使用されます。<code class="literal">authentication_ldap_sasl</code> は、ユーザー DN とクライアント提供のパスワードを使用して、別のバインドを実行します。 
              </p></li><li class="listitem"><p>
                アカウントがユーザー DN を指定する場合: この場合、最初のバインド操作は不要です。<code class="literal">authentication_ldap_sasl</code> は、ユーザー DN とクライアント提供のパスワードを使用して単一のバインドを実行します。 これは、MySQL アカウントで LDAP ユーザー DN が指定されていない場合より高速です。 
              </p></li></ul></div></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_root_pwd"></a>
            <code class="literal">authentication_ldap_sasl_bind_root_pwd</code>
          </p><a class="indexterm" name="idm46723758024464"></a><a class="indexterm" name="idm46723758022864"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_root_pwd"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-bind-root-pwd=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_pwd">authentication_ldap_sasl_bind_root_pwd</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、ルート識別名のパスワード。 この変数は、<code class="literal">authentication_ldap_sasl_bind_root_dn</code> とともに使用されます。 その変数の説明を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_ca_path"></a>
            <code class="literal">authentication_ldap_sasl_ca_path</code>
          </p><a class="indexterm" name="idm46723757996944"></a><a class="indexterm" name="idm46723757995360"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_ca_path"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-ca-path=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_ca_path">authentication_ldap_sasl_ca_path</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、認証局ファイルの絶対パス。 認証プラグインで LDAP サーバー証明書の検証を実行する場合は、このファイルを指定します。 
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <code class="literal">authentication_ldap_sasl_ca_path</code> 変数をファイル名に設定するだけでなく、適切な認証局の証明書をファイルに追加し、<code class="literal">authentication_ldap_sasl_tls</code> システム変数を有効にする必要があります。 これらの変数は、デフォルトの OpenLDAP TLS 構成をオーバーライドするように設定できます。<a class="xref" href="security.html#ldap-pluggable-authentication-ldap-conf" title="LDAP プラガブル認証および ldap.conf">LDAP プラガブル認証および ldap.conf</a> を参照してください 
            </p></div></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_group_search_attr"></a>
            <code class="literal">authentication_ldap_sasl_group_search_attr</code>
          </p><a class="indexterm" name="idm46723757966064"></a><a class="indexterm" name="idm46723757964448"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_group_search_attr"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-group-search-attr=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_attr">authentication_ldap_sasl_group_search_attr</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">cn</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、LDAP ディレクトリエントリ内のグループ名を指定する属性の名前。 <code class="literal">authentication_ldap_sasl_group_search_attr</code> のデフォルト値が <code class="literal">cn</code> の場合、検索では <code class="literal">cn</code> 値がグループ名として返されます。 たとえば、<code class="literal">uid</code> 値が <code class="literal">user1</code> の LDAP エントリに <code class="literal">mygroup</code> の <code class="literal">cn</code> 属性がある場合、<code class="literal">user1</code> を検索すると、<code class="literal">mygroup</code> がグループ名として返されます。 
          </p><p>
            グループまたはプロキシ認証が不要な場合は、この変数を空の文字列にする必要があります。
          </p><p>
            グループ検索属性が <code class="literal">isMemberOf</code> の場合、LDAP 認証はユーザー属性 <code class="literal">isMemberOf</code> 値を直接取得し、グループ情報として割り当てます。 グループ検索属性が <code class="literal">isMemberOf</code> でない場合、LDAP 認証はユーザーがメンバーであるすべてのグループを検索します。 (後者がデフォルトの動作です。) この動作は、LDAP グループ情報を格納する方法に基づいています: 1) グループエントリは、ユーザー名の値を持つ <code class="literal">memberUid</code> または <code class="literal">member</code> という名前の属性を持つことができます。2) ユーザーエントリは、グループ名の値を持つ <code class="literal">isMemberOf</code> という名前の属性を持つことができます。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_group_search_filter"></a>
            <code class="literal">authentication_ldap_sasl_group_search_filter</code>
          </p><a class="indexterm" name="idm46723757925744"></a><a class="indexterm" name="idm46723757924128"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_group_search_filter"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-group-search-filter=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_filter">authentication_ldap_sasl_group_search_filter</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">(|(&amp;(objectClass=posixGroup)(memberUid=%s))(&amp;(objectClass=group)(member=%s)))</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、カスタムグループ検索フィルタ。
          </p><p>
            検索フィルタ値には、ユーザー名と完全なユーザー DN を表す <code class="literal">{UA}</code> および <code class="literal">{UD}</code> 表記を含めることができます。 たとえば、<code class="literal">{UA}</code> は<code class="literal">"admin"</code>などのユーザー名に置き換えられますが、<code class="literal">{UD}</code> は<code class="literal">"uid=admin,ou=People,dc=example,dc=com"</code>などの完全 DN に置き換えられます。 次の値がデフォルトで、OpenLDAP と Active Directory の両方をサポートしています: 
          </p><pre class="programlisting">(|(&amp;(objectClass=posixGroup)(memberUid={UA}))
  (&amp;(objectClass=group)(member={UD})))
</pre><p>
            場合によっては、<code class="literal">memberOf</code> はグループ情報を保持しない単純なユーザー属性です。 柔軟性を高めるために、オプションの <code class="literal">{GA}</code> 接頭辞をグループ検索属性とともに使用できます。 {GA} 接頭辞を持つグループ属性は、グループ名を持つユーザー属性として扱われます。 たとえば、<code class="literal">{GA}MemberOf</code> の値では、グループ値が DN の場合、グループ DN の最初の属性値がグループ名として返されます。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_init_pool_size"></a>
            <code class="literal">authentication_ldap_sasl_init_pool_size</code>
          </p><a class="indexterm" name="idm46723757889280"></a><a class="indexterm" name="idm46723757887680"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_init_pool_size"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-init-pool-size=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_init_pool_size">authentication_ldap_sasl_init_pool_size</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">10</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">32767</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、LDAP サーバーへの接続プールの初期サイズ。 LDAP サーバーに対する同時認証リクエストの平均数に基づいて、この変数の値を選択します。 
          </p><p>
            プラグインは、<code class="literal">authentication_ldap_sasl_init_pool_size</code> と <code class="literal">authentication_ldap_sasl_max_pool_size</code> を一緒に使用して接続プールを管理します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                認証プラグインが初期化されると、<code class="literal">authentication_ldap_sasl_max_pool_size=0</code> がプーリングを無効にしないかぎり、<code class="literal">authentication_ldap_sasl_init_pool_size</code> 接続が作成されます。
              </p></li><li class="listitem"><p>
                現在の接続プールに空き接続がないときにプラグインが認可リクエストを受信した場合、プラグインは <code class="literal">authentication_ldap_sasl_max_pool_size</code> で指定された最大接続プールサイズまで新しい接続を作成できます。
              </p></li><li class="listitem"><p>
                プールサイズがすでに最大値に達していて、空き接続がないときにプラグインがリクエストを受信した場合、認証は失敗します。
              </p></li><li class="listitem"><p>
                プラグインがアンロードされると、プールされたすべての接続が閉じられます。
              </p></li></ul></div><p>
            プラグインシステム変数の設定を変更しても、プール内にすでに存在する接続には影響しない可能性があります。 たとえば、LDAP サーバーのホスト、ポートまたは TLS 設定を変更しても、既存の接続には影響しません。 ただし、元の変数値が無効で接続プールを初期化できなかった場合、プラグインは次の LDAP リクエストのためにプールを再初期化しようとします。 この場合、新しいシステム変数値が再初期化の試行に使用されます。 
          </p><p>
            <code class="literal">authentication_ldap_sasl_max_pool_size=0</code> でプーリングを無効にする場合、プラグインによってオープンされる各 LDAP 接続では、その時点でシステム変数に設定されている値が使用されます。
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_log_status"></a>
            <code class="literal">authentication_ldap_sasl_log_status</code>
          </p><a class="indexterm" name="idm46723757844112"></a><a class="indexterm" name="idm46723757842512"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_log_status"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-log-status=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_log_status">authentication_ldap_sasl_log_status</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最大値 (≥ 8.0.18)</th>
<td><code class="literal">6</code></td>
</tr><tr><th>最大値 (≤ 8.0.17)</th>
<td><code class="literal">5</code></td>
</tr></tbody></table></div><a class="indexterm" name="idm46723757813248"></a><p>
            SASL LDAP 認証の場合、エラーログに書き込まれるメッセージのロギングレベル。 次のテーブルに、許可されるレベル値とその意味を示します。 
          </p><div class="table"><a name="idm46723757810496"></a><p class="title"><b>表 6.24 authentication_ldap_sasl_log_status のログレベル</b></p><div class="table-contents"><table summary="authentication_ldap_sasl_log_status system variable option values and types of messages logged per value."><col style="width=30%"><col style="width=70%"><thead><tr>
                <th>オプション値</th>
                <th>記録されるメッセージのタイプ</th>
              </tr></thead><tbody><tr>
                <td><code class="literal">1</code></td>
                <td>メッセージがありません</td>
              </tr><tr>
                <td><code class="literal">2</code></td>
                <td>エラーメッセージ</td>
              </tr><tr>
                <td><code class="literal">3</code></td>
                <td>エラーメッセージと警告メッセージ</td>
              </tr><tr>
                <td><code class="literal">4</code></td>
                <td>エラー、警告および情報メッセージ</td>
              </tr><tr>
                <td><code class="literal">5</code></td>
                <td>MySQL からの以前のレベルおよびデバッグメッセージと同じ</td>
              </tr><tr>
                <td><code class="literal">6</code></td>
                <td>LDAP ライブラリからの前のレベルおよびデバッグメッセージと同じ</td>
              </tr></tbody></table></div></div><br class="table-break"><p>
            ログレベル 6 は、MySQL 8.0.18 で使用できます。
          </p><a class="indexterm" name="idm46723757788656"></a><a class="indexterm" name="idm46723757786480"></a><a class="indexterm" name="idm46723757785024"></a><p>
            クライアント側では、<code class="literal">AUTHENTICATION_LDAP_CLIENT_LOG</code> 環境変数を設定することで、メッセージを標準出力に記録できます。 許可される値とデフォルト値は、<code class="literal">authentication_ldap_sasl_log_status</code> の場合と同じです。 
          </p><p>
            <code class="literal">AUTHENTICATION_LDAP_CLIENT_LOG</code> 環境変数は SASL LDAP 認証にのみ適用されます。 この場合のクライアントプラグインは <code class="literal">mysql_clear_password</code> であり、LDAP 操作については何も認識されないため、単純な LDAP 認証には影響しません。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_max_pool_size"></a>
            <code class="literal">authentication_ldap_sasl_max_pool_size</code>
          </p><a class="indexterm" name="idm46723757775872"></a><a class="indexterm" name="idm46723757774272"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_max_pool_size"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-max-pool-size=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size">authentication_ldap_sasl_max_pool_size</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1000</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">32767</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、LDAP サーバーへの接続プールの最大サイズ。 接続プーリングを無効にするには、この変数を 0 に設定します。 
          </p><p>
            この変数は、<code class="literal">authentication_ldap_sasl_init_pool_size</code> とともに使用されます。 その変数の説明を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_referral"></a>
            <code class="literal">authentication_ldap_sasl_referral</code>
          </p><a class="indexterm" name="idm46723757742656"></a><a class="indexterm" name="idm46723757741056"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_referral"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-referral[={OFF|ON}]</code></td>
</tr><tr><th>導入</th>
<td>8.0.20</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_referral">authentication_ldap_sasl_referral</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">OFF</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、LDAP 検索リフェラルを有効にするかどうか。 <a class="xref" href="security.html#ldap-pluggable-authentication-ldap-referral" title="LDAP 検索照会">LDAP 検索照会</a>を参照してください。 
          </p><p>
            この変数は、デフォルトの OpenLDAP リフェラル構成をオーバーライドするように設定できます。<a class="xref" href="security.html#ldap-pluggable-authentication-ldap-conf" title="LDAP プラガブル認証および ldap.conf">LDAP プラガブル認証および ldap.conf</a> を参照してください
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_server_host"></a>
            <code class="literal">authentication_ldap_sasl_server_host</code>
          </p><a class="indexterm" name="idm46723757711904"></a><a class="indexterm" name="idm46723757710304"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_server_host"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-server-host=host_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_host">authentication_ldap_sasl_server_host</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、LDAP サーバーホスト。 この変数に指定できる値は、認証方法によって異なります: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">authentication_ldap_sasl_auth_method_name=SCRAM-SHA-1</code> の場合: LDAP サーバーホストには、ホスト名または IP アドレスを指定できます。
              </p></li><li class="listitem"><p>
                <code class="literal">authentication_ldap_sasl_auth_method_name=SCRAM-SHA-256</code> の場合: LDAP サーバーホストには、ホスト名または IP アドレスを指定できます。
              </p></li></ul></div></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_server_port"></a>
            <code class="literal">authentication_ldap_sasl_server_port</code>
          </p><a class="indexterm" name="idm46723757683312"></a><a class="indexterm" name="idm46723757681712"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_server_port"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-server-port=port_num</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_port">authentication_ldap_sasl_server_port</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">389</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">32376</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合は、LDAP サーバーの TCP/IP ポート番号。
          </p><p>
            MySQL 8.0.14 では、LDAP ポート番号が 636 または 3269 として構成されている場合、プラグインは LDAP ではなく LDAPS (LDAP over SSL) を使用します。 (LDAPS は <code class="literal">startTLS</code> とは異なります。) 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_tls"></a>
            <code class="literal">authentication_ldap_sasl_tls</code>
          </p><a class="indexterm" name="idm46723757650416"></a><a class="indexterm" name="idm46723757648848"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_tls"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-tls[={OFF|ON}]</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_tls">authentication_ldap_sasl_tls</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">OFF</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、プラグインによる LDAP サーバーへの接続がセキュリティー保護されているかどうか。 この変数が有効な場合、プラグインは TLS を使用して LDAP サーバーにセキュアに接続します。 この変数は、デフォルトの OpenLDAP TLS 構成をオーバーライドするように設定できます。<a class="xref" href="security.html#ldap-pluggable-authentication-ldap-conf" title="LDAP プラガブル認証および ldap.conf">LDAP プラガブル認証および ldap.conf</a> を参照してください。この変数を有効にする場合は、<code class="literal">authentication_ldap_sasl_ca_path</code> 変数も設定できます。 
          </p><p>
            MySQL LDAP プラグインは、プレーン LDAP 接続上で TLS を初期化する StartTLS メソッドをサポートしています。
          </p><p>
            MySQL 8.0.14 では、LDAPS は <code class="literal">authentication_ldap_sasl_server_port</code> システム変数を設定することで使用できます。
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_user_search_attr"></a>
            <code class="literal">authentication_ldap_sasl_user_search_attr</code>
          </p><a class="indexterm" name="idm46723757619280"></a><a class="indexterm" name="idm46723757617664"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_user_search_attr"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-sasl-user-search-attr=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr">authentication_ldap_sasl_user_search_attr</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">uid</code></td>
</tr></tbody></table></div><p>
            SASL LDAP 認証の場合、LDAP ディレクトリエントリ内のユーザー名を指定する属性の名前。 ユーザー識別名が指定されていない場合、認証プラグインはこの属性を使用して名前を検索します。 たとえば、<code class="literal">authentication_ldap_sasl_user_search_attr</code> 値が <code class="literal">uid</code> の場合、ユーザー名 <code class="literal">user1</code> を検索すると、<code class="literal">uid</code> 値が <code class="literal">user1</code> のエントリが検索されます。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_auth_method_name"></a>
            <code class="literal">authentication_ldap_simple_auth_method_name</code>
          </p><a class="indexterm" name="idm46723757588400"></a><a class="indexterm" name="idm46723757586784"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_auth_method_name"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-auth-method-name=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_auth_method_name">authentication_ldap_simple_auth_method_name</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">SIMPLE</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">SIMPLE</code></p><p class="valid-value"><code class="literal">AD-FOREST</code></p></td>
</tr></tbody></table></div><p>
            簡易 LDAP 認証の場合は、認証方式名。 認証プラグインと LDAP サーバー間の通信は、この認証方式に従って行われます。 
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              すべての単純な LDAP 認証方式では、セキュアな接続を介して LDAP サーバーとの通信が行われるように TLS パラメータを設定することもお薦めします。
            </p></div><p>
            次の認証方式の値が許可されます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">SIMPLE</code>: 簡易 LDAP 認証を使用します。 この方法では、MySQL アカウントが LDAP ユーザー識別名を指定しているかどうかに応じて、いずれかまたは 2 つの LDAP バインド操作が使用されます。 <code class="literal">authentication_ldap_simple_bind_root_dn</code> の説明を参照してください。 
              </p></li><li class="listitem"><p>
                <code class="literal">AD-FOREST</code>: 認証によって Active Directory フォレスト内のすべてのドメインが検索され、ユーザーが特定のドメインで見つかるまで各 Active Directory ドメインへの LDAP バインドが実行されるような、<code class="literal">SIMPLE</code> のバリエーション。
              </p></li></ul></div></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_base_dn"></a>
            <code class="literal">authentication_ldap_simple_bind_base_dn</code>
          </p><a class="indexterm" name="idm46723757549792"></a><a class="indexterm" name="idm46723757548192"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_base_dn"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-bind-base-dn=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_base_dn">authentication_ldap_simple_bind_base_dn</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><p>
            単純な LDAP 認証の場合は、ベース識別名 (DN)。 この変数を使用すると、検索ツリー内の特定の場所 (<span class="quote">「<span class="quote">base</span>」</span>) に検索範囲を固定することで、検索範囲を制限できます。 
          </p><p>
            LDAP ユーザーエントリのセットのメンバーがそれぞれ次の形式であるとします:
          </p><pre class="programlisting">uid=<em class="replaceable"><code>user_name</code></em>,ou=People,dc=example,dc=com
</pre><p>
            また、LDAP ユーザーエントリの別のセットのメンバーは、それぞれ次の形式になります:
          </p><pre class="programlisting">uid=<em class="replaceable"><code>user_name</code></em>,ou=Admin,dc=example,dc=com
</pre><p>
            検索は、異なるベース DN 値に対して次のように機能します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                ベース DN が <code class="literal">ou=People,dc=example,dc=com</code> の場合: 検索では、最初のセットのユーザーエントリのみが検索されます。
              </p></li><li class="listitem"><p>
                ベース DN が <code class="literal">ou=Admin,dc=example,dc=com</code> の場合: 検索では、2 番目のセット内のユーザエントリだけが検索されます。
              </p></li><li class="listitem"><p>
                ベース DN が <code class="literal">ou=dc=example,dc=com</code> の場合: 検索では、1 番目または 2 番目のセット内のユーザエントリが検索されます。
              </p></li></ul></div><p>
            一般に、より具体的なベース DN 値を使用すると、検索範囲が制限されるため、検索速度が向上します。
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_root_dn"></a>
            <code class="literal">authentication_ldap_simple_bind_root_dn</code>
          </p><a class="indexterm" name="idm46723757511312"></a><a class="indexterm" name="idm46723757509712"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_root_dn"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-bind-root-dn=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_dn">authentication_ldap_simple_bind_root_dn</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><p>
            単純な LDAP 認証の場合は、ルート識別名 (DN)。 この変数は、検索を実行する目的で LDAP サーバーに対して認証するための資格証明として <code class="literal">authentication_ldap_simple_bind_root_pwd</code> とともに使用されます。 認証では、MySQL アカウントが LDAP ユーザー DN を指定しているかどうかに応じて、次のいずれかまたは 2 つの LDAP バインド操作を使用します: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                アカウントがユーザー DN を指定していない場合: <code class="literal">authentication_ldap_simple</code> は、<code class="literal">authentication_ldap_simple_bind_root_dn</code> および <code class="literal">authentication_ldap_simple_bind_root_pwd</code> を使用して初期 LDAP バインディングを実行します。 (これらは両方ともデフォルトで空であるため、設定しない場合、LDAP サーバーは匿名接続を許可する必要があります。) 生成されたバインド LDAP ハンドルは、クライアントユーザー名に基づいてユーザー DN を検索するために使用されます。<code class="literal">authentication_ldap_simple</code> は、ユーザー DN とクライアント提供のパスワードを使用して、別のバインドを実行します。 
              </p></li><li class="listitem"><p>
                アカウントがユーザー DN を指定する場合: この場合、最初のバインド操作は不要です。<code class="literal">authentication_ldap_simple</code> は、ユーザー DN とクライアント提供のパスワードを使用して単一のバインドを実行します。 これは、MySQL アカウントで LDAP ユーザー DN が指定されていない場合より高速です。 
              </p></li></ul></div></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_root_pwd"></a>
            <code class="literal">authentication_ldap_simple_bind_root_pwd</code>
          </p><a class="indexterm" name="idm46723757475264"></a><a class="indexterm" name="idm46723757473664"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_root_pwd"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-bind-root-pwd=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_pwd">authentication_ldap_simple_bind_root_pwd</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><p>
            簡易 LDAP 認証の場合、ルート識別名のパスワード。 この変数は、<code class="literal">authentication_ldap_simple_bind_root_dn</code> とともに使用されます。 その変数の説明を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_ca_path"></a>
            <code class="literal">authentication_ldap_simple_ca_path</code>
          </p><a class="indexterm" name="idm46723757447456"></a><a class="indexterm" name="idm46723757445856"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_ca_path"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-ca-path=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_ca_path">authentication_ldap_simple_ca_path</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><p>
            簡易 LDAP 認証の場合、認証局ファイルの絶対パス。 認証プラグインで LDAP サーバー証明書の検証を実行する場合は、このファイルを指定します。 
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <code class="literal">authentication_ldap_simple_ca_path</code> 変数をファイル名に設定するだけでなく、適切な認証局の証明書をファイルに追加し、<code class="literal">authentication_ldap_simple_tls</code> システム変数を有効にする必要があります。 これらの変数は、デフォルトの OpenLDAP TLS 構成をオーバーライドするように設定できます。<a class="xref" href="security.html#ldap-pluggable-authentication-ldap-conf" title="LDAP プラガブル認証および ldap.conf">LDAP プラガブル認証および ldap.conf</a> を参照してください 
            </p></div></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_group_search_attr"></a>
            <code class="literal">authentication_ldap_simple_group_search_attr</code>
          </p><a class="indexterm" name="idm46723757416576"></a><a class="indexterm" name="idm46723757414960"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_group_search_attr"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-group-search-attr=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_attr">authentication_ldap_simple_group_search_attr</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">cn</code></td>
</tr></tbody></table></div><p>
            簡易 LDAP 認証の場合、LDAP ディレクトリエントリ内のグループ名を指定する属性の名前。 <code class="literal">authentication_ldap_simple_group_search_attr</code> のデフォルト値が <code class="literal">cn</code> の場合、検索では <code class="literal">cn</code> 値がグループ名として返されます。 たとえば、<code class="literal">uid</code> 値が <code class="literal">user1</code> の LDAP エントリに <code class="literal">mygroup</code> の <code class="literal">cn</code> 属性がある場合、<code class="literal">user1</code> を検索すると、<code class="literal">mygroup</code> がグループ名として返されます。 
          </p><p>
            グループ検索属性が <code class="literal">isMemberOf</code> の場合、LDAP 認証はユーザー属性 <code class="literal">isMemberOf</code> 値を直接取得し、グループ情報として割り当てます。 グループ検索属性が <code class="literal">isMemberOf</code> でない場合、LDAP 認証はユーザーがメンバーであるすべてのグループを検索します。 (後者がデフォルトの動作です。) この動作は、LDAP グループ情報を格納する方法に基づいています: 1) グループエントリは、ユーザー名の値を持つ <code class="literal">memberUid</code> または <code class="literal">member</code> という名前の属性を持つことができます。2) ユーザーエントリは、グループ名の値を持つ <code class="literal">isMemberOf</code> という名前の属性を持つことができます。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_group_search_filter"></a>
            <code class="literal">authentication_ldap_simple_group_search_filter</code>
          </p><a class="indexterm" name="idm46723757376944"></a><a class="indexterm" name="idm46723757375328"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_group_search_filter"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-group-search-filter=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_filter">authentication_ldap_simple_group_search_filter</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">(|(&amp;(objectClass=posixGroup)(memberUid=%s))(&amp;(objectClass=group)(member=%s)))</code></td>
</tr></tbody></table></div><p>
            単純 LDAP 認証の場合は、カスタムグループ検索フィルタ。
          </p><p>
            検索フィルタ値には、ユーザー名と完全なユーザー DN を表す <code class="literal">{UA}</code> および <code class="literal">{UD}</code> 表記を含めることができます。 たとえば、<code class="literal">{UA}</code> は<code class="literal">"admin"</code>などのユーザー名に置き換えられますが、<code class="literal">{UD}</code> は<code class="literal">"uid=admin,ou=People,dc=example,dc=com"</code>などの完全 DN に置き換えられます。 次の値がデフォルトで、OpenLDAP と Active Directory の両方をサポートしています: 
          </p><pre class="programlisting">(|(&amp;(objectClass=posixGroup)(memberUid={UA}))
  (&amp;(objectClass=group)(member={UD})))
</pre><p>
            場合によっては、<code class="literal">memberOf</code> はグループ情報を保持しない単純なユーザー属性です。 柔軟性を高めるために、オプションの <code class="literal">{GA}</code> 接頭辞をグループ検索属性とともに使用できます。 {GA} 接頭辞を持つグループ属性は、グループ名を持つユーザー属性として扱われます。 たとえば、<code class="literal">{GA}MemberOf</code> の値では、グループ値が DN の場合、グループ DN の最初の属性値がグループ名として返されます。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_init_pool_size"></a>
            <code class="literal">authentication_ldap_simple_init_pool_size</code>
          </p><a class="indexterm" name="idm46723757340448"></a><a class="indexterm" name="idm46723757338832"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_init_pool_size"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-init-pool-size=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_init_pool_size">authentication_ldap_simple_init_pool_size</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">10</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">32767</code></td>
</tr></tbody></table></div><p>
            単純な LDAP 認証の場合、LDAP サーバーへの接続プールの初期サイズ。 LDAP サーバーに対する同時認証リクエストの平均数に基づいて、この変数の値を選択します。 
          </p><p>
            プラグインは、<code class="literal">authentication_ldap_simple_init_pool_size</code> と <code class="literal">authentication_ldap_simple_max_pool_size</code> を一緒に使用して接続プールを管理します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                認証プラグインが初期化されると、<code class="literal">authentication_ldap_simple_max_pool_size=0</code> がプーリングを無効にしないかぎり、<code class="literal">authentication_ldap_simple_init_pool_size</code> 接続が作成されます。
              </p></li><li class="listitem"><p>
                現在の接続プールに空き接続がないときにプラグインが認可リクエストを受信した場合、プラグインは <code class="literal">authentication_ldap_simple_max_pool_size</code> で指定された最大接続プールサイズまで新しい接続を作成できます。
              </p></li><li class="listitem"><p>
                プールサイズがすでに最大値に達していて、空き接続がないときにプラグインがリクエストを受信した場合、認証は失敗します。
              </p></li><li class="listitem"><p>
                プラグインがアンロードされると、プールされたすべての接続が閉じられます。
              </p></li></ul></div><p>
            プラグインシステム変数の設定を変更しても、プール内にすでに存在する接続には影響しない可能性があります。 たとえば、LDAP サーバーのホスト、ポートまたは TLS 設定を変更しても、既存の接続には影響しません。 ただし、元の変数値が無効で接続プールを初期化できなかった場合、プラグインは次の LDAP リクエストのためにプールを再初期化しようとします。 この場合、新しいシステム変数値が再初期化の試行に使用されます。 
          </p><p>
            <code class="literal">authentication_ldap_simple_max_pool_size=0</code> でプーリングを無効にする場合、プラグインによってオープンされる各 LDAP 接続では、その時点でシステム変数に設定されている値が使用されます。
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_log_status"></a>
            <code class="literal">authentication_ldap_simple_log_status</code>
          </p><a class="indexterm" name="idm46723757295136"></a><a class="indexterm" name="idm46723757293536"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_log_status"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-log-status=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_log_status">authentication_ldap_simple_log_status</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最大値 (≥ 8.0.18)</th>
<td><code class="literal">6</code></td>
</tr><tr><th>最大値 (≤ 8.0.17)</th>
<td><code class="literal">5</code></td>
</tr></tbody></table></div><a class="indexterm" name="idm46723757264256"></a><p>
            単純な LDAP 認証の場合、エラーログに書き込まれるメッセージのロギングレベル。 次のテーブルに、許可されるレベル値とその意味を示します。 
          </p><div class="table"><a name="idm46723757261488"></a><p class="title"><b>表 6.25 authentication_ldap_simple_log_status のログレベル</b></p><div class="table-contents"><table summary="authentication_ldap_simple_log_status system variable option values and types of messages logged per value."><col style="width=30%"><col style="width=70%"><thead><tr>
                <th>オプション値</th>
                <th>記録されるメッセージのタイプ</th>
              </tr></thead><tbody><tr>
                <td><code class="literal">1</code></td>
                <td>メッセージがありません</td>
              </tr><tr>
                <td><code class="literal">2</code></td>
                <td>エラーメッセージ</td>
              </tr><tr>
                <td><code class="literal">3</code></td>
                <td>エラーメッセージと警告メッセージ</td>
              </tr><tr>
                <td><code class="literal">4</code></td>
                <td>エラー、警告および情報メッセージ</td>
              </tr><tr>
                <td><code class="literal">5</code></td>
                <td>MySQL からの以前のレベルおよびデバッグメッセージと同じ</td>
              </tr><tr>
                <td><code class="literal">6</code></td>
                <td>LDAP ライブラリからの前のレベルおよびデバッグメッセージと同じ</td>
              </tr></tbody></table></div></div><br class="table-break"><p>
            ログレベル 6 は、MySQL 8.0.18 で使用できます。
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_max_pool_size"></a>
            <code class="literal">authentication_ldap_simple_max_pool_size</code>
          </p><a class="indexterm" name="idm46723757237456"></a><a class="indexterm" name="idm46723757235856"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_max_pool_size"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-max-pool-size=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size">authentication_ldap_simple_max_pool_size</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1000</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">32767</code></td>
</tr></tbody></table></div><p>
            簡易 LDAP 認証の場合、LDAP サーバーへの接続プールの最大サイズ。 接続プーリングを無効にするには、この変数を 0 に設定します。 
          </p><p>
            この変数は、<code class="literal">authentication_ldap_simple_init_pool_size</code> とともに使用されます。 その変数の説明を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_referral"></a>
            <code class="literal">authentication_ldap_simple_referral</code>
          </p><a class="indexterm" name="idm46723757204112"></a><a class="indexterm" name="idm46723757202512"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_referral"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-referral[={OFF|ON}]</code></td>
</tr><tr><th>導入</th>
<td>8.0.20</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_referral">authentication_ldap_simple_referral</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">OFF</code></td>
</tr></tbody></table></div><p>
            単純な LDAP 認証の場合、LDAP 検索リフェラルを有効にするかどうか。 <a class="xref" href="security.html#ldap-pluggable-authentication-ldap-referral" title="LDAP 検索照会">LDAP 検索照会</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_server_host"></a>
            <code class="literal">authentication_ldap_simple_server_host</code>
          </p><a class="indexterm" name="idm46723757174816"></a><a class="indexterm" name="idm46723757173216"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_server_host"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-server-host=host_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_server_host">authentication_ldap_simple_server_host</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            単純な LDAP 認証の場合は、LDAP サーバーホスト。 この変数に指定できる値は、認証方法によって異なります: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">authentication_ldap_simple_auth_method_name=SIMPLE</code> の場合: LDAP サーバーホストには、ホスト名または IP アドレスを指定できます。
              </p></li><li class="listitem"><p>
                <code class="literal">authentication_ldap_simple_auth_method_name=AD-FOREST</code> の場合。 LDAP サーバーホストには、Active Directory ドメイン名を指定できます。 たとえば、LDAP サーバー URL が <code class="literal">ldap://example.mem.local:389</code> の場合、サーバー名は <code class="literal">mem.local</code> になります。 
              </p><a class="indexterm" name="idm46723757147168"></a><p>
                Active Directory フォレスト設定には、DNS を使用して検出できる複数のドメイン (LDAP サーバー IP) を含めることができます。 Unix および Unix に似たシステムでは、Active Directory ドメインの LDAP サーバーを指定する SRV レコードを使用して DNS サーバーを構成するために、いくつかの追加設定が必要になる場合があります。 DNS SRV の詳細は、<a class="ulink" href="https://tools.ietf.org/html/rfc2782" target="_top">RFC 2782</a> を参照してください。 
              </p><p>
                構成に次のプロパティがあるとします:
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    Active Directory ドメインに関する情報を提供するネームサーバーには、IP アドレス <code class="literal">10.172.166.100</code> があります。
                  </p></li><li class="listitem"><p>
                    LDAP サーバーの名前は <code class="literal">ldap1.mem.local</code> から <code class="literal">ldap3.mem.local</code> で、IP アドレスは <code class="literal">10.172.166.101</code> から <code class="literal">10.172.166.103</code> です。
                  </p></li></ul></div><p>
                SRV 検索を使用して LDAP サーバーを検出できるようにします。 たとえば、コマンドラインでは、次のようなコマンドで LDAP サーバーをリストする必要があります: 
              </p><pre class="programlisting">host -t SRV _ldap._tcp.mem.local
</pre><p>
                次のように DNS 構成を実行します:
              </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                    <code class="filename">/etc/resolv.conf</code> に行を追加して、Active Directory ドメインに関する情報を提供するネームサーバーを指定します:
                  </p><pre class="programlisting">nameserver 10.172.166.100
</pre></li><li class="listitem"><p>
                    LDAP サーバーの SRV レコードを使用して、ネームサーバーの適切なゾーンファイルを構成します:
                  </p><pre class="programlisting">_ldap._tcp.mem.local. 86400 IN SRV 0 100 389 ldap1.mem.local.
_ldap._tcp.mem.local. 86400 IN SRV 0 100 389 ldap2.mem.local.
_ldap._tcp.mem.local. 86400 IN SRV 0 100 389 ldap3.mem.local.
</pre></li><li class="listitem"><p>
                    サーバーホストを解決できない場合は、<code class="filename">/etc/hosts</code> で LDAP サーバーの IP アドレスを指定する必要がある場合もあります。 たとえば、次のような行をファイルに追加します: 
                  </p><pre class="programlisting">10.172.166.101 ldap1.mem.local
10.172.166.102 ldap2.mem.local
10.172.166.103 ldap3.mem.local
</pre></li></ol></div><p>
                前述のように DNS を構成すると、サーバー側 LDAP プラグインは LDAP サーバーを検出し、認証が成功するかサーバーがなくなるまで、すべてのドメインで認証を試行できます。
              </p><p>
                ここで説明したような設定は必要ありません。 <code class="literal">authentication_ldap_simple_server_host</code> 値に LDAP サーバーホストが指定されている場合、Windows LDAP ライブラリはすべてのドメインを検索し、認証を試みます。 
              </p></li></ul></div></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_server_port"></a>
            <code class="literal">authentication_ldap_simple_server_port</code>
          </p><a class="indexterm" name="idm46723757120816"></a><a class="indexterm" name="idm46723757119216"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_server_port"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-server-port=port_num</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_server_port">authentication_ldap_simple_server_port</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">389</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">32376</code></td>
</tr></tbody></table></div><p>
            単純な LDAP 認証の場合は、LDAP サーバーの TCP/IP ポート番号。
          </p><p>
            MySQL 8.0.14 では、LDAP ポート番号が 636 または 3269 として構成されている場合、プラグインは LDAP ではなく LDAPS (LDAP over SSL) を使用します。 (LDAPS は <code class="literal">startTLS</code> とは異なります。) 
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_tls"></a>
            <code class="literal">authentication_ldap_simple_tls</code>
          </p><a class="indexterm" name="idm46723757087968"></a><a class="indexterm" name="idm46723757086400"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_tls"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-tls[={OFF|ON}]</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_tls">authentication_ldap_simple_tls</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">OFF</code></td>
</tr></tbody></table></div><p>
            単純な LDAP 認証の場合、プラグインによる LDAP サーバーへの接続がセキュリティー保護されているかどうか。 この変数が有効な場合、プラグインは TLS を使用して LDAP サーバーにセキュアに接続します。 この変数は、デフォルトの OpenLDAP TLS 構成をオーバーライドするように設定できます。<a class="xref" href="security.html#ldap-pluggable-authentication-ldap-conf" title="LDAP プラガブル認証および ldap.conf">LDAP プラガブル認証および ldap.conf</a> を参照してください。この変数を有効にする場合は、<code class="literal">authentication_ldap_simple_ca_path</code> 変数も設定できます。 
          </p><p>
            MySQL LDAP プラグインは、プレーン LDAP 接続上で TLS を初期化する StartTLS メソッドをサポートしています。
          </p><p>
            MySQL 8.0.14 では、LDAPS は <code class="literal">authentication_ldap_simple_server_port</code> システム変数を設定することで使用できます。
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_user_search_attr"></a>
            <code class="literal">authentication_ldap_simple_user_search_attr</code>
          </p><a class="indexterm" name="idm46723757056912"></a><a class="indexterm" name="idm46723757055296"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for authentication_ldap_simple_user_search_attr"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--authentication-ldap-simple-user-search-attr=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr">authentication_ldap_simple_user_search_attr</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">uid</code></td>
</tr></tbody></table></div><p>
            簡易 LDAP 認証の場合、LDAP ディレクトリエントリ内のユーザー名を指定する属性の名前。 ユーザー識別名が指定されていない場合、認証プラグインはこの属性を使用して名前を検索します。 たとえば、<code class="literal">authentication_ldap_simple_user_search_attr</code> 値が <code class="literal">uid</code> の場合、ユーザー名 <code class="literal">user1</code> を検索すると、<code class="literal">uid</code> 値が <code class="literal">user1</code> のエントリが検索されます。 
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="connection-control"></a>6.4.2 Connection-Control プラグイン</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#connection-control-installation">6.4.2.1 Connection-Control プラグインのインストール</a></span></dt><dt><span class="section"><a href="security.html#connection-control-variables">6.4.2.2 Connection-Control のシステム変数とステータス変数</a></span></dt></dl></div><p>
      MySQL Server にはプラグインライブラリが含まれており、これを使用すると、管理者は、構成可能な連続して失敗した試行回数のあとに、接続試行に対するサーバー応答の遅延を増やすことができます。 この機能は、MySQL ユーザーアカウントに対する総当たり攻撃の速度を低下させる抑止機能を提供します。 プラグインライブラリには、次の 2 つのプラグインが含まれます: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">CONNECTION_CONTROL</code> は着信接続試行をチェックし、必要に応じてサーバーレスポンスに遅延を追加します。 このプラグインは、操作を構成できるシステム変数と、基本的なモニタリング情報を提供するステータス変数も公開します。 
        </p><p>
          <code class="literal">CONNECTION_CONTROL</code> プラグインは、監査プラグインインタフェースを使用します (<a class="ulink" href="https://dev.mysql.com/doc/extending-mysql/8.0/en/writing-audit-plugins.html" target="_top">Writing Audit Plugins</a> を参照)。 情報を収集するために、<code class="literal">MYSQL_AUDIT_CONNECTION_CLASSMASK</code> イベントクラスをサブスクライブし、<code class="literal">MYSQL_AUDIT_CONNECTION_CONNECT</code> および <code class="literal">MYSQL_AUDIT_CONNECTION_CHANGE_USER</code> サブイベントを処理して、接続試行に応答する前にサーバーが遅延を導入する必要があるかどうかを確認します。 
        </p></li><li class="listitem"><p>
          <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code> は、失敗した接続試行に関するより詳細な監視情報を公開する <code class="literal">INFORMATION_SCHEMA</code> テーブルを実装します。
        </p></li></ul></div><p>
      次の各セクションでは、接続制御プラグインのインストールおよび構成について説明します。 <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code> テーブルの詳細は、<a class="xref" href="information-schema.html#information-schema-connection-control-failed-login-attempts-table" title="26.53.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS テーブル">セクション26.53.1「INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS テーブル」</a> を参照してください。 
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="connection-control-installation"></a>6.4.2.1 Connection-Control プラグインのインストール</h4></div></div></div><a class="indexterm" name="idm46723757011840"></a><a class="indexterm" name="idm46723757009680"></a><a class="indexterm" name="idm46723757007728"></a><a class="indexterm" name="idm46723757005520"></a><p>
        このセクションでは、接続制御プラグイン、<code class="literal">CONNECTION_CONTROL</code> および <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code> をインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
      </p><p>
        サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
      </p><p>
        プラグインライブラリファイルのベース名は <code class="literal">connection_control</code> です。 ファイル名の接尾辞は、プラットフォームごとに異なります (たとえば、<code class="filename">.so</code> for Unix and Unix-like systems, <code class="filename">.dll</code> for Windows)。 
      </p><p>
        サーバーの起動時にプラグインをロードするには、<code class="option">--plugin-load-add</code> オプションを使用して、プラグインを含むライブラリファイルに名前を付けます。 このプラグインのロード方式では、サーバーを起動するたびにオプションを指定する必要があります。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルに次の行を入力し、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します: 
      </p><pre class="programlisting">[mysqld]
plugin-load-add=connection_control.so
</pre><p>
        <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
      </p><p>
        または、実行時にプラグインをロードするには、次のステートメントを使用して、プラットフォームの <code class="filename">.so</code> 接尾辞を必要に応じて調整します:
      </p><pre class="programlisting">INSTALL PLUGIN CONNECTION_CONTROL
  SONAME 'connection_control.so';
INSTALL PLUGIN CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS
  SONAME 'connection_control.so';
</pre><p>
        <code class="literal">INSTALL PLUGIN</code> はプラグインをただちにロードし、<code class="literal">mysql.plugins</code> システムテーブルにも登録して、<code class="option">--plugin-load-add</code> を必要とせずに後続の通常の起動のたびにサーバーがプラグインをロードするようにします。
      </p><p>
        プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'connection%';</code></strong>
+------------------------------------------+---------------+
| PLUGIN_NAME                              | PLUGIN_STATUS |
+------------------------------------------+---------------+
| CONNECTION_CONTROL                       | ACTIVE        |
| CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS | ACTIVE        |
+------------------------------------------+---------------+
</pre><p>
        プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
      </p><p>
        プラグインが以前に <code class="literal">INSTALL PLUGIN</code> に登録されているか、<code class="option">--plugin-load-add</code> にロードされている場合は、サーバーの起動時に <code class="option">--connection-control</code> および <code class="option">--connection-control-failed-login-attempts</code> オプションを使用してプラグインのアクティブ化を制御できます。 たとえば、起動時にプラグインをロードし、実行時に削除されないようにするには、次のオプションを使用します: 
      </p><pre class="programlisting">[mysqld]
plugin-load-add=connection_control.so
connection-control=FORCE_PLUS_PERMANENT
connection-control-failed-login-attempts=FORCE_PLUS_PERMANENT
</pre><p>
        指定された接続制御プラグインなしでサーバーが実行されないようにするには、<code class="literal">FORCE</code> または <code class="literal">FORCE_PLUS_PERMANENT</code> のオプション値を使用して、プラグインが正常に初期化されない場合にサーバーの起動が強制的に失敗するようにします。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          一方のプラグインをもう一方のプラグインなしでインストールすることは可能ですが、完全な接続制御機能を使用するには両方をインストールする必要があります。 特に、<code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code> プラグインのみのインストールはほとんど使用されません。これは、<code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code> テーブルに移入するデータを提供する <code class="literal">CONNECTION_CONTROL</code> プラグインがない場合、テーブルは常に空になるためです。 
        </p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-delay-configuration" title="接続遅延の構成">接続遅延の構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-failure-assessment" title="接続失敗評価">接続失敗評価</a></p></li><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-failure-monitoring" title="接続失敗のモニタリング">接続失敗のモニタリング</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="connection-control-plugin-delay-configuration"></a>接続遅延の構成</h5></div></div></div><p>
          操作の構成を有効にするために、<code class="literal">CONNECTION_CONTROL</code> プラグインは次のシステム変数を公開します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">connection_control_failed_connections_threshold</code>: サーバーが後続の接続試行の遅延を追加する前に、アカウントに対して許可された連続して失敗した接続試行の数。 失敗した接続カウントを無効にするには、<code class="literal">connection_control_failed_connections_threshold</code> をゼロに設定します。 
            </p></li><li class="listitem"><p>
              <code class="literal">connection_control_min_connection_delay</code>: しきい値を超える接続失敗の最小遅延 (ミリ秒)。
            </p></li><li class="listitem"><p>
              <code class="literal">connection_control_max_connection_delay</code>: しきい値を超える接続失敗の最大遅延 (ミリ秒)。
            </p></li></ul></div><p>
          <code class="literal">connection_control_failed_connections_threshold</code> がゼロ以外の場合、失敗した接続カウントは有効になり、次のプロパティがあります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">connection_control_failed_connections_threshold</code> による接続試行の連続失敗により、遅延はゼロになります。
            </p></li><li class="listitem"><p>
              その後、サーバーは、接続が成功するまで、後続の連続した試行の遅延を増やします。 未調整の初期遅延は 1000 ミリ秒 (1 秒) から始まり、試行ごとに 1000 ミリ秒増加します。 つまり、アカウントに対して遅延がアクティブ化されると、後続の失敗した試行の未調整の遅延は 1000 ミリ秒、2000 ミリ秒、3000 ミリ秒などになります。 
            </p></li><li class="listitem"><p>
              クライアントで発生する実際の遅延は、<code class="literal">connection_control_min_connection_delay</code> および <code class="literal">connection_control_max_connection_delay</code> システム変数の値内に収まるように調整された未調整の遅延です。
            </p></li><li class="listitem"><p>
              アカウントの遅延がアクティブ化されると、そのアカウントによって成功した最初の接続でも遅延が発生しますが、後続の接続の失敗カウントはリセットされます。
            </p></li></ul></div><p>
          たとえば、デフォルトの <code class="literal">connection_control_failed_connections_threshold</code> 値が 3 の場合、アカウントによる最初の 3 回連続して失敗した接続試行は遅延されません。 4 番目および後続の失敗した接続のために発生する実際の調整済遅延は、<code class="literal">connection_control_min_connection_delay</code> および <code class="literal">connection_control_max_connection_delay</code> の値によって異なります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">connection_control_min_connection_delay</code> および <code class="literal">connection_control_max_connection_delay</code> が 1000 および 20000 の場合、調整された遅延は未調整の遅延と同じで、最大 20000 ミリ秒です。 4 番目以降に失敗した接続は 1000 ミリ秒、2000 ミリ秒、3000 ミリ秒など遅延します。 
            </p></li><li class="listitem"><p>
              <code class="literal">connection_control_min_connection_delay</code> および <code class="literal">connection_control_max_connection_delay</code> が 1500 および 20000 の場合、4 番目および後続の失敗した接続の調整済遅延は 1500 ミリ秒、2000 ミリ秒、3000 ミリ秒などで、最大 20000 ミリ秒です。
            </p></li><li class="listitem"><p>
              <code class="literal">connection_control_min_connection_delay</code> および <code class="literal">connection_control_max_connection_delay</code> が 2000 および 3000 の場合、4 番目以降に失敗した接続の調整済遅延は 2000 ミリ秒、2000 ミリ秒および 3000 ミリ秒で、後続のすべての失敗した接続も 3000 ミリ秒遅延します。
            </p></li></ul></div><p>
          <code class="literal">CONNECTION_CONTROL</code> システム変数は、サーバーの起動時または実行時に設定できます。 サーバーがレスポンスの遅延を開始する前に、2000 ミリ秒の最小遅延で 4 回連続して失敗した接続試行を許可するとします。 サーバーの起動時に関連する変数を設定するには、サーバーの <code class="filename">my.cnf</code> ファイルに次の行を挿入します: 
        </p><pre class="programlisting">[mysqld]
plugin-load-add=connection_control.so
connection_control_failed_connections_threshold=4
connection_control_min_connection_delay=2000
</pre><p>
          実行時に変数を設定して永続化するには、次のステートメントを使用します:
        </p><pre class="programlisting">SET PERSIST connection_control_failed_connections_threshold = 4;
SET PERSIST connection_control_min_connection_delay = 2000;
</pre><p>
          <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、値が保存され、その後のサーバーの再起動に引き継がれます。 後続の再起動に引き継ぐことなく、実行中の MySQL インスタンスの値を変更するには、<code class="literal">PERSIST</code> ではなく <code class="literal">GLOBAL</code> キーワードを使用します。 <a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a>を参照してください。 
        </p><p>
          <code class="literal">connection_control_min_connection_delay</code> および <code class="literal">connection_control_max_connection_delay</code> システム変数の最小値と最大値はどちらも 1000 および 2147483647 です。 また、各変数に許可される値の範囲は、他の変数の現在の値によっても異なります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">connection_control_min_connection_delay</code> は、<code class="literal">connection_control_max_connection_delay</code> の現在の値より大きく設定できません。
            </p></li><li class="listitem"><p>
              <code class="literal">connection_control_max_connection_delay</code> は、<code class="literal">connection_control_min_connection_delay</code> の現在の値より小さく設定できません。
            </p></li></ul></div><p>
          したがって、一部の構成に必要な変更を行うには、特定の順序で変数を設定する必要がある場合があります。 現在の最小遅延および最大遅延が 1000 および 2000 で、3000 および 5000 に設定するとします。 現在の <code class="literal">connection_control_max_connection_delay</code> 値 2000 より大きいため、最初に <code class="literal">connection_control_min_connection_delay</code> を 3000 に設定することはできません。 かわりに、<code class="literal">connection_control_max_connection_delay</code> を 5000 に設定してから、<code class="literal">connection_control_min_connection_delay</code> を 3000 に設定します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="connection-control-plugin-failure-assessment"></a>接続失敗評価</h5></div></div></div><p>
          <code class="literal">CONNECTION_CONTROL</code> プラグインがインストールされると、接続試行がチェックされ、失敗したか成功したかが追跡されます。 このため、失敗した接続試行は、クライアントユーザーとホストが既知の MySQL アカウントと一致するが、指定された資格証明が正しくないか、既知のアカウントと一致しない接続試行です。 
        </p><p>
          失敗した接続数は、各接続試行のユーザー/ホストの組合せに基づきます。 適用可能なユーザー名とホスト名を決定すると、プロキシが考慮され、次のようになります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              クライアントユーザーが別のユーザーをプロキシする場合、失敗した接続カウントのアカウントはプロキシユーザーではなくプロキシユーザーです。 たとえば、<code class="literal">external_user@example.com</code> が <code class="literal">proxy_user@example.com</code> をプロキシする場合、接続カウントでは、プロキシユーザーである <code class="literal">proxy_user@example.com</code> ではなく、プロキシユーザーである <code class="literal">external_user@example.com</code> が使用されます。 <code class="literal">external_user@example.com</code> と <code class="literal">proxy_user@example.com</code> の両方で、<code class="literal">mysql.user</code> システムテーブルに有効なエントリがあり、それらの間のプロキシ関係が <code class="literal">mysql.proxies_priv</code> システムテーブルで定義されている必要があります (<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照)。 
            </p></li><li class="listitem"><p>
              クライアントユーザーが別のユーザーをプロキシしないが、<code class="literal">mysql.user</code> エントリと一致する場合、カウントではそのエントリに対応する <code class="literal">CURRENT_USER()</code> 値が使用されます。 たとえば、ホスト <code class="literal">host1.example.com</code> から接続しているユーザー <code class="literal">user1</code> が <code class="literal">user1@host1.example.com</code> エントリと一致する場合、カウントには <code class="literal">user1@host1.example.com</code> が使用されます。 かわりに、ユーザーが <code class="literal">user1@%.example.com</code>、<code class="literal">user1@%.com</code> または <code class="literal">user1@%</code> エントリと一致する場合、カウントではそれぞれ <code class="literal">user1@%.example.com</code>、<code class="literal">user1@%.com</code> または <code class="literal">user1@%</code> が使用されます。 
            </p></li></ul></div><p>
          前述のケースでは、接続試行は <code class="literal">mysql.user</code> エントリと一致し、リクエストが成功するか失敗するかは、クライアントが正しい認証資格証明を提供するかどうかによって決まります。 たとえば、クライアントが間違ったパスワードを提示した場合、接続の試行は失敗します。 
        </p><p>
          接続試行が <code class="literal">mysql.user</code> エントリと一致しない場合、試行は失敗します。 この場合、使用可能な <code class="literal">CURRENT_USER()</code> 値はなく、接続失敗カウントでは、サーバーによって決定されたクライアントおよびクライアントホストによって指定されたユーザー名が使用されます。 たとえば、クライアントがホスト <code class="literal">host2.example.com</code> からユーザー <code class="literal">user2</code> として接続しようとすると、クライアントリクエストでユーザー名の部分が使用可能になり、サーバーによってホスト情報が決定されます。 カウントに使用されるユーザー/ホストの組合せは <code class="literal">user2@host2.example.com</code> です。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            サーバーは、サーバーに接続できるクライアントホストに関する情報を保持します (基本的に、<code class="literal">mysql.user</code> エントリのホスト値の和集合)。 クライアントが他のホストから接続しようとすると、サーバーは接続設定の初期段階で試行を拒否します: 
          </p><pre class="programlisting">ERROR 1130 (HY000): Host '<em class="replaceable"><code>host_name</code></em>' is not
allowed to connect to this MySQL server
</pre><p>
            このタイプの拒否は非常に早く発生するため、<code class="literal">CONNECTION_CONTROL</code> ではそれは表示されず、カウントされません。
          </p></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="connection-control-plugin-failure-monitoring"></a>接続失敗のモニタリング</h5></div></div></div><p>
          失敗した接続を監視するには、次の情報ソースを使用します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">Connection_control_delay_generated</code> ステータス変数は、失敗した接続試行に対するレスポンスにサーバーが遅延を追加した回数を示します。 これにより、<code class="literal">connection_control_failed_connections_threshold</code> システム変数で定義されたしきい値に達するまでに発生する試行はカウントされません。 
            </p></li><li class="listitem"><p>
              <code class="literal">INFORMATION_SCHEMA</code> <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code> テーブルには、アカウント (ユーザー/ホストの組合せ) ごとの接続試行の現在の連続失敗回数に関する情報が表示されます。 これにより、遅延したかどうかに関係なく、失敗したすべての試行がカウントされます。 
            </p></li></ul></div><p>
          実行時に <code class="literal">connection_control_failed_connections_threshold</code> に値を割り当てると、次の効果があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              累積されたすべての失敗した接続カウンタがゼロにリセットされます。
            </p></li><li class="listitem"><p>
              <code class="literal">Connection_control_delay_generated</code> ステータス変数はゼロにリセットされます。
            </p></li><li class="listitem"><p>
              <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code> テーブルが空になります。
            </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="connection-control-variables"></a>6.4.2.2 Connection-Control のシステム変数とステータス変数</h4></div></div></div><p>
        このセクションでは、操作を構成およびモニターできるようにするために <code class="literal">CONNECTION_CONTROL</code> プラグインが提供するシステム変数とステータス変数について説明します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-system-variables" title="Connection-Control システム変数">Connection-Control システム変数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-status-variables" title="接続制御ステータス変数">接続制御ステータス変数</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="connection-control-plugin-system-variables"></a>Connection-Control システム変数</h5></div></div></div><a class="indexterm" name="idm46723756844272"></a><p>
          <code class="literal">CONNECTION_CONTROL</code> プラグインがインストールされている場合は、次のシステム変数が公開されます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_connection_control_failed_connections_threshold"></a>
              <code class="literal">connection_control_failed_connections_threshold</code>
            </p><a class="indexterm" name="idm46723756838768"></a><a class="indexterm" name="idm46723756837136"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for connection_control_failed_connections_threshold"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--connection-control-failed-connections-threshold=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold">connection_control_failed_connections_threshold</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">3</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">2147483647</code></td>
</tr></tbody></table></div><p>
              サーバーが後続の接続試行の遅延を追加する前に、アカウントに対して許可された連続して失敗した接続試行の数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  変数にゼロ以外の値の <em class="replaceable"><code>N</code></em> がある場合、サーバーは連続して失敗した試行 <em class="replaceable"><code>N</code></em>+1 から始まる遅延を追加します。 アカウントが接続レスポンスの遅延ポイントに到達すると、次の成功した接続に対しても遅延が発生します。 
                </p></li><li class="listitem"><p>
                  この変数をゼロに設定すると、失敗した接続カウントが無効になります。 この場合、サーバーは遅延を追加しません。 
                </p></li></ul></div><p>
              <code class="literal">connection_control_failed_connections_threshold</code> と他の接続制御システムおよびステータス変数との相互作用の詳細は、<a class="xref" href="security.html#connection-control-installation" title="6.4.2.1 Connection-Control プラグインのインストール">セクション6.4.2.1「Connection-Control プラグインのインストール」</a> を参照してください。
            </p></li><li class="listitem"><p><a name="sysvar_connection_control_max_connection_delay"></a>
              <code class="literal">connection_control_max_connection_delay</code>
            </p><a class="indexterm" name="idm46723756800880"></a><a class="indexterm" name="idm46723756799280"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for connection_control_max_connection_delay"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--connection-control-max-connection-delay=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_connection_control_max_connection_delay">connection_control_max_connection_delay</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">2147483647</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">1000</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">2147483647</code></td>
</tr><tr><th>単位</th>
<td><code class="literal">milliseconds</code></td>
</tr></tbody></table></div><p>
              <code class="literal">connection_control_failed_connections_threshold</code> がゼロより大きい場合の、失敗した接続試行に対するサーバーレスポンスの最大遅延 (ミリ秒)。
            </p><p>
              <code class="literal">connection_control_max_connection_delay</code> と他の接続制御システムおよびステータス変数との相互作用の詳細は、<a class="xref" href="security.html#connection-control-installation" title="6.4.2.1 Connection-Control プラグインのインストール">セクション6.4.2.1「Connection-Control プラグインのインストール」</a> を参照してください。
            </p></li><li class="listitem"><p><a name="sysvar_connection_control_min_connection_delay"></a>
              <code class="literal">connection_control_min_connection_delay</code>
            </p><a class="indexterm" name="idm46723756763600"></a><a class="indexterm" name="idm46723756762000"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for connection_control_min_connection_delay"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--connection-control-min-connection-delay=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_connection_control_min_connection_delay">connection_control_min_connection_delay</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1000</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">1000</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">2147483647</code></td>
</tr><tr><th>単位</th>
<td><code class="literal">milliseconds</code></td>
</tr></tbody></table></div><p>
              <code class="literal">connection_control_failed_connections_threshold</code> がゼロより大きい場合の、失敗した接続試行に対するサーバーレスポンスの最小遅延 (ミリ秒)。
            </p><p>
              <code class="literal">connection_control_min_connection_delay</code> と他の接続制御システムおよびステータス変数との相互作用の詳細は、<a class="xref" href="security.html#connection-control-installation" title="6.4.2.1 Connection-Control プラグインのインストール">セクション6.4.2.1「Connection-Control プラグインのインストール」</a> を参照してください。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="connection-control-plugin-status-variables"></a>接続制御ステータス変数</h5></div></div></div><a class="indexterm" name="idm46723756726992"></a><p>
          <code class="literal">CONNECTION_CONTROL</code> プラグインがインストールされている場合、次のステータス変数が公開されます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Connection_control_delay_generated"></a>
              <code class="literal">Connection_control_delay_generated</code>
            </p><a class="indexterm" name="idm46723756721440"></a><a class="indexterm" name="idm46723756719840"></a><p>
              失敗した接続試行に対するレスポンスにサーバーが遅延を追加した回数。 これにより、<code class="literal">connection_control_failed_connections_threshold</code> システム変数で定義されたしきい値に達するまでに発生する試行はカウントされません。 
            </p><p>
              この変数は単純なカウンタを提供します。 接続制御モニタリング情報の詳細は、<code class="literal">INFORMATION_SCHEMA</code> <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code> テーブルを確認してください。<a class="xref" href="information-schema.html#information-schema-connection-control-failed-login-attempts-table" title="26.53.1 INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS テーブル">セクション26.53.1「INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS テーブル」</a> を参照してください。 
            </p><p>
              実行時に <code class="literal">connection_control_failed_connections_threshold</code> に値を割り当てると、<code class="literal">Connection_control_delay_generated</code> はゼロにリセットされます。
            </p></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="validate-password"></a>6.4.3 パスワード検証コンポーネント</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#validate-password-installation">6.4.3.1 パスワード検証コンポーネントのインストールおよびアンインストール</a></span></dt><dt><span class="section"><a href="security.html#validate-password-options-variables">6.4.3.2 パスワード検証オプションおよび変数</a></span></dt><dt><span class="section"><a href="security.html#validate-password-transitioning">6.4.3.3 パスワード検証コンポーネントへの移行</a></span></dt></dl></div><a class="indexterm" name="idm46723756708208"></a><a class="indexterm" name="idm46723756706704"></a><a class="indexterm" name="idm46723756705296"></a><a class="indexterm" name="idm46723756703920"></a><p>
      <code class="literal">validate_password</code> コンポーネントは、アカウントパスワードを要求し、潜在的なパスワードの強度テストを有効にすることで、セキュリティを向上させます。 このコンポーネントは、コンポーネント監視用のパスワードポリシーおよびステータス変数を構成できるシステム変数を公開します。 
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        MySQL 8.0 では、<code class="literal">validate_password</code> プラグインが <code class="literal">validate_password</code> コンポーネントとして再実装されました。 (コンポーネントの一般情報は、<a class="xref" href="server-administration.html#components" title="5.5 MySQL のコンポーネント">セクション5.5「MySQL のコンポーネント」</a> を参照してください。) 次の手順では、プラグインではなくコンポーネントの使用方法について説明します。 プラグインフォームの <code class="literal">validate_password</code> を使用する手順は、<a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/" target="_top">MySQL 5.7 Reference Manual</a> の <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/validate-password.html" target="_top">The Password Validation Plugin</a> を参照してください。 
      </p><p>
        <code class="literal">validate_password</code> のプラグインフォームは引き続き使用できますが、非推奨になっています。将来のバージョンの MySQL で削除される予定です。 プラグインを使用する MySQL インストールでは、かわりにコンポーネントの使用に移行する必要があります。 <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 パスワード検証コンポーネントへの移行">セクション6.4.3.3「パスワード検証コンポーネントへの移行」</a>を参照してください。 
      </p></div><p>
      <code class="literal">validate_password</code> コンポーネントは、次の機能を実装します:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          クリアテキスト値として指定されたパスワードを割り当てる SQL ステートメントの場合、<code class="literal">validate_password</code> は現在のパスワードポリシーに対してパスワードをチェックし、弱い場合はパスワードを拒否します (ステートメントは <code class="literal">ER_NOT_VALID_PASSWORD</code> エラーを返します)。 これは、<code class="literal">ALTER USER</code>、<code class="literal">CREATE USER</code> および <code class="literal">SET PASSWORD</code> ステートメントに適用されます。 
        </p></li><li class="listitem"><p>
          <code class="literal">CREATE USER</code> ステートメントの場合、<code class="literal">validate_password</code> ではパスワードを指定する必要があり、パスワードポリシーを満たしている必要があります。 これは、アカウントが最初にロックされている場合でも当てはまります。アカウントを後でロック解除すると、ポリシーを満たすパスワードなしでアクセス可能になるためです。 
        </p></li><li class="listitem"><p>
          <code class="literal">validate_password</code> には、潜在的なパスワードの強度を評価する <code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> SQL 関数が実装されています。 この関数は、パスワード引数を取り、0 (弱い) から 100 (強い) までの整数を返します。 
        </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        アカウントパスワード (<code class="literal">ALTER USER</code>、<code class="literal">CREATE USER</code> および <code class="literal">SET PASSWORD</code>) を割当てまたは変更するステートメントの場合、ここで説明する <code class="literal">validate_password</code> 機能は、MySQL に内部的に資格証明を格納する認証プラグインを使用するアカウントにのみ適用されます。 MySQL 外部の資格証明システムに対して認証を実行するプラグインを使用するアカウントの場合、パスワード管理もそのシステムに対して外部で処理する必要があります。 内部資格証明記憶域の詳細は、<a class="xref" href="security.html#password-management" title="6.2.15 パスワード管理">セクション6.2.15「パスワード管理」</a> を参照してください。 
      </p><p>
        前述の制限は、アカウントに直接影響しないため、<code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> 関数の使用には適用されません。
      </p></div><p>
      例:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">validate_password</code> は、次のステートメントでクリアテキストパスワードを確認します。 デフォルトのパスワードポリシーではパスワードに最低 8 文字の長さが要求されるため、パスワードが弱いことからステートメントはエラーを生成します。 
        </p><a class="indexterm" name="idm46723756668528"></a><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER USER USER() IDENTIFIED BY 'abc';</code></strong>
ERROR 1819 (HY000): Your password does not satisfy the current
policy requirements
</pre></li><li class="listitem"><p>
          元のパスワード値はチェックに使用できないため、ハッシュ値として指定されたパスワードはチェックされません:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>ALTER USER 'jeffrey'@'localhost'</code></strong>
       <strong class="userinput"><code>IDENTIFIED WITH mysql_native_password</code></strong>
       <strong class="userinput"><code>AS '*0D3CED9BEC10A777AEC23CCC353A8C08A633045E';</code></strong>
Query OK, 0 rows affected (0.01 sec)
</pre></li><li class="listitem"><p>
          現在のパスワードポリシーを満たすパスワードがアカウントに含まれていないため、アカウントが最初にロックされていても、このアカウント作成ステートメントは失敗します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE USER 'juanita'@'localhost' ACCOUNT LOCK;</code></strong>
ERROR 1819 (HY000): Your password does not satisfy the current
policy requirements
</pre></li><li class="listitem"><p>
          パスワードを確認するには、<code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> 関数を使用します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT VALIDATE_PASSWORD_STRENGTH('weak');</code></strong>
+------------------------------------+
| VALIDATE_PASSWORD_STRENGTH('weak') |
+------------------------------------+
|                                 25 |
+------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT VALIDATE_PASSWORD_STRENGTH('lessweak$_@123');</code></strong>
+----------------------------------------------+
| VALIDATE_PASSWORD_STRENGTH('lessweak$_@123') |
+----------------------------------------------+
|                                           50 |
+----------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT VALIDATE_PASSWORD_STRENGTH('N0Tweak$_@123!');</code></strong>
+----------------------------------------------+
| VALIDATE_PASSWORD_STRENGTH('N0Tweak$_@123!') |
+----------------------------------------------+
|                                          100 |
+----------------------------------------------+
</pre></li></ul></div><p>
      パスワードチェックを構成するには、<code class="literal">validate_password.<em class="replaceable"><code>xxx</code></em></code> という形式の名前を持つシステム変数を変更します。これらは、パスワードポリシーを制御するパラメータです。 <a class="xref" href="security.html#validate-password-options-variables" title="6.4.3.2 パスワード検証オプションおよび変数">セクション6.4.3.2「パスワード検証オプションおよび変数」</a>を参照してください。 
    </p><p>
      <code class="literal">validate_password</code> がインストールされていない場合、<code class="literal">validate_password.<em class="replaceable"><code>xxx</code></em></code> システム変数は使用できず、ステートメントのパスワードはチェックされず、<code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> 関数は常に 0 を返します。 たとえば、プラグインがインストールされていない場合、アカウントには 8 文字未満のパスワードを割り当てることも、パスワードをまったく割り当てないこともできます。 
    </p><p>
      <code class="literal">validate_password</code> がインストールされていると仮定すると、3 レベルのパスワードチェックが実装されます: <code class="literal">LOW</code>、<code class="literal">MEDIUM</code> および <code class="literal">STRONG</code>。 デフォルトは <code class="literal">MEDIUM</code> です。これを変更するには、<code class="literal">validate_password.policy</code> の値を変更します。 これらのポリシーにより、実装されるパスワードテストはますます厳密になります。 次の説明では、適切なシステム変数を変更して変更できるデフォルトのパラメータ値について説明します。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">LOW</code> ポリシーは、パスワードの長さのみテストします。 パスワードは少なくとも 8 文字の長さでなければなりません。 この長さを変更するには、<code class="literal">validate_password.length</code> を変更します。 
        </p></li><li class="listitem"><p>
          <code class="literal">MEDIUM</code> ポリシーでは、パスワードに少なくとも 1 つの数字、1 つの小文字、1 つの大文字および 1 つの特殊文字 (英数字以外) を含める必要があるという条件が追加されます。 これらの値を変更するには、<code class="literal">validate_password.number_count</code>、<code class="literal">validate_password.mixed_case_count</code> および <code class="literal">validate_password.special_char_count</code> を変更します。 
        </p></li><li class="listitem"><p>
          <code class="literal">STRONG</code> ポリシーは、パスワードの 4 文字以上の部分文字列が、(辞書ファイルが指定された場合に) 辞書ファイル内の単語と一致してはならないという条件を追加します。 ディクショナリファイルを指定するには、<code class="literal">validate_password.dictionary_file</code> を変更します。 
        </p></li></ul></div><p>
      また、<code class="literal">validate_password</code> では、現在のセッションの有効なユーザーアカウントのユーザー名部分と一致するパスワードを転送または逆方向に拒否する機能がサポートされています。 この機能を制御するために、<code class="literal">validate_password</code> では、デフォルトで有効になっている <code class="literal">validate_password.check_user_name</code> システム変数が公開されます。 
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="validate-password-installation"></a>6.4.3.1 パスワード検証コンポーネントのインストールおよびアンインストール</h4></div></div></div><a class="indexterm" name="idm46723756622304"></a><a class="indexterm" name="idm46723756620128"></a><a class="indexterm" name="idm46723756617984"></a><a class="indexterm" name="idm46723756616032"></a><p>
        このセクションでは、<code class="literal">validate_password</code> パスワード検証コンポーネントをインストールおよびアンインストールする方法について説明します。 コンポーネントのインストールおよびアンインストールの一般情報は、<a class="xref" href="server-administration.html#components" title="5.5 MySQL のコンポーネント">セクション5.5「MySQL のコンポーネント」</a> を参照してください。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <a class="ulink" href="https://dev.mysql.com/downloads/repo/yum/" target="_top">「MySQL Yum リポジトリ」</a>、<a class="ulink" href="https://dev.mysql.com/downloads/repo/suse/" target="_top">「MySQL SLES リポジトリ」</a>または <a class="link" href="installing.html#linux-installation-rpm" title="2.5.4 Oracle の RPM パッケージを使用した Linux への MySQL のインストール">RPM packages provided by Oracle</a> を使用して MySQL 8.0 をインストールする場合、MySQL Server を初めて起動した後、<code class="literal">validate_password</code> コンポーネントはデフォルトで有効になります。
        </p><p>
          Yum または RPM パッケージを使用して 5.7 から MySQL 8.0 にアップグレードすると、<code class="literal">validate_password</code> プラグインはそのまま残ります。 <code class="literal">validate_password</code> プラグインから <code class="literal">validate_password</code> コンポーネントへの移行を行うには、<a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 パスワード検証コンポーネントへの移行">セクション6.4.3.3「パスワード検証コンポーネントへの移行」</a> を参照してください。 
        </p></div><p>
        サーバーで使用できるようにするには、コンポーネントライブラリファイルが MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) にある必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
      </p><p>
        <code class="literal">validate_password</code> コンポーネントをインストールするには、次のステートメントを使用します:
      </p><pre class="programlisting">INSTALL COMPONENT 'file://component_validate_password';
</pre><p>
        コンポーネントのインストールは、サーバーの起動ごとに実行する必要のない一度限りの操作です。 <code class="literal">INSTALL COMPONENT</code> によってコンポーネントがロードされ、<code class="literal">mysql.component</code> システムテーブルにも登録されて、後続のサーバー起動時にロードされます。 
      </p><p>
        <code class="literal">validate_password</code> コンポーネントをアンインストールするには、次のステートメントを使用します:
      </p><pre class="programlisting">UNINSTALL COMPONENT 'file://component_validate_password';
</pre><p>
        <code class="literal">UNINSTALL COMPONENT</code> はコンポーネントをアンロードし、<code class="literal">mysql.component</code> システムテーブルから登録解除して、後続のサーバー起動時にロードされないようにします。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="validate-password-options-variables"></a>6.4.3.2 パスワード検証オプションおよび変数</h4></div></div></div><a class="indexterm" name="idm46723756586976"></a><p>
        このセクションでは、操作を構成および監視できるようにするために <code class="literal">validate_password</code> が提供するシステム変数およびステータス変数について説明します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#validate-password-system-variables" title="パスワード検証コンポーネントのシステム変数">パスワード検証コンポーネントのシステム変数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#validate-password-status-variables" title="パスワード検証コンポーネントのステータス変数">パスワード検証コンポーネントのステータス変数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#validate-password-plugin-options" title="パスワード検証プラグインオプション">パスワード検証プラグインオプション</a></p></li><li class="listitem"><p><a class="xref" href="security.html#validate-password-plugin-system-variables" title="パスワード検証プラグインシステム変数">パスワード検証プラグインシステム変数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#validate-password-plugin-status-variables" title="パスワード検証プラグインステータス変数">パスワード検証プラグインステータス変数</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="validate-password-system-variables"></a>パスワード検証コンポーネントのシステム変数</h5></div></div></div><a class="indexterm" name="idm46723756576528"></a><p>
          <code class="literal">validate_password</code> コンポーネントが有効になっている場合、パスワードチェックの構成を有効にするいくつかのシステム変数が公開されます:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'validate_password.%';</code></strong>
+--------------------------------------+--------+
| Variable_name                        | Value  |
+--------------------------------------+--------+
| validate_password.check_user_name    | ON     |
| validate_password.dictionary_file    |        |
| validate_password.length             | 8      |
| validate_password.mixed_case_count   | 1      |
| validate_password.number_count       | 1      |
| validate_password.policy             | MEDIUM |
| validate_password.special_char_count | 1      |
+--------------------------------------+--------+
</pre><p>
          パスワードのチェック方法を変更するには、サーバーの起動時または実行時にこれらのシステム変数を設定します。 次のリストは、各変数の意味を説明したものです。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_validate_password.check_user_name"></a>
              <code class="literal">validate_password.check_user_name</code>
            </p><a class="indexterm" name="idm46723756567728"></a><a class="indexterm" name="idm46723756566128"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password.check_user_name"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password.check-user-name[={OFF|ON}]</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.check_user_name">validate_password.check_user_name</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ON</code></td>
</tr></tbody></table></div><p>
              <code class="literal">validate_password</code> で、現在のセッションの有効なユーザーアカウントのユーザー名部分とパスワードを比較し、一致する場合は拒否するかどうか。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p><p>
              デフォルトでは、<code class="literal">validate_password.check_user_name</code> は有効です。 この変数は、<code class="literal">validate_password.policy</code> の値に関係なく、ユーザー名の一致を制御します。 
            </p><p>
              <code class="literal">validate_password.check_user_name</code> を有効にすると、次の効果があります:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  チェックは、<code class="literal">validate_password</code> が起動されるすべてのコンテキストで行われます。これには、<code class="literal">ALTER USER</code> や <code class="literal">SET PASSWORD</code> などのステートメントを使用した現在のユーザーパスワードの変更、<code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> などの関数の起動が含まれます。
                </p></li><li class="listitem"><p>
                  比較に使用されるユーザー名は、現行セッションの <code class="literal">USER()</code> および <code class="literal">CURRENT_USER()</code> 関数の値から取得されます。 つまり、別のユーザーパスワードを設定するための十分な権限を持つユーザーは、そのユーザー名にパスワードを設定でき、そのユーザーパスワードをステートメントを実行するユーザーの名前に設定できません。 たとえば、<code class="literal">'root'@'localhost'</code>では<code class="literal">'jeffrey'@'localhost'</code>のパスワードを<code class="literal">'jeffrey'</code>に設定できますが、パスワードを<code class="literal">'root</code> に設定することはできません。 
                </p></li><li class="listitem"><p>
                  <code class="literal">USER()</code> および <code class="literal">CURRENT_USER()</code> 関数の値のユーザー名部分のみが使用され、ホスト名部分は使用されません。 ユーザー名が空の場合、比較は行われません。 
                </p></li><li class="listitem"><p>
                  パスワードがユーザー名と同じであるか、その逆の場合、一致が発生し、パスワードは拒否されます。
                </p></li><li class="listitem"><p>
                  ユーザー名の照合では、大文字と小文字が区別されます。 パスワードとユーザー名の値は、バイト単位でバイナリ文字列として比較されます。 
                </p></li><li class="listitem"><p>
                  パスワードがユーザー名と一致する場合、他の <code class="literal">validate_password</code> システム変数の設定方法に関係なく、<code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> は 0 を返します。
                </p></li></ul></div></li><li class="listitem"><p><a name="sysvar_validate_password.dictionary_file"></a>
              <code class="literal">validate_password.dictionary_file</code>
            </p><a class="indexterm" name="idm46723756514976"></a><a class="indexterm" name="idm46723756513376"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password.dictionary_file"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password.dictionary-file=file_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.dictionary_file">validate_password.dictionary_file</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ファイル名</td>
</tr></tbody></table></div><p>
              <code class="literal">validate_password</code> がパスワードのチェックに使用するディクショナリファイルのパス名。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p><p>
              デフォルトでは、この変数は空の値を持ち、辞書検査は実行されません。 ディクショナリチェックを実行するには、変数値を空にしないでください。 ファイル名が相対パスとして指定された場合、サーバーのデータディレクトリを基準として解釈されます。 ファイルの内容は小文字で、1 行につき 1 語にする必要があります。 内容は、<code class="literal">utf8</code> の文字セットを持つものとして処理されます。 許可される最大のファイルサイズは 1M バイトです。 
            </p><p>
              パスワードチェック中にディクショナリファイルを使用するには、パスワードポリシーを 2 (<code class="literal">STRONG</code>) に設定する必要があります。<code class="literal">validate_password.policy</code> システム変数の説明を参照してください。 これが true である場合、長さが 4 から 100 までのパスワードの各部分文字列が辞書ファイル内の単語と比較されます。 いずれかが一致すると、パスワードが拒否されます。 比較では大文字と小文字は区別されません。 
            </p><p>
              <code class="literal">VALIDATE_PASSWORD_STRENGTH()</code> の場合、パスワードは <code class="literal">STRONG</code> を含むすべてのポリシーに対してチェックされるため、強度評価には <code class="literal">validate_password.policy</code> 値に関係なくディクショナリチェックが含まれます。
            </p><p>
              <code class="literal">validate_password.dictionary_file</code> は実行時に設定でき、値を割り当てると、サーバーを再起動せずに名前付きファイルが読み取られます。
            </p></li><li class="listitem"><p><a name="sysvar_validate_password.length"></a>
              <code class="literal">validate_password.length</code>
            </p><a class="indexterm" name="idm46723756479120"></a><a class="indexterm" name="idm46723756477568"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password.length"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password.length=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.length">validate_password.length</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">8</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr></tbody></table></div><p>
              <code class="literal">validate_password</code> がパスワードを必要とする最小文字数。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p><p>
              <code class="literal">validate_password.length</code> の最小値は、他のいくつかの関連するシステム変数の関数です。 この式の値より小さい値は設定できません: 
            </p><pre class="programlisting">validate_password.number_count
+ validate_password.special_char_count
+ (2 * validate_password.mixed_case_count)
</pre><p>
              <code class="literal">validate_password</code> は、前述の制約のために <code class="literal">validate_password.length</code> の値を調整すると、エラーログにメッセージを書き込みます。
            </p></li><li class="listitem"><p><a name="sysvar_validate_password.mixed_case_count"></a>
              <code class="literal">validate_password.mixed_case_count</code>
            </p><a class="indexterm" name="idm46723756443680"></a><a class="indexterm" name="idm46723756442080"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password.mixed_case_count"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password.mixed-case-count=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.mixed_case_count">validate_password.mixed_case_count</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr></tbody></table></div><p>
              パスワードポリシーが <code class="literal">MEDIUM</code> 以上の場合に、<code class="literal">validate_password</code> がパスワードを必要とする小文字と大文字の最小数。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p><p>
              特定の <code class="literal">validate_password.mixed_case_count</code> 値について、パスワードには小文字が多数含まれ、大文字が多数含まれている必要があります。
            </p></li><li class="listitem"><p><a name="sysvar_validate_password.number_count"></a>
              <code class="literal">validate_password.number_count</code>
            </p><a class="indexterm" name="idm46723756410752"></a><a class="indexterm" name="idm46723756409184"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password.number_count"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password.number-count=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.number_count">validate_password.number_count</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr></tbody></table></div><p>
              パスワードポリシーが <code class="literal">MEDIUM</code> 以上の場合に、<code class="literal">validate_password</code> がパスワードを必要とする数字 (数字) の最小数。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p></li><li class="listitem"><p><a name="sysvar_validate_password.policy"></a>
              <code class="literal">validate_password.policy</code>
            </p><a class="indexterm" name="idm46723756379568"></a><a class="indexterm" name="idm46723756378016"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password.policy"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password.policy=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.policy">validate_password.policy</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table></div><p>
              <code class="literal">validate_password</code> によって強制されるパスワードポリシー。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p><p>
              <code class="literal">validate_password.policy</code> は、<code class="literal">validate_password.check_user_name</code> によって独立して制御されるユーザー名に対するパスワードのチェックを除き、<code class="literal">validate_password</code> が他のポリシー設定システム変数を使用する方法に影響します。
            </p><p>
              <code class="literal">validate_password.policy</code> 値は、数値 0、1、2、または対応するシンボリック値 <code class="literal">LOW</code>, <code class="literal">MEDIUM</code>, <code class="literal">STRONG</code> を使用して指定できます。 次の表では、それぞれのポリシーに対して実施されるテストについて説明します。 長さテストの場合、必要な長さは <code class="literal">validate_password.length</code> システム変数の値です。 同様に、他のテストに必要な値は、他の <code class="literal">validate_password.<em class="replaceable"><code>xxx</code></em></code> 変数によって指定されます。 
            </p><div class="informaltable"><table summary="Password policies enforced by the validate_password component and the tests performed for each policy."><col style="width=20%"><col style="width=80%"><thead><tr>
                  <th>ポリシー</th>
                  <th>実施されるテスト</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">0</code> または <code class="literal">LOW</code></td>
                  <td>長さ</td>
                </tr><tr>
                  <td><code class="literal">1</code> または <code class="literal">MEDIUM</code></td>
                  <td>長さ。数値、小文字、大文字、および特殊文字</td>
                </tr><tr>
                  <td><code class="literal">2</code> または <code class="literal">STRONG</code></td>
                  <td>長さ。数値、小文字、大文字、および特殊文字。辞書ファイル</td>
                </tr></tbody></table></div></li><li class="listitem"><p><a name="sysvar_validate_password.special_char_count"></a>
              <code class="literal">validate_password.special_char_count</code>
            </p><a class="indexterm" name="idm46723756322112"></a><a class="indexterm" name="idm46723756320512"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password.special_char_count"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password.special-char-count=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.special_char_count">validate_password.special_char_count</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr></tbody></table></div><p>
              パスワードポリシーが <code class="literal">MEDIUM</code> 以上の場合に、<code class="literal">validate_password</code> がパスワードを必要とする英数字以外の最小文字数。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="validate-password-status-variables"></a>パスワード検証コンポーネントのステータス変数</h5></div></div></div><a class="indexterm" name="idm46723756291488"></a><p>
          <code class="literal">validate_password</code> コンポーネントが有効になっている場合、操作情報を提供するステータス変数が公開されます:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'validate_password.%';</code></strong>
+-----------------------------------------------+---------------------+
| Variable_name                                 | Value               |
+-----------------------------------------------+---------------------+
| validate_password.dictionary_file_last_parsed | 2019-10-03 08:33:49 |
| validate_password.dictionary_file_words_count | 1902                |
+-----------------------------------------------+---------------------+
</pre><p>
          次のリストに、各ステータス変数の意味を示します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_validate_password.dictionary_file_last_parsed"></a>
              <code class="literal">validate_password.dictionary_file_last_parsed</code>
            </p><a class="indexterm" name="idm46723756283312"></a><a class="indexterm" name="idm46723756281680"></a><p>
              ディクショナリファイルが最後に解析された日時。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p></li><li class="listitem"><p><a name="statvar_validate_password.dictionary_file_words_count"></a>
              <code class="literal">validate_password.dictionary_file_words_count</code>
            </p><a class="indexterm" name="idm46723756275936"></a><a class="indexterm" name="idm46723756274304"></a><p>
              辞書ファイルから読み取られた単語の数。 この変数は、<code class="literal">validate_password</code> がインストールされていないかぎり使用できません。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="validate-password-plugin-options"></a>パスワード検証プラグインオプション</h5></div></div></div><a class="indexterm" name="idm46723756269248"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            MySQL 8.0 では、<code class="literal">validate_password</code> プラグインが <code class="literal">validate_password</code> コンポーネントとして再実装されました。 <code class="literal">validate_password</code> プラグインは非推奨です。将来のバージョンの MySQL で削除される予定です。 したがって、そのオプションも非推奨になり、それらも削除されることが予想されます。 プラグインを使用する MySQL インストールでは、かわりにコンポーネントの使用に移行する必要があります。 <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 パスワード検証コンポーネントへの移行">セクション6.4.3.3「パスワード検証コンポーネントへの移行」</a>を参照してください。 
          </p></div><p>
          <code class="literal">validate_password</code> プラグインのアクティブ化を制御するには、このオプションを使用します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_validate-password"></a>
              <code class="option">--validate-password[=<em class="replaceable"><code>value</code></em>]</code>
            </p><a class="indexterm" name="idm46723756259232"></a><a class="indexterm" name="idm46723756257072"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate-password"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password[=value]</code></td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ON</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">FORCE</code></p><p class="valid-value"><code class="literal">FORCE_PLUS_PERMANENT</code></p></td>
</tr></tbody></table></div><p>
              このオプションは、サーバーが起動時に非推奨の <code class="literal">validate_password</code> プラグインをロードする方法を制御します。 値は<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>に記載されているような、プラグインロードオプション用に指定可能ないずれかの値とする必要があります。 たとえば、<code class="option">--validate-password=FORCE_PLUS_PERMANENT</code> は、起動時にプラグインをロードし、サーバーの実行中にプラグインが削除されないようにサーバーに指示します。 
            </p><p>
              このオプションは、<code class="literal">validate_password</code> プラグインが以前に <code class="literal">INSTALL PLUGIN</code> に登録されているか、<code class="option">--plugin-load-add</code> にロードされている場合にのみ使用できます。 <a class="xref" href="security.html#validate-password-installation" title="6.4.3.1 パスワード検証コンポーネントのインストールおよびアンインストール">セクション6.4.3.1「パスワード検証コンポーネントのインストールおよびアンインストール」</a>を参照してください。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="validate-password-plugin-system-variables"></a>パスワード検証プラグインシステム変数</h5></div></div></div><a class="indexterm" name="idm46723756230512"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            MySQL 8.0 では、<code class="literal">validate_password</code> プラグインが <code class="literal">validate_password</code> コンポーネントとして再実装されました。 <code class="literal">validate_password</code> プラグインは非推奨です。将来のバージョンの MySQL で削除される予定です。 したがって、そのシステム変数も非推奨になるため、これらも削除する必要があります。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応するシステム変数を使用してください。<a class="xref" href="security.html#validate-password-system-variables" title="パスワード検証コンポーネントのシステム変数">パスワード検証コンポーネントのシステム変数</a> を参照してください。 プラグインを使用する MySQL インストールでは、かわりにコンポーネントの使用に移行する必要があります。 <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 パスワード検証コンポーネントへの移行">セクション6.4.3.3「パスワード検証コンポーネントへの移行」</a>を参照してください。 
          </p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_validate_password_check_user_name"></a>
              <code class="literal">validate_password_check_user_name</code>
            </p><a class="indexterm" name="idm46723756220016"></a><a class="indexterm" name="idm46723756218416"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password_check_user_name"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password-check-user-name[={OFF|ON}]</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_check_user_name">validate_password_check_user_name</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ON</code></td>
</tr></tbody></table></div><p>
              この <code class="literal">validate_password</code> プラグインシステム変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.check_user_name</code> システム変数を使用してください。 
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_dictionary_file"></a>
              <code class="literal">validate_password_dictionary_file</code>
            </p><a class="indexterm" name="idm46723756190880"></a><a class="indexterm" name="idm46723756189280"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password_dictionary_file"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password-dictionary-file=file_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_dictionary_file">validate_password_dictionary_file</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ファイル名</td>
</tr></tbody></table></div><p>
              この <code class="literal">validate_password</code> プラグインシステム変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.dictionary_file</code> システム変数を使用してください。 
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_length"></a>
              <code class="literal">validate_password_length</code>
            </p><a class="indexterm" name="idm46723756164256"></a><a class="indexterm" name="idm46723756162704"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password_length"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password-length=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_length">validate_password_length</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">8</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr></tbody></table></div><p>
              この <code class="literal">validate_password</code> プラグインシステム変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.length</code> システム変数を使用してください。 
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_mixed_case_count"></a>
              <code class="literal">validate_password_mixed_case_count</code>
            </p><a class="indexterm" name="idm46723756132752"></a><a class="indexterm" name="idm46723756131152"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password_mixed_case_count"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password-mixed-case-count=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_mixed_case_count">validate_password_mixed_case_count</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr></tbody></table></div><p>
              この <code class="literal">validate_password</code> プラグインシステム変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.mixed_case_count</code> システム変数を使用してください。 
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_number_count"></a>
              <code class="literal">validate_password_number_count</code>
            </p><a class="indexterm" name="idm46723756101248"></a><a class="indexterm" name="idm46723756099680"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password_number_count"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password-number-count=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_number_count">validate_password_number_count</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr></tbody></table></div><p>
              この <code class="literal">validate_password</code> プラグインシステム変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.number_count</code> システム変数を使用してください。 
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_policy"></a>
              <code class="literal">validate_password_policy</code>
            </p><a class="indexterm" name="idm46723756069808"></a><a class="indexterm" name="idm46723756068256"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password_policy"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password-policy=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_policy">validate_password_policy</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table></div><p>
              この <code class="literal">validate_password</code> プラグインシステム変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.policy</code> システム変数を使用してください。 
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_special_char_count"></a>
              <code class="literal">validate_password_special_char_count</code>
            </p><a class="indexterm" name="idm46723756035984"></a><a class="indexterm" name="idm46723756034384"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for validate_password_special_char_count"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--validate-password-special-char-count=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_special_char_count">validate_password_special_char_count</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr></tbody></table></div><p>
              この <code class="literal">validate_password</code> プラグインシステム変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.special_char_count</code> システム変数を使用してください。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="validate-password-plugin-status-variables"></a>パスワード検証プラグインステータス変数</h5></div></div></div><a class="indexterm" name="idm46723756005008"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            MySQL 8.0 では、<code class="literal">validate_password</code> プラグインが <code class="literal">validate_password</code> コンポーネントとして再実装されました。 <code class="literal">validate_password</code> プラグインは非推奨です。将来のバージョンの MySQL で削除される予定です。 その結果、そのステータス変数も非推奨になり、削除されることが予想されます。 <code class="literal">validate_password</code> コンポーネントの対応するステータス変数を使用します。<a class="xref" href="security.html#validate-password-status-variables" title="パスワード検証コンポーネントのステータス変数">パスワード検証コンポーネントのステータス変数</a> を参照してください。 プラグインを使用する MySQL インストールでは、かわりにコンポーネントの使用に移行する必要があります。 <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 パスワード検証コンポーネントへの移行">セクション6.4.3.3「パスワード検証コンポーネントへの移行」</a>を参照してください。 
          </p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_validate_password_dictionary_file_last_parsed"></a>
              <code class="literal">validate_password_dictionary_file_last_parsed</code>
            </p><a class="indexterm" name="idm46723755994592"></a><a class="indexterm" name="idm46723755992960"></a><p>
              この <code class="literal">validate_password</code> プラグインステータス変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.dictionary_file_last_parsed</code> ステータス変数を使用してください。 
            </p></li><li class="listitem"><p><a name="statvar_validate_password_dictionary_file_words_count"></a>
              <code class="literal">validate_password_dictionary_file_words_count</code>
            </p><a class="indexterm" name="idm46723755985392"></a><a class="indexterm" name="idm46723755983760"></a><p>
              この <code class="literal">validate_password</code> プラグインステータス変数は非推奨です。将来のバージョンの MySQL で削除される予定です。 かわりに、<code class="literal">validate_password</code> コンポーネントの対応する <code class="literal">validate_password.dictionary_file_words_count</code> ステータス変数を使用してください。 
            </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="validate-password-transitioning"></a>6.4.3.3 パスワード検証コンポーネントへの移行</h4></div></div></div><a class="indexterm" name="idm46723755976736"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          MySQL 8.0 では、<code class="literal">validate_password</code> プラグインが <code class="literal">validate_password</code> コンポーネントとして再実装されました。 <code class="literal">validate_password</code> プラグインは非推奨です。将来のバージョンの MySQL で削除される予定です。 
        </p></div><p>
        <code class="literal">validate_password</code> プラグインを現在使用している MySQL インストールでは、かわりに <code class="literal">validate_password</code> コンポーネントの使用に移行する必要があります。 これを行うには、次の手順を使用します。 この手順では、プラグインをアンインストールする前にコンポーネントをインストールして、パスワード検証が行われない時間ウィンドウが表示されないようにします。 (コンポーネントとプラグインは同時にインストールできます。 この場合、サーバーはコンポーネントを使用しようとし、コンポーネントが使用できない場合はプラグインにフォールバックします。) 
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            <code class="literal">validate_password</code> コンポーネントをインストールします:
          </p><pre class="programlisting">INSTALL COMPONENT 'file://component_validate_password';
</pre></li><li class="listitem"><p>
            <code class="literal">validate_password</code> コンポーネントをテストして、予想どおりに機能することを確認します。 <code class="literal">validate_password.<em class="replaceable"><code>xxx</code></em></code> システム変数を設定する必要がある場合は、<code class="literal">SET GLOBAL</code> を使用して実行時に設定できます。 (必要なオプションファイルの変更は、次のステップで実行します。) 
          </p></li><li class="listitem"><p>
            プラグインシステムおよびステータス変数への参照を、対応するコンポーネントシステムおよびステータス変数を参照するように調整します。 以前に、次のようなオプションファイルを使用して起動時にプラグインを構成したとします: 
          </p><pre class="programlisting">[mysqld]
validate-password=FORCE_PLUS_PERMANENT
validate_password_dictionary_file=/usr/share/dict/words
validate_password_length=10
validate_password_number_count=2
</pre><p>
            これらの設定はプラグインに適していますが、コンポーネントに適用するように変更する必要があります。 オプションファイルを調整するには、<code class="option">--validate-password</code> オプションを省略し (コンポーネントではなくプラグインにのみ適用)、プラグインに適したドットなしの名前からコンポーネントに適したドット付きの名前にシステム変数参照を変更します: 
          </p><pre class="programlisting">[mysqld]
validate_password.dictionary_file=/usr/share/dict/words
validate_password.length=10
validate_password.number_count=2
</pre><p>
            実行時に <code class="literal">validate_password</code> プラグインシステムおよびステータス変数を参照するアプリケーションにも同様の調整が必要です。 ドットなしプラグイン変数名を、対応するドット付きコンポーネント変数名に変更します。 
          </p></li><li class="listitem"><p>
            <code class="literal">validate_password</code> プラグインをアンインストールします:
          </p><pre class="programlisting">UNINSTALL PLUGIN validate_password;
</pre><p>
            <code class="option">--plugin-load</code> または <code class="option">--plugin-load-add</code> オプションを使用してサーバーの起動時に <code class="literal">validate_password</code> プラグインがロードされる場合は、サーバーの起動手順でそのオプションを省略します。 たとえば、オプションがサーバーオプションファイルにリストされている場合は、ファイルから削除します。 
          </p></li><li class="listitem"><p>
            サーバーを再起動します。
          </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="keyring"></a>6.4.4 MySQL キーリング</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#keyring-installation">6.4.4.1 キーリングプラグインのインストール</a></span></dt><dt><span class="section"><a href="security.html#keyring-file-plugin">6.4.4.2 keyring_file ファイルベースプラグインの使用</a></span></dt><dt><span class="section"><a href="security.html#keyring-encrypted-file-plugin">6.4.4.3 keyring_encrypted_file キーリングプラグインの使用</a></span></dt><dt><span class="section"><a href="security.html#keyring-okv-plugin">6.4.4.4 keyring_okv KMIP プラグインの使用</a></span></dt><dt><span class="section"><a href="security.html#keyring-aws-plugin">6.4.4.5 keyring_aws Amazon Web Services キーリングプラグインの使用</a></span></dt><dt><span class="section"><a href="security.html#keyring-hashicorp-plugin">6.4.4.6 HashiCorp Vault キーリングプラグインの使用</a></span></dt><dt><span class="section"><a href="security.html#keyring-oci-plugin">6.4.4.7 Oracle Cloud Infrastructure Vault キーリングプラグインの使用</a></span></dt><dt><span class="section"><a href="security.html#keyring-key-types">6.4.4.8 サポートされているキーリングキーのタイプと長さ</a></span></dt><dt><span class="section"><a href="security.html#keyring-key-migration">6.4.4.9 キーリングキーストア間のキーの移行</a></span></dt><dt><span class="section"><a href="security.html#keyring-functions-general-purpose">6.4.4.10 汎用キーリングキー管理関数</a></span></dt><dt><span class="section"><a href="security.html#keyring-functions-plugin-specific">6.4.4.11 プラグイン固有のキーリングキー管理関数</a></span></dt><dt><span class="section"><a href="security.html#keyring-options">6.4.4.12 キーリングコマンドのオプション</a></span></dt><dt><span class="section"><a href="security.html#keyring-system-variables">6.4.4.13 キーリングシステム変数</a></span></dt></dl></div><a class="indexterm" name="idm46723755945136"></a><p>
      MySQL Server は、内部サーバーコンポーネントおよびプラグインが機密情報を安全に格納して後で取得できるようにするキーリングをサポートしています。 実装は、次の要素で構成されます: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          バッキングストアを管理したり、ストレージバックエンドと通信したりするキーリングプラグイン。 次のキーリングプラグインを使用できます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">keyring_file</code> は、キーリングデータをサーバーホストのローカルファイルに格納します。 このプラグインは、MySQL Community Edition および MySQL Enterprise Edition のディストリビューションで使用できます。 <a class="xref" href="security.html#keyring-file-plugin" title="6.4.4.2 keyring_file ファイルベースプラグインの使用">セクション6.4.4.2「keyring_file ファイルベースプラグインの使用」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">keyring_encrypted_file</code> は、サーバーホストに対してローカルな暗号化されたファイルにキーリングデータを格納します。 このプラグインは、MySQL Enterprise Edition ディストリビューションで使用できます。 <a class="xref" href="security.html#keyring-encrypted-file-plugin" title="6.4.4.3 keyring_encrypted_file キーリングプラグインの使用">セクション6.4.4.3「keyring_encrypted_file キーリングプラグインの使用」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">keyring_okv</code> は、Oracle Key Vault や Gemalto SafeNet KeySecure Appliance などの KMIP 互換のバックエンドキーリングストレージ製品で使用する KMIP 1.1 プラグインです。 このプラグインは、MySQL Enterprise Edition ディストリビューションで使用できます。 <a class="xref" href="security.html#keyring-okv-plugin" title="6.4.4.4 keyring_okv KMIP プラグインの使用">セクション6.4.4.4「keyring_okv KMIP プラグインの使用」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">keyring_aws</code> は、キーの生成のために Amazon Web Services Key Management Service と通信し、キーの格納にローカルファイルを使用します。 このプラグインは、MySQL Enterprise Edition ディストリビューションで使用できます。 <a class="xref" href="security.html#keyring-aws-plugin" title="6.4.4.5 keyring_aws Amazon Web Services キーリングプラグインの使用">セクション6.4.4.5「keyring_aws Amazon Web Services キーリングプラグインの使用」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">keyring_hashicorp</code> は、バックエンドストレージのために HashiCorp Vault と通信します。 このプラグインは、MySQL 8.0.18 の時点の MySQL Enterprise Edition ディストリビューションで使用できます。 <a class="xref" href="security.html#keyring-hashicorp-plugin" title="6.4.4.6 HashiCorp Vault キーリングプラグインの使用">セクション6.4.4.6「HashiCorp Vault キーリングプラグインの使用」</a>を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">keyring_oci</code> は、バックエンドストレージのために Oracle Cloud Infrastructure Vault と通信します。 このプラグインは、MySQL 8.0.22 の時点の MySQL Enterprise Edition ディストリビューションで使用できます。 <a class="xref" href="security.html#keyring-oci-plugin" title="6.4.4.7 Oracle Cloud Infrastructure Vault キーリングプラグインの使用">セクション6.4.4.7「Oracle Cloud Infrastructure Vault キーリングプラグインの使用」</a>を参照してください。 
            </p></li></ul></div></li><li class="listitem"><p>
          主要な移行機能。 MySQL サーバーの操作モードでは、基礎となるキーリングキーストア間でキーを移行できるため、DBA は MySQL インストールをあるキーリングプラグインから別のキーリングプラグインに切り替えることができます。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          鍵リング鍵管理用の鍵リングサービスインタフェース。次の 2 つのレベルでアクセスできます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              SQL インタフェース: SQL ステートメントで、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> で説明されているユーザー定義関数 (UDF) をコールします。
            </p></li><li class="listitem"><p>
              C インタフェース: C 言語コードでは、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> で説明されているキーリングサービス関数をコールします。
            </p></li></ul></div></li><li class="listitem"><p>
          キーメタデータアクセス。 MySQL 8.0.16 以降では、パフォーマンススキーマ <code class="literal">keyring_keys</code> テーブルは鍵リング内の鍵のメタデータを公開します。 キーメタデータには、キー ID、キー所有者およびバックエンドキー ID が含まれます。 <code class="literal">keyring_keys</code> テーブルでは、キーの内容などの機密キーリングデータは公開されません。 <a class="xref" href="performance-schema.html#performance-schema-keyring-keys-table" title="27.12.19.6 keyring_keys テーブル">セクション27.12.19.6「keyring_keys テーブル」</a>を参照してください。 
        </p><a class="indexterm" name="idm46723755912144"></a><a class="indexterm" name="idm46723755910000"></a></li></ul></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
        暗号化キー管理用の <code class="literal">keyring_file</code> および <code class="literal">keyring_encrypted_file</code> プラグインは、規制コンプライアンスソリューションとしては意図されていません。 PCI、FIPS などのセキュリティ標準では、キーボールトまたはハードウェアセキュリティモジュール (HSM) 内の暗号化キーを保護、管理および保護するためにキー管理システムを使用する必要があります。 
      </p></div><p>
      MySQL 内では、キーリングの使用方法は次のとおりです:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code> ストレージエンジンは、鍵リングを使用して、テーブルスペース暗号化用の鍵を格納します。 <code class="literal">InnoDB</code> は、サポートされている任意のキーリングプラグインを使用できます。 <a class="xref" href="innodb-storage-engine.html#innodb-data-encryption" title="15.13 InnoDB 保存データ暗号化">セクション15.13「InnoDB 保存データ暗号化」</a>を参照してください。 
        </p></li><li class="listitem"><p>
          MySQL Enterprise Audit では、キーリングを使用して監査ログファイルの暗号化パスワードを格納します。 監査ログプラグインは、サポートされている任意のキーリングプラグインを使用できます。 <a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a>を参照してください。 
        </p></li><li class="listitem"><p>
          バイナリログとリレーログの管理では、ログファイルの鍵リングベースの暗号化がサポートされています。 ログファイルの暗号化を有効にすると、バイナリログファイルとリレーログファイルのパスワードを暗号化するために使用される鍵が鍵リングに格納されます。 この機能では、サポートされている任意のキーリングプラグインを使用できます。 <a class="xref" href="replication.html#replication-binlog-encryption" title="17.3.2 バイナリログファイルとリレーログファイルの暗号化">セクション17.3.2「バイナリログファイルとリレーログファイルの暗号化」</a>を参照してください。 
        </p></li></ul></div><p>
      鍵リングの一般的なインストール手順については、<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> を参照してください。 特定のキーリングプラグインに固有のインストールおよび構成情報については、そのプラグインについて説明しているセクションを参照してください。 
    </p><p>
      キーリング UDF の使用の詳細は、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> を参照してください。
    </p><p>
      キープラグインおよび UDF は、キーリングへのコンポーネントのインタフェースを提供するキーリングサービスにアクセスします。 キーリングプラグインサービスへのアクセスおよびキーリングプラグインの記述については、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> および <a class="ulink" href="https://dev.mysql.com/doc/extending-mysql/8.0/en/writing-keyring-plugins.html" target="_top">Writing Keyring Plugins</a> を参照してください。 
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-installation"></a>6.4.4.1 キーリングプラグインのインストール</h4></div></div></div><a class="indexterm" name="idm46723755889440"></a><a class="indexterm" name="idm46723755887264"></a><a class="indexterm" name="idm46723755885312"></a><a class="indexterm" name="idm46723755883088"></a><a class="indexterm" name="idm46723755881136"></a><a class="indexterm" name="idm46723755878944"></a><a class="indexterm" name="idm46723755876992"></a><a class="indexterm" name="idm46723755874800"></a><a class="indexterm" name="idm46723755872848"></a><a class="indexterm" name="idm46723755870640"></a><a class="indexterm" name="idm46723755868688"></a><a class="indexterm" name="idm46723755866496"></a><p>
        鍵リングサービスコンシューマには、鍵リングプラグインがインストールされている必要があります。 MySQL には、次のプラグインの選択肢があります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">keyring_file</code>: キーリングデータをサーバーホストのローカルファイルに格納します。 すべての MySQL ディストリビューションで使用できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_encrypted_file</code>: キーリングデータをサーバーホストに対してローカルな暗号化されたファイルに格納します。 MySQL Enterprise Edition ディストリビューションで使用できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_okv</code>: Oracle Key Vault、Gemalto SafeNet KeySecure Appliance などの KMIP 互換のバックエンドキーリングストレージ製品を使用します。 MySQL Enterprise Edition ディストリビューションで使用できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_aws</code>: キー生成のバックエンドとして Amazon Web Services Key Management Service と通信し、キーの格納にローカルファイルを使用します。 MySQL Enterprise Edition ディストリビューションで使用できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_hashicorp</code>: バックエンドストレージのために HashiCorp Vault と通信します。 MySQL Enterprise Edition ディストリビューションで使用できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_oci</code> の場合: <a class="xref" href="security.html#keyring-oci-plugin" title="6.4.4.7 Oracle Cloud Infrastructure Vault キーリングプラグインの使用">セクション6.4.4.7「Oracle Cloud Infrastructure Vault キーリングプラグインの使用」</a>
          </p></li></ul></div><p>
        このセクションでは、選択したキーリングプラグインをインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
      </p><p>
        キーリングプラグインとともにキーリングユーザー定義関数 (UDF) を使用する場合は、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> の手順に従って、プラグインのインストール後に UDF をインストールします。
      </p><p>
        サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
      </p><p>
        各キーリングプラグインのインストールは似ています。 次の手順では、<code class="literal">keyring_file</code> を使用します。 別のキーリングプラグインのユーザーは、<code class="literal">keyring_file</code> をその名前に置き換えることができます。 
      </p><p>
        <code class="literal">keyring_file</code> プラグインライブラリファイルのベース名は <code class="literal">keyring_file</code> です。 ファイル名の接尾辞は、プラットフォームごとに異なります (たとえば、<code class="filename">.so</code> for Unix and Unix-like systems, <code class="filename">.dll</code> for Windows)。 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          キーリングプラグインは一度に 1 つだけイネーブルにする必要があります。 複数のキーリングプラグインの有効化はサポートされていないため、予想どおりに結果が得られないことがあります。 
        </p></div><p>
        キーリングプラグインは、コンポーネントが独自の初期化中に必要に応じてアクセスできるように、サーバーの起動シーケンスの最早段階でロードする必要があります。 たとえば、<code class="literal">InnoDB</code> ストレージエンジンはテーブルスペースの暗号化に鍵リングを使用するため、<code class="literal">InnoDB</code> を初期化する前に鍵リングプラグインをロードして使用可能にする必要があります。 
      </p><p>
        プラグインをロードするには、<code class="option">--early-plugin-load</code> オプションを使用して、プラグインを含むプラグインライブラリファイルに名前を付けます。 たとえば、プラグインライブラリファイルの接尾辞が <code class="filename">.so</code> であるプラットフォームでは、サーバーの <code class="filename">my.cnf</code> ファイルで次の行を使用し、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整します: 
      </p><pre class="programlisting">[mysqld]
early-plugin-load=keyring_file.so
</pre><p>
        サーバーを起動する前に、選択したキーリングプラグインのノートをチェックして、追加の構成が許可されているか必要かを確認します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">keyring_file</code>: <a class="xref" href="security.html#keyring-file-plugin" title="6.4.4.2 keyring_file ファイルベースプラグインの使用">セクション6.4.4.2「keyring_file ファイルベースプラグインの使用」</a>。
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_encrypted_file</code>: <a class="xref" href="security.html#keyring-encrypted-file-plugin" title="6.4.4.3 keyring_encrypted_file キーリングプラグインの使用">セクション6.4.4.3「keyring_encrypted_file キーリングプラグインの使用」</a>。
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_okv</code>: <a class="xref" href="security.html#keyring-okv-plugin" title="6.4.4.4 keyring_okv KMIP プラグインの使用">セクション6.4.4.4「keyring_okv KMIP プラグインの使用」</a>。
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_aws</code>: <a class="xref" href="security.html#keyring-aws-plugin" title="6.4.4.5 keyring_aws Amazon Web Services キーリングプラグインの使用">セクション6.4.4.5「keyring_aws Amazon Web Services キーリングプラグインの使用」</a>
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_hashicorp</code>: <a class="xref" href="security.html#keyring-hashicorp-plugin" title="6.4.4.6 HashiCorp Vault キーリングプラグインの使用">セクション6.4.4.6「HashiCorp Vault キーリングプラグインの使用」</a>
          </p></li></ul></div><p>
        プラグイン固有の構成を実行した後、プラグインのインストールを検証します。 MySQL サーバーを実行した状態で、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'keyring%';</code></strong>
+--------------+---------------+
| PLUGIN_NAME  | PLUGIN_STATUS |
+--------------+---------------+
| keyring_file | ACTIVE        |
+--------------+---------------+
</pre><p>
        プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
      </p><p>
        プラグインは、<code class="option">--plugin-load</code> や <code class="option">--plugin-load-add</code> オプション、<code class="literal">INSTALL PLUGIN</code> ステートメントなど、<code class="option">--early-plugin-load</code> 以外の方法でロードできます。 ただし、これらのメソッドを使用してロードされたキーリングプラグインは、<code class="literal">InnoDB</code> などの特定のコンポーネントのサーバー起動シーケンスでは遅すぎる可能性があります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="option">--plugin-load</code> または <code class="option">--plugin-load-add</code> を使用したプラグインのロードは、<code class="literal">InnoDB</code> の初期化後に行われます。
          </p></li><li class="listitem"><p>
            <code class="literal">INSTALL PLUGIN</code> を使用してインストールされたプラグインは、<code class="literal">mysql.plugin</code> システムテーブルに登録され、その後のサーバーの再起動のために自動的にロードされます。 ただし、<code class="literal">mysql.plugin</code> は <code class="literal">InnoDB</code> テーブルであるため、そこに指定されたプラグインは、<code class="literal">InnoDB</code> の初期化後にのみ起動時にロードできます。 
          </p></li></ul></div><p>
        コンポーネントが鍵リングサービスにアクセスしようとしたときに鍵リングプラグインを使用できない場合、そのコンポーネントはそのサービスを使用できません。 その結果、コンポーネントの初期化に失敗したり、機能が制限されて初期化されたりする可能性があります。 たとえば、<code class="literal">InnoDB</code> は、初期化時に暗号化されたテーブルスペースがあることを検出すると、キーリングへのアクセスを試みます。 キーリングが使用できない場合、<code class="literal">InnoDB</code> は暗号化されていないテーブルスペースにのみアクセスできます。 <code class="literal">InnoDB</code> が暗号化されたテーブルスペースにも確実にアクセスできるようにするには、<code class="option">--early-plugin-load</code> を使用してキープラグインをロードします。 
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-file-plugin"></a>6.4.4.2 keyring_file ファイルベースプラグインの使用</h4></div></div></div><a class="indexterm" name="idm46723755791248"></a><a class="indexterm" name="idm46723755789728"></a><p>
        <code class="literal">keyring_file</code> キーリングプラグインは、サーバーホストに対してローカルなファイルに鍵リングデータを格納します。
      </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
          暗号化キー管理用の <code class="literal">keyring_file</code> プラグインは、規制コンプライアンスソリューションとしては意図されていません。 PCI、FIPS などのセキュリティ標準では、キーボールトまたはハードウェアセキュリティモジュール (HSM) 内の暗号化キーを保護、管理および保護するためにキー管理システムを使用する必要があります。 
        </p></div><p>
        <code class="literal">keyring_file</code> プラグインをインストールするには、<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> にある一般的なキーリングのインストール手順と、ここにある <code class="literal">keyring_file</code> に固有の構成情報を使用します。
      </p><p>
        サーバーの起動プロセス中に使用できるようにするには、<code class="option">--early-plugin-load</code> オプションを使用して <code class="literal">keyring_file</code> をロードする必要があります。 <code class="literal">keyring_file_data</code> システム変数は、オプションで、<code class="literal">keyring_file</code> プラグインがデータストレージに使用するファイルの場所を構成します。 デフォルト値はプラットフォーム固有です。 ファイルの場所を明示的に構成するには、起動時に変数値を設定します。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルで次の行を使用して、プラットフォームの <code class="filename">.so</code> 接尾辞とファイルの場所を必要に応じて調整します: 
      </p><pre class="programlisting">[mysqld]
early-plugin-load=keyring_file.so
keyring_file_data=/usr/local/mysql/mysql-keyring/keyring
</pre><p>
        キーリング操作はトランザクションです: <code class="literal">keyring_file</code> プラグインは、書込み操作中にバックアップファイルを使用して、操作が失敗した場合に元のファイルにロールバックできるようにします。 バックアップファイルの名前は、接尾辞が <code class="filename">.backup</code> の <code class="literal">keyring_file_data</code> システム変数の値と同じです。 
      </p><p>
        <code class="literal">keyring_file_data</code> の詳細は、<a class="xref" href="security.html#keyring-system-variables" title="6.4.4.13 キーリングシステム変数">セクション6.4.4.13「キーリングシステム変数」</a> を参照してください。
      </p><p>
        正しい鍵リングストレージファイルが存在する場合にのみ鍵が確実にフラッシュされるように、<code class="literal">keyring_file</code> は鍵リングの SHA-256 チェックサムをファイルに格納します。 ファイルを更新する前に、プラグインは、予想されるチェックサムが含まれていることを確認します。 
      </p><p>
        <code class="literal">keyring_file</code> プラグインは、標準の MySQL キーリングサービスインタフェースを構成する関数をサポートしています。 これらの関数によって実行されるキーリング操作には、次の 2 つのレベルでアクセスできます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL インタフェース: SQL ステートメントで、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> で説明されているユーザー定義関数 (UDF) をコールします。
          </p></li><li class="listitem"><p>
            C インタフェース: C 言語コードでは、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> で説明されているキーリングサービス関数をコールします。
          </p></li></ul></div><p>
        例 (UDF を使用):
      </p><pre class="programlisting">SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
        <code class="literal">keyring_file</code> で許可されるキータイプの詳細は、<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-encrypted-file-plugin"></a>6.4.4.3 keyring_encrypted_file キーリングプラグインの使用</h4></div></div></div><a class="indexterm" name="idm46723755756224"></a><a class="indexterm" name="idm46723755754672"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">keyring_encrypted_file</code> プラグインは、商用製品である MySQL Enterprise Edition に含まれている拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
        </p></div><p>
        <code class="literal">keyring_encrypted_file</code> キーリングプラグインは、サーバーホストに対してローカルな暗号化ファイルに鍵リングデータを格納します。
      </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
          暗号化キー管理用の <code class="literal">keyring_encrypted_file</code> プラグインは、規制コンプライアンスソリューションとしては意図されていません。 PCI、FIPS などのセキュリティ標準では、キーボールトまたはハードウェアセキュリティモジュール (HSM) 内の暗号化キーを保護、管理および保護するためにキー管理システムを使用する必要があります。 
        </p></div><p>
        <code class="literal">keyring_encrypted_file</code> プラグインをインストールするには、<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> にある一般的なキーリングのインストール手順と、ここにある <code class="literal">keyring_encrypted_file</code> に固有の構成情報を使用します。
      </p><p>
        サーバーの起動プロセス中に使用できるようにするには、<code class="option">--early-plugin-load</code> オプションを使用して <code class="literal">keyring_encrypted_file</code> をロードする必要があります。 キーリングデータファイルを暗号化するためのパスワードを指定するには、<code class="literal">keyring_encrypted_file_password</code> システム変数を設定します。 (パスワードは必須です。サーバーの起動時に指定しない場合、<code class="literal">keyring_encrypted_file</code> の初期化は失敗します。) <code class="literal">keyring_encrypted_file_data</code> システム変数は、オプションで、<code class="literal">keyring_encrypted_file</code> プラグインがデータストレージに使用するファイルの場所を構成します。 デフォルト値はプラットフォーム固有です。 ファイルの場所を明示的に構成するには、起動時に変数値を設定します。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルで次の行を使用し、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞とファイルの場所を調整し、選択したパスワードを置き換えます: 
      </p><pre class="programlisting">[mysqld]
early-plugin-load=keyring_encrypted_file.so
keyring_encrypted_file_data=/usr/local/mysql/mysql-keyring/keyring-encrypted
keyring_encrypted_file_password=<em class="replaceable"><code>password</code></em>
</pre><p>
        示されているように書き込まれると、<code class="filename">my.cnf</code> ファイルにはパスワードが格納されるため、パスワードは制限モードであり、MySQL サーバーの実行に使用されるアカウントからのみアクセス可能である必要があります。
      </p><p>
        キーリング操作はトランザクションです: <code class="literal">keyring_encrypted_file</code> プラグインは、書込み操作中にバックアップファイルを使用して、操作が失敗した場合に元のファイルにロールバックできるようにします。 バックアップファイルの名前は、接尾辞が <code class="filename">.backup</code> の <code class="literal">keyring_encrypted_file_data</code> システム変数の値と同じです。 
      </p><p>
        <code class="literal">keyring_encrypted_file</code> プラグインの構成に使用されるシステム変数の詳細は、<a class="xref" href="security.html#keyring-system-variables" title="6.4.4.13 キーリングシステム変数">セクション6.4.4.13「キーリングシステム変数」</a> を参照してください。
      </p><p>
        正しい鍵リングストレージファイルが存在する場合にのみ鍵が確実にフラッシュされるように、<code class="literal">keyring_encrypted_file</code> は鍵リングの SHA-256 チェックサムをファイルに格納します。 ファイルを更新する前に、プラグインは、予想されるチェックサムが含まれていることを確認します。 また、<code class="literal">keyring_encrypted_file</code> では、AES を使用してファイルの内容を暗号化してからファイルに書き込み、ファイルの内容を復号化します。 
      </p><p>
        <code class="literal">keyring_encrypted_file</code> プラグインは、標準の MySQL キーリングサービスインタフェースを構成する関数をサポートしています。 これらの関数によって実行されるキーリング操作には、次の 2 つのレベルでアクセスできます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL インタフェース: SQL ステートメントで、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> で説明されているユーザー定義関数 (UDF) をコールします。
          </p></li><li class="listitem"><p>
            C インタフェース: C 言語コードでは、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> で説明されているキーリングサービス関数をコールします。
          </p></li></ul></div><p>
        例 (UDF を使用):
      </p><pre class="programlisting">SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
        <code class="literal">keyring_encrypted_file</code> で許可されるキータイプの詳細は、<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-okv-plugin"></a>6.4.4.4 keyring_okv KMIP プラグインの使用</h4></div></div></div><a class="indexterm" name="idm46723755713536"></a><a class="indexterm" name="idm46723755712016"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">keyring_okv</code> プラグインは、商用製品である MySQL Enterprise Edition に含まれている拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
        </p></div><p>
        Key Management Interoperability Protocol (KMIP) は、鍵管理サーバーとそのクライアント間の暗号化鍵の通信を可能にします。 <code class="literal">keyring_okv</code> キーリングプラグインは KMIP 1.1 プロトコルを使用して、KMIP バックエンドのクライアントとしてセキュアに通信します。 キーリング材料は、<code class="literal">keyring_okv</code> ではなくバックエンドによって排他的に生成されます。 プラグインは、次の KMIP 互換製品で動作します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Oracle Key Vault
          </p></li><li class="listitem"><p>
            Gemalto SafeNet KeySecure アプライアンス
          </p></li><li class="listitem"><p>
            Townsend Alliance Key Manager
          </p></li></ul></div><p>
        <code class="literal">keyring_okv</code> プラグインは、標準の MySQL キーリングサービスインタフェースを構成する関数をサポートしています。 これらの関数によって実行されるキーリング操作には、次の 2 つのレベルでアクセスできます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL インタフェース: SQL ステートメントで、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> で説明されているユーザー定義関数 (UDF) をコールします。
          </p></li><li class="listitem"><p>
            C インタフェース: C 言語コードでは、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> で説明されているキーリングサービス関数をコールします。
          </p></li></ul></div><p>
        例 (UDF を使用):
      </p><pre class="programlisting">SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
        <code class="literal">keyring_okv</code>、<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> で許可されるキータイプの詳細。
      </p><p>
        <code class="literal">keyring_okv</code> プラグインをインストールするには、<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> にある一般的なキーリングのインストール手順と、ここにある <code class="literal">keyring_okv</code> に固有の構成情報を使用します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-configuration" title="一般的な keyring_okv 構成">一般的な keyring_okv 構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-oracle-key-vault" title="Oracle Key Vault 用の keyring_okv の構成">Oracle Key Vault 用の keyring_okv の構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-keysecure" title="Gemalto SafeNet KeySecure Appliance 用の keyring_okv の構成">Gemalto SafeNet KeySecure Appliance 用の keyring_okv の構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-alliance" title="Townsend Alliance Key Manager 用の keyring_okv の構成">Townsend Alliance Key Manager 用の keyring_okv の構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-encrypt-key-file" title="keyring_okv キーファイルのパスワード保護">keyring_okv キーファイルのパスワード保護</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-okv-configuration"></a>一般的な keyring_okv 構成</h5></div></div></div><a class="indexterm" name="idm46723755683360"></a><p>
          <code class="literal">keyring_okv</code> プラグインが鍵リングストレージに使用する KMIP バックエンドに関係なく、<code class="literal">keyring_okv_conf_dir</code> システム変数は、<code class="literal">keyring_okv</code> がサポートファイルに使用するディレクトリの場所を構成します。 デフォルト値は空であるため、プラグインが KMIP バックエンドと通信する前に、適切に構成されたディレクトリに名前を付けるように変数を設定する必要があります。 そうしないかぎり、<code class="literal">keyring_okv</code> は、通信できないメッセージをサーバーの起動時にエラーログに書き込みます: 
        </p><pre class="programlisting">[Warning] Plugin keyring_okv reported: 'For keyring_okv to be
initialized, please point the keyring_okv_conf_dir variable to a directory
containing Oracle Key Vault configuration file and ssl materials'
</pre><p>
          <code class="literal">keyring_okv_conf_dir</code> 変数は、次の項目を含むディレクトリに名前を付ける必要があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">okvclient.ora</code>: <code class="literal">keyring_okv</code> が通信する KMIP バックエンドの詳細を含むファイル。
            </p></li><li class="listitem"><p>
              <code class="filename">ssl</code>: KMIP バックエンドとのセキュアな接続を確立するために必要な証明書および鍵ファイルを含むディレクトリ: <code class="filename">CA.pem</code>、<code class="filename">cert.pem</code> および <code class="filename">key.pem</code>。 キーファイルがパスワードで保護されている場合、<code class="filename">ssl</code> ディレクトリには、キーファイルの復号化に必要なパスワードを含む <code class="filename">password.txt</code> という単一行のテキストファイルを含めることができます。 
            </p></li></ul></div><p>
          <code class="literal">keyring_okv</code> が正常に動作するには、証明書およびキーファイルを含む <code class="filename">okvclient.ora</code> ファイルと <code class="filename">ssl</code> ディレクトリの両方が必要です。 これらのファイルを構成ディレクトリに移入する手順は、他の場所で説明されているように、<code class="literal">keyring_okv</code> で使用される KMIP バックエンドによって異なります。 
        </p><p>
          <code class="literal">keyring_okv</code> でサポートファイルの場所として使用される構成ディレクトリには制限モードが必要で、MySQL サーバーの実行に使用されるアカウントからのみアクセスできます。 たとえば、Unix および Unix に似たシステムで<code class="filename">/usr/local/mysql/mysql-keyring-okv</code> ディレクトリを使用するには、次のコマンド (<code class="literal">root</code> として実行) を実行してディレクトリを作成し、そのモードと所有権を設定します: 
        </p><pre class="programlisting">cd /usr/local/mysql
mkdir mysql-keyring-okv
chmod 750 mysql-keyring-okv
chown mysql mysql-keyring-okv
chgrp mysql mysql-keyring-okv
</pre><p>
          サーバーの起動プロセス中に使用できるようにするには、<code class="option">--early-plugin-load</code> オプションを使用して <code class="literal">keyring_okv</code> をロードする必要があります。 また、<code class="literal">keyring_okv_conf_dir</code> システム変数を設定して、構成ディレクトリの場所を <code class="literal">keyring_okv</code> に通知します。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルで次の行を使用して、プラットフォームの <code class="filename">.so</code> 接尾辞とディレクトリの場所を必要に応じて調整します: 
        </p><pre class="programlisting">[mysqld]
early-plugin-load=keyring_okv.so
keyring_okv_conf_dir=/usr/local/mysql/mysql-keyring-okv
</pre><p>
          <code class="literal">keyring_okv_conf_dir</code> の詳細は、<a class="xref" href="security.html#keyring-system-variables" title="6.4.4.13 キーリングシステム変数">セクション6.4.4.13「キーリングシステム変数」</a> を参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-okv-oracle-key-vault"></a>Oracle Key Vault 用の keyring_okv の構成</h5></div></div></div><a class="indexterm" name="idm46723755647040"></a><a class="indexterm" name="idm46723755644912"></a><p>
          ここでの説明は、Oracle Key Vault に精通していることを前提としています。 いくつかの関連情報ソース: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/overview/index.html" target="_top">Oracle Key Vault サイト</a>
            </p></li><li class="listitem"><p>
              <a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/documentation/index.html" target="_top">Oracle Key Vault のドキュメント</a>
            </p></li></ul></div><p>
          Oracle Key Vault 用語では、Oracle Key Vault を使用してセキュリティオブジェクトを格納および取得するクライアントはエンドポイントと呼ばれます。 Oracle Key Vault と通信するには、エンドポイントとして登録し、エンドポイントサポートファイルをダウンロードしてインストールする必要があります。 
        </p><p>
          次の手順は、Oracle Key Vault で使用するための <code class="literal">keyring_okv</code> の設定プロセスを簡単に要約したものです:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              使用する <code class="literal">keyring_okv</code> プラグインの構成ディレクトリを作成します。
            </p></li><li class="listitem"><p>
              エンドポイントを Oracle Key Vault に登録して、エンロールトークンを取得します。
            </p></li><li class="listitem"><p>
              エンロールトークンを使用して、<code class="filename">okvclient.jar</code> クライアントソフトウェアのダウンロードを取得します。
            </p></li><li class="listitem"><p>
              クライアントソフトウェアをインストールして、Oracle Key Vault サポートファイルを含む <code class="literal">keyring_okv</code> 構成ディレクトリに移入します。
            </p></li></ol></div><p>
          <code class="literal">keyring_okv</code> と Oracle Key Vault が連携するように構成するには、次の手順を使用します。 この説明では、Oracle Key Vault との対話方法のみをまとめています。 詳細は、<a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/overview/index.html" target="_top">Oracle Key Vault</a> サイトにアクセスし、『 Oracle Key Vault 管理者ガイド』を参照してください。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              Oracle Key Vault サポートファイルを含む構成ディレクトリを作成し、<code class="literal">keyring_okv_conf_dir</code> システム変数がそのディレクトリに名前を付けるように設定されていることを確認します (詳細は、<a class="xref" href="security.html#keyring-okv-configuration" title="一般的な keyring_okv 構成">一般的な keyring_okv 構成</a> を参照)。
            </p></li><li class="listitem"><p>
              システム管理者ロールを持つユーザーとして Oracle Key Vault 管理コンソールにログインします。
            </p></li><li class="listitem"><p>
              Endpoints タブを選択して、Endpoints ページにアクセスします。 Endpoints ページで、Add をクリックします。 
            </p></li><li class="listitem"><p>
              必要なエンドポイント情報を指定し、Register をクリックします。 エンドポイントタイプはその他である必要があります。 登録に成功すると、エンロールトークンが生成されます。 
            </p></li><li class="listitem"><p>
              Oracle Key Vault サーバーからログアウトします。
            </p></li><li class="listitem"><p>
              今回はログインせずに、Oracle Key Vault サーバーに再度接続します。 エンドポイントエンロールトークンを使用して、<code class="filename">okvclient.jar</code> ソフトウェアのダウンロードをエンロールおよびリクエストします。 このファイルをシステムに保存します。 
            </p></li><li class="listitem"><p>
              次のコマンドを使用して、<code class="filename">okvclient.jar</code> ファイルをインストールします (JDK 1.4 以上が必要です):
            </p><pre class="programlisting">java -jar okvclient.jar -d <em class="replaceable"><code>dir_name</code></em> [-v]
</pre><p>
              <code class="option">-d</code> オプションに続くディレクトリ名は、抽出したファイルをインストールする場所です。 <code class="option">-v</code> オプションを指定すると、コマンドが失敗した場合に役立つログ情報が生成されます。 
            </p><p>
              コマンドで Oracle Key Vault エンドポイントパスワードを要求された場合は、指定しないでください。 代わりに、Enter キーを押します。 (その結果、エンドポイントが Oracle Key Vault に接続するときにパスワードは必要ありません。) 
            </p></li><li class="listitem"><p>
              前述のコマンドにより、<code class="filename">okvclient.ora</code> ファイルが生成されます。このファイルは、前述の <span class="command"><strong>java -jar</strong></span> コマンドの <code class="option">-d</code> オプションで指定されたディレクトリの下のこの場所にある必要があります:
            </p><pre class="programlisting">install_dir/conf/okvclient.ora
</pre><p>
              ファイルの内容には、次のような行が含まれます:
            </p><pre class="programlisting">SERVER=<em class="replaceable"><code>host_ip</code></em>:<em class="replaceable"><code>port_num</code></em>
STANDBY_SERVER=<em class="replaceable"><code>host_ip</code></em>:<em class="replaceable"><code>port_num</code></em>
</pre><p>
              <code class="literal">keyring_okv</code> プラグインは、<code class="literal">SERVER</code> 変数で指定されたホスト上で実行されているサーバーと通信しようとし、失敗した場合は <code class="literal">STANDBY_SERVER</code> にフォールバックします:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  <code class="literal">SERVER</code> 変数の場合、<code class="filename">okvclient.ora</code> ファイルの設定は必須です。
                </p></li><li class="listitem"><p>
                  <code class="literal">STANDBY_SERVER</code> 変数の場合、<code class="filename">okvclient.ora</code> ファイルの設定はオプションです。
                </p></li></ul></div></li><li class="listitem"><p>
              Oracle Key Vault インストーラディレクトリに移動し、次のコマンドを実行して設定をテストします:
            </p><pre class="programlisting">okvutil/bin/okvutil list
</pre><p>
              出力は次のようになります:
            </p><pre class="programlisting">Unique ID                               Type            Identifier
255AB8DE-C97F-482C-E053-0100007F28B9	Symmetric Key	-
264BF6E0-A20E-7C42-E053-0100007FB29C	Symmetric Key	-
</pre><p>
              新しい Oracle Key Vault サーバー (キーのないサーバー) の場合、ボールトにキーがないことを示すために、出力は次のようになります:
            </p><pre class="programlisting">no objects found
</pre></li><li class="listitem"><p>
              次のコマンドを使用して、SSL 材料を含む <code class="filename">ssl</code> ディレクトリを <code class="filename">okvclient.jar</code> ファイルから抽出します:
            </p><pre class="programlisting">jar xf okvclient.jar ssl
</pre></li><li class="listitem"><p>
              Oracle Key Vault サポートファイル (<code class="filename">okvclient.ora</code> ファイルおよび <code class="filename">ssl</code> ディレクトリ) を構成ディレクトリにコピーします。
            </p></li><li class="listitem"><p>
              (オプション) キーファイルをパスワードで保護する場合は、<a class="xref" href="security.html#keyring-okv-encrypt-key-file" title="keyring_okv キーファイルのパスワード保護">keyring_okv キーファイルのパスワード保護</a> の手順を使用します。
            </p></li></ol></div><p>
          前述の手順を完了したら、MySQL サーバーを再起動します。 <code class="literal">keyring_okv</code> プラグインがロードされ、<code class="literal">keyring_okv</code> は構成ディレクトリ内のファイルを使用して Oracle Key Vault と通信します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-okv-keysecure"></a>Gemalto SafeNet KeySecure Appliance 用の keyring_okv の構成</h5></div></div></div><a class="indexterm" name="idm46723755577712"></a><a class="indexterm" name="idm46723755575392"></a><a class="indexterm" name="idm46723755573152"></a><p>
          Gemalto SafeNet KeySecure Appliance は KMIP プロトコル (バージョン 1.1 または 1.2) を使用します。 <code class="literal">keyring_okv</code> キーリングプラグイン (KMIP 1.1 をサポート) は、鍵リングストレージの KMIP バックエンドとして KeySecure を使用できます。 
        </p><p>
          <code class="literal">keyring_okv</code> と KeySecure が連携するように構成するには、次の手順を使用します。 説明には、KeySecure との対話方法のみがまとめられています。 詳細は、Add a KMIP Server in the <a class="ulink" href="https://www2.gemalto.com/aws-marketplace/usage/vks/uploadedFiles/Support_and_Downloads/AWS/007-012362-001-keysecure-appliance-user-guide-v7.1.0.pdf" target="_top">「KeySecure ユーザーガイド」</a>のセクションを参照してください。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              KeySecure サポートファイルを含む構成ディレクトリを作成し、<code class="literal">keyring_okv_conf_dir</code> システム変数がそのディレクトリに名前を付けるように設定されていることを確認します (詳細は、<a class="xref" href="security.html#keyring-okv-configuration" title="一般的な keyring_okv 構成">一般的な keyring_okv 構成</a> を参照)。
            </p></li><li class="listitem"><p>
              構成ディレクトリで、必要な SSL 証明書およびキーファイルの格納に使用する <code class="filename">ssl</code> という名前のサブディレクトリを作成します。
            </p></li><li class="listitem"><p>
              構成ディレクトリで、<code class="filename">okvclient.ora</code> という名前のファイルを作成します。 次の形式である必要があります: 
            </p><pre class="programlisting">SERVER=<em class="replaceable"><code>host_ip</code></em>:<em class="replaceable"><code>port_num</code></em>
STANDBY_SERVER=<em class="replaceable"><code>host_ip</code></em>:<em class="replaceable"><code>port_num</code></em>
</pre><p>
              たとえば、KeySecure がホスト 198.51.100.20 で実行されており、ポート 9002 でリスニングしている場合、<code class="filename">okvclient.ora</code> ファイルは次のようになります:
            </p><pre class="programlisting">SERVER=198.51.100.20:9002
STANDBY_SERVER=198.51.100.20:9002
</pre></li><li class="listitem"><p>
              認証局アクセスの資格証明を持つ管理者として KeySecure 管理コンソールに接続します。
            </p></li><li class="listitem"><p>
              セキュリティ→ローカル CA に移動し、ローカル認証局 (CA) を作成します。
            </p></li><li class="listitem"><p>
              信頼できる CA リストに移動します。 デフォルトを選択し、プロパティをクリックします。 次に、信頼できる認証局リストの編集を選択し、作成した CA を追加します。 
            </p></li><li class="listitem"><p>
              CA をダウンロードし、<code class="filename">CA.pem</code> という名前のファイルとして <code class="filename">ssl</code> ディレクトリに保存します。
            </p></li><li class="listitem"><p>
              Security &gt; &gt; Certificate Requests に移動し、証明書を作成します。 その後、証明書 PEM ファイルを含む圧縮 <span class="command"><strong>tar</strong></span> ファイルをダウンロードできます。 
            </p></li><li class="listitem"><p>
              ダウンロードしたファイルから PEM ファイルを抽出します。 たとえば、ファイル名が <code class="filename">csr_w_pk_pkcs8.gz</code> の場合は、次のコマンドを使用して解凍および解凍します: 
            </p><pre class="programlisting">tar zxvf csr_w_pk_pkcs8.gz
</pre><p>
              2 つのファイルが抽出操作によって生成されます: <code class="filename">certificate_request.pem</code> および <code class="filename">private_key_pkcs8.pem</code>。
            </p></li><li class="listitem"><p>
              この <span class="command"><strong>openssl</strong></span> コマンドを使用して、秘密キーを復号化し、<code class="filename">key.pem</code> という名前のファイルを作成します:
            </p><pre class="programlisting">openssl pkcs8 -in private_key_pkcs8.pem -out key.pem
</pre></li><li class="listitem"><p>
              <code class="filename">key.pem</code> ファイルを <code class="filename">ssl</code> ディレクトリにコピーします。
            </p></li><li class="listitem"><p>
              <code class="filename">certificate_request.pem</code> の証明書リクエストをクリップボードにコピーします。
            </p></li><li class="listitem"><p>
              Security &gt; &gt; Local CA に移動します。 以前に作成した CA (<code class="filename">CA.pem</code> ファイルを作成するためにダウンロードした CA) を選択し、署名リクエストをクリックします。 クリップボードから証明書リクエストを貼り付け、クライアントの証明書の目的 (キーリングは KeySecure のクライアント) を選択して、署名リクエストをクリックします。 その結果、選択した CA で署名された証明書が新しいページに表示されます。 
            </p></li><li class="listitem"><p>
              署名付き証明書をクリップボードにコピーし、クリップボードの内容を <code class="filename">cert.pem</code> という名前のファイルとして <code class="filename">ssl</code> ディレクトリに保存します。
            </p></li><li class="listitem"><p>
              (オプション) キーファイルをパスワードで保護する場合は、<a class="xref" href="security.html#keyring-okv-encrypt-key-file" title="keyring_okv キーファイルのパスワード保護">keyring_okv キーファイルのパスワード保護</a> の手順を使用します。
            </p></li></ol></div><p>
          前述の手順を完了したら、MySQL サーバーを再起動します。 <code class="literal">keyring_okv</code> プラグインがロードされ、<code class="literal">keyring_okv</code> は構成ディレクトリ内のファイルを使用して KeySecure と通信します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-okv-alliance"></a>Townsend Alliance Key Manager 用の keyring_okv の構成</h5></div></div></div><a class="indexterm" name="idm46723755523888"></a><a class="indexterm" name="idm46723755521808"></a><a class="indexterm" name="idm46723755519536"></a><p>
          Townsend Alliance Key Manager は KMIP プロトコルを使用します。 <code class="literal">keyring_okv</code> キーリングプラグインは、キーリングストレージの KMIP バックエンドとして Alliance Key Manager を使用できます。 詳細は、<a class="ulink" href="https://www.townsendsecurity.com/product/encryption-key-management-mysql" target="_top">「MySQL のアライアンスキーマネージャ」</a>を参照してください。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-okv-encrypt-key-file"></a>keyring_okv キーファイルのパスワード保護</h5></div></div></div><p>
          オプションで、キーファイルをパスワードで保護し、パスワードを含むファイルを指定してキーファイルを復号化できます。 これを行うには、場所を <code class="filename">ssl</code> ディレクトリに変更し、次のステップを実行します: 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              <code class="filename">key.pem</code> キーファイルを暗号化します。 たとえば、次のようなコマンドを使用して、プロンプトで暗号化パスワードを入力します: 
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>openssl rsa -des3 -in key.pem -out key.pem.new</code></strong>
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
</pre></li><li class="listitem"><p>
              <code class="filename">ssl</code> ディレクトリの <code class="filename">password.txt</code> という単一行のテキストファイルに暗号化パスワードを保存します。
            </p></li><li class="listitem"><p>
              次のコマンドを使用して、暗号化されたキーファイルを復号化できることを確認します。 復号化されたファイルがコンソールに表示されます: 
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>openssl rsa -in key.pem.new -passin file:password.txt</code></strong>
</pre></li><li class="listitem"><p>
              元の <code class="filename">key.pem</code> ファイルを削除し、<code class="filename">key.pem.new</code> の名前を <code class="filename">key.pem</code> に変更します。
            </p></li><li class="listitem"><p>
              必要に応じて、新しい <code class="filename">key.pem</code> ファイルおよび <code class="filename">password.txt</code> ファイルの所有権とアクセスモードを変更し、<code class="filename">ssl</code> ディレクトリ内の他のファイルと同じ制限があることを確認します。
            </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-aws-plugin"></a>6.4.4.5 keyring_aws Amazon Web Services キーリングプラグインの使用</h4></div></div></div><a class="indexterm" name="idm46723755494176"></a><a class="indexterm" name="idm46723755492656"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">keyring_aws</code> プラグインは、商用製品である MySQL Enterprise Edition に含まれている拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
        </p></div><p>
        <code class="literal">keyring_aws</code> キーリングプラグインは、キー生成のバックエンドとして Amazon Web Services Key Management Service (AWS KMS) と通信し、キーの格納にローカルファイルを使用します。 すべてのキーリングデータは、AWS サーバーによってのみ生成され、<code class="literal">keyring_aws</code> によっては生成されません。 
      </p><p>
        <code class="literal">keyring_aws</code> は、次のプラットフォームで使用できます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            EL7
          </p></li><li class="listitem"><p>
            macOS 10.13 および 10.14
          </p></li><li class="listitem"><p>
            SLES 12
          </p></li><li class="listitem"><p>
            Ubuntu 14.04 および 16.04
          </p></li><li class="listitem"><p>
            Windows
          </p></li></ul></div><p>
        ここでの説明は、AWS 全般および KMS に精通していることを前提としています。 いくつかの関連情報ソース: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="ulink" href="https://aws.amazon.com/kms/" target="_top">AWS サイト</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.aws.amazon.com/kms/" target="_top">KMS ドキュメント</a>
          </p></li></ul></div><p>
        次の各セクションでは、<code class="literal">keyring_aws</code> キープラグインの構成および使用方法について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#keyring-aws-plugin-configuration" title="keyring_aws 構成">keyring_aws 構成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-aws-plugin-operation" title="keyring_aws 操作">keyring_aws 操作</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-aws-plugin-credential-changes" title="keyring_aws 資格証明の変更">keyring_aws 資格証明の変更</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-aws-plugin-configuration"></a>keyring_aws 構成</h5></div></div></div><p>
          <code class="literal">keyring_aws</code> プラグインをインストールするには、ここにあるプラグイン固有の構成情報とともに、<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> にある一般的なキーリングインストール手順を使用します。
        </p><p>
          プラグインライブラリファイルには、<code class="literal">keyring_aws</code> プラグインと、<code class="literal">keyring_aws_rotate_cmk()</code> および <code class="literal">keyring_aws_rotate_keys()</code> の 2 つのユーザー定義関数 (UDF) が含まれます。
        </p><p>
          <code class="literal">keyring_aws</code> を構成するには、AWS KMS と通信するための資格証明を提供する秘密アクセスキーを取得し、それを構成ファイルに書き込む必要があります:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              AWS KMS アカウントを作成します。
            </p></li><li class="listitem"><p>
              AWS KMS を使用して、秘密アクセスキー ID および秘密アクセスキーを作成します。 アクセスキーは、アイデンティティおよびアプリケーションのアイデンティティを検証するために機能します。 
            </p></li><li class="listitem"><p>
              AWS KMS アカウントを使用して、顧客マスターキー (CMK) ID を作成します。 MySQL の起動時に、<code class="literal">keyring_aws_cmk_id</code> システム変数を CMK ID 値に設定します。 この変数は必須であり、デフォルトはありません。 (この値は、必要に応じて <code class="literal">SET GLOBAL</code> を使用して実行時に変更できます。) 
            </p></li><li class="listitem"><p>
              必要に応じて、構成ファイルを配置するディレクトリを作成します。 ディレクトリには制限モードがあり、MySQL サーバーの実行に使用されるアカウントからのみアクセスできる必要があります。 たとえば、Unix および Unix に似たシステムでは、<code class="filename">/usr/local/mysql/mysql-keyring/keyring_aws_conf</code> をファイル名として使用するために、次のコマンド (<code class="literal">root</code> として実行) によって親ディレクトリが作成され、ディレクトリのモードと所有権が設定されます: 
            </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cd /usr/local/mysql</code></strong>
shell&gt; <strong class="userinput"><code>mkdir mysql-keyring</code></strong>
shell&gt; <strong class="userinput"><code>chmod 750 mysql-keyring</code></strong>
shell&gt; <strong class="userinput"><code>chown mysql mysql-keyring</code></strong>
shell&gt; <strong class="userinput"><code>chgrp mysql mysql-keyring</code></strong>
</pre><p>
              MySQL の起動時に、<code class="literal">keyring_aws_conf_file</code> システム変数を<code class="filename">/usr/local/mysql/mysql-keyring/keyring_aws_conf</code> に設定して、構成ファイルの場所をサーバーに示します。
            </p></li><li class="listitem"><p>
              次の 2 つの行を含む <code class="literal">keyring_aws</code> 構成ファイルを準備します:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  明細 1: 秘密アクセスキー ID
                </p></li><li class="listitem"><p>
                  明細 2: 秘密アクセスキー
                </p></li></ul></div><p>
              たとえば、キー ID が <code class="literal">wwwwwwwwwwwwwEXAMPLE</code> で、キーが <code class="literal">xxxxxxxxxxxxx/yyyyyyy/zzzzzzzzEXAMPLEKEY</code> の場合、構成ファイルは次のようになります:
            </p><pre class="programlisting">wwwwwwwwwwwwwEXAMPLE
xxxxxxxxxxxxx/yyyyyyy/zzzzzzzzEXAMPLEKEY
</pre></li></ol></div><p>
          サーバーの起動プロセス中に使用できるようにするには、<code class="option">--early-plugin-load</code> オプションを使用して <code class="literal">keyring_aws</code> をロードする必要があります。 <code class="literal">keyring_aws_cmk_id</code> システム変数は必須であり、AWS KMS サーバーから取得した顧客マスターキー (CMK) ID を構成します。 <code class="literal">keyring_aws_conf_file</code> および <code class="literal">keyring_aws_data_file</code> システム変数は、オプションで、<code class="literal">keyring_aws</code> プラグインが構成情報およびデータ記憶域に使用するファイルの場所を構成します。 ファイルの場所変数のデフォルト値はプラットフォーム固有です。 場所を明示的に構成するには、起動時に変数値を設定します。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルで次の行を使用して、プラットフォームの <code class="filename">.so</code> 接尾辞とファイルの場所を必要に応じて調整します: 
        </p><pre class="programlisting">[mysqld]
early-plugin-load=keyring_aws.so
keyring_aws_cmk_id='arn:aws:kms:us-west-2:111122223333:key/abcd1234-ef56-ab12-cd34-ef56abcd1234'
keyring_aws_conf_file=/usr/local/mysql/mysql-keyring/keyring_aws_conf
keyring_aws_data_file=/usr/local/mysql/mysql-keyring/keyring_aws_data
</pre><p>
          <code class="literal">keyring_aws</code> プラグインを正常に起動するには、構成ファイルが存在し、前述のように初期化された有効な秘密アクセスキー情報が含まれている必要があります。 ストレージファイルが存在する必要はありません。 そうでない場合、<code class="literal">keyring_aws</code> はそれを (必要に応じて親ディレクトリとともに) 作成しようとします。 
        </p><p>
          <code class="literal">keyring_aws</code> プラグインの構成に使用されるシステム変数の詳細は、<a class="xref" href="security.html#keyring-system-variables" title="6.4.4.13 キーリングシステム変数">セクション6.4.4.13「キーリングシステム変数」</a> を参照してください。
        </p><p>
          MySQL サーバーを起動し、<code class="literal">keyring_aws</code> プラグインに関連付けられた UDF をインストールします。 これはワンタイム操作で、次のステートメントを実行して、プラットフォームの <code class="filename">.so</code> 接尾辞を必要に応じて調整します: 
        </p><pre class="programlisting">CREATE FUNCTION keyring_aws_rotate_cmk RETURNS INTEGER
  SONAME 'keyring_aws.so';
CREATE FUNCTION keyring_aws_rotate_keys RETURNS INTEGER
  SONAME 'keyring_aws.so';
</pre><p>
          <code class="literal">keyring_aws</code> UDF の詳細は、<a class="xref" href="security.html#keyring-functions-plugin-specific" title="6.4.4.11 プラグイン固有のキーリングキー管理関数">セクション6.4.4.11「プラグイン固有のキーリングキー管理関数」</a> を参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-aws-plugin-operation"></a>keyring_aws 操作</h5></div></div></div><p>
          プラグインの起動時に、<code class="literal">keyring_aws</code> プラグインは AWS 秘密アクセスキー ID とキーをその構成ファイルから読み取ります。 また、記憶域ファイルに含まれる暗号化されたキーをメモリー内キャッシュに読み取ります。 
        </p><p>
          操作中、<code class="literal">keyring_aws</code> は暗号化されたキーをインメモリーキャッシュに保持し、記憶域ファイルをローカル永続記憶域として使用します。 各キーリング操作はトランザクション型です: <code class="literal">keyring_aws</code> では、メモリー内キーキャッシュとキーリングストレージファイルの両方が正常に変更されるか、操作が失敗してキーリングの状態は変更されません。 
        </p><p>
          正しい鍵リングストレージファイルが存在する場合にのみ鍵が確実にフラッシュされるように、<code class="literal">keyring_aws</code> は鍵リングの SHA-256 チェックサムをファイルに格納します。 ファイルを更新する前に、プラグインは、予想されるチェックサムが含まれていることを確認します。 
        </p><p>
          <code class="literal">keyring_aws</code> プラグインは、標準の MySQL キーリングサービスインタフェースを構成する関数をサポートしています。 これらの関数によって実行されるキーリング操作には、次の 2 つのレベルでアクセスできます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              SQL インタフェース: SQL ステートメントで、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> で説明されているユーザー定義関数 (UDF) をコールします。
            </p></li><li class="listitem"><p>
              C インタフェース: C 言語コードでは、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> で説明されているキーリングサービス関数をコールします。
            </p></li></ul></div><p>
          例 (UDF を使用):
        </p><pre class="programlisting">SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
          また、<code class="literal">keyring_aws_rotate_cmk()</code> および <code class="literal">keyring_aws_rotate_keys()</code> UDF は、標準のキーリングサービスインタフェースでカバーされていない AWS 関連の機能を提供するために、キーリングプラグインインタフェースを <span class="quote">「<span class="quote">extend</span>」</span> に提供します。 これらの機能には、UDF を呼び出すことによってのみアクセスできます。 対応する C 言語キーサービス関数はありません。 
        </p><p>
          <code class="literal">keyring_aws</code> で許可されるキータイプの詳細は、<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> を参照してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-aws-plugin-credential-changes"></a>keyring_aws 資格証明の変更</h5></div></div></div><p>
          <code class="literal">keyring_aws</code> プラグインがサーバーの起動時に適切に初期化されていると仮定すると、AWS KMS との通信に使用される資格証明を変更できます:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              AWS KMS を使用して、新しい秘密アクセスキー ID および秘密アクセスキーを作成します。
            </p></li><li class="listitem"><p>
              新しい資格証明を構成ファイル (<code class="literal">keyring_aws_conf_file</code> システム変数で指定されたファイル) に格納します。 ファイル形式は前述のとおりです。 
            </p></li><li class="listitem"><p>
              <code class="literal">keyring_aws</code> プラグインを再初期化して、構成ファイルを再読み込みします。 新しい資格証明が有効であると仮定すると、プラグインは正常に初期化されます。 
            </p><p>
              プラグインを再初期化するには、2 つの方法があります:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  サーバーを再起動します。 これは単純で副作用はありませんが、できるだけ再起動が少ないサーバーの停止時間を最小限に抑えるインストールには適していません。 
                </p></li><li class="listitem"><p>
                  次のステートメントを実行して、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整し、サーバーを再起動せずにプラグインを再初期化します:
                </p><pre class="programlisting">UNINSTALL PLUGIN keyring_aws;
INSTALL PLUGIN keyring_aws SONAME 'keyring_aws.so';
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                    <code class="literal">INSTALL PLUGIN</code> では、実行時にプラグインをロードするだけでなく、プラグインを <code class="literal">mysql.plugin</code> システムテーブルに登録するという副作用もあります。 このため、<code class="literal">keyring_aws</code> の使用を停止する場合は、サーバーの起動に使用される一連のオプションから <code class="option">--early-plugin-load</code> オプションを削除するだけでは不十分です。 これにより、プラグインの早期ロードは停止されますが、サーバーは、<code class="literal">mysql.plugin</code> に登録されているプラグインをロードする起動シーケンス内のポイントに到達したときに、プラグインのロードを試行します。 
                  </p><p>
                    したがって、AWS KMS 資格証明を変更するために説明した <code class="literal">UNINSTALL PLUGIN</code> と <code class="literal">INSTALL PLUGIN</code> の順序を実行した場合、<code class="literal">keyring_aws</code> の使用を停止するには、<code class="option">--early-plugin-load</code> オプションの削除に加えて、<code class="literal">UNINSTALL PLUGIN</code> を再度実行してプラグインを登録解除する必要があります。
                  </p></div></li></ul></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-hashicorp-plugin"></a>6.4.4.6 HashiCorp Vault キーリングプラグインの使用</h4></div></div></div><a class="indexterm" name="idm46723755371872"></a><a class="indexterm" name="idm46723755370304"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">keyring_hashicorp</code> プラグインは、商用製品である MySQL Enterprise Edition に含まれている拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
        </p></div><p>
        <code class="literal">keyring_hashicorp</code> キーリングプラグインは、バックエンドストレージのために HashiCorp Vault と通信します。 プラグインは、HashiCorp Vault AppRole 認証をサポートしています。 キー情報は、MySQL サーバーのローカル記憶域に永続的に格納されません。 (オプションのインメモリーキーキャッシュを中間記憶域として使用できます。) ランダムキー生成は MySQL サーバー側で実行され、その後、キーは Hashicorp Vault に格納されます。 
      </p><p>
        <code class="literal">keyring_hashicorp</code> プラグインは、標準の MySQL キーリングサービスインタフェースを構成する関数をサポートしています。 これらの関数によって実行されるキーリング操作には、次の 2 つのレベルでアクセスできます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL インタフェース: SQL ステートメントで、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> で説明されているユーザー定義関数 (UDF) をコールします。
          </p></li><li class="listitem"><p>
            C インタフェース: C 言語コードでは、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> で説明されているキーリングサービス関数をコールします。
          </p></li></ul></div><p>
        例 (UDF を使用):
      </p><pre class="programlisting">SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
        <code class="literal">keyring_hashicorp</code> で許可されるキータイプの詳細は、<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> を参照してください。
      </p><p>
        <code class="literal">keyring_hashicorp</code> プラグインをインストールするには、<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> にある一般的なキーリングのインストール手順と、ここにある <code class="literal">keyring_hashicorp</code> に固有の構成情報を使用します。 プラグイン固有の構成には、HashiCorp Vault への接続および Vault 自体の構成に必要な証明書およびキーファイルの準備が含まれます。 次の各セクションでは、必要な手順について説明します。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#keyring-hashicorp-certificate-configuration" title="証明書とキーの準備">証明書とキーの準備</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-hashicorp-vault-configuration" title="HashiCorp Vault の設定">HashiCorp Vault の設定</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-hashicorp-certificate-configuration"></a>証明書とキーの準備</h5></div></div></div><a class="indexterm" name="idm46723755347264"></a><p>
          <code class="literal">keyring_hashicorp</code> プラグインには、HTTPS プロトコルを使用した HashiCorp Vault サーバーへのセキュアな接続が必要です。 一般的な設定には、証明書とキーファイルのセットが含まれます: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">company.crt</code>: 組織に属するカスタム CA 証明書。 このファイルは、HashiCorp Vault サーバーと <code class="literal">keyring_hashicorp</code> プラグインの両方で使用されます。 
            </p></li><li class="listitem"><p>
              <code class="filename">vault.key</code>: HashiCorp Vault サーバーインスタンスの秘密キー。 このファイルは、HashiCorp Vault サーバーで使用されます。 
            </p></li><li class="listitem"><p>
              <code class="filename">vault.crt</code>: HashiCorp Vault サーバーインスタンスの証明書。 このファイルは、組織の CA 証明書によって署名されている必要があります。 
            </p></li></ul></div><p>
          次の手順では、OpenSSL を使用して証明書およびキーファイルを作成する方法について説明します。 (すでにファイルがある場合は、<a class="xref" href="security.html#keyring-hashicorp-vault-configuration" title="HashiCorp Vault の設定">HashiCorp Vault の設定</a> に進みます。) 示されている手順は Linux プラットフォームに適用され、他のプラットフォームに対する調整が必要になる場合があります。 
        </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
            これらの手順で生成される証明書は自己署名されており、あまりセキュアではない可能性があります。 このようなファイルの使用経験がある場合は、登録された認証局から証明書/キーデータを取得することを検討してください。 
          </p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              会社キーと HashiCorp Vault サーバーキーを準備します。
            </p><p>
              次のコマンドを使用して、キーファイルを生成します:
            </p><pre class="programlisting">openssl genrsa -aes256 -out company.key 4096
openssl genrsa -aes256 -out vault.key 2048
</pre><p>
              これらのコマンドは、会社の秘密キー (<code class="filename">company.key</code>) および Vault サーバーの秘密キー (<code class="filename">vault.key</code>) を保持するファイルを生成します。 鍵はそれぞれ 4,096 ビットと 2,048 ビットのランダムに生成された RSA 鍵です。 
            </p><p>
              各コマンドでは、パスワードの入力を求められます。 (テスト目的では、パスワードは必要ありません。 無効にするには、<code class="option">-aes256</code> 引数を省略します。) 
            </p><p>
              キーファイルは機密情報を保持し、セキュアな場所に格納する必要があります。 パスワードは後で必要になるため、書き留めて安全な場所に格納します。 
            </p><p>
              (オプション) キーファイルの内容と有効性を確認するには、次のコマンドを使用します:
            </p><pre class="programlisting">openssl rsa -in company.key -check
openssl rsa -in vault.key -check
</pre></li><li class="listitem"><p>
              会社の CA 証明書を作成します。
            </p><p>
              365 日間有効な <code class="filename">company.crt</code> という名前の会社の CA 証明書ファイルを作成するには、次のコマンドを使用します (コマンドは単一行で入力します):
            </p><pre class="programlisting">openssl req -x509 -new -nodes -key company.key
  -sha256 -days 365 -out company.crt
</pre><p>
              <code class="option">-aes256</code> 引数を使用してキーの生成時にキーの暗号化を実行した場合、CA 証明書の作成時に会社のキーパスワードの入力を求められます。 次に示すように、証明書ホルダー (つまり、自分または会社) に関する情報の入力も求められます: 
            </p><pre class="programlisting">Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
</pre><p>
              プロンプトに適切な値を入力します。
            </p></li><li class="listitem"><p>
              証明書署名リクエストを作成します。
            </p><p>
              HashiCorp Vault サーバー証明書を作成するには、新しく作成したサーバーキーに対して証明書署名リクエスト (CSR) を準備する必要があります。 次の行を含む <code class="filename">request.conf</code> という名前の構成ファイルを作成します。 HashiCorp Vault サーバーがローカルホストで実行されていない場合は、適切な CN 値と IP 値を置き換え、必要に応じて他の変更を行います。 
            </p><pre class="programlisting">[req]
distinguished_name = vault
x509_entensions = v3_req
prompt = no

[vault]
C = US
ST = CA
L = RWC
O = Company
CN = 127.0.0.1

[v3_req]
subjectAltName = @alternatives
authorityKeyIdentifier = keyid,issuer
basicConstraints = CA:TRUE

[alternatives]
IP = 127.0.0.1
</pre><p>
              署名要求を作成するには、次のコマンドを使用します:
            </p><pre class="programlisting">openssl req -new -key vault.key -config request.conf -out request.csr
</pre><p>
              出力ファイル (<code class="filename">request.csr</code>) は、サーバー証明書を作成するための入力として機能する中間ファイルです。
            </p></li><li class="listitem"><p>
              HashiCorp Vault サーバー証明書を作成します。
            </p><p>
              HashiCorp Vault サーバーキー (<code class="filename">vault.key</code>) と CSR (<code class="filename">request.csr</code>) の結合情報に会社の証明書 (<code class="filename">company.crt</code>) を使用して署名し、HashiCorp Vault サーバー証明書 (<code class="filename">vault.crt</code>) を作成します。 これを行うには、次のコマンドを使用します (コマンドは単一行で入力します): 
            </p><pre class="programlisting">openssl x509 -req -in request.csr
  -CA company.crt -CAkey company.key -CAcreateserial
  -out vault.crt -days 365 -sha256
</pre><p>
              <code class="filename">vault.crt</code> サーバー証明書を役に立つようにするには、<code class="filename">company.crt</code> 会社の証明書の内容を追加します。 これは、会社の証明書がリクエストでサーバー証明書とともに配信されるようにするために必要です。 
            </p><pre class="programlisting">cat company.crt &gt;&gt; vault.crt
</pre><p>
              テキストエディタで <code class="filename">vault.crt</code> ファイルを開くと、その内容は次のようになります:
            </p><pre class="programlisting">-----BEGIN CERTIFICATE-----
... <em class="replaceable"><code>content of HashiCorp Vault server certificate</code></em> ...
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
... <em class="replaceable"><code>content of company certificate</code></em> ...
-----END CERTIFICATE-----
</pre></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-hashicorp-vault-configuration"></a>HashiCorp Vault の設定</h5></div></div></div><a class="indexterm" name="idm46723755296512"></a><p>
          次の手順では、<code class="literal">keyring_hashicorp</code> プラグインのテストを容易にする HashiCorp Vault 設定を作成する方法について説明します。
        </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
            テスト設定は本番設定と似ていますが、HashiCorp Vault を本番で使用するには、自己署名されていない証明書の使用やシステムトラストストアへの会社の証明書の格納など、追加のセキュリティ上の考慮事項が必要です。 運用要件を満たすために必要な追加のセキュリティステップを実装する必要があります。 
          </p></div><p>
          次の手順では、<a class="xref" href="security.html#keyring-hashicorp-certificate-configuration" title="証明書とキーの準備">証明書とキーの準備</a> で作成された証明書およびキーファイルが使用可能であることを前提としています。 ファイルがない場合は、そのセクションを参照してください。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              HashiCorp Vault バイナリをフェッチします。
            </p><p>
              ご使用のプラットフォームに適した HashiCorp Vault バイナリを <a class="ulink" href="https://www.vaultproject.io/downloads.html" target="_top">https://www.vaultproject.io/downloads.html</a> からダウンロードします。
            </p><p>
              アーカイブの内容を抽出して、HashiCorp Vault 操作の実行に使用される実行可能な <span class="command"><strong>vault</strong></span> コマンドを生成します。 必要に応じて、コマンドをインストールするディレクトリをシステムパスに追加します。 
            </p><p>
              (オプション) HashiCorp Vault では、使いやすくするオートコンプリートオプションがサポートされています。 詳細は、<a class="ulink" href="https://learn.hashicorp.com/vault/getting-started/install#command-completion" target="_top">https://learn.hashicorp.com/vault/getting-started/install#command-completion</a>を参照してください。 
            </p></li><li class="listitem"><p>
              HashiCorp Vault サーバー構成ファイルを作成します。
            </p><p>
              次の内容を含む <code class="filename">config.hcl</code> という名前の構成ファイルを準備します。 <code class="literal">tls_cert_file</code>、<code class="literal">tls_key_file</code> および <code class="literal">path</code> の値は、使用しているシステムに適したパス名に置き換えてください。 
            </p><pre class="programlisting">listener "tcp" {
  address="127.0.0.1:8200"
  tls_cert_file="/home/username/certificates/vault.crt"
  tls_key_file="/home/username/certificates/vault.key"
}

storage "file" {
  path = "/home/username/vaultstorage/storage"
}

ui = true
</pre></li><li class="listitem"><p>
              HashiCorp Vault サーバーを起動します。
            </p><p>
              Vault サーバーを起動するには、次のコマンドを使用します。ここで、<code class="option">-config</code> オプションは作成したばかりの構成ファイルへのパスを指定します:
            </p><pre class="programlisting">vault server -config=config.hcl
</pre><p>
              このステップでは、<code class="filename">vault.key</code> ファイルに格納されている Vault サーバーの秘密キーのパスワードの入力を求められる場合があります。
            </p><p>
              サーバーが起動し、コンソールにいくつかの情報 (IP、ポートなど) が表示されます。
            </p><p>
              残りのコマンドを入力できるように、<span class="command"><strong>vault server</strong></span> コマンドをバックグラウンドに置くか、続行する前に別の端末を開きます。
            </p></li><li class="listitem"><p>
              HashiCorp Vault サーバーを初期化します。
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                この手順で説明する操作は、開封キーとルートトークンを取得するために Vault を初めて起動する場合にのみ必要です。 その後の Vault インスタンスの再起動では、シール解除キーを使用したアンシールのみが必要です。 
              </p></div><p>
              次のコマンドを発行します (Bourne シェル構文を想定):
            </p><pre class="programlisting">export VAULT_SKIP_VERIFY=1
vault operator init -n 1 -t 1
</pre><p>
              最初のコマンドを使用すると、<span class="command"><strong>vault</strong></span> コマンドは、システムトラストストアに会社の証明書が追加されていないことを一時的に無視できます。 自己署名 CA がそのストアに追加されていないという事実を補う。 (本番で使用するには、このような証明書を追加する必要があります。) 
            </p><p>
              2 番目のコマンドは、シール解除のために 1 つのシール解除キーが存在する必要がある単一のシール解除キーを作成します。 (本番で使用する場合、インスタンスには複数のアンシールキーがあり、アンシールするために入力する必要があるキーはその数までです。 開封キーは、会社内の主要な顧客に配信する必要があります。 単一のキーを使用すると、ボールトを単一のキーカスタムによってシール解除できるため、セキュリティ上の問題とみなされる場合があります。) 
            </p><p>
              Vault は、シール解除キーとルートトークンに関する情報に加えて、追加のテキストを返信する必要があります (実際のシール解除キーとルートトークンの値はここに示す値とは異なります):
            </p><pre class="programlisting">...
Unseal Key 1: I2xwcFQc892O0Nt2pBiRNlnkHzTUrWS+JybL39BjcOE=
Initial Root Token: s.vTvXeo3tPEYehfcd9WH7oUKz
...
</pre><p>
              シール解除キーとルートトークンをセキュアな場所に格納します。
            </p></li><li class="listitem"><p>
              HashiCorp Vault サーバーをシール解除します。
            </p><p>
              Vault サーバをシール解除するには、次のコマンドを使用します:
            </p><pre class="programlisting">vault operator unseal
</pre><p>
              開封キーの入力を求めるプロンプトが表示されたら、Vault の初期化時に以前に取得したキーを使用します。
            </p><p>
              Vault は、セットアップが完了し、ボールトがシールなしであることを示す出力を生成します。
            </p></li><li class="listitem"><p>
              HashiCorp Vault サーバーにログインし、そのステータスを確認します。
            </p><p>
              root としてログインするために必要な環境変数を準備します:
            </p><pre class="programlisting">vault login s.vTvXeo3tPEYehfcd9WH7oUKz
</pre><p>
              このコマンドのトークン値は、Vault の初期化中に以前に取得した root トークンの内容に置き換えてください。
            </p><p>
              Vault サーバのステータスを確認します:
            </p><pre class="programlisting">vault status
</pre><p>
              出力には次の行が含まれる必要があります (特に):
            </p><pre class="programlisting">...
Initialized     true
Sealed          false
...
</pre></li><li class="listitem"><p>
              HashiCorp Vault の認証および記憶域を設定します。
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                この手順で説明する操作は、Vault インスタンスの初回実行時にのみ必要です。 後で繰り返す必要はありません。 
              </p></div><p>
              AppRole 認証方式を有効にして、認証方式リストに含まれていることを確認します:
            </p><pre class="programlisting">vault auth enable approle
vault auth list
</pre><p>
              Vault KeyValue ストレージエンジンを有効にします:
            </p><pre class="programlisting">vault secrets enable -version=1 kv
</pre><p>
              <code class="literal">keyring_hashicorp</code> プラグインで使用するロールを作成および設定します (コマンドを単一行で入力します):
            </p><pre class="programlisting">vault write auth/approle/role/mysql token_num_uses=0
  token_ttl=20m token_max_ttl=30m secret_id_num_uses=0
</pre></li><li class="listitem"><p>
              AppRole セキュリティポリシーを追加します。
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                この手順で説明する操作は、Vault インスタンスの初回実行時にのみ必要です。 後で繰り返す必要はありません。 
              </p></div><p>
              以前に作成したロールに適切なシークレットへのアクセスを許可するポリシーを準備します。 次の内容で <code class="filename">mysql.hcl</code> という名前の新しいファイルを作成します: 
            </p><pre class="programlisting">path "kv/mysql/*" {
  capabilities = ["create", "read", "update", "delete", "list"]
}
</pre><p>
              ポリシーファイルを Vault サーバーにインポートして <code class="literal">mysql-policy</code> という名前のポリシーを作成し、そのポリシーを新しいロールに割り当てます:
            </p><pre class="programlisting">vault policy write mysql-policy mysql.hcl
vault write auth/approle/role/mysql policies=mysql-policy
</pre><p>
              新しく作成したロールの ID を取得し、セキュアな場所に格納します:
            </p><pre class="programlisting">vault read auth/approle/role/mysql/role-id
</pre><p>
              ロールのシークレット ID を生成し、セキュアな場所に格納します:
            </p><pre class="programlisting">vault write -f auth/approle/role/mysql/secret-id
</pre><p>
              これらの AppRole ロール ID およびシークレット ID の資格証明が生成された後、それらは無期限に有効なままである必要があります。 これらを再度生成する必要はなく、継続的に使用するように <code class="literal">keyring_hashicorp</code> プラグインを構成できます。 AuthRole 認証の詳細は、<a class="ulink" href="https://www.vaultproject.io/docs/auth/approle.html" target="_top">https://www.vaultproject.io/docs/auth/approle.html</a> を参照してください。 
            </p></li></ol></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-hashicorp-plugin-configuration"></a>keyring_hashicorp 構成</h5></div></div></div><a class="indexterm" name="idm46723755228672"></a><p>
          プラグインライブラリファイルには、<code class="literal">keyring_hashicorp</code> プラグインとユーザー定義関数 (UDF)、<code class="literal">keyring_hashicorp_update_config()</code> が含まれています。 プラグインが初期化および終了すると、UDF が自動的にロードおよびアンロードされるため、UDF を手動でロードおよびアンロードする必要はありません。 
        </p><p>
          <code class="literal">keyring_hashicorp</code> プラグインは、次のテーブルに示す構成パラメータをサポートしています。 これらのパラメータを指定するには、対応するシステム変数に値を割り当てます。 
        </p><div class="informaltable"><table summary="keyring_hashicorp configuration parameters and corresponding system variables."><col style="width=35%"><col style="width=50%"><col style="width=15%"><thead><tr>
              <th scope="col">構成パラメータ</th>
              <th scope="col">システム変数</th>
              <th scope="col">必須</th>
            </tr></thead><tbody><tr>
              <th scope="row">HashiCorp サーバー URL</th>
              <td><code class="literal">keyring_hashicorp_server_url</code></td>
              <td>いいえ</td>
            </tr><tr>
              <th scope="row">AppRole ロール ID</th>
              <td><code class="literal">keyring_hashicorp_role_id</code></td>
              <td>はい</td>
            </tr><tr>
              <th scope="row">AppRole シークレット ID</th>
              <td><code class="literal">keyring_hashicorp_secret_id</code></td>
              <td>はい</td>
            </tr><tr>
              <th scope="row">ストアパス</th>
              <td><code class="literal">keyring_hashicorp_store_path</code></td>
              <td>はい</td>
            </tr><tr>
              <th scope="row">認可パス</th>
              <td><code class="literal">keyring_hashicorp_auth_path</code></td>
              <td>いいえ</td>
            </tr><tr>
              <th scope="row">CA 証明書ファイルのパス</th>
              <td><code class="literal">keyring_hashicorp_ca_path</code></td>
              <td>いいえ</td>
            </tr><tr>
              <th scope="row">キャッシュ制御</th>
              <td><code class="literal">keyring_hashicorp_caching</code></td>
              <td>いいえ</td>
            </tr></tbody></table></div><p>
          サーバーの起動プロセス中に使用できるようにするには、<code class="option">--early-plugin-load</code> オプションを使用して <code class="literal">keyring_hashicorp</code> をロードする必要があります。 前述のテーブルに示されているように、プラグイン関連のいくつかのシステム変数は必須であり、設定する必要もあります。 たとえば、サーバー <code class="filename">my.cnf</code> ファイルで次の行を使用して、プラットフォームの <code class="filename">.so</code> 接尾辞とファイルの場所を必要に応じて調整します: 
        </p><pre class="programlisting">[mysqld]
early-plugin-load=keyring_hashicorp.so
keyring_hashicorp_role_id='ee3b495c-d0c9-11e9-8881-8444c71c32aa'
keyring_hashicorp_secret_id='0512af29-d0ca-11e9-95ee-0010e00dd718'
keyring_hashicorp_store_path='/v1/kv/mysql'
</pre><p>
          MySQL Server は、AppRole 認証を使用して HashiCorp Vault に対して認証します。 認証に成功するには、Vault にロール ID とシークレット ID の 2 つのシークレットを提供する必要があります。これらは、ユーザー名とパスワードの概念に似ています。 使用するロール ID およびシークレット ID の値は、以前に実行した HashiCorp Vault の設定手順で取得した値です。 2 つの ID を指定するには、それぞれの値を <code class="literal">keyring_hashicorp_role_id</code> および <code class="literal">keyring_hashicorp_secret_id</code> システム変数に割り当てます。 設定手順では、<code class="literal">/v1/kv/mysql</code> のストアパスも生成されます。これは、<code class="literal">keyring_hashicorp_commit_store_path</code> に割り当てる値です。 
        </p><p>
          プラグインの初期化時に、<code class="literal">keyring_hashicorp</code> は構成値を使用して HashiCorp Vault サーバーへの接続を試みます。 接続が成功すると、プラグインは名前に<code class="literal">_commit_</code>が含まれる対応するシステム変数に値を格納します。 たとえば、接続が成功すると、プラグインは <code class="literal">keyring_hashicorp_role_id</code> および <code class="literal">keyring_hashicorp_store_path</code> の値を <code class="literal">keyring_hashicorp_commit_role_id</code> および <code class="literal">keyring_hashicorp_commit_store_path</code> に格納します。 
        </p><p>
          実行時の再構成は、<code class="literal">keyring_hashicorp_update_config()</code> UDF を使用して実行できます:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              <code class="literal">SET</code> ステートメントを使用して、前述のテーブルに示す構成システム変数に必要な新しい値を割り当てます。 これらの割り当て自体は、進行中のプラグイン操作には影響しません。 
            </p></li><li class="listitem"><p>
              <code class="literal">keyring_hashicorp_update_config()</code> を起動してプラグインを再構成し、新しい変数値を使用して HashiCorp Vault サーバーに再接続します。
            </p></li><li class="listitem"><p>
              接続が成功すると、プラグインは、名前に<code class="literal">_commit_</code>が含まれる対応するシステム変数に更新された構成値を格納します。
            </p></li></ol></div><p>
          たとえば、デフォルト 8200 ではなくポート 8201 でリスニングするように HashiCorp Vault を再構成した場合は、次のように <code class="literal">keyring_hashicorp</code> を再構成します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL keyring_hashicorp_server_url = 'https://127.0.0.1:8201';</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT keyring_hashicorp_update_config();</code></strong>
+--------------------------------------+
| keyring_hashicorp_update_config()    |
+--------------------------------------+
| Configuration update was successful. |
+--------------------------------------+
1 row in set (0.03 sec)
</pre><p>
          初期化または再構成中にプラグインが HashiCorp Vault に接続できず、既存の接続がなかった場合、<code class="literal">_commit_</code>システム変数は文字列値変数に対して<code class="literal">'Not committed'</code>に設定され、ブール値変数に対して <code class="literal">OFF</code> に設定されます。 プラグインが接続できないが、既存の接続があった場合、その接続はアクティブなままで、<code class="literal">_commit_</code>変数にはその接続に使用された値が反映されます。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            サーバーの起動時に必須のシステム変数を設定しない場合、または他のプラグイン初期化エラーが発生した場合、初期化は失敗します。 この場合、実行時再構成手順を使用すると、サーバーを再起動せずにプラグインを初期化できます。 
          </p></div><p>
          <code class="literal">keyring_hashicorp</code> プラグイン固有のシステム変数および UDF の詳細は、<a class="xref" href="security.html#keyring-system-variables" title="6.4.4.13 キーリングシステム変数">セクション6.4.4.13「キーリングシステム変数」</a> および <a class="xref" href="security.html#keyring-functions-plugin-specific" title="6.4.4.11 プラグイン固有のキーリングキー管理関数">セクション6.4.4.11「プラグイン固有のキーリングキー管理関数」</a> を参照してください。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-oci-plugin"></a>6.4.4.7 Oracle Cloud Infrastructure Vault キーリングプラグインの使用</h4></div></div></div><a class="indexterm" name="idm46723755147312"></a><a class="indexterm" name="idm46723755145792"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          <code class="literal">keyring_oci</code> プラグインは、商用製品である MySQL Enterprise Edition に含まれている拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
        </p></div><p>
        <code class="literal">keyring_oci</code> プラグインは、バックエンドストレージのために Oracle Cloud Infrastructure Vault と通信するキーリングプラグインです。 キー情報は、MySQL サーバーのローカル記憶域に永続的に格納されません。 すべてのキーは Oracle Cloud Infrastructure Vault に格納されるため、このプラグインは Oracle Cloud Infrastructure MySQL 顧客の MySQL Enterprise Edition キーの管理に適しています。 
      </p><p>
        <code class="literal">keyring_oci</code> プラグインは、標準の MySQL キーリングサービスインタフェースを構成する関数をサポートしています。 これらの関数によって実行されるキーリング操作には、次の 2 つのレベルでアクセスできます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL インタフェース: SQL ステートメントで、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> で説明されているユーザー定義関数 (UDF) をコールします。
          </p></li><li class="listitem"><p>
            C インタフェース: C 言語コードでは、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> で説明されているキーリングサービス関数をコールします。
          </p></li></ul></div><p>
        例 (UDF を使用):
      </p><pre class="programlisting">SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
        <code class="literal">keyring_oci</code> で許可されるキータイプの詳細は、<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> を参照してください。
      </p><p>
        <code class="literal">keyring_oci</code> プラグインをインストールするには、<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> にある一般的なキーリングのインストール手順と、ここにある <code class="literal">keyring_oci</code> に固有の構成情報を使用します。 プラグイン固有の構成には、Oracle Cloud Infrastructure リソースの名前または値を示す多数のシステム変数の設定が含まれます。 
      </p><a class="indexterm" name="idm46723755127648"></a><p>
        Oracle Cloud Infrastructure の概念に精通していることを前提としていますが、<code class="literal">keyring_oci</code> プラグインで使用するリソースを設定する際に次のドキュメントが役立つ場合があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="ulink" href="https://docs.cloud.oracle.com/iaas/Content/KeyManagement/Concepts/keyoverview.htm" target="_top">Vault の概要</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/General/Concepts/identifiers.htm" target="_top">リソース識別子</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm" target="_top">必要なキーおよび OCID</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingkeys.htm" target="_top">キーの管理</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/Identity/Tasks/managingcompartments.htm" target="_top">コンパートメントの管理</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingvaults.htm" target="_top">ボールトの管理</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingsecrets.htm" target="_top">シークレットの管理</a>
          </p></li></ul></div><p>
        <code class="literal">keyring_oci</code> プラグインは、次のテーブルに示す構成パラメータをサポートしています。 これらのパラメータを指定するには、対応するシステム変数に値を割り当てます。 
      </p><div class="informaltable"><table summary="keyring_oci configuration parameters and corresponding system variables."><col style="width=35%"><col style="width=50%"><col style="width=15%"><thead><tr>
            <th scope="col">構成パラメータ</th>
            <th scope="col">システム変数</th>
            <th scope="col">必須</th>
          </tr></thead><tbody><tr>
            <th scope="row">ユーザー OCID</th>
            <td><code class="literal">keyring_oci_user</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">テナンシ OCID</th>
            <td><code class="literal">keyring_oci_tenancy</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">コンパートメント OCID</th>
            <td><code class="literal">keyring_oci_compartment</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">ボールト OCID</th>
            <td><code class="literal">keyring_oci_virtual_vault</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">マスターキー OCID</th>
            <td><code class="literal">keyring_oci_master_key</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">暗号化サーバーエンドポイント</th>
            <td><code class="literal">keyring_oci_encryption_endpoint</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">キー管理サーバーエンドポイント</th>
            <td><code class="literal">keyring_oci_management_endpoint</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">ボールトサーバーエンドポイント</th>
            <td><code class="literal">keyring_oci_vaults_endpoint</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">シークレットサーバーエンドポイント</th>
            <td><code class="literal">keyring_oci_secrets_endpoint</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">RSA 秘密キーファイル</th>
            <td><code class="literal">keyring_oci_key_file</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">RSA 秘密キーのフィンガープリント</th>
            <td><code class="literal">keyring_oci_key_fingerprint</code></td>
            <td>はい</td>
          </tr><tr>
            <th scope="row">CA 証明書バンドルファイル</th>
            <td><code class="literal">keyring_oci_ca_certificate</code></td>
            <td>いいえ</td>
          </tr></tbody></table></div><p>
        サーバーの起動プロセス中に使用できるようにするには、<code class="option">--early-plugin-load</code> オプションを使用して <code class="literal">keyring_oci</code> をロードする必要があります。 前述のテーブルに示されているように、プラグイン関連のいくつかのシステム変数は必須であり、設定する必要もあります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Oracle Cloud Infrastructure では、Oracle Cloud ID (OCID) を広範囲に使用してリソースを指定し、いくつかの <code class="literal">keyring_oci</code> パラメータでは、使用するリソースの OCID 値を指定します。 したがって、<code class="literal">keyring_oci</code> プラグインを使用する前に、次の前提条件を満たす必要があります: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Oracle Cloud Infrastructure に接続するためのユーザーが存在する必要があります。 必要に応じてユーザーを作成し、ユーザー OCID を <code class="literal">keyring_oci_user</code> システム変数に割り当てます。 
              </p></li><li class="listitem"><p>
                使用する Oracle Cloud Infrastructure テナンシ、テナンシ内の MySQL コンパートメントおよびコンパートメント内のボールトが存在する必要があります。 必要に応じてこれらのリソースを作成し、ユーザーが使用できるようになっていることを確認します。 テナンシ、コンパートメントおよびボールトの OCID を <code class="literal">keyring_oci_tenancy</code>、<code class="literal">keyring_oci_compartment</code> および <code class="literal">keyring_oci_virtual_vault</code> システム変数に割り当てます。 
              </p></li><li class="listitem"><p>
                暗号化用のマスターキーが存在する必要があります。 必要に応じて OCID を作成し、<code class="literal">keyring_oci_master_key</code> システム変数に割り当てます。 
              </p></li></ul></div></li><li class="listitem"><p>
            複数のサーバーエンドポイントを指定する必要があります。 これらのエンドポイントはボールト固有であり、Oracle Cloud Infrastructure によってボールト作成時に割り当てられます。 ボールトの詳細ページから値を取得し、<code class="literal">keyring_oci_encryption_endpoint</code>, <code class="literal">keyring_oci_management_endpoint</code>, <code class="literal">keyring_oci_vaults_endpoint</code> および <code class="literal">keyring_oci_secrets_endpoint</code> システム変数に割り当てます。 
          </p></li><li class="listitem"><p>
            Oracle Cloud Infrastructure API では、RSA 秘密キーと公開キーのペアを認証に使用します。 このキーペアを作成してキーフィンガープリントを取得するには、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm" target="_top">「必要なキーおよび OCID」</a>の手順を使用します。 秘密キーファイル名とキーフィンガープリントを <code class="literal">keyring_oci_key_file</code> および <code class="literal">keyring_oci_key_fingerprint</code> システム変数に割り当てます。 
          </p></li></ul></div><p>
        必須のシステム変数に加えて、ピア認証用の認証局 (CA) 証明書バンドルファイルを指定するように <code class="literal">keyring_oci_ca_certificate</code> をオプションで設定できます。
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          Oracle Cloud Infrastructure コンソールからパラメータをコピーする場合、コピーされた値に初期 <code class="literal">https://</code>部分が含まれている可能性があります。 対応する <code class="literal">keyring_oci</code> システム変数を設定する場合は、その部分を省略します。 
        </p></div><p>
        たとえば、<code class="literal">keyring_oci8</code> をロードして構成するには、サーバーの <code class="filename">my.cnf</code> ファイルで次の行を使用します (必要に応じて、プラットフォームの <code class="filename">.so</code> 接尾辞とファイルの場所を調整します):
      </p><pre class="programlisting">[mysqld]
early-plugin-load=keyring_oci.so
keyring_oci_user=ocid1.user.oc1..<em class="replaceable"><code>longAlphaNumericString</code></em>
keyring_oci_tenancy=ocid1.tenancy.oc1..<em class="replaceable"><code>longAlphaNumericString</code></em>
keyring_oci_compartment=ocid1.compartment.oc1..<em class="replaceable"><code>longAlphaNumericString</code></em>
keyring_oci_virtual_vault=ocid1.vault.oc1.iad.<em class="replaceable"><code>shortAlphaNumericString</code></em>.<em class="replaceable"><code>longAlphaNumericString</code></em>
keyring_oci_master_key=ocid1.key.oc1.iad.<em class="replaceable"><code>shortAlphaNumericString</code></em>.<em class="replaceable"><code>longAlphaNumericString</code></em>
keyring_oci_encryption_endpoint=<em class="replaceable"><code>shortAlphaNumericString</code></em>-crypto.kms.us-ashburn-1.oraclecloud.com
keyring_oci_management_endpoint=<em class="replaceable"><code>shortAlphaNumericString</code></em>-management.kms.us-ashburn-1.oraclecloud.com
keyring_oci_vaults_endpoint=vaults.us-ashburn-1.oci.oraclecloud.com
keyring_oci_secrets_endpoint=secrets.vaults.us-ashburn-1.oci.oraclecloud.com
keyring_oci_key_file=<em class="replaceable"><code>file_name</code></em>
keyring_oci_key_fingerprint=12:34:56:78:90:ab:cd:ef:12:34:56:78:90:ab:cd:ef
</pre><p>
        <code class="literal">keyring_oci</code> プラグイン固有のシステム変数の詳細は、<a class="xref" href="security.html#keyring-system-variables" title="6.4.4.13 キーリングシステム変数">セクション6.4.4.13「キーリングシステム変数」</a> を参照してください。
      </p><p>
        <code class="literal">keyring_oci</code> プラグインは実行時再構成をサポートしておらず、そのシステム変数は実行時に変更できません。 構成パラメータを変更するには、次のようにします: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename">my.cnf</code> ファイルのパラメータ設定を変更するか、<code class="filename">mysqld-auto.conf</code> に永続化されるパラメータに <code class="literal">SET PERSIST_ONLY</code> を使用します。
          </p></li><li class="listitem"><p>
            サーバーを再起動します。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-key-types"></a>6.4.4.8 サポートされているキーリングキーのタイプと長さ</h4></div></div></div><p>
        MySQL キーリングでは、様々なタイプ (暗号化アルゴリズム) および長さのキーがサポートされます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            使用可能なキータイプは、インストールされているキープラグインによって異なります。
          </p></li><li class="listitem"><p>
            許可されるキーの長さには、複数の要因があります:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                一般的なキーリング UDF インタフェース制限 (<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> で説明されているいずれかのキーリング UDF を使用して管理されるキーの場合)、またはバックエンド実装からの制限。 これらの長さ制限は、キー操作タイプによって異なる場合があります。 
              </p></li><li class="listitem"><p>
                一般的な制限に加えて、個々のプラグインではキータイプごとにキーの長さに制限が課される場合があります。
              </p></li></ul></div></li></ul></div><p>
        <a class="xref" href="security.html#keyring-general-key-length-limits-table" title="表 6.26 一般的なキーリングキーの長さ制限">表6.26「一般的なキーリングキーの長さ制限」</a> には、一般的なキー長制限が表示されます。 (<code class="literal">keyring_aws</code> の下限は、キーリング UDF ではなく AWS KMS インタフェースによって課されます。) <a class="xref" href="security.html#keyring-key-types-table" title="表 6.27 プラグインのキータイプと長さのキー設定">表6.27「プラグインのキータイプと長さのキー設定」</a> は、キーリングプラグインごとに、許可されているキータイプおよびプラグイン固有のキー長制限を表示します。 
      </p><div class="table"><a name="keyring-general-key-length-limits-table"></a><p class="title"><b>表 6.26 一般的なキーリングキーの長さ制限</b></p><div class="table-contents"><table summary="General limits on keyring key lengths."><col style="width=20%"><col style="width=80%"><thead><tr>
            <th>キー操作</th>
            <th>最大キー長</th>
          </tr></thead><tbody><tr>
            <td>キーの生成</td>
            <td><p class="valid-value">
                16,384 バイト (MySQL 8.0.18 より前の 2,048)、<code class="literal">keyring_aws</code> の場合 1,024
              </p></td>
          </tr><tr>
            <td>ストアキー</td>
            <td><p class="valid-value">
                16,384 バイト (MySQL 8.0.18 より前の 2,048)、<code class="literal">keyring_aws</code> の場合 4,096
              </p></td>
          </tr><tr>
            <td>Fetch key</td>
            <td><p class="valid-value">
                16,384 バイト (MySQL 8.0.18 より前の 2,048)、<code class="literal">keyring_aws</code> の場合 4,096
              </p></td>
          </tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="keyring-key-types-table"></a><p class="title"><b>表 6.27 プラグインのキータイプと長さのキー設定</b></p><div class="table-contents"><table summary="Key types and lengths supported by keyring plugins."><col style="width=30%"><col style="width=25%"><col style="width=45%"><thead><tr>
            <th scope="col">プラグイン名</th>
            <th scope="col">許可されたキータイプ</th>
            <th scope="col">プラグイン固有の長さの制限</th>
          </tr></thead><tbody><tr>
            <th scope="row" valign="top"><code class="literal">keyring_aws</code></th>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">SECRET</code>
              </p></td>
            <td><p class="valid-value">
                16 バイト、24 バイトまたは 32 バイト
              </p><p class="valid-value">
                なし
              </p></td>
          </tr><tr>
            <th scope="row" valign="top"><code class="literal">keyring_encrypted_file</code></th>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">DSA</code>
              </p><p class="valid-value">
                <code class="literal">RSA</code>
              </p><p class="valid-value">
                <code class="literal">SECRET</code>
              </p></td>
            <td><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p></td>
          </tr><tr>
            <th scope="row" valign="top"><code class="literal">keyring_file</code></th>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">DSA</code>
              </p><p class="valid-value">
                <code class="literal">RSA</code>
              </p><p class="valid-value">
                <code class="literal">SECRET</code>
              </p></td>
            <td><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p></td>
          </tr><tr>
            <th scope="row" valign="top"><code class="literal">keyring_hashicorp</code></th>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">DSA</code>
              </p><p class="valid-value">
                <code class="literal">RSA</code>
              </p><p class="valid-value">
                <code class="literal">SECRET</code>
              </p></td>
            <td><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p><p class="valid-value">
                なし
              </p></td>
          </tr><tr>
            <th scope="row" valign="top"><code class="literal">keyring_oci</code></th>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p></td>
            <td><p class="valid-value">
                16 バイト、24 バイトまたは 32 バイト
              </p></td>
          </tr><tr>
            <th scope="row" valign="top"><code class="literal">keyring_okv</code></th>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">SECRET</code>
              </p></td>
            <td><p class="valid-value">
                16 バイト、24 バイトまたは 32 バイト
              </p><p class="valid-value">
                なし
              </p></td>
          </tr></tbody></table></div></div><br class="table-break"><p>
        MySQL 8.0.19 で使用可能な <code class="literal">SECRET</code> キータイプは、MySQL キーリングを使用した機密データの汎用的な格納を目的としており、ほとんどのキーリングプラグインでサポートされています。 キーリングは、格納および取得時に <code class="literal">SECRET</code> データをバイトストリームとして暗号化および復号化します。 
      </p><p>
        <code class="literal">SECRET</code> キータイプを含むキーリング操作の例:
      </p><pre class="programlisting">SELECT keyring_key_generate('MySecret1', 'SECRET', 20);
SELECT keyring_key_remove('MySecret1');

SELECT keyring_key_store('MySecret2', 'SECRET', 'MySecretData');
SELECT keyring_key_fetch('MySecret2');
SELECT keyring_key_length_fetch('MySecret2');
SELECT keyring_key_type_fetch('MySecret2');
SELECT keyring_key_remove('MySecret2');
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-key-migration"></a>6.4.4.9 キーリングキーストア間のキーの移行</h4></div></div></div><p>
        MySQL サーバーは、基礎となるキーリングキーストア間での鍵の移行を可能にする操作モードをサポートしているため、DBA は MySQL インストールをあるキーリングプラグインから別のキーリングプラグインに切り替えることができます。 移行サーバー (キー移行モードで起動されたサーバー) は、クライアント接続を受け入れません。 かわりに、キーの移行に十分な時間だけ実行され、終了します。 移行サーバーは、コンソールにエラーを報告します (標準エラー出力)。 
      </p><p>
        オフラインまたはオンラインのキー移行を実行できます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            ローカルホストで実行中のサーバーがソースキーストアまたは宛先キーストアを使用していないことが確実な場合は、オフライン移行が可能です。 この場合、移行中にサーバーを実行してキーストアコンテンツを変更することなく、移行サーバーはキーストアを変更できます。 
          </p></li><li class="listitem"><p>
            ローカルホストで実行中のサーバーがソースキーストアまたは宛先キーストアを使用している場合は、オンライン移行を実行する必要があります。 この場合、移行サーバーは実行中のサーバーに接続し、キー移行の進行中にキーリング操作を一時停止するように指示します。 
          </p></li></ul></div><p>
        キーの移行操作の結果、移行前のキーとソースキーストアのキーが宛先キーストアに含まれます。 キーは移動されずにコピーされるため、ソースキーストアは移行の前後と同じです。 コピーするキーが宛先キーストアにすでに存在する場合は、エラーが発生し、宛先キーストアは事前統合状態にリストアされます。 
      </p><p>
        キー移行モードでサーバーを起動するユーザーは、<code class="literal">root</code> オペレーティングシステムユーザーではなく、キーリングファイルの読取りおよび書込み権限を持っている必要があります。
      </p><p>
        鍵の移行操作を実行するには、必要な鍵の移行オプションを決定します。 移行オプションは、関係するキーリングプラグインと、オフライン移行とオンライン移行のどちらを実行するかを示します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            ソースおよび宛先のキーリングプラグインを指定するには、次のオプションを指定します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="option">--keyring-migration-source</code>: 移行するキーを管理するソースキープラグイン。
              </p></li><li class="listitem"><p>
                <code class="option">--keyring-migration-destination</code>: 移行された鍵のコピー先の宛先キーリングプラグイン。
              </p></li></ul></div><p>
            これらのオプションは、キー移行モードで実行するようにサーバーに指示します。 両方のオプションは、すべてのキー移行操作に必須です。 ソースプラグインと移行先プラグインは異なる必要があり、移行サーバーは両方のプラグインをサポートする必要があります。 
          </p></li><li class="listitem"><p>
            オフライン移行の場合、追加のキー移行オプションは必要ありません。
          </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
              実行中のサーバーで使用されているキーストアを含むオフライン移行を実行しないでください。
            </p></div></li><li class="listitem"><p>
            オンライン移行の場合、現在実行中の一部のサーバーがソースキーストアまたは宛先キーストアを使用しています。 実行中のサーバーへの接続方法を示す主要な移行オプションを指定します。 これは、移行サーバーが実行中のサーバーに接続し、移行操作中にキーリングの使用を一時停止するように指示するために必要です。 
          </p><p>
            次のいずれかのオプションを使用することは、オンライン移行を意味します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="option">--keyring-migration-host</code>: 実行中のサーバーがあるホスト。 これは常にローカルホストです。 
              </p></li><li class="listitem"><p>
                <code class="option">--keyring-migration-user</code>, <code class="option">--keyring-migration-password</code>: 実行中のサーバーへの接続に使用するアカウントのユーザー名とパスワード。
              </p></li><li class="listitem"><p>
                <code class="option">--keyring-migration-port</code>: TCP/IP 接続の場合、実行中のサーバー上の接続先のポート番号。
              </p></li><li class="listitem"><p>
                <code class="option">--keyring-migration-socket</code>: Unix ソケットファイルまたは Windows 名前付きパイプ接続の場合、実行中のサーバーで接続するソケットファイルまたは名前付きパイプ。
              </p></li></ul></div></li></ul></div><p>
        キー移行オプションの詳細は、<a class="xref" href="security.html#keyring-options" title="6.4.4.12 キーリングコマンドのオプション">セクション6.4.4.12「キーリングコマンドのオプション」</a> を参照してください。
      </p><p>
        前述のとおりに決定されたキー移行オプションを使用して (場合によっては他のオプションを使用して)、移行サーバーを起動します。 次の考慮事項に注意してください: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            2 つのキーリングプラグインのほかの構成パラメータなど、ほかのサーバーオプションが必要になることがあります。 たとえば、<code class="literal">keyring_file</code> がプラグインのいずれかである場合、キーリングデータファイルの場所がデフォルトの場所でないときは、<code class="literal">keyring_file_data</code> システム変数を設定する必要があります。 その他の非キーリングオプションも必要な場合があります。 これらのオプションを指定する方法の 1 つは、<code class="option">--defaults-file</code> を使用して、必要なオプションを含むオプションファイルに名前を付けることです。 
          </p></li><li class="listitem"><p>
            MySQL の実行に通常使用されるシステムアカウントとは異なるシステムアカウントから移行サーバーを起動すると、通常の操作中にサーバーからアクセスできないキーリングディレクトリまたはファイルが作成される場合があります。 通常、<span class="command"><strong>mysqld</strong></span> は <code class="literal">mysql</code> オペレーティングシステムユーザーとして実行されますが、<code class="literal">isabel</code> としてログインしている間に移行サーバーを起動するとします。 移行サーバーによって作成された新しいディレクトリまたはファイルは、<code class="literal">isabel</code> によって所有されます。 <code class="literal">mysql</code> オペレーティングシステムユーザーとして実行されているサーバーが、<code class="literal">isabel</code> が所有するファイルシステムオブジェクトにアクセスしようとすると、後続の起動が失敗します。 
          </p><p>
            この問題を回避するには、<code class="literal">root</code> オペレーティングシステムユーザーとして移行サーバーを起動し、<code class="option">--user=<em class="replaceable"><code>user_name</code></em></code> オプションを指定します。<em class="replaceable"><code>user_name</code></em> は、MySQL の実行に通常使用されるシステムアカウントです。
          </p></li><li class="listitem"><p>
            移行サーバーでは、パス名オプションの値はフルパスである必要があります。 相対パス名が予期したとおりに解決されない場合があります。 
          </p></li></ul></div><p>
        オフラインキー移行のコマンドラインの例:
      </p><pre class="programlisting">mysqld --defaults-file=/usr/local/mysql/etc/my.cnf
  --keyring-migration-source=keyring_file.so
  --keyring-migration-destination=keyring_encrypted_file.so
  --keyring_encrypted_file_password=<em class="replaceable"><code>password</code></em>
</pre><p>
        オンラインキー移行のコマンドラインの例:
      </p><pre class="programlisting">mysqld --defaults-file=/usr/local/mysql/etc/my.cnf
  --keyring-migration-source=keyring_file.so
  --keyring-migration-destination=keyring_encrypted_file.so
  --keyring_encrypted_file_password=<em class="replaceable"><code>password</code></em>
  --keyring-migration-host=localhost
  --keyring-migration-user=root
  --keyring-migration-password=<em class="replaceable"><code>root_password</code></em>
</pre><p>
        キー移行サーバーは、次のように移行操作を実行します:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
            (オンライン移行のみ) 接続オプションを使用して、実行中のサーバーに接続します。 接続に使用するアカウントには、グローバル <code class="literal">keyring_operations</code> システム変数 (<code class="literal">SYSTEM_VARIABLES_ADMIN</code> または非推奨の <code class="literal">SUPER</code> 権限に加えて <code class="literal">ENCRYPTION_KEY_ADMIN</code>) を変更するために必要な権限が必要です。 
          </p></li><li class="listitem"><p>
            (オンライン移行のみ) 実行中のサーバーで <code class="literal">keyring_operations</code> を無効にします。 (実行中のサーバーが <code class="literal">keyring_operations</code> をサポートしている必要があります。) 
          </p></li><li class="listitem"><p>
            ソースおよび宛先のキーリングプラグインをロードします。
          </p></li><li class="listitem"><p>
            ソースキーリングから宛先キーリングにキーをコピーします。
          </p></li><li class="listitem"><p>
            キーリングプラグインをアンロードします。
          </p></li><li class="listitem"><p>
            (オンライン移行のみ) 実行中のサーバーで <code class="literal">keyring_operations</code> を有効にします。
          </p></li><li class="listitem"><p>
            (オンライン移行のみ) 実行中のサーバーから切断します。
          </p></li><li class="listitem"><p>
            Exit.
          </p></li></ol></div><p>
        キーの移行中にエラーが発生した場合、宛先プラグインにコピーされたキーは削除され、宛先キーストアは変更されません。
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          オンライン移行操作の場合、移行サーバーは、実行中のサーバーで <code class="literal">keyring_operations</code> を有効または無効にします。 移行サーバーが異常終了した場合 (強制終了された場合など)、実行中のサーバーで <code class="literal">keyring_operations</code> が再度有効化されず、キーリング操作を実行できない可能性があります。 この場合、実行中のサーバーに接続し、<code class="literal">keyring_operations</code> を手動で有効にする必要がある場合があります。 
        </p></div><p>
        オンラインキー移行操作が成功した後、実行中のサーバーの再起動が必要になる場合があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            実行中のサーバーがソースキーストアを使用していた場合は、移行後に再起動する必要はありません。
          </p></li><li class="listitem"><p>
            移行前に実行中のサーバーがソースキーストアを使用していたが、移行後に宛先キーストアを使用する必要がある場合は、宛先キープラグインを使用するように再構成して再起動する必要があります。
          </p></li><li class="listitem"><p>
            実行中のサーバーが宛先キーストアを使用していて、それを引き続き使用している場合は、移行後に再起動して、移行先キーストアに移行されたすべてのキーをロードする必要があります。
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          MySQL サーバーのキー移行モードでは、単一の実行中のサーバーの一時停止がサポートされます。 関連するキーストアが複数のキーサーバーで使用されている場合にキーの移行を実行するには、次の手順を使用します: 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              実行中の各サーバーに手動で接続し、<code class="literal">keyring_operations=OFF</code> を設定します。
            </p></li><li class="listitem"><p>
              移行サーバーを使用して、オフラインキー移行を実行します。
            </p></li><li class="listitem"><p>
              実行中の各サーバーに手動で接続し、<code class="literal">keyring_operations=ON</code> を設定します。
            </p></li></ol></div><p>
          実行中のすべてのサーバーは、<code class="literal">keyring_operations=ON</code> システム変数をサポートする必要があります。
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-functions-general-purpose"></a>6.4.4.10 汎用キーリングキー管理関数</h4></div></div></div><a class="indexterm" name="idm46723754824400"></a><a class="indexterm" name="idm46723754822224"></a><a class="indexterm" name="idm46723754820304"></a><p>
        MySQL Server は、内部コンポーネントおよびプラグインが機密情報を安全に格納して後で取得できるようにするキーリングサービスをサポートしています。
      </p><p>
        MySQL Server には、キーリングキー管理用の SQL インタフェースも含まれており、内部キーリングサービスによって提供される関数にアクセスする一連の汎用ユーザー定義関数 (UDF) として実装されています。 キーリング UDF はプラグインライブラリファイルに含まれており、UDF を起動する前に有効にする必要がある <code class="literal">keyring_udf</code> プラグインも含まれています。 これらの UDF を使用するには、<code class="literal">keyring_file</code> や <code class="literal">keyring_okv</code> などのキーリングプラグインを有効にする必要があります。 
      </p><p>
        ここで説明する UDF は一般的な目的であり、任意のキーリングプラグインでの使用を目的としています。 特定のキーリングプラグインには、そのプラグインでのみ使用することを目的とした独自の UDF がある場合があります。<a class="xref" href="security.html#keyring-functions-plugin-specific" title="6.4.4.11 プラグイン固有のキーリングキー管理関数">セクション6.4.4.11「プラグイン固有のキーリングキー管理関数」</a> を参照してください。 
      </p><p>
        次の各セクションでは、UDF のキー設定のインストール手順を示し、それらの使用方法を示します。 UDF によって呼び出されるキーリングサービス関数の詳細は、<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> を参照してください。 一般的な鍵リング情報については、<a class="xref" href="security.html#keyring" title="6.4.4 MySQL キーリング">セクション6.4.4「MySQL キーリング」</a> を参照してください。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#keyring-function-installation" title="汎用キーリング関数のインストールまたはアンインストール">汎用キーリング関数のインストールまたはアンインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-function-usage" title="汎用キーリング関数の使用">汎用キーリング関数の使用</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-function-reference" title="汎用キーリング関数リファレンス">汎用キーリング関数リファレンス</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-function-installation"></a>汎用キーリング関数のインストールまたはアンインストール</h5></div></div></div><a class="indexterm" name="idm46723754804976"></a><a class="indexterm" name="idm46723754802832"></a><a class="indexterm" name="idm46723754800720"></a><a class="indexterm" name="idm46723754798768"></a><a class="indexterm" name="idm46723754796592"></a><a class="indexterm" name="idm46723754794496"></a><p>
          このセクションでは、<code class="literal">keyring_udf</code> プラグインも含むプラグインライブラリファイルに実装されているキーリングユーザー定義関数 (UDF) をインストールまたはアンインストールする方法について説明します。 プラグインおよび UDF のインストールまたはアンインストールの一般情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a> および <a class="xref" href="server-administration.html#function-loading" title="5.7.1 ユーザー定義関数のインストールおよびアンインストール">セクション5.7.1「ユーザー定義関数のインストールおよびアンインストール」</a> を参照してください。 
        </p><p>
          キーリング UDF を使用すると、キーリングキー管理操作が可能になりますが、UDF が正しく機能しないため、<code class="literal">keyring_udf</code> プラグインもインストールする必要があります。 <code class="literal">keyring_udf</code> プラグインなしで UDF を使用しようとすると、エラーが発生します。 
        </p><p>
          サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
        </p><p>
          プラグインライブラリファイルのベース名は <code class="literal">keyring_udf</code> です。 ファイル名の接尾辞は、プラットフォームごとに異なります (たとえば、<code class="filename">.so</code> for Unix and Unix-like systems, <code class="filename">.dll</code> for Windows)。 
        </p><p>
          <code class="literal">keyring_udf</code> プラグインおよび UDF をインストールするには、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整して、<code class="literal">INSTALL PLUGIN</code> および <code class="literal">CREATE FUNCTION</code> ステートメントを使用します:
        </p><pre class="programlisting">INSTALL PLUGIN keyring_udf SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_generate RETURNS INTEGER
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_fetch RETURNS STRING
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_length_fetch RETURNS INTEGER
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_type_fetch RETURNS STRING
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_store RETURNS INTEGER
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_remove RETURNS INTEGER
  SONAME 'keyring_udf.so';
</pre><p>
          プラグインと UDF がソースレプリケーションサーバーで使用されている場合は、レプリケーションの問題を回避するために、それらをすべてのレプリカにインストールします。
        </p><p>
          前述のようにインストールすると、プラグインと UDF はアンインストールされるまでインストールされたままになります。 これらを削除するには、<code class="literal">UNINSTALL PLUGIN</code> および <code class="literal">DROP FUNCTION</code> ステートメントを使用します: 
        </p><pre class="programlisting">UNINSTALL PLUGIN keyring_udf;
DROP FUNCTION keyring_key_generate;
DROP FUNCTION keyring_key_fetch;
DROP FUNCTION keyring_key_length_fetch;
DROP FUNCTION keyring_key_type_fetch;
DROP FUNCTION keyring_key_store;
DROP FUNCTION keyring_key_remove;
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-function-usage"></a>汎用キーリング関数の使用</h5></div></div></div><a class="indexterm" name="idm46723754769040"></a><p>
          キーリングユーザー定義関数 (UDF) を使用する前に、<a class="xref" href="security.html#keyring-function-installation" title="汎用キーリング関数のインストールまたはアンインストール">汎用キーリング関数のインストールまたはアンインストール</a> の指示に従ってインストールします。
        </p><p>
          キーリング UDF には、次の制約があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              任意のキーリング UDF を使用するには、<code class="literal">keyring_udf</code> プラグインを有効にする必要があります。 それ以外の場合は、次のエラーが発生します: 
            </p><pre class="programlisting">ERROR 1123 (HY000): Can't initialize function 'keyring_key_generate';
This function requires keyring_udf plugin which is not installed.
Please install
</pre><p>
              <code class="literal">keyring_udf</code> プラグインをインストールするには、<a class="xref" href="security.html#keyring-function-installation" title="汎用キーリング関数のインストールまたはアンインストール">汎用キーリング関数のインストールまたはアンインストール</a> を参照してください。
            </p></li><li class="listitem"><p>
              キーリング UDF は、キーリングサービス関数を呼び出します (<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> を参照)。 次に、サービス関数はインストールされているキーリングプラグイン (<code class="literal">keyring_file</code> や <code class="literal">keyring_okv</code> など) を使用します。 したがって、任意のキーリング UDF を使用するには、基礎となるキーリングプラグインの一部を有効にする必要があります。 それ以外の場合は、次のエラーが発生します: 
            </p><pre class="programlisting">ERROR 3188 (HY000): Function 'keyring_key_generate' failed because
underlying keyring service returned an error. Please check if a
keyring plugin is installed and that provided arguments are valid
for the keyring you are using.
</pre><p>
              キーリングプラグインをインストールするには、<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> を参照してください。
            </p></li><li class="listitem"><p>
              任意のキーリング UDF を使用するには、ユーザーはグローバル <code class="literal">EXECUTE</code> 権限を持っている必要があります。 それ以外の場合は、次のエラーが発生します: 
            </p><pre class="programlisting">ERROR 1123 (HY000): Can't initialize function 'keyring_key_generate';
The user is not privileged to execute this function. User needs to
have EXECUTE
</pre><p>
              グローバル <code class="literal">EXECUTE</code> 権限をユーザーに付与するには、次のステートメントを使用します:
            </p><pre class="programlisting">GRANT EXECUTE ON *.* TO <em class="replaceable"><code>user</code></em>;
</pre><p>
              または、ユーザーに特定のキー管理操作へのアクセスを許可しながらグローバル <code class="literal">EXECUTE</code> 権限を付与しないようにする場合は、<span class="quote">「<span class="quote">「ラッパー」</span>」</span>ストアドプログラムを定義できます (このセクションの後半で説明します)。
            </p></li><li class="listitem"><p>
              特定のユーザーがキーリングに格納したキーは、後で同じユーザーのみが操作できます。 つまり、キー操作時の <code class="literal">CURRENT_USER()</code> 関数の値は、キーリングにキーが格納されたときと同じ値である必要があります。 (この制約は、テーブルスペースの暗号化をサポートするために <code class="literal">InnoDB</code> によって作成されたキーなど、インスタンス全体のキーを操作するためのキーリング UDF の使用を除外します。) 
            </p><p>
              複数のユーザーが同じキーに対して操作を実行できるようにするには、<span class="quote">「<span class="quote">「ラッパー」</span>」</span>ストアドプログラムを定義します (このセクションの後半で説明します)。
            </p></li><li class="listitem"><p>
              キーリング UDF では、基礎となるキーリングプラグインでサポートされるキーのタイプと長さがサポートされます。 特定のキーリングプラグインに固有の鍵については、<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> を参照してください。 
            </p></li></ul></div><p>
          新しいランダムキーを作成してキーリングに格納するには、キータイプ (暗号化メソッド) およびその長さ (バイト単位) とともに、<code class="literal">keyring_key_generate()</code> をコールしてキーの ID を渡します。 次のコールは、<code class="literal">MyKey</code> という名前の 2,048-bit DSA 暗号化キーを作成します: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('MyKey', 'DSA', 256);</code></strong>
+-------------------------------------------+
| keyring_key_generate('MyKey', 'DSA', 256) |
+-------------------------------------------+
|                                         1 |
+-------------------------------------------+
</pre><p>
          戻り値 1 は成功を示します。 キーを作成できない場合、戻り値は <code class="literal">NULL</code> であり、エラーが発生します。 これは、基礎となるキーリングプラグインが、指定された鍵タイプと鍵長の組み合わせをサポートしていないことが原因である可能性があります。<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> を参照してください。 
        </p><p>
          エラーが発生したかどうかに関係なく戻り型をチェックできるようにするには、<code class="literal">SELECT ... INTO @<em class="replaceable"><code>var_name</code></em></code> を使用して変数値をテストします:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('', '', -1) INTO @x;</code></strong>
ERROR 3188 (HY000): Function 'keyring_key_generate' failed because
underlying keyring service returned an error. Please check if a
keyring plugin is installed and that provided arguments are valid
for the keyring you are using.
mysql&gt; <strong class="userinput"><code>SELECT @x;</code></strong>
+------+
| @x   |
+------+
| NULL |
+------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('x', 'AES', 16) INTO @x;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT @x;</code></strong>
+------+
| @x   |
+------+
|    1 |
+------+
</pre><p>
          この手法は、失敗した場合に値とエラーを返す他のキーリング UDF にも適用されます。
        </p><p>
          <code class="literal">keyring_key_generate()</code> に渡される ID は、後続の UDF コールでキーを参照する手段を提供します。 たとえば、キー ID を使用して、そのタイプを文字列またはバイト単位の長さとして整数として取得します: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_type_fetch('MyKey');</code></strong>
+---------------------------------+
| keyring_key_type_fetch('MyKey') |
+---------------------------------+
| DSA                             |
+---------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_length_fetch('MyKey');</code></strong>
+-----------------------------------+
| keyring_key_length_fetch('MyKey') |
+-----------------------------------+
|                               256 |
+-----------------------------------+
</pre><p>
          キー値を取得するには、キー ID を <code class="literal">keyring_key_fetch()</code> に渡します。 次の例では、印刷できない文字が含まれている可能性があるため、<code class="literal">HEX()</code> を使用してキー値を表示します。 この例では、簡潔にするために短いキーも使用していますが、長いキーを使用するとセキュリティが向上することに注意してください: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('MyShortKey', 'DSA', 8);</code></strong>
+----------------------------------------------+
| keyring_key_generate('MyShortKey', 'DSA', 8) |
+----------------------------------------------+
|                                            1 |
+----------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT HEX(keyring_key_fetch('MyShortKey'));</code></strong>
+--------------------------------------+
| HEX(keyring_key_fetch('MyShortKey')) |
+--------------------------------------+
| 1DB3B0FC3328A24C                     |
+--------------------------------------+
</pre><p>
          キーリング UDF では、キー ID、タイプおよび値がバイナリ文字列として扱われるため、比較では大/小文字が区別されます。 たとえば、<code class="literal">MyKey</code> と <code class="literal">mykey</code> の ID は異なるキーを参照します。 
        </p><p>
          キーを削除するには、キー ID を <code class="literal">keyring_key_remove()</code> に渡します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_remove('MyKey');</code></strong>
+-----------------------------+
| keyring_key_remove('MyKey') |
+-----------------------------+
|                           1 |
+-----------------------------+
</pre><p>
          指定したキーを不明瞭化して格納するには、キー ID、タイプおよび値を <code class="literal">keyring_key_store()</code> に渡します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_store('AES_key', 'AES', 'Secret string');</code></strong>
+------------------------------------------------------+
| keyring_key_store('AES_key', 'AES', 'Secret string') |
+------------------------------------------------------+
|                                                    1 |
+------------------------------------------------------+
</pre><p>
          前述のように、ユーザーはキーリング UDF をコールするためのグローバル <code class="literal">EXECUTE</code> 権限を持っている必要があり、キーリングにキーを最初に格納するユーザーは、UDF コールごとに有効な <code class="literal">CURRENT_USER()</code> 値から決定される、後でキーに対して後続の操作を実行するユーザーと同じである必要があります。 グローバル <code class="literal">EXECUTE</code> 権限を持たないユーザー、またはキー <span class="quote">「<span class="quote">owner,</span>」</span>ではないユーザーにキー操作を許可するには、次の方法を使用します: 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              必要なキー操作をカプセル化し、<code class="literal">DEFINER</code> 値がキー所有者と等しい<span class="quote">「<span class="quote">「ラッパー」</span>」</span>ストアドプログラムを定義します。
            </p></li><li class="listitem"><p>
              特定のストアドプログラムを起動できるようにする個々のユーザーに、それらのストアドプログラムに対する <code class="literal">EXECUTE</code> 権限を付与します。
            </p></li><li class="listitem"><p>
              ラッパーストアドプログラムによって実装される操作にキー作成が含まれていない場合は、ストアドプログラム定義で <code class="literal">DEFINER</code> として指定されたアカウントを使用して、必要なキーを事前に作成します。
            </p></li></ol></div><p>
          この手法を使用すると、キーをユーザー間で共有でき、グローバル権限を付与せずに、誰がキーを使用して何を実行できるかを DBA がよりきめ細かく制御できます。
        </p><p>
          次の例は、DBA が所有する <code class="literal">SharedKey</code> という名前の共有キーと、現在のキー値へのアクセスを提供する <code class="literal">get_shared_key()</code> ストアドファンクションの設定方法を示しています。 この値は、<code class="literal">key_schema</code> スキーマに作成された、その関数に対する <code class="literal">EXECUTE</code> 権限を持つすべてのユーザーが取得できます。 
        </p><p>
          MySQL 管理アカウント (この例では<code class="literal">'root'@'localhost'</code>) から、キーにアクセスするための管理スキーマおよびストアドファンクションを作成します:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE SCHEMA key_schema;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE DEFINER = 'root'@'localhost'</code></strong>
       <strong class="userinput"><code>FUNCTION key_schema.get_shared_key()</code></strong>
       <strong class="userinput"><code>RETURNS BLOB READS SQL DATA</code></strong>
       <strong class="userinput"><code>RETURN keyring_key_fetch('SharedKey');</code></strong>
</pre><p>
          管理アカウントから、共有キーが存在することを確認します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('SharedKey', 'DSA', 8);</code></strong>
+---------------------------------------------+
| keyring_key_generate('SharedKey', 'DSA', 8) |
+---------------------------------------------+
|                                           1 |
+---------------------------------------------+
</pre><p>
          管理アカウントから、キーアクセス権を付与する通常のユーザーアカウントを作成します:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'key_user'@'localhost'</code></strong>
       <strong class="userinput"><code>IDENTIFIED BY 'key_user_pwd';</code></strong>
</pre><p>
          <code class="literal">key_user</code> アカウントから、適切な <code class="literal">EXECUTE</code> 権限がない場合、新しいアカウントが共有キーにアクセスできないことを確認します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT HEX(key_schema.get_shared_key());</code></strong>
ERROR 1370 (42000): execute command denied to user 'key_user'@'localhost'
for routine 'key_schema.get_shared_key'
</pre><p>
          管理アカウントから、ストアドファンクションの <code class="literal">EXECUTE</code> を <code class="literal">key_user</code> に付与します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>GRANT EXECUTE ON FUNCTION key_schema.get_shared_key</code></strong>
       <strong class="userinput"><code>TO 'key_user'@'localhost';</code></strong>
</pre><p>
          <code class="literal">key_user</code> アカウントから、キーにアクセスできるようになったことを確認します:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT HEX(key_schema.get_shared_key());</code></strong>
+----------------------------------+
| HEX(key_schema.get_shared_key()) |
+----------------------------------+
| 9BAFB9E75CEEB013                 |
+----------------------------------+
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="keyring-function-reference"></a>汎用キーリング関数リファレンス</h5></div></div></div><p>
          このセクションでは、汎用キーリングユーザー定義関数 (UDF) ごとに、その目的、コール順序および戻り値について説明します。 これらの UDF を起動できる条件の詳細は、<a class="xref" href="security.html#keyring-function-usage" title="汎用キーリング関数の使用">汎用キーリング関数の使用</a> を参照してください。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_keyring-key-fetch"></a>
              <code class="literal">keyring_key_fetch(<em class="replaceable"><code>key_id</code></em>)</code>
            </p><a class="indexterm" name="idm46723754657552"></a><a class="indexterm" name="idm46723754656064"></a><p>
              キー ID を指定すると、キー値を不明瞭化して戻します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: キー ID を指定する文字列。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              成功した場合は文字列、キーが存在しない場合は <code class="literal">NULL</code>、失敗した場合は <code class="literal">NULL</code> およびエラーとしてキー値を返します。
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                <code class="literal">keyring_key_fetch()</code> を使用して取得されたキー値は、<a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a> で説明されている一般的なキーリング UDF 制限の対象となります。 その長さより長いキー値は、キーリングサービス関数 (<a class="xref" href="server-administration.html#keyring-service" title="5.6.8.2 キーリングサービス">セクション5.6.8.2「キーリングサービス」</a> を参照) を使用して格納できますが、<code class="literal">keyring_key_fetch()</code> を使用して取得されたキー値は、一般的なキーリング UDF 制限に切り捨てられます。 
              </p></div><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('RSA_key', 'RSA', 16);</code></strong>
+--------------------------------------------+
| keyring_key_generate('RSA_key', 'RSA', 16) |
+--------------------------------------------+
|                                          1 |
+--------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT HEX(keyring_key_fetch('RSA_key'));</code></strong>
+-----------------------------------+
| HEX(keyring_key_fetch('RSA_key')) |
+-----------------------------------+
| 91C2253B696064D3556984B6630F891A  |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_type_fetch('RSA_key');</code></strong>
+-----------------------------------+
| keyring_key_type_fetch('RSA_key') |
+-----------------------------------+
| RSA                               |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_length_fetch('RSA_key');</code></strong>
+-------------------------------------+
| keyring_key_length_fetch('RSA_key') |
+-------------------------------------+
|                                  16 |
+-------------------------------------+
</pre><p>
              この例では、印刷できない文字が含まれている可能性があるため、<code class="literal">HEX()</code> を使用してキー値を表示します。 この例では、簡潔にするために短いキーも使用していますが、長いキーを使用するとセキュリティが向上することに注意してください。 
            </p></li><li class="listitem"><p><a name="function_keyring-key-generate"></a>
              <code class="literal">keyring_key_generate(<em class="replaceable"><code>key_id</code></em>, <em class="replaceable"><code>key_type</code></em>, <em class="replaceable"><code>key_length</code></em>)</code>
            </p><a class="indexterm" name="idm46723754632464"></a><a class="indexterm" name="idm46723754630912"></a><p>
              指定された ID、タイプおよび長さの新しいランダムキーを生成し、キーリングに格納します。 型と長さの値は、基礎となるキーリングプラグインでサポートされている値と一致している必要があります。 <a class="xref" href="security.html#keyring-key-types" title="6.4.4.8 サポートされているキーリングキーのタイプと長さ">セクション6.4.4.8「サポートされているキーリングキーのタイプと長さ」</a>を参照してください。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: キー ID を指定する文字列。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_type</code></em>: キータイプを指定する文字列。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_length</code></em>: キーの長さをバイト単位で指定する整数。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              成功した場合は 1、失敗した場合は <code class="literal">NULL</code> およびエラーを返します。
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('RSA_key', 'RSA', 384);</code></strong>
+---------------------------------------------+
| keyring_key_generate('RSA_key', 'RSA', 384) |
+---------------------------------------------+
|                                           1 |
+---------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_keyring-key-length-fetch"></a>
              <code class="literal">keyring_key_length_fetch(<em class="replaceable"><code>key_id</code></em>)</code>
            </p><a class="indexterm" name="idm46723754615632"></a><a class="indexterm" name="idm46723754614064"></a><p>
              キー ID を指定すると、キーの長さを返します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: キー ID を指定する文字列。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              成功した場合はキーの長さをバイト単位で返し、キーが存在しない場合は <code class="literal">NULL</code>、失敗した場合は <code class="literal">NULL</code> およびエラーを返します。
            </p><p>
              例:
            </p><p>
              <code class="literal">keyring_key_fetch()</code> の説明を参照してください。
            </p></li><li class="listitem"><p><a name="function_keyring-key-remove"></a>
              <code class="literal">keyring_key_remove(<em class="replaceable"><code>key_id</code></em>)</code>
            </p><a class="indexterm" name="idm46723754602048"></a><a class="indexterm" name="idm46723754600496"></a><p>
              指定された ID のキーをキーリングから削除します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: キー ID を指定する文字列。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              成功の場合は 1 を返し、失敗の場合は <code class="literal">NULL</code> を返します。
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_remove('AES_key');</code></strong>
+-------------------------------+
| keyring_key_remove('AES_key') |
+-------------------------------+
|                             1 |
+-------------------------------+
</pre></li><li class="listitem"><p><a name="function_keyring-key-store"></a>
              <code class="literal">keyring_key_store(<em class="replaceable"><code>key_id</code></em>, <em class="replaceable"><code>key_type</code></em>, <em class="replaceable"><code>key</code></em>)</code>
            </p><a class="indexterm" name="idm46723754588272"></a><a class="indexterm" name="idm46723754586784"></a><p>
              キーリングにキーを不明瞭化して格納します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: キー ID を指定する文字列。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_type</code></em>: キータイプを指定する文字列。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key</code></em>: キー値を指定する文字列。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              成功した場合は 1、失敗した場合は <code class="literal">NULL</code> およびエラーを返します。
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT keyring_key_store('new key', 'DSA', 'My key value');</code></strong>
+-----------------------------------------------------+
| keyring_key_store('new key', 'DSA', 'My key value') |
+-----------------------------------------------------+
|                                                   1 |
+-----------------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_keyring-key-type-fetch"></a>
              <code class="literal">keyring_key_type_fetch(<em class="replaceable"><code>key_id</code></em>)</code>
            </p><a class="indexterm" name="idm46723754572272"></a><a class="indexterm" name="idm46723754570704"></a><p>
              キー ID を指定すると、キータイプを返します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: キー ID を指定する文字列。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              成功した場合は文字列、キーが存在しない場合は <code class="literal">NULL</code>、失敗した場合は <code class="literal">NULL</code> およびエラーとしてキータイプを返します。
            </p><p>
              例:
            </p><p>
              <code class="literal">keyring_key_fetch()</code> の説明を参照してください。
            </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-functions-plugin-specific"></a>6.4.4.11 プラグイン固有のキーリングキー管理関数</h4></div></div></div><a class="indexterm" name="idm46723754559776"></a><p>
        このセクションでは、キーリングプラグイン固有のユーザー定義関数 (UDF) ごとに、その目的、呼び出しシーケンス、および戻り値について説明します。 汎用キーリング UDF の詳細は、<a class="xref" href="security.html#keyring-functions-general-purpose" title="6.4.4.10 汎用キーリングキー管理関数">セクション6.4.4.10「汎用キーリングキー管理関数」</a> を参照してください。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_keyring-aws-rotate-cmk"></a>
            <code class="literal">keyring_aws_rotate_cmk()</code>
          </p><a class="indexterm" name="idm46723754553936"></a><a class="indexterm" name="idm46723754552528"></a><p>
            関連付けられたキーリングプラグイン: <code class="literal">keyring_aws</code>
          </p><p>
            <code class="literal">keyring_aws_rotate_cmk()</code> は、顧客マスターキー (CMK) をローテーションします。 ローテーションでは、AWS KMS が後続のデータキー暗号化操作に使用するキーのみが変更されます。 AWS KMS は以前の CMK バージョンを保持するため、以前の CMK を使用して生成されたキーはローテーション後も復号化可能なままになります。 
          </p><p>
            ローテーションによって AWS KMS 内で使用される CMK 値が変更されますが、参照に使用される ID は変更されないため、<code class="literal">keyring_aws_rotate_cmk()</code> のコール後に <code class="literal">keyring_aws_cmk_id</code> システム変数を変更する必要はありません。
          </p><p>
            この UDF には <code class="literal">SUPER</code> 権限が必要です。
          </p><p>
            引数:
          </p><p>
            なし
          </p><p>
            戻り値:
          </p><p>
            成功した場合は 1、失敗した場合は <code class="literal">NULL</code> およびエラーを返します。
          </p></li><li class="listitem"><p><a name="function_keyring-aws-rotate-keys"></a>
            <code class="literal">keyring_aws_rotate_keys()</code>
          </p><a class="indexterm" name="idm46723754537872"></a><a class="indexterm" name="idm46723754536464"></a><p>
            関連付けられたキーリングプラグイン: <code class="literal">keyring_aws</code>
          </p><p>
            <code class="literal">keyring_aws_rotate_keys()</code> は、<code class="literal">keyring_aws_data_file</code> システム変数で指定された <code class="literal">keyring_aws</code> ストレージファイルに格納されているキーをローテーションします。 ローテーションでは、<code class="literal">keyring_aws_cmk_id</code> システム変数の値を CMK 値として使用して、ファイルに格納されている各キーを AWS KMS に再暗号化のために送信し、新しい暗号化キーをファイルに格納します。 
          </p><p>
            <code class="literal">keyring_aws_rotate_keys()</code> は、次の場合にキーの再暗号化に役立ちます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                CMK のローテーション後 (<code class="literal">keyring_aws_rotate_cmk()</code> UDF の起動後)
              </p></li><li class="listitem"><p>
                <code class="literal">keyring_aws_cmk_id</code> システム変数を別のキー値に変更した後
              </p></li></ul></div><p>
            この UDF には <code class="literal">SUPER</code> 権限が必要です。
          </p><p>
            引数:
          </p><p>
            なし
          </p><p>
            戻り値:
          </p><p>
            成功した場合は 1、失敗した場合は <code class="literal">NULL</code> およびエラーを返します。
          </p></li><li class="listitem"><p><a name="function_keyring-hashicorp-update-config"></a>
            <code class="literal">keyring_hashicorp_update_config()</code>
          </p><a class="indexterm" name="idm46723754516016"></a><a class="indexterm" name="idm46723754514672"></a><p>
            関連付けられたキーリングプラグイン: <code class="literal">keyring_hashicorp</code>
          </p><p>
            <a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a> で説明されているように、<code class="literal">keyring_hashicorp_update_config()</code> UDF が呼び出されると、<code class="literal">keyring_hashicorp</code> はランタイム再構成を実行します。
          </p><p>
            この UDF ではグローバルシステム変数が変更されるため、<code class="literal">SYSTEM_VARIABLES_ADMIN</code> 権限が必要です。
          </p><p>
            引数:
          </p><p>
            なし
          </p><p>
            戻り値:
          </p><p>
            成功した場合は文字列<code class="literal">'Configuration update was successful.'</code>、失敗した場合は<code class="literal">'Configuration update failed.'</code>を返します。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-options"></a>6.4.4.12 キーリングコマンドのオプション</h4></div></div></div><p>
        MySQL は、次のキーリング関連のコマンドラインオプションをサポートしています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_keyring-migration-destination"></a>
            <code class="option">--keyring-migration-destination=<em class="replaceable"><code>plugin</code></em></code>
          </p><a class="indexterm" name="idm46723754498784"></a><a class="indexterm" name="idm46723754496592"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring-migration-destination"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-migration-destination=plugin_name</code></td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            キー移行用の宛先キーリングプラグイン。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 オプション値の形式と解釈は、<code class="option">--keyring-migration-source</code> オプションで説明されているものと同じです。 
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <code class="option">--keyring-migration-source</code> および <code class="option">--keyring-migration-destination</code> は、すべてのキーリング移行操作に必須です。 ソースプラグインと移行先プラグインは異なる必要があり、移行サーバーは両方のプラグインをサポートする必要があります。 
            </p></div></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-host"></a>
            <code class="option">--keyring-migration-host=<em class="replaceable"><code>host_name</code></em></code>
          </p><a class="indexterm" name="idm46723754479840"></a><a class="indexterm" name="idm46723754477616"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring-migration-host"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-migration-host=host_name</code></td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">localhost</code></td>
</tr></tbody></table></div><p>
            いずれかのキー移行キーストアを現在使用している実行中のサーバーのホストの場所。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 移行は常にローカルホストで行われるため、このオプションでは、<code class="literal">localhost</code>, <code class="literal">127.0.0.1</code>, <code class="literal">::1</code> などのローカルサーバーに接続するための値、またはローカルホストの IP アドレスまたはホスト名を常に指定します。 
          </p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-password"></a>
            <code class="option">--keyring-migration-password[=<em class="replaceable"><code>password</code></em>]</code>
          </p><a class="indexterm" name="idm46723754459296"></a><a class="indexterm" name="idm46723754457120"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring-migration-password"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-migration-password[=password]</code></td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            いずれかのキー移行キーストアを現在使用している実行中のサーバーに接続するためのパスワード。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 コマンドラインでオプション名の後に <em class="replaceable"><code>password</code></em> 値を省略すると、サーバーによって値の入力が求められます。 
          </p><p>
            コマンド行でのパスワード指定は、セキュアでないと考えるべきです。 <a class="xref" href="security.html#password-security-user" title="6.1.2.1 パスワードセキュリティーのためのエンドユーザーガイドライン">セクション6.1.2.1「パスワードセキュリティーのためのエンドユーザーガイドライン」</a>を参照してください。 オプションファイルを使用すれば、コマンド行でパスワードを指定することを回避できます。 この場合、ファイルには制限モードがあり、移行サーバーの実行に使用されるアカウントからのみアクセスできる必要があります。 
          </p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-port"></a>
            <code class="option">--keyring-migration-port=<em class="replaceable"><code>port_num</code></em></code>
          </p><a class="indexterm" name="idm46723754441248"></a><a class="indexterm" name="idm46723754439024"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring-migration-port"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-migration-port=port_num</code></td>
</tr><tr><th>型</th>
<td>数値</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">3306</code></td>
</tr></tbody></table></div><p>
            TCP/IP 接続の場合、キー移行キーストアのいずれかを現在使用している実行中のサーバーに接続するためのポート番号。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-socket"></a>
            <code class="option">--keyring-migration-socket=<em class="replaceable"><code>path</code></em></code>
          </p><a class="indexterm" name="idm46723754423312"></a><a class="indexterm" name="idm46723754421072"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring-migration-socket"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-migration-socket={file_name|pipe_name}</code></td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            Unix ソケットファイルまたは Windows 名前付きパイプ接続の場合、キー移行キーストアのいずれかを現在使用している実行中のサーバーに接続するためのソケットファイルまたは名前付きパイプ。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-source"></a>
            <code class="option">--keyring-migration-source=<em class="replaceable"><code>plugin</code></em></code>
          </p><a class="indexterm" name="idm46723754407584"></a><a class="indexterm" name="idm46723754405344"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring-migration-source"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-migration-source=plugin_name</code></td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            キー移行用のソースキープラグイン。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 
          </p><p>
            このオプションの値は <code class="option">--plugin-load</code> の値と似ていますが、指定できるプラグインライブラリが 1 つだけである点が異なります。 この値は、<em class="replaceable"><code>name</code></em> <code class="literal">=</code> <em class="replaceable"><code>plugin_library</code></em> または <em class="replaceable"><code>plugin_library</code></em> として指定されます。 <em class="replaceable"><code>name</code></em> はロードするプラグインの名前で、<em class="replaceable"><code>plugin_library</code></em> はプラグインコードを含むライブラリファイルの名前です。 プラグインライブラリに先行するプラグイン名を付けないで名前を付けると、サーバーはライブラリ内のすべてのプラグインをロードします。 サーバーは、<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ内でプラグインライブラリファイルを検索します。 
          </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
              <code class="option">--keyring-migration-source</code> および <code class="option">--keyring-migration-destination</code> は、すべてのキーリング移行操作に必須です。 ソースプラグインと移行先プラグインは異なる必要があり、移行サーバーは両方のプラグインをサポートする必要があります。 
            </p></div></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-user"></a>
            <code class="option">--keyring-migration-user=<em class="replaceable"><code>user_name</code></em></code>
          </p><a class="indexterm" name="idm46723754383264"></a><a class="indexterm" name="idm46723754381040"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring-migration-user"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-migration-user=user_name</code></td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            いずれかのキー移行キーストアを現在使用している実行中のサーバーに接続するためのユーザー名。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="keyring-system-variables"></a>6.4.4.13 キーリングシステム変数</h4></div></div></div><a class="indexterm" name="idm46723754368480"></a><p>
        MySQL キーリングプラグインは、次のシステム変数をサポートしています。 これらを使用して、キーリングプラグイン操作を構成します。 これらの変数は、適切なキーリングプラグインがインストールされていないかぎり使用できません (<a class="xref" href="security.html#keyring-installation" title="6.4.4.1 キーリングプラグインのインストール">セクション6.4.4.1「キーリングプラグインのインストール」</a> を参照)。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_keyring_aws_cmk_id"></a>
            <code class="literal">keyring_aws_cmk_id</code>
          </p><a class="indexterm" name="idm46723754363344"></a><a class="indexterm" name="idm46723754361792"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_aws_cmk_id"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-aws-cmk-id=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_aws_cmk_id">keyring_aws_cmk_id</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            AWS KMS サーバーから取得され、<code class="literal">keyring_aws</code> プラグインで使用される顧客マスターキー (CMK) ID。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_aws</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_aws_conf_file"></a>
            <code class="literal">keyring_aws_conf_file</code>
          </p><a class="indexterm" name="idm46723754337152"></a><a class="indexterm" name="idm46723754335600"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_aws_conf_file"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-aws-conf-file=file_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_aws_conf_file">keyring_aws_conf_file</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ファイル名</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_aws</code> プラグインの構成ファイルの場所。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            プラグインの起動時に、<code class="literal">keyring_aws</code> は AWS 秘密アクセスキー ID およびキーを構成ファイルから読み取ります。 <code class="literal">keyring_aws</code> プラグインを正常に起動するには、構成ファイルが存在し、<a class="xref" href="security.html#keyring-aws-plugin" title="6.4.4.5 keyring_aws Amazon Web Services キーリングプラグインの使用">セクション6.4.4.5「keyring_aws Amazon Web Services キーリングプラグインの使用」</a> の説明に従って初期化された有効な秘密アクセスキー情報が含まれている必要があります。 
          </p><p>
            デフォルトのファイル名は <code class="literal">keyring_aws_conf</code> で、デフォルトのキーリングファイルディレクトリにあります。 このデフォルトディレクトリの場所は、<code class="literal">keyring_file_data</code> システム変数の場所と同じです。 ディレクトリを手動で作成する場合に考慮する必要がある考慮事項の詳細は、その変数の説明を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_aws_data_file"></a>
            <code class="literal">keyring_aws_data_file</code>
          </p><a class="indexterm" name="idm46723754303936"></a><a class="indexterm" name="idm46723754302384"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_aws_data_file"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-aws-data-file</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_aws_data_file">keyring_aws_data_file</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ファイル名</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_aws</code> プラグインのストレージファイルの場所。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            プラグインの起動時に、<code class="literal">keyring_aws_data_file</code> に割り当てられた値で存在しないファイルが指定された場合、<code class="literal">keyring_aws</code> プラグインはそれを (必要に応じて親ディレクトリとともに) 作成しようとします。 ファイルが存在する場合、<code class="literal">keyring_aws</code> はファイルに含まれている暗号化キーをメモリー内キャッシュに読み取ります。<code class="literal">keyring_aws</code> では、暗号化されていないキーはメモリーにキャッシュされません。 
          </p><p>
            デフォルトのファイル名は <code class="literal">keyring_aws_data</code> で、デフォルトのキーリングファイルディレクトリにあります。 このデフォルトディレクトリの場所は、<code class="literal">keyring_file_data</code> システム変数の場所と同じです。 ディレクトリを手動で作成する場合に考慮する必要がある考慮事項の詳細は、その変数の説明を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_aws_region"></a>
            <code class="literal">keyring_aws_region</code>
          </p><a class="indexterm" name="idm46723754269488"></a><a class="indexterm" name="idm46723754267936"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_aws_region"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-aws-region=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_aws_region">keyring_aws_region</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">us-east-1</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">ap-northeast-1</code></p><p class="valid-value"><code class="literal">ap-northeast-2</code></p><p class="valid-value"><code class="literal">ap-south-1</code></p><p class="valid-value"><code class="literal">ap-southeast-1</code></p><p class="valid-value"><code class="literal">ap-southeast-2</code></p><p class="valid-value"><code class="literal">eu-central-1</code></p><p class="valid-value"><code class="literal">eu-west-1</code></p><p class="valid-value"><code class="literal">sa-east-1</code></p><p class="valid-value"><code class="literal">us-east-1</code></p><p class="valid-value"><code class="literal">us-west-1</code></p><p class="valid-value"><code class="literal">us-west-2</code></p></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_aws</code> プラグインの AWS リージョン。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_encrypted_file_data"></a>
            <code class="literal">keyring_encrypted_file_data</code>
          </p><a class="indexterm" name="idm46723754229968"></a><a class="indexterm" name="idm46723754228400"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_encrypted_file_data"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-encrypted-file-data=file_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_encrypted_file_data">keyring_encrypted_file_data</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ファイル名</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_encrypted_file</code> プラグインによってセキュアなデータ記憶域に使用されるデータファイルのパス名。 この変数は、そのプラグインがインストールされないかぎり利用できません。 ファイルの場所は、キーリングプラグインによってのみ使用されると見なされるディレクトリ内にある必要があります。 たとえば、データディレクトリの下にファイルを配置しないでください。 
          </p><p>
            キーリング操作はトランザクションです: <code class="literal">keyring_encrypted_file</code> プラグインは、書込み操作中にバックアップファイルを使用して、操作が失敗した場合に元のファイルにロールバックできるようにします。 バックアップファイルの名前は、接尾辞が <code class="filename">.backup</code> の <code class="literal">keyring_encrypted_file_data</code> システム変数の値と同じです。 
          </p><p>
            複数の MySQL インスタンスに同じ <code class="literal">keyring_encrypted_file</code> データファイルを使用しないでください。 各インスタンスには、独自の一意のデータファイルが必要です。 
          </p><p>
            次のテーブルに示すように、デフォルトのファイル名は <code class="filename">keyring_encrypted</code> で、プラットフォーム固有のディレクトリにあり、<code class="option">INSTALL_LAYOUT</code> <span class="command"><strong>CMake</strong></span> オプションの値によって異なります。 ソースからビルドする場合にファイルのデフォルトディレクトリを明示的に指定するには、<code class="option">INSTALL_MYSQLKEYRINGDIR</code> <span class="command"><strong>CMake</strong></span> オプションを使用します。 
          </p><div class="informaltable"><table summary="The default keyring_encrypted_file_data value for different INSTALL_LAYOUT values."><col style="width=35%"><col style="width=65%"><thead><tr>
                <th><code class="literal">INSTALL_LAYOUT</code> 値</th>
                <th>デフォルトの <code class="literal">keyring_encrypted_file_data</code> 値</th>
              </tr></thead><tbody><tr>
                <td><code class="literal">DEB</code>, <code class="literal">RPM</code>, <code class="literal">SVR4</code></td>
                <td><code class="filename">/var/lib/mysql-keyring/keyring_encrypted</code></td>
              </tr><tr>
                <td>それ以外の場合</td>
                <td><code class="option">CMAKE_INSTALL_PREFIX</code> 値の下の <code class="filename">keyring/keyring_encrypted</code></td>
              </tr></tbody></table></div><p>
            プラグインの起動時に、<code class="literal">keyring_encrypted_file_data</code> に割り当てられた値で存在しないファイルが指定された場合、<code class="literal">keyring_encrypted_file</code> プラグインはそれを (必要に応じて親ディレクトリとともに) 作成しようとします。
          </p><p>
            ディレクトリを手動で作成する場合は、制限モードであり、MySQL サーバーの実行に使用されるアカウントからのみアクセスできる必要があります。 たとえば、Unix および Unix に似たシステムで<code class="filename">/usr/local/mysql/mysql-keyring</code> ディレクトリを使用するには、次のコマンド (<code class="literal">root</code> として実行) を実行してディレクトリを作成し、そのモードと所有権を設定します: 
          </p><pre class="programlisting">cd /usr/local/mysql
mkdir mysql-keyring
chmod 750 mysql-keyring
chown mysql mysql-keyring
chgrp mysql mysql-keyring
</pre><p>
            <code class="literal">keyring_encrypted_file</code> プラグインは、データファイルを作成またはアクセスできない場合、エラーログにエラーメッセージを書き込みます。 <code class="literal">keyring_encrypted_file_data</code> への実行時割当てが試行されてもエラーが発生した場合、変数値は変更されません。 
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
              <code class="literal">keyring_encrypted_file</code> プラグインがデータファイルを作成して使用を開始したら、ファイルを削除しないことが重要です。 ファイルが失われると、キーを使用して暗号化されたデータにアクセスできなくなります。 (一致するように <code class="literal">keyring_encrypted_file_data</code> の値を変更しているかぎり、ファイルの名前を変更したり、ファイルを移動したりできます。) 
            </p></div></li><li class="listitem"><p><a name="sysvar_keyring_encrypted_file_password"></a>
            <code class="literal">keyring_encrypted_file_password</code>
          </p><a class="indexterm" name="idm46723754166160"></a><a class="indexterm" name="idm46723754164576"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_encrypted_file_password"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-encrypted-file-password=password</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_encrypted_file_password">keyring_encrypted_file_password</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_encrypted_file</code> プラグインで使用されるパスワード。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_encrypted_file</code> の初期化は失敗します。 
          </p><p>
            この変数がオプションファイルで指定されている場合、ファイルは制限モードであり、MySQL サーバーの実行に使用されるアカウントからのみアクセスできる必要があります。
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
              <code class="literal">keyring_encrypted_file_password</code> 値が設定されると、変更してもキーリングパスワードはローテーションされず、サーバーにアクセスできなくなる可能性があります。 不正なパスワードが指定された場合、<code class="literal">keyring_encrypted_file</code> プラグインは暗号化キーリングファイルからキーをロードできません。 
            </p></div><p>
            表示値が不明瞭化されているため、<code class="literal">SHOW VARIABLES</code> またはパフォーマンススキーマ <code class="literal">global_variables</code> テーブルでは実行時にパスワード値を表示できません。
          </p></li><li class="listitem"><p><a name="sysvar_keyring_file_data"></a>
            <code class="literal">keyring_file_data</code>
          </p><a class="indexterm" name="idm46723754133264"></a><a class="indexterm" name="idm46723754131712"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_file_data"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-file-data=file_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_file_data">keyring_file_data</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ファイル名</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_file</code> プラグインによってセキュアなデータ記憶域に使用されるデータファイルのパス名。 この変数は、そのプラグインがインストールされないかぎり利用できません。 ファイルの場所は、キーリングプラグインによってのみ使用されると見なされるディレクトリ内にある必要があります。 たとえば、データディレクトリの下にファイルを配置しないでください。 
          </p><p>
            キーリング操作はトランザクションです: <code class="literal">keyring_file</code> プラグインは、書込み操作中にバックアップファイルを使用して、操作が失敗した場合に元のファイルにロールバックできるようにします。 バックアップファイルの名前は、接尾辞が <code class="filename">.backup</code> の <code class="literal">keyring_file_data</code> システム変数の値と同じです。 
          </p><p>
            複数の MySQL インスタンスに同じ <code class="literal">keyring_file</code> データファイルを使用しないでください。 各インスタンスには、独自の一意のデータファイルが必要です。 
          </p><p>
            次のテーブルに示すように、デフォルトのファイル名は <code class="filename">keyring</code> で、プラットフォーム固有のディレクトリにあり、<code class="option">INSTALL_LAYOUT</code> <span class="command"><strong>CMake</strong></span> オプションの値によって異なります。 ソースからビルドする場合にファイルのデフォルトディレクトリを明示的に指定するには、<code class="option">INSTALL_MYSQLKEYRINGDIR</code> <span class="command"><strong>CMake</strong></span> オプションを使用します。 
          </p><div class="informaltable"><table summary="The default keyring_file_data value for different INSTALL_LAYOUT values."><col style="width=35%"><col style="width=65%"><thead><tr>
                <th><code class="literal">INSTALL_LAYOUT</code> 値</th>
                <th>デフォルトの <code class="literal">keyring_file_data</code> 値</th>
              </tr></thead><tbody><tr>
                <td><code class="literal">DEB</code>, <code class="literal">RPM</code>, <code class="literal">SVR4</code></td>
                <td><code class="filename">/var/lib/mysql-keyring/keyring</code></td>
              </tr><tr>
                <td>それ以外の場合</td>
                <td><code class="option">CMAKE_INSTALL_PREFIX</code> 値の下の <code class="filename">keyring/keyring</code></td>
              </tr></tbody></table></div><p>
            プラグインの起動時に、<code class="literal">keyring_file_data</code> に割り当てられた値で存在しないファイルが指定された場合、<code class="literal">keyring_file</code> プラグインはそれを (必要に応じて親ディレクトリとともに) 作成しようとします。
          </p><p>
            ディレクトリを手動で作成する場合は、制限モードであり、MySQL サーバーの実行に使用されるアカウントからのみアクセスできる必要があります。 たとえば、Unix および Unix に似たシステムで<code class="filename">/usr/local/mysql/mysql-keyring</code> ディレクトリを使用するには、次のコマンド (<code class="literal">root</code> として実行) を実行してディレクトリを作成し、そのモードと所有権を設定します: 
          </p><pre class="programlisting">cd /usr/local/mysql
mkdir mysql-keyring
chmod 750 mysql-keyring
chown mysql mysql-keyring
chgrp mysql mysql-keyring
</pre><p>
            <code class="literal">keyring_file</code> プラグインは、データファイルを作成またはアクセスできない場合、エラーログにエラーメッセージを書き込みます。 <code class="literal">keyring_file_data</code> への実行時割当てが試行されてもエラーが発生した場合、変数値は変更されません。 
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
              <code class="literal">keyring_file</code> プラグインがデータファイルを作成して使用を開始したら、ファイルを削除しないことが重要です。 たとえば、<code class="literal">InnoDB</code> は、このファイルを使用して、<code class="literal">InnoDB</code> テーブルスペース暗号化を使用するテーブルのデータの復号化に使用されるマスターキーを格納します。<a class="xref" href="innodb-storage-engine.html#innodb-data-encryption" title="15.13 InnoDB 保存データ暗号化">セクション15.13「InnoDB 保存データ暗号化」</a> を参照してください。 ファイルが失われると、このようなテーブルのデータにアクセスできなくなります。 (一致するように <code class="literal">keyring_file_data</code> の値を変更しているかぎり、ファイルの名前を変更したり、ファイルを移動したりできます。) 最初の暗号化されたテーブルを作成した直後、およびマスターキーのローテーションの前後に、キーリングデータファイルの個別のバックアップを作成することをお薦めします。 
            </p></div></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_auth_path"></a>
            <code class="literal">keyring_hashicorp_auth_path</code>
          </p><a class="indexterm" name="idm46723754066944"></a><a class="indexterm" name="idm46723754065376"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_auth_path"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-hashicorp-auth-path=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_auth_path">keyring_hashicorp_auth_path</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">/v1/auth/approle/login</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_hashicorp</code> プラグインで使用するために、HashiCorp Vault サーバー内で AppRole 認証が有効になっている認証パス。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_ca_path"></a>
            <code class="literal">keyring_hashicorp_ca_path</code>
          </p><a class="indexterm" name="idm46723754037504"></a><a class="indexterm" name="idm46723754035936"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_ca_path"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-hashicorp-ca-path=file_name</code></td>
</tr><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_ca_path">keyring_hashicorp_ca_path</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ファイル名</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">empty string</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_hashicorp</code> プラグインで使用する適切にフォーマットされた TLS 認証局を含む、MySQL サーバーにアクセス可能なローカルファイルの絶対パス名。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            この変数が設定されていない場合、<code class="literal">keyring_hashicorp</code> プラグインはサーバー証明書の検証を使用せずに HTTPS 接続を開き、HashiCorp Vault サーバーによって配信された証明書を信頼します。 これを安全にするには、Vault サーバが悪意のないものと想定し、中間者攻撃が発生しないようにする必要があります。 これらの仮定が無効な場合は、<code class="literal">keyring_hashicorp_ca_path</code> を信頼できる CA 証明書のパスに設定します。 (たとえば、<a class="xref" href="security.html#keyring-hashicorp-certificate-configuration" title="証明書とキーの準備">証明書とキーの準備</a> の手順の場合、これは <code class="filename">company.crt</code> ファイルです。) 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_caching"></a>
            <code class="literal">keyring_hashicorp_caching</code>
          </p><a class="indexterm" name="idm46723754003440"></a><a class="indexterm" name="idm46723754001872"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_caching"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-hashicorp-caching[={OFF|ON}]</code></td>
</tr><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_caching">keyring_hashicorp_caching</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">OFF</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_hashicorp</code> プラグインが HashiCorp Vault サーバーからキーをキャッシュするために使用するオプションのインメモリーキーキャッシュを有効にするかどうか。 この変数は、そのプラグインがインストールされないかぎり利用できません。 キャッシュが有効になっている場合、プラグインは初期化中にキャッシュを移入します。 それ以外の場合、プラグインは初期化中にキーリストのみを移入します。 
          </p><p>
            キャッシュの有効化は危険です: パフォーマンスは向上しますが、機密キー情報のコピーはメモリー内に保持されるため、セキュリティ上の目的では望ましくない場合があります。
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_commit_auth_path"></a>
            <code class="literal">keyring_hashicorp_commit_auth_path</code>
          </p><a class="indexterm" name="idm46723753972912"></a><a class="indexterm" name="idm46723753971312"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_commit_auth_path"><col style="width=30%"><col style="width=70%"><tbody><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_commit_auth_path">keyring_hashicorp_commit_auth_path</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            この変数は、<code class="literal">keyring_hashicorp</code> プラグインの初期化時に値を取得する <code class="literal">keyring_hashicorp_auth_path</code> に関連付けられています。 この変数は、そのプラグインがインストールされないかぎり利用できません。 これには、初期化が成功した場合にプラグイン操作に実際に使用される <span class="quote">「<span class="quote">committed</span>」</span> 値が反映されます。 追加情報については <a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_commit_ca_path"></a>
            <code class="literal">keyring_hashicorp_commit_ca_path</code>
          </p><a class="indexterm" name="idm46723753945952"></a><a class="indexterm" name="idm46723753944368"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_commit_ca_path"><col style="width=30%"><col style="width=70%"><tbody><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_commit_ca_path">keyring_hashicorp_commit_ca_path</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            この変数は、<code class="literal">keyring_hashicorp</code> プラグインの初期化時に値を取得する <code class="literal">keyring_hashicorp_ca_path</code> に関連付けられています。 この変数は、そのプラグインがインストールされないかぎり利用できません。 これには、初期化が成功した場合にプラグイン操作に実際に使用される <span class="quote">「<span class="quote">committed</span>」</span> 値が反映されます。 追加情報については <a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_commit_caching"></a>
            <code class="literal">keyring_hashicorp_commit_caching</code>
          </p><a class="indexterm" name="idm46723753918976"></a><a class="indexterm" name="idm46723753917392"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_commit_caching"><col style="width=30%"><col style="width=70%"><tbody><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_commit_caching">keyring_hashicorp_commit_caching</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            この変数は、<code class="literal">keyring_hashicorp</code> プラグインの初期化時に値を取得する <code class="literal">keyring_hashicorp_caching</code> に関連付けられています。 この変数は、そのプラグインがインストールされないかぎり利用できません。 これには、初期化が成功した場合にプラグイン操作に実際に使用される <span class="quote">「<span class="quote">committed</span>」</span> 値が反映されます。 追加情報については <a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_commit_role_id"></a>
            <code class="literal">keyring_hashicorp_commit_role_id</code>
          </p><a class="indexterm" name="idm46723753892000"></a><a class="indexterm" name="idm46723753890416"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_commit_role_id"><col style="width=30%"><col style="width=70%"><tbody><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_commit_role_id">keyring_hashicorp_commit_role_id</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            この変数は、<code class="literal">keyring_hashicorp</code> プラグインの初期化時に値を取得する <code class="literal">keyring_hashicorp_role_id</code> に関連付けられています。 この変数は、そのプラグインがインストールされないかぎり利用できません。 これには、初期化が成功した場合にプラグイン操作に実際に使用される <span class="quote">「<span class="quote">committed</span>」</span> 値が反映されます。 追加情報については <a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_commit_server_url"></a>
            <code class="literal">keyring_hashicorp_commit_server_url</code>
          </p><a class="indexterm" name="idm46723753864928"></a><a class="indexterm" name="idm46723753863328"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_commit_server_url"><col style="width=30%"><col style="width=70%"><tbody><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_commit_server_url">keyring_hashicorp_commit_server_url</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            この変数は、<code class="literal">keyring_hashicorp</code> プラグインの初期化時に値を取得する <code class="literal">keyring_hashicorp_server_url</code> に関連付けられています。 この変数は、そのプラグインがインストールされないかぎり利用できません。 これには、初期化が成功した場合にプラグイン操作に実際に使用される <span class="quote">「<span class="quote">committed</span>」</span> 値が反映されます。 追加情報については <a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_commit_store_path"></a>
            <code class="literal">keyring_hashicorp_commit_store_path</code>
          </p><a class="indexterm" name="idm46723753837872"></a><a class="indexterm" name="idm46723753836272"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_commit_store_path"><col style="width=30%"><col style="width=70%"><tbody><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_commit_store_path">keyring_hashicorp_commit_store_path</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            この変数は、<code class="literal">keyring_hashicorp</code> プラグインの初期化時に値を取得する <code class="literal">keyring_hashicorp_store_path</code> に関連付けられています。 この変数は、そのプラグインがインストールされないかぎり利用できません。 これには、初期化が成功した場合にプラグイン操作に実際に使用される <span class="quote">「<span class="quote">committed</span>」</span> 値が反映されます。 追加情報については <a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a>を参照してください。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_role_id"></a>
            <code class="literal">keyring_hashicorp_role_id</code>
          </p><a class="indexterm" name="idm46723753810912"></a><a class="indexterm" name="idm46723753809344"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_role_id"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-hashicorp-role-id=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_role_id">keyring_hashicorp_role_id</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">empty string</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_hashicorp</code> プラグインで使用する HashiCorp Vault AppRole 認証ロール ID。 この変数は、そのプラグインがインストールされないかぎり利用できません。 値は UUID 形式である必要があります。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_hashicorp</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_secret_id"></a>
            <code class="literal">keyring_hashicorp_secret_id</code>
          </p><a class="indexterm" name="idm46723753780144"></a><a class="indexterm" name="idm46723753778576"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_secret_id"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-hashicorp-secret-id=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_secret_id">keyring_hashicorp_secret_id</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">empty string</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_hashicorp</code> プラグインで使用する HashiCorp Vault AppRole 認証シークレット ID。 この変数は、そのプラグインがインストールされないかぎり利用できません。 値は UUID 形式である必要があります。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_hashicorp</code> の初期化は失敗します。 
          </p><p>
            この変数の値は機密であるため、その値は表示時に <code class="literal">*</code> 文字によってマスクされます。
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_server_url"></a>
            <code class="literal">keyring_hashicorp_server_url</code>
          </p><a class="indexterm" name="idm46723753748080"></a><a class="indexterm" name="idm46723753746512"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_server_url"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-hashicorp-server-url=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_server_url">keyring_hashicorp_server_url</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">https://127.0.0.1:8200</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_hashicorp</code> プラグインで使用する HashiCorp Vault サーバーの URL。 この変数は、そのプラグインがインストールされないかぎり利用できません。 値は <code class="literal">https://</code>で始まる必要があります。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_hashicorp_store_path"></a>
            <code class="literal">keyring_hashicorp_store_path</code>
          </p><a class="indexterm" name="idm46723753718032"></a><a class="indexterm" name="idm46723753716464"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_hashicorp_store_path"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-hashicorp-store-path=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.18</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_hashicorp_store_path">keyring_hashicorp_store_path</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">empty string</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_hashicorp</code> プラグインによって適切な AppRole AppRole 資格証明が提供される場合に書込み可能な HashiCorp Vault サーバー内のストアパス。 この変数は、そのプラグインがインストールされないかぎり利用できません。 資格証明を指定するには、<code class="literal">keyring_hashicorp_role_id</code> および <code class="literal">keyring_hashicorp_secret_id</code> システム変数を設定します (たとえば、<a class="xref" href="security.html#keyring-hashicorp-plugin-configuration" title="keyring_hashicorp 構成">keyring_hashicorp 構成</a> を参照)。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_hashicorp</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_ca_certificate"></a>
            <code class="literal">keyring_oci_ca_certificate</code>
          </p><a class="indexterm" name="idm46723753684368"></a><a class="indexterm" name="idm46723753682800"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_ca_certificate"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-ca-certificate=file_name</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_ca_certificate">keyring_oci_ca_certificate</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">empty string</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインが Oracle Cloud Infrastructure 証明書の検証に使用する CA 証明書バンドルファイルのパス名。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            ファイルにピア検証用の 1 つまたは複数の証明書が含まれています。 ファイルが指定されていない場合、システムにインストールされているデフォルトの CA バンドルが使用されます。 値が <code class="literal">disabled</code> の場合 (大/小文字を区別)、<code class="literal">keyring_oci</code> は証明書の検証を実行しません。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_compartment"></a>
            <code class="literal">keyring_oci_compartment</code>
          </p><a class="indexterm" name="idm46723753652368"></a><a class="indexterm" name="idm46723753650816"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_compartment"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-compartment=ocid</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_compartment">keyring_oci_compartment</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインが MySQL キーの場所として使用するテナンシコンパートメントの OCID。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            <code class="literal">keyring_oci</code> を使用する前に、MySQL コンパートメントまたはサブコンパートメントが存在しない場合は作成する必要があります。 このコンパートメントにボールトキーまたはボールトシークレットを含めることはできません。 MySQL Keyring 以外のシステムでは使用しないでください。 
          </p><p>
            コンパートメントの管理および OCID の取得の詳細は、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/Identity/Tasks/managingcompartments.htm" target="_top">「コンパートメントの管理」</a>を参照してください。
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_encryption_endpoint"></a>
            <code class="literal">keyring_oci_encryption_endpoint</code>
          </p><a class="indexterm" name="idm46723753621104"></a><a class="indexterm" name="idm46723753619520"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_encryption_endpoint"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-encryption-endpoint=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_encryption_endpoint">keyring_oci_encryption_endpoint</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインが新しいキーの暗号文を生成するために使用する Oracle Cloud Infrastructure 暗号化サーバーのエンドポイント。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            暗号化エンドポイントはボールト固有であり、Oracle Cloud Infrastructure によってボールト作成時に割り当てられます。 エンドポイント OCID を取得するには、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingvaults.htm" target="_top">「ボールトの管理」</a>の手順を使用して、<code class="literal">keyring_oci</code> ボールトの構成詳細を表示します。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_key_file"></a>
            <code class="literal">keyring_oci_key_file</code>
          </p><a class="indexterm" name="idm46723753590192"></a><a class="indexterm" name="idm46723753588640"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_key_file"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-key-file=file_name</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_key_file">keyring_oci_key_file</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインが Oracle Cloud Infrastructure 認証に使用する RSA 秘密キーを含むファイルのパス名。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            コンソールを使用して、対応する RSA 公開キーもアップロードする必要があります。 コンソールには、<code class="literal">keyring_oci_key_fingerprint</code> システム変数の設定に使用できるキーフィンガープリント値が表示されます。 
          </p><p>
            API キーの生成およびアップロードの詳細は、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm" target="_top">「必要なキーおよび OCID」</a>を参照してください。
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_key_fingerprint"></a>
            <code class="literal">keyring_oci_key_fingerprint</code>
          </p><a class="indexterm" name="idm46723753558704"></a><a class="indexterm" name="idm46723753557136"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_key_fingerprint"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-key-fingerprint=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_key_fingerprint">keyring_oci_key_fingerprint</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインが Oracle Cloud Infrastructure 認証に使用する RSA 秘密キーのフィンガープリント。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            API キーの作成中にキーフィンガープリントを取得するには、次のコマンドを実行します:
          </p><pre class="programlisting">openssl rsa -pubout -outform DER -in ~/.oci/oci_api_key.pem | openssl md5 -c
</pre><p>
            または、RSA 公開キーをアップロードするとフィンガープリントが自動的に表示されるコンソールからフィンガープリントを取得します。
          </p><p>
            キーフィンガープリントの取得の詳細は、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm" target="_top">「必要なキーおよび OCID」</a>を参照してください。
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_management_endpoint"></a>
            <code class="literal">keyring_oci_management_endpoint</code>
          </p><a class="indexterm" name="idm46723753526496"></a><a class="indexterm" name="idm46723753524912"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_management_endpoint"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-management-endpoint=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_management_endpoint">keyring_oci_management_endpoint</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインが既存のキーをリストするために使用する Oracle Cloud Infrastructure キー管理サーバーのエンドポイント。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            キー管理エンドポイントはボールト固有で、Oracle Cloud Infrastructure によってボールト作成時に割り当てられます。 エンドポイント OCID を取得するには、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingvaults.htm" target="_top">「ボールトの管理」</a>の手順を使用して、<code class="literal">keyring_oci</code> ボールトの構成詳細を表示します。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_master_key"></a>
            <code class="literal">keyring_oci_master_key</code>
          </p><a class="indexterm" name="idm46723753495600"></a><a class="indexterm" name="idm46723753494048"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_master_key"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-master-key=ocid</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_master_key">keyring_oci_master_key</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインがシークレットの暗号化に使用する Oracle Cloud Infrastructure マスター暗号化キーの OCID。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            <code class="literal">keyring_oci</code> を使用する前に、Oracle Cloud Infrastructure コンパートメントの暗号化キーを作成する必要があります (存在しない場合)。 生成されたキーの MySQL 固有名を指定し、他の目的には使用しないでください。 
          </p><p>
            キーの作成の詳細は、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingkeys.htm" target="_top">「キーの管理」</a>を参照してください。
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_secrets_endpoint"></a>
            <code class="literal">keyring_oci_secrets_endpoint</code>
          </p><a class="indexterm" name="idm46723753464464"></a><a class="indexterm" name="idm46723753462896"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_secrets_endpoint"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-secrets-endpoint=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_secrets_endpoint">keyring_oci_secrets_endpoint</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインがシークレットのリスト、作成およびリタイアに使用する Oracle Cloud Infrastructure シークレットサーバーのエンドポイント。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            シークレットのエンドポイントはボールト固有で、Oracle Cloud Infrastructure によってボールト作成時に割り当てられます。 エンドポイント OCID を取得するには、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingvaults.htm" target="_top">「ボールトの管理」</a>の手順を使用して、<code class="literal">keyring_oci</code> ボールトの構成詳細を表示します。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_tenancy"></a>
            <code class="literal">keyring_oci_tenancy</code>
          </p><a class="indexterm" name="idm46723753433520"></a><a class="indexterm" name="idm46723753431968"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_tenancy"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-tenancy=ocid</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_tenancy">keyring_oci_tenancy</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインが MySQL コンパートメントの場所として使用する Oracle Cloud Infrastructure テナンシの OCID。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            <code class="literal">keyring_oci</code> を使用する前に、テナンシが存在しない場合は作成する必要があります。 コンソールからテナンシ OCID を取得するには、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm" target="_top">「必要なキーおよび OCID」</a>の手順を使用します。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_user"></a>
            <code class="literal">keyring_oci_user</code>
          </p><a class="indexterm" name="idm46723753403120"></a><a class="indexterm" name="idm46723753401584"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_user"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-user=ocid</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_user">keyring_oci_user</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインがクラウド接続に使用する Oracle Cloud Infrastructure ユーザーの OCID。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            <code class="literal">keyring_oci</code> を使用する前に、このユーザーが存在し、構成済の Oracle Cloud Infrastructure テナンシ、コンパートメントおよびボールトリソースを使用するためのアクセス権が付与されている必要があります。
          </p><p>
            コンソールからユーザー OCID を取得するには、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm" target="_top">「必要なキーおよび OCID」</a>の手順を使用します。
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_vaults_endpoint"></a>
            <code class="literal">keyring_oci_vaults_endpoint</code>
          </p><a class="indexterm" name="idm46723753371968"></a><a class="indexterm" name="idm46723753370400"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_vaults_endpoint"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-vaults-endpoint=value</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_vaults_endpoint">keyring_oci_vaults_endpoint</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインがシークレットの値を取得するために使用する Oracle Cloud Infrastructure ボールトサーバーのエンドポイント。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            ボールトエンドポイントはボールト固有であり、Oracle Cloud Infrastructure によってボールト作成時に割り当てられます。 エンドポイント OCID を取得するには、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingvaults.htm" target="_top">「ボールトの管理」</a>の手順を使用して、<code class="literal">keyring_oci</code> ボールトの構成詳細を表示します。 
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_oci_virtual_vault"></a>
            <code class="literal">keyring_oci_virtual_vault</code>
          </p><a class="indexterm" name="idm46723753341152"></a><a class="indexterm" name="idm46723753339584"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_oci_virtual_vault"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-oci-virtual-vault=ocid</code></td>
</tr><tr><th>導入</th>
<td>8.0.22</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_oci_virtual_vault">keyring_oci_virtual_vault</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_oci</code> プラグインが暗号化操作に使用する Oracle Cloud Infrastructure Vault の OCID。 この変数は、そのプラグインがインストールされないかぎり利用できません。 
          </p><p>
            <code class="literal">keyring_oci</code> を使用する前に、MySQL コンパートメントに新しいボールトが存在しない場合は作成する必要があります。 (または、MySQL コンパートメントの親コンパートメントにある既存のボールトを再利用できます。) コンパートメントユーザーは、それぞれのコンパートメントのキーのみを表示および使用できます。 
          </p><p>
            ボールトの作成およびボールト OCID の取得の詳細は、<a class="ulink" href="https://docs.cloud.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingvaults.htm" target="_top">「ボールトの管理」</a>を参照してください。
          </p><p>
            この変数は必須です。 指定しない場合、<code class="literal">keyring_oci</code> の初期化は失敗します。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_okv_conf_dir"></a>
            <code class="literal">keyring_okv_conf_dir</code>
          </p><a class="indexterm" name="idm46723753309824"></a><a class="indexterm" name="idm46723753308272"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_okv_conf_dir"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--keyring-okv-conf-dir=dir_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_okv_conf_dir">keyring_okv_conf_dir</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ディレクトリ名</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">empty string</code></td>
</tr></tbody></table></div><p>
            <code class="literal">keyring_okv</code> プラグインで使用される構成情報を格納するディレクトリのパス名。 この変数は、そのプラグインがインストールされないかぎり利用できません。 この場所は、<code class="literal">keyring_okv</code> プラグインでのみ使用されるディレクトリである必要があります。 たとえば、データディレクトリの下にディレクトリを配置しないでください。 
          </p><p>
            デフォルトの <code class="literal">keyring_okv_conf_dir</code> 値は空です。 <code class="literal">keyring_okv</code> プラグインが Oracle Key Vault にアクセスできるようにするには、値を Oracle Key Vault 構成および SSL 材料を含むディレクトリに設定する必要があります。 このディレクトリの設定手順は、<a class="xref" href="security.html#keyring-okv-plugin" title="6.4.4.4 keyring_okv KMIP プラグインの使用">セクション6.4.4.4「keyring_okv KMIP プラグインの使用」</a> を参照してください。 
          </p><p>
            ディレクトリには制限モードがあり、MySQL サーバーの実行に使用されるアカウントからのみアクセスできる必要があります。 たとえば、Unix および Unix に似たシステムで<code class="filename">/usr/local/mysql/mysql-keyring-okv</code> ディレクトリを使用するには、次のコマンド (<code class="literal">root</code> として実行) を実行してディレクトリを作成し、そのモードと所有権を設定します: 
          </p><pre class="programlisting">cd /usr/local/mysql
mkdir mysql-keyring-okv
chmod 750 mysql-keyring-okv
chown mysql mysql-keyring-okv
chgrp mysql mysql-keyring-okv
</pre><p>
            <code class="literal">keyring_okv_conf_dir</code> に割り当てられた値で、存在しないディレクトリが指定された場合、または Oracle Key Vault への接続を確立できる構成情報が含まれていない場合、<code class="literal">keyring_okv</code> はエラーメッセージをエラーログに書き込みます。 <code class="literal">keyring_okv_conf_dir</code> への実行時割当てが試行された結果、エラーが発生した場合、変数値およびキーリング操作は変更されません。 
          </p></li><li class="listitem"><p><a name="sysvar_keyring_operations"></a>
            <code class="literal">keyring_operations</code>
          </p><a class="indexterm" name="idm46723753270400"></a><a class="indexterm" name="idm46723753268848"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for keyring_operations"><col style="width=30%"><col style="width=70%"><tbody><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_operations">keyring_operations</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ON</code></td>
</tr></tbody></table></div><p>
            キーリング操作が有効かどうか。 この変数は、キーの移行操作中に使用されます。 <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.9 キーリングキーストア間のキーの移行">セクション6.4.4.9「キーリングキーストア間のキーの移行」</a>を参照してください。 この変数の変更に必要な権限は、<code class="literal">SYSTEM_VARIABLES_ADMIN</code> または非推奨の <code class="literal">SUPER</code> 権限に加えて、<code class="literal">ENCRYPTION_KEY_ADMIN</code> です。 
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="audit-log"></a>6.4.5 MySQL Enterprise Audit</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#audit-log-elements">6.4.5.1 MySQL Enterprise Audit の要素</a></span></dt><dt><span class="section"><a href="security.html#audit-log-installation">6.4.5.2 MySQL Enterprise Audit のインストールまたはアンインストール</a></span></dt><dt><span class="section"><a href="security.html#audit-log-security">6.4.5.3 MySQL Enterprise Audit のセキュリティに関する考慮事項</a></span></dt><dt><span class="section"><a href="security.html#audit-log-file-formats">6.4.5.4 監査ログファイル形式</a></span></dt><dt><span class="section"><a href="security.html#audit-log-logging-configuration">6.4.5.5 監査ロギング特性の構成</a></span></dt><dt><span class="section"><a href="security.html#audit-log-file-reading">6.4.5.6 監査ログファイルの読取り</a></span></dt><dt><span class="section"><a href="security.html#audit-log-filtering">6.4.5.7 監査ログのフィルタリング</a></span></dt><dt><span class="section"><a href="security.html#audit-log-filter-definitions">6.4.5.8 監査ログフィルタ定義の書込み</a></span></dt><dt><span class="section"><a href="security.html#audit-log-legacy-filtering">6.4.5.9 レガシーモード監査ログのフィルタリング</a></span></dt><dt><span class="section"><a href="security.html#audit-log-reference">6.4.5.10 監査ログ参照</a></span></dt><dt><span class="section"><a href="security.html#audit-log-restrictions">6.4.5.11 監査ログの制限</a></span></dt></dl></div><a class="indexterm" name="idm46723753243360"></a><a class="indexterm" name="idm46723753241856"></a><a class="indexterm" name="idm46723753240192"></a><a class="indexterm" name="idm46723753239104"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        MySQL Enterprise Audit は、商用製品である MySQL Enterprise Edition に含まれる拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
      </p></div><p>
      MySQL Enterprise Edition には、<code class="literal">audit_log</code> というサーバープラグインを使用して実装された MySQL Enterprise Audit が含まれています。MySQL Enterprise Audit では、オープン MySQL 監査 API を使用して、特定の MySQL サーバーで実行される接続およびクエリーアクティビティの標準、ポリシーベースの監視、ロギングおよびブロックを有効にします。 MySQL Enterprise Audit は、Oracle 監査仕様を満たすように設計されており、内部および外部の規制ガイドラインによって管理されるアプリケーションに対して、すぐに使用できる監査およびコンプライアンスソリューションを提供します。 
    </p><p>
      インストール時に監査プラグインを使用すると、MySQL サーバーはサーバーアクティビティーの監査レコードを含むログファイルを生成できます。 ログの内容には、クライアントが接続および切断した時間、接続中に実行したアクション (アクセスしたデータベースおよびテーブルなど) が含まれます。 
    </p><p>
      監査プラグインをインストールすると (<a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 MySQL Enterprise Audit のインストールまたはアンインストール">セクション6.4.5.2「MySQL Enterprise Audit のインストールまたはアンインストール」</a> を参照)、監査ログファイルが書き込まれます。 デフォルトでは、そのファイルはサーバーのデータディレクトリ内の <code class="filename">audit.log</code> という名前です。 ファイルの名前を変更するには、サーバーの起動時に <code class="literal">audit_log_file</code> システム変数を設定します。 
    </p><p>
      デフォルトでは、監査ログファイルの内容は、圧縮や暗号化を行わずに新しい形式の XML 形式で書き込まれます。 ファイル形式を選択するには、サーバーの起動時に <code class="literal">audit_log_format</code> システム変数を設定します。 ファイルの形式および内容についての詳細は、<a class="xref" href="security.html#audit-log-file-formats" title="6.4.5.4 監査ログファイル形式">セクション6.4.5.4「監査ログファイル形式」</a>を参照してください。 
    </p><p>
      監査ログファイルの名前や形式の選択など、ロギングの実行方法の制御の詳細は、<a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a> を参照してください。 監査イベントのフィルタリングを実行するには、<a class="xref" href="security.html#audit-log-filtering" title="6.4.5.7 監査ログのフィルタリング">セクション6.4.5.7「監査ログのフィルタリング」</a> を参照してください。 監査ログプラグインを構成する際に使用されるパラメータについては、<a class="xref" href="security.html#audit-log-options-variables" title="監査ログのオプションおよび変数">監査ログのオプションおよび変数</a>を参照してください。 
    </p><p>
      監査ログプラグインが有効になっている場合、パフォーマンススキーマ (<a class="xref" href="performance-schema.html" title="第 27 章 MySQL パフォーマンススキーマ">第27章「<i>MySQL パフォーマンススキーマ</i>」</a> を参照) にはそのインストゥルメンテーションがあります。 関連するインストゥルメントを識別するには、次のクエリーを使用します。 
    </p><pre class="programlisting">SELECT NAME FROM performance_schema.setup_instruments
WHERE NAME LIKE '%/alog/%';
</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-elements"></a>6.4.5.1 MySQL Enterprise Audit の要素</h4></div></div></div><p>
        MySQL Enterprise Audit は、監査ログプラグインおよび関連する要素に基づいています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log</code> という名前のサーバー側プラグインは、監査可能なイベントを調べ、それらを監査ログに書き込むかどうかを決定します。
          </p></li><li class="listitem"><p>
            ユーザー定義関数を使用すると、ロギング動作、暗号化パスワードおよびログファイルの読取りを制御するフィルタリング定義を操作できます。
          </p></li><li class="listitem"><p>
            <code class="literal">mysql</code> システムデータベースのテーブルは、フィルタおよびユーザーアカウントデータの永続的な記憶域を提供します。
          </p></li><li class="listitem"><p>
            システム変数を使用すると、監査ログの構成が可能になり、ステータス変数を使用すると実行時の操作情報が提供されます。
          </p></li><li class="listitem"><p>
            <code class="literal">AUDIT_ADMIN</code> 権限を使用すると、ユーザーは監査ログを管理できます。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-installation"></a>6.4.5.2 MySQL Enterprise Audit のインストールまたはアンインストール</h4></div></div></div><a class="indexterm" name="idm46723753207344"></a><a class="indexterm" name="idm46723753205184"></a><p>
        このセクションでは、<a class="xref" href="security.html#audit-log-elements" title="6.4.5.1 MySQL Enterprise Audit の要素">セクション6.4.5.1「MySQL Enterprise Audit の要素」</a> で説明されている監査ログプラグインおよび関連要素を使用して実装される MySQL Enterprise Audit をインストールまたはアンインストールする方法について説明します。 プラグインのインストールについての一般的な情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>を参照してください。 
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          指示に従う前に、このセクション全体をお読みください。 手順の一部は、環境によって異なります。 
        </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          インストールされている場合、<code class="literal">audit_log</code> プラグインは、無効になっていても最小限のオーバーヘッドを伴います。 このオーバーヘッドを回避するには、使用する予定がないかぎり、MySQL Enterprise Audit をインストールしないでください。 
        </p></div><p>
        サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
      </p><p>
        MySQL Enterprise Audit をインストールするには、MySQL インストールの <code class="filename">share</code> ディレクトリを検索し、ご使用のプラットフォームに適したスクリプトを選択します。 使用可能なスクリプトは、プラグインライブラリファイルの参照に使用される接尾辞とは異なります: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename">audit_log_filter_win_install.sql</code>: ファイル名の接尾辞として <code class="filename">.dll</code> を使用する Windows システムの場合は、このスクリプトを選択します。
          </p></li><li class="listitem"><p>
            <code class="filename">audit_log_filter_linux_install.sql</code>: Linux および <code class="filename">.so</code> をファイル名接尾辞として使用する類似システムの場合は、このスクリプトを選択します。
          </p></li></ul></div><p>
        次のようにスクリプトを実行します。 この例では、Linux インストールスクリプトを使用します。 システムに適切な置換を行います。 
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u root -p &lt; audit_log_filter_linux_install.sql</code></strong>
Enter password: <em class="replaceable"><code>(enter root password here)</code></em>
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          一部の MySQL バージョンでは、MySQL Enterprise Audit テーブルの構造が変更されています。 以前のバージョンの MySQL 8.0 からのアップグレードでテーブルが最新であることを確認するには、MySQL のアップグレード手順を実行し、更新を強制するオプションを使用してください (<a class="xref" href="installing.html#upgrading" title="2.11 MySQL のアップグレード">セクション2.11「MySQL のアップグレード」</a> を参照)。 MySQL Enterprise Audit テーブルに対してのみ UPDATE ステートメントを実行する場合は、次の説明を参照してください。 
        </p><p>
          MySQL 8.0.12 以降、新規 MySQL インストールでは、MySQL Enterprise Audit により使用される <code class="literal">audit_log_user</code> テーブルの <code class="literal">USER</code> および <code class="literal">HOST</code> カラムは、<code class="literal">mysql.user</code> システムテーブルの <code class="literal">User</code> および <code class="literal">Host</code> カラムの定義によりよく対応する定義を持ちます。 MySQL Enterprise Audit がすでにインストールされているインストールにアップグレードする場合は、次のようにテーブル定義を変更することをお薦めします: 
        </p><pre class="programlisting">ALTER TABLE mysql.audit_log_user
  DROP FOREIGN KEY audit_log_user_ibfk_1;
ALTER TABLE mysql.audit_log_filter
  CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_as_ci;
ALTER TABLE mysql.audit_log_user
  CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_as_ci;
ALTER TABLE mysql.audit_log_user
  MODIFY COLUMN USER VARCHAR(32);
ALTER TABLE mysql.audit_log_user
  ADD FOREIGN KEY (FILTERNAME) REFERENCES mysql.audit_log_filter(NAME);
</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          ソース/レプリカレプリケーション、グループレプリケーションまたは InnoDB クラスタ のコンテキストで MySQL Enterprise Audit を使用するには、ソースノードでインストールスクリプトを実行する前にレプリカノードを準備する必要があります。 これは、スクリプト内の <code class="literal">INSTALL PLUGIN</code> ステートメントがレプリケートされないために必要です。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              各レプリカノードで、インストールスクリプトから <code class="literal">INSTALL PLUGIN</code> ステートメントを抽出し、手動で実行します。
            </p></li><li class="listitem"><p>
              ソースノードで、前述のようにインストールスクリプトを実行します。
            </p></li></ol></div></div><p>
        プラグインのインストールを確認するには、<code class="literal">INFORMATION_SCHEMA.PLUGINS</code> テーブルを調べるか、<code class="literal">SHOW PLUGINS</code> ステートメントを使用します (<a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 サーバープラグイン情報の取得">セクション5.6.2「サーバープラグイン情報の取得」</a> を参照)。 例: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'audit%';</code></strong>
+-------------+---------------+
| PLUGIN_NAME | PLUGIN_STATUS |
+-------------+---------------+
| audit_log   | ACTIVE        |
+-------------+---------------+
</pre><p>
        プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
      </p><p>
        MySQL Enterprise Audit のインストール後、<code class="option">--audit-log</code> オプションを使用して、後続のサーバー起動で <code class="literal">audit_log</code> プラグインのアクティブ化を制御できます。 たとえば、プラグインが実行時に削除されないようにするには、このオプションを使用します: 
      </p><pre class="programlisting">[mysqld]
audit-log=FORCE_PLUS_PERMANENT
</pre><p>
        監査プラグインを使用せずにサーバーが実行されることを回避する必要がある場合は、<code class="literal">FORCE</code> または <code class="literal">FORCE_PLUS_PERMANENT</code> の値とともに <code class="option">--audit-log</code> を使用して、プラグインが正常に初期化されない場合にサーバーの起動を強制的に失敗させます。
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          デフォルトでは、ルールベースの監査ログのフィルタリングでは、ユーザーの監査可能なイベントは記録されません。 これは、すべてのユーザーのすべての監査可能イベントを記録するレガシー監査ログの動作とは異なります (<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a> を参照)。 ルールベースのフィルタリングを使用してログ詳細動作を生成する場合は、ロギングを有効にする単純なフィルタを作成し、それをデフォルトアカウントに割り当てます: 
        </p><pre class="programlisting">SELECT audit_log_filter_set_filter('log_all', '{ "filter": { "log": true } }');
SELECT audit_log_filter_set_user('%', 'log_all');
</pre><p>
          <code class="literal">%</code> に割り当てられたフィルタは、フィルタが明示的に割り当てられていないアカウントからの接続に使用されます (最初はすべてのアカウントに適用されます)。
        </p></div><p>
        前述のようにインストールすると、MySQL Enterprise Audit はアンインストールされるまでインストールされたままになります。 削除するには、次のステートメントを実行します: 
      </p><pre class="programlisting">DROP TABLE IF EXISTS mysql.audit_log_user;
DROP TABLE IF EXISTS mysql.audit_log_filter;
UNINSTALL PLUGIN audit_log;
DROP FUNCTION audit_log_filter_set_filter;
DROP FUNCTION audit_log_filter_remove_filter;
DROP FUNCTION audit_log_filter_set_user;
DROP FUNCTION audit_log_filter_remove_user;
DROP FUNCTION audit_log_filter_flush;
DROP FUNCTION audit_log_encryption_password_get;
DROP FUNCTION audit_log_encryption_password_set;
DROP FUNCTION audit_log_read;
DROP FUNCTION audit_log_read_bookmark;
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-security"></a>6.4.5.3 MySQL Enterprise Audit のセキュリティに関する考慮事項</h4></div></div></div><p>
        デフォルトでは、監査ログプラグインによって生成される監査ログファイルの内容は暗号化されず、SQL ステートメントのテキストなどの機密情報が含まれることがあります。 セキュリティ上の理由から、監査ログファイルは、MySQL サーバーおよびログを表示する正当な理由を持つユーザーのみがアクセスできるディレクトリに書き込む必要があります。 デフォルトのファイル名は、データディレクトリ内の <code class="filename">audit.log</code> です。 これは、サーバーの起動時に <code class="literal">audit_log_file</code> システム変数を設定することで変更できます。 ログローテーションが原因で、他の監査ログファイルが存在する可能性があります。 
      </p><p>
        セキュリティを強化するには、監査ログファイルの暗号化を有効にします。 <a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a>を参照してください。 
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-file-formats"></a>6.4.5.4 監査ログファイル形式</h4></div></div></div><p>
        MySQL サーバーは、監査可能なイベントが発生するたびに、監査ログプラグインを呼び出して監査レコードをそのログファイルに書き込みます。 通常、プラグインの起動後に書き込まれる最初の監査レコードには、サーバーの説明と起動オプションが含まれます。 そのあとの要素は、クライアントの接続および切断イベント、SQL ステートメントの実行などのイベントを表します。 最上位のステートメントのみのログが記録され、トリガーやストアドプロシージャーなどのストアドプログラム内のステートメントのログは記録されません。 <code class="literal">LOAD DATA</code> などのステートメントで参照されるファイルの内容は記録されません。 
      </p><p>
        監査ログプラグインがログファイルの書き込みに使用するログ形式を選択するには、サーバーの起動時に <code class="literal">audit_log_format</code> システム変数を設定します。 次の形式を使用できます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            新しいスタイルの XML 形式 (<code class="literal">audit_log_format=NEW</code>): 古い形式の XML 形式よりも Oracle Audit Vault との互換性が高いXML形式。 MySQL 8.0 では、デフォルトで新しいスタイルの XML 形式が使用されます。 
          </p></li><li class="listitem"><p>
            「古いスタイルの XML」形式 (<code class="literal">audit_log_format=OLD</code>): 古い MySQL シリーズでデフォルトで使用される元の監査ログ形式。
          </p></li><li class="listitem"><p>
            JSON 形式 (<code class="literal">audit_log_format=JSON</code>)
          </p></li></ul></div><p>
        デフォルトでは、監査ログファイルの内容は、圧縮や暗号化を行わずに新しい形式の XML 形式で書き込まれます。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          ログ形式を変更する際に考慮する問題の詳細は、<a class="xref" href="security.html#audit-log-file-format" title="監査ログファイル形式の選択">監査ログファイル形式の選択</a> を参照してください。
        </p></div><p>
        次の各セクションでは、使用可能な監査ロギング形式について説明します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-new-style-xml-format" title="新規スタイルの XML 監査ログファイル形式">新規スタイルの XML 監査ログファイル形式</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-old-style-xml-format" title="古い形式の XML 監査ログファイル形式">古い形式の XML 監査ログファイル形式</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-json-format" title="JSON 監査ログファイル形式">JSON 監査ログファイル形式</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-new-style-xml-format"></a>新規スタイルの XML 監査ログファイル形式</h5></div></div></div><p>
          次に、読みやすくするために若干再フォーマットされた新しい形式の XML 形式 (<code class="literal">audit_log_format=NEW</code>) のサンプルログファイルを示します:
        </p><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;AUDIT&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2019-10-03T14:06:33 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;1_2019-10-03T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Audit&lt;/NAME&gt;
  &lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
  &lt;VERSION&gt;1&lt;/VERSION&gt;
  &lt;STARTUP_OPTIONS&gt;/usr/local/mysql/bin/mysqld
    --socket=/usr/local/mysql/mysql.sock
    --port=3306&lt;/STARTUP_OPTIONS&gt;
  &lt;OS_VERSION&gt;i686-Linux&lt;/OS_VERSION&gt;
  &lt;MYSQL_VERSION&gt;5.7.21-log&lt;/MYSQL_VERSION&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2019-10-03T14:09:38 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;2_2019-10-03T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Connect&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;5&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root&lt;/USER&gt;
  &lt;OS_LOGIN/&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
  &lt;CONNECTION_TYPE&gt;SSL/TLS&lt;/CONNECTION_TYPE&gt;
  &lt;CONNECTION_ATTRIBUTES&gt;
   &lt;ATTRIBUTE&gt;
    &lt;NAME&gt;_pid&lt;/NAME&gt;
    &lt;VALUE&gt;42794&lt;/VALUE&gt;
   &lt;/ATTRIBUTE&gt;
   ...
   &lt;ATTRIBUTE&gt;
    &lt;NAME&gt;program_name&lt;/NAME&gt;
    &lt;VALUE&gt;mysqladmin&lt;/VALUE&gt;
   &lt;/ATTRIBUTE&gt;
  &lt;/CONNECTION_ATTRIBUTES&gt;
  &lt;PRIV_USER&gt;root&lt;/PRIV_USER&gt;
  &lt;PROXY_USER/&gt;
  &lt;DB&gt;test&lt;/DB&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2019-10-03T14:09:38 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;6_2019-10-03T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Query&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;5&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
  &lt;OS_LOGIN/&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;drop_table&lt;/COMMAND_CLASS&gt;
  &lt;SQLTEXT&gt;DROP TABLE IF EXISTS t&lt;/SQLTEXT&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2019-10-03T14:09:39 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;8_2019-10-03T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Quit&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;5&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root&lt;/USER&gt;
  &lt;OS_LOGIN/&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
  &lt;CONNECTION_TYPE&gt;SSL/TLS&lt;/CONNECTION_TYPE&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2019-10-03T14:09:43 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;11_2019-10-03T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Quit&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;6&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root&lt;/USER&gt;
  &lt;OS_LOGIN/&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
  &lt;CONNECTION_TYPE&gt;SSL/TLS&lt;/CONNECTION_TYPE&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2019-10-03T14:09:45 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;12_2019-10-03T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;NoAudit&lt;/NAME&gt;
  &lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
 &lt;/AUDIT_RECORD&gt;
&lt;/AUDIT&gt;
</pre><p>
          監査ログファイルは、UTF-8 (1 文字当たり最大 4 バイト) を使用した XML として記述されています。 ルート要素は、<code class="literal">&lt;AUDIT&gt;</code> です。 ルート要素には、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素が含まれています。この要素のそれぞれは、監査対象のイベントに関する情報を提供します。 監査ログプラグインは、新しいログファイルの書き込みを開始すると、XML 宣言と開始 <code class="literal">&lt;AUDIT&gt;</code> ルート要素タグを書き込みます。 プラグインは、ログファイルを閉じると、終了 <code class="literal">&lt;/AUDIT&gt;</code> ルート要素タグを書き込みます。 ファイルが開いている間は、終了タグは存在しません。 
        </p><p>
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素内の要素には、次の特性があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              一部の要素はすべての <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素に表示されます。 その他はオプションで、監査レコードタイプに応じて表示される場合があります。 
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素内の要素の順序は保証されません。
            </p></li><li class="listitem"><p>
              要素値が固定長ではありません。 長い値は、後で説明する要素の説明に従って切り捨てられる場合があります。 
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;</code>、<code class="literal">&gt;</code>、<code class="literal">"</code>、および <code class="literal">&amp;</code> 文字は、それぞれ <code class="literal">&amp;lt;</code>、<code class="literal">&amp;gt;</code>、<code class="literal">&amp;quot;</code>、および <code class="literal">&amp;amp;</code> としてエンコードされます。 NUL バイト (U+00) は、<code class="literal">?</code> 文字としてエンコードされます。 
            </p></li><li class="listitem"><p>
              XML 文字として有効でない文字は、数値の文字参照を使用してエンコードされます。 有効な XML 文字は次のとおりです。 
            </p><pre class="programlisting">#x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]
</pre></li></ul></div><p>
          次の要素は、すべての <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素で必須です。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">&lt;NAME&gt;</code>
            </p><p>
              監査イベントを生成した命令 (サーバーがクライアントから受信したコマンドなど) のタイプを表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;NAME&gt;Query&lt;/NAME&gt;
</pre><p>
              一部の一般的な <code class="literal">&lt;NAME&gt;</code> 値:
            </p><pre class="programlisting">Audit    When auditing starts, which may be server startup time
Connect  When a client connects, also known as logging in
Query    An SQL statement (executed directly)
Prepare  Preparation of an SQL statement; usually followed by Execute
Execute  Execution of an SQL statement; usually follows Prepare
Shutdown Server shutdown
Quit     When a client disconnects
NoAudit  Auditing has been turned off
</pre><p>
              使用可能な値は <code class="literal">Audit</code>, <code class="literal">Binlog Dump</code>, <code class="literal">Change user</code>, <code class="literal">Close stmt</code>, <code class="literal">Connect Out</code>, <code class="literal">Connect</code>, <code class="literal">Create DB</code>, <code class="literal">Daemon</code>, <code class="literal">Debug</code>, <code class="literal">Delayed insert</code>, <code class="literal">Drop DB</code>, <code class="literal">Execute</code>, <code class="literal">Fetch</code>, <code class="literal">Field List</code>, <code class="literal">Init DB</code>, <code class="literal">Kill</code>, <code class="literal">Long Data</code>, <code class="literal">NoAudit</code>, <code class="literal">Ping</code>, <code class="literal">Prepare</code>, <code class="literal">Processlist</code>, <code class="literal">Query</code>, <code class="literal">Quit</code>, <code class="literal">Refresh</code>, <code class="literal">Register Slave</code>, <code class="literal">Reset stmt</code>, <code class="literal">Set option</code>, <code class="literal">Shutdown</code>, <code class="literal">Sleep</code>, <code class="literal">Statistics</code>, <code class="literal">Table Dump</code>, <code class="literal">TableDelete</code>, <code class="literal">TableInsert</code>, <code class="literal">TableRead</code>, <code class="literal">TableUpdate</code>, <code class="literal">Time</code> です。
            </p><p>
              これらの値の多くは、<code class="filename">my_command.h</code> ヘッダーファイルにリストされている <code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code> コマンド値に対応しています。 たとえば、<code class="literal">Create DB</code> および <code class="literal">Change user</code> は、それぞれ <code class="literal">COM_CREATE_DB</code> および <code class="literal">COM_CHANGE_USER</code> に対応します。 
            </p><p>
              <code class="literal">Table<em class="replaceable"><code>XXX</code></em></code> の <code class="literal">&lt;NAME&gt;</code> 値を持つイベントには、<code class="literal">Query</code> イベントが付随します。 たとえば、次のステートメントは、1 つの <code class="literal">Query</code> イベント、2 つの <code class="literal">TableRead</code> イベントおよび <code class="literal">TableInsert</code> イベントを生成します: 
            </p><pre class="programlisting">INSERT INTO t3 SELECT t1.* FROM t1 JOIN t2;
</pre><p>
              各 <code class="literal">Table<em class="replaceable"><code>XXX</code></em></code> イベントには、イベントが参照するテーブルを識別する <code class="literal">&lt;DB&gt;</code> および <code class="literal">&lt;TABLE&gt;</code> 要素が含まれます。
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;RECORD_ID&gt;</code>
            </p><p>
              監査レコードを表す一意の識別子。 この値はシーケンス番号とタイムスタンプで構成され、形式は <code class="literal"><em class="replaceable"><code>SEQ_TIMESTAMP</code></em></code> です。 監査ログプラグインが監査ログファイルを開くと、順序番号が監査ログファイルのサイズに初期化され、記録されるレコードごとに順序が 1 ずつ増分されます。 タイムスタンプは、監査ログプラグインがファイルを開いた日時を示す <code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code> 形式の UTC 値です。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;RECORD_ID&gt;12_2019-10-03T14:06:33&lt;/RECORD_ID&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;TIMESTAMP&gt;</code>
            </p><p>
              監査イベントが生成された日時を示す <code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em> UTC</code> 形式の UTC 値を表す文字列。 たとえば、クライアントから受信した SQL ステートメントの実行に対応するイベントの <code class="literal">&lt;TIMESTAMP&gt;</code> 値は、受信時ではなく、ステートメントの終了後に発生します。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;TIMESTAMP&gt;2019-10-03T14:09:45 UTC&lt;/TIMESTAMP&gt;
</pre></li></ul></div><p>
          次の要素は、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素ではオプションです。 これらの多くは、特定の <code class="literal">&lt;NAME&gt;</code> 要素値でのみ発生します。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">&lt;COMMAND_CLASS&gt;</code>
            </p><p>
              実行されたアクションのタイプを示す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;COMMAND_CLASS&gt;drop_table&lt;/COMMAND_CLASS&gt;
</pre><p>
              値は <code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code> コマンドカウンタに対応しています。 たとえば、<em class="replaceable"><code>xxx</code></em> は、<code class="literal">DROP TABLE</code> および <code class="literal">SELECT</code> ステートメントのそれぞれ <code class="literal">drop_table</code> および <code class="literal">select</code> です。 次のステートメントは、使用可能な名前を表示します: 
            </p><pre class="programlisting">SELECT REPLACE(EVENT_NAME, 'statement/sql/', '') AS name
FROM performance_schema.events_statements_summary_global_by_event_name
WHERE EVENT_NAME LIKE 'statement/sql/%'
ORDER BY name;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;CONNECTION_ATTRIBUTES&gt;</code>
            </p><p>
              MySQL 8.0.19 では、<code class="literal">&lt;COMMAND_CLASS&gt;</code> 値が <code class="literal">connect</code> のイベントに <code class="literal">&lt;CONNECTION_ATTRIBUTES&gt;</code> 要素が含まれ、接続時にクライアントによって渡される接続属性が表示される場合があります。 (「パフォーマンススキーマ」テーブルでも公開されるこれらの属性の詳細は、<a class="xref" href="performance-schema.html#performance-schema-connection-attribute-tables" title="27.12.9 パフォーマンススキーマ接続属性テーブル">セクション27.12.9「パフォーマンススキーマ接続属性テーブル」</a> を参照してください。) 
            </p><p>
              <code class="literal">&lt;CONNECTION_ATTRIBUTES&gt;</code> 要素には属性ごとに 1 つの <code class="literal">&lt;ATTRIBUTE&gt;</code> 要素が含まれ、それぞれに属性名と値を示す <code class="literal">&lt;NAME&gt;</code> 要素と <code class="literal">&lt;VALUE&gt;</code> 要素が含まれます。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;CONNECTION_ATTRIBUTES&gt;
 &lt;ATTRIBUTE&gt;
  &lt;NAME&gt;_pid&lt;/NAME&gt;
  &lt;VALUE&gt;42794&lt;/VALUE&gt;
 &lt;/ATTRIBUTE&gt;
 &lt;ATTRIBUTE&gt;
  &lt;NAME&gt;_os&lt;/NAME&gt;
  &lt;VALUE&gt;macos10.14&lt;/VALUE&gt;
 &lt;/ATTRIBUTE&gt;
 &lt;ATTRIBUTE&gt;
  &lt;NAME&gt;_platform&lt;/NAME&gt;
  &lt;VALUE&gt;x86_64&lt;/VALUE&gt;
 &lt;/ATTRIBUTE&gt;
 &lt;ATTRIBUTE&gt;
  &lt;NAME&gt;_client_version&lt;/NAME&gt;
  &lt;VALUE&gt;8.0.19&lt;/VALUE&gt;
 &lt;/ATTRIBUTE&gt;
 &lt;ATTRIBUTE&gt;
  &lt;NAME&gt;_client_name&lt;/NAME&gt;
  &lt;VALUE&gt;libmysql&lt;/VALUE&gt;
 &lt;/ATTRIBUTE&gt;
 &lt;ATTRIBUTE&gt;
  &lt;NAME&gt;program_name&lt;/NAME&gt;
  &lt;VALUE&gt;mysqladmin&lt;/VALUE&gt;
 &lt;/ATTRIBUTE&gt;
&lt;/CONNECTION_ATTRIBUTES&gt;
</pre><p>
              イベントに接続属性が存在しない場合、何も記録されず、<code class="literal">&lt;CONNECTION_ATTRIBUTES&gt;</code> 要素は表示されません。 これは、接続試行が成功しなかった場合、クライアントが属性を渡さなかった場合、またはサーバーの起動時やプラグインによって開始されたときなどに接続が内部的に発生した場合に発生することがあります。 
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;CONNECTION_ID&gt;</code>
            </p><p>
              クライアント接続識別子を表す符号なし整数。 これは、セッション内の <code class="literal">CONNECTION_ID()</code> 関数によって戻される値と同じです。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;CONNECTION_ID&gt;127&lt;/CONNECTION_ID&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;CONNECTION_TYPE&gt;</code>
            </p><p>
              サーバーへの接続のセキュリティ状態。 許可される値は、<code class="literal">TCP/IP</code> (暗号化なしで確立された TCP/IP 接続)、<code class="literal">SSL/TLS</code> (暗号化で確立された TCP/IP 接続)、<code class="literal">Socket</code> (Unix ソケットファイル接続)、<code class="literal">Named Pipe</code> (Windows 名前付きパイプ接続) および <code class="literal">Shared Memory</code> (Windows 共有メモリー接続) です。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;CONNECTION_TYPE&gt;SSL/TLS&lt;/CONNECTION_TYPE&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;DB&gt;</code>
            </p><p>
              デフォルトのデータベース名を表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;DB&gt;test&lt;/DB&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;HOST&gt;</code>
            </p><p>
              クライアントのホスト名を表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;HOST&gt;localhost&lt;/HOST&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;IP&gt;</code>
            </p><p>
              クライアントの IP アドレスを表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;IP&gt;127.0.0.1&lt;/IP&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;MYSQL_VERSION&gt;</code>
            </p><p>
              MySQL サーバーのバージョンを表す文字列。 これは、セッション内の <code class="literal">VERSION()</code> 関数または <code class="literal">version</code> システム変数の値と同じです。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;MYSQL_VERSION&gt;5.7.21-log&lt;/MYSQL_VERSION&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;OS_LOGIN&gt;</code>
            </p><p>
              認証プロセス中に使用される外部ユーザー名を表す文字列。クライアントの認証に使用されるプラグインによって設定されます。 ネイティブ (組込み) MySQL 認証の場合、またはプラグインで値が設定されていない場合、この要素は空です。 この値は、<code class="literal">external_user</code> システム変数の値と同じです (<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照)。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;OS_LOGIN&gt;jeffrey&lt;/OS_LOGIN&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;OS_VERSION&gt;</code>
            </p><p>
              サーバーが構築された、または実行されているオペレーティングシステムを表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;OS_VERSION&gt;x86_64-Linux&lt;/OS_VERSION&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;PRIV_USER&gt;</code>
            </p><p>
              サーバーがクライアントを認証する際に使用したユーザーを表す文字列。 これは、サーバーが権限チェックを行う際に使用するユーザー名であり、<code class="literal">&lt;USER&gt;</code> の値とは異なる可能性があります。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;PRIV_USER&gt;jeffrey&lt;/PRIV_USER&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;PROXY_USER&gt;</code>
            </p><p>
              プロキシユーザーを表す文字列 (<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照)。 ユーザーのプロキシ処理が有効になっていない場合は、値が空です。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;PROXY_USER&gt;developer&lt;/PROXY_USER&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;SERVER_ID&gt;</code>
            </p><p>
              サーバー ID を表す符号なし整数。 これは、<code class="literal">server_id</code> システム変数の値と同じです。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;SQLTEXT&gt;</code>
            </p><p>
              SQL ステートメントのテキストを表す文字列。 この値は、空にすることができます。 長い値は、切り捨てられる可能性があります。 監査ログファイル自体などの文字列は、UTF-8 (1 文字当たり最大 4 バイト) を使用して記述されるため、この値が変換の結果となる場合があります。 たとえば、元のステートメントは、SJIS 文字列としてクライアントから受信された可能性があります。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;SQLTEXT&gt;DELETE FROM t1&lt;/SQLTEXT&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;STARTUP_OPTIONS&gt;</code>
            </p><p>
              MySQL サーバーの起動時に、コマンド行またはオプションファイルで指定されたオプションを表す文字列。 最初のオプションは、サーバー実行可能ファイルへのパスです。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;STARTUP_OPTIONS&gt;/usr/local/mysql/bin/mysqld
  --port=3306 --log_output=FILE&lt;/STARTUP_OPTIONS&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;STATUS&gt;</code>
            </p><p>
              コマンドのステータスを表す符号なし整数 (成功した場合は 0、エラーが発生した場合はゼロ以外)。 これは、<code class="literal">mysql_errno()</code> C API 関数の値と同じです。 <code class="literal">&lt;STATUS&gt;</code> と異なる点については、<code class="literal">&lt;STATUS_CODE&gt;</code> の説明を参照してください。 
            </p><p>
              監査ログには、SQLSTATE 値またはエラーメッセージが含まれていません。 エラーコード、SQLSTATE 値、およびメッセージ間の関連性を確認する方法については、<a class="ulink" href="https://dev.mysql.com/doc/mysql-errors/8.0/en/server-error-reference.html" target="_top">Server Error Message Reference</a>を参照してください。 
            </p><p>
              警告のログは記録されません。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;STATUS&gt;1051&lt;/STATUS&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;STATUS_CODE&gt;</code>
            </p><p>
              コマンドのステータスを表す符号なし整数 (成功した場合は 0、エラーが発生した場合は 1)。
            </p><p>
              <code class="literal">STATUS_CODE</code> の値は、<code class="literal">STATUS</code> の値とは異なります。<code class="literal">STATUS_CODE</code> は、成功した場合は 0、エラーが発生した場合は 1 であり、Audit Vault の EZ_collector コンシューマとの互換性があります。 <code class="literal">STATUS</code> は、<code class="literal">mysql_errno()</code> C API 関数の値です。 これは、成功した場合は 0、エラーが発生した場合はゼロ以外です。そのため、エラーが発生した場合、必ずしも 1 であるとはかぎりません。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;TABLE&gt;</code>
            </p><p>
              テーブル名を表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;TABLE&gt;t3&lt;/TABLE&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;USER&gt;</code>
            </p><p>
              クライアントによって送信されたユーザー名を表す文字列。 これは、<code class="literal">&lt;PRIV_USER&gt;</code> の値とは異なる可能性があります。 
            </p><p>
              例:
            </p><pre class="programlisting">&lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;VERSION&gt;</code>
            </p><p>
              監査ログファイル形式のバージョンを表す符号なし整数。
            </p><p>
              例:
            </p><pre class="programlisting">&lt;VERSION&gt;1&lt;/VERSION&gt;
</pre></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-old-style-xml-format"></a>古い形式の XML 監査ログファイル形式</h5></div></div></div><p>
          次に、読みやすくするために若干再フォーマットされた古い形式の XML 形式 (<code class="literal">audit_log_format=OLD</code>) のサンプルログファイルを示します:
        </p><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;AUDIT&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2019-10-03T14:25:00 UTC"
    RECORD_ID="1_2019-10-03T14:25:00"
    NAME="Audit"
    SERVER_ID="1"
    VERSION="1"
    STARTUP_OPTIONS="--port=3306"
    OS_VERSION="i686-Linux"
    MYSQL_VERSION="5.7.21-log"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2019-10-03T14:25:24 UTC"
    RECORD_ID="2_2019-10-03T14:25:00"
    NAME="Connect"
    CONNECTION_ID="4"
    STATUS="0"
    STATUS_CODE="0"
    USER="root"
    OS_LOGIN=""
    HOST="localhost"
    IP="127.0.0.1"
    COMMAND_CLASS="connect"
    CONNECTION_TYPE="SSL/TLS"
    PRIV_USER="root"
    PROXY_USER=""
    DB="test"/&gt;

...

  &lt;AUDIT_RECORD
    TIMESTAMP="2019-10-03T14:25:24 UTC"
    RECORD_ID="6_2019-10-03T14:25:00"
    NAME="Query"
    CONNECTION_ID="4"
    STATUS="0"
    STATUS_CODE="0"
    USER="root[root] @ localhost [127.0.0.1]"
    OS_LOGIN=""
    HOST="localhost"
    IP="127.0.0.1"
    COMMAND_CLASS="drop_table"
    SQLTEXT="DROP TABLE IF EXISTS t"/&gt;

...

  &lt;AUDIT_RECORD
    TIMESTAMP="2019-10-03T14:25:24 UTC"
    RECORD_ID="8_2019-10-03T14:25:00"
    NAME="Quit"
    CONNECTION_ID="4"
    STATUS="0"
    STATUS_CODE="0"
    USER="root"
    OS_LOGIN=""
    HOST="localhost"
    IP="127.0.0.1"
    COMMAND_CLASS="connect"
    CONNECTION_TYPE="SSL/TLS"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2019-10-03T14:25:32 UTC"
    RECORD_ID="12_2019-10-03T14:25:00"
    NAME="NoAudit"
    SERVER_ID="1"/&gt;
&lt;/AUDIT&gt;
</pre><p>
          監査ログファイルは、UTF-8 (1 文字当たり最大 4 バイト) を使用した XML として記述されています。 ルート要素は、<code class="literal">&lt;AUDIT&gt;</code> です。 ルート要素には、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素が含まれています。この要素のそれぞれは、監査対象のイベントに関する情報を提供します。 監査ログプラグインは、新しいログファイルの書き込みを開始すると、XML 宣言と開始 <code class="literal">&lt;AUDIT&gt;</code> ルート要素タグを書き込みます。 プラグインは、ログファイルを閉じると、終了 <code class="literal">&lt;/AUDIT&gt;</code> ルート要素タグを書き込みます。 ファイルが開いている間は、終了タグは存在しません。 
        </p><p>
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素の属性には、次のような特性があります。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              一部の属性はすべての <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素に表示されます。 その他はオプションで、監査レコードタイプに応じて表示される場合があります。 
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素内の属性の順序は保証されません。
            </p></li><li class="listitem"><p>
              属性値は固定長ではありません。 あとで属性の説明で示すように、長い値は切り捨てられる可能性があります。 
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;</code>、<code class="literal">&gt;</code>、<code class="literal">"</code>、および <code class="literal">&amp;</code> 文字は、それぞれ <code class="literal">&amp;lt;</code>、<code class="literal">&amp;gt;</code>、<code class="literal">&amp;quot;</code>、および <code class="literal">&amp;amp;</code> としてエンコードされます。 NUL バイト (U+00) は、<code class="literal">?</code> 文字としてエンコードされます。 
            </p></li><li class="listitem"><p>
              XML 文字として有効でない文字は、数値の文字参照を使用してエンコードされます。 有効な XML 文字は次のとおりです。 
            </p><pre class="programlisting">#x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]
</pre></li></ul></div><p>
          次の属性は、すべての <code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素で必須です。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NAME</code>
            </p><p>
              監査イベントを生成した命令 (サーバーがクライアントから受信したコマンドなど) のタイプを表す文字列。
            </p><p>
              例: <code class="literal">NAME="Query"</code>
            </p><p>
              一部の一般的な <code class="literal">NAME</code> 値:
            </p><pre class="programlisting">Audit    When auditing starts, which may be server startup time
Connect  When a client connects, also known as logging in
Query    An SQL statement (executed directly)
Prepare  Preparation of an SQL statement; usually followed by Execute
Execute  Execution of an SQL statement; usually follows Prepare
Shutdown Server shutdown
Quit     When a client disconnects
NoAudit  Auditing has been turned off
</pre><p>
              使用可能な値は <code class="literal">Audit</code>, <code class="literal">Binlog Dump</code>, <code class="literal">Change user</code>, <code class="literal">Close stmt</code>, <code class="literal">Connect Out</code>, <code class="literal">Connect</code>, <code class="literal">Create DB</code>, <code class="literal">Daemon</code>, <code class="literal">Debug</code>, <code class="literal">Delayed insert</code>, <code class="literal">Drop DB</code>, <code class="literal">Execute</code>, <code class="literal">Fetch</code>, <code class="literal">Field List</code>, <code class="literal">Init DB</code>, <code class="literal">Kill</code>, <code class="literal">Long Data</code>, <code class="literal">NoAudit</code>, <code class="literal">Ping</code>, <code class="literal">Prepare</code>, <code class="literal">Processlist</code>, <code class="literal">Query</code>, <code class="literal">Quit</code>, <code class="literal">Refresh</code>, <code class="literal">Register Slave</code>, <code class="literal">Reset stmt</code>, <code class="literal">Set option</code>, <code class="literal">Shutdown</code>, <code class="literal">Sleep</code>, <code class="literal">Statistics</code>, <code class="literal">Table Dump</code>, <code class="literal">TableDelete</code>, <code class="literal">TableInsert</code>, <code class="literal">TableRead</code>, <code class="literal">TableUpdate</code>, <code class="literal">Time</code> です。
            </p><p>
              これらの値の多くは、<code class="filename">my_command.h</code> ヘッダーファイルにリストされている <code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code> コマンド値に対応しています。 たとえば、<code class="literal">"Create DB"</code>および<code class="literal">"Change user"</code>は、それぞれ <code class="literal">COM_CREATE_DB</code> および <code class="literal">COM_CHANGE_USER</code> に対応します。 
            </p><p>
              <code class="literal">Table<em class="replaceable"><code>XXX</code></em></code> の <code class="literal">NAME</code> 値を持つイベントには、<code class="literal">Query</code> イベントが付随します。 たとえば、次のステートメントは、1 つの <code class="literal">Query</code> イベント、2 つの <code class="literal">TableRead</code> イベントおよび <code class="literal">TableInsert</code> イベントを生成します: 
            </p><pre class="programlisting">INSERT INTO t3 SELECT t1.* FROM t1 JOIN t2;
</pre><p>
              各 <code class="literal">Table<em class="replaceable"><code>XXX</code></em></code> イベントには、イベントが参照するテーブルを識別するための <code class="literal">DB</code> および <code class="literal">TABLE</code> 属性があります。
            </p><p>
              古い形式の XML 監査ログ形式の <code class="literal">Connect</code> イベントには、接続属性は含まれません。
            </p></li><li class="listitem"><p>
              <code class="literal">RECORD_ID</code>
            </p><p>
              監査レコードを表す一意の識別子。 この値はシーケンス番号とタイムスタンプで構成され、形式は <code class="literal"><em class="replaceable"><code>SEQ_TIMESTAMP</code></em></code> です。 監査ログプラグインが監査ログファイルを開くと、順序番号が監査ログファイルのサイズに初期化され、記録されるレコードごとに順序が 1 ずつ増分されます。 タイムスタンプは、監査ログプラグインがファイルを開いた日時を示す <code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code> 形式の UTC 値です。 
            </p><p>
              例: <code class="literal">RECORD_ID="12_2019-10-03T14:25:00"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">TIMESTAMP</code>
            </p><p>
              監査イベントが生成された日時を示す <code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em> UTC</code> 形式の UTC 値を表す文字列。 たとえば、クライアントから受信した SQL ステートメントの実行に対応するイベントの <code class="literal">TIMESTAMP</code> 値は、受信時ではなく、ステートメントの終了後に発生します。 
            </p><p>
              例: <code class="literal">TIMESTAMP="2019-10-03T14:25:32 UTC"</code>
            </p></li></ul></div><p>
          次の属性は、<code class="literal">&lt;AUDIT_RECORD&gt;</code> 要素ではオプションです。 これらの多くは、<code class="literal">NAME</code> 属性の特定の値を含む要素でのみ発生します。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">COMMAND_CLASS</code>
            </p><p>
              実行されたアクションのタイプを示す文字列。
            </p><p>
              例: <code class="literal">COMMAND_CLASS="drop_table"</code>
            </p><p>
              値は <code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code> コマンドカウンタに対応しています。 たとえば、<em class="replaceable"><code>xxx</code></em> は、<code class="literal">DROP TABLE</code> および <code class="literal">SELECT</code> ステートメントのそれぞれ <code class="literal">drop_table</code> および <code class="literal">select</code> です。 次のステートメントは、使用可能な名前を表示します: 
            </p><pre class="programlisting">SELECT REPLACE(EVENT_NAME, 'statement/sql/', '') AS name
FROM performance_schema.events_statements_summary_global_by_event_name
WHERE EVENT_NAME LIKE 'statement/sql/%'
ORDER BY name;
</pre></li><li class="listitem"><p>
              <code class="literal">CONNECTION_ID</code>
            </p><p>
              クライアント接続識別子を表す符号なし整数。 これは、セッション内の <code class="literal">CONNECTION_ID()</code> 関数によって戻される値と同じです。 
            </p><p>
              例: <code class="literal">CONNECTION_ID="127"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">CONNECTION_TYPE</code>
            </p><p>
              サーバーへの接続のセキュリティ状態。 許可される値は、<code class="literal">TCP/IP</code> (暗号化なしで確立された TCP/IP 接続)、<code class="literal">SSL/TLS</code> (暗号化で確立された TCP/IP 接続)、<code class="literal">Socket</code> (Unix ソケットファイル接続)、<code class="literal">Named Pipe</code> (Windows 名前付きパイプ接続) および <code class="literal">Shared Memory</code> (Windows 共有メモリー接続) です。 
            </p><p>
              例: <code class="literal">CONNECTION_TYPE="SSL/TLS"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">DB</code>
            </p><p>
              デフォルトのデータベース名を表す文字列。
            </p><p>
              例: <code class="literal">DB="test"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">HOST</code>
            </p><p>
              クライアントのホスト名を表す文字列。
            </p><p>
              例: <code class="literal">HOST="localhost"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">IP</code>
            </p><p>
              クライアントの IP アドレスを表す文字列。
            </p><p>
              例: <code class="literal">IP="127.0.0.1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">MYSQL_VERSION</code>
            </p><p>
              MySQL サーバーのバージョンを表す文字列。 これは、セッション内の <code class="literal">VERSION()</code> 関数または <code class="literal">version</code> システム変数の値と同じです。 
            </p><p>
              例: <code class="literal">MYSQL_VERSION="5.7.21-log"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">OS_LOGIN</code>
            </p><p>
              認証プロセス中に使用される外部ユーザー名を表す文字列。クライアントの認証に使用されるプラグインによって設定されます。 ネイティブ (組込み) MySQL 認証の場合、またはプラグインで値が設定されていない場合、この属性は空です。 この値は、<code class="literal">external_user</code> システム変数の値と同じです (<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照)。 
            </p><p>
              例: <code class="literal">OS_LOGIN="jeffrey"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">OS_VERSION</code>
            </p><p>
              サーバーが構築された、または実行されているオペレーティングシステムを表す文字列。
            </p><p>
              例: <code class="literal">OS_VERSION="x86_64-Linux"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">PRIV_USER</code>
            </p><p>
              サーバーがクライアントを認証する際に使用したユーザーを表す文字列。 これは、サーバーが権限チェックに使用するユーザー名で、<code class="literal">USER</code> の値とは異なる場合があります。 
            </p><p>
              例: <code class="literal">PRIV_USER="jeffrey"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">PROXY_USER</code>
            </p><p>
              プロキシユーザーを表す文字列 (<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照)。 ユーザーのプロキシ処理が有効になっていない場合は、値が空です。 
            </p><p>
              例: <code class="literal">PROXY_USER="developer"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">SERVER_ID</code>
            </p><p>
              サーバー ID を表す符号なし整数。 これは、<code class="literal">server_id</code> システム変数の値と同じです。 
            </p><p>
              例: <code class="literal">SERVER_ID="1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">SQLTEXT</code>
            </p><p>
              SQL ステートメントのテキストを表す文字列。 この値は、空にすることができます。 長い値は、切り捨てられる可能性があります。 監査ログファイル自体などの文字列は、UTF-8 (1 文字当たり最大 4 バイト) を使用して記述されるため、この値が変換の結果となる場合があります。 たとえば、元のステートメントは、SJIS 文字列としてクライアントから受信された可能性があります。 
            </p><p>
              例: <code class="literal">SQLTEXT="DELETE FROM t1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STARTUP_OPTIONS</code>
            </p><p>
              MySQL サーバーの起動時に、コマンド行またはオプションファイルで指定されたオプションを表す文字列。
            </p><p>
              例: <code class="literal">STARTUP_OPTIONS="--port=3306 --log_output=FILE"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STATUS</code>
            </p><p>
              コマンドのステータスを表す符号なし整数 (成功した場合は 0、エラーが発生した場合はゼロ以外)。 これは、<code class="literal">mysql_errno()</code> C API 関数の値と同じです。 <code class="literal">STATUS</code> との違いの詳細は、<code class="literal">STATUS_CODE</code> の説明を参照してください。 
            </p><p>
              監査ログには、SQLSTATE 値またはエラーメッセージが含まれていません。 エラーコード、SQLSTATE 値、およびメッセージ間の関連性を確認する方法については、<a class="ulink" href="https://dev.mysql.com/doc/mysql-errors/8.0/en/server-error-reference.html" target="_top">Server Error Message Reference</a>を参照してください。 
            </p><p>
              警告のログは記録されません。
            </p><p>
              例: <code class="literal">STATUS="1051"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STATUS_CODE</code>
            </p><p>
              コマンドのステータスを表す符号なし整数 (成功した場合は 0、エラーが発生した場合は 1)。
            </p><p>
              <code class="literal">STATUS_CODE</code> の値は、<code class="literal">STATUS</code> の値とは異なります。<code class="literal">STATUS_CODE</code> は、成功した場合は 0、エラーが発生した場合は 1 であり、Audit Vault の EZ_collector コンシューマとの互換性があります。 <code class="literal">STATUS</code> は、<code class="literal">mysql_errno()</code> C API 関数の値です。 これは、成功した場合は 0、エラーが発生した場合はゼロ以外です。そのため、エラーが発生した場合、必ずしも 1 であるとはかぎりません。 
            </p><p>
              例: <code class="literal">STATUS_CODE="0"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">TABLE</code>
            </p><p>
              テーブル名を表す文字列。
            </p><p>
              例: <code class="literal">TABLE="t3"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">USER</code>
            </p><p>
              クライアントによって送信されたユーザー名を表す文字列。 これは <code class="literal">PRIV_USER</code> の値とは異なる場合があります。 
            </p></li><li class="listitem"><p>
              <code class="literal">VERSION</code>
            </p><p>
              監査ログファイル形式のバージョンを表す符号なし整数。
            </p><p>
              例: <code class="literal">VERSION="1"</code>
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-json-format"></a>JSON 監査ログファイル形式</h5></div></div></div><p>
          JSON 形式の監査ロギング (<code class="literal">audit_log_format=JSON</code>) の場合、ログファイルの内容は、監査対象イベントをキーと値のペアの <code class="literal">JSON</code> ハッシュとして表す各配列要素を持つ <code class="literal">JSON</code> 配列を形成します。 完全なイベントレコードの例は、このセクションの後半で説明します。 部分的なイベントの抜粋を次に示します: 
        </p><pre class="programlisting">[
  {
    "timestamp": "2019-10-03 13:50:01",
    "id": 0,
    "class": "audit",
    "event": "startup",
    ...
  },
  {
    "timestamp": "2019-10-03 15:02:32",
    "id": 0,
    "class": "connection",
    "event": "connect",
    ...
  },
  ...
  {
    "timestamp": "2019-10-03 17:37:26",
    "id": 0,
    "class": "table_access",
    "event": "insert",
      ...
  }
  ...
]
</pre><p>
          監査ログファイルは、UTF-8 を使用して書き込まれます (文字当たり最大 4 バイト)。 監査ログプラグインは、新しいログファイルの書き込みを開始すると、開いている<code class="literal">[</code>アレイマーカーを書き込みます。 プラグインは、ログファイルを閉じるときに、閉じている<code class="literal">]</code>配列マーカーを書き込みます。 ファイルが開いている間は、閉じマーカーは存在しません。 
        </p><p>
          監査レコード内の項目には、次の特性があります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              一部の項目は、すべての監査レコードに表示されます。 その他はオプションで、監査レコードタイプに応じて表示される場合があります。 
            </p></li><li class="listitem"><p>
              監査レコード内の項目の順序は保証されません。
            </p></li><li class="listitem"><p>
              アイテム値が固定長ではありません。 長い値は、後で指定する品目摘要で示されるように切り捨てられる場合があります。 
            </p></li><li class="listitem"><p>
              <code class="literal">"</code>および<code class="literal">\</code>の文字は、それぞれ<code class="literal">"</code>および<code class="literal">\\</code>としてエンコードされます。
            </p></li></ul></div><p>
          次の例は、読みやすくするために若干再フォーマットされた様々なイベントタイプ (<code class="literal">class</code> および <code class="literal">event</code> 項目で示される) の JSON オブジェクト形式を示しています:
        </p><p>
          起動イベントの監査:
        </p><pre class="programlisting">{ "timestamp": "2019-10-03 14:21:56",
  "id": 0,
  "class": "audit",
  "event": "startup",
  "connection_id": 0,
  "startup_data": { "server_id": 1,
                    "os_version": "i686-Linux",
                    "mysql_version": "5.7.21-log",
                    "args": ["/usr/local/mysql/bin/mysqld",
                             "--loose-audit-log-format=JSON",
                             "--log-error=log.err",
                             "--pid-file=mysqld.pid",
                             "--port=3306" ] } }
</pre><p>
          (実行時に有効にされるのではなく) サーバーの起動の結果として監査ログプラグインが起動すると、<code class="literal">connection_id</code> は 0 に設定され、<code class="literal">account</code> および <code class="literal">login</code> は存在しません。
        </p><p>
          停止イベントの監査:
        </p><pre class="programlisting">{ "timestamp": "2019-10-03 14:28:20",
  "id": 3,
  "class": "audit",
  "event": "shutdown",
  "connection_id": 0,
  "shutdown_data": { "server_id": 1 } }
</pre><p>
          (実行時に無効にされるのではなく) サーバーのシャットダウンの結果として監査ログプラグインがアンインストールされると、<code class="literal">connection_id</code> は 0 に設定され、<code class="literal">account</code> および <code class="literal">login</code> は存在しません。
        </p><p>
          Connect または change-user イベント:
        </p><pre class="programlisting">{ "timestamp": "2019-10-03 14:23:18",
  "id": 1,
  "class": "connection",
  "event": "connect",
  "connection_id": 5,
  "account": { "user": "root", "host": "localhost" },
  "login": { "user": "root", "os": "", "ip": "::1", "proxy": "" },
  "connection_data": { "connection_type": "ssl",
                       "status": 0,
                       "db": "test",
                       "connection_attributes": {
                         "_pid": "43236",
                         ...
                         "program_name": "mysqladmin"
                       } }
}
</pre><p>
          切断イベント:
        </p><pre class="programlisting">{ "timestamp": "2019-10-03 14:24:45",
  "id": 3,
  "class": "connection",
  "event": "disconnect",
  "connection_id": 5,
  "account": { "user": "root", "host": "localhost" },
  "login": { "user": "root", "os": "", "ip": "::1", "proxy": "" },
  "connection_data": { "connection_type": "ssl" } }
</pre><p>
          クエリーイベント:
        </p><pre class="programlisting">{ "timestamp": "2019-10-03 14:23:35",
  "id": 2,
  "class": "general",
  "event": "status",
  "connection_id": 5,
  "account": { "user": "root", "host": "localhost" },
  "login": { "user": "root", "os": "", "ip": "::1", "proxy": "" },
  "general_data": { "command": "Query",
                    "sql_command": "show_variables",
                    "query": "SHOW VARIABLES",
                    "status": 0 } }
</pre><p>
          テーブルアクセスイベント (読取り、削除、挿入、更新):
        </p><pre class="programlisting">{ "timestamp": "2019-10-03 14:23:41",
  "id": 0,
  "class": "table_access",
  "event": "insert",
  "connection_id": 5,
  "account": { "user": "root", "host": "localhost" },
  "login": { "user": "root", "os": "", "ip": "127.0.0.1", "proxy": "" },
  "table_access_data": { "db": "test",
                         "table": "t1",
                         "query": "INSERT INTO t1 (i) VALUES(1),(2),(3)",
                         "sql_command": "insert" } }
</pre><p>
          次のリストの項目は、JSON 形式の監査レコードの最上位レベルに表示されます: 各アイテム値はスカラーまたは <code class="literal">JSON</code> ハッシュのいずれかです。 ハッシュ値を持つアイテムの場合、説明にはそのハッシュ内のアイテム名のみがリストされます。 セカンドレベルハッシュアイテムの詳細は、このセクションの後半のを参照してください。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">account</code>
            </p><p>
              イベントに関連付けられた MySQL アカウント。 この値は、セクション内の <code class="literal">CURRENT_USER()</code> 関数の値と同等の項目を含むハッシュです: <code class="literal">user</code>、<code class="literal">host</code>。 
            </p><p>
              例:
            </p><pre class="programlisting">"account": { "user": "root", "host": "localhost" }
</pre></li><li class="listitem"><p>
              <code class="literal">class</code>
            </p><p>
              イベントクラスを表す文字列。 このクラスは、イベントサブクラスを指定する <code class="literal">event</code> アイテムとともに取得されるイベントのタイプを定義します。 
            </p><p>
              例:
            </p><pre class="programlisting">"class": "connection"
</pre><p>
              次のテーブルに、<code class="literal">class</code> 値と <code class="literal">event</code> 値の許可される組合せを示します。
            </p><div class="table"><a name="audit-log-class-event-combinations"></a><p class="title"><b>表 6.28 監査ログクラスとイベントの組合せ</b></p><div class="table-contents"><table summary="Permitted combinations of audit log class and event values."><col style="width=30%"><col style="width=40%"><thead><tr>
                  <th>クラス値</th>
                  <th>許可されたイベント値</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">audit</code></td>
                  <td><code class="literal">startup</code>, <code class="literal">shutdown</code></td>
                </tr><tr>
                  <td><code class="literal">接続</code></td>
                  <td><code class="literal">connect</code>, <code class="literal">change_user</code>, <code class="literal">disconnect</code></td>
                </tr><tr>
                  <td><code class="literal">general</code></td>
                  <td><code class="literal">status</code></td>
                </tr><tr>
                  <td><code class="literal">table_access_data</code></td>
                  <td><code class="literal">read</code>, <code class="literal">delete</code>, <code class="literal">insert</code>, <code class="literal">update</code></td>
                </tr></tbody></table></div></div><br class="table-break"></li><li class="listitem"><p>
              <code class="literal">connection_data</code>
            </p><p>
              クライアント接続に関する情報。 値は、これらのアイテムを含むハッシュです: <code class="literal">connection_type</code>, <code class="literal">status</code>, <code class="literal">db</code>、および場合によっては <code class="literal">connection_attributes</code>。 この項目は、<code class="literal">class</code> 値が <code class="literal">connection</code> の監査レコードに対してのみ発生します。 
            </p><p>
              例:
            </p><pre class="programlisting">"connection_data": { "connection_type": "ssl",
                     "status": 0,
                     "db": "test" }
</pre><p>
              MySQL 8.0.19 の時点では、<code class="literal">class</code> 値が <code class="literal">connection</code> で <code class="literal">event</code> 値が <code class="literal">connect</code> のイベントには、接続時にクライアントによって渡された接続属性を表示するための <code class="literal">connection_attributes</code> アイテムが含まれる場合があります。 (「パフォーマンススキーマ」テーブルでも公開されるこれらの属性の詳細は、<a class="xref" href="performance-schema.html#performance-schema-connection-attribute-tables" title="27.12.9 パフォーマンススキーマ接続属性テーブル">セクション27.12.9「パフォーマンススキーマ接続属性テーブル」</a> を参照してください。) 
            </p><p>
              <code class="literal">connection_attributes</code> 値は、各属性をその名前と値で表すハッシュです。
            </p><p>
              例:
            </p><pre class="programlisting">"connection_attributes": {
  "_pid": "43236",
  "_os": "macos10.14",
  "_platform": "x86_64",
  "_client_version": "8.0.19",
  "_client_name": "libmysql",
  "program_name": "mysqladmin"
}
</pre><p>
              イベントに接続属性が存在しない場合、何も記録されず、<code class="literal">connection_attributes</code> アイテムは表示されません。 これは、接続試行が成功しなかった場合、クライアントが属性を渡さなかった場合、またはサーバーの起動時やプラグインによって開始されたときなどに接続が内部的に発生した場合に発生することがあります。 
            </p></li><li class="listitem"><p>
              <code class="literal">connection_id</code>
            </p><p>
              クライアント接続識別子を表す符号なし整数。 これは、セッション内の <code class="literal">CONNECTION_ID()</code> 関数によって戻される値と同じです。 
            </p><p>
              例:
            </p><pre class="programlisting">"connection_id": 5
</pre></li><li class="listitem"><p>
              <code class="literal">event</code>
            </p><p>
              イベントクラスのサブクラスを表す文字列。 サブクラスは、イベントクラスを指定する <code class="literal">class</code> アイテムとともに取得されるイベントのタイプを定義します。 詳細は、<code class="literal">class</code> アイテムの説明を参照してください。 
            </p><p>
              例:
            </p><pre class="programlisting">"event": "connect"
</pre></li><li class="listitem"><p>
              <code class="literal">general_data</code>
            </p><p>
              実行されたステートメントまたはコマンドに関する情報。 値は、これらのアイテムを含むハッシュです: <code class="literal">command</code>, <code class="literal">sql_command</code>, <code class="literal">query</code>, <code class="literal">status</code>。 この項目は、<code class="literal">class</code> 値が <code class="literal">general</code> の監査レコードに対してのみ発生します。 
            </p><p>
              例:
            </p><pre class="programlisting">"general_data": { "command": "Query",
                  "sql_command": "show_variables",
                  "query": "SHOW VARIABLES",
                  "status": 0 }
</pre></li><li class="listitem"><p>
              <code class="literal">id</code>
            </p><p>
              イベント ID を表す符号なし整数。
            </p><p>
              例:
            </p><pre class="programlisting">"id": 2
</pre><p>
              同じ <code class="literal">timestamp</code> 値を持つ監査レコードの場合、<code class="literal">id</code> 値によってそれらが区別され、順序が形成されます。 監査ログ内では、<code class="literal">timestamp</code>/<code class="literal">id</code> のペアは一意です。 これらのペアは、ログ内のイベントの場所を識別するブックマークです。 
            </p></li><li class="listitem"><p>
              <code class="literal">login</code>
            </p><p>
              クライアントがサーバーに接続した方法を示す情報。 値は、これらのアイテムを含むハッシュです: <code class="literal">user</code>, <code class="literal">os</code>, <code class="literal">ip</code>, <code class="literal">proxy</code>。 
            </p><p>
              例:
            </p><pre class="programlisting">"login": { "user": "root", "os": "", "ip": "::1", "proxy": "" }
</pre></li><li class="listitem"><p>
              <code class="literal">shutdown_data</code>
            </p><p>
              監査ログプラグインの終了に関する情報。 値は、これらのアイテムを含むハッシュです: <code class="literal">server_id</code> この項目は、<code class="literal">class</code> 値と <code class="literal">event</code> 値がそれぞれ <code class="literal">audit</code> および <code class="literal">shutdown</code> である監査レコードに対してのみ発生します。 
            </p><p>
              例:
            </p><pre class="programlisting">"shutdown_data": { "server_id": 1 }
</pre></li><li class="listitem"><p>
              <code class="literal">startup_data</code>
            </p><p>
              監査ログプラグインの初期化に関する情報。 値は、これらのアイテムを含むハッシュです: <code class="literal">server_id</code>, <code class="literal">os_version</code>, <code class="literal">mysql_version</code>, <code class="literal">args</code>。 この項目は、<code class="literal">class</code> 値と <code class="literal">event</code> 値がそれぞれ <code class="literal">audit</code> および <code class="literal">startup</code> である監査レコードに対してのみ発生します。 
            </p><p>
              例:
            </p><pre class="programlisting">"startup_data": { "server_id": 1,
                  "os_version": "i686-Linux",
                  "mysql_version": "5.7.21-log",
                  "args": ["/usr/local/mysql/bin/mysqld",
                           "--loose-audit-log-format=JSON",
                           "--log-error=log.err",
                           "--pid-file=mysqld.pid",
                           "--port=3306" ] }
</pre></li><li class="listitem"><p>
              <code class="literal">table_access_data</code>
            </p><p>
              テーブルへのアクセスに関する情報。 値は、これらのアイテムを含むハッシュです: <code class="literal">db</code>, <code class="literal">table</code>, <code class="literal">query</code>, <code class="literal">sql_command</code>、この項目は、<code class="literal">class</code> 値が <code class="literal">table_access</code> の監査レコードに対してのみ発生します。 
            </p><p>
              例:
            </p><pre class="programlisting">"table_access_data": { "db": "test",
                       "table": "t1",
                       "query": "INSERT INTO t1 (i) VALUES(1),(2),(3)",
                       "sql_command": "insert" }
</pre></li><li class="listitem"><p>
              <code class="literal">timestamp</code>
            </p><p>
              監査イベントが生成された日時を示す <em class="replaceable"><code>YYYY-MM-DD hh:mm:ss</code></em> 形式の UTC 値を表す文字列。 たとえば、クライアントから受信した SQL ステートメントの実行に対応するイベントの <code class="literal">timestamp</code> 値は、受信時ではなく、ステートメントの終了後に発生します。 
            </p><p>
              例:
            </p><pre class="programlisting">"timestamp": "2019-10-03 13:50:01"
</pre><p>
              同じ <code class="literal">timestamp</code> 値を持つ監査レコードの場合、<code class="literal">id</code> 値によってそれらが区別され、順序が形成されます。 監査ログ内では、<code class="literal">timestamp</code>/<code class="literal">id</code> のペアは一意です。 これらのペアは、ログ内のイベントの場所を識別するブックマークです。 
            </p></li></ul></div><p>
          JSON 形式の監査レコードのトップレベル項目に関連付けられたハッシュ値内には、次の項目が表示されます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">args</code>
            </p><p>
              MySQL サーバーの起動時にコマンド行またはオプションファイルで指定されたオプションの配列。 最初のオプションは、サーバー実行可能ファイルへのパスです。 
            </p><p>
              例:
            </p><pre class="programlisting">"args": ["/usr/local/mysql/bin/mysqld",
         "--loose-audit-log-format=JSON",
         "--log-error=log.err",
         "--pid-file=mysqld.pid",
         "--port=3306" ]
</pre></li><li class="listitem"><p>
              <code class="literal">command</code>
            </p><p>
              監査イベントを生成した命令 (サーバーがクライアントから受信したコマンドなど) のタイプを表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">"command": "Query"
</pre></li><li class="listitem"><p>
              <code class="literal">connection_type</code>
            </p><p>
              サーバーへの接続のセキュリティ状態。 許可される値は、<code class="literal">tcp/ip</code> (暗号化なしで確立された TCP/IP 接続)、<code class="literal">ssl</code> (暗号化で確立された TCP/IP 接続)、<code class="literal">socket</code> (Unix ソケットファイル接続)、<code class="literal">named_pipe</code> (Windows 名前付きパイプ接続) および <code class="literal">shared_memory</code> (Windows 共有メモリー接続) です。 
            </p><p>
              例:
            </p><pre class="programlisting">"connection_type": "tcp/tcp"
</pre></li><li class="listitem"><p>
              <code class="literal">db</code>
            </p><p>
              データベース名を表す文字列。 <code class="literal">connection_data</code> の場合、これはデフォルトのデータベースです。 <code class="literal">table_access_data</code> の場合は、テーブルデータベースです。 
            </p><p>
              例:
            </p><pre class="programlisting">"db": "test"
</pre></li><li class="listitem"><p>
              <code class="literal">ホスト</code>
            </p><p>
              クライアントのホスト名を表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">"host": "localhost"
</pre></li><li class="listitem"><p>
              <code class="literal">ip</code>
            </p><p>
              クライアントの IP アドレスを表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">"ip": "::1"
</pre></li><li class="listitem"><p>
              <code class="literal">mysql_version</code>
            </p><p>
              MySQL サーバーのバージョンを表す文字列。 これは、セッション内の <code class="literal">VERSION()</code> 関数または <code class="literal">version</code> システム変数の値と同じです。 
            </p><p>
              例:
            </p><pre class="programlisting">"mysql_version": "5.7.21-log"
</pre></li><li class="listitem"><p>
              <code class="literal">os</code>
            </p><p>
              認証プロセス中に使用される外部ユーザー名を表す文字列。クライアントの認証に使用されるプラグインによって設定されます。 ネイティブ (組込み) MySQL 認証の場合、またはプラグインで値が設定されていない場合、この属性は空です。 この値は、<code class="literal">external_user</code> システム変数の値と同じです。 <a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a>を参照してください。 
            </p><p>
              例:
            </p><pre class="programlisting">"os": "jeffrey"
</pre></li><li class="listitem"><p>
              <code class="literal">os_version</code>
            </p><p>
              サーバーが構築された、または実行されているオペレーティングシステムを表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">"os_version": "i686-Linux"
</pre></li><li class="listitem"><p>
              <code class="literal">プロキシ</code>
            </p><p>
              プロキシユーザーを表す文字列 (<a class="xref" href="security.html#proxy-users" title="6.2.18 プロキシユーザー">セクション6.2.18「プロキシユーザー」</a> を参照)。 ユーザーのプロキシ処理が有効になっていない場合は、値が空です。 
            </p><p>
              例:
            </p><pre class="programlisting">"proxy": "developer"
</pre></li><li class="listitem"><p>
              <code class="literal">クエリー</code>
            </p><p>
              SQL ステートメントのテキストを表す文字列。 この値は、空にすることができます。 長い値は、切り捨てられる可能性があります。 監査ログファイル自体などの文字列は、UTF-8 (1 文字当たり最大 4 バイト) を使用して記述されるため、この値が変換の結果となる場合があります。 たとえば、元のステートメントは、SJIS 文字列としてクライアントから受信された可能性があります。 
            </p><p>
              例:
            </p><pre class="programlisting">"query": "DELETE FROM t1"
</pre></li><li class="listitem"><p>
              <code class="literal">server_id</code>
            </p><p>
              サーバー ID を表す符号なし整数。 これは、<code class="literal">server_id</code> システム変数の値と同じです。 
            </p><p>
              例:
            </p><pre class="programlisting">"server_id": 1
</pre></li><li class="listitem"><p>
              <code class="literal">sql_command</code>
            </p><p>
              SQL ステートメントのタイプを示す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">"sql_command": "insert"
</pre><p>
              値は <code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code> コマンドカウンタに対応しています。 たとえば、<em class="replaceable"><code>xxx</code></em> は、<code class="literal">DROP TABLE</code> および <code class="literal">SELECT</code> ステートメントのそれぞれ <code class="literal">drop_table</code> および <code class="literal">select</code> です。 次のステートメントは、使用可能な名前を表示します: 
            </p><pre class="programlisting">SELECT REPLACE(EVENT_NAME, 'statement/sql/', '') AS name
FROM performance_schema.events_statements_summary_global_by_event_name
WHERE EVENT_NAME LIKE 'statement/sql/%'
ORDER BY name;
</pre></li><li class="listitem"><p>
              <code class="literal">status</code>
            </p><p>
              コマンドのステータスを表す符号なし整数 (成功した場合は 0、エラーが発生した場合はゼロ以外)。 これは、<code class="literal">mysql_errno()</code> C API 関数の値と同じです。 
            </p><p>
              監査ログには、SQLSTATE 値またはエラーメッセージが含まれていません。 エラーコード、SQLSTATE 値、およびメッセージ間の関連性を確認する方法については、<a class="ulink" href="https://dev.mysql.com/doc/mysql-errors/8.0/en/server-error-reference.html" target="_top">Server Error Message Reference</a>を参照してください。 
            </p><p>
              警告のログは記録されません。
            </p><p>
              例:
            </p><pre class="programlisting">"status": 1051
</pre></li><li class="listitem"><p>
              <code class="literal">table</code>
            </p><p>
              テーブル名を表す文字列。
            </p><p>
              例:
            </p><pre class="programlisting">"table": "t1"
</pre></li><li class="listitem"><p>
              <code class="literal">user</code>
            </p><p>
              ユーザー名を表す文字列。 意味は、<code class="literal">user</code> が発生するアイテムによって異なります: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">account</code> アイテム内の <code class="literal">user</code> は、サーバーがクライアントを認証したユーザーを表す文字列です。 これは、サーバーが権限チェックに使用するユーザー名です。 
                </p></li><li class="listitem"><p>
                  <code class="literal">login</code> アイテム内の <code class="literal">user</code> は、クライアントによって送信されるユーザー名を表す文字列です。
                </p></li></ul></div><p>
              例:
            </p><pre class="programlisting">"user": "root"
</pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-logging-configuration"></a>6.4.5.5 監査ロギング特性の構成</h4></div></div></div><p>
        このセクションでは、監査ログプラグインがイベントを書き込むファイル、書き込まれたイベントの形式、ログファイルの圧縮と暗号化を有効にするかどうかなど、監査ロギング特性を構成する方法について説明します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-name" title="監査ログファイルのネーミング規則">監査ログファイルのネーミング規則</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-format" title="監査ログファイル形式の選択">監査ログファイル形式の選択</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-compression" title="監査ログファイルの圧縮">監査ログファイルの圧縮</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-uncompression-decryption" title="監査ログファイルの手動での解凍および復号化">監査ログファイルの手動での解凍および復号化</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-encryption-old" title="MySQL 8.0.17 より前の監査ログファイルの暗号化">MySQL 8.0.17 より前の監査ログファイルの暗号化</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-space-management" title="監査ログファイルの領域管理">監査ログファイルの領域管理</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-strategy" title="監査ロギングの書込み戦略">監査ロギングの書込み戦略</a></p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          ここで説明する暗号化機能は、現在の暗号化機能を以前の制限付き機能と比較するセクションを除き、MySQL 8.0.17 の時点で適用されます。<a class="xref" href="security.html#audit-log-file-encryption-old" title="MySQL 8.0.17 より前の監査ログファイルの暗号化">MySQL 8.0.17 より前の監査ログファイルの暗号化</a> を参照してください。
        </p></div><p>
        監査ロギングに影響するユーザー定義関数およびシステム変数の詳細は、<a class="xref" href="security.html#audit-log-routines" title="監査ログ関数">監査ログ関数</a> および <a class="xref" href="security.html#audit-log-options-variables" title="監査ログのオプションおよび変数">監査ログのオプションおよび変数</a> を参照してください。
      </p><p>
        監査ログプラグインは、イベントの内容またはイベントの発生元のアカウントに基づいて、監査ログファイルに書き込む監査イベントを制御することもできます。 <a class="xref" href="security.html#audit-log-filtering" title="6.4.5.7 監査ログのフィルタリング">セクション6.4.5.7「監査ログのフィルタリング」</a>を参照してください。 
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-name"></a>監査ログファイルのネーミング規則</h5></div></div></div><p>
          監査ログファイル名を構成するには、サーバーの起動時に <code class="literal">audit_log_file</code> システム変数を設定します。 サーバーデータディレクトリのデフォルト名は <code class="filename">audit.log</code> です。 セキュリティを最適化するには、MySQL サーバーおよびログを表示する正当な理由があるユーザーのみがアクセスできるディレクトリに監査ログを書き込みます。 
        </p><p>
          プラグインは、<code class="literal">audit_log_file</code> 値を、オプションの先頭ディレクトリ名、ベース名、およびオプションの接尾辞で構成されるものとして解釈します。 圧縮または暗号化が有効になっている場合、有効なファイル名 (ログファイルの作成に実際に使用される名前) は、追加の接尾辞があるため、構成されたファイル名とは異なります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              圧縮が有効な場合、プラグインは <code class="filename">.gz</code> の接尾辞を追加します。
            </p></li><li class="listitem"><p>
              暗号化が有効な場合、プラグインは <code class="filename">.<em class="replaceable"><code>pwd_id</code></em>.enc</code> の接尾辞を追加します。ここで、<em class="replaceable"><code>pwd_id</code></em> はログファイル操作に使用する暗号化パスワードを示します。 監査ログプラグインは、暗号化パスワードを鍵リングに格納します。<a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a> を参照してください。 
            </p></li></ul></div><p>
          有効な監査ログファイル名は、構成されたファイル名に適用可能な圧縮および暗号化接尾辞を追加した結果の名前です。 たとえば、構成された <code class="literal">audit_log_file</code> 値が <code class="filename">audit.log</code> の場合、有効なファイル名は次のテーブルに示す値のいずれかになります。 
        </p><div class="informaltable"><table summary="audit_log effective file names for various combinations of the compression and encryption features."><col style="width=50%"><col style="width=50%"><thead><tr>
              <th>有効な機能</th>
              <th>有効なファイル名</th>
            </tr></thead><tbody><tr>
              <td>圧縮または暗号化なし</td>
              <td><code class="filename">audit.log</code></td>
            </tr><tr>
              <td>Compression</td>
              <td><code class="filename">audit.log.gz</code></td>
            </tr><tr>
              <td>暗号化</td>
              <td><code class="filename">audit.log.<em class="replaceable"><code>pwd_id</code></em>.enc</code></td>
            </tr><tr>
              <td>圧縮、暗号化</td>
              <td><code class="filename">audit.log.gz.<em class="replaceable"><code>pwd_id</code></em>.enc</code></td>
            </tr></tbody></table></div><p>
          <em class="replaceable"><code>pwd_id</code></em> は、ファイルの暗号化または復号化に使用されるパスワードの ID を示します。<em class="replaceable"><code>pwd_id</code></em> 形式は <em class="replaceable"><code>pwd_timestamp-seq</code></em> です。ここでは:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <em class="replaceable"><code>pwd_timestamp</code></em> は、パスワードがいつ作成されたかを示す <code class="literal"><em class="replaceable"><code>YYYYMMDD</code></em>T<em class="replaceable"><code>hhmmss</code></em></code> 形式の UTC 値です。
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>seq</code></em> は順序番号です。 順序番号は 1 から始まり、同じ <em class="replaceable"><code>pwd_timestamp</code></em> 値を持つパスワードに対して増加します。 
            </p></li></ul></div><p>
          <em class="replaceable"><code>pwd_id</code></em> パスワード ID の値の例を次に示します:
        </p><pre class="programlisting">20190403T142359-1
20190403T142400-1
20190403T142400-2
</pre><p>
          パスワードをキーリングに格納するための対応するキーリング ID を構築するために、監査ログプラグインは <code class="literal">audit_log-</code> の接頭辞を <em class="replaceable"><code>pwd_id</code></em> 値に追加します。 前述のパスワード ID の例では、対応するキーリング ID は次のとおりです: 
        </p><pre class="programlisting">audit_log-20190403T142359-1
audit_log-20190403T142400-1
audit_log-20190403T142400-2
</pre><p>
          監査ログプラグインによって暗号化に現在使用されているパスワードの ID は、<em class="replaceable"><code>pwd_timestamp</code></em> 値がもっとも大きいパスワードです。 複数のパスワードにその <em class="replaceable"><code>pwd_timestamp</code></em> 値がある場合、現在のパスワード ID は順序番号が最も大きいものになります。 たとえば、前述のパスワード ID のセットでは、パスワード ID のうち 2 つの ID のタイムスタンプが最大の <code class="literal">20190403T142400</code> であるため、現在のパスワード ID は順序番号 (<code class="literal">2</code>) が最も大きいものになります。 
        </p><p>
          監査ログプラグインは、有効な監査ログファイル名に基づいて、初期化および終了時に特定のアクションを実行します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              初期化中に、プラグインは監査ログファイル名を持つファイルがすでに存在するかどうかをチェックし、存在する場合は名前を変更します。 (この場合、プラグインは、監査ログプラグインの実行中に以前のサーバー起動が予期せず終了したことを前提としています。) 次に、プラグインは新しい空の監査ログファイルに書き込みます。 
            </p></li><li class="listitem"><p>
              終了時に、プラグインは監査ログファイルの名前を変更します。
            </p></li><li class="listitem"><p>
              ファイルの名前変更 (プラグインの初期化時または終了時) は、サイズベースのログファイルの自動ローテーションの通常のルールに従って行われます。<a class="xref" href="security.html#audit-log-size-based-rotation" title="サイズベースの監査ログファイルのローテーション">サイズベースの監査ログファイルのローテーション</a> を参照してください。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-format"></a>監査ログファイル形式の選択</h5></div></div></div><p>
          監査ログファイル形式を構成するには、サーバーの起動時に <code class="literal">audit_log_format</code> システム変数を設定します。 デフォルトでは、フォーマットは <code class="literal">NEW</code> (新しいスタイルの XML フォーマット) です。 各形式についての詳細は、<a class="xref" href="security.html#audit-log-file-formats" title="6.4.5.4 監査ログファイル形式">セクション6.4.5.4「監査ログファイル形式」</a>を参照してください。 
        </p><p>
          <code class="literal">audit_log_format</code> を変更する場合は、<code class="literal">audit_log_file</code> も変更することをお薦めします。 それ以外の場合は、ベース名は同じで形式が異なる 2 つのログファイルのセットが存在します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-compression"></a>監査ログファイルの圧縮</h5></div></div></div><p>
          監査ログファイルの圧縮は、任意のロギング形式に対して有効にできます。
        </p><p>
          監査ログファイルの圧縮を構成するには、サーバーの起動時に <code class="literal">audit_log_compression</code> システム変数を設定します。 許可される値は、<code class="literal">NONE</code> (圧縮なし、デフォルト) および <code class="literal">GZIP</code> (GNU Zip 圧縮) です。 
        </p><p>
          圧縮と暗号化の両方が有効な場合、圧縮は暗号化の前に行われます。 元のファイルを手動でリカバリするには、最初に復号化してから解凍します。 <a class="xref" href="security.html#audit-log-file-uncompression-decryption" title="監査ログファイルの手動での解凍および復号化">監査ログファイルの手動での解凍および復号化</a>を参照してください。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-encryption"></a>監査ログファイルの暗号化</h5></div></div></div><p>
          監査ログファイルの暗号化は、任意のロギング形式に対して有効にできます。 暗号化は、ユーザー定義のパスワードに基づきます (監査ログプラグインによって生成される初期パスワードを除く)。 この機能を使用するには、監査ロギングでパスワード記憶域に使用されるため、MySQL キーリングを有効にする必要があります。 どのキーリングプラグインも使用できます。手順については、<a class="xref" href="security.html#keyring" title="6.4.4 MySQL キーリング">セクション6.4.4「MySQL キーリング」</a> を参照してください。 
        </p><p>
          監査ログファイルの暗号化を構成するには、サーバーの起動時に <code class="literal">audit_log_encryption</code> システム変数を設定します。 許可される値は、<code class="literal">NONE</code> (暗号化なし、デフォルト) および <code class="literal">AES</code> (AES-256-CBC 暗号化) です。 
        </p><p>
          実行時に暗号化パスワードを設定または取得するには、次のユーザー定義関数 (UDF) を使用します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              現在の暗号化パスワードを設定するには、<code class="literal">audit_log_encryption_password_set()</code> を起動します。 この関数は、キーリングに新しいパスワードを格納します。 暗号化が有効な場合は、現在のログファイルの名前を変更するログファイルローテーション操作も実行され、パスワードで暗号化された新しいログファイルが開始されます。 ファイル名の変更は、サイズベースの自動ログファイルローテーションの通常のルールに従って行われます。<a class="xref" href="security.html#audit-log-size-based-rotation" title="サイズベースの監査ログファイルのローテーション">サイズベースの監査ログファイルのローテーション</a> を参照してください。 
            </p><a class="indexterm" name="idm46723752403312"></a><a class="indexterm" name="idm46723752401696"></a><p>
              <code class="literal">audit_log_password_history_keep_days</code> システム変数がゼロ以外の場合、<code class="literal">audit_log_encryption_password_set()</code> を起動すると、古いアーカイブ監査ログの暗号化パスワードも期限切れになります。 パスワードのアーカイブや有効期限など、監査ログのパスワード履歴の詳細は、その変数の説明を参照してください。 
            </p></li><li class="listitem"><p>
              現在の暗号化パスワードを取得するには、引数を指定せずに <code class="literal">audit_log_encryption_password_get()</code> を起動します。 ID でパスワードを取得するには、現在のパスワードまたはアーカイブされたパスワードのキーリング ID を指定する引数を渡します。 
            </p><a class="indexterm" name="idm46723752394320"></a><a class="indexterm" name="idm46723752392704"></a><p>
              存在する監査ログ鍵リング ID を確認するには、パフォーマンススキーマ <code class="literal">keyring_keys</code> テーブルをクエリーします:
            </p><a class="indexterm" name="idm46723752389056"></a><a class="indexterm" name="idm46723752386864"></a><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT KEY_ID FROM performance_schema.keyring_keys</code></strong>
       <strong class="userinput"><code>WHERE KEY_ID LIKE 'audit_log%'</code></strong>
       <strong class="userinput"><code>ORDER BY KEY_ID;</code></strong>
+-----------------------------+
| KEY_ID                      |
+-----------------------------+
| audit_log-20190415T152248-1 |
| audit_log-20190415T153507-1 |
| audit_log-20190416T125122-1 |
| audit_log-20190416T141608-1 |
+-----------------------------+
</pre></li></ul></div><p>
          監査ログの暗号化 UDF の詳細は、<a class="xref" href="security.html#audit-log-routines" title="監査ログ関数">監査ログ関数</a> を参照してください。
        </p><p>
          監査ログプラグインが初期化されるときに、ログファイルの暗号化が有効になっていることが判明すると、鍵リングに監査ログの暗号化パスワードが含まれているかどうかがチェックされます。 そうでない場合、プラグインはランダムな初期暗号化パスワードを自動的に生成し、キーリングに格納します。 このパスワードを検出するには、<code class="literal">audit_log_encryption_password_get()</code> を起動します。 
        </p><p>
          圧縮と暗号化の両方が有効な場合、圧縮は暗号化の前に行われます。 元のファイルを手動でリカバリするには、最初に復号化してから解凍します。 <a class="xref" href="security.html#audit-log-file-uncompression-decryption" title="監査ログファイルの手動での解凍および復号化">監査ログファイルの手動での解凍および復号化</a>を参照してください。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-uncompression-decryption"></a>監査ログファイルの手動での解凍および復号化</h5></div></div></div><p>
          監査ログファイルは、標準ツールを使用して圧縮解除および復号化できます。 これは、閉じられた (アーカイブされた) 使用されなくなったログファイルに対してのみ実行してください。監査ログプラグインが現在書き込んでいるログファイルに対しては実行しないでください。 アーカイブログファイルは、ベース名の直後のファイル名にタイムスタンプを含めるように監査ログプラグインによって名前が変更されているため、認識できます。 
        </p><p>
          この説明では、<code class="literal">audit_log_file</code> が <code class="filename">audit.log</code> に設定されていると仮定します。 その場合、アーカイブされた監査ログファイルには、次のテーブルに示すいずれかの名前が付けられます。 
        </p><div class="informaltable"><table summary="audit_log archived file names for various combinations of the compression and encryption features."><col style="width=50%"><col style="width=50%"><thead><tr>
              <th>有効な機能</th>
              <th>アーカイブファイル名</th>
            </tr></thead><tbody><tr>
              <td>圧縮または暗号化なし</td>
              <td><code class="filename">audit.<em class="replaceable"><code>timestamp</code></em>.log</code></td>
            </tr><tr>
              <td>Compression</td>
              <td><code class="filename">audit.<em class="replaceable"><code>timestamp</code></em>.log.gz</code></td>
            </tr><tr>
              <td>暗号化</td>
              <td><code class="filename">audit.<em class="replaceable"><code>timestamp</code></em>.log.<em class="replaceable"><code>pwd_id</code></em>.enc</code></td>
            </tr><tr>
              <td>圧縮、暗号化</td>
              <td><code class="filename">audit.<em class="replaceable"><code>timestamp</code></em>.log.gz.<em class="replaceable"><code>pwd_id</code></em>.enc</code></td>
            </tr></tbody></table></div><p>
          <a class="xref" href="security.html#audit-log-file-name" title="監査ログファイルのネーミング規則">監査ログファイルのネーミング規則</a> で説明されているように、<em class="replaceable"><code>pwd_id</code></em> 形式は <em class="replaceable"><code>pwd_timestamp-seq</code></em> です。 したがって、アーカイブされた暗号化ログファイルの名前には、実際には 2 つのタイムスタンプが含まれています。 1 つ目はファイルのローテーション時間を示し、2 つ目は暗号化パスワードが作成された時間を示します。 
        </p><p>
          次のアーカイブ暗号化ログファイル名のセットについて考えてみます:
        </p><pre class="programlisting">audit.20190410T205827.log.20190403T185337-1.enc
audit.20190410T210243.log.20190403T185337-1.enc
audit.20190415T145309.log.20190414T223342-1.enc
audit.20190415T151322.log.20190414T223342-2.enc
</pre><p>
          各ファイル名には、一意のローテーション時間タイムスタンプがあります。 対照的に、パスワードのタイムスタンプは一意ではありません: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              最初の 2 つのファイルのパスワード ID と順序番号は同じです (<code class="literal">20190403T185337-1</code>)。 これらの暗号化パスワードは同じです。 
            </p></li><li class="listitem"><p>
              2 つ目のファイルのパスワード ID (<code class="literal">20190414T223342</code>) は同じですが、順序番号 (<code class="literal">1</code>、<code class="literal">2</code>) が異なります。 これらのファイルの暗号化パスワードは異なります。 
            </p></li></ul></div><p>
          圧縮されたログファイルを手動で解凍するには、<span class="command"><strong>gunzip</strong></span>、<span class="command"><strong>gzip -d</strong></span> または同等のコマンドを使用します。 例: 
        </p><pre class="programlisting">gunzip -c audit.<em class="replaceable"><code>timestamp</code></em>.log.gz &gt; audit.<em class="replaceable"><code>timestamp</code></em>.log
</pre><p>
          暗号化されたログファイルを手動で復号化するには、<span class="command"><strong>openssl</strong></span> コマンドを使用します。 例: 
        </p><pre class="programlisting">openssl enc -d -aes-256-cbc -pass pass:<em class="replaceable"><code>password</code></em> -md sha256
    -in audit.<em class="replaceable"><code>timestamp</code></em>.log.<em class="replaceable"><code>pwd_id</code></em>.enc
    -out audit.<em class="replaceable"><code>timestamp</code></em>.log
</pre><p>
          このコマンドを実行するには、暗号化パスワードである <em class="replaceable"><code>password</code></em> を取得する必要があります。 これを行うには、<code class="literal">audit_log_encryption_password_get()</code> を使用します。 たとえば、監査ログファイル名が <code class="filename">audit.20190415T151322.log.20190414T223342-2.enc</code> の場合、パスワード ID は <code class="literal">20190414T223342-2</code> で、キーリング ID は <code class="literal">audit-log-20190414T223342-2</code> です。 次のようなキーリングパスワードを取得します: 
        </p><pre class="programlisting">SELECT audit_log_encryption_password_get('audit-log-20190414T223342-2');
</pre><p>
          圧縮と暗号化の両方が監査ロギングに対して有効になっている場合、圧縮は暗号化の前に行われます。 この場合、ファイル名には、これらの操作が発生する順序に対応する <code class="filename">.gz</code> および <code class="filename">.<em class="replaceable"><code>pwd_id</code></em>.enc</code> 接尾辞が追加されます。 元のファイルを手動でリカバリするには、操作を逆に実行します。 つまり、最初にファイルを復号化してから解凍します: 
        </p><pre class="programlisting">openssl enc -d -aes-256-cbc -pass pass:<em class="replaceable"><code>password</code></em> -md sha256
    -in audit.<em class="replaceable"><code>timestamp</code></em>.log.gz.<em class="replaceable"><code>pwd_id</code></em>.enc
    -out audit.<em class="replaceable"><code>timestamp</code></em>.log.gz
gunzip -c audit.<em class="replaceable"><code>timestamp</code></em>.log.gz &gt; audit.<em class="replaceable"><code>timestamp</code></em>.log
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-file-encryption-old"></a>MySQL 8.0.17 より前の監査ログファイルの暗号化</h5></div></div></div><p>
          このセクションでは、パスワード履歴 (パスワードのアーカイブと有効期限を含む) が実装されたときの、MySQL 8.0.17 の前後の監査ログファイルの暗号化機能の違いについて説明します。 また、監査ログプラグインが 8.0.17 より前のバージョンから MySQL 8.0.17 以上へのアップグレードを処理する方法も示します。 
        </p><div class="informaltable"><table summary="Comparison of audit log encryption prior to and as of MySQL 8.0.17."><col style="width=30%"><col style="width=35%"><col style="width=35%"><thead><tr>
              <th scope="col">機能</th>
              <th scope="col">MySQL 8.0.17 より前</th>
              <th scope="col">MySQL 8.0.17 の時点</th>
            </tr></thead><tbody><tr>
              <th scope="row">パスワードの数</th>
              <td>単一パスワードのみ</td>
              <td>複数のパスワードを許可</td>
            </tr><tr>
              <th scope="row">暗号化されたログファイル名</th>
              <td><code class="filename">.enc</code> 接尾辞</td>
              <td><code class="filename">.<em class="replaceable"><code>pwd_id</code></em>.enc</code> 接尾辞</td>
            </tr><tr>
              <th scope="row">パスワードキーリング ID</th>
              <td><code class="literal">audit_log</code></td>
              <td><code class="literal">audit_log-<em class="replaceable"><code>pwd_id</code></em></code></td>
            </tr><tr>
              <th scope="row">パスワード履歴</th>
              <td>いいえ</td>
              <td>はい</td>
            </tr></tbody></table></div><p>
          MySQL 8.0.17 より前ではパスワード履歴がないため、新しいパスワードを設定すると古いパスワードにアクセスできなくなり、MySQL Enterprise Audit は古いパスワードで暗号化されたログファイルを読み取ることができなくなりました。 これらのファイルを手動で復号化する必要があると予想される場合は、以前のパスワードのレコードを保持する必要があります。 
        </p><p>
          下位バージョンから MySQL 8.0.17 以上にアップグレードするときに監査ログファイルの暗号化が有効になっている場合、監査ログプラグインは次のアップグレードアクションを実行します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              プラグインの初期化中に、プラグインはキーリング ID が <code class="literal">audit_log</code> の暗号化パスワードをチェックします。 見つかった場合、プラグインは <code class="literal">audit_log-<em class="replaceable"><code>pwd_id</code></em></code> 形式のキーリング ID を使用してパスワードを複製し、現在の暗号化パスワードとして使用します。 (<em class="replaceable"><code>pwd_id</code></em> 構文の詳細は、<a class="xref" href="security.html#audit-log-file-name" title="監査ログファイルのネーミング規則">監査ログファイルのネーミング規則</a> を参照してください。) 
            </p></li><li class="listitem"><p>
              既存の暗号化されたログファイルには、接尾辞 <code class="filename">.enc</code> が付きます。 プラグインは、接尾辞が <code class="filename">.<em class="replaceable"><code>pwd_id</code></em>.enc</code> になるようにこれらの名前を変更しませんが、ID が <code class="literal">audit_log</code> のキーがキーリングに残っているかぎり読み取ることができます。 
            </p></li><li class="listitem"><p>
              パスワードのクリーンアップが発生したときに、プラグインが <code class="literal">audit_log-<em class="replaceable"><code>pwd_id</code></em></code> 形式のキーリング ID を持つパスワードを期限切れにすると、<code class="filename">audit_log</code> のキーリング ID を持つパスワードも期限切れになります (存在する場合)。 (この時点で、<code class="filename">.<em class="replaceable"><code>pwd_id</code></em>.enc</code> ではなく <code class="filename">.enc</code> という接尾辞を持つ暗号化されたログファイルはプラグインで読み取れなくなるため、不要になったと想定されます。) 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-space-management"></a>監査ログファイルの領域管理</h5></div></div></div><p>
          監査ログファイルは、非常に大きくなり、大量のディスク領域を消費する可能性があります。 ログファイルで使用される領域の管理を有効にするために、監査ログプラグインでは、ファイルサイズに基づいて手動または自動でログファイルをローテーションできます。 MySQL 8.0.24 では、このプラグインは JSON 形式のログファイルのログファイルプルーニングもサポートしています。 
        </p><p>
          監査ログファイルの領域管理機能では、<code class="literal">audit_log_rotate_on_size</code>、<code class="literal">audit_log_flush</code> および <code class="literal">audit_log_prune_seconds</code> システム変数が使用され、次のように組み合されています:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_rotate_on_size</code> が 0 (デフォルト) の場合:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  自動ログファイルローテーションが無効です。 手動で実行しないかぎり、ローテーションは発生しません。 
                </p></li><li class="listitem"><p>
                  手動で名前を変更した後、<code class="literal">audit_log_flush</code> を使用して現在のログファイルを閉じ、再度開きます。
                </p></li><li class="listitem"><p>
                  ログファイルのプルーニングを有効にできず、<code class="literal">audit_log_prune_seconds</code> は無効です。
                </p></li></ul></div><p></p></li><li class="listitem"><p>
              <code class="literal">audit_log_rotate_on_size</code> が 0 より大きい場合:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  自動ローテーションは、現在のログファイルへの書込みによってサイズがこの値を超える場合に発生します。 監査ログプラグインは、ファイルを閉じて名前を変更し、新しいログファイルを開きます。 
                </p></li><li class="listitem"><p>
                  ログファイルのプルーニングを有効にでき、<code class="literal">audit_log_prune_seconds</code> はプルーニングが行われるかどうかを判断します。
                </p></li><li class="listitem"><p>
                  <code class="literal">audit_log_flush</code> には影響はありません。
                </p></li></ul></div></li><li class="listitem"><p>
              自動サイズベースローテーションは、後で説明する他のいくつかの条件下でも発生します。
            </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            名前が変更されたログファイルは自動的に削除されません。 たとえば、サイズベースのログファイルローテーションでは、名前が変更されたログファイルは名前シーケンスの最後からローテーションされません。 かわりに、一意の名前を持ち、無期限に蓄積されます。 過剰な領域使用を回避するには: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                MySQL 8.0.24 以降 (JSON 形式のログファイル用): <a class="xref" href="security.html#audit-log-pruning" title="監査ログファイルのプルーニング">監査ログファイルのプルーニング</a> の説明に従って、ログファイルのプルーニングを有効にします。
              </p></li><li class="listitem"><p>
                それ以外の場合 (JSON 以外のファイルの場合、またはすべてのログ形式について MySQL 8.0.24 より前の場合): 古いファイルを定期的に削除し、必要に応じて最初にバックアップします。 バックアップされたログファイルが暗号化されている場合は、後でファイルを復号化する必要があるときに、対応する暗号化パスワードも安全な場所にバックアップします。 
              </p></li></ul></div></div><p>
          次の各セクションでは、ログファイルのローテーションとプルーニングについて詳しく説明します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-manual-rotation" title="手動監査ログファイルローテーション">手動監査ログファイルローテーション</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-size-based-rotation" title="サイズベースの監査ログファイルのローテーション">サイズベースの監査ログファイルのローテーション</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-pruning" title="監査ログファイルのプルーニング">監査ログファイルのプルーニング</a></p></li></ul></div><h6><a name="audit-log-manual-rotation"></a>手動監査ログファイルローテーション</h6><p>
          <code class="literal">audit_log_rotate_on_size</code> が 0 (デフォルト) の場合、手動で実行しないかぎり、ログローテーションは発生しません。 この場合、<code class="literal">audit_log_flush</code> の値が無効から有効に変更されると、監査ログプラグインはログファイルを閉じてから再度開きます。 ログファイル名の変更は、サーバーの外部で実行される必要があります。 ログファイル名が <code class="filename">audit.log</code> で、<code class="filename">audit.log.3</code> を介して <code class="filename">audit.log.1</code> という名前を循環して、最新の 3 つのログファイルを保持するとします。 Unix 上で、次のように手動でローテーションを実行します。 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              コマンド行から、現在のログファイル名を変更します。
            </p><pre class="programlisting">mv audit.log.2 audit.log.3
mv audit.log.1 audit.log.2
mv audit.log audit.log.1
</pre><p>
              この方法では、現在の <code class="filename">audit.log.3</code> コンテンツが上書きされ、アーカイブログファイルの数とそれらが使用する領域にバインドが配置されます。
            </p></li><li class="listitem"><p>
              この時点で、プラグインは引き続き、<code class="filename">audit.log.1</code> に名前が変更された現在のログファイルに書き込みます。 サーバーに接続し、ログファイルをフラッシュします。これにより、プラグインはログファイルを閉じて、新しい <code class="filename">audit.log</code> ファイルログを再度開きます。 
            </p><pre class="programlisting">SET GLOBAL audit_log_flush = ON;
</pre><p>
              <code class="literal">audit_log_flush</code> は、その値が <code class="literal">OFF</code> のままであるため、別のフラッシュを実行するために再度有効にする前に明示的に無効にする必要がないという点で特殊です。
            </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            圧縮または暗号化が有効になっている場合、ログファイル名には、有効な機能を示す接尾辞と、暗号化が有効になっている場合はパスワード ID が含まれます。 ファイル名にパスワード ID が含まれている場合は、復号化操作に使用するパスワードを決定できるように、手動で名前を変更するファイルの名前に ID を保持してください。 
          </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            JSON 形式のロギングの場合、監査ログファイルの名前を手動で変更すると、監査ログプラグインはログファイル順序の一部であると判断できなくなるため、ログ読取り機能で使用できなくなります (<a class="xref" href="security.html#audit-log-file-reading" title="6.4.5.6 監査ログファイルの読取り">セクション6.4.5.6「監査ログファイルの読取り」</a> を参照)。 かわりに、サイズベースのローテーションを使用するように 0 より大きい <code class="literal">audit_log_rotate_on_size</code> を設定することを検討してください。 
          </p></div><h6><a name="audit-log-size-based-rotation"></a>サイズベースの監査ログファイルのローテーション</h6><p>
          <code class="literal">audit_log_rotate_on_size</code> が 0 よりも大きい場合は、<code class="literal">audit_log_flush</code> を設定しても効果がありません。 代わりに、現在のログファイルへの書き込みによってそのサイズが <code class="literal">audit_log_rotate_on_size</code> 値を超えるたびに、監査ログプラグインは自動的にファイルを閉じて名前を変更し、新しいログファイルを開きます。 
        </p><p>
          自動サイズベースローテーションは、次の条件下でも発生します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              プラグインの初期化中に、監査ログファイル名を持つファイルがすでに存在する場合 (<a class="xref" href="security.html#audit-log-file-name" title="監査ログファイルのネーミング規則">監査ログファイルのネーミング規則</a> を参照)。
            </p></li><li class="listitem"><p>
              プラグインの終了時。
            </p></li><li class="listitem"><p>
              暗号化が有効になっている場合に、<code class="literal">audit_log_encryption_password_set()</code> 関数をコールして暗号化パスワードを設定するとき。 (暗号化が無効になっている場合、ローテーションは行われません。) 
            </p></li></ul></div><p>
          プラグインは、ベース名の直後にタイムスタンプを挿入して、元のファイルの名前を変更します。 たとえば、ファイル名が <code class="filename">audit.log</code> の場合、プラグインはその名前を <code class="filename">audit.20190115T140633.log</code> などの値に変更します。 タイムスタンプは、<code class="literal"><em class="replaceable"><code>YYYYMMDD</code></em>T<em class="replaceable"><code>hhmmss</code></em></code> 形式の UTC 値です。 タイムスタンプは、XML ロギングのローテーション時間と、JSON ロギングのためにファイルに最後に書き込まれたイベントのタイムスタンプを示します。 
        </p><h6><a name="audit-log-pruning"></a>監査ログファイルのプルーニング</h6><p>
          MySQL 8.0.24 では、監査ログプラグインは JSON 形式の監査ログファイルのプルーニングをサポートしています。 この機能を有効にするには: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_format</code> を <code class="literal">JSON</code> に設定します。
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_rotate_on_size</code> を 0 より大きい値に設定して、ログファイルのローテーションが発生するサイズを指定します。
            </p></li><li class="listitem"><p>
              0 より大きい <code class="literal">audit_log_prune_seconds</code> を設定して、ログファイルがプルーニングの対象になるまでの秒数を指定します。
            </p></li></ul></div><p>
          ログファイルのプルーニングは、次の条件下で発生します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              プラグインの初期化中。
            </p></li><li class="listitem"><p>
              現在のログファイルがローテーションサイズを超えたためにサイズベースの自動ローテーションが発生した場合。
            </p></li><li class="listitem"><p>
              <code class="literal">SET GLOBAL audit_log_prune_seconds</code> が実行時に実行される場合。
            </p></li></ul></div><p>
          プルーニングポイントは、現在の時間から <code class="literal">audit_log_prune_seconds</code> の値を引いた値です。 ローテーションされた JSON 形式のログファイルでは、各ファイル名のタイムスタンプ部分は、ファイルに最後に書き込まれたイベントのタイムスタンプを示します。 プルーニングが発生すると、監査ログプラグインはファイル名のタイムスタンプを使用して、プルーニングポイントより古いイベントのみを含むファイルを特定し、それらを削除します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-strategy"></a>監査ロギングの書込み戦略</h5></div></div></div><p>
          監査プラグインは、ログの書き込みに関する複数の戦略のいずれかを使用できます。 戦略に関係なく、ロギングはベストエフォートベーシスで発生するため、一貫性は保証されません。 
        </p><p>
          書込み戦略を指定するには、サーバーの起動時に <code class="literal">audit_log_strategy</code> システム変数を設定します。 デフォルトでは、戦略の値は <code class="literal">ASYNCHRONOUS</code> であり、プラグインは非同期的にログをバッファーに記録し、バッファーがいっぱいの場合は待機します。 ファイルシステムのキャッシュ処理を使用するか (<code class="literal">SEMISYNCHRONOUS</code>)、各書き込みリクエストのあとに <code class="literal">sync()</code> を呼び出して出力を強制すれば (<code class="literal">SYNCHRONOUS</code>)、待機しないように (<code class="literal">PERFORMANCE</code>)、または同期的にログを記録するようにプラグインに指示できます。 
        </p><p>
          非同期書込み戦略の場合、<code class="literal">audit_log_buffer_size</code> システム変数はバイト単位のバッファサイズです。 バッファサイズを変更するには、サーバー起動時にこの変数を設定します。 このプラグインでは、初期化時に割り当てられ、終了時に削除される単一のバッファーが使用されます。 プラグインは、このバッファーを非同期でない書き込み戦略に割り当てません。 
        </p><p>
          非同期ロギングの戦略には、次のような特性があります。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              サーバーのパフォーマンスと拡張性への影響が最小限です。
            </p></li><li class="listitem"><p>
              できるかぎり最短の時間 (つまり、バッファーを割り当てる時間とそのバッファーにイベントをコピーする時間を足した時間) で、監査イベントを生成するスレッドをブロックします。
            </p></li><li class="listitem"><p>
              出力はバッファーに書き込まれます。 個別のスレッドがバッファーからログファイルへの書き込みに対処します。 
            </p></li></ul></div><p>
          非同期ロギングでは、ファイルへの書込み中に問題が発生した場合、またはプラグインが正常に停止しない場合 (サーバーホストが予期せず終了した場合など)、ログファイルの整合性が損なわれる可能性があります。 このリスクを減らすには、同期ロギングが使用されるように <code class="literal">audit_log_strategy</code> を設定します。 
        </p><p>
          <code class="literal">PERFORMANCE</code> 戦略のデメリットは、バッファーがいっぱいの場合にイベントが破棄される点です。 負荷の高いサーバーの場合、監査ログにイベントが欠落している可能性があります。 
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-file-reading"></a>6.4.5.6 監査ログファイルの読取り</h4></div></div></div><p>
        監査ログプラグインは、JSON 形式の監査ログファイルを読み取るための SQL インタフェースを提供するユーザー定義関数をサポートしています。 (この機能は、他の形式で書き込まれたログファイルには適用されません。) 
      </p><p>
        監査ログプラグインが初期化され、JSON ロギング用に構成されている場合、読み取り可能な監査ログファイルを検索する場所として、現在の監査ログファイルを含むディレクトリが使用されます。 プラグインは、<code class="literal">audit_log_file</code> システム変数の値からファイルの場所、ベース名および接尾辞を決定し、次のパターンに一致する名前のファイルを検索します (<code class="literal">[...]</code>はオプションのファイル名部分を示します): 
      </p><a class="indexterm" name="idm46723752171344"></a><a class="indexterm" name="idm46723752169824"></a><pre class="programlisting"><em class="replaceable"><code>basename</code></em>[.<em class="replaceable"><code>timestamp</code></em>].<em class="replaceable"><code>suffix</code></em>[.gz][[.<em class="replaceable"><code>pwd_id</code></em>].enc]
</pre><p>
        ファイル名が <code class="filename">.enc</code> で終わる場合、ファイルは暗号化され、暗号化されていない内容を読み取るには、キーリングから取得した復号化パスワードが必要です。 監査ログプラグインは、復号化パスワードの鍵リング ID を次のように決定します: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename">.enc</code> の前に <em class="replaceable"><code>pwd_id</code></em> がある場合、キーリング ID は <code class="literal">audit_log-<em class="replaceable"><code>pwd_id</code></em> </code>です。
          </p></li><li class="listitem"><p>
            <code class="filename">.enc</code> の前に <em class="replaceable"><code>pwd_id</code></em> が付いていない場合、監査ログの暗号化パスワード履歴が実装される前からの古い名前がファイルに含まれます。 キーリング ID は <code class="literal">audit_log</code> です。 
          </p></li></ul></div><p>
        暗号化された監査ログファイルの詳細は、<a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a> を参照してください。
      </p><p>
        プラグインは、手動で名前が変更され、パターンと一致しないファイルと、パスワードで暗号化されたファイルがキーリングで使用できなくなったファイルを無視します。 プラグインは残りの各候補ファイルを開き、ファイルに <code class="literal">JSON</code> 監査イベントが実際に含まれていることを確認し、各ファイルの最初のイベントのタイムスタンプを使用してファイルをソートします。 その結果、ログ読取りユーザー定義関数 (UDF) を使用してアクセスされる一連のファイルが生成されます: 
      </p><a class="indexterm" name="idm46723752153040"></a><a class="indexterm" name="idm46723752151472"></a><a class="indexterm" name="idm46723752149568"></a><a class="indexterm" name="idm46723752147968"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_read()</code> は、監査ログからイベントを読み取るか、読取りプロセスをクローズします。
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_read_bookmark()</code> は、最後に書き込まれた監査ログイベントのブックマークを返します。 このブックマークは、読取りを開始する場所を示すために <code class="literal">audit_log_read()</code> に渡すのに適しています。 
          </p></li></ul></div><p>
        <code class="literal">audit_log_read()</code> はオプションの <code class="literal">JSON</code> 文字列引数を取り、いずれかの関数のコールが成功したときに返される結果は <code class="literal">JSON</code> 文字列です。
      </p><p>
        関数を使用して監査ログを読み取るには、次の原則に従います:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_read()</code> をコールして、特定の位置または現在の位置から開始するイベントを読み取るか、検針をクローズします:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                監査ログの読取り順序を初期化するには、開始位置を示す引数を渡します。 これを行うには、<code class="literal">audit_log_read_bookmark()</code> によって返されたブックマークを渡す方法があります: 
              </p><pre class="programlisting">SELECT audit_log_read(audit_log_read_bookmark());
</pre></li><li class="listitem"><p>
                順序内の現在の位置からの読取りを続行するには、位置を指定せずに <code class="literal">audit_log_read()</code> をコールします:
              </p><pre class="programlisting">SELECT audit_log_read();
</pre></li><li class="listitem"><p>
                読取り順序を明示的にクローズするには、<code class="literal">JSON</code> <code class="literal">null</code> 引数を渡します:
              </p><pre class="programlisting">SELECT audit_log_read('null');
</pre><p>
                読取りを明示的にクローズする必要はありません。 読取りは、セッションが終了するか、開始位置を示す引数を指定して <code class="literal">audit_log_read()</code> をコールすることで、新しい読取り順序が初期化されると暗黙的にクローズされます。 
              </p></li></ul></div></li><li class="listitem"><p>
            <code class="literal">audit_log_read()</code> を正常にコールしてイベントを読み取ると、監査イベントの配列を含む <code class="literal">JSON</code> 文字列が返されます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                返された配列の最終値が <code class="literal">JSON</code> <code class="literal">null</code> 値でない場合は、読み取られたばかりのイベントのあとにさらにイベントが存在し、<code class="literal">audit_log_read()</code> を再度呼び出してさらに多くのイベントを読み取ることができます。
              </p></li><li class="listitem"><p>
                返される配列の最終値が <code class="literal">JSON</code> <code class="literal">null</code> 値である場合、現在の読取り順序で読み取られるイベントは残っていません。
              </p></li></ul></div><p>
            <code class="literal">null</code> 以外の各配列要素は、<code class="literal">JSON</code> ハッシュとして表されるイベントです。 例: 
          </p><pre class="programlisting">[
  {
    "timestamp": "2020-05-18 13:39:33", "id": 0,
    "class": "connection", "event": "connect",
    ...
  },
  {
    "timestamp": "2020-05-18 13:39:33", "id": 1,
    "class": "general", "event": "status",
    ...
  },
  {
    "timestamp": "2020-05-18 13:39:33", "id": 2,
    "class": "connection", "event": "disconnect",
    ...
  },
  null
]
</pre><p>
            JSON 形式の監査イベントの内容の詳細は、<a class="xref" href="security.html#audit-log-file-json-format" title="JSON 監査ログファイル形式">JSON 監査ログファイル形式</a> を参照してください。
          </p></li><li class="listitem"><p>
            位置を指定しないイベントを読み取る <code class="literal">audit_log_read()</code> コールは、次のいずれかの条件下でエラーを生成します:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                読取り順序は、<code class="literal">audit_log_read()</code> に位置を渡して初期化されていません。
              </p></li><li class="listitem"><p>
                現在の読み取りシーケンスで読み取られるイベントは残っていません。つまり、<code class="literal">audit_log_read()</code> は以前に <code class="literal">JSON</code> <code class="literal">null</code> 値で終わる配列を返しました。
              </p></li><li class="listitem"><p>
                最新の読取り順序は、<code class="literal">JSON</code> <code class="literal">null</code> 値を <code class="literal">audit_log_read()</code> に渡すことでクローズされました。
              </p></li></ul></div><p>
            これらの条件下でイベントを読み取るには、まず位置を指定する引数を使用して <code class="literal">audit_log_read()</code> をコールし、読取り順序を初期化する必要があります。
          </p></li></ul></div><p>
        <code class="literal">audit_log_read()</code> の位置を指定するには、読取りを開始する場所を示す引数を含めます。 たとえば、特定のイベントを一意に識別する <code class="literal">timestamp</code> および <code class="literal">id</code> 要素を含む <code class="literal">JSON</code> ハッシュであるブックマークを渡します。 次に、<code class="literal">audit_log_read_bookmark()</code> 関数をコールして取得したブックマークの例を示します: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_read_bookmark();</code></strong>
+-------------------------------------------------+
| audit_log_read_bookmark()                       |
+-------------------------------------------------+
| { "timestamp": "2020-05-18 21:03:44", "id": 0 } |
+-------------------------------------------------+
</pre><p>
        現在のブックマークを <code class="literal">audit_log_read()</code> に渡すと、ブックマーク位置から始まるイベント読取りが初期化されます:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_read(audit_log_read_bookmark());</code></strong>
+-----------------------------------------------------------------------+
| audit_log_read(audit_log_read_bookmark())                             |
+-----------------------------------------------------------------------+
| [ {"timestamp":"2020-05-18 22:41:24","id":0,"class":"connection", ... |
+-----------------------------------------------------------------------+
</pre><p>
        <code class="literal">audit_log_read()</code> の引数はオプションです。 存在する場合は、読取り順序をクローズする <code class="literal">JSON</code> <code class="literal">null</code> 値または <code class="literal">JSON</code> ハッシュを指定できます。 
      </p><p>
        <code class="literal">audit_log_read()</code> のハッシュ引数内では、項目はオプションであり、読取りを開始する位置や読み取るイベントの数など、読取り操作の側面を制御します。 次の項目は重要です (他の項目は無視されます): 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">start</code>: 最初に読み取るイベントの監査ログ内の位置。 位置はタイムスタンプとして指定され、タイムスタンプ値以降に発生する最初のイベントから読取りが開始されます。 <code class="literal">start</code> アイテムの形式は次のとおりです。ここで、<em class="replaceable"><code>value</code></em> はリテラルのタイムスタンプ値です: 
          </p><pre class="programlisting">"start": { "timestamp": "<em class="replaceable"><code>value</code></em>" }
</pre><p>
            <code class="literal">start</code> 品目は、MySQL 8.0.22 で許可されています。
          </p></li><li class="listitem"><p>
            <code class="literal">timestamp</code>, <code class="literal">id</code>: 最初に読み取るイベントの監査ログ内の位置。 <code class="literal">timestamp</code> アイテムと <code class="literal">id</code> アイテムは、特定のイベントを一意に識別するブックマークで構成されます。 <code class="literal">audit_log_read()</code> 引数にいずれかの項目が含まれている場合、位置を完全に指定するには両方を含める必要があります。そうしないと、エラーが発生します。 
          </p></li><li class="listitem"><p>
            <code class="literal">max_array_length</code>: ログから読み取るイベントの最大数。 この項目を省略した場合、デフォルトでは、ログの最後まで、または読取りバッファがいっぱいになるまで (いずれか早い方まで) 読み取られます。 
          </p></li></ul></div><p>
        開始位置を <code class="literal">audit_log_read()</code> に指定するには、<code class="literal">start</code> アイテムまたは <code class="literal">timestamp</code> アイテムと <code class="literal">id</code> アイテムで構成されるブックマークを含むハッシュ引数を渡します。 ハッシュ引数に <code class="literal">start</code> アイテムとブックマークの両方が含まれている場合は、エラーが発生します。 
      </p><p>
        ハッシュ引数で開始位置が指定されていない場合、読取りは現在の位置から続行されます。
      </p><p>
        タイムスタンプ値に時間部分が含まれていない場合は、<code class="literal">00:00:00</code> の時間部分が想定されます。
      </p><p>
        <code class="literal">audit_log_read()</code> で受け入れられる引数の例:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            指定されたタイムスタンプ以降に発生する最初のイベントから開始するイベントを読み取ります:
          </p><pre class="programlisting">audit_log_read('{ "start": { "timestamp": "2020-05-24 12:30:00" } }')
</pre></li><li class="listitem"><p>
            前の例と似ていますが、最大 3 つのイベントを読み取ります:
          </p><pre class="programlisting">audit_log_read('{ "start": { "timestamp": "2020-05-24 12:30:00" }, "max_array_length": 3 }')
</pre></li><li class="listitem"><p>
            <code class="literal">2020-05-24 00:00:00</code> 以降に発生する最初のイベントから始まるイベントを読み取ります (タイムスタンプには時間部分が含まれないため、<code class="literal">00:00:00</code> が想定されます):
          </p><pre class="programlisting">audit_log_read('{ "start": { "timestamp": "2020-05-24" } }')
</pre></li><li class="listitem"><p>
            正確なタイムスタンプとイベント ID を持つイベントで始まるイベントを読み取ります:
          </p><pre class="programlisting">audit_log_read('{ "timestamp": "2020-05-24 12:30:00", "id": 0 }')
</pre></li><li class="listitem"><p>
            前の例と似ていますが、最大 3 つのイベントを読み取ります:
          </p><pre class="programlisting">audit_log_read('{ "timestamp": "2020-05-24 12:30:00", "id": 0, "max_array_length": 3 }')
</pre></li><li class="listitem"><p>
            検針シーケンスの現在の位置からイベントを読み取ります:
          </p><pre class="programlisting">audit_log_read()
</pre></li><li class="listitem"><p>
            検針シーケンスの現在の位置から開始する最大 5 つのイベントを読み取ります:
          </p><pre class="programlisting">audit_log_read('{ "max_array_length": 5 }')
</pre></li><li class="listitem"><p>
            現在の検針シーケンスをクローズします:
          </p><pre class="programlisting">audit_log_read('null')
</pre></li></ul></div><p>
        いずれかのログ読取り関数から返された <code class="literal">JSON</code> 文字列は、必要に応じて操作できます。 ブックマークを取得するコールによって次の値が生成されるとします: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET @mark := audit_log_read_bookmark();</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT @mark;</code></strong>
+-------------------------------------------------+
| @mark                                           |
+-------------------------------------------------+
| { "timestamp": "2020-05-18 16:10:28", "id": 2 } |
+-------------------------------------------------+
</pre><p>
        その引数を使用して <code class="literal">audit_log_read()</code> をコールすると、複数のイベントを返すことができます。 <code class="literal">audit_log_read()</code> を最大 <em class="replaceable"><code>N</code></em> イベント数に制限するには、その値を持つ <code class="literal">max_array_length</code> アイテムを文字列に追加します。 たとえば、単一のイベントを読み取るには、次のように文字列を変更します: 
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET @mark := JSON_SET(@mark, '$.max_array_length', 1);</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT @mark;</code></strong>
+----------------------------------------------------------------------+
| @mark                                                                |
+----------------------------------------------------------------------+
| {"id": 2, "timestamp": "2020-05-18 16:10:28", "max_array_length": 1} |
+----------------------------------------------------------------------+
</pre><p>
        変更された文字列が <code class="literal">audit_log_read()</code> に渡されると、使用可能なイベントの数に関係なく、最大 1 つのイベントを含む結果が生成されます。
      </p><p>
        MySQL 8.0.19 より前では、監査ログ UDF からの文字列の戻り値はバイナリ文字列です。 バイナリ以外の文字列 (<code class="literal">JSON</code> 値を操作する関数など) を必要とする関数でバイナリ文字列を使用するには、バイナリ以外の文字列に変換します。 たとえば、ブックマークを <code class="literal">JSON_SET()</code> に渡す前に、次のように <code class="literal">utf8mb4</code> に変換します: 
      </p><pre class="programlisting">SET @mark = CONVERT(@mark USING utf8mb4);
</pre><p>
        このステートメントは、MySQL 8.0.19 以上でも使用できます。これらのバージョンでは、基本的に no-op であり、無害です。
      </p><p>
        <code class="literal">audit_log_read()</code> が読み取るバイト数の制限を設定するには、<code class="literal">audit_log_read_buffer_size</code> システム変数を設定します。 MySQL 8.0.12 では、この変数のデフォルトは 32KB で、実行時に設定できます。 各クライアントは、<code class="literal">audit_log_read()</code> を使用するために <code class="literal">audit_log_read_buffer_size</code> のセッション値を適切に設定する必要があります。 
      </p><a class="indexterm" name="idm46723752012240"></a><a class="indexterm" name="idm46723752010672"></a><p>
        <code class="literal">audit_log_read()</code> をコールするたびに、バッファサイズ内に収まる数の使用可能なイベントが返されます。 バッファサイズ内に収まらないイベントはスキップされ、警告が生成されます。 この動作では、アプリケーションの適切なバッファサイズを評価する際に次の要因を考慮してください: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_read()</code> へのコール数とコールごとに返されるイベントとの間にはトレードオフがあります:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                バッファサイズを小さくすると、コールによって返されるイベントが少なくなるため、必要なコールが増えます。
              </p></li><li class="listitem"><p>
                バッファサイズが大きいほど、コールはより多くのイベントを返すため、必要なコールは少なくなります。
              </p></li></ul></div></li><li class="listitem"><p>
            デフォルトサイズの 32KB など、バッファサイズが小さいほど、イベントがバッファサイズを超えてスキップされる可能性が高くなります。
          </p></li></ul></div><p>
        MySQL 8.0.12 より前では、<code class="literal">audit_log_read_buffer_size</code> のデフォルトは 1MB で、すべてのクライアントに影響し、サーバーの起動時にのみ変更できます。
      </p><p>
        監査ログ読み取り関数の詳細は、<a class="xref" href="security.html#audit-log-routines" title="監査ログ関数">監査ログ関数</a> を参照してください。
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-filtering"></a>6.4.5.7 監査ログのフィルタリング</h4></div></div></div><a class="indexterm" name="idm46723751996208"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          このセクションでは、監査ログプラグインおよび付随する監査テーブルと UDF がインストールされている場合の監査ログのフィルタリングの動作について説明します。 プラグインがインストールされているが、付随する監査テーブルおよび UDF がインストールされていない場合、プラグインはレガシーフィルタリングモードで動作します (<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a> を参照)。 レガシーモードは、MySQL 5.7.13 より前、つまりルールベースのフィルタリングの導入前のフィルタリング動作です。 
        </p></div><p>
        監査ログプラグインには、監査対象イベントのロギングをフィルタリングして制御する機能があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            監査イベントは、次の特性を使用してフィルタできます:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                ユーザーアカウント
              </p></li><li class="listitem"><p>
                監査イベントクラス
              </p></li><li class="listitem"><p>
                監査イベントサブクラス
              </p></li><li class="listitem"><p>
                操作ステータスや実行された SQL ステートメントを示すイベントフィールドなどのイベントフィールドの値
              </p></li></ul></div></li><li class="listitem"><p>
            監査フィルタリングはルールベースです:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                フィルタ定義によって、一連の監査ルールが作成されます。 定義は、前述の特性に基づいてロギングのイベントを含めるか除外するように構成できます。 
              </p></li><li class="listitem"><p>
                フィルタルールには、イベントロギングの既存の機能に加えて、適格なイベントの実行をブロック (中断) する機能があります。
              </p></li><li class="listitem"><p>
                複数のフィルタを定義でき、任意の数のユーザーアカウントに任意のフィルタを割り当てることができます。
              </p></li><li class="listitem"><p>
                フィルタが明示的に割り当てられていないユーザーアカウントで使用するデフォルトフィルタを定義できます。
              </p></li></ul></div></li><li class="listitem"><p>
            監査フィルタは、ユーザー定義関数 (UDF) に基づく SQL インタフェースを使用して定義、表示および変更できます。
          </p></li><li class="listitem"><p>
            監査フィルタ定義は、<code class="literal">mysql</code> システムデータベースのテーブルに格納されます。
          </p></li><li class="listitem"><p>
            特定のセッション内で、読取り専用 <code class="literal">audit_log_filter_id</code> システム変数の値は、フィルタがセッションに割り当てられているかどうかを示します。
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          デフォルトでは、ルールベースの監査ログのフィルタリングでは、ユーザーの監査可能なイベントは記録されません。 すべてのユーザーのすべての監査可能イベントをログに記録するには、次のステートメントを使用します。これにより、ロギングを有効にしてデフォルトアカウントに割り当てる単純なフィルタが作成されます: 
        </p><pre class="programlisting">SELECT audit_log_filter_set_filter('log_all', '{ "filter": { "log": true } }');
SELECT audit_log_filter_set_user('%', 'log_all');
</pre><p>
          <code class="literal">%</code> に割り当てられたフィルタは、フィルタが明示的に割り当てられていないアカウントからの接続に使用されます (最初はすべてのアカウントに適用されます)。
        </p></div><p>
        次のリストに、監査フィルタリング制御用の SQL インタフェースを実装する UDF の概要を示します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">audit_log_filter_set_filter()</code>: フィルタの定義
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_filter_remove_filter()</code>: フィルタの削除
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_filter_set_user()</code>: ユーザーアカウントのフィルタリングの開始
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_filter_remove_user()</code>: ユーザーアカウントのフィルタリングの停止
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log_filter_flush()</code>: フィルタテーブルへの手動変更をフラッシュして、進行中のフィルタリングに影響を与えます
          </p></li></ul></div><p>
        使用例およびフィルタリング関数の詳細は、<a class="xref" href="security.html#audit-log-filtering-functions" title="監査ログフィルタリング関数の使用">監査ログフィルタリング関数の使用</a> および <a class="xref" href="security.html#audit-log-routines" title="監査ログ関数">監査ログ関数</a> を参照してください。
      </p><p>
        監査ログのフィルタリング関数には、次の制約があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            フィルタリング関数を使用するには、<code class="literal">audit_log</code> プラグインを有効にする必要があります。有効にしないと、エラーが発生します。 また、監査テーブルが存在する必要があり、存在しない場合はエラーが発生します。 <code class="literal">audit_log</code> プラグインとそれに付随する UDF およびテーブルをインストールするには、<a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 MySQL Enterprise Audit のインストールまたはアンインストール">セクション6.4.5.2「MySQL Enterprise Audit のインストールまたはアンインストール」</a> を参照してください。 
          </p></li><li class="listitem"><p>
            フィルタリング機能を使用するには、ユーザーが <code class="literal">SUPER</code> 権限を持っている必要があり、持っていない場合はエラーが発生します。 <code class="literal">SUPER</code> 権限をユーザーアカウントに付与するには、次のステートメントを使用します: 
          </p><pre class="programlisting">GRANT SUPER ON *.* TO <em class="replaceable"><code>user</code></em>;
</pre><p>
            または、ユーザーに特定のフィルタリング関数へのアクセスを許可しながら <code class="literal">SUPER</code> 権限を付与しないようにする場合は、<span class="quote">「<span class="quote">「ラッパー」</span>」</span>ストアドプログラムを定義できます。 この手法については、<a class="xref" href="security.html#keyring-function-usage" title="汎用キーリング関数の使用">汎用キーリング関数の使用</a> での UDF のキー設定のコンテキストで説明されています。UDF のフィルタリングでの使用に適応できます。 
          </p></li><li class="listitem"><p>
            <code class="literal">audit_log</code> プラグインは、インストールされているが、付随する監査テーブルおよび関数が作成されていない場合、レガシーモードで動作します。 プラグインは、サーバーの起動時に次のメッセージをエラーログに書き込みます: 
          </p><a class="indexterm" name="idm46723751943536"></a><pre class="programlisting">[Warning] Plugin audit_log reported: 'Failed to open the audit log filter tables.'
[Warning] Plugin audit_log reported: 'Audit Log plugin supports a filtering,
which has not been installed yet. Audit Log plugin will run in the legacy
mode, which will be disabled in the next release.'
</pre><p>
            レガシーモードでは、フィルタリングはイベントアカウントまたはステータスにのみ実行できます。 詳細は、<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a>を参照してください。 
          </p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-functions" title="監査ログフィルタリング関数の使用">監査ログフィルタリング関数の使用</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-functions"></a>監査ログフィルタリング関数の使用</h5></div></div></div><p>
          監査ログのユーザー定義関数 (UDF) を使用する前に、<a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 MySQL Enterprise Audit のインストールまたはアンインストール">セクション6.4.5.2「MySQL Enterprise Audit のインストールまたはアンインストール」</a> の指示に従ってインストールします。 これらの関数を使用するには、<code class="literal">SUPER</code> 権限が必要です。 
        </p><p>
          監査ログのフィルタリング機能を使用すると、フィルタ定義を作成、変更および削除し、ユーザーアカウントにフィルタを割り当てるためのインタフェースを提供することで、フィルタリングを制御できます。
        </p><p>
          フィルタ定義は <code class="literal">JSON</code> 値です。 MySQL での <code class="literal">JSON</code> データの使用の詳細は、<a class="xref" href="data-types.html#json" title="11.5 JSON データ型">セクション11.5「JSON データ型」</a> を参照してください。 このセクションでは、単純なフィルタ定義をいくつか示します。 フィルタ定義の詳細は、<a class="xref" href="security.html#audit-log-filter-definitions" title="6.4.5.8 監査ログフィルタ定義の書込み">セクション6.4.5.8「監査ログフィルタ定義の書込み」</a> を参照してください。 
        </p><p>
          接続が到着すると、監査ログプラグインは、現在のフィルタ割り当てでユーザーアカウント名を検索して、新しいセッションに使用するフィルタを決定します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              フィルタがユーザーに割り当てられている場合、監査ログはそのフィルタを使用します。
            </p></li><li class="listitem"><p>
              それ以外の場合、ユーザー固有のフィルタ割当てが存在せず、デフォルトアカウント (<code class="literal">%</code>) にフィルタが割り当てられていると、監査ログではデフォルトフィルタが使用されます。
            </p></li><li class="listitem"><p>
              それ以外の場合、監査ログはセッションから処理する監査イベントを選択しません。
            </p></li></ul></div><p>
          セッション中に変更ユーザー操作が発生した場合 (<a class="ulink" href="https://dev.mysql.com/doc/c-api/8.0/en/mysql-change-user.html" target="_top">mysql_change_user()</a> を参照)、セッションのフィルタ割当ては同じルールを使用して更新されますが、新規ユーザーの場合です。
        </p><p>
          デフォルトでは、アカウントにフィルタが割り当てられていないため、どのアカウントに対しても監査可能なイベントの処理は行われません。
        </p><p>
          かわりに、デフォルトで接続関連のアクティビティのみをログに記録するとします (たとえば、接続、変更ユーザーおよび切断イベントは表示しますが、接続中にユーザーが実行する SQL ステートメントは表示しません)。 これを実現するには、<code class="literal">connection</code> クラスのイベントのみのロギングを有効にするフィルタ (ここでは <code class="literal">log_conn_events</code> という名前) を定義し、そのフィルタを <code class="literal">%</code> アカウント名で表されるデフォルトアカウントに割り当てます: 
        </p><pre class="programlisting">SET @f = '{ "filter": { "class": { "name": "connection" } } }';
SELECT audit_log_filter_set_filter('log_conn_events', @f);
SELECT audit_log_filter_set_user('%', 'log_conn_events');
</pre><p>
          監査ログでは、フィルタが明示的に定義されていないアカウントからの接続に、このデフォルトのアカウントフィルタが使用されるようになりました。
        </p><p>
          フィルタを特定のユーザーアカウントに明示的に割り当てるには、フィルタを定義してから、関連するアカウントに割り当てます:
        </p><pre class="programlisting">SELECT audit_log_filter_set_filter('log_all', '{ "filter": { "log": true } }');
SELECT audit_log_filter_set_user('user1@localhost', 'log_all');
SELECT audit_log_filter_set_user('user2@localhost', 'log_all');
</pre><p>
          これで、<code class="literal">user1@localhost</code> および <code class="literal">user2@localhost</code> の完全ロギングが有効になりました。 他のアカウントからの接続は、デフォルトのアカウントフィルタを使用して引き続きフィルタされます。 
        </p><p>
          ユーザーアカウントと現在のフィルタの関連付けを解除するには、フィルタの割当てを解除するか、別のフィルタを割り当てます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              ユーザーアカウントからフィルタの割当てを解除するには:
            </p><pre class="programlisting">SELECT audit_log_filter_remove_user('user1@localhost');
</pre><p>
              アカウントの現在のセッションのフィルタリングは影響を受けません。 アカウントからの後続の接続は、デフォルトのアカウントフィルタ (存在する場合) を使用してフィルタされ、それ以外の場合はログに記録されません。 
            </p></li><li class="listitem"><p>
              ユーザーアカウントに別のフィルタを割り当てるには:
            </p><pre class="programlisting">SELECT audit_log_filter_set_filter('log_nothing', '{ "filter": { "log": false } }');
SELECT audit_log_filter_set_user('user1@localhost', 'log_nothing');
</pre><p>
              アカウントの現在のセッションのフィルタリングは影響を受けません。 アカウントからの後続の接続は、新しいフィルタを使用してフィルタ処理されます。 ここに示すフィルタの場合、<code class="literal">user1@localhost</code> からの新規接続のロギングがないことを意味します。 
            </p></li></ul></div><p>
          監査ログのフィルタリングでは、ユーザー名とホスト名の比較で大/小文字が区別されます。 これは、ホスト名の比較で大/小文字が区別されない権限チェックの比較とは異なります。 
        </p><p>
          フィルタを削除するには、次のようにします:
        </p><pre class="programlisting">SELECT audit_log_filter_remove_filter('log_nothing');
</pre><p>
          フィルタを削除すると、そのフィルタが割り当てられているユーザー (それらのユーザーの現在のセッションを含む) からもフィルタの割当てが解除されます。
        </p><p>
          ここで説明したフィルタ UDF は、監査フィルタリングにすぐに影響し、フィルタおよびユーザーアカウントを格納する <code class="literal">mysql</code> システムデータベースの監査ログテーブルを更新します (<a class="xref" href="security.html#audit-log-tables" title="監査ログテーブル">監査ログテーブル</a> を参照)。 <code class="literal">INSERT</code>、<code class="literal">UPDATE</code>、<code class="literal">DELETE</code> などのステートメントを使用して監査ログテーブルを直接変更することもできますが、このような変更はフィルタリングにすぐには影響しません。 変更をフラッシュして操作可能にするには、<code class="literal">audit_log_filter_flush()</code> をコールします: 
        </p><pre class="programlisting">SELECT audit_log_filter_flush();
</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
            <code class="literal">audit_log_filter_flush()</code> は、すべてのフィルタを強制的にリロードするために、監査テーブルを直接変更した後にのみ使用してください。 それ以外の場合は、この関数を使用しないでください。 実際には、<code class="literal">UNINSTALL PLUGIN</code> と <code class="literal">INSTALL PLUGIN</code> を使用した <code class="literal">audit_log</code> プラグインのアンロードおよびリロードの簡略化されたバージョンです。 
          </p><p>
            <code class="literal">audit_log_filter_flush()</code> は、現在のすべてのセッションに影響を与え、以前のフィルタからデタッチします。 現在のセッションは、切断して再接続するか、ユーザー変更操作を実行しないかぎり、ログに記録されなくなります。 
          </p></div><p>
          フィルタが現在のセッションに割り当てられているかどうかを確認するには、読取り専用 <code class="literal">audit_log_filter_id</code> システム変数のセッション値を確認します。 値が 0 の場合、フィルタは割り当てられません。 ゼロ以外の値は、割り当てられたフィルタの内部的に保持されている ID を示します: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT @@audit_log_filter_id;</code></strong>
+-----------------------+
| @@audit_log_filter_id |
+-----------------------+
|                     2 |
+-----------------------+
</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-filter-definitions"></a>6.4.5.8 監査ログフィルタ定義の書込み</h4></div></div></div><p>
        フィルタ定義は <code class="literal">JSON</code> 値です。 MySQL での <code class="literal">JSON</code> データの使用の詳細は、<a class="xref" href="data-types.html#json" title="11.5 JSON データ型">セクション11.5「JSON データ型」</a> を参照してください。 
      </p><p>
        フィルタ定義の形式は次のとおりです。ここで、<em class="replaceable"><code>actions</code></em> はフィルタリングの実行方法を示します:
      </p><pre class="programlisting">{ "filter": <em class="replaceable"><code>actions</code></em> }
</pre><p>
        次の説明では、フィルタ定義で許可される構成要素について説明します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-enabling-logging" title="すべてのイベントのロギング">すべてのイベントのロギング</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-class-logging" title="ロギング固有のイベントクラス">ロギング固有のイベントクラス</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-subclass-logging" title="特定のイベントサブクラスのロギング">特定のイベントサブクラスのロギング</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-inclusive-exclusive" title="包括的および排他的ロギング">包括的および排他的ロギング</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-event-fields" title="イベントフィールド値のテスト">イベントフィールド値のテスト</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-blocking-events" title="特定のイベントの実行のブロック">特定のイベントの実行のブロック</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-logical-operators" title="論理演算子">論理演算子</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-predefined-variables" title="事前定義変数の参照">事前定義変数の参照</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-predefined-functions" title="事前定義関数の参照">事前定義関数の参照</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-filter-replacement" title="ユーザーフィルタの置換">ユーザーフィルタの置換</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-enabling-logging"></a>すべてのイベントのロギング</h5></div></div></div><p>
          すべてのイベントのロギングを明示的に有効または無効にするには、フィルタで <code class="literal">log</code> 要素を使用します:
        </p><pre class="programlisting">{
  "filter": { "log": true }
}
</pre><p>
          <code class="literal">log</code> の値は、<code class="literal">true</code> または <code class="literal">false</code> のいずれかです。
        </p><p>
          前述のフィルタは、すべてのイベントのロギングを有効にします。 これは次と同等です: 
        </p><pre class="programlisting">{
  "filter": { }
}
</pre><p>
          ロギングの動作は、<code class="literal">log</code> の値、および <code class="literal">class</code> アイテムと <code class="literal">event</code> アイテムのどちらが指定されているかによって異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">log</code> が指定されている場合は、指定された値が使用されます。
            </p></li><li class="listitem"><p>
              <code class="literal">log</code> が指定されていない場合、<code class="literal">class</code> または <code class="literal">event</code> アイテムが指定されていないとロギングは <code class="literal">true</code> になり、それ以外の場合は <code class="literal">false</code> になります (この場合、<code class="literal">class</code> または <code class="literal">event</code> に独自の <code class="literal">log</code> アイテムを含めることができます)。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-class-logging"></a>ロギング固有のイベントクラス</h5></div></div></div><p>
          特定のクラスのイベントをログに記録するには、ログに記録するクラスの名前を示す <code class="literal">name</code> フィールドとともに、フィルタで <code class="literal">class</code> 要素を使用します:
        </p><pre class="programlisting">{
  "filter": {
    "class": { "name": "connection" }
  }
}
</pre><p>
          <code class="literal">name</code> の値は、それぞれ <code class="literal">connection</code>、<code class="literal">general</code> または <code class="literal">table_access</code> で、接続、一般またはテーブルアクセスイベントをログに記録できます。
        </p><p>
          前述のフィルタは、<code class="literal">connection</code> クラスでのイベントのロギングを有効にします。 これは、明示的に作成された <code class="literal">log</code> アイテムの次のフィルタと同等です: 
        </p><pre class="programlisting">{
  "filter": {
    "log": false,
    "class": { "log": true,
               "name": "connection" }
  }
}
</pre><p>
          複数のクラスのロギングを有効にするには、クラスを指定する <code class="literal">JSON</code> 配列要素として <code class="literal">class</code> 値を定義します:
        </p><pre class="programlisting">{
  "filter": {
    "class": [
      { "name": "connection" },
      { "name": "general" },
      { "name": "table_access" }
    ]
  }
}
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            特定のアイテムの複数のインスタンスがフィルタ定義内の同じレベルに表示される場合、アイテム値を配列値内のそのアイテムの単一のインスタンスに結合できます。 前述の定義は、次のように記述できます: 
          </p><pre class="programlisting">{
  "filter": {
    "class": [
      { "name": [ "connection", "general", "table_access" ] }
    ]
  }
}
</pre></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-subclass-logging"></a>特定のイベントサブクラスのロギング</h5></div></div></div><p>
          特定のイベントサブクラスを選択するには、サブクラスを指定する <code class="literal">name</code> アイテムを含む <code class="literal">event</code> アイテムを使用します。 <code class="literal">event</code> アイテムによって選択されたイベントのデフォルトのアクションは、それらをログに記録することです。 たとえば、このフィルタは、指定されたイベントサブクラスのロギングを有効にします: 
        </p><pre class="programlisting">{
  "filter": {
    "class": [
      {
        "name": "connection",
        "event": [
          { "name": "connect" },
          { "name": "disconnect" }
        ]
      },
      { "name": "general" },
      {
        "name": "table_access",
        "event": [
          { "name": "insert" },
          { "name": "delete" },
          { "name": "update" }
        ]
      }
    ]
  }
}
</pre><p>
          <code class="literal">event</code> 品目には、適格なイベントをログに記録するかどうかを示す明示的な <code class="literal">log</code> 品目を含めることもできます。 この <code class="literal">event</code> アイテムは、複数のイベントを選択し、それらのロギング動作を明示的に示します: 
        </p><pre class="programlisting">"event": [
  { "name": "read", "log": false },
  { "name": "insert", "log": true },
  { "name": "delete", "log": true },
  { "name": "update", "log": true }
]
</pre><p>
          <code class="literal">event</code> 項目に <code class="literal">abort</code> 項目が含まれている場合は、該当するイベントをブロックするかどうかも指定できます。 詳細は、<a class="xref" href="security.html#audit-log-filtering-blocking-events" title="特定のイベントの実行のブロック">特定のイベントの実行のブロック</a>を参照してください。 
        </p><p>
          <a class="xref" href="security.html#audit-log-event-subclass-combinations" title="表 6.29 イベントクラスとサブクラスの組合せ">表6.29「イベントクラスとサブクラスの組合せ」</a> は、各イベントクラスに許可されるサブクラス値を記述します。
        </p><div class="table"><a name="audit-log-event-subclass-combinations"></a><p class="title"><b>表 6.29 イベントクラスとサブクラスの組合せ</b></p><div class="table-contents"><table summary="Permitted combiniations of event class and subclass values."><col style="width=20%"><col style="width=20%"><col style="width=60%"><thead><tr>
              <th scope="col">イベントクラス</th>
              <th scope="col">イベントサブクラス</th>
              <th scope="col">説明</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">接続</code></th>
              <td><code class="literal">connect</code></td>
              <td>接続の開始 (成功または失敗)</td>
            </tr><tr>
              <th scope="row"><code class="literal">接続</code></th>
              <td><code class="literal">change_user</code></td>
              <td>セッション中に異なるユーザー/パスワードでユーザーを再認証</td>
            </tr><tr>
              <th scope="row"><code class="literal">接続</code></th>
              <td><code class="literal">disconnect</code></td>
              <td>接続の終了</td>
            </tr><tr>
              <th scope="row"><code class="literal">general</code></th>
              <td><code class="literal">status</code></td>
              <td>一般的な操作情報</td>
            </tr><tr>
              <th scope="row"><code class="literal">message</code></th>
              <td><code class="literal">internal</code></td>
              <td>内部で生成されたメッセージ</td>
            </tr><tr>
              <th scope="row"><code class="literal">message</code></th>
              <td><code class="literal">user</code></td>
              <td><code class="literal">audit_api_message_emit_udf()</code> によって生成されたメッセージ</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">read</code></td>
              <td><code class="literal">SELECT</code> や <code class="literal">INSERT INTO ... SELECT</code> などのテーブル読取りステートメント</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">delete</code></td>
              <td><code class="literal">DELETE</code> や <code class="literal">TRUNCATE TABLE</code> などのテーブル削除ステートメント</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">挿入</code></td>
              <td><code class="literal">INSERT</code> や <code class="literal">REPLACE</code> などのテーブル挿入ステートメント</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">update</code></td>
              <td><code class="literal">UPDATE</code> などのテーブル更新ステートメント</td>
            </tr></tbody></table></div></div><br class="table-break"><p>
          <a class="xref" href="security.html#audit-log-event-subclass-log-abort" title="表 6.30 イベントクラスとサブクラスの組合せごとのログおよび中断特性">表6.30「イベントクラスとサブクラスの組合せごとのログおよび中断特性」</a> では、イベントサブクラスごとに、ログに記録できるか中断できるかが記述されます。
        </p><div class="table"><a name="audit-log-event-subclass-log-abort"></a><p class="title"><b>表 6.30 イベントクラスとサブクラスの組合せごとのログおよび中断特性</b></p><div class="table-contents"><table summary="Log and abort characteristics for event class and subclass combinations."><col style="width=20%"><col style="width=20%"><col style="width=30%"><col style="width=30%"><thead><tr>
              <th scope="col">イベントクラス</th>
              <th scope="col">イベントサブクラス</th>
              <th scope="col">記録可能</th>
              <th scope="col">中断可能</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">接続</code></th>
              <td><code class="literal">connect</code></td>
              <td>はい</td>
              <td>いいえ</td>
            </tr><tr>
              <th scope="row"><code class="literal">接続</code></th>
              <td><code class="literal">change_user</code></td>
              <td>はい</td>
              <td>いいえ</td>
            </tr><tr>
              <th scope="row"><code class="literal">接続</code></th>
              <td><code class="literal">disconnect</code></td>
              <td>はい</td>
              <td>いいえ</td>
            </tr><tr>
              <th scope="row"><code class="literal">general</code></th>
              <td><code class="literal">status</code></td>
              <td>はい</td>
              <td>いいえ</td>
            </tr><tr>
              <th scope="row"><code class="literal">message</code></th>
              <td><code class="literal">internal</code></td>
              <td>はい</td>
              <td>はい</td>
            </tr><tr>
              <th scope="row"><code class="literal">message</code></th>
              <td><code class="literal">user</code></td>
              <td>はい</td>
              <td>はい</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">read</code></td>
              <td>はい</td>
              <td>はい</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">delete</code></td>
              <td>はい</td>
              <td>はい</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">挿入</code></td>
              <td>はい</td>
              <td>はい</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_access</code></th>
              <td><code class="literal">update</code></td>
              <td>はい</td>
              <td>はい</td>
            </tr></tbody></table></div></div><br class="table-break"></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-inclusive-exclusive"></a>包括的および排他的ロギング</h5></div></div></div><p>
          フィルタは包含モードまたは排他モードで定義できます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              包含モードでは、明示的に指定された項目のみが記録されます。
            </p></li><li class="listitem"><p>
              排他モードでは、明示的に指定された項目以外はすべてログに記録されます。
            </p></li></ul></div><p>
          包括的ロギングを実行するには、ロギングをグローバルに無効にし、特定のクラスのロギングを有効にします。 このフィルタは、<code class="literal">connect</code> および <code class="literal">disconnect</code> イベントを <code class="literal">connection</code> クラスに記録し、イベントを <code class="literal">general</code> クラスに記録します: 
        </p><pre class="programlisting">{
  "filter": {
    "log": false,
    "class": [
      {
        "name": "connection",
        "event": [
          { "name": "connect", "log": true },
          { "name": "disconnect", "log": true }
        ]
      },
      { "name": "general", "log": true }
    ]
  }
}
</pre><p>
          排他的ロギングを実行するには、ロギングをグローバルに有効にし、特定のクラスのロギングを無効にします。 このフィルタは、<code class="literal">general</code> クラスのイベントを除くすべてのログを記録します: 
        </p><pre class="programlisting">{
  "filter": {
    "log": true,
    "class":
      { "name": "general", "log": false }
  }
}
</pre><p>
          このフィルタは、他のすべてをログに記録しないことによって、<code class="literal">change_user</code> イベントを <code class="literal">connection</code> クラス、<code class="literal">message</code> イベントおよび <code class="literal">table_access</code> イベントに記録します:
        </p><pre class="programlisting">{
  "filter": {
    "log": true,
    "class": [
      {
        "name": "connection",
        "event": [
          { "name": "connect", "log": false },
          { "name": "disconnect", "log": false }
        ]
      },
      { "name": "general", "log": false }
    ]
  }
}
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-event-fields"></a>イベントフィールド値のテスト</h5></div></div></div><p>
          特定のイベントフィールド値に基づいてロギングを有効にするには、フィールド名と予想される値を示す <code class="literal">field</code> アイテムを <code class="literal">log</code> アイテム内で指定します:
        </p><pre class="programlisting">{
  "filter": {
    "class": {
    "name": "general",
      "event": {
        "name": "status",
        "log": {
          "field": { "name": "general_command.str", "value": "Query" }
        }
      }
    }
  }
}
</pre><p>
          各イベントには、カスタムフィルタリングを実行するためにフィルタ内からアクセスできるイベントクラス固有のフィールドが含まれます。
        </p><p>
          接続イベントは、ユーザーがサーバーに接続したり、サーバーから切断したりするなど、セッション中に接続関連のアクティビティが発生したときを示します。<a class="xref" href="security.html#audit-log-connection-event-fields" title="表 6.31 接続イベントフィールド">表6.31「接続イベントフィールド」</a> は、接続イベントに許可されているフィールドを示します。
        </p><div class="table"><a name="audit-log-connection-event-fields"></a><p class="title"><b>表 6.31 接続イベントフィールド</b></p><div class="table-contents"><table summary="Permitted fields for connection events."><col style="width=35%"><col style="width=20%"><col style="width=45%"><thead><tr>
              <th scope="col">フィールド名</th>
              <th scope="col">フィールドタイプ</th>
              <th scope="col">説明</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">status</code></th>
              <td>整数</td>
              <td><p class="valid-value">
                  イベントステータス:
                </p><p class="valid-value">
                  0: OK
                </p><p class="valid-value">
                  それ以外の場合: 失敗
                </p></td>
            </tr><tr>
              <th scope="row"><code class="literal">connection_id</code></th>
              <td>unsigned integer</td>
              <td>接続 ID</td>
            </tr><tr>
              <th scope="row"><code class="literal">user.str</code></th>
              <td>文字列</td>
              <td>認証時に指定されたユーザー名</td>
            </tr><tr>
              <th scope="row"><code class="literal">user.length</code></th>
              <td>unsigned integer</td>
              <td>ユーザー名の長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">priv_user.str</code></th>
              <td>文字列</td>
              <td>認証されたユーザー名 (アカウントユーザー名)</td>
            </tr><tr>
              <th scope="row"><code class="literal">priv_user.length</code></th>
              <td>unsigned integer</td>
              <td>認証済ユーザー名の長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">external_user.str</code></th>
              <td>文字列</td>
              <td>外部ユーザー名 (サードパーティの認証プラグインによって提供される)</td>
            </tr><tr>
              <th scope="row"><code class="literal">external_user.length</code></th>
              <td>unsigned integer</td>
              <td>外部ユーザー名の長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">proxy_user.str</code></th>
              <td>文字列</td>
              <td>プロキシユーザー名</td>
            </tr><tr>
              <th scope="row"><code class="literal">proxy_user.length</code></th>
              <td>unsigned integer</td>
              <td>プロキシユーザー名の長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">host.str</code></th>
              <td>文字列</td>
              <td>接続ユーザーホスト</td>
            </tr><tr>
              <th scope="row"><code class="literal">host.length</code></th>
              <td>unsigned integer</td>
              <td>接続ユーザーホストの長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">ip.str</code></th>
              <td>文字列</td>
              <td>接続ユーザーの IP アドレス</td>
            </tr><tr>
              <th scope="row"><code class="literal">ip.length</code></th>
              <td>unsigned integer</td>
              <td>接続ユーザーの IP アドレスの長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">database.str</code></th>
              <td>文字列</td>
              <td>接続時に指定されたデータベース名</td>
            </tr><tr>
              <th scope="row"><code class="literal">database.length</code></th>
              <td>unsigned integer</td>
              <td>データベース名長</td>
            </tr><tr>
              <th scope="row"><code class="literal">connection_type</code></th>
              <td>整数</td>
              <td><p class="valid-value">
                  接続タイプ:
                </p><p class="valid-value">
                  または<code class="literal">"::undefined"</code> : 未定義
                </p><p class="valid-value">
                  または<code class="literal">"::tcp/ip"</code> : TCP/IP
                </p><p class="valid-value">
                  または<code class="literal">"::socket"</code> : Socket
                </p><p class="valid-value">
                  または<code class="literal">"::named_pipe"</code> : 名前付きパイプ
                </p><p class="valid-value">
                  または<code class="literal">"::ssl"</code> : 暗号化を使用した TCP/IP
                </p><p class="valid-value">
                  または<code class="literal">"::shared_memory"</code> : 共有メモリー
                </p></td>
            </tr></tbody></table></div></div><br class="table-break"><p>
          <code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code>値は、リテラルの数値のかわりに指定できるシンボリック擬似定数です。 これらは文字列として引用符で囲む必要があり、大/小文字が区別されます。 
        </p><p>
          一般イベントは、操作のステータスコードとその詳細を示します。<a class="xref" href="security.html#audit-log-general-event-fields" title="表 6.32 一般イベントフィールド">表6.32「一般イベントフィールド」</a> は、一般イベントに許可されているフィールドを示します。
        </p><div class="table"><a name="audit-log-general-event-fields"></a><p class="title"><b>表 6.32 一般イベントフィールド</b></p><div class="table-contents"><table summary="Permitted field types for general events."><col style="width=35%"><col style="width=20%"><col style="width=45%"><thead><tr>
              <th scope="col">フィールド名</th>
              <th scope="col">フィールドタイプ</th>
              <th scope="col">説明</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">general_error_code</code></th>
              <td>整数</td>
              <td><p class="valid-value">
                  イベントステータス:
                </p><p class="valid-value">
                  0: OK
                </p><p class="valid-value">
                  それ以外の場合: 失敗
                </p></td>
            </tr><tr>
              <th scope="row"><code class="literal">general_thread_id</code></th>
              <td>unsigned integer</td>
              <td>接続/スレッド ID</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_user.str</code></th>
              <td>文字列</td>
              <td>認証時に指定されたユーザー名</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_user.length</code></th>
              <td>unsigned integer</td>
              <td>ユーザー名の長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_command.str</code></th>
              <td>文字列</td>
              <td>コマンド名</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_command.length</code></th>
              <td>unsigned integer</td>
              <td>コマンド名長</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_query.str</code></th>
              <td>文字列</td>
              <td>SQL ステートメントテキスト</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_query.length</code></th>
              <td>unsigned integer</td>
              <td>SQL ステートメントのテキスト長</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_host.str</code></th>
              <td>文字列</td>
              <td>ホスト名</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_host.length</code></th>
              <td>unsigned integer</td>
              <td>ホスト名長</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_sql_command.str</code></th>
              <td>文字列</td>
              <td>SQL コマンドタイプ名</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_sql_command.length</code></th>
              <td>unsigned integer</td>
              <td>SQL コマンドタイプ名の長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_external_user.str</code></th>
              <td>文字列</td>
              <td>外部ユーザー名 (サードパーティの認証プラグインによって提供される)</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_external_user.length</code></th>
              <td>unsigned integer</td>
              <td>外部ユーザー名の長さ</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_ip.str</code></th>
              <td>文字列</td>
              <td>接続ユーザーの IP アドレス</td>
            </tr><tr>
              <th scope="row"><code class="literal">general_ip.length</code></th>
              <td>unsigned integer</td>
              <td>接続ユーザー IP アドレスの長さ</td>
            </tr></tbody></table></div></div><br class="table-break"><p>
          <code class="literal">general_command.str</code> はコマンド名を示します: <code class="literal">Query</code>, <code class="literal">Execute</code>, <code class="literal">Quit</code> または <code class="literal">Change user</code>。
        </p><p>
          <code class="literal">general_command.str</code> フィールドが <code class="literal">Query</code> または <code class="literal">Execute</code> に設定された一般イベントには、SQL コマンドのタイプを指定する値に設定された <code class="literal">general_sql_command.str</code> が含まれます: <code class="literal">alter_db</code>, <code class="literal">alter_db_upgrade</code>, <code class="literal">admin_commands</code> など。 これらの値は、次のステートメントによって表示されるパフォーマンススキーマインストゥルメントの最後のコンポーネントとして表示できます: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT NAME FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE 'statement/sql/%' ORDER BY NAME;</code></strong>
+---------------------------------------+
| NAME                                  |
+---------------------------------------+
| statement/sql/alter_db                |
| statement/sql/alter_db_upgrade        |
| statement/sql/alter_event             |
| statement/sql/alter_function          |
| statement/sql/alter_instance          |
| statement/sql/alter_procedure         |
| statement/sql/alter_server            |
...
</pre><p>
          テーブルアクセスイベントは、特定のテーブルアクセスに関する情報を提供します。<a class="xref" href="security.html#audit-log-table-access-event-fields" title="表 6.33 テーブルアクセスイベントフィールド">表6.33「テーブルアクセスイベントフィールド」</a> は、テーブルアクセスイベントに許可されているフィールドを示します。
        </p><div class="table"><a name="audit-log-table-access-event-fields"></a><p class="title"><b>表 6.33 テーブルアクセスイベントフィールド</b></p><div class="table-contents"><table summary="Permitted fields for table-access events."><col style="width=35%"><col style="width=20%"><col style="width=45%"><thead><tr>
              <th scope="col">フィールド名</th>
              <th scope="col">フィールドタイプ</th>
              <th scope="col">説明</th>
            </tr></thead><tbody><tr>
              <th scope="row"><code class="literal">connection_id</code></th>
              <td>unsigned integer</td>
              <td>イベント接続 ID</td>
            </tr><tr>
              <th scope="row"><code class="literal">sql_command_id</code></th>
              <td>整数</td>
              <td>SQL コマンド ID</td>
            </tr><tr>
              <th scope="row"><code class="literal">query.str</code></th>
              <td>文字列</td>
              <td>SQL ステートメントテキスト</td>
            </tr><tr>
              <th scope="row"><code class="literal">query.length</code></th>
              <td>unsigned integer</td>
              <td>SQL ステートメントのテキスト長</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_database.str</code></th>
              <td>文字列</td>
              <td>イベントに関連付けられたデータベース名</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_database.length</code></th>
              <td>unsigned integer</td>
              <td>データベース名長</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_name.str</code></th>
              <td>文字列</td>
              <td>イベントに関連付けられたテーブル名</td>
            </tr><tr>
              <th scope="row"><code class="literal">table_name.length</code></th>
              <td>unsigned integer</td>
              <td>テーブル名の長さ</td>
            </tr></tbody></table></div></div><br class="table-break"><p>
          次のリストに、どのステートメントがどのテーブルアクセスイベントを生成するかを示します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">read</code> イベント:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">SELECT</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">INSERT ... SELECT</code> (<code class="literal">SELECT</code> 句で参照されるテーブルの場合)
                </p></li><li class="listitem"><p>
                  <code class="literal">REPLACE ... SELECT</code> (<code class="literal">SELECT</code> 句で参照されるテーブルの場合)
                </p></li><li class="listitem"><p>
                  <code class="literal">UPDATE ... WHERE</code> (<code class="literal">WHERE</code> 句で参照されるテーブルの場合)
                </p></li><li class="listitem"><p>
                  <code class="literal">HANDLER ... READ</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">delete</code> イベント:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">DELETE</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">TRUNCATE TABLE</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">insert</code> イベント:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">INSERT</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">INSERT ... SELECT</code> (<code class="literal">INSERT</code> 句で参照されるテーブルの場合)
                </p></li><li class="listitem"><p>
                  <code class="literal">REPLACE</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">REPLACE ... SELECT</code> (<code class="literal">REPLACE</code> 句で参照されるテーブルの場合)
                </p></li><li class="listitem"><p>
                  <code class="literal">LOAD DATA</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">LOAD XML</code>
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">update</code> イベント:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">UPDATE</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">UPDATE ... WHERE</code> (<code class="literal">UPDATE</code> 句で参照されるテーブルの場合)
                </p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-blocking-events"></a>特定のイベントの実行のブロック</h5></div></div></div><p>
          <code class="literal">event</code> 品目には、適格イベントが実行されないようにするかどうかを示す <code class="literal">abort</code> 品目を含めることができます。 たとえば、<code class="literal">abort</code> では、特定の SQL ステートメントの実行をブロックするルールを記述できます。 
        </p><p>
          <code class="literal">abort</code> 品目は、<code class="literal">event</code> 品目内に表示される必要があります。 例: 
        </p><pre class="programlisting">"event": {
  "name": <em class="replaceable"><code>qualifying event subclass names</code></em>
  "abort": <em class="replaceable"><code>condition</code></em>
}
</pre><p>
          <code class="literal">name</code> アイテムによって選択されたイベントサブクラスの場合、<code class="literal">abort</code> アクションは <em class="replaceable"><code>condition</code></em> 評価に応じて true または false です。 条件が true と評価された場合、イベントはブロックされます。 それ以外の場合、イベントは引き続き実行されます。 
        </p><p>
          <em class="replaceable"><code>condition</code></em> 仕様は、<code class="literal">true</code> または <code class="literal">false</code> のように単純にすることも、イベント特性に依存するようにより複雑にすることもできます。
        </p><p>
          このフィルタは、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code> および <code class="literal">DELETE</code> ステートメントをブロックします:
        </p><pre class="programlisting">{
  "filter": {
    "class": {
      "name": "table_access",
      "event": {
        "name": [ "insert", "update", "delete" ],
        "abort": true
      }
    }
  }
}
</pre><p>
          この複雑なフィルタは、特定のテーブル (<code class="literal">finances.bank_account</code>) に対してのみ同じステートメントをブロックします:
        </p><pre class="programlisting">{
  "filter": {
    "class": {
      "name": "table_access",
      "event": {
        "name": [ "insert", "update", "delete" ],
        "abort": {
          "and": [
            { "field": { "name": "table_database.str", "value": "finances" } },
            { "field": { "name": "table_name.str", "value": "bank_account" } }
          ]
        }
      }
    }
  }
}
</pre><p>
          フィルタによって一致およびブロックされたステートメントは、クライアントにエラーを返します:
        </p><pre class="programlisting">ERROR 1045 (28000): Statement was aborted by an audit log filter
</pre><p>
          すべてのイベントをブロックできるわけではありません (<a class="xref" href="security.html#audit-log-event-subclass-log-abort" title="表 6.30 イベントクラスとサブクラスの組合せごとのログおよび中断特性">表6.30「イベントクラスとサブクラスの組合せごとのログおよび中断特性」</a> を参照)。 できないイベントの場合、監査ログは警告をブロックするのではなく、エラーログに書き込みます。 
        </p><p>
          <code class="literal">abort</code> アイテムが <code class="literal">event</code> アイテム以外の場所に表示されるフィルタを定義しようとすると、エラーが発生します。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-logical-operators"></a>論理演算子</h5></div></div></div><p>
          論理演算子 (<code class="literal">and</code>, <code class="literal">or</code>, <code class="literal">not</code>) は、<code class="literal">log</code> アイテムで使用できます。 これにより、より高度なフィルタリング構成を構築できます: 
        </p><pre class="programlisting">{
  "filter": {
    "class": {
      "name": "general",
      "event": {
        "name": "status",
        "log": {
          "or": [
            {
              "and": [
                { "field": { "name": "general_command.str",    "value": "Query" } },
                { "field": { "name": "general_command.length", "value": 5 } }
              ]
            },
            {
              "and": [
                { "field": { "name": "general_command.str",    "value": "Execute" } },
                { "field": { "name": "general_command.length", "value": 7 } }
              ]
            }
          ]
        }
      }
    }
  }
}
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-predefined-variables"></a>事前定義変数の参照</h5></div></div></div><p>
          <code class="literal">log</code> 条件で事前定義済の変数を参照するには、特定の値と等しいかどうかをテストする <code class="literal">variable</code> アイテムを使用します:
        </p><pre class="programlisting">{
  "filter": {
    "class": {
      "name": "general",
      "event": {
        "name": "status",
        "log": {
          "variable": {
            "name": "audit_log_connection_policy_value", "value": "::none"
          }
        }
      }
    }
  }
}
</pre><p>
          事前定義された各変数は、システム変数に対応します。 事前定義された変数をテストするフィルタを記述することで、フィルタを再定義しなくても、対応するシステム変数を設定してフィルタ操作を変更できます。 たとえば、<code class="literal">audit_log_connection_policy_value</code> の事前定義済変数の値をテストするフィルタを記述することで、<code class="literal">audit_log_connection_policy</code> システム変数の値を変更することでフィルタ操作を変更できます。 
        </p><a class="indexterm" name="idm46723751379936"></a><p>
          <code class="literal">audit_log_<em class="replaceable"><code>xxx</code></em>_policy</code> システム変数は、レガシーモードの監査ログに使用されます (<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a> を参照)。 ルールベースの監査ログフィルタリングでは、これらの変数は表示されたままになりますが (たとえば、<code class="literal">SHOW VARIABLES</code> を使用して)、変数を参照する構成を含むフィルタを記述しないかぎり、変更は効果がありません。 
        </p><p>
          次のリストでは、<code class="literal">variable</code> 品目に許可されている事前定義済変数について説明します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_connection_policy_value</code>
            </p><p>
              この変数は、<code class="literal">audit_log_connection_policy</code> システム変数の値に対応します。 値は符号なし整数です。<a class="xref" href="security.html#audit-log-connection-policy-value-values" title="表 6.34 audit_log_connection_policy_value の値">表6.34「audit_log_connection_policy_value の値」</a> には、許可された値および対応する <code class="literal">audit_log_connection_policy</code> 値が表示されます。 
            </p><div class="table"><a name="audit-log-connection-policy-value-values"></a><p class="title"><b>表 6.34 audit_log_connection_policy_value の値</b></p><div class="table-contents"><table summary="Permitted audit_log_connection_policy_value values and the corresponding audit_log_connection_policy values."><col style="width=20%"><col style="width=80%"><thead><tr>
                  <th>値</th>
                  <th>対応する audit_log_connection_policy 値</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">0</code> または<code class="literal">"::none"</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <td><code class="literal">1</code> または<code class="literal">"::errors"</code></td>
                  <td><code class="literal">ERRORS</code></td>
                </tr><tr>
                  <td><code class="literal">2</code> または<code class="literal">"::all"</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr></tbody></table></div></div><br class="table-break"><p>
              <code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code>値は、リテラルの数値のかわりに指定できるシンボリック擬似定数です。 これらは文字列として引用符で囲む必要があり、大/小文字が区別されます。 
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_policy_value</code>
            </p><p>
              この変数は、<code class="literal">audit_log_policy</code> システム変数の値に対応します。 値は符号なし整数です。<a class="xref" href="security.html#audit-log-policy-value-values" title="表 6.35 audit_log_policy_value の値">表6.35「audit_log_policy_value の値」</a> には、許可された値および対応する <code class="literal">audit_log_policy</code> 値が表示されます。 
            </p><div class="table"><a name="audit-log-policy-value-values"></a><p class="title"><b>表 6.35 audit_log_policy_value の値</b></p><div class="table-contents"><table summary="Permitted audit_log_policy_value values and the corresponding audit_log_policy values."><col style="width=20%"><col style="width=80%"><thead><tr>
                  <th>値</th>
                  <th>対応する audit_log_policy 値</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">0</code> または<code class="literal">"::none"</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <td><code class="literal">1</code> または<code class="literal">"::logins"</code></td>
                  <td><code class="literal">LOGINS</code></td>
                </tr><tr>
                  <td><code class="literal">2</code> または<code class="literal">"::all"</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr><tr>
                  <td><code class="literal">3</code> または<code class="literal">"::queries"</code></td>
                  <td><code class="literal">QUERIES</code></td>
                </tr></tbody></table></div></div><br class="table-break"><p>
              <code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code>値は、リテラルの数値のかわりに指定できるシンボリック擬似定数です。 これらは文字列として引用符で囲む必要があり、大/小文字が区別されます。 
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_statement_policy_value</code>
            </p><p>
              この変数は、<code class="literal">audit_log_statement_policy</code> システム変数の値に対応します。 値は符号なし整数です。<a class="xref" href="security.html#audit-log-statement-policy-value-values" title="表 6.36 audit_log_statement_policy_value の値">表6.36「audit_log_statement_policy_value の値」</a> には、許可された値および対応する <code class="literal">audit_log_statement_policy</code> 値が表示されます。 
            </p><div class="table"><a name="audit-log-statement-policy-value-values"></a><p class="title"><b>表 6.36 audit_log_statement_policy_value の値</b></p><div class="table-contents"><table summary="Permitted audit_log_statement_policy_value values and the corresponding audit_log_statement_policy values."><col style="width=20%"><col style="width=80%"><thead><tr>
                  <th>値</th>
                  <th>対応する audit_log_statement_policy 値</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">0</code> または<code class="literal">"::none"</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <td><code class="literal">1</code> または<code class="literal">"::errors"</code></td>
                  <td><code class="literal">ERRORS</code></td>
                </tr><tr>
                  <td><code class="literal">2</code> または<code class="literal">"::all"</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr></tbody></table></div></div><br class="table-break"><p>
              <code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code>値は、リテラルの数値のかわりに指定できるシンボリック擬似定数です。 これらは文字列として引用符で囲む必要があり、大/小文字が区別されます。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-predefined-functions"></a>事前定義関数の参照</h5></div></div></div><p>
          <code class="literal">log</code> 条件で事前定義済関数を参照するには、<code class="literal">function</code> アイテムを使用します。このアイテムは、<code class="literal">name</code> および <code class="literal">args</code> の値を使用して、関数名とその引数をそれぞれ指定します:
        </p><pre class="programlisting">{
  "filter": {
    "class": {
      "name": "general",
      "event": {
        "name": "status",
        "log": {
          "function": {
            "name": "find_in_include_list",
            "args": [ { "string": [ { "field": "user.str" },
                                    { "string": "@"},
                                    { "field": "host.str" } ] } ]
          }
        }
      }
    }
  }
}
</pre><p>
          <code class="literal">name</code> 項目に指定されている関数は、カッコや引数リストを含まない関数名のみである必要があります。 <code class="literal">args</code> アイテムに引数がある場合は、関数の説明にリストされている順序で引数を指定する必要があります。 引数は、事前定義済の変数、イベントフィールド、文字列定数または数値定数を参照できます。 
        </p><p>
          前述のフィルタは、現在のユーザーが <code class="literal">audit_log_include_accounts</code> システム変数で見つかったかどうかに応じて、<code class="literal">general</code> クラスの <code class="literal">status</code> イベントをログに記録するかどうかを決定します。 そのユーザーは、イベントのフィールドを使用して作成されます。 
        </p><p>
          次のリストでは、<code class="literal">function</code> 品目に許可されている事前定義済関数について説明します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_exclude_accounts_is_null()</code>
            </p><p>
              <code class="literal">audit_log_exclude_accounts</code> システム変数が <code class="literal">NULL</code> かどうかを確認します。 この関数は、レガシー監査ログの実装に対応するフィルタを定義する場合に役立ちます。 
            </p><p>
              引数:
            </p><p>
              なし
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_include_accounts_is_null()</code>
            </p><p>
              <code class="literal">audit_log_include_accounts</code> システム変数が <code class="literal">NULL</code> かどうかを確認します。 この関数は、レガシー監査ログの実装に対応するフィルタを定義する場合に役立ちます。 
            </p><p>
              引数:
            </p><p>
              なし
            </p></li><li class="listitem"><p>
              <code class="literal">debug_sleep(millisec)</code>
            </p><p>
              指定されたミリ秒数スリープします。 この関数は、パフォーマンス測定時に使用されます。 
            </p><p>
              <code class="literal">debug_sleep()</code> はデバッグビルドにのみ使用できます。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>millisec</code></em>: スリープするミリ秒数を指定する符号なし整数。
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">find_in_exclude_list(account)</code>
            </p><p>
              アカウント文字列が監査ログ除外リスト (<code class="literal">audit_log_exclude_accounts</code> システム変数の値) に存在するかどうかを確認します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>account</code></em>: ユーザーアカウント名を指定する文字列。
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">find_in_include_list(account)</code>
            </p><p>
              アカウント文字列が監査ログインクルードリスト (<code class="literal">audit_log_include_accounts</code> システム変数の値) に存在するかどうかを確認します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>account</code></em>: ユーザーアカウント名を指定する文字列。
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">string_find(text, substr)</code>
            </p><p>
              <code class="literal">substr</code> 値が <code class="literal">text</code> 値に含まれているかどうかを確認します。 この検索では大文字と小文字が区別されます。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>text</code></em>: 検索するテキスト文字列。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>substr</code></em>: <em class="replaceable"><code>text</code></em> で検索する部分文字列。
                </p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-filtering-filter-replacement"></a>ユーザーフィルタの置換</h5></div></div></div><p>
          場合によっては、フィルタ定義を動的に変更できます。 これを行うには、既存の <code class="literal">filter</code> 内で <code class="literal">filter</code> 構成を定義します。 例: 
        </p><pre class="programlisting">{
  "filter": {
    "id": "main",
    "class": {
      "name": "table_access",
      "event": {
        "name": [ "update", "delete" ],
        "log": false,
        "filter": {
          "class": {
            "name": "general",
            "event" : { "name": "status",
                        "filter": { "ref": "main" } }
          },
          "activate": {
            "or": [
              { "field": { "name": "table_name.str", "value": "temp_1" } },
              { "field": { "name": "table_name.str", "value": "temp_2" } }
            ]
          }
        }
      }
    }
  }
}
</pre><p>
          サブフィルタ内の <code class="literal">activate</code> 要素が <code class="literal">true</code> と評価されると、新しいフィルタがアクティブ化されます。 最上位の <code class="literal">filter</code> での <code class="literal">activate</code> の使用は許可されていません。 
        </p><p>
          サブフィルタ内の <code class="literal">ref</code> アイテムを使用して元のフィルタ <code class="literal">id</code> を参照することで、新しいフィルタを元のフィルタに置き換えることができます。
        </p><p>
          表示されるフィルタは次のように動作します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">main</code> フィルタは、<code class="literal">update</code> または <code class="literal">delete</code> のいずれかの <code class="literal">table_access</code> イベントを待機します。
            </p></li><li class="listitem"><p>
              <code class="literal">temp_1</code> または <code class="literal">temp_2</code> テーブルで <code class="literal">update</code> または <code class="literal">delete</code> の <code class="literal">table_access</code> イベントが発生した場合、フィルタは内部イベントに置き換えられます (明示的に参照する必要がないため、<code class="literal">id</code> はありません)。
            </p></li><li class="listitem"><p>
              コマンドの終了が通知されると (<code class="literal">general</code> / <code class="literal">status</code> イベント)、エントリが監査ログファイルに書き込まれ、フィルタが <code class="literal">main</code> フィルタに置き換えられます。
            </p></li></ul></div><p>
          このフィルタは、次のような <code class="literal">temp_1</code> または <code class="literal">temp_2</code> テーブルに対して更新または削除を行うステートメントをログに記録する場合に役立ちます:
        </p><pre class="programlisting">UPDATE temp_1, temp_3 SET temp_1.a=21, temp_3.a=23;
</pre><p>
          このステートメントでは複数の <code class="literal">table_access</code> イベントが生成されますが、監査ログファイルには <code class="literal">general</code> / <code class="literal">status</code> エントリのみが含まれます。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            定義で使用されている <code class="literal">id</code> 値は、その定義に対してのみ評価されます。 これらは、<code class="literal">audit_log_filter_id</code> システム変数の値とは関係ありません。 
          </p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-legacy-filtering"></a>6.4.5.9 レガシーモード監査ログのフィルタリング</h4></div></div></div><a class="indexterm" name="idm46723751213696"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          このセクションでは、レガシー監査ログのフィルタリングについて説明します。このフィルタリングは、<code class="literal">audit_log</code> プラグインがインストールされているが、ルールベースのフィルタリングに必要な監査テーブルおよび UDF には付随しない場合に適用されます。
        </p></div><p>
        監査ログプラグインは、監査対象イベントをフィルタリングできます。 これにより、イベントの発生元またはイベントステータスに基づいて、監査イベントを監査ログファイルに書き込むかどうかを制御できます。 ステータスのフィルタリングは、接続イベントおよびステートメントイベントごとに個別に発生します。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-account-filtering" title="アカウント別のイベントフィルタリング">アカウント別のイベントフィルタリング</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-status-filtering" title="ステータス別のイベントフィルタリング">ステータス別のイベントフィルタリング</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-account-filtering"></a>アカウント別のイベントフィルタリング</h5></div></div></div><p>
          元のアカウントに基づいて監査イベントをフィルタするには、サーバーの起動時または実行時に次のいずれかのシステム変数を設定します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_include_accounts</code>: 監査ロギングに含めるアカウント。 この変数が設定されている場合は、これらのアカウントのみが監査されます。 
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_exclude_accounts</code>: 監査ロギングから除外するアカウント。 この変数が設定されている場合は、これらのアカウント以外がすべて監査されます。 
            </p></li></ul></div><p>
          いずれかの変数の値には、<code class="literal">NULL</code> またはカンマで区切った 1 つ以上のアカウント名を含む文字列を指定できます。それぞれの形式は <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> です。 デフォルトでは、両方の変数が <code class="literal">NULL</code> になっています。この場合、アカウントのフィルタリングは実行されず、すべてのアカウントで監査が発生します。 
        </p><p>
          <code class="literal">audit_log_include_accounts</code> または <code class="literal">audit_log_exclude_accounts</code> の変更は、変更後に作成された接続にのみ影響し、既存の接続には影響しません。
        </p><p>
          例: <code class="literal">user1</code> および <code class="literal">user2</code> ローカルホストのアカウントでのみ監査ロギングを有効にするには、次のように <code class="literal">audit_log_include_accounts</code> システム変数を設定します。
        </p><pre class="programlisting">SET GLOBAL audit_log_include_accounts = 'user1@localhost,user2@localhost';
</pre><p>
          同時に <code class="literal">NULL</code> 以外に設定できるのは、<code class="literal">audit_log_include_accounts</code> と <code class="literal">audit_log_exclude_accounts</code> のいずれかのみです。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_include_accounts</code> を設定すると、サーバーは <code class="literal">audit_log_exclude_accounts</code> を <code class="literal">NULL</code> に設定します。
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_include_accounts</code> が <code class="literal">NULL</code> でない場合を除いて、<code class="literal">audit_log_exclude_accounts</code> を設定しようとするとエラーが発生します。 この場合は、まず <code class="literal">audit_log_include_accounts</code> を <code class="literal">NULL</code> に設定することでクリアする必要があります。 
            </p></li></ul></div><pre class="programlisting">-- This sets audit_log_exclude_accounts to NULL
SET GLOBAL audit_log_include_accounts = <em class="replaceable"><code>value</code></em>;

-- This fails because audit_log_include_accounts is not NULL
SET GLOBAL audit_log_exclude_accounts = <em class="replaceable"><code>value</code></em>;

-- To set audit_log_exclude_accounts, first set
-- audit_log_include_accounts to NULL
SET GLOBAL audit_log_include_accounts = NULL;
SET GLOBAL audit_log_exclude_accounts = <em class="replaceable"><code>value</code></em>;
</pre><p>
          いずれかの変数の値を調査する場合は、<code class="literal">SHOW VARIABLES</code> で <code class="literal">NULL</code> が空の文字列として表示されることに注意してください。 これを回避するには、代わりに <code class="literal">SELECT</code> を使用してください。 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log_include_accounts';</code></strong>
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| audit_log_include_accounts |       |
+----------------------------+-------+
mysql&gt; <strong class="userinput"><code>SELECT @@audit_log_include_accounts;</code></strong>
+------------------------------+
| @@audit_log_include_accounts |
+------------------------------+
| NULL                         |
+------------------------------+
</pre><p>
          カンマ、スペース、またはその他の特殊文字が含まれているために、ユーザー名やホスト名を引用符で囲む必要がある場合は、一重引用符を使用して囲みます。 変数の値自体が一重引用符で囲まれている場合は、内側の各一重引用符を二重に入力するか、バックスラッシュを使用してエスケープします。 次のステートメントはそれぞれ、ローカルの <code class="literal">root</code> アカウントの監査ロギングを有効にします。引用符のスタイルが異なりますが、いずれも同等です。 
        </p><pre class="programlisting">SET GLOBAL audit_log_include_accounts = 'root@localhost';
SET GLOBAL audit_log_include_accounts = '''root''@''localhost''';
SET GLOBAL audit_log_include_accounts = '\'root\'@\'localhost\'';
SET GLOBAL audit_log_include_accounts = "'root'@'localhost'";
</pre><p>
          <code class="literal">ANSI_QUOTES</code> SQL モードが有効な場合、最後のステートメントは機能しません。このモードでは、二重引用符は文字列引用符ではなく識別子引用符を示しているためです。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-status-filtering"></a>ステータス別のイベントフィルタリング</h5></div></div></div><p>
          ステータスに基づいて監査イベントをフィルタするには、サーバーの起動時または実行時に次のシステム変数を設定します。 これらの変数は、レガシー監査ログのフィルタリングにのみ適用されます。 JSON 監査ログのフィルタリングについては、様々なステータス変数が適用されます。<a class="xref" href="security.html#audit-log-options-variables" title="監査ログのオプションおよび変数">監査ログのオプションおよび変数</a> を参照してください。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_connection_policy</code>: 接続イベントのロギングポリシーです
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_statement_policy</code>: ステートメントイベントのロギングポリシーです
            </p></li></ul></div><p>
          各変数には、<code class="literal">ALL</code> (関連付けられたすべてのイベントのログを記録します。これがデフォルトです)、<code class="literal">ERRORS</code> (失敗したイベントのログのみを記録します)、または <code class="literal">NONE</code> (イベントのログを記録しません) の値が指定されます。 たとえば、ステートメントイベントのログはすべて記録するが、接続イベントのログは失敗したもののみを記録する場合は、次の設定を使用します。 
        </p><pre class="programlisting">SET GLOBAL audit_log_statement_policy = ALL;
SET GLOBAL audit_log_connection_policy = ERRORS;
</pre><p>
          別のポリシーシステム変数 <code class="literal">audit_log_policy</code> を使用できますが、<code class="literal">audit_log_connection_policy</code> および <code class="literal">audit_log_statement_policy</code> ほど制御できません。 それはサーバーの起動時にのみ設定できます。 実行時は、読み取り専用の変数です。 これには、<code class="literal">ALL</code> (すべてのイベントのログを記録します。これがデフォルトです)、<code class="literal">LOGINS</code> (接続イベントのログを記録します)、<code class="literal">QUERIES</code> (ステートメントイベントのログを記録します)、または <code class="literal">NONE</code> (イベントのログを記録しません) の値が指定されます。 これらの値のいずれを指定しても、監査ログプラグインは成功と失敗を区別せずに、選択したイベントのログをすべて記録します。 起動時の <code class="literal">audit_log_policy</code> の使用は、次のように動作します: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">audit_log_policy</code> を設定しない場合や、デフォルト値の <code class="literal">ALL</code> に設定した場合でも、<code class="literal">audit_log_connection_policy</code> または <code class="literal">audit_log_statement_policy</code> を明示的に設定すれば、指定どおりに適用されます。 指定しない場合は、デフォルトが <code class="literal">ALL</code> に設定されます。 
            </p></li><li class="listitem"><p>
              <code class="literal">audit_log_policy</code> を <code class="literal">ALL</code> 以外の値に設定した場合は、次の表に示すように、その値が優先され、<code class="literal">audit_log_connection_policy</code> および <code class="literal">audit_log_statement_policy</code> を設定する際に使用されます。 また、これらの変数のいずれかをデフォルトの <code class="literal">ALL</code> 以外の値に設定する場合、サーバーはそれらの値がオーバーライドされることを示すメッセージをエラーログに書き込みます。 
            </p><div class="informaltable"><table summary="How the server uses audit_log_policy to set audit_log_connection_policy and audit_log_statement_policy at startup."><col style="width=33%"><col style="width=33%"><col style="width=33%"><thead><tr>
                  <th scope="col">起動時の audit_log_policy 値</th>
                  <th scope="col">結果として返される audit_log_connection_policy 値</th>
                  <th scope="col">結果として返される audit_log_statement_policy 値</th>
                </tr></thead><tbody><tr>
                  <th scope="row"><code class="literal">LOGINS</code></th>
                  <td><code class="literal">ALL</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <th scope="row"><code class="literal">QUERIES</code></th>
                  <td><code class="literal">NONE</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr><tr>
                  <th scope="row"><code class="literal">NONE</code></th>
                  <td><code class="literal">NONE</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr></tbody></table></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-reference"></a>6.4.5.10 監査ログ参照</h4></div></div></div><p>
        次の各セクションでは、MySQL Enterprise Audit 要素のリファレンスを示します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-tables" title="監査ログテーブル">監査ログテーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-routines" title="監査ログ関数">監査ログ関数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-option-variable-reference" title="監査ログオプションおよび変数リファレンス">監査ログオプションおよび変数リファレンス</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-options-variables" title="監査ログのオプションおよび変数">監査ログのオプションおよび変数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-status-variables" title="監査ログステータス変数">監査ログステータス変数</a></p></li></ul></div><p>
        監査ログのテーブルおよび関数をインストールするには、<a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 MySQL Enterprise Audit のインストールまたはアンインストール">セクション6.4.5.2「MySQL Enterprise Audit のインストールまたはアンインストール」</a> で提供されている手順を使用します。 これらのオブジェクトがインストールされていないかぎり、<code class="literal">audit_log</code> プラグインはレガシーモードで動作します。 <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a>を参照してください。 
      </p><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-tables"></a>監査ログテーブル</h5></div></div></div><p>
          MySQL Enterprise Audit では、フィルタおよびユーザーアカウントデータの永続的な格納に <code class="literal">mysql</code> システムデータベースのテーブルが使用されます。 テーブルにアクセスできるのは、そのデータベースに対する権限を持つユーザーのみです。 これらのテーブルは、<code class="literal">InnoDB</code> ストレージエンジンを使用します。 
        </p><p>
          これらのテーブルがない場合、<code class="literal">audit_log</code> プラグインはレガシーモードで動作します。 <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a>を参照してください。 
        </p><p>
          <code class="literal">audit_log_filter</code> テーブルには、フィルタ定義が格納されます。 テーブルには次のカラムがあります。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NAME</code>
            </p><p>
              フィルタ名。
            </p></li><li class="listitem"><p>
              <code class="literal">FILTER</code>
            </p><p>
              フィルタ名に関連付けられたフィルタ定義。 定義は <code class="literal">JSON</code> 値として格納されます。 
            </p></li></ul></div><p>
          <code class="literal">audit_log_user</code> テーブルには、ユーザーアカウント情報が格納されます。 テーブルには次のカラムがあります。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USER</code>
            </p><p>
              アカウントのユーザー名部分。 アカウント <code class="literal">user1@localhost</code> の場合、<code class="literal">USER</code> 部分は <code class="literal">user1</code> です。 
            </p></li><li class="listitem"><p>
              <code class="literal">HOST</code>
            </p><p>
              アカウントのホスト名部分。 アカウント <code class="literal">user1@localhost</code> の場合、<code class="literal">HOST</code> 部分は <code class="literal">localhost</code> です。 
            </p></li><li class="listitem"><p>
              <code class="literal">FILTERNAME</code>
            </p><p>
              アカウントに割り当てられたフィルタの名前。 フィルタ名は、アカウントを <code class="literal">audit_log_filter</code> テーブルで定義されているフィルタに関連付けます。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-routines"></a>監査ログ関数</h5></div></div></div><p>
          このセクションでは、監査ログのユーザー定義関数 (UDF) ごとに、その目的、コール順序および戻り値について説明します。 これらの UDF を起動できる条件の詳細は、<a class="xref" href="security.html#audit-log-filtering" title="6.4.5.7 監査ログのフィルタリング">セクション6.4.5.7「監査ログのフィルタリング」</a> を参照してください。 
        </p><p>
          各監査ログ UDF は、操作が成功したかどうかを示す文字列を返します。 <code class="literal">OK</code> は成功を示します。 <code class="literal">ERROR: <em class="replaceable"><code>message</code></em></code> は失敗を示します。 
        </p><p>
          MySQL 8.0.19 の時点では、監査ログ UDF は文字列引数を <code class="literal">utf8mb4</code> に変換し、文字列戻り値は <code class="literal">utf8mb4</code> 文字列です。 MySQL 8.0.19 より前では、監査ログ UDF は文字列引数をバイナリ文字列として扱い (大文字と小文字を区別しない)、文字列の戻り値はバイナリ文字列です。 
        </p><p>
          次の監査ログ UDF を使用できます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_audit-log-encryption-password-get"></a>
              <code class="literal">audit_log_encryption_password_get([<em class="replaceable"><code>keyring_id</code></em>])</code>
            </p><a class="indexterm" name="idm46723751061680"></a><a class="indexterm" name="idm46723751060064"></a><p>
              この関数は、監査ログの暗号化パスワードを MySQL キーリングからフェッチします。このキーリングは有効にする必要があり、有効にしないとエラーが発生します。 どのキーリングプラグインも使用できます。手順については、<a class="xref" href="security.html#keyring" title="6.4.4 MySQL キーリング">セクション6.4.4「MySQL キーリング」</a> を参照してください。 
            </p><p>
              引数を指定しない場合、関数は現在の暗号化パスワードをバイナリ文字列として取得します。 取得する監査ログ暗号化パスワードを指定する引数を指定できます。 引数は、現在のパスワードまたはアーカイブされたパスワードのキーリング ID である必要があります。 
            </p><p>
              監査ログの暗号化の詳細は、<a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a> を参照してください。
            </p><p>
              引数:
            </p><p>
              <em class="replaceable"><code>keyring_id</code></em>: MySQL 8.0.17 では、このオプションの引数は取得するパスワードのキーリング ID を示します。 最大許容長は 766 バイトです。 省略すると、現在のパスワードが取得されます。 
            </p><p>
              MySQL 8.0.17 より前では、引数は使用できません。 この関数は、常に現在のパスワードを取得します。 
            </p><p>
              戻り値:
            </p><p>
              成功のパスワード文字列 (最大 766 バイト)、または <code class="literal">NULL</code> と失敗のエラー。
            </p><p>
              例:
            </p><p>
              現在のパスワードを取得します:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_encryption_password_get();</code></strong>
+-------------------------------------+
| audit_log_encryption_password_get() |
+-------------------------------------+
| secret                              |
+-------------------------------------+
</pre><p>
              ID でパスワードを取得するには、パフォーマンススキーマ <code class="literal">keyring_keys</code> テーブルをクエリーすることによって、存在する監査ログ鍵リング ID を確認できます:
            </p><a class="indexterm" name="idm46723751044960"></a><a class="indexterm" name="idm46723751042816"></a><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT KEY_ID FROM performance_schema.keyring_keys</code></strong>
       <strong class="userinput"><code>WHERE KEY_ID LIKE 'audit_log%'</code></strong>
       <strong class="userinput"><code>ORDER BY KEY_ID;</code></strong>
+-----------------------------+
| KEY_ID                      |
+-----------------------------+
| audit_log-20190415T152248-1 |
| audit_log-20190415T153507-1 |
| audit_log-20190416T125122-1 |
| audit_log-20190416T141608-1 |
+-----------------------------+
mysql&gt; <strong class="userinput"><code>SELECT audit_log_encryption_password_get('audit_log-20190416T125122-1');</code></strong>
+------------------------------------------------------------------+
| audit_log_encryption_password_get('audit_log-20190416T125122-1') |
+------------------------------------------------------------------+
| segreto                                                          |
+------------------------------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_audit-log-encryption-password-set"></a>
              <code class="literal">audit_log_encryption_password_set(<em class="replaceable"><code>password</code></em>)</code>
            </p><a class="indexterm" name="idm46723751033440"></a><a class="indexterm" name="idm46723751031824"></a><p>
              現在の監査ログ暗号化パスワードを引数に設定し、パスワードを MySQL キーリングに格納します。 MySQL 8.0.19 では、パスワードは <code class="literal">utf8mb4</code> 文字列として格納されます。 MySQL 8.0.19 より前は、パスワードはバイナリ形式で格納されます。 
            </p><p>
              暗号化が有効な場合、この関数は、現在のログファイルの名前を変更するログファイルローテーション操作を実行し、パスワードで暗号化された新しいログファイルを開始します。 キーリングを有効にする必要があり、有効にしないとエラーが発生します。 どのキーリングプラグインも使用できます。手順については、<a class="xref" href="security.html#keyring" title="6.4.4 MySQL キーリング">セクション6.4.4「MySQL キーリング」</a> を参照してください。 
            </p><p>
              監査ログの暗号化の詳細は、<a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a> を参照してください。
            </p><p>
              引数:
            </p><p>
              <em class="replaceable"><code>password</code></em>: パスワード文字列。 最大許容長は 766 バイトです。 
            </p><p>
              戻り値:
            </p><p>
              成功の場合は 1、失敗の場合は 0。
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_encryption_password_set(<em class="replaceable"><code>password</code></em>);</code></strong>
+---------------------------------------------+
| audit_log_encryption_password_set(<em class="replaceable"><code>password</code></em>) |
+---------------------------------------------+
| 1                                           |
+---------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_audit-log-filter-flush"></a>
              <code class="literal">audit_log_filter_flush()</code>
            </p><a class="indexterm" name="idm46723751017120"></a><a class="indexterm" name="idm46723751015520"></a><p>
              他のフィルタリング UDF を呼び出すと、操作監査ログのフィルタリングにただちに影響し、監査ログテーブルが更新されます。 かわりに、<code class="literal">INSERT</code>、<code class="literal">UPDATE</code> および <code class="literal">DELETE</code> などのステートメントを使用してこれらのテーブルの内容を直接変更しても、変更はフィルタリングにすぐには影響しません。 変更をフラッシュして操作可能にするには、<code class="literal">audit_log_filter_flush()</code> をコールします。 
            </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
                <code class="literal">audit_log_filter_flush()</code> は、すべてのフィルタを強制的にリロードするために、監査テーブルを直接変更した後にのみ使用してください。 それ以外の場合は、この関数を使用しないでください。 実際には、<code class="literal">UNINSTALL PLUGIN</code> と <code class="literal">INSTALL PLUGIN</code> を使用した <code class="literal">audit_log</code> プラグインのアンロードおよびリロードの簡略化されたバージョンです。 
              </p><p>
                <code class="literal">audit_log_filter_flush()</code> は、現在のすべてのセッションに影響を与え、以前のフィルタからデタッチします。 現在のセッションは、切断して再接続するか、ユーザー変更操作を実行しないかぎり、ログに記録されなくなります。 
              </p></div><p>
              この関数が失敗すると、エラーメッセージが返され、次に <code class="literal">audit_log_filter_flush()</code> が正常にコールされるまで監査ログは無効になります。
            </p><p>
              引数:
            </p><p>
              なし
            </p><p>
              戻り値:
            </p><p>
              操作が成功したかどうかを示す文字列。 <code class="literal">OK</code> は成功を示します。 <code class="literal">ERROR: <em class="replaceable"><code>message</code></em></code> は失敗を示します。 
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_flush();</code></strong>
+--------------------------+
| audit_log_filter_flush() |
+--------------------------+
| OK                       |
+--------------------------+
</pre></li><li class="listitem"><p><a name="function_audit-log-filter-remove-filter"></a>
              <code class="literal">audit_log_filter_remove_filter(<em class="replaceable"><code>filter_name</code></em>)</code>
            </p><a class="indexterm" name="idm46723750990640"></a><a class="indexterm" name="idm46723750989024"></a><p>
              フィルタ名を指定すると、現在のフィルタセットからフィルタが削除されます。 フィルタが存在しない場合はエラーではありません。 
            </p><p>
              削除されたフィルタがいずれかのユーザーアカウントに割り当てられている場合、それらのユーザーはフィルタ処理を停止します (<code class="literal">audit_log_user</code> テーブルから削除されます)。 フィルタリングの終了には、それらのユーザーの現在のセッションが含まれます: フィルタからデタッチされ、ログに記録されなくなります。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>filter_name</code></em>: フィルタ名を指定する文字列。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              操作が成功したかどうかを示す文字列。 <code class="literal">OK</code> は成功を示します。 <code class="literal">ERROR: <em class="replaceable"><code>message</code></em></code> は失敗を示します。 
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_remove_filter('SomeFilter');</code></strong>
+----------------------------------------------+
| audit_log_filter_remove_filter('SomeFilter') |
+----------------------------------------------+
| OK                                           |
+----------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_audit-log-filter-remove-user"></a>
              <code class="literal">audit_log_filter_remove_user(<em class="replaceable"><code>user_name</code></em>)</code>
            </p><a class="indexterm" name="idm46723750974256"></a><a class="indexterm" name="idm46723750972656"></a><p>
              ユーザーアカウント名を指定すると、ユーザーはフィルタに割り当てられなくなります。 ユーザーにフィルタが割り当てられていない場合は、エラーになりません。 ユーザーの現在のセッションのフィルタリングは影響を受けません。 ユーザーの新しい接続は、デフォルトのアカウントフィルタ (存在する場合) を使用してフィルタされ、それ以外の場合はログに記録されません。 
            </p><p>
              名前が <code class="literal">%</code> の場合、関数は、明示的にフィルタが割り当てられていないユーザーアカウントに使用されるデフォルトのアカウントフィルタを削除します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>user_name</code></em>: <code class="literal"> <em class="replaceable"><code>user_name</code></em> @<em class="replaceable"><code>host_name</code></em></code> 形式の文字列としてのユーザーアカウント名、またはデフォルトアカウントを表す <code class="literal">%</code>。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              操作が成功したかどうかを示す文字列。 <code class="literal">OK</code> は成功を示します。 <code class="literal">ERROR: <em class="replaceable"><code>message</code></em></code> は失敗を示します。 
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_remove_user('user1@localhost');</code></strong>
+-------------------------------------------------+
| audit_log_filter_remove_user('user1@localhost') |
+-------------------------------------------------+
| OK                                              |
+-------------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_audit-log-filter-set-filter"></a>
              <code class="literal">audit_log_filter_set_filter(<em class="replaceable"><code>filter_name</code></em>, <em class="replaceable"><code>definition</code></em>)</code>
            </p><a class="indexterm" name="idm46723750955424"></a><a class="indexterm" name="idm46723750953824"></a><p>
              フィルタ名と定義を指定すると、現在のフィルタセットにフィルタが追加されます。 フィルタがすでに存在し、現在のセッションで使用されている場合、それらのセッションはフィルタからデタッチされ、ログに記録されなくなります。 これは、新しいフィルタ定義に以前の ID とは異なる新しいフィルタ ID があるために発生します。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>filter_name</code></em>: フィルタ名を指定する文字列。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>definition</code></em>: フィルタ定義を指定する <code class="literal">JSON</code> 値。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              操作が成功したかどうかを示す文字列。 <code class="literal">OK</code> は成功を示します。 <code class="literal">ERROR: <em class="replaceable"><code>message</code></em></code> は失敗を示します。 
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET @f = '{ "filter": { "log": false } }';</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_set_filter('SomeFilter', @f);</code></strong>
+-----------------------------------------------+
| audit_log_filter_set_filter('SomeFilter', @f) |
+-----------------------------------------------+
| OK                                            |
+-----------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_audit-log-filter-set-user"></a>
              <code class="literal">audit_log_filter_set_user(<em class="replaceable"><code>user_name</code></em>, <em class="replaceable"><code>filter_name</code></em>)</code>
            </p><a class="indexterm" name="idm46723750937264"></a><a class="indexterm" name="idm46723750935664"></a><p>
              ユーザーアカウント名とフィルタ名を指定すると、ユーザーにフィルタが割り当てられます。 ユーザーには 1 つのフィルタのみを割り当てることができるため、ユーザーにフィルタがすでに割り当てられている場合は、割り当てが置き換えられます。 ユーザーの現在のセッションのフィルタリングは影響を受けません。 新しい接続は、新しいフィルタを使用してフィルタ処理されます。 
            </p><p>
              特殊なケースとして、<code class="literal">%</code> という名前はデフォルトのアカウントを表します。 フィルタは、フィルタが明示的に割り当てられていないユーザーアカウントからの接続に使用されます。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>user_name</code></em>: <code class="literal"> <em class="replaceable"><code>user_name</code></em> @<em class="replaceable"><code>host_name</code></em></code> 形式の文字列としてのユーザーアカウント名、またはデフォルトアカウントを表す <code class="literal">%</code>。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>filter_name</code></em>: フィルタ名を指定する文字列。
                </p></li></ul></div><p>
              戻り値:
            </p><p>
              操作が成功したかどうかを示す文字列。 <code class="literal">OK</code> は成功を示します。 <code class="literal">ERROR: <em class="replaceable"><code>message</code></em></code> は失敗を示します。 
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_set_user('user1@localhost', 'SomeFilter');</code></strong>
+------------------------------------------------------------+
| audit_log_filter_set_user('user1@localhost', 'SomeFilter') |
+------------------------------------------------------------+
| OK                                                         |
+------------------------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_audit-log-read"></a>
              <code class="literal">audit_log_read([<em class="replaceable"><code>arg</code></em>])</code>
            </p><a class="indexterm" name="idm46723750917488"></a><a class="indexterm" name="idm46723750915920"></a><p>
              監査ログを読み取り、<code class="literal">JSON</code> 文字列の結果を返します。 監査ログ形式が <code class="literal">JSON</code> でない場合は、エラーが発生します。 
            </p><p>
              引数または <code class="literal">JSON</code> ハッシュ引数を指定しない場合、<code class="literal">audit_log_read()</code> は監査ログからイベントを読み取り、監査イベントの配列を含む <code class="literal">JSON</code> 文字列を返します。 hash 引数の項目は、あとで説明するように、読み取りの発生方法に影響します。 返される配列内の各要素は、<code class="literal">JSON</code> ハッシュとして表されるイベントですが、最後の要素が <code class="literal">JSON</code> <code class="literal">null</code> 値であり、次のイベントを読み取ることができないことを示す例外があります。 
            </p><p>
              <code class="literal">JSON</code> <code class="literal">null</code> 値で構成される引数を使用すると、<code class="literal">audit_log_read()</code> は現在の読取り順序をクローズします。
            </p><p>
              監査ログの読取りプロセスの詳細は、<a class="xref" href="security.html#audit-log-file-reading" title="6.4.5.6 監査ログファイルの読取り">セクション6.4.5.6「監査ログファイルの読取り」</a> を参照してください。
            </p><p>
              引数:
            </p><p>
              最後に書き込まれたイベントのブックマークを取得するには、<code class="literal">audit_log_read_bookmark()</code> をコールします。
            </p><p>
              <em class="replaceable"><code>arg</code></em>: 引数はオプションです。 省略すると、関数は現在の位置からイベントを読み取ります。 引数が存在する場合は、読取り順序をクローズする <code class="literal">JSON</code> <code class="literal">null</code> 値または <code class="literal">JSON</code> ハッシュを指定できます。 ハッシュ引数内では、項目はオプションであり、読取りを開始する位置や読み取るイベントの数など、読取り操作の側面を制御します。 次の項目は重要です (他の項目は無視されます): 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">start</code>: 最初に読み取るイベントの監査ログ内の位置。 位置はタイムスタンプとして指定され、タイムスタンプ値以降に発生する最初のイベントから読取りが開始されます。 <code class="literal">start</code> アイテムの形式は次のとおりです。ここで、<em class="replaceable"><code>value</code></em> はリテラルのタイムスタンプ値です: 
                </p><pre class="programlisting">"start": { "timestamp": "<em class="replaceable"><code>value</code></em>" }
</pre><p>
                  <code class="literal">start</code> 品目は、MySQL 8.0.22 で許可されています。
                </p></li><li class="listitem"><p>
                  <code class="literal">timestamp</code>, <code class="literal">id</code>: 最初に読み取るイベントの監査ログ内の位置。 <code class="literal">timestamp</code> アイテムと <code class="literal">id</code> アイテムは、特定のイベントを一意に識別するブックマークで構成されます。 <code class="literal">audit_log_read()</code> 引数にいずれかの項目が含まれている場合、位置を完全に指定するには両方を含める必要があります。そうしないと、エラーが発生します。 
                </p></li><li class="listitem"><p>
                  <code class="literal">max_array_length</code>: ログから読み取るイベントの最大数。 この項目を省略した場合、デフォルトでは、ログの最後まで、または読取りバッファがいっぱいになるまで (いずれか早い方まで) 読み取られます。 
                </p></li></ul></div><p>
              開始位置を <code class="literal">audit_log_read()</code> に指定するには、<code class="literal">start</code> アイテムまたは <code class="literal">timestamp</code> アイテムと <code class="literal">id</code> アイテムで構成されるブックマークを含むハッシュ引数を渡します。 ハッシュ引数に <code class="literal">start</code> アイテムとブックマークの両方が含まれている場合は、エラーが発生します。 
            </p><p>
              ハッシュ引数で開始位置が指定されていない場合、読取りは現在の位置から続行されます。
            </p><p>
              タイムスタンプ値に時間部分が含まれていない場合は、<code class="literal">00:00:00</code> の時間部分が想定されます。
            </p><p>
              戻り値:
            </p><p>
              コールが成功した場合、戻り値は監査イベントの配列を含む <code class="literal">JSON</code> 文字列、または読取りシーケンスをクローズする引数として渡された場合は <code class="literal">JSON</code> <code class="literal">null</code> 値です。 コールが失敗すると、戻り値は <code class="literal">NULL</code> になり、エラーが発生します。 
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_read(audit_log_read_bookmark());</code></strong>
+-----------------------------------------------------------------------+
| audit_log_read(audit_log_read_bookmark())                             |
+-----------------------------------------------------------------------+
| [ {"timestamp":"2020-05-18 22:41:24","id":0,"class":"connection", ... |
+-----------------------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT audit_log_read('null');</code></strong>
+------------------------+
| audit_log_read('null') |
+------------------------+
| null                   |
+------------------------+
</pre><p>
              メモ:
            </p><p>
              MySQL 8.0.19 より前では、文字列の戻り値はバイナリ <code class="literal">JSON</code> 文字列です。 このような値を非バイナリ文字列に変換する方法については、<a class="xref" href="security.html#audit-log-file-reading" title="6.4.5.6 監査ログファイルの読取り">セクション6.4.5.6「監査ログファイルの読取り」</a> を参照してください。 
            </p></li><li class="listitem"><p><a name="function_audit-log-read-bookmark"></a>
              <code class="literal">audit_log_read_bookmark()</code>
            </p><a class="indexterm" name="idm46723750858704"></a><a class="indexterm" name="idm46723750857104"></a><p>
              最後に書き込まれた監査ログイベントのブックマークを表す <code class="literal">JSON</code> 文字列を返します。 監査ログ形式が <code class="literal">JSON</code> でない場合は、エラーが発生します。 
            </p><p>
              ブックマークは、監査ログ内のイベントの位置を一意に識別する <code class="literal">timestamp</code> および <code class="literal">id</code> アイテムを含む <code class="literal">JSON</code> ハッシュです。 <code class="literal">audit_log_read()</code> に渡して、その関数に読取りを開始する位置を示すのに適しています。 
            </p><p>
              監査ログの読取りプロセスの詳細は、<a class="xref" href="security.html#audit-log-file-reading" title="6.4.5.6 監査ログファイルの読取り">セクション6.4.5.6「監査ログファイルの読取り」</a> を参照してください。
            </p><p>
              引数:
            </p><p>
              なし
            </p><p>
              戻り値:
            </p><p>
              成功のためのブックマーク、または失敗のための <code class="literal">NULL</code> とエラーを含む <code class="literal">JSON</code> 文字列。
            </p><p>
              例:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_log_read_bookmark();</code></strong>
+-------------------------------------------------+
| audit_log_read_bookmark()                       |
+-------------------------------------------------+
| { "timestamp": "2019-10-03 21:03:44", "id": 0 } |
+-------------------------------------------------+
</pre><p>
              メモ:
            </p><p>
              MySQL 8.0.19 より前では、文字列の戻り値はバイナリ <code class="literal">JSON</code> 文字列です。 このような値を非バイナリ文字列に変換する方法については、<a class="xref" href="security.html#audit-log-file-reading" title="6.4.5.6 監査ログファイルの読取り">セクション6.4.5.6「監査ログファイルの読取り」</a> を参照してください。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-option-variable-reference"></a>監査ログオプションおよび変数リファレンス</h5></div></div></div><div class="table"><a name="idm46723750835856"></a><p class="title"><b>表 6.37 「監査ログオプションおよび変数リファレンス」</b></p><div class="table-contents"><table frame="box" rules="all" summary="「監査ログのコマンド行オプション、システム変数、およびステータス変数のリファレンス。」"><col style="width=20%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><col style="width=15%"><thead><tr><th scope="col">名前</th>
<th scope="col">コマンド行</th>
<th scope="col">オプションファイル</th>
<th scope="col">システム変数</th>
<th scope="col">ステータス変数</th>
<th scope="col">変数スコープ</th>
<th scope="col">動的</th>
</tr></thead><tbody><tr><th scope="row"><a class="link" href="security.html#option_mysqld_audit-log">audit-log</a></th>
<td>はい</td>
<td>はい</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_compression">audit_log_compression</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_current_session">audit_log_current_session</a></th>
<td></td>
<td></td>
<td>はい</td>
<td></td>
<td>両方</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#statvar_Audit_log_current_size">Audit_log_current_size</a></th>
<td></td>
<td></td>
<td></td>
<td>はい</td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_encryption">audit_log_encryption</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#statvar_Audit_log_event_max_drop_size">Audit_log_event_max_drop_size</a></th>
<td></td>
<td></td>
<td></td>
<td>はい</td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#statvar_Audit_log_events">Audit_log_events</a></th>
<td></td>
<td></td>
<td></td>
<td>はい</td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#statvar_Audit_log_events_filtered">Audit_log_events_filtered</a></th>
<td></td>
<td></td>
<td></td>
<td>はい</td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#statvar_Audit_log_events_lost">Audit_log_events_lost</a></th>
<td></td>
<td></td>
<td></td>
<td>はい</td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#statvar_Audit_log_events_written">Audit_log_events_written</a></th>
<td></td>
<td></td>
<td></td>
<td>はい</td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_file">audit_log_file</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_filter_id">audit_log_filter_id</a></th>
<td></td>
<td></td>
<td>はい</td>
<td></td>
<td>両方</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_flush">audit_log_flush</a></th>
<td></td>
<td></td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_format">audit_log_format</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_password_history_keep_days">audit_log_password_history_keep_days</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_prune_seconds">audit_log_prune_seconds</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_read_buffer_size">audit_log_read_buffer_size</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>異なる</td>
<td>異なる</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>はい</td>
</tr><tr><th scope="row"><a class="link" href="security.html#sysvar_audit_log_strategy">audit_log_strategy</a></th>
<td>はい</td>
<td>はい</td>
<td>はい</td>
<td></td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#statvar_Audit_log_total_size">Audit_log_total_size</a></th>
<td></td>
<td></td>
<td></td>
<td>はい</td>
<td>グローバル</td>
<td>いいえ</td>
</tr><tr><th scope="row"><a class="link" href="security.html#statvar_Audit_log_write_waits">Audit_log_write_waits</a></th>
<td></td>
<td></td>
<td></td>
<td>はい</td>
<td>グローバル</td>
<td>いいえ</td>
</tr></tbody></table></div></div><br class="table-break"></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-options-variables"></a>監査ログのオプションおよび変数</h5></div></div></div><p>
          このセクションでは、MySQL Enterprise Audit の操作を構成するコマンドオプションおよびシステム変数について説明します。 起動時に指定された値が正しくない場合、<code class="literal">audit_log</code> プラグインが正しく初期化されず、サーバーがロードしない可能性があります。 この場合、サーバーは他の監査ログ設定を認識しないため、エラーメッセージを生成することもあります。 
        </p><p>
          監査ログプラグインのアクティブ化を構成するには、このオプションを使用します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_audit-log"></a>
              <code class="option">--audit-log[=<em class="replaceable"><code>value</code></em>]</code>
            </p><a class="indexterm" name="idm46723750624160"></a><a class="indexterm" name="idm46723750622016"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit-log"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log[=value]</code></td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ON</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">FORCE</code></p><p class="valid-value"><code class="literal">FORCE_PLUS_PERMANENT</code></p></td>
</tr></tbody></table></div><p>
              このオプションは、サーバーの起動時に <code class="literal">audit_log</code> プラグインをロードする方法を制御します。 プラグインが以前に <code class="literal">INSTALL PLUGIN</code> に登録されているか、<code class="option">--plugin-load</code> または <code class="option">--plugin-load-add</code> にロードされている場合にのみ使用できます。 <a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 MySQL Enterprise Audit のインストールまたはアンインストール">セクション6.4.5.2「MySQL Enterprise Audit のインストールまたはアンインストール」</a>を参照してください。 
            </p><p>
              <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a>で説明したように、オプションの値は、プラグインのロードオプションに指定可能な値のいずれかである必要があります。 たとえば、<code class="option">--audit-log=FORCE_PLUS_PERMANENT</code> は、プラグインをロードし、それがサーバーの実行時に削除されることを回避するようにサーバーに指示します。 
            </p></li></ul></div><p>
          監査ログプラグインが有効になっている場合、ロギングの制御を許可するいくつかのシステム変数が公開されます:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log%';</code></strong>
+-----------------------------+--------------+
| Variable_name               | Value        |
+-----------------------------+--------------+
| audit_log_buffer_size       | 1048576      |
| audit_log_connection_policy | ALL          |
| audit_log_current_session   | OFF          |
| audit_log_exclude_accounts  |              |
| audit_log_file              | audit.log    |
| audit_log_filter_id         | 0            |
| audit_log_flush             | OFF          |
| audit_log_format            | NEW          |
| audit_log_include_accounts  |              |
| audit_log_policy            | ALL          |
| audit_log_rotate_on_size    | 0            |
| audit_log_statement_policy  | ALL          |
| audit_log_strategy          | ASYNCHRONOUS |
+-----------------------------+--------------+
</pre><p>
          これらの変数のいずれも、サーバーの起動時 (一部は実行時) に設定できます。 レガシーモードの監査ログフィルタリングでのみ使用可能なものは、このように記載されています。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_audit_log_buffer_size"></a>
              <code class="literal">audit_log_buffer_size</code>
            </p><a class="indexterm" name="idm46723750591536"></a><a class="indexterm" name="idm46723750589984"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_buffer_size"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-buffer-size=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">1048576</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">4096</code></td>
</tr><tr><th>最大値 (64 ビットプラットフォーム)</th>
<td><code class="literal">18446744073709547520</code></td>
</tr><tr><th>最大値 (32 ビットプラットフォーム)</th>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table></div><p>
              監査ログプラグインが非同期的にイベントをログに書き込むと、イベントの内容を書き込む前に、バッファーを使用してそれらを格納します。 この変数は、そのバッファーのサイズ (バイト単位) を制御します。 サーバーは、この値を 4096 の倍数に調整します。 このプラグインでは、初期化時に割り当てられ、終了時に削除される単一のバッファーが使用されます。 このプラグインは、ロギングが非同期の場合にのみ、このバッファーを割り当てます。 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_compression"></a>
              <code class="literal">audit_log_compression</code>
            </p><a class="indexterm" name="idm46723750556784"></a><a class="indexterm" name="idm46723750555232"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_compression"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-compression=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_compression">audit_log_compression</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NONE</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">NONE</code></p><p class="valid-value"><code class="literal">GZIP</code></p></td>
</tr></tbody></table></div><p>
              監査ログファイルの圧縮のタイプ。 許可される値は、<code class="literal">NONE</code> (圧縮なし、デフォルト) および <code class="literal">GZIP</code> (GNU Zip 圧縮) です。 詳細は、<a class="xref" href="security.html#audit-log-file-compression" title="監査ログファイルの圧縮">監査ログファイルの圧縮</a>を参照してください。 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_connection_policy"></a>
              <code class="literal">audit_log_connection_policy</code>
            </p><a class="indexterm" name="idm46723750524480"></a><a class="indexterm" name="idm46723750522912"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_connection_policy"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-connection-policy=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ALL</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">ERRORS</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                この変数は、レガシーモードの監査ログフィルタリングにのみ適用されます (<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a> を参照)。
              </p></div><p>
              監査ログプラグインが接続イベントをそのログファイルに書き込む方法を制御するポリシーです。 次の表は、許可される値を示しています。 
            </p><div class="informaltable"><table summary="Permitted values for the audit_log_connection_policy variable."><col style="width=15%"><col style="width=85%"><thead><tr>
                  <th>値</th>
                  <th>説明</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">ALL</code></td>
                  <td>接続イベントのログをすべて記録します</td>
                </tr><tr>
                  <td><code class="literal">ERRORS</code></td>
                  <td>失敗した接続イベントのログのみを記録します</td>
                </tr><tr>
                  <td><code class="literal">NONE</code></td>
                  <td>接続イベントのログを記録しません</td>
                </tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>で説明したように、<code class="literal">audit_log_policy</code> も指定されている場合は、サーバーの起動時に、<code class="literal">audit_log_connection_policy</code> に明示的に指定された値がオーバーライドされる可能性があります。
              </p></div></li><li class="listitem"><p><a name="sysvar_audit_log_current_session"></a>
              <code class="literal">audit_log_current_session</code>
            </p><a class="indexterm" name="idm46723750474576"></a><a class="indexterm" name="idm46723750473008"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_current_session"><col style="width=30%"><col style="width=70%"><tbody><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_current_session">audit_log_current_session</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル、セッション</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">depends on filtering policy</code></td>
</tr></tbody></table></div><p>
              現在のセッションで監査ロギングが有効になっているかどうかを示します。 この変数のセッションの値は、読み取り専用です。 セッションの開始時に、<code class="literal">audit_log_include_accounts</code> および <code class="literal">audit_log_exclude_accounts</code> システム変数の値に基づいて設定されます。 監査ログプラグインはこのセッション値を使用して、そのセッションでイベントを監査するかどうかを決定します。 (グローバル値もありますが、このプラグインでは使用されません。) 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_encryption"></a>
              <code class="literal">audit_log_encryption</code>
            </p><a class="indexterm" name="idm46723750447728"></a><a class="indexterm" name="idm46723750446176"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_encryption"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-encryption=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_encryption">audit_log_encryption</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NONE</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">NONE</code></p><p class="valid-value"><code class="literal">AES</code></p></td>
</tr></tbody></table></div><p>
              監査ログファイルの暗号化のタイプ。 許可される値は、<code class="literal">NONE</code> (暗号化なし、デフォルト) および <code class="literal">AES</code> (AES-256-CBC 暗号化) です。 詳細は、<a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a>を参照してください。 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_exclude_accounts"></a>
              <code class="literal">audit_log_exclude_accounts</code>
            </p><a class="indexterm" name="idm46723750415408"></a><a class="indexterm" name="idm46723750413840"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_exclude_accounts"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-exclude-accounts=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                この変数は、レガシーモードの監査ログフィルタリングにのみ適用されます (<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a> を参照)。
              </p></div><p>
              イベントのログが記録されないアカウント。 この値には、<code class="literal">NULL</code> またはカンマで区切った 1 つ以上のアカウント名のリストを含む文字列を指定するようにしてください。 詳細は、<a class="xref" href="security.html#audit-log-filtering" title="6.4.5.7 監査ログのフィルタリング">セクション6.4.5.7「監査ログのフィルタリング」</a>を参照してください。 
            </p><p>
              <code class="literal">audit_log_exclude_accounts</code> の変更は、変更後に作成された接続にのみ影響し、既存の接続には影響しません。
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_file"></a>
              <code class="literal">audit_log_file</code>
            </p><a class="indexterm" name="idm46723750383952"></a><a class="indexterm" name="idm46723750382432"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_file"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-file=file_name</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_file">audit_log_file</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>ファイル名</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">audit.log</code></td>
</tr></tbody></table></div><p>
              監査ログプラグインがイベントを書き込むファイルのベース名と接尾辞。 ロギング形式に関係なく、デフォルト値は <code class="filename">audit.log</code> です。 名前接尾辞をフォーマットに対応させるには、別の接尾辞を選択して、名前を明示的に設定します (たとえば、XML フォーマットの場合は <code class="filename">audit.xml</code>、JSON フォーマットの場合は <code class="filename">audit.json</code>)。 
            </p><p>
              <code class="literal">audit_log_file</code> の値が相対パス名の場合、プラグインはデータディレクトリを基準にした相対パス名を解釈します。 値がフルパス名の場合、プラグインは値をそのまま使用します。 フルパス名は、監査ファイルを別のファイルシステムまたはディレクトリに配置することをお勧めします。 セキュリティ上の理由から、MySQL サーバーおよびログを表示する正当な理由を持つユーザーのみがアクセスできるディレクトリに監査ログファイルを書き込みます。 
            </p><p>
              監査ログプラグインが <code class="literal">audit_log_file</code> 値を解釈する方法と、プラグインの初期化および終了時に発生するファイル名変更の規則の詳細は、<a class="xref" href="security.html#audit-log-file-name" title="監査ログファイルのネーミング規則">監査ログファイルのネーミング規則</a> を参照してください。
            </p><p>
              監査ログプラグインは、読み取り可能な監査ログファイルを検索する場所として、(<code class="literal">audit_log_file</code> の値から決定された) 監査ログファイルを含むディレクトリを使用します。 これらのログファイルと現在のファイルから、プラグインは監査ログのブックマークおよび読み取り関数で使用される対象のもののリストを構築します。 <a class="xref" href="security.html#audit-log-file-reading" title="6.4.5.6 監査ログファイルの読取り">セクション6.4.5.6「監査ログファイルの読取り」</a>を参照してください。 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_filter_id"></a>
              <code class="literal">audit_log_filter_id</code>
            </p><a class="indexterm" name="idm46723750347616"></a><a class="indexterm" name="idm46723750346064"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_filter_id"><col style="width=30%"><col style="width=70%"><tbody><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_filter_id">audit_log_filter_id</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル、セッション</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr></tbody></table></div><p>
              この変数のセッション値は、現在のセッションの監査フィルタの内部的に保持されている ID を示します。 値 0 は、セッションにフィルタが割り当てられていないことを意味します。 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_flush"></a>
              <code class="literal">audit_log_flush</code>
            </p><a class="indexterm" name="idm46723750325280"></a><a class="indexterm" name="idm46723750323744"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_flush"><col style="width=30%"><col style="width=70%"><tbody><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_flush">audit_log_flush</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">OFF</code></td>
</tr></tbody></table></div><p>
              この変数が有効になるよう (1 または <code class="literal">ON</code>) に設定されている場合、監査ログプラグインはそのログファイルを閉じてから再度開いて、フラッシュします。 (この値は、別のフラッシュを実行するために再度有効にする前に、明示的に無効にする必要がないように、<code class="literal">OFF</code> のままになっています。) <code class="literal">audit_log_rotate_on_size</code> が 0 である場合を除いて、この変数を有効にしても効果はありません。 詳細は、<a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>を参照してください。 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_format"></a>
              <code class="literal">audit_log_format</code>
            </p><a class="indexterm" name="idm46723750297616"></a><a class="indexterm" name="idm46723750296080"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_format"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-format=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_format">audit_log_format</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NEW</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">OLD</code></p><p class="valid-value"><code class="literal">NEW</code></p><p class="valid-value"><code class="literal">JSON</code></p></td>
</tr></tbody></table></div><p>
              監査ログファイルの形式。 許可される値は、<code class="literal">OLD</code> (古いスタイルの XML)、<code class="literal">NEW</code> (新しいスタイルの XML。デフォルト) および <code class="literal">JSON</code> です。 各形式についての詳細は、<a class="xref" href="security.html#audit-log-file-formats" title="6.4.5.4 監査ログファイル形式">セクション6.4.5.4「監査ログファイル形式」</a>を参照してください。 
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                ログ形式を変更する際に考慮する問題の詳細は、<a class="xref" href="security.html#audit-log-file-format" title="監査ログファイル形式の選択">監査ログファイル形式の選択</a> を参照してください。
              </p></div></li><li class="listitem"><p><a name="sysvar_audit_log_include_accounts"></a>
              <code class="literal">audit_log_include_accounts</code>
            </p><a class="indexterm" name="idm46723750261984"></a><a class="indexterm" name="idm46723750260416"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_include_accounts"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-include-accounts=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>文字列</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">NULL</code></td>
</tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                この変数は、レガシーモードの監査ログフィルタリングにのみ適用されます (<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a> を参照)。
              </p></div><p>
              イベントのログが記録されるアカウント。 この値には、<code class="literal">NULL</code> またはカンマで区切った 1 つ以上のアカウント名のリストを含む文字列を指定するようにしてください。 詳細は、<a class="xref" href="security.html#audit-log-filtering" title="6.4.5.7 監査ログのフィルタリング">セクション6.4.5.7「監査ログのフィルタリング」</a>を参照してください。 
            </p><p>
              <code class="literal">audit_log_include_accounts</code> の変更は、変更後に作成された接続にのみ影響し、既存の接続には影響しません。
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_password_history_keep_days"></a>
              <code class="literal">audit_log_password_history_keep_days</code>
            </p><a class="indexterm" name="idm46723750230464"></a><a class="indexterm" name="idm46723750228864"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_password_history_keep_days"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-password-history-keep-days=#</code></td>
</tr><tr><th>導入</th>
<td>8.0.17</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_password_history_keep_days">audit_log_password_history_keep_days</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table></div><p>
              監査ログプラグインは、MySQL 鍵リングに格納されている暗号化パスワードを使用してログファイルの暗号化を実装します (<a class="xref" href="security.html#audit-log-file-encryption" title="監査ログファイルの暗号化">監査ログファイルの暗号化</a> を参照)。 このプラグインは、パスワードのアーカイブと有効期限 (削除) を含むパスワード履歴も実装します。 
            </p><p>
              監査ログプラグインは、新しい暗号化パスワードを作成するときに、以前のパスワード (存在する場合) をあとで使用するためにアーカイブします。 <code class="literal">audit_log_password_history_keep_days</code> 変数は、期限切れのアーカイブ済パスワードの自動削除を制御します。 この値は、アーカイブ監査ログの暗号化パスワードが削除されるまでの日数を示します。 デフォルトの 0 は、パスワードの有効期限を無効にします: パスワードの保存期間は永久的です。 
            </p><p>
              新しい監査ログ暗号化パスワードは、次の状況で作成されます:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  プラグインの初期化中に、プラグインがログファイルの暗号化が有効であることを検出すると、キーリングに監査ログの暗号化パスワードが含まれているかどうかをチェックします。 そうでない場合、プラグインはランダムな初期暗号化パスワードを自動的に生成します。 
                </p></li><li class="listitem"><p>
                  特定のパスワードを設定するために <code class="literal">audit_log_encryption_password_set()</code> 関数がコールされた場合。
                </p></li></ul></div><p>
              いずれの場合も、プラグインは新しいパスワードをキーリングに格納し、それを使用して新しいログファイルを暗号化します。
            </p><p>
              期限切れの監査ログ暗号化パスワードの削除は、次の状況で発生します:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  プラグインの初期化中。
                </p></li><li class="listitem"><p>
                  <code class="literal">audit_log_encryption_password_set()</code> 関数がコールされたとき。
                </p></li><li class="listitem"><p>
                  <code class="literal">audit_log_password_history_keep_days</code> のランタイム値が現在の値から 0 より大きい値に変更された場合。 ランタイム値の変更は、<code class="literal">GLOBAL</code> または <code class="literal">PERSIST</code> キーワードを使用するが <code class="literal">PERSIST_ONLY</code> キーワードを使用しない <code class="literal">SET</code> ステートメントで発生します。 <code class="literal">PERSIST_ONLY</code> は変数設定を <code class="filename">mysqld-auto.cnf</code> に書き込みますが、ランタイム値には影響しません。 
                </p><a class="indexterm" name="idm46723750179648"></a><a class="indexterm" name="idm46723750178160"></a></li></ul></div><p>
              パスワードの削除が発生すると、<code class="literal">audit_log_password_history_keep_days</code> の現在の値によって、削除するパスワードが決まります:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  値が 0 の場合、プラグインはパスワードを削除しません。
                </p></li><li class="listitem"><p>
                  値が <em class="replaceable"><code>N</code></em> &gt; 0 の場合、プラグインは <em class="replaceable"><code>N</code></em> 日より古いパスワードを削除します。
                </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                アーカイブされた暗号化ログファイルの読取りに必要な古いパスワードを期限切れにしないように注意してください。
              </p></div><p>
              通常、パスワードの有効期限を無効のままにすると (つまり、<code class="literal">audit_log_password_history_keep_days</code> の値が 0 の場合)、変数にゼロより大きい値を一時的に割り当てることで、オンデマンドクリーンアップ操作を実行できます。 たとえば、365 日より古いパスワードを期限切れにするには、次のようにします: 
            </p><pre class="programlisting">SET GLOBAL audit_log_password_history_keep_days = 365;
SET GLOBAL audit_log_password_history_keep_days = 0;
</pre><p>
              <code class="literal">audit_log_password_history_keep_days</code> のランタイム値を設定するには、グローバルシステム変数のランタイム値を設定するために通常必要な <code class="literal">SYSTEM_VARIABLES_ADMIN</code> 権限 (または非推奨の <code class="literal">SUPER</code> 権限) に加えて、<code class="literal">AUDIT_ADMIN</code> 権限が必要です。
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_policy"></a>
              <code class="literal">audit_log_policy</code>
            </p><a class="indexterm" name="idm46723750159696"></a><a class="indexterm" name="idm46723750158160"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_policy"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-policy=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ALL</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">LOGINS</code></p><p class="valid-value"><code class="literal">QUERIES</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                この変数は、レガシーモードの監査ログフィルタリングにのみ適用されます (<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a> を参照)。
              </p></div><p>
              監査ログプラグインがイベントをそのログファイルに書き込む方法を制御するポリシーです。 次の表は、許可される値を示しています。 
            </p><div class="informaltable"><table summary="Permitted values for the audit_log_policy variable."><col style="width=15%"><col style="width=85%"><thead><tr>
                  <th>値</th>
                  <th>説明</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">ALL</code></td>
                  <td>イベントのログをすべて記録します</td>
                </tr><tr>
                  <td><code class="literal">LOGINS</code></td>
                  <td>ログインイベントのログのみを記録します</td>
                </tr><tr>
                  <td><code class="literal">QUERIES</code></td>
                  <td>クエリーイベントのログのみを記録します</td>
                </tr><tr>
                  <td><code class="literal">NONE</code></td>
                  <td>ログを何も記録しません (監査ストリームを無効にします)</td>
                </tr></tbody></table></div><p>
              <code class="literal">audit_log_policy</code> は、サーバーの起動時にのみ設定できます。 実行時は、読み取り専用の変数です。 他の 2 つのシステム変数 (<code class="literal">audit_log_connection_policy</code> および <code class="literal">audit_log_statement_policy</code>) は、ロギングポリシーをより細かく制御し、起動時または実行時に設定できます。 起動時に他の 2 つの変数ではなく <code class="literal">audit_log_policy</code> を使用する場合、サーバーはその値を使用してこれらの変数を設定します。 ポリシーの変数とそれらの相互作用についての詳細は、<a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>を参照してください。 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_prune_seconds"></a>
              <code class="literal">audit_log_prune_seconds</code>
            </p><a class="indexterm" name="idm46723750104048"></a><a class="indexterm" name="idm46723750102496"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_prune_seconds"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-prune-seconds=#</code></td>
</tr><tr><th>導入</th>
<td>8.0.24</td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_prune_seconds">audit_log_prune_seconds</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最小値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">4294967295</code></td>
</tr><tr><th>単位</th>
<td><code class="literal">seconds</code></td>
</tr></tbody></table></div><p>
              この変数は、JSON 形式のログファイルでのみサポートされている監査ログファイルのプルーニングに関連します。
            </p><p>
              <code class="literal">audit_log_rotate_on_size</code> が 0 より大きい場合を除き、<code class="literal">audit_log_prune_seconds</code> は効果がありません。 true であると仮定した場合: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">audit_log_prune_seconds</code> が 0 (デフォルト) の場合、プルーニングは無効になり、サイズベースのローテーションの結果として作成されたログファイルは無期限に蓄積されます。
                </p></li><li class="listitem"><p>
                  <code class="literal">audit_log_prune_seconds</code> が 0 より大きい場合、プルーニングは有効で、値は監査ログファイルがプルーニングの対象になるまでの秒数です。
                </p></li></ul></div><p>
              プルーニングを有効にすると、<a class="xref" href="security.html#audit-log-space-management" title="監査ログファイルの領域管理">監査ログファイルの領域管理</a> で説明されている条件で実行されます。
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_read_buffer_size"></a>
              <code class="literal">audit_log_read_buffer_size</code>
            </p><a class="indexterm" name="idm46723750059680"></a><a class="indexterm" name="idm46723750058112"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_read_buffer_size"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-read-buffer-size=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_read_buffer_size">audit_log_read_buffer_size</a></code></td>
</tr><tr><th>スコープ (≥ 8.0.12)</th>
<td>グローバル、セッション</td>
</tr><tr><th>スコープ (8.0.11)</th>
<td>グローバル</td>
</tr><tr><th>動的 (≥ 8.0.12)</th>
<td>はい</td>
</tr><tr><th>動的 (8.0.11)</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値 (≥ 8.0.12)</th>
<td><code class="literal">32768</code></td>
</tr><tr><th>デフォルト値 (8.0.11)</th>
<td><code class="literal">1048576</code></td>
</tr><tr><th>最小値 (≥ 8.0.12)</th>
<td><code class="literal">32768</code></td>
</tr><tr><th>最小値 (8.0.11)</th>
<td><code class="literal">1024</code></td>
</tr><tr><th>最大値</th>
<td><code class="literal">4194304</code></td>
</tr></tbody></table></div><p>
              監査ログファイルから読み取るバッファサイズ (バイト単位)。 <code class="literal">audit_log_read()</code> 関数は、このバイト数以下を読み取ります。 ログファイルの読取りは、JSON ログ形式でのみサポートされます。 詳細は、<a class="xref" href="security.html#audit-log-file-reading" title="6.4.5.6 監査ログファイルの読取り">セクション6.4.5.6「監査ログファイルの読取り」</a>を参照してください。 
            </p><p>
              MySQL 8.0.12 では、この変数のデフォルトは 32KB で、実行時に設定できます。 各クライアントは、<code class="literal">audit_log_read()</code> を使用するために <code class="literal">audit_log_read_buffer_size</code> のセッション値を適切に設定する必要があります。 MySQL 8.0.12 より前では、<code class="literal">audit_log_read_buffer_size</code> のデフォルトは 1MB で、すべてのクライアントに影響し、サーバーの起動時にのみ変更できます。 
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_rotate_on_size"></a>
              <code class="literal">audit_log_rotate_on_size</code>
            </p><a class="indexterm" name="idm46723750013120"></a><a class="indexterm" name="idm46723750011568"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_rotate_on_size"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-rotate-on-size=#</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Integer</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">0</code></td>
</tr><tr><th>単位</th>
<td><code class="literal">bytes</code></td>
</tr></tbody></table></div><p>
              <code class="literal">audit_log_rotate_on_size</code> が 0 の場合、監査ログプラグインはサイズベースのログファイルの自動ローテーションを実行しません。 代わりに、<code class="literal">audit_log_flush</code> 使用して、要求に応じてログを閉じてから再度開きます。 この場合は、フラッシュする前に、ファイルの名前をサーバーの外部に手動で変更します。 
            </p><p>
              <code class="literal">audit_log_rotate_on_size</code> が 0 より大きい場合、サイズベースのログファイルの自動ローテーションが発生します。 ログファイルへの書き込みによってそのサイズが <code class="literal">audit_log_rotate_on_size</code> 値を超えるたびに、監査ログプラグインは現在のログファイルを閉じて名前を変更し、新しいログファイルを開きます。 
            </p><p>
              <code class="literal">audit_log_rotate_on_size</code> を 4096 の倍数でない値に設定すると、最も近い倍数に切り捨てられます。 (このため、4096 未満の値に設定すると 0 に設定され、手動以外は回転は発生しません。) 
            </p><p>
              MySQL 8.0.24 では、<code class="literal">audit_log_rotate_on_size</code> は監査ログファイルのプルーニングを有効にできるかどうかも制御します:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">audit_log_rotate_on_size</code> が無効 (0) の場合、プルーニングは有効にできず、<code class="literal">audit_log_prune_seconds</code> は無効になります。
                </p></li><li class="listitem"><p>
                  <code class="literal">audit_log_rotate_on_size</code> が有効になっている (0 より大きい) 場合は、プルーニングを有効にでき、<code class="literal">audit_log_prune_seconds</code> によってプルーニングが行われるかどうかが決定されます。
                </p></li></ul></div><p>
              監査ログファイルのローテーションおよびプルーニングの詳細は、<a class="xref" href="security.html#audit-log-space-management" title="監査ログファイルの領域管理">監査ログファイルの領域管理</a> を参照してください。
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_statement_policy"></a>
              <code class="literal">audit_log_statement_policy</code>
            </p><a class="indexterm" name="idm46723749967376"></a><a class="indexterm" name="idm46723749965808"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_statement_policy"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-statement-policy=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ALL</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">ERRORS</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                この変数は、レガシーモードの監査ログフィルタリングにのみ適用されます (<a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.9 レガシーモード監査ログのフィルタリング">セクション6.4.5.9「レガシーモード監査ログのフィルタリング」</a> を参照)。
              </p></div><p>
              監査ログプラグインがステートメントイベントをそのログファイルに書き込む方法を制御するポリシーです。 次の表は、許可される値を示しています。 
            </p><div class="informaltable"><table summary="Permitted values for the audit_log_statement_policy variable."><col style="width=15%"><col style="width=85%"><thead><tr>
                  <th>値</th>
                  <th>説明</th>
                </tr></thead><tbody><tr>
                  <td><code class="literal">ALL</code></td>
                  <td>ステートメントイベントのログをすべて記録します</td>
                </tr><tr>
                  <td><code class="literal">ERRORS</code></td>
                  <td>失敗したステートメントイベントのログのみを記録します</td>
                </tr><tr>
                  <td><code class="literal">NONE</code></td>
                  <td>ステートメントイベントのログを記録しません</td>
                </tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>で説明したように、<code class="literal">audit_log_policy</code> も指定されている場合は、サーバーの起動時に、<code class="literal">audit_log_statement_policy</code> に明示的に指定された値がオーバーライドされる可能性があります。
              </p></div></li><li class="listitem"><p><a name="sysvar_audit_log_strategy"></a>
              <code class="literal">audit_log_strategy</code>
            </p><a class="indexterm" name="idm46723749917360"></a><a class="indexterm" name="idm46723749915808"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for audit_log_strategy"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--audit-log-strategy=value</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_strategy">audit_log_strategy</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>いいえ</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>列挙</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ASYNCHRONOUS</code></td>
</tr><tr><th>有効な値</th>
<td><p class="valid-value"><code class="literal">ASYNCHRONOUS</code></p><p class="valid-value"><code class="literal">PERFORMANCE</code></p><p class="valid-value"><code class="literal">SEMISYNCHRONOUS</code></p><p class="valid-value"><code class="literal">SYNCHRONOUS</code></p></td>
</tr></tbody></table></div><p>
              監査ログプラグインで使用されるロギング方法。 次の戦略値を使用できます: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">ASYNCHRONOUS</code>: 非同期でログを記録します。 出力バッファ内の領域を待機します。 
                </p></li><li class="listitem"><p>
                  <code class="literal">PERFORMANCE</code>: 非同期でログを記録します。 出力バッファに十分な領域がないリクエストを削除します。 
                </p></li><li class="listitem"><p>
                  <code class="literal">SEMISYNCHRONOUS</code>: 同期的にログを記録します。 オペレーティングシステムによるキャッシュを許可します。 
                </p></li><li class="listitem"><p>
                  <code class="literal">SYNCHRONOUS</code>: 同期的にログを記録します。 各リクエストの後に <code class="filename">sync()</code> をコールします。 
                </p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="audit-log-status-variables"></a>監査ログステータス変数</h5></div></div></div><p>
          監査ログプラグインが有効になっている場合は、操作情報を提供するいくつかのステータス変数が公開されます。 これらの変数は、レガシーモードの監査フィルタリングおよび JSON モードの監査フィルタリングに使用できます。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Audit_log_current_size"></a>
              <code class="literal">Audit_log_current_size</code>
            </p><a class="indexterm" name="idm46723749874640"></a><a class="indexterm" name="idm46723749873072"></a><p>
              現在の監査ログファイルのサイズ。 この値は、イベントがログに書き込まれると増加し、ログがローテーションされると 0 にリセットされます。 
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_event_max_drop_size"></a>
              <code class="literal">Audit_log_event_max_drop_size</code>
            </p><a class="indexterm" name="idm46723749868128"></a><a class="indexterm" name="idm46723749866544"></a><p>
              パフォーマンスロギングモードで破棄された最大イベントのサイズ。 ロギングモードについては、<a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>を参照してください。 
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_events"></a>
              <code class="literal">Audit_log_events</code>
            </p><a class="indexterm" name="idm46723749860896"></a><a class="indexterm" name="idm46723749859344"></a><p>
              フィルタリングのポリシーに基づいてログに書き込まれたかどうかに関係なく、監査ログプラグインによって処理されたイベントの数 (<a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>を参照してください)。
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_filtered"></a>
              <code class="literal">Audit_log_events_filtered</code>
            </p><a class="indexterm" name="idm46723749853712"></a><a class="indexterm" name="idm46723749852144"></a><p>
              フィルタリングのポリシーに基づいて、監査ログプラグインによってフィルタリングされた (ログに書き込まれなかった) イベントの数 (<a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>を参照してください)。
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_lost"></a>
              <code class="literal">Audit_log_events_lost</code>
            </p><a class="indexterm" name="idm46723749846400"></a><a class="indexterm" name="idm46723749844848"></a><p>
              イベントが使用可能な監査ログバッファー領域よりも大きかったために、パフォーマンスロギングモードで失われたイベントの数。 この値は、<code class="literal">audit_log_buffer_size</code> を設定して、パフォーマンスモード用にバッファーのサイズを調整する方法を評価する際に役立つことがあります。 ロギングモードについては、<a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>を参照してください。 
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_written"></a>
              <code class="literal">Audit_log_events_written</code>
            </p><a class="indexterm" name="idm46723749837888"></a><a class="indexterm" name="idm46723749836320"></a><p>
              監査ログに書き込まれたイベントの数。
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_total_size"></a>
              <code class="literal">Audit_log_total_size</code>
            </p><a class="indexterm" name="idm46723749831552"></a><a class="indexterm" name="idm46723749830000"></a><p>
              すべての監査ログファイルに書き込まれたイベントの合計サイズ。 <code class="literal">Audit_log_current_size</code> とは異なり、<code class="literal">Audit_log_total_size</code> の値は、ログがローテーションされたときにも増加します。 
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_write_waits"></a>
              <code class="literal">Audit_log_write_waits</code>
            </p><a class="indexterm" name="idm46723749823088"></a><a class="indexterm" name="idm46723749821536"></a><p>
              非同期ロギングモードでイベントが監査ログバッファー内の領域を待機する必要があった回数。 ロギングモードについては、<a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 監査ロギング特性の構成">セクション6.4.5.5「監査ロギング特性の構成」</a>を参照してください。 
            </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="audit-log-restrictions"></a>6.4.5.11 監査ログの制限</h4></div></div></div><p>
        MySQL Enterprise Audit には、次の一般的な制限事項があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL ステートメントのみがログに記録されます。 memcached、Node.JS、NDB API などの非 SQL API によって行われた変更はログに記録されません。 
          </p></li><li class="listitem"><p>
            最上位のステートメントのみのログが記録され、トリガーやストアドプロシージャーなどのストアドプログラム内のステートメントのログは記録されません。
          </p></li><li class="listitem"><p>
            <code class="literal">LOAD DATA</code> などのステートメントで参照されるファイルの内容は記録されません。
          </p></li></ul></div><p><b>NDB Cluster. </b>
          次の条件に従って、MySQL NDB Cluster で MySQL Enterprise Audit を使用できます:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            ログに記録されるすべての変更は、SQL インタフェースを使用して行う必要があります。 NDB API、memcached、または ClusterJ によって提供されるインタフェースなど、SQL 以外のインタフェースを使用した変更はログに記録されません。 
          </p></li><li class="listitem"><p>
            このプラグインは、クラスタで SQL を実行するために使用される各 MySQL サーバーにインストールする必要があります。
          </p></li><li class="listitem"><p>
            監査プラグインデータは、クラスタで使用されるすべての MySQL サーバー間で集約する必要があります。 この集計は、アプリケーションまたはユーザーの役割を果たします。 
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="audit-api-message-emit"></a>6.4.6 監査メッセージコンポーネント</h3></div></div></div><p>
      MySQL 8.0.14 では、<code class="literal">audit_api_message_emit</code> コンポーネントを使用して、<code class="literal">audit_api_message_emit_udf()</code> ユーザー定義関数を使用して独自のメッセージイベントを監査ログに追加できます。
    </p><p>
      <code class="literal">audit_api_message_emit</code> コンポーネントは、監査タイプのすべてのプラグインと連携します。 簡潔にするために、例では <a class="xref" href="security.html#audit-log" title="6.4.5 MySQL Enterprise Audit">セクション6.4.5「MySQL Enterprise Audit」</a> で説明されている <code class="literal">audit_log</code> プラグインを使用します。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-api-message-emit-install" title="監査メッセージコンポーネントのインストールまたはアンインストール">監査メッセージコンポーネントのインストールまたはアンインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-api-message-emit-functions" title="監査メッセージ機能">監査メッセージ機能</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="audit-api-message-emit-install"></a>監査メッセージコンポーネントのインストールまたはアンインストール</h4></div></div></div><p>
        サーバーで使用できるようにするには、コンポーネントライブラリファイルが MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) にある必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
      </p><p>
        <code class="literal">audit_api_message_emit</code> コンポーネントをインストールするには、次のステートメントを使用します:
      </p><pre class="programlisting">INSTALL COMPONENT "file://component_audit_api_message_emit";
</pre><p>
        コンポーネントのインストールは、サーバーの起動ごとに実行する必要のない一度限りの操作です。 <code class="literal">INSTALL COMPONENT</code> によってコンポーネントがロードされ、<code class="literal">mysql.component</code> システムテーブルにも登録されて、後続のサーバー起動時にロードされます。 
      </p><p>
        <code class="literal">audit_api_message_emit</code> コンポーネントをアンインストールするには、次のステートメントを使用します:
      </p><pre class="programlisting">UNINSTALL COMPONENT "file://component_audit_api_message_emit";
</pre><p>
        <code class="literal">UNINSTALL COMPONENT</code> はコンポーネントをアンロードし、<code class="literal">mysql.component</code> システムテーブルから登録解除して、後続のサーバー起動時にロードされないようにします。
      </p><p>
        <code class="literal">audit_api_message_emit</code> コンポーネントをインストールおよびアンインストールすると、コンポーネントが実装する <code class="literal">audit_api_message_emit_udf()</code> 関数がインストールおよびアンインストールされるため、<code class="literal">CREATE FUNCTION</code> または <code class="literal">DROP FUNCTION</code> を使用して行う必要はありません。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="audit-api-message-emit-functions"></a>監査メッセージ機能</h4></div></div></div><p>
        このセクションでは、<code class="literal">audit_api_message_emit</code> コンポーネントによって実装される <code class="literal">audit_api_message_emit_udf()</code> ユーザー定義関数 (UDF) について説明します。
      </p><p>
        監査メッセージ機能を使用する前に、<a class="xref" href="security.html#audit-api-message-emit-install" title="監査メッセージコンポーネントのインストールまたはアンインストール">監査メッセージコンポーネントのインストールまたはアンインストール</a> の指示に従って監査メッセージコンポーネントをインストールします。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_audit-api-message-emit-udf"></a>
            <code class="literal">audit_api_message_emit_udf(<em class="replaceable"><code>component</code></em>, <em class="replaceable"><code>producer</code></em>, <em class="replaceable"><code>message</code></em>[, <em class="replaceable"><code>key</code></em>, <em class="replaceable"><code>value</code></em>] ...)</code>
          </p><a class="indexterm" name="idm46723749768080"></a><a class="indexterm" name="idm46723749766528"></a><p>
            監査ログにメッセージイベントを追加します。 メッセージイベントには、コール元が選択するコンポーネント、プロデューサおよびメッセージ文字列と、オプションでキーと値のペアのセットが含まれます。 
          </p><p>
            この UDF によってポストされたイベントは、監査タイプの有効なすべてのプラグインに送信され、それぞれが独自のルールに従ってイベントを処理します。 監査タイプのプラグインが有効になっていない場合、イベントをポストしても効果はありません。 
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>component</code></em>: コンポーネント名を指定する文字列。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>producer</code></em>: プロデューサ名を指定する文字列。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>message</code></em>: イベントメッセージを指定する文字列。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>key</code></em>, <em class="replaceable"><code>value</code></em>: イベントには、任意のアプリケーション提供のデータマップを指定する 0 個以上のキーと値のペアを含めることができます。 各 <em class="replaceable"><code>key</code></em> 引数は、<em class="replaceable"><code>value</code></em> 引数の直後の名前を指定する文字列です。 各 <em class="replaceable"><code>value</code></em> 引数は、<em class="replaceable"><code>key</code></em> 引数の直後の値を指定します。 各 <em class="replaceable"><code>value</code></em> には、文字列、数値または <code class="literal">NULL</code> を指定できます。 
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            成功を示す文字列 <code class="literal">OK</code>。 関数が失敗すると、エラーが発生します。 
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT audit_api_message_emit_udf('component_text',</code></strong>
                                         <strong class="userinput"><code>'producer_text',</code></strong>
                                         <strong class="userinput"><code>'message_text',</code></strong>
                                         <strong class="userinput"><code>'key1', 'value1',</code></strong>
                                         <strong class="userinput"><code>'key2', 123,</code></strong>
                                         <strong class="userinput"><code>'key3', NULL) AS 'Message';</code></strong>
+---------+
| Message |
+---------+
| OK      |
+---------+
</pre><p>
            追加情報:
          </p><p>
            <code class="literal">audit_api_message_emit_udf()</code> によってポストされたイベントを受信する各監査プラグインは、プラグイン固有の形式でイベントを記録します。 たとえば、<code class="literal">audit_log</code> プラグイン (<a class="xref" href="security.html#audit-log" title="6.4.5 MySQL Enterprise Audit">セクション6.4.5「MySQL Enterprise Audit」</a> を参照) は、<code class="literal">audit_log_format</code> システム変数で構成されたログ形式に応じて、次のようにメッセージ値をログに記録します: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                JSON 形式 (<code class="literal">audit_log_format=JSON</code>):
              </p><pre class="programlisting">{
  ...
  "class": "message",
  "event": "user",
  ...
  "message_data": {
    "component": "component_text",
    "producer": "producer_text",
    "message": "message_text",
    "map": {
      "key1": "value1",
      "key2": 123,
      "key3": null
    }
  }
}
</pre></li><li class="listitem"><p>
                「新規スタイルの XML」形式 (<code class="literal">audit_log_format=NEW</code>):
              </p><pre class="programlisting">&lt;AUDIT_RECORD&gt;
 ...
 &lt;NAME&gt;Message&lt;/NAME&gt;
 ...
 &lt;COMMAND_CLASS&gt;user&lt;/COMMAND_CLASS&gt;
 &lt;COMPONENT&gt;component_text&lt;/COMPONENT&gt;
 &lt;PRODUCER&gt;producer_text&lt;/PRODUCER&gt;
 &lt;MESSAGE&gt;message_text&lt;/MESSAGE&gt;
 &lt;MAP&gt;
   &lt;ELEMENT&gt;
     &lt;KEY&gt;key1&lt;/KEY&gt;
     &lt;VALUE&gt;value1&lt;/VALUE&gt;
   &lt;/ELEMENT&gt;
   &lt;ELEMENT&gt;
     &lt;KEY&gt;key2&lt;/KEY&gt;
     &lt;VALUE&gt;123&lt;/VALUE&gt;
   &lt;/ELEMENT&gt;
   &lt;ELEMENT&gt;
     &lt;KEY&gt;key3&lt;/KEY&gt;
     &lt;VALUE/&gt;
   &lt;/ELEMENT&gt;
 &lt;/MAP&gt;
&lt;/AUDIT_RECORD&gt;
</pre></li><li class="listitem"><p>
                「古いスタイルの XML」形式 (<code class="literal">audit_log_format=OLD</code>):
              </p><pre class="programlisting">&lt;AUDIT_RECORD
  ...
  NAME="Message"
  ...
  COMMAND_CLASS="user"
  COMPONENT="component_text"
  PRODUCER="producer_text"
  MESSAGE="message_text"/&gt;
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                  古い形式の XML 形式で記録されたメッセージイベントには、この形式による表現上の制約のため、キーと値のマップは含まれません。
                </p></div></li></ul></div><p>
            <code class="literal">audit_api_message_emit_udf()</code> によってポストされるメッセージには、<code class="literal">MYSQL_AUDIT_MESSAGE_CLASS</code> のイベントクラスと <code class="literal">MYSQL_AUDIT_MESSAGE_USER</code> のサブクラスがあります。 (相互に生成された監査メッセージは、同じクラスと <code class="literal">MYSQL_AUDIT_MESSAGE_INTERNAL</code> のサブクラスを持ちます。このサブクラスは現在使用されていません。) <code class="literal">audit_log</code> フィルタリングルールでこのようなイベントを参照するには、<code class="literal">name</code> 値が <code class="literal">message</code> の <code class="literal">class</code> 要素を使用します。 例: 
          </p><pre class="programlisting">{
  "filter": {
    "class": {
      "name": "message"
    }
  }
}
</pre><p>
            ユーザー生成メッセージイベントと内部生成メッセージイベントを区別する必要がある場合は、<code class="literal">user</code> または <code class="literal">internal</code> に対して <code class="literal">subclass</code> 値をテストします。
          </p><p>
            キーと値のマップの内容に基づくフィルタリングはサポートされていません。
          </p><p>
            フィルタリングルールの作成の詳細は、<a class="xref" href="security.html#audit-log-filtering" title="6.4.5.7 監査ログのフィルタリング">セクション6.4.5.7「監査ログのフィルタリング」</a> を参照してください。
          </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="firewall"></a>6.4.7 MySQL Enterprise Firewall</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#firewall-elements">6.4.7.1 MySQL Enterprise Firewall の要素</a></span></dt><dt><span class="section"><a href="security.html#firewall-installation">6.4.7.2 MySQL Enterprise Firewall のインストールまたはアンインストール</a></span></dt><dt><span class="section"><a href="security.html#firewall-usage">6.4.7.3 MySQL Enterprise Firewall の使用</a></span></dt><dt><span class="section"><a href="security.html#firewall-reference">6.4.7.4 MySQL Enterprise Firewall リファレンス</a></span></dt></dl></div><a class="indexterm" name="idm46723749714288"></a><a class="indexterm" name="idm46723749713200"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        MySQL Enterprise Firewall は、商用製品である MySQL Enterprise Edition に含まれる拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
      </p></div><p>
      MySQL Enterprise Edition には、アプリケーションレベルのファイアウォールである MySQL Enterprise Firewall が含まれています。これにより、データベース管理者は、受け入れられたステートメントパターンのリストに対する照合に基づいて SQL ステートメントの実行を許可または拒否できます。 これにより、SQL インジェクションなどの攻撃や、正当なクエリーワークロード特性の外部でアプリケーションを使用することで、アプリケーションを利用しようとする攻撃に対して MySQL Server を強化できます。 
    </p><p>
      ファイアウォールに登録された各 MySQL アカウントには独自のステートメント allowlist があり、アカウントごとに保護を調整できます。 特定のアカウントについて、ファイアウォールは記録、保護または検出モードで動作し、受け入れられるステートメントパターンでのトレーニング、受け入れられないステートメントに対するアクティブな保護、または受入れ不可能なステートメントの受動的な検出を行うことができます。 この図は、ファイアウォールが各モードで受信ステートメントを処理する方法を示しています。 
    </p><div class="figure"><a name="firewall-diagram"></a><p class="title"><b>図 6.1 MySQL Enterprise Firewall 操作</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/firewall-diagram-1.png" width="682" height="481" alt="記録、保護および検出モードでの MySQL Enterprise Firewall による受信 SQL ステートメントの処理方法を示すフローチャート。"></div></div></div><br class="figure-break"><p>
      次の各セクションでは、MySQL Enterprise Firewall の要素について説明し、それをインストールおよび使用する方法を説明し、その要素のリファレンス情報を提供します。
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="firewall-elements"></a>6.4.7.1 MySQL Enterprise Firewall の要素</h4></div></div></div><p>
        MySQL Enterprise Firewall は、次の要素を含むプラグインライブラリに基づいています:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">MYSQL_FIREWALL</code> という名前のサーバー側プラグインは、実行前に SQL ステートメントを調べ、登録されたファイアウォールプロファイルに基づいて、各ステートメントを実行するか拒否するかを決定します。
          </p></li><li class="listitem"><p>
            <code class="literal">MYSQL_FIREWALL</code> プラグインは、<code class="literal">MYSQL_FIREWALL_USERS</code> および <code class="literal">MYSQL_FIREWALL_WHITELIST</code> という名前のサーバー側プラグインとともに、登録済プロファイルへのビューを提供するパフォーマンススキーマおよび <code class="literal">INFORMATION_SCHEMA</code> テーブルを実装します。
          </p></li><li class="listitem"><p>
            プロファイルは、パフォーマンスを向上させるためにメモリーにキャッシュされます。 <code class="literal">mysql</code> システムデータベースのテーブルは、サーバーの再起動後もプロファイルの永続性を維持するために、ファイアウォールデータのバッキング記憶域を提供します。 
          </p></li><li class="listitem"><p>
            ストアドプロシージャは、ファイアウォールプロファイルの登録、操作モードの確立、キャッシュと永続記憶域間のファイアウォールデータの転送の管理などのタスクを実行します。
          </p></li><li class="listitem"><p>
            ユーザー定義関数は、キャッシュと永続記憶域の同期化などの下位レベルのタスク用の API を提供します。
          </p></li><li class="listitem"><p>
            システム変数はファイアウォール構成を可能にし、ステータス変数はランタイム操作情報を提供します。
          </p></li><li class="listitem"><p>
            <code class="literal">FIREWALL_ADMIN</code> および <code class="literal">FIREWALL_USER</code> 権限を使用すると、ユーザーはそれぞれ任意のユーザーのファイアウォールルールおよび独自のファイアウォールルールを管理できます。
          </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="firewall-installation"></a>6.4.7.2 MySQL Enterprise Firewall のインストールまたはアンインストール</h4></div></div></div><a class="indexterm" name="idm46723749679488"></a><a class="indexterm" name="idm46723749677344"></a><p>
        MySQL Enterprise Firewall のインストールは、<a class="xref" href="security.html#firewall-elements" title="6.4.7.1 MySQL Enterprise Firewall の要素">セクション6.4.7.1「MySQL Enterprise Firewall の要素」</a> で説明されている要素をインストールするワンタイム操作です。 インストールはグラフィカルインタフェースを使用して実行することも、手動で実行することもできます: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Windows では、MySQL Installer に MySQL Enterprise Firewall を有効にするオプションが含まれています。
          </p></li><li class="listitem"><p>
            MySQL Workbench 6.3.4 以上では、MySQL Enterprise Firewall のインストール、インストールされたファイアウォールの有効化または無効化、ファイアウォールのアンインストールを行うことができます。
          </p></li><li class="listitem"><p>
            MySQL Enterprise Firewall の手動インストールでは、MySQL インストールの <code class="filename">share</code> ディレクトリにあるスクリプトを実行します。
          </p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          指示に従う前に、このセクション全体をお読みください。 手順の一部は、環境によって異なります。 
        </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          インストールされている場合、MySQL Enterprise Firewall は、無効化されていても最小限のオーバーヘッドを伴います。 このオーバーヘッドを回避するには、ファイアウォールを使用する予定がないかぎり、ファイアウォールをインストールしないでください。 
        </p></div><p>
        使用手順については、<a class="xref" href="security.html#firewall-usage" title="6.4.7.3 MySQL Enterprise Firewall の使用">セクション6.4.7.3「MySQL Enterprise Firewall の使用」</a> を参照してください。 参照情報については、<a class="xref" href="security.html#firewall-reference" title="6.4.7.4 MySQL Enterprise Firewall リファレンス">セクション6.4.7.4「MySQL Enterprise Firewall リファレンス」</a> を参照してください。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#firewall-install" title="MySQL Enterprise Firewall のインストール">MySQL Enterprise Firewall のインストール</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-uninstall" title="MySQL Enterprise Firewall のアンインストール">MySQL Enterprise Firewall のアンインストール</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-install"></a>MySQL Enterprise Firewall のインストール</h5></div></div></div><p>
          MySQL Enterprise Firewall が古いバージョンの MySQL からすでにインストールされている場合は、このセクションで後述する手順を使用してアンインストールし、現在のバージョンをインストールする前にサーバーを再起動します。 この場合は、構成を再度登録する必要もあります。 
        </p><p>
          Windows では、<a class="xref" href="security.html#firewall-installation-windows-installer" title="図 6.2 Windows での MySQL Enterprise Firewall のインストール">図6.2「Windows での MySQL Enterprise Firewall のインストール」</a> に示すように、MySQL Installer を使用して MySQL Enterprise Firewall をインストールできます。 <span class="guilabel">「MySQL Enterprise Firewall の有効化」</span>チェックボックスを選択します。 (<span class="guilabel">「ネットワークアクセス用の Open Firewall ポート」</span>には異なる目的があります。 Windows ファイアウォールを参照し、MySQL サーバーがクライアント接続をリスニングする TCP/IP ポートを Windows でブロックするかどうかを制御します。) 
        </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
            MySQL Installer を使用してインストールされた MySQL 8.0.19 には、サーバーの構成ステップ中に MySQL Enterprise Firewall が選択された場合にサーバーを起動できない問題があります。 サーバーの起動操作が失敗した場合は、<span class="guibutton">取消</span>をクリックして構成プロセスを終了し、ダッシュボードに戻ります。 サーバーをアンインストールする必要があります。 
          </p><p>
            回避策は、MySQL Enterprise Firewall を選択せずに MySQL Installer を実行することです。 (つまり、<span class="guilabel">「MySQL Enterprise Firewall の有効化」</span>チェックボックスを選択しないでください。) その後、このセクションの後半にある手動インストールの手順を使用して、MySQL Enterprise Firewall をインストールします。 この問題は、MySQL 8.0.20 で修正されています。 
          </p></div><div class="figure"><a name="firewall-installation-windows-installer"></a><p class="title"><b>図 6.2 Windows での MySQL Enterprise Firewall のインストール</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/firewall-8-windows-installer-option.png" width="789" height="598" alt="内容は周囲のテキストで説明されています。"></div></div></div><br class="figure-break"><p>
          MySQL Workbench 6.3.4 以上を使用して MySQL Enterprise Firewall をインストールするには、<a class="ulink" href="https://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a> を参照してください。
        </p><p>
          MySQL Enterprise Firewall を手動でインストールするには、MySQL インストールの <code class="filename">share</code> ディレクトリを検索し、ご使用のプラットフォームに適したスクリプトを選択します。 使用可能なスクリプトは、プラグインライブラリファイルの参照に使用される接尾辞とは異なります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">win_install_firewall.sql</code>: ファイル名の接尾辞として <code class="filename">.dll</code> を使用する Windows システムの場合は、このスクリプトを選択します。
            </p></li><li class="listitem"><p>
              <code class="filename">linux_install_firewall.sql</code>: Linux および <code class="filename">.so</code> をファイル名接尾辞として使用する類似システムの場合は、このスクリプトを選択します。
            </p></li></ul></div><p>
          インストールスクリプトはデフォルトデータベースにストアドプロシージャを作成するため、使用するデータベースを選択します。 次に、コマンドラインで選択したデータベースに名前を付けて、次のようにスクリプトを実行します。 この例では、<code class="literal">mysql</code> システムデータベースおよび Linux インストールスクリプトを使用します。 システムに適切な置換を行います。 
        </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql -u root -p mysql &lt; linux_install_firewall.sql</code></strong>
Enter password: <em class="replaceable"><code>(enter root password here)</code></em>
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            ソース/レプリカレプリケーション、グループレプリケーションまたは InnoDB クラスタ のコンテキストで MySQL Enterprise Firewall を使用するには、ソースノードでインストールスクリプトを実行する前にレプリカノードを準備する必要があります。 これが必要なのは、スクリプト内の <code class="literal">INSTALL PLUGIN</code> ステートメントがレプリケートされないためです。 
          </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                各レプリカノードで、インストールスクリプトから <code class="literal">INSTALL PLUGIN</code> ステートメントを抽出し、手動で実行します。
              </p></li><li class="listitem"><p>
                ソースノードで、前述のようにインストールスクリプトを実行します。
              </p></li></ol></div></div><p>
          グラフィカルインタフェースを使用して MySQL Enterprise Firewall をインストールするか、手動でファイアウォールを有効にする必要があります。 これを確認するには、サーバーに接続して次のステートメントを実行します: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GLOBAL VARIABLES LIKE 'mysql_firewall_mode';</code></strong>
+---------------------+-------+
| Variable_name       | Value |
+---------------------+-------+
| mysql_firewall_mode | ON    |
+---------------------+-------+
</pre><p>
          プラグインの初期化に失敗した場合は、サーバーエラーログで診断メッセージを確認してください。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-uninstall"></a>MySQL Enterprise Firewall のアンインストール</h5></div></div></div><p>
          MySQL Enterprise Firewall は、MySQL Workbench を使用して、または手動でアンインストールできます。
        </p><p>
          MySQL Workbench 6.3.4 以上を使用して MySQL Enterprise Firewall をアンインストールするには、<a class="xref" href="workbench.html" title="第 31 章 MySQL Workbench">第31章「<i>MySQL Workbench</i>」</a> の <a class="ulink" href="https://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a> を参照してください。
        </p><p>
          MySQL Enterprise Firewall を手動でアンインストールするには、次のステートメントを実行します。 ステートメントは、以前にインストールされたファイアウォールバージョンによっては、一部のオブジェクトが存在しないか、それらをインストールしたプラグインをアンインストールすることによって暗黙的に削除される可能性があるため、<code class="literal">IF EXISTS</code> を使用します。 
        </p><pre class="programlisting">DROP TABLE IF EXISTS mysql.firewall_group_allowlist;
DROP TABLE IF EXISTS mysql.firewall_groups;
DROP TABLE IF EXISTS mysql.firewall_membership;
DROP TABLE IF EXISTS mysql.firewall_users;
DROP TABLE IF EXISTS mysql.firewall_whitelist;

UNINSTALL PLUGIN MYSQL_FIREWALL;
UNINSTALL PLUGIN MYSQL_FIREWALL_USERS;
UNINSTALL PLUGIN MYSQL_FIREWALL_WHITELIST;

DROP FUNCTION IF EXISTS firewall_group_delist;
DROP FUNCTION IF EXISTS firewall_group_enlist;
DROP FUNCTION IF EXISTS mysql_firewall_flush_status;
DROP FUNCTION IF EXISTS normalize_statement;
DROP FUNCTION IF EXISTS read_firewall_group_allowlist;
DROP FUNCTION IF EXISTS read_firewall_groups;
DROP FUNCTION IF EXISTS read_firewall_users;
DROP FUNCTION IF EXISTS read_firewall_whitelist;
DROP FUNCTION IF EXISTS set_firewall_group_mode;
DROP FUNCTION IF EXISTS set_firewall_mode;

DROP PROCEDURE IF EXISTS mysql.sp_firewall_group_delist;
DROP PROCEDURE IF EXISTS mysql.sp_firewall_group_enlist;
DROP PROCEDURE IF EXISTS mysql.sp_reload_firewall_group_rules;
DROP PROCEDURE IF EXISTS mysql.sp_reload_firewall_rules;
DROP PROCEDURE IF EXISTS mysql.sp_set_firewall_group_mode;
DROP PROCEDURE IF EXISTS mysql.sp_set_firewall_group_mode_and_user;
DROP PROCEDURE IF EXISTS mysql.sp_set_firewall_mode;
</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="firewall-usage"></a>6.4.7.3 MySQL Enterprise Firewall の使用</h4></div></div></div><a class="indexterm" name="idm46723749612592"></a><p>
        MySQL Enterprise Firewall を使用する前に、<a class="xref" href="security.html#firewall-installation" title="6.4.7.2 MySQL Enterprise Firewall のインストールまたはアンインストール">セクション6.4.7.2「MySQL Enterprise Firewall のインストールまたはアンインストール」</a> に記載されている手順に従ってインストールします。
      </p><p>
        このセクションでは、SQL ステートメントを使用して MySQL Enterprise Firewall を構成する方法について説明します。 または、MySQL Workbench 6.3.4 以上では、ファイアウォール制御用のグラフィカルインタフェースが提供されます。 <a class="ulink" href="https://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a>を参照してください。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#firewall-enabling-disabling" title="ファイアウォールの有効化または無効化">ファイアウォールの有効化または無効化</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-privileges" title="ファイアウォール権限の割当て">ファイアウォール権限の割当て</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-concepts" title="ファイアウォール操作の概念">ファイアウォール操作の概念</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-accounts" title="ファイアウォールアカウントプロファイルの登録">ファイアウォールアカウントプロファイルの登録</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-groups" title="ファイアウォールグループプロファイルの登録">ファイアウォールグループプロファイルの登録</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-multiple-profiles" title="複数の適用可能なプロファイルに対するファイアウォール操作">複数の適用可能なプロファイルに対するファイアウォール操作</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-monitoring" title="ファイアウォールの監視">ファイアウォールの監視</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-enabling-disabling"></a>ファイアウォールの有効化または無効化</h5></div></div></div><p>
          ファイアウォールを有効または無効にするには、<code class="literal">mysql_firewall_mode</code> システム変数を設定します。 デフォルトでは、この変数はファイアウォールのインストール時に有効になります。 ファイアウォールの初期状態を明示的に制御するには、サーバーの起動時に変数を設定します。 たとえば、オプションファイルでファイアウォールを有効にするには、次の行を使用します: 
        </p><pre class="programlisting">[mysqld]
mysql_firewall_mode=ON
</pre><p>
          <code class="filename">my.cnf</code> を変更したら、新しい設定を有効にするためにサーバーを再起動します。
        </p><p>
          または、実行時にファイアウォール設定を設定して永続化するには:
        </p><pre class="programlisting">SET PERSIST mysql_firewall_mode = OFF;
SET PERSIST mysql_firewall_mode = ON;
</pre><p>
          <code class="literal">SET PERSIST</code> は、実行中の MySQL インスタンスの値を設定します。 また、値が保存され、その後のサーバーの再起動に引き継がれます。 後続の再起動に引き継ぐことなく、実行中の MySQL インスタンスの値を変更するには、<code class="literal">PERSIST</code> ではなく <code class="literal">GLOBAL</code> キーワードを使用します。 <a class="xref" href="sql-statements.html#set-variable" title="13.7.6.1 変数代入の SET 構文">セクション13.7.6.1「変数代入の SET 構文」</a>を参照してください。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-privileges"></a>ファイアウォール権限の割当て</h5></div></div></div><p>
          ファイアウォールがインストールされている状態で、それを管理する予定の MySQL アカウントに適切な権限を付与します。 権限は、アカウントが実行を許可するファイアウォール操作によって異なります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              完全な管理ファイアウォールアクセスを必要とする任意のアカウントに <code class="literal">FIREWALL_ADMIN</code> 権限を付与します。 (一部のユーザー定義プロシージャは、個々の UDF の説明に示されているように、<code class="literal">FIREWALL_ADMIN</code> または非推奨の <code class="literal">SUPER</code> 権限を持つアカウントによって起動できます。) 
            </p></li><li class="listitem"><p>
              独自のファイアウォールルールに対してのみ管理アクセス権を持つアカウントに <code class="literal">FIREWALL_USER</code> 権限を付与します。
            </p></li><li class="listitem"><p>
              <code class="literal">mysql</code> システムデータベースのファイアウォールストアドプロシージャに対する <code class="literal">EXECUTE</code> 権限を付与します。 これらは UDF を呼び出す可能性があるため、ストアドプロシージャアクセスには、これらの UDF に必要な前述の権限も必要です。 
            </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            <code class="literal">FIREWALL_ADMIN</code> および <code class="literal">FIREWALL_USER</code> 権限は、ファイアウォールコンポーネントで定義されているため、ファイアウォールのインストール中にのみ付与できます。
          </p></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-concepts"></a>ファイアウォール操作の概念</h5></div></div></div><p>
          MySQL サーバーを使用すると、クライアントはそれらの SQL ステートメントとの間で接続および受信を実行できます。 サーバーは、構文エラーですぐには失敗しない各受信ステートメントをファイアウォールに渡します。 ファイアウォールがステートメントを受け入れるかどうかに基づいて、サーバーはステートメントを実行するか、クライアントにエラーを返します。 
        </p><p>
          ファイアウォール操作は、ステートメントの実行保護を適用できるプロファイルのレジストリに基づいています。 プロファイルには次の属性があります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              プロファイルで受け入れ可能なステートメントを定義するルール。 このルールセットは、プロファイル allowlist を形成します。 
            </p></li><li class="listitem"><p>
              現在の操作モード。 このモードでは、プロファイルを様々な方法で使用できます。 次に例を示します: プロファイルをトレーニングモードにすると、許可リストを確立できます。許可リストは、ステートメントの実行または侵入の検出を制限するために使用できます。プロファイルは完全に無効にできます。 
            </p></li><li class="listitem"><p>
              プロファイルが適用されるクライアント接続を示す適用範囲。
            </p><p>
              ファイアウォールは、各プロファイルが特定のクライアントアカウント (クライアントユーザー名とホスト名の組み合わせ) に一致するように、アカウントベースのプロファイルをサポートしています。 たとえば、許可リストが <code class="literal">admin@localhost</code> からの接続に適用されるアカウントプロファイルと、許可リストが <code class="literal">myapp@apphost.example.com</code> からの接続に適用される別のアカウントプロファイルを登録できます。 
            </p><p>
              MySQL 8.0.23 では、ファイアウォールは複数のアカウントをメンバーとして持つことができるグループプロファイルもサポートしています。 グループプロファイルを使用すると、管理が容易になり、特定の一連の許可リストルールを複数のアカウントに適用する必要があるデプロイメントの柔軟性が向上します: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  アカウントプロファイルを使用して、アカウントごとに 1 つのプロファイルを登録し、各プロファイル間で許可リストを複製する必要があります。
                </p></li><li class="listitem"><p>
                  より簡単な方法として、すべてのアカウントをメンバーとして持つグループプロファイルを使用できます。 グループプロファイル allowlist はすべてのメンバーアカウントに適用され、アカウントごとに複製する必要はありません。 
                </p></li></ul></div></li></ul></div><p>
          クライアント接続ごとに、ファイアウォールはどのプロファイルを適用するかを決定し、プロファイルで許可されているステートメントのみを受け入れます。 (クライアントがプロファイルに一致しない場合、ファイアウォールはそれを無視し、すべてのステートメントを受け入れます。) 
        </p><p>
          デフォルトでは、ファイアウォールはすべてのステートメントを受け入れ、MySQL アカウントが実行できるステートメントには影響しません。 ファイアウォール保護機能を適用するには、明示的なアクションを実行する必要があります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              ファイアウォールに 1 つ以上のプロファイルを登録します。 (これは、ファイアウォールがプロファイルに一致しないクライアントを無視するために必要です。) 
            </p></li><li class="listitem"><p>
              ファイアウォールをトレーニングして、各プロファイルの許可リスト (つまり、プロファイルがクライアントに実行を許可するステートメントのタイプ) を確立します。
            </p></li><li class="listitem"><p>
              トレーニングされた各プロファイルを使用して MySQL を保護するようにファイアウォールに指示します。つまり、クライアントの接続時に受信ステートメントを適切な許可リストと照合します。
            </p></li></ul></div><p>
          ファイアウォールによって実行されるステートメント照合では、クライアントから受信した SQL ステートメントは使用されません。 かわりに、サーバーは受信ステートメントを正規化されたダイジェスト形式に変換し、ファイアウォール操作はこれらのダイジェストを使用します。 ステートメントの正規化の利点は、単一のパターンを使用して同様のステートメントをグループ化および認識できることです。 たとえば、次のステートメントは互いに異なります: 
        </p><pre class="programlisting">SELECT first_name, last_name FROM customer WHERE customer_id = 1;
select first_name, last_name from customer where customer_id = 99;
SELECT first_name, last_name FROM customer WHERE customer_id = 143;
</pre><p>
          ただし、これらはすべて同じ正規化ダイジェストフォームを持ちます:
        </p><pre class="programlisting">SELECT `first_name` , `last_name` FROM `customer` WHERE `customer_id` = ?
</pre><p>
          正規化を使用することで、ファイアウォールは、クライアントから受信した様々なステートメントにそれぞれ一致する許可ダイジェストに格納できます。 正規化およびダイジェストの詳細は、<a class="xref" href="performance-schema.html#performance-schema-statement-digests" title="27.10 パフォーマンススキーマのステートメントダイジェストとサンプリング">セクション27.10「パフォーマンススキーマのステートメントダイジェストとサンプリング」</a> を参照してください。 
        </p><p>
          ファイアウォールに登録された各プロファイルには、次の値から選択された独自の操作モードがあります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">OFF</code>: このモードでは、プロファイルが無効になります。 ファイアウォールは非アクティブとみなし、無視します。 
            </p></li><li class="listitem"><p>
              <code class="literal">RECORDING</code>: これはファイアウォールトレーニングモードです。 プロファイルと一致するクライアントから受信した受信ステートメントは、プロファイルで受け入れ可能とみなされ、その<span class="quote">「<span class="quote">「指紋」</span>」</span>の一部になります。 ファイアウォールは、各ステートメントの正規化されたダイジェスト形式を記録して、プロファイルの受け入れ可能なステートメントパターンを学習します。 各パターンはルールであり、ルールの和集合はプロファイル allowlist です。 
            </p><p>
              アカウントプロファイルとグループプロファイルの違いは、グループプロファイルのステートメントの記録を単一のグループメンバーから受け取ったステートメントに制限できることです。
            </p></li><li class="listitem"><p>
              <code class="literal">PROTECTING</code>: このモードでは、プロファイルによってステートメントの実行が許可または防止されます。 ファイアウォールは、受信ステートメントをプロファイル allowlist と照合し、一致しないステートメントのみを受け入れて拒否します。 <code class="literal">RECORDING</code> モードでプロファイルをトレーニングした後、<code class="literal">PROTECTING</code> モードに切り替えて、許可リストから逸脱するステートメントによるアクセスに対して MySQL を強化します。 
            </p></li><li class="listitem"><p>
              <code class="literal">DETECTING</code>: このモードでは、侵入 (プロファイル allowlist 内で何にも一致しないため疑わしいステートメント) は検出されますが、ブロックされません。 <code class="literal">DETECTING</code> モードでは、ファイアウォールは疑わしいステートメントをエラーログに書き込みますが、アクセスを拒否せずに受け入れます。 
            </p></li></ul></div><p>
          プロファイルに前述のモード値のいずれかが割り当てられると、ファイアウォールはそのモードをプロファイルに格納します。 ファイアウォールモード設定操作では <code class="literal">RESET</code> のモード値も許可されますが、この値は格納されません: プロファイルを <code class="literal">RESET</code> モードに設定すると、ファイアウォールはプロファイルのすべてのルールを削除し、そのモードを <code class="literal">OFF</code> に設定します。 
        </p><p>
          次のセクションでは、ファイアウォールプロファイルの使用方法について説明します。 簡単にするために、この説明では単一のアカウントプロファイルと単一のグループプロファイルの設定について説明し、複数のプロファイルが同時に適用された場合にファイアウォールがどのように動作するかについて、より複雑なケースに移動します。 
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-accounts"></a>ファイアウォールアカウントプロファイルの登録</h5></div></div></div><p>
          MySQL Enterprise Firewall では、個々のアカウントに対応するプロファイルを登録できます。
        </p><p>
          MySQL は、特定のユーザー名とホスト名の組合せに対して各クライアントセッションを認証します。 この組合せは<span class="emphasis"><em>セッションアカウント</em></span>です。 ファイアウォールは、セッションアカウントを登録済アカウントプロファイルと照合して、セッションからの受信ステートメントの処理に適用されるプロファイルを決定します: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              ファイアウォールは非アクティブなプロファイル (<code class="literal">OFF</code> モードのプロファイル) を無視します。
            </p></li><li class="listitem"><p>
              セッションアカウントは、同じユーザーとホストを持つアクティブなアカウントプロファイルと一致します (存在する場合)。 そのようなアカウントプロファイルは最大 1 つあります。 
            </p></li></ul></div><p>
          つまり、特定のセッションには最大 1 つのアクティブなアカウントプロファイルを適用でき、ファイアウォールは各受信ステートメントを次のように処理します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              適用可能なプロファイルがない場合、制限はありません。 ファイアウォールはステートメントを受け入れます。 
            </p></li><li class="listitem"><p>
              適用可能なプロファイルがある場合、そのモードによってステートメントの処理が決定されます:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">RECORDING</code> モードでは、ファイアウォールはプロファイル allowlist ルールにステートメントを追加し、それを受け入れます。
                </p></li><li class="listitem"><p>
                  <code class="literal">PROTECTING</code> モードでは、ファイアウォールはステートメントをプロファイル allowlist のルールと比較します。 ファイアウォールは、一致がある場合はステートメントを受け入れ、それ以外の場合は拒否します。 <code class="literal">mysql_firewall_trace</code> システム変数が有効になっている場合、ファイアウォールは拒否されたステートメントもエラーログに書き込みます。 
                </p></li><li class="listitem"><p>
                  <code class="literal">DETECTING</code> モードでは、ファイアウォールはアクセスを拒否せずに侵入を検出します。 ファイアウォールはステートメントを受け入れますが、<code class="literal">PROTECTING</code> モードと同様にプロファイル allowlist にも一致します。 ステートメントが疑わしい (不一致) 場合、ファイアウォールはそれをエラーログに書き込みます。 
                </p></li></ul></div></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            この説明は、セッションアカウントが 1 つ以上の適用可能なアカウントプロファイルと一致することを前提としているため、簡略化されています。 複数プロファイルの場合については、<a class="xref" href="security.html#firewall-multiple-profiles" title="複数の適用可能なプロファイルに対するファイアウォール操作">複数の適用可能なプロファイルに対するファイアウォール操作</a> を参照してください。 
          </p></div><p>
          ファイアウォールアカウントプロファイルを使用して、特定のアカウントからの受信ステートメントから MySQL を保護するには、次のステップに従います:
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              アカウントプロファイルを登録し、<code class="literal">RECORDING</code> モードにします。
            </p></li><li class="listitem"><p>
              アカウントを使用して MySQL サーバーに接続し、学習するステートメントを実行します。 これにより、対応するアカウントプロファイルがトレーニングされ、プロファイル allowlist を形成するルールが設定されます。 
            </p></li><li class="listitem"><p>
              アカウントプロファイルを <code class="literal">PROTECTING</code> モードに切り替えます。 クライアントがアカウントを使用してサーバーに接続すると、アカウントプロファイル allowlist によってステートメントの実行が制限されます。 
            </p></li><li class="listitem"><p>
              追加のトレーニングが必要な場合は、アカウントプロファイルを再度 <code class="literal">RECORDING</code> モードに切り替え、新しいステートメントパターンで許可リストを更新してから、<code class="literal">PROTECTING</code> モードに戻します。
            </p></li></ol></div><p>
          プロファイルを維持することで、ファイアウォールは次のような保護戦略の実装を可能にします:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              アプリケーションに一意の保護要件がある場合は、他の目的に使用されていないアカウントを使用するように構成し、対応するアカウントプロファイルを設定します。
            </p></li><li class="listitem"><p>
              関連アプリケーションで保護要件を共有する場合は、すべて同じアカウント (および同じアカウントプロファイル) を使用するように構成します。
            </p><p>
              または、各アプリケーションを独自のアカウントに関連付けてから、これらのアカウントを同じグループプロファイルに追加します。 <a class="xref" href="security.html#firewall-groups" title="ファイアウォールグループプロファイルの登録">ファイアウォールグループプロファイルの登録</a>を参照してください。 
            </p></li></ul></div><p>
          ファイアウォール関連のアカウント参照については、次のガイドラインに従います:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              アカウント参照が発生するコンテキストに注意してください。 ファイアウォール操作のアカウントに名前を付けるには、一重引用符で囲まれた文字列 (<code class="literal">'<em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em>'</code>) として指定します。 これは、アカウント名のユーザー部分とホスト部分を別々に引用符で囲む <code class="literal">CREATE USER</code> や <code class="literal">GRANT</code> などのステートメントの通常の MySQL 規則とは異なります (<code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>)。 
            </p><p>
              ファイアウォール操作のために一重引用符で囲まれた文字列としてアカウントに名前を付ける要件は、ユーザー名に<code class="literal">@</code>文字が埋め込まれているアカウントを使用できないことを意味します。
            </p></li><li class="listitem"><p>
              ファイアウォールは、サーバーによって認証された実際のユーザー名とホスト名で表されるアカウントに対してステートメントを評価します。 アカウントプロファイルを登録する場合は、ワイルドカード文字またはネットマスクを使用しないでください: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">me@%.example.org</code> という名前のアカウントが存在し、クライアントがそれを使用してホスト <code class="literal">abc.example.org</code> からサーバーに接続するとします。
                </p></li><li class="listitem"><p>
                  アカウント名には <code class="literal">%</code> ワイルドカード文字が含まれていますが、サーバーは、ユーザー名が <code class="literal">me</code> でホスト名が <code class="literal">abc.example.com</code> であること、つまりファイアウォールに表示されることとしてクライアントを認証します。
                </p></li><li class="listitem"><p>
                  したがって、ファイアウォール操作に使用するアカウント名は、<code class="literal">me@%.example.org</code> ではなく <code class="literal">me@abc.example.org</code> です。
                </p></li></ul></div></li></ul></div><p>
          次の例では、アカウントプロファイルをファイアウォールに登録し、そのプロファイルの受入れ可能なステートメントをファイアウォールに指示し、そのプロファイルを使用して、アカウントによる受入れ不可能なステートメントの実行から MySQL を保護する方法を示します。 サンプルアカウント <code class="literal">fwuser@localhost</code> は、<code class="literal">sakila</code> データベース (<a class="ulink" href="https://dev.mysql.com/doc/index-other.html" target="_top">https://dev.mysql.com/doc/index-other.html</a> で入手可能) のテーブルにアクセスするアプリケーションで使用することを前提としています。 
        </p><p>
          ファイアウォールに登録されたアカウントプロファイルに対応する <code class="literal">fwuser@localhost</code> アカウントで実行するように指定されたステップを除き、管理 MySQL アカウントを使用してこの手順のステップを実行します。 このアカウントを使用して実行されるステートメントの場合、デフォルトのデータベースは <code class="literal">sakila</code> である必要があります。 (指示を適宜調整することで、別のデータベースを使用できます。) 
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              必要に応じて、ステートメントの実行に使用するアカウントを作成し (適切なパスワードを選択)、<code class="literal">sakila</code> データベースに対する権限を付与します:
            </p><pre class="programlisting">CREATE USER 'fwuser'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL ON sakila.* TO 'fwuser'@'localhost';
</pre></li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_mode()</code> ストアドプロシージャを使用して、アカウントプロファイルをファイアウォールに登録し、プロファイルを <code class="literal">RECORDING</code> (トレーニング) モードにします:
            </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'RECORDING');
</pre><p>
              ストアドプロシージャは、実行時にファイアウォールのユーザー定義関数を起動し、独自の出力を生成できます。
            </p></li><li class="listitem"><p>
              登録済アカウントプロファイルをトレーニングするには、ファイアウォールに <code class="literal">fwuser@localhost</code> のセッションアカウントが表示されるように、サーバーホストから <code class="literal">fwuser</code> としてサーバーに接続します。 次に、アカウントを使用して、プロファイルに対して正当とみなされるいくつかのステートメントを実行します。 例: 
            </p><pre class="programlisting">SELECT first_name, last_name FROM customer WHERE customer_id = 1;
UPDATE rental SET return_date = NOW() WHERE rental_id = 1;
SELECT get_customer_balance(1, NOW());
</pre><p>
              プロファイルは <code class="literal">RECORDING</code> モードであるため、ファイアウォールは正規化されたダイジェスト形式のステートメントをルールとしてプロファイル allowlist に記録します。
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                <code class="literal">fwuser@localhost</code> アカウントプロファイルが <code class="literal">RECORDING</code> モードでステートメントを受信するまで、その allowlist は空であり、これは<span class="quote">「<span class="quote">「すべて拒否」</span>」</span>と同等です。 空の allowlist に一致するステートメントはないため、次のような影響があります: 
              </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    アカウントプロファイルを <code class="literal">PROTECTING</code> モードに切り替えることはできません。 すべてのステートメントが拒否され、アカウントによるステートメントの実行が事実上禁止されます。 
                  </p></li><li class="listitem"><p>
                    アカウントプロファイルは <code class="literal">DETECTING</code> モードに切り替えることができます。 この場合、プロファイルはすべてのステートメントを受け入れますが、疑わしいステートメントとして記録します。 
                  </p></li></ul></div></div></li><li class="listitem"><p>
              この時点で、アカウントプロファイル情報がキャッシュされます。 この情報を表示するには、ファイアウォール <code class="literal">INFORMATION_SCHEMA</code> テーブルをクエリーします: 
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT MODE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code></strong>
       <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong>
+-----------+
| MODE      |
+-----------+
| RECORDING |
+-----------+
mysql&gt; <strong class="userinput"><code>SELECT RULE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code></strong>
       <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong>
+----------------------------------------------------------------------------+
| RULE                                                                       |
+----------------------------------------------------------------------------+
| SELECT `first_name` , `last_name` FROM `customer` WHERE `customer_id` = ?  |
| SELECT `get_customer_balance` ( ? , NOW ( ) )                              |
| UPDATE `rental` SET `return_date` = NOW ( ) WHERE `rental_id` = ?          |
| SELECT @@`version_comment` LIMIT ?                                         |
+----------------------------------------------------------------------------+
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                <code class="literal">@@version_comment</code> ルールは、アカウントプロファイルに対応するアカウントを使用してサーバーに接続したときに、<span class="command"><strong>mysql</strong></span> クライアントによって自動的に送信されるステートメントから取得されます。
              </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
                アプリケーションの使用に一致する条件でファイアウォールをトレーニングします。 たとえば、サーバーの特性と機能を判断するために、特定の MySQL コネクタが各セッションの開始時にサーバーにステートメントを送信する場合があります。 アプリケーションが通常そのコネクタを介して使用される場合は、コネクタを使用してファイアウォールもトレーニングします。 これにより、これらの初期ステートメントを、アプリケーションに関連付けられたアカウントプロファイルの許可リストの一部にすることができます。 
              </p></div></li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_mode()</code> を再度起動します。今回は、アカウントプロファイルを <code class="literal">PROTECTING</code> モードに切り替えます:
            </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'PROTECTING');
</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
                アカウントプロファイルを <code class="literal">RECORDING</code> モードから切り替えると、キャッシュされたデータが、基礎となる永続的な記憶域を提供する <code class="literal">mysql</code> システムデータベーステーブルと同期されます。 記録されているプロファイルのモードを切り替えない場合、キャッシュされたデータは永続ストレージに書き込まれず、サーバーの再起動時に失われます。 
              </p></div></li><li class="listitem"><p>
              アカウントを使用して、許容できるステートメントと許容できないステートメントを実行し、アカウントプロファイルをテストします。 ファイアウォールは、各ステートメントをプロファイル allowlist と照合し、それを受け入れるか拒否します: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  このステートメントはトレーニングステートメントと同じではありませんが、いずれかのステートメントと同じ正規化ステートメントを生成するため、ファイアウォールはそれを受け入れます:
                </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = '48';</code></strong>
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| ANN        | EVANS     |
+------------+-----------+
</pre></li><li class="listitem"><p>
                  これらのステートメントは allowlist 内の何も一致しないため、ファイアウォールはそれぞれエラーで拒否します:
                </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = 1 OR TRUE;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>TRUNCATE TABLE mysql.slow_log;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
</pre></li><li class="listitem"><p>
                  <code class="literal">mysql_firewall_trace</code> システム変数が有効になっている場合、ファイアウォールは拒否されたステートメントもエラーログに書き込みます。 例: 
                </p><pre class="programlisting">[Note] Plugin MYSQL_FIREWALL reported:
'ACCESS DENIED for fwuser@localhost. Reason: No match in whitelist.
Statement: TRUNCATE TABLE `mysql` . `slow_log` '
</pre><p>
                  これらのログメッセージは、必要に応じて攻撃の原因を特定する際に役立ちます。
                </p></li></ul></div></li></ol></div><p>
          ファイアウォールアカウントプロファイルは、<code class="literal">fwuser@localhost</code> アカウントについてトレーニングされるようになりました。 クライアントがそのアカウントを使用して接続し、ステートメントを実行しようとすると、プロファイルによって、プロファイル allowlist で一致しないステートメントから MySQL が保護されます。 
        </p><p>
          一致しないステートメントをアクセスを拒否せずに疑わしいステートメントとして記録することで、侵入を検出することもできます。 まず、アカウントプロファイルを <code class="literal">DETECTING</code> モードにします: 
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'DETECTING');
</pre><p>
          次に、アカウントを使用して、アカウントプロファイル allowlist と一致しないステートメントを実行します。 <code class="literal">DETECTING</code> モードでは、ファイアウォールは一致しないステートメントの実行を許可します: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
+------------------------------+
| Tables_in_sakila (customer%) |
+------------------------------+
| customer                     |
| customer_list                |
+------------------------------+
</pre><p>
          さらに、ファイアウォールはエラーログにメッセージを書き込みます:
        </p><pre class="programlisting">[Note] Plugin MYSQL_FIREWALL reported:
'SUSPICIOUS STATEMENT from 'fwuser@localhost'. Reason: No match in whitelist.
Statement: SHOW TABLES LIKE ? '
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            <code class="literal">DETECTING</code> モードでは、メッセージはノート (情報メッセージ) として書き込まれます。 このようなメッセージがエラーログに表示され、破棄されないようにするには、情報メッセージを記録するためにエラーロギングの冗長性が十分であることを確認します。 たとえば、<a class="xref" href="server-administration.html#error-log-priority-based-filtering" title="5.4.2.5 優先度ベースのエラーログのフィルタリング (log_filter_internal)">セクション5.4.2.5「優先度ベースのエラーログのフィルタリング (log_filter_internal)」</a> で説明されている優先度ベースのログフィルタリングを使用している場合は、<code class="literal">log_error_verbosity</code> システム変数の値を 3 に設定します。 
          </p></div><p>
          アカウントプロファイルを無効にするには、そのモードを <code class="literal">OFF</code> に変更します:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>, 'OFF');
</pre><p>
          プロファイルのすべてのトレーニングを忘れて無効にするには、リセットします:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>, 'RESET');
</pre><p>
          リセット操作により、ファイアウォールはプロファイルのすべてのルールを削除し、そのモードを <code class="literal">OFF</code> に設定します。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-groups"></a>ファイアウォールグループプロファイルの登録</h5></div></div></div><p>
          MySQL Enterprise Firewall では、個々のアカウントに対応するサポートプロファイルに加えて、MySQL 8.0.23 の時点でグループプロファイルがサポートされています。 グループプロファイルは、そのメンバーとして複数のアカウントを持つことができます。 
        </p><p>
          グループプロファイルは、次の点でアカウントプロファイルと異なります:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              グループプロファイルの場合、その許可リストは、セッションアカウントがグループのいずれかのメンバーと一致するときに適用されます。 グループプロファイルを使用すると、アカウントごとに許可リスト内の各ルールを複製せずに、特定の許可リストを複数のアカウントに適用できます。 
            </p></li><li class="listitem"><p>
              アカウントプロファイルは、それが適用される単一のアカウントを使用してのみトレーニングできます。 グループプロファイルは、グループメンバーアカウントのいずれかまたはすべてを使用してトレーニングすることも、それらのアカウントのいずれかに限定することもできます。 
            </p></li><li class="listitem"><p>
              アカウントプロファイル名は、MySQL サーバーに接続するクライアントに依存する特定のユーザー名とホスト名の組合せに基づきます。 グループプロファイル名は、長さが 1 から 288 文字である必要があるという制約なしで選択されます。 
            </p></li></ul></div><p>
          その他の点では、アカウントプロファイルの使用に関する原則は、グループプロファイルの使用にも適用されます。 ここでは、これらの原則をよく理解していることを前提としています。<a class="xref" href="security.html#firewall-accounts" title="ファイアウォールアカウントプロファイルの登録">ファイアウォールアカウントプロファイルの登録</a> を参照してください。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            この説明は、セッションアカウントが 1 つ以上の適用可能なグループプロファイルと一致することを前提としているため、簡略化されています。 複数プロファイルの場合については、<a class="xref" href="security.html#firewall-multiple-profiles" title="複数の適用可能なプロファイルに対するファイアウォール操作">複数の適用可能なプロファイルに対するファイアウォール操作</a> を参照してください。 
          </p></div><p>
          次の例では、グループプロファイルをファイアウォールに登録し、その許可リストをトレーニングし、それを使用して MySQL を許容できないステートメントの実行から保護し、メンバーを追加および削除する方法を示します。 この例では、<code class="literal">mygrp</code> のグループプロファイル名を使用します。 
        </p><p>
          管理 MySQL アカウントを使用して、この手順の手順を実行します。ただし、ファイアウォールグループプロファイルのメンバーアカウントによって実行されるように指定された手順は除きます。
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
              必要に応じて、<code class="literal">mygrp</code> グループプロファイルのメンバーとなるアカウントを作成し、適切なアクセス権限を付与します。 1 つのメンバーに対するステートメントを次に示します (適切なパスワードを選択してください): 
            </p><pre class="programlisting">CREATE USER 'member1'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL ON sakila.* TO 'member1'@'localhost';
</pre></li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_group_mode()</code> ストアドプロシージャを使用して、グループプロファイルをファイアウォールに登録し、そのプロファイルを <code class="literal">RECORDING</code> (トレーニング) モードにします:
            </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('mygrp', 'RECORDING');
</pre></li><li class="listitem"><p>
              <code class="literal">sp_firewall_group_enlist()</code> ストアドプロシージャを使用して、グループプロファイル許可リストのトレーニングに使用する初期メンバーアカウントを追加します:
            </p><pre class="programlisting">CALL mysql.sp_firewall_group_enlist('mygrp', 'member1@localhost');
</pre></li><li class="listitem"><p>
              グループプロファイルのトレーニングに初期メンバーアカウントを使用するには、サーバーホストから <code class="literal">member1</code> としてサーバーに接続し、ファイアウォールに <code class="literal">member1@localhost</code> のセッションアカウントが表示されるようにします。 次に、プロファイルに対して正当とみなされるいくつかのステートメントを実行します。 例: 
            </p><pre class="programlisting">SELECT title, description FROM film WHERE film_id = 1;
UPDATE actor SET last_update = NOW() WHERE actor_id = 1;
SELECT store_id, COUNT(*) FROM inventory GROUP BY store_id;
</pre><p>
              ファイアウォールは、<code class="literal">member1@localhost</code> アカウントからステートメントを受け取ります。 このアカウントは <code class="literal">RECORDING</code> モードの <code class="literal">mygrp</code> プロファイルのメンバーであるため、ファイアウォールはステートメントを <code class="literal">mygrp</code> に適用可能として解釈し、正規化されたダイジェスト形式のステートメントを <code class="literal">mygrp</code> 許可リスト内のルールとして記録します。 これらのルールは、<code class="literal">mygrp</code> のメンバーであるすべてのアカウントに適用されます。 
            </p></li><li class="listitem"><p>
              この時点で、名前、メンバーシップ、許可リストなどのグループプロファイル情報がキャッシュされます。 この情報を表示するには、ファイアウォールの「パフォーマンススキーマ」テーブルをクエリーします: 
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT MODE FROM performance_schema.firewall_groups</code></strong>
       <strong class="userinput"><code>WHERE NAME = 'mygrp';</code></strong>
+-----------+
| MODE      |
+-----------+
| RECORDING |
+-----------+
mysql&gt; <strong class="userinput"><code>SELECT * FROM performance_schema.firewall_membership</code></strong>
       <strong class="userinput"><code>ORDER BY USERHOST;</code></strong>
+------------+-------------------+
| GROUP_NAME | USERHOST          |
+------------+-------------------+
| mygrp      | member1@localhost |
+------------+-------------------+
mysql&gt; <strong class="userinput"><code>SELECT RULE FROM performance_schema.firewall_group_allowlist</code></strong>
       <strong class="userinput"><code>WHERE NAME = 'mygrp';</code></strong>
+----------------------------------------------------------------------+
| RULE                                                                 |
+----------------------------------------------------------------------+
| SELECT @@`version_comment` LIMIT ?                                   |
| SELECT `title` , DESCRIPTION FROM `film` WHERE `film_id` = ?         |
| UPDATE `actor` SET `last_update` = NOW ( ) WHERE `actor_id` = ?      |
| SELECT `store_id` , COUNT ( * ) FROM `inventory` GROUP BY `store_id` |
+----------------------------------------------------------------------+
</pre></li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_group_mode()</code> を再度起動して、グループプロファイルを <code class="literal">PROTECTING</code> モードに切り替えます:
            </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('mygrp', 'PROTECTING');
</pre></li><li class="listitem"><p>
              メンバーである必要がある他のアカウントをグループプロファイルに追加します:
            </p><pre class="programlisting">CALL mysql.sp_firewall_group_enlist('mygrp', 'member2@localhost');
CALL mysql.sp_firewall_group_enlist('mygrp', 'member3@localhost');
CALL mysql.sp_firewall_group_enlist('mygrp', 'member4@localhost');
</pre><p>
              <code class="literal">member1@localhost</code> アカウントを使用してトレーニングされたプロファイル許可リストは、追加アカウントにも適用されるようになりました。
            </p></li><li class="listitem"><p>
              更新されたグループメンバーシップを確認するには、<code class="literal">firewall_membership</code> テーブルを再度クエリーします:
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM performance_schema.firewall_membership</code></strong>
       <strong class="userinput"><code>ORDER BY USERHOST;</code></strong>
+------------+-------------------+
| GROUP_NAME | USERHOST          |
+------------+-------------------+
| mygrp      | member1@localhost |
| mygrp      | member2@localhost |
| mygrp      | member3@localhost |
| mygrp      | member4@localhost |
+------------+-------------------+
</pre></li><li class="listitem"><p>
              グループ内の任意のアカウントを使用してファイアウォールに対してグループプロファイルをテストし、受け入れ可能なステートメントと受け入れられないステートメントを実行します。 ファイアウォールは、アカウントからの各ステートメントをプロファイル許可リストと照合し、それを受け入れるか拒否します。 
            </p></li><li class="listitem"><p>
              グループプロファイルからメンバーを削除する必要がある場合は、<code class="literal">sp_firewall_group_enlist()</code> ではなく <code class="literal">sp_firewall_group_delist()</code> ストアドプロシージャを使用します:
            </p><pre class="programlisting">CALL mysql.sp_firewall_group_delist('mygrp', 'member3@localhost');
</pre></li></ol></div><p>
          前述の手順では、許可リストをトレーニングする前に、1 人のメンバーのみをグループプロファイルに追加しました。 こうすることで、新規の許容ステートメントを許可リストに追加できるアカウントを制限することで、研修期間をより適切に制御できます。 追加のトレーニングが必要な場合は、プロファイルを <code class="literal">RECORDING</code> モードに戻すことができます: 
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('mygrp', 'RECORDING');
</pre><p>
          ただし、グループの任意のメンバーがステートメントを実行して許可リストに追加できるようになります。 追加のトレーニングを単一のグループメンバーに制限するには、<code class="literal">sp_set_firewall_group_mode_and_user()</code> をコールします。これは <code class="literal">sp_set_firewall_group_mode()</code> に似ていますが、<code class="literal">RECORDING</code> モードでプロファイルのトレーニングを許可するアカウントを指定する引数を使用します。 たとえば、<code class="literal">member4@localhost</code> によるトレーニングのみを有効にするには、次のようにします: 
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode_and_user('mygrp', 'RECORDING', 'member4@localhost');
</pre><p>
          これにより、他のグループメンバーを削除せずに、指定したアカウントによる追加のトレーニングが可能になります。 ステートメントを実行できますが、そのステートメントは許可リストに追加されません。 (ただし、<code class="literal">RECORDING</code> モードでは、他のメンバーが任意のステートメントを実行できることに注意してください。) 
        </p><p>
          追加のトレーニングの後、グループプロファイルを <code class="literal">PROTECTING</code> モードに戻します:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode('mygrp', 'PROTECTING');
</pre><p>
          <code class="literal">sp_set_firewall_group_mode_and_user()</code> によって確立されたトレーニングアカウントはグループプロファイルに保存されるため、後でさらにトレーニングが必要になった場合に備えて、ファイアウォールに保存されます。 したがって、<code class="literal">sp_set_firewall_group_mode()</code> (トレーニングアカウント引数なし) をコールした場合、現在のプロファイルトレーニングアカウントである <code class="literal">member4@localhost</code> は変更されません。 
        </p><p>
          すべてのグループメンバーが <code class="literal">RECORDING</code> モードでトレーニングを実行できるようにする必要がある場合にトレーニングアカウントをクリアするには、<code class="literal">sp_set_firewall_group_mode_and_user()</code> をコールし、アカウント引数に <code class="literal">NULL</code> 値を渡します:
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_group_mode_and_user('mygrp', 'RECORDING', NULL);
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
            特定のアカウントがグループプロファイルのトレーニングアカウントとして指定された場合の予期しない動作を回避するには、そのアカウントがグループのメンバーであることを常に確認してください。
          </p></div><p>
          アカウントプロファイルと同様に、侵入検出の場合は <code class="literal">DETECTING</code> のモード、プロファイルを無効にする場合は <code class="literal">OFF</code>、プロファイルルールを忘れてそのモードを <code class="literal">OFF</code> に設定する場合は <code class="literal">RESET</code> のモードをグループプロファイルに割り当てることができます。
        </p></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-multiple-profiles"></a>複数の適用可能なプロファイルに対するファイアウォール操作</h5></div></div></div><p>
          簡単にするために、前のセクションでは、ファイアウォールがクライアントからの受信ステートメントを単一のプロファイル (アカウントプロファイルまたはグループプロファイル) に対してのみ照合する観点を説明しました。 ただし、ファイアウォール操作はより複雑になる可能性があります: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              グループプロファイルには、複数のアカウントをメンバーとして含めることができます。
            </p></li><li class="listitem"><p>
              アカウントは、複数のグループプロファイルのメンバーになることができます。
            </p></li><li class="listitem"><p>
              複数のプロファイルを特定のクライアントに一致させることができます。
            </p></li></ul></div><p>
          このセクションでは、複数のプロファイルが受信ステートメントに適用される場合のファイアウォールの動作について説明します。 この説明では、単一の適用可能なアカウントまたはグループプロファイルで前述したケースを含む、一般的なケースについて説明します。 
        </p><p>
          MySQL は、特定のユーザー名とホスト名の組合せに対して各クライアントセッションを認証します。 この組合せは<span class="emphasis"><em>セッションアカウント</em></span>です。 ファイアウォールは、セッションアカウントを登録済プロファイルと照合して、セッションからの受信ステートメントの処理に適用するプロファイルを決定します: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              ファイアウォールは非アクティブなプロファイル (<code class="literal">OFF</code> モードのプロファイル) を無視します。
            </p></li><li class="listitem"><p>
              セッションアカウントは、同じユーザーとホストを持つアクティブなアカウントプロファイルと一致します (存在する場合)。 そのようなアカウントプロファイルは最大 1 つあります。 
            </p></li><li class="listitem"><p>
              セッションアカウントは、同じユーザーおよびホストを持つメンバーを含むすべてのアクティブなグループプロファイルと一致します。 そのようなグループプロファイルは複数存在できます。 
            </p></li></ul></div><p>
          つまり、セッションアカウントは、0 個または 1 個のアクティブなアカウントプロファイルと、0 個以上のアクティブなグループプロファイルと一致します。 つまり、0、1 または複数のファイアウォールプロファイルが特定のセッションに適用可能であり、ファイアウォールが各受信ステートメントを次のように処理することを意味します: 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              適用可能なプロファイルがない場合、制限はありません。 ファイアウォールはステートメントを受け入れます。 
            </p></li><li class="listitem"><p>
              適用可能なプロファイルがある場合は、そのモードによってステートメントの処理が決まります:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  ファイアウォールは、<code class="literal">RECORDING</code> モードの適用可能な各プロファイルの許可リストにステートメントを記録します。
                </p></li><li class="listitem"><p>
                  ファイアウォールは、<code class="literal">DETECTING</code> モードの適用可能な各プロファイルのエラーログにステートメントを書き込みます。
                </p></li><li class="listitem"><p>
                  少なくとも 1 つの適用可能なプロファイルが <code class="literal">RECORDING</code> モードまたは <code class="literal">DETECTING</code> モードの場合 (これらのモードはすべてのステートメントを受け入れます)、あるいは少なくとも 1 つの適用可能なプロファイルの許可リストと <code class="literal">PROTECTING</code> モードで一致する場合、ファイアウォールはそのステートメントを受け入れます。 そうでない場合、ファイアウォールはステートメントを拒否します (<code class="literal">mysql_firewall_trace</code> システム変数が有効になっている場合はエラーログに書き込みます)。 
                </p></li></ul></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-monitoring"></a>ファイアウォールの監視</h5></div></div></div><p>
          ファイアウォールアクティビティを評価するには、そのステータス変数を調べます。 たとえば、前述の手順を実行して <code class="literal">fwuser@localhost</code> アカウントをトレーニングおよび保護すると、変数は次のようになります: 
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Firewall%';</code></strong>
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| Firewall_access_denied     | 3     |
| Firewall_access_granted    | 4     |
| Firewall_access_suspicious | 1     |
| Firewall_cached_entries    | 4     |
+----------------------------+-------+
</pre><p>
          変数は、拒否されたステートメント、受け入れられたステートメント、疑わしいステートメントとして記録されたステートメントおよびキャッシュに追加されたステートメントの数をそれぞれ示します。 登録済アカウントを使用して接続した 3 回ごとに <span class="command"><strong>mysql</strong></span> クライアントによって送信される<code class="literal">@@version_comment</code> ステートメントと <code class="literal">DETECTING</code> モードでブロックされなかった <code class="literal">SHOW TABLES</code> ステートメントのため、<code class="literal">Firewall_access_granted</code> 数は 4 です。 
        </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="firewall-reference"></a>6.4.7.4 MySQL Enterprise Firewall リファレンス</h4></div></div></div><p>
        次の各セクションでは、MySQL Enterprise Firewall 要素のリファレンスを示します:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#firewall-tables" title="MySQL Enterprise Firewall テーブル">MySQL Enterprise Firewall テーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-stored-routines" title="MySQL Enterprise Firewall ストアドプロシージャ">MySQL Enterprise Firewall ストアドプロシージャ</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-functions" title="MySQL Enterprise Firewall のユーザー定義関数">MySQL Enterprise Firewall のユーザー定義関数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-system-variables" title="MySQL Enterprise Firewall システム変数">MySQL Enterprise Firewall システム変数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-status-variables" title="MySQL Enterprise Firewall ステータス変数">MySQL Enterprise Firewall ステータス変数</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-tables"></a>MySQL Enterprise Firewall テーブル</h5></div></div></div><p>
          MySQL Enterprise Firewall では、アカウントごとおよびグループごとにプロファイル情報が保持されます。 <code class="literal">mysql</code> システムデータベース内のテーブルを永続記憶域に使用し、<code class="literal">INFORMATION_SCHEMA</code> テーブルまたは「パフォーマンススキーマ」テーブルを使用してメモリー内にキャッシュされたデータを表示します。 有効にすると、ファイアウォールはキャッシュされたデータに基づいて操作上の決定を行います。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#firewall-tables-account" title="ファイアウォールアカウントプロファイルテーブル">ファイアウォールアカウントプロファイルテーブル</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-tables-group" title="ファイアウォールグループプロファイルテーブル">ファイアウォールグループプロファイルテーブル</a></p></li></ul></div><h6><a name="firewall-tables-account"></a>ファイアウォールアカウントプロファイルテーブル</h6><p>
          MySQL Enterprise Firewall では、永続記憶域の <code class="literal">mysql</code> システムデータベースのテーブルおよび <code class="literal">INFORMATION_SCHEMA</code> テーブルを使用してアカウントプロファイル情報を保持し、メモリー内にキャッシュされたデータのビューを提供します。
        </p><p>
          各 <code class="literal">mysql</code> システムデータベーステーブルにアクセスできるのは、そのテーブルに対する <code class="literal">SELECT</code> 権限を持つアカウントのみです。 <code class="literal">INFORMATION_SCHEMA</code> テーブルには、誰でもアクセスできます。 
        </p><p>
          <code class="literal">mysql.firewall_users</code> テーブルには、登録済ファイアウォールアカウントプロファイルの名前と操作モードがリストされます。 テーブルには次のカラムがあります (対応する <code class="literal">INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code> テーブルには類似したカラムがありますが、必ずしも同一ではありません): 
        </p><a class="indexterm" name="idm46723749249344"></a><a class="indexterm" name="idm46723749247760"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p>
              アカウントプロファイル名。 各アカウント名の形式は <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> です。 
            </p></li><li class="listitem"><p>
              <code class="literal">MODE</code>
            </p><p>
              プロファイルの現在の操作モード。 許可されるモード値は、<code class="literal">OFF</code>, <code class="literal">DETECTING</code>, <code class="literal">PROTECTING</code>, <code class="literal">RECORDING</code> および <code class="literal">RESET</code> です。 意味の詳細は、<a class="xref" href="security.html#firewall-concepts" title="ファイアウォール操作の概念">ファイアウォール操作の概念</a> を参照してください。 
            </p></li></ul></div><p>
          <code class="literal">mysql.firewall_whitelist</code> テーブルには、登録済ファイアウォールアカウントプロファイルの許可リストルールがリストされます。 テーブルには次のカラムがあります (対応する <code class="literal">INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code> テーブルには類似したカラムがありますが、必ずしも同一ではありません): 
        </p><a class="indexterm" name="idm46723749233008"></a><a class="indexterm" name="idm46723749231408"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p>
              アカウントプロファイル名。 各アカウント名の形式は <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> です。 
            </p></li><li class="listitem"><p>
              <code class="literal">RULE</code>
            </p><p>
              プロファイルの許容可能なステートメントパターンを示す正規化されたステートメント。 プロファイル許可リストは、そのルールの和集合です。 
            </p></li><li class="listitem"><p>
              <code class="literal">ID</code>
            </p><p>
              テーブルの主キーである整数カラム。 このカラムは、MySQL 8.0.12 で追加されました。 
            </p></li></ul></div><h6><a name="firewall-tables-group"></a>ファイアウォールグループプロファイルテーブル</h6><p>
          MySQL 8.0.23 の時点では、MySQL Enterprise Firewall は、永続記憶域用の <code class="literal">mysql</code> システムデータベースのテーブルおよび「パフォーマンススキーマ」テーブルを使用してグループプロファイル情報を保持し、メモリー内にキャッシュされたデータへのビューを提供します。
        </p><p>
          各システムおよび「パフォーマンススキーマ」テーブルには、そのシステムおよび「パフォーマンススキーマ」テーブルに対する <code class="literal">SELECT</code> 権限を持つアカウントのみがアクセスできます。
        </p><p>
          <code class="literal">mysql.firewall_groups</code> テーブルには、登録されているファイアウォールグループプロファイルの名前と動作モードが一覧表示されます。 テーブルには次のカラムがあります (対応するパフォーマンススキーマ <code class="literal">firewall_groups</code> テーブルには類似していますが、必ずしも同一ではありません): 
        </p><a class="indexterm" name="idm46723749213664"></a><a class="indexterm" name="idm46723749212080"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NAME</code>
            </p><p>
              グループプロファイル名。
            </p></li><li class="listitem"><p>
              <code class="literal">MODE</code>
            </p><p>
              プロファイルの現在の操作モード。 許可されるモード値は、<code class="literal">OFF</code>, <code class="literal">DETECTING</code>, <code class="literal">PROTECTING</code> および <code class="literal">RECORDING</code> です。 意味の詳細は、<a class="xref" href="security.html#firewall-concepts" title="ファイアウォール操作の概念">ファイアウォール操作の概念</a> を参照してください。 
            </p></li><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p>
              プロファイルが <code class="literal">RECORDING</code> モードの場合に使用される、グループプロファイルのトレーニングアカウント。 値は、<code class="literal">NULL</code> または <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の <code class="literal">NULL</code> 以外のアカウントです: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  値が <code class="literal">NULL</code> の場合、ファイアウォールはグループのメンバーであるアカウントから受信したステートメントの許可リストルールを記録します。
                </p></li><li class="listitem"><p>
                  値が <code class="literal">NULL</code> 以外の場合、ファイアウォールは、指定されたアカウント (グループのメンバーである必要があります) から受信したステートメントの許可リストルールのみを記録します。
                </p></li></ul></div></li></ul></div><p>
          <code class="literal">mysql.firewall_group_allowlist</code> テーブルには、登録されているファイアウォールグループプロファイルの許可リストルールが一覧表示されます。 テーブルには次のカラムがあります (対応するパフォーマンススキーマ <code class="literal">firewall_group_allowlist</code> テーブルには類似していますが、必ずしも同一ではありません): 
        </p><a class="indexterm" name="idm46723749187840"></a><a class="indexterm" name="idm46723749186224"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NAME</code>
            </p><p>
              グループプロファイル名。
            </p></li><li class="listitem"><p>
              <code class="literal">RULE</code>
            </p><p>
              プロファイルの許容可能なステートメントパターンを示す正規化されたステートメント。 プロファイル許可リストは、そのルールの和集合です。 
            </p></li><li class="listitem"><p>
              <code class="literal">ID</code>
            </p><p>
              テーブルの主キーである整数カラム。
            </p></li></ul></div><p>
          <code class="literal">mysql.firewall_membership</code> テーブルには、登録済のファイアウォールグループプロファイルのメンバー (アカウント) がリストされます。 テーブルには次のカラムがあります (対応するパフォーマンススキーマ <code class="literal">firewall_membership</code> テーブルには類似していますが、必ずしも同一ではありません): 
        </p><a class="indexterm" name="idm46723749174800"></a><a class="indexterm" name="idm46723749173200"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">GROUP_ID</code>
            </p><p>
              グループプロファイル名。
            </p></li><li class="listitem"><p>
              <code class="literal">MEMBER_ID</code>
            </p><p>
              プロファイルのメンバーであるアカウントの名前。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-stored-routines"></a>MySQL Enterprise Firewall ストアドプロシージャ</h5></div></div></div><p>
          MySQL Enterprise Firewall ストアドプロシージャは、ファイアウォールへのプロファイルの登録、操作モードの確立、キャッシュと永続記憶域間のファイアウォールデータの転送の管理などのタスクを実行します。 これらのプロシージャは、下位レベルのタスク用の API を提供するユーザー定義関数 (UDF) を起動します。 
        </p><p>
          ファイアウォールストアドプロシージャは、<code class="literal">mysql</code> システムデータベースに作成されます。 ファイアウォールストアドプロシージャを起動するには、<code class="literal">mysql</code> がデフォルトのデータベースである間に起動するか、プロシージャ名をデータベース名で修飾します。 例: 
        </p><pre class="programlisting">CALL mysql.sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>, <em class="replaceable"><code>mode</code></em>);
</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#firewall-stored-routines-account" title="ファイアウォールアカウントプロファイルのストアドプロシージャー">ファイアウォールアカウントプロファイルのストアドプロシージャー</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-stored-routines-group" title="ファイアウォールグループプロファイルのストアドプロシージャ">ファイアウォールグループプロファイルのストアドプロシージャ</a></p></li></ul></div><h6><a name="firewall-stored-routines-account"></a>ファイアウォールアカウントプロファイルのストアドプロシージャー</h6><p>
          次のストアドプロシージャは、ファイアウォールアカウントプロファイルに対して管理操作を実行します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">sp_reload_firewall_rules(<em class="replaceable"><code>user</code></em>)</code>
            </p><a class="indexterm" name="idm46723749153312"></a><a class="indexterm" name="idm46723749151648"></a><p>
              このストアドプロシージャは、個々のアカウントプロファイルのファイアウォール操作を制御します。 この手順では、ファイアウォール UDF を使用して、<code class="literal">mysql.firewall_whitelist</code> テーブルに格納されているルールからアカウントプロファイルのメモリー内ルールをリロードします。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>user</code></em>: 影響を受けるアカウントプロファイルの名前 (<code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の文字列)。
                </p></li></ul></div><p>
              例:
            </p><pre class="programlisting">CALL mysql.sp_reload_firewall_rules('fwuser@localhost');
</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
                このプロシージャは、永続ストレージからリロードする前にアカウントプロファイルのインメモリー許可リストルールをクリアし、プロファイルモードを <code class="literal">OFF</code> に設定します。 <code class="literal">sp_reload_firewall_rules()</code> コールの前にプロファイルモードが <code class="literal">OFF</code> でなかった場合は、ルールのリロード後に <code class="literal">sp_set_firewall_mode()</code> を使用して以前のモードをリストアします。 たとえば、プロファイルが <code class="literal">PROTECTING</code> モードであった場合、<code class="literal">sp_reload_firewall_rules()</code> をコールした後で true でなくなり、それを明示的に <code class="literal">PROTECTING</code> に再度設定する必要があります。 
              </p></div></li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>, <em class="replaceable"><code>mode</code></em>)</code>
            </p><a class="indexterm" name="idm46723749133536"></a><a class="indexterm" name="idm46723749131872"></a><p>
              このストアドプロシージャは、ファイアウォールにプロファイルを登録した後 (まだ登録されていない場合)、ファイアウォールアカウントプロファイルの操作モードを確立します。 この手順では、必要に応じてファイアウォール UDF を呼び出して、キャッシュと永続ストレージの間でファイアウォールデータを転送することもできます。 このプロシージャは、<code class="literal">mysql_firewall_mode</code> システム変数が <code class="literal">OFF</code> の場合でもコールできますが、プロファイルのモードを設定しても、ファイアウォールが有効になるまで操作上の影響はありません。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>user</code></em>: 影響を受けるアカウントプロファイルの名前 (<code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の文字列)。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>mode</code></em>: 文字列としてのプロファイルの操作モード。 許可されるモード値は、<code class="literal">OFF</code>, <code class="literal">DETECTING</code>, <code class="literal">PROTECTING</code>, <code class="literal">RECORDING</code> および <code class="literal">RESET</code> です。 意味の詳細は、<a class="xref" href="security.html#firewall-concepts" title="ファイアウォール操作の概念">ファイアウォール操作の概念</a> を参照してください。 
                </p></li></ul></div><p>
              アカウントプロファイルを任意のモードに切り替えますが、<code class="literal">RECORDING</code> はファイアウォールキャッシュデータを、基礎となる永続的な記憶域を提供する <code class="literal">mysql</code> システムデータベーステーブルと同期します。 モードを <code class="literal">OFF</code> から <code class="literal">RECORDING</code> に切り替えると、<code class="literal">mysql.firewall_whitelist</code> テーブルからキャッシュに allowlist がリロードされます。 
            </p><p>
              アカウントプロファイルに空の許可リストがある場合、そのモードは <code class="literal">PROTECTING</code> に設定できません。これは、プロファイルがすべてのステートメントを拒否し、効果的にアカウントによるステートメントの実行を禁止するためです。 このようなモード設定の試行に応じて、ファイアウォールは SQL エラーとしてではなく結果セットとして返される診断メッセージを生成します: 
            </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('a@b','PROTECTING');</code></strong>
+----------------------------------------------------------------------+
| set_firewall_mode(arg_userhost, arg_mode)                            |
+----------------------------------------------------------------------+
| ERROR: PROTECTING mode requested for a@b but the whitelist is empty. |
+----------------------------------------------------------------------+
</pre></li></ul></div><h6><a name="firewall-stored-routines-group"></a>ファイアウォールグループプロファイルのストアドプロシージャ</h6><p>
          これらのストアドプロシージャーは、ファイアウォールグループプロファイルに対して管理操作を実行します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">sp_firewall_group_delist(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>user</code></em>)</code>
            </p><a class="indexterm" name="idm46723749104384"></a><a class="indexterm" name="idm46723749102720"></a><p>
              このストアドプロシージャは、ファイアウォールグループプロファイルからアカウントを削除します。
            </p><p>
              コールが成功した場合、グループメンバーシップの変更は、インメモリーキャッシュと永続記憶域の両方に対して行われます。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>group</code></em>: 影響を受けるグループプロファイルの名前。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>user</code></em>: 削除するアカウント (<code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の文字列)。
                </p></li></ul></div><p>
              例:
            </p><pre class="programlisting">CALL sp_firewall_group_delist('g', 'fwuser@localhost');
</pre><p>
              このプロシージャは、MySQL 8.0.23 で追加されました。
            </p></li><li class="listitem"><p>
              <code class="literal">sp_firewall_group_enlist(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>user</code></em>)</code>
            </p><a class="indexterm" name="idm46723749089952"></a><a class="indexterm" name="idm46723749088288"></a><p>
              このストアドプロシージャは、ファイアウォールグループプロファイルにアカウントを追加します。 アカウントをグループに追加する前に、アカウント自体をファイアウォールに登録する必要はありません。 
            </p><p>
              コールが成功した場合、グループメンバーシップの変更は、インメモリーキャッシュと永続記憶域の両方に対して行われます。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>group</code></em>: 影響を受けるグループプロファイルの名前。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>user</code></em>: <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の文字列として追加するアカウント。
                </p></li></ul></div><p>
              例:
            </p><pre class="programlisting">CALL sp_firewall_group_enlist('g', 'fwuser@localhost');
</pre><p>
              このプロシージャは、MySQL 8.0.23 で追加されました。
            </p></li><li class="listitem"><p>
              <code class="literal">sp_reload_firewall_group_rules(<em class="replaceable"><code>group</code></em>)</code>
            </p><a class="indexterm" name="idm46723749075664"></a><a class="indexterm" name="idm46723749073968"></a><p>
              このストアドプロシージャは、個々のグループプロファイルのファイアウォール操作を制御します。 この手順では、ファイアウォール UDF を使用して、<code class="literal">mysql.firewall_group_allowlist</code> テーブルに格納されているルールからグループプロファイルのインメモリールールをリロードします。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>group</code></em>: 影響を受けるグループプロファイルの名前。
                </p></li></ul></div><p>
              例:
            </p><pre class="programlisting">CALL sp_reload_firewall_group_rules('myapp');
</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
                このプロシージャは、永続記憶域からリロードする前にグループプロファイルインメモリー許可リストルールをクリアし、プロファイルモードを <code class="literal">OFF</code> に設定します。 <code class="literal">sp_reload_firewall_group_rules()</code> コールの前にプロファイルモードが <code class="literal">OFF</code> でなかった場合は、ルールのリロード後に <code class="literal">sp_set_firewall_group_mode()</code> を使用して以前のモードをリストアします。 たとえば、プロファイルが <code class="literal">PROTECTING</code> モードであった場合、<code class="literal">sp_reload_firewall_group_rules()</code> をコールした後で true でなくなり、それを明示的に <code class="literal">PROTECTING</code> に再度設定する必要があります。 
              </p></div><p>
              このプロシージャは、MySQL 8.0.23 で追加されました。
            </p></li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_group_mode(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>mode</code></em>)</code>
            </p><a class="indexterm" name="idm46723749056576"></a><a class="indexterm" name="idm46723749054896"></a><p>
              このストアドプロシージャは、ファイアウォールにプロファイルを登録した後、ファイアウォールグループプロファイルの動作モードを確立します (まだ登録されていない場合)。 この手順では、必要に応じてファイアウォール UDF を呼び出して、キャッシュと永続ストレージの間でファイアウォールデータを転送することもできます。 このプロシージャは、<code class="literal">mysql_firewall_mode</code> システム変数が <code class="literal">OFF</code> の場合でもコールできますが、プロファイルのモードを設定しても、ファイアウォールが有効になるまで操作上の影響はありません。 
            </p><p>
              プロファイルが以前に存在していた場合、その記録制限は変更されません。 制限を設定またはクリアするには、かわりに <code class="literal">sp_set_firewall_group_mode_and_user()</code> をコールします。 
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>group</code></em>: 影響を受けるグループプロファイルの名前。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>mode</code></em>: 文字列としてのプロファイルの操作モード。 許可されるモード値は、<code class="literal">OFF</code>, <code class="literal">DETECTING</code>, <code class="literal">PROTECTING</code> および <code class="literal">RECORDING</code> です。 意味の詳細は、<a class="xref" href="security.html#firewall-concepts" title="ファイアウォール操作の概念">ファイアウォール操作の概念</a> を参照してください。 
                </p></li></ul></div><p>
              例:
            </p><pre class="programlisting">CALL sp_set_firewall_group_mode('myapp', 'PROTECTING');
</pre><p>
              このプロシージャは、MySQL 8.0.23 で追加されました。
            </p></li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_group_mode_and_user(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>mode</code></em>, <em class="replaceable"><code>user</code></em>)</code>
            </p><a class="indexterm" name="idm46723749036464"></a><a class="indexterm" name="idm46723749034640"></a><p>
              このストアドプロシージャは、<code class="literal">sp_set_firewall_group_mode()</code> と同様に、グループをファイアウォールに登録し、その操作モードを確立しますが、グループが <code class="literal">RECORDING</code> モードの場合に使用するトレーニングアカウントも指定します。
            </p><p>
              引数:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>group</code></em>: 影響を受けるグループプロファイルの名前。
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>mode</code></em>: 文字列としてのプロファイルの操作モード。 許可されるモード値は、<code class="literal">OFF</code>, <code class="literal">DETECTING</code>, <code class="literal">PROTECTING</code> および <code class="literal">RECORDING</code> です。 意味の詳細は、<a class="xref" href="security.html#firewall-concepts" title="ファイアウォール操作の概念">ファイアウォール操作の概念</a> を参照してください。 
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>user</code></em>: プロファイルが <code class="literal">RECORDING</code> モードの場合に使用される、グループプロファイルのトレーニングアカウント。 値は、<code class="literal">NULL</code> または <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の <code class="literal">NULL</code> 以外のアカウントです: 
                </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                      値が <code class="literal">NULL</code> の場合、ファイアウォールはグループのメンバーであるアカウントから受信したステートメントの許可リストルールを記録します。
                    </p></li><li class="listitem"><p>
                      値が <code class="literal">NULL</code> 以外の場合、ファイアウォールは、指定されたアカウント (グループのメンバーである必要があります) から受信したステートメントの許可リストルールのみを記録します。
                    </p></li></ul></div></li></ul></div><p>
              例:
            </p><pre class="programlisting">CALL sp_set_firewall_group_mode_and_user('myapp', 'RECORDING', 'myapp_user1@localhost');
</pre><p>
              このプロシージャは、MySQL 8.0.23 で追加されました。
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-functions"></a>MySQL Enterprise Firewall のユーザー定義関数</h5></div></div></div><p>
          MySQL Enterprise Firewall ユーザー定義関数 (UDF) は、ファイアウォールキャッシュを基礎となるシステムテーブルと同期化するなどの下位レベルのタスク用の API を提供します。
        </p><p>
          <span class="emphasis"><em>通常の操作では、これらの UDF はユーザーによって直接ではなく、ファイアウォールストアドプロシージャによって起動されます。</em></span> そのため、これらの UDF の説明には、引数や戻り型に関する情報など、通常の詳細は含まれません。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#firewall-functions-account" title="ファイアウォールアカウントプロファイルのユーザー定義関数">ファイアウォールアカウントプロファイルのユーザー定義関数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-functions-group" title="ファイアウォールグループプロファイルのユーザー定義関数">ファイアウォールグループプロファイルのユーザー定義関数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-functions-miscellaneous" title="ファイアウォールのその他のユーザー定義関数">ファイアウォールのその他のユーザー定義関数</a></p></li></ul></div><h6><a name="firewall-functions-account"></a>ファイアウォールアカウントプロファイルのユーザー定義関数</h6><p>
          次の UDF は、ファイアウォールアカウントプロファイルに対する管理操作を実行します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_read-firewall-users"></a>
              <code class="literal">read_firewall_users(<em class="replaceable"><code>user</code></em>, <em class="replaceable"><code>mode</code></em>)</code>
            </p><a class="indexterm" name="idm46723748999024"></a><a class="indexterm" name="idm46723748997616"></a><p>
              この集計 UDF は、<code class="literal">mysql.firewall_users</code> テーブルの <code class="literal">SELECT</code> ステートメントを使用してファイアウォールアカウントプロファイルキャッシュを更新します。 <code class="literal">FIREWALL_ADMIN</code> 権限または非推奨の <code class="literal">SUPER</code> 権限が必要です。 
            </p><p>
              例:
            </p><pre class="programlisting">SELECT read_firewall_users('fwuser@localhost', 'RECORDING')
FROM mysql.firewall_users;
</pre></li><li class="listitem"><p><a name="function_read-firewall-whitelist"></a>
              <code class="literal">read_firewall_whitelist(<em class="replaceable"><code>user</code></em>, <em class="replaceable"><code>rule</code></em>)</code>
            </p><a class="indexterm" name="idm46723748986784"></a><a class="indexterm" name="idm46723748985376"></a><p>
              この集計 UDF は、<code class="literal">mysql.firewall_whitelist</code> テーブルの <code class="literal">SELECT</code> ステートメントを使用して、指定されたアカウントプロファイルの記録済ステートメントキャッシュを更新します。 <code class="literal">FIREWALL_ADMIN</code> 権限または非推奨の <code class="literal">SUPER</code> 権限が必要です。 
            </p><p>
              例:
            </p><pre class="programlisting">SELECT read_firewall_whitelist('fwuser@localhost', fw.rule)
FROM mysql.firewall_whitelist AS fw
WHERE USERHOST = 'fwuser@localhost';
</pre></li><li class="listitem"><p><a name="function_set-firewall-mode"></a>
              <code class="literal">set_firewall_mode(<em class="replaceable"><code>user</code></em>, <em class="replaceable"><code>mode</code></em>)</code>
            </p><a class="indexterm" name="idm46723748974304"></a><a class="indexterm" name="idm46723748972896"></a><p>
              この UDF は、アカウントプロファイルキャッシュを管理し、プロファイル操作モードを確立します。 <code class="literal">FIREWALL_ADMIN</code> 権限または非推奨の <code class="literal">SUPER</code> 権限が必要です。 
            </p><p>
              例:
            </p><pre class="programlisting">SELECT set_firewall_mode('fwuser@localhost', 'RECORDING');
</pre></li></ul></div><h6><a name="firewall-functions-group"></a>ファイアウォールグループプロファイルのユーザー定義関数</h6><p>
          これらの UDF は、ファイアウォールグループプロファイルに対して管理操作を実行します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_firewall-group-delist"></a>
              <code class="literal">firewall_group_delist(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>user</code></em>)</code>
            </p><a class="indexterm" name="idm46723748961280"></a><a class="indexterm" name="idm46723748959872"></a><p>
              この UDF は、グループプロファイルからアカウントを削除します。 <code class="literal">FIREWALL_ADMIN</code> 権限が必要です。 
            </p><p>
              例:
            </p><pre class="programlisting">SELECT firewall_group_delist('g', 'fwuser@localhost');
</pre><p>
              この関数は、MySQL 8.0.23 で追加されました。
            </p></li><li class="listitem"><p><a name="function_firewall-group-enlist"></a>
              <code class="literal">firewall_group_enlist(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>user</code></em>)</code>
            </p><a class="indexterm" name="idm46723748951072"></a><a class="indexterm" name="idm46723748949664"></a><p>
              この UDF は、アカウントをグループプロファイルに追加します。 <code class="literal">FIREWALL_ADMIN</code> 権限が必要です。 
            </p><p>
              アカウントをグループに追加する前に、アカウント自体をファイアウォールに登録する必要はありません。
            </p><p>
              例:
            </p><pre class="programlisting">SELECT firewall_group_enlist('g', 'fwuser@localhost');
</pre><p>
              この関数は、MySQL 8.0.23 で追加されました。
            </p></li><li class="listitem"><p><a name="function_read-firewall-group-allowlist"></a>
              <code class="literal">read_firewall_group_allowlist(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>rule</code></em>)</code>
            </p><a class="indexterm" name="idm46723748940144"></a><a class="indexterm" name="idm46723748938704"></a><p>
              この集計 UDF は、<code class="literal">mysql.firewall_group_allowlist</code> テーブルの <code class="literal">SELECT</code> ステートメントを介して、指定されたグループプロファイルの記録されたステートメントキャッシュを更新します。 <code class="literal">FIREWALL_ADMIN</code> 権限が必要です。 
            </p><p>
              例:
            </p><pre class="programlisting">SELECT read_firewall_group_allowlist('my_fw_group', fgw.rule)
FROM mysql.firewall_group_allowlist AS fgw
WHERE NAME = 'my_fw_group';
</pre><p>
              この関数は、MySQL 8.0.23 で追加されました。
            </p></li><li class="listitem"><p><a name="function_read-firewall-groups"></a>
              <code class="literal">read_firewall_groups(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>mode</code></em>, <em class="replaceable"><code>user</code></em>)</code>
            </p><a class="indexterm" name="idm46723748927456"></a><a class="indexterm" name="idm46723748926048"></a><p>
              この集計 UDF は、<code class="literal">mysql.firewall_groups</code> テーブルの <code class="literal">SELECT</code> ステートメントを介してファイアウォールグループプロファイルキャッシュを更新します。 <code class="literal">FIREWALL_ADMIN</code> 権限が必要です。 
            </p><p>
              例:
            </p><pre class="programlisting">SELECT read_firewall_groups('g', 'RECORDING', 'fwuser@localhost')
FROM mysql.firewall_groups;
</pre><p>
              この関数は、MySQL 8.0.23 で追加されました。
            </p></li><li class="listitem"><p><a name="function_set-firewall-group-mode"></a>
              <code class="literal">set_firewall_group_mode(<em class="replaceable"><code>group</code></em>, <em class="replaceable"><code>mode</code></em>[, <em class="replaceable"><code>user</code></em>])</code>
            </p><a class="indexterm" name="idm46723748915040"></a><a class="indexterm" name="idm46723748913632"></a><p>
              この UDF は、グループプロファイルキャッシュを管理し、プロファイル操作モードを確立し、オプションでプロファイルトレーニングアカウントを指定します。 <code class="literal">FIREWALL_ADMIN</code> 権限が必要です。 
            </p><p>
              オプションの <em class="replaceable"><code>user</code></em> 引数が指定されていない場合、プロファイルの以前の <em class="replaceable"><code>user</code></em> 設定は変更されません。 設定を変更するには、3 番目の引数を指定して UDF を呼び出します。 
            </p><p>
              オプションの <em class="replaceable"><code>user</code></em> 引数が指定されている場合は、プロファイルが <code class="literal">RECORDING</code> モードのときに使用される、グループプロファイルのトレーニングアカウントを指定します。 値は、<code class="literal">NULL</code> または <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code> 形式の <code class="literal">NULL</code> 以外のアカウントです: 
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  値が <code class="literal">NULL</code> の場合、ファイアウォールはグループのメンバーであるアカウントから受信したステートメントの許可リストルールを記録します。
                </p></li><li class="listitem"><p>
                  値が <code class="literal">NULL</code> 以外の場合、ファイアウォールは、指定されたアカウント (グループのメンバーである必要があります) から受信したステートメントの許可リストルールのみを記録します。
                </p></li></ul></div><p>
              例:
            </p><pre class="programlisting">SELECT set_firewall_group_mode('g', 'DETECTING');
</pre><p>
              この関数は、MySQL 8.0.23 で追加されました。
            </p></li></ul></div><h6><a name="firewall-functions-miscellaneous"></a>ファイアウォールのその他のユーザー定義関数</h6><p>
          次の UDF は、その他のファイアウォール操作を実行します:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_mysql-firewall-flush-status"></a>
              <code class="literal">mysql_firewall_flush_status()</code>
            </p><a class="indexterm" name="idm46723748892320"></a><a class="indexterm" name="idm46723748890880"></a><p>
              この UDF は、いくつかのファイアウォールステータス変数を 0 にリセットします:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">Firewall_access_denied</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Firewall_access_granted</code>
                </p></li><li class="listitem"><p>
                  <code class="literal">Firewall_access_suspicious</code>
                </p></li></ul></div><p>
              この UDF には、<code class="literal">FIREWALL_ADMIN</code> 権限または非推奨の <code class="literal">SUPER</code> 権限が必要です。
            </p><p>
              例:
            </p><pre class="programlisting">SELECT mysql_firewall_flush_status();
</pre></li><li class="listitem"><p><a name="function_normalize-statement"></a>
              <code class="literal">normalize_statement(<em class="replaceable"><code>stmt</code></em>)</code>
            </p><a class="indexterm" name="idm46723748875856"></a><a class="indexterm" name="idm46723748874448"></a><p>
              この UDF は、SQL ステートメントを許可リストルールに使用されるダイジェストフォームに正規化します。 <code class="literal">FIREWALL_ADMIN</code> 権限または非推奨の <code class="literal">SUPER</code> 権限が必要です。 
            </p><p>
              例:
            </p><pre class="programlisting">SELECT normalize_statement('SELECT * FROM t1 WHERE c1 &gt; 2');
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
                <code class="literal">STATEMENT_DIGEST_TEXT()</code> SQL 関数を使用して、ファイアウォールコンテキストの外部で同じダイジェスト機能を使用できます。
              </p></div></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-system-variables"></a>MySQL Enterprise Firewall システム変数</h5></div></div></div><p>
          MySQL Enterprise Firewall は、次のシステム変数をサポートしています。 これらを使用してファイアウォール操作を構成します。 これらの変数は、ファイアウォールがインストールされていないかぎり使用できません (<a class="xref" href="security.html#firewall-installation" title="6.4.7.2 MySQL Enterprise Firewall のインストールまたはアンインストール">セクション6.4.7.2「MySQL Enterprise Firewall のインストールまたはアンインストール」</a> を参照)。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_mysql_firewall_mode"></a>
              <code class="literal">mysql_firewall_mode</code>
            </p><a class="indexterm" name="idm46723748860480"></a><a class="indexterm" name="idm46723748858928"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for mysql_firewall_mode"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--mysql-firewall-mode[={OFF|ON}]</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_mysql_firewall_mode">mysql_firewall_mode</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">ON</code></td>
</tr></tbody></table></div><p>
              MySQL Enterprise Firewall が有効 (デフォルト) か無効か。
            </p></li><li class="listitem"><p><a name="sysvar_mysql_firewall_trace"></a>
              <code class="literal">mysql_firewall_trace</code>
            </p><a class="indexterm" name="idm46723748834288"></a><a class="indexterm" name="idm46723748832736"></a><div class="informaltable"><table frame="box" rules="all" summary="Properties for mysql_firewall_trace"><col style="width=30%"><col style="width=70%"><tbody><tr><th>コマンド行形式</th>
<td><code class="literal">--mysql-firewall-trace[={OFF|ON}]</code></td>
</tr><tr><th>システム変数</th>
<td><code class="literal"><a class="link" href="security.html#sysvar_mysql_firewall_trace">mysql_firewall_trace</a></code></td>
</tr><tr><th>スコープ</th>
<td>グローバル</td>
</tr><tr><th>動的</th>
<td>はい</td>
</tr><tr><th><code class="literal">SET_VAR</code> ヒントの適用</th>
<td>いいえ</td>
</tr><tr><th>型</th>
<td>Boolean</td>
</tr><tr><th>デフォルト値</th>
<td><code class="literal">OFF</code></td>
</tr></tbody></table></div><p>
              MySQL Enterprise Firewall トレースが有効か無効か (デフォルト)。 <code class="literal">mysql_firewall_trace</code> が有効な場合、<code class="literal">PROTECTING</code> モードでは、ファイアウォールは拒否されたステートメントをエラーログに書き込みます。 
            </p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="firewall-status-variables"></a>MySQL Enterprise Firewall ステータス変数</h5></div></div></div><p>
          MySQL Enterprise Firewall では、次のステータス変数がサポートされます。 これらを使用して、ファイアウォールの操作ステータスに関する情報を取得します。 これらの変数は、ファイアウォールがインストールされていないかぎり使用できません (<a class="xref" href="security.html#firewall-installation" title="6.4.7.2 MySQL Enterprise Firewall のインストールまたはアンインストール">セクション6.4.7.2「MySQL Enterprise Firewall のインストールまたはアンインストール」</a> を参照)。 <code class="literal">MYSQL_FIREWALL</code> プラグインがインストールされるか、サーバーが起動されるたびに、ファイアウォールステータス変数は 0 に設定されます。 これらの多くは、<code class="literal">mysql_firewall_flush_status()</code> UDF によってゼロにリセットされます (<a class="xref" href="security.html#firewall-functions" title="MySQL Enterprise Firewall のユーザー定義関数">MySQL Enterprise Firewall のユーザー定義関数</a> を参照)。 
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Firewall_access_denied"></a>
              <code class="literal">Firewall_access_denied</code>
            </p><a class="indexterm" name="idm46723748799712"></a><a class="indexterm" name="idm46723748798144"></a><p>
              MySQL Enterprise Firewall によって拒否されたステートメントの数。
            </p></li><li class="listitem"><p><a name="statvar_Firewall_access_granted"></a>
              <code class="literal">Firewall_access_granted</code>
            </p><a class="indexterm" name="idm46723748793392"></a><a class="indexterm" name="idm46723748791824"></a><p>
              MySQL Enterprise Firewall で受け入れられるステートメントの数。
            </p></li><li class="listitem"><p><a name="statvar_Firewall_access_suspicious"></a>
              <code class="literal">Firewall_access_suspicious</code>
            </p><a class="indexterm" name="idm46723748787056"></a><a class="indexterm" name="idm46723748785488"></a><p>
              <code class="literal">DETECTING</code> モードのユーザーの疑わしいステートメントとして MySQL Enterprise Firewall によって記録されたステートメントの数。
            </p></li><li class="listitem"><p><a name="statvar_Firewall_cached_entries"></a>
              <code class="literal">Firewall_cached_entries</code>
            </p><a class="indexterm" name="idm46723748779856"></a><a class="indexterm" name="idm46723748778288"></a><p>
              MySQL Enterprise Firewall によって記録されたステートメントの数 (重複を含む)。
            </p></li></ul></div></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-masking"></a>6.5 MySQL Enterprise Data Masking and De-Identification</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#data-masking-elements">6.5.1 MySQL Enterprise Data Masking and De-Identification 要素</a></span></dt><dt><span class="section"><a href="security.html#data-masking-installation">6.5.2 MySQL Enterprise Data Masking and De-Identification のインストールまたはアンインストール</a></span></dt><dt><span class="section"><a href="security.html#data-masking-usage">6.5.3 MySQL Enterprise Data Masking and De-Identification の使用</a></span></dt><dt><span class="section"><a href="security.html#data-masking-function-reference">6.5.4 MySQL Enterprise Data Masking and De-Identification ユーザー定義関数リファレンス</a></span></dt><dt><span class="section"><a href="security.html#data-masking-functions">6.5.5 MySQL Enterprise Data Masking and De-Identification ユーザー定義関数の説明</a></span></dt></dl></div><a class="indexterm" name="idm46723748773808"></a><a class="indexterm" name="idm46723748772688"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
      MySQL Enterprise Data Masking and De-Identification は、商用製品である MySQL Enterprise Edition に含まれる拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
    </p></div><p>
    MySQL 8.0.13 では、MySQL Enterprise Edition はデータマスキングおよび識別解除機能を提供します:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        クレジットカード番号の最後の 4 桁を<code class="literal">'X'</code>文字に変更するなど、既存のデータをマスクして識別特性を削除するための変換。
      </p></li><li class="listitem"><p>
        E メールアドレスや支払カード番号などのランダムデータの生成。
      </p></li></ul></div><p>
    アプリケーションでこれらの機能を使用する方法は、データが使用される目的およびデータにアクセスするユーザーによって異なります:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        機密データを使用するアプリケーションは、データマスキングを実行し、部分的にマスクされたデータをクライアント識別に使用できるようにすることで、機密データを保護できます。 例: コールセンターは、最後の 4 桁の社会保障番号を提供するようクライアントに要求する場合があります。 
      </p></li><li class="listitem"><p>
        適切にフォーマットされたデータを必要とするが、必ずしも元のデータを必要としないアプリケーションでは、サンプルデータを合成できます。 例: データバリデータをテストしているが、元のデータにアクセスできないアプリケーション開発者は、ランダムデータを同じ形式で合成できます。 
      </p></li></ul></div><p>
    例 1:
  </p><p>
    医療研究施設は，個人データと医療データの混合を含む患者データを保持できます。 これには、遺伝的順序 (長い文字列)、JSON 形式で格納されたテスト結果およびその他のデータ型が含まれます。 ほとんどの場合、データは自動分析ソフトウェアで使用できますが、特定の患者のゲノムデータまたはテスト結果へのアクセスは可能です。 このような場合は、データマスキングを使用して、個人を識別できないこの情報をレンダリングする必要があります。 
  </p><p>
    例 2:
  </p><p>
    クレジットカードプロセッサ会社は、次のような機密データを使用して一連のサービスを提供します:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        1 秒当たりの多数の財務トランザクションの処理。
      </p></li><li class="listitem"><p>
        大量のトランザクション関連データの格納。
      </p></li><li class="listitem"><p>
        個人データの厳格な要件によるトランザクション関連データの保護。
      </p></li><li class="listitem"><p>
        可逆または部分的にマスクされたデータを使用したトランザクションに関するクライアントの苦情を処理します。
      </p></li></ul></div><p>
    一般的なトランザクションには、次のような多くのタイプの機密情報が含まれる場合があります:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        クレジットカード番号。
      </p></li><li class="listitem"><p>
        トランザクションタイプおよび金額。
      </p></li><li class="listitem"><p>
        業者タイプ。
      </p></li><li class="listitem"><p>
        トランザクション暗号化 (トランザクション正当性を確認するため)。
      </p></li><li class="listitem"><p>
        GPS 対応端末の地理的位置 (不正検出用)。
      </p></li></ul></div><p>
    これらのタイプの情報は、銀行またはその他のカード発行金融機関内で、次のようなクライアント個人データと結合できます:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        完全なクライアント名 (個人または会社)。
      </p></li><li class="listitem"><p>
        Address.
      </p></li><li class="listitem"><p>
        生年月日。
      </p></li><li class="listitem"><p>
        社会保障番号。
      </p></li><li class="listitem"><p>
        電子メールアドレス。
      </p></li><li class="listitem"><p>
        電話番号。
      </p></li></ul></div><p>
    カード処理会社と金融機関の両方で様々な従業員ロールを使用するには、そのデータにアクセスする必要があります。 これらのロールの中には、マスキングされたデータへのアクセスのみを必要とするものがあります。 他のロールでは、ケースごとに元のデータへのアクセスが必要になる場合があります。このデータは監査ログに記録されます。 
  </p><p>
    マスキングおよび識別解除は規制コンプライアンスの中核となるため、MySQL Enterprise Data Masking and De-Identification はアプリケーション開発者がプライバシ要件を満たすのに役立ちます:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        PCI - DSS: 支払カードデータ。
      </p></li><li class="listitem"><p>
        HIPAA: 医療データのプライバシー、経済臨床医療法 (HITECH 法) の健康情報技術。
      </p></li><li class="listitem"><p>
        EU 一般データ保護ディレクティブ (GDPR): 個人データの保護。
      </p></li><li class="listitem"><p>
        データ保護法 (英国): 個人データの保護。
      </p></li><li class="listitem"><p>
        Sarbanes Oxley、GLBA、The USA Patriot Act、Identity Theft and Assumption Deterrence Act of 1998。
      </p></li><li class="listitem"><p>
        FERPA - Student Data、NASD、CA SB1386 および AB 1950、State Data Protection Laws、Basel II。
      </p></li></ul></div><p>
    次の各セクションでは、MySQL Enterprise Data Masking and De-Identification の要素について説明し、それをインストールおよび使用する方法を説明し、その要素のリファレンス情報を提供します。
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="data-masking-elements"></a>6.5.1 MySQL Enterprise Data Masking and De-Identification 要素</h3></div></div></div><a class="indexterm" name="idm46723748731136"></a><p>
      MySQL Enterprise Data Masking and De-Identification は、次の要素を実装するプラグインライブラリに基づいています:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">data_masking</code> という名前のサーバー側プラグイン。
        </p></li><li class="listitem"><p>
          一連のユーザー定義関数 (UDF) は、マスキングおよび識別解除操作を実行するための SQL レベルの API を提供します。 これらの関数の中には、<code class="literal">SUPER</code> 権限を必要とするものがあります。 
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="data-masking-installation"></a>6.5.2 MySQL Enterprise Data Masking and De-Identification のインストールまたはアンインストール</h3></div></div></div><a class="indexterm" name="idm46723748722720"></a><a class="indexterm" name="idm46723748720592"></a><a class="indexterm" name="idm46723748718496"></a><a class="indexterm" name="idm46723748716400"></a><p>
      このセクションでは、プラグインおよびユーザー定義関数 (UDF) を含むプラグインライブラリファイルとして実装される MySQL Enterprise Data Masking and De-Identification をインストールまたはアンインストールする方法について説明します。 プラグインおよび UDF のインストールまたはアンインストールの一般情報は、<a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 プラグインのインストールおよびアンインストール">セクション5.6.1「プラグインのインストールおよびアンインストール」</a> および <a class="xref" href="server-administration.html#function-loading" title="5.7.1 ユーザー定義関数のインストールおよびアンインストール">セクション5.7.1「ユーザー定義関数のインストールおよびアンインストール」</a> を参照してください。 
    </p><p>
      サーバーで使用できるようにするには、プラグインライブラリファイルを MySQL プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) に配置する必要があります。 必要に応じて、サーバーの起動時に <code class="literal">plugin_dir</code> の値を設定してプラグインディレクトリの場所を構成します。 
    </p><p>
      プラグインライブラリファイルのベース名は <code class="literal">data_masking</code> です。 ファイル名の接尾辞は、プラットフォームごとに異なります (たとえば、<code class="filename">.so</code> for Unix and Unix-like systems, <code class="filename">.dll</code> for Windows)。 
    </p><p>
      MySQL Enterprise Data Masking and De-Identification プラグインおよび UDF をインストールするには、必要に応じてプラットフォームの <code class="filename">.so</code> 接尾辞を調整して、<code class="literal">INSTALL PLUGIN</code> および <code class="literal">CREATE FUNCTION</code> ステートメントを使用します:
    </p><pre class="programlisting">INSTALL PLUGIN data_masking SONAME 'data_masking.so';
CREATE FUNCTION gen_blocklist RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION gen_dictionary RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION gen_dictionary_drop RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION gen_dictionary_load RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION gen_range RETURNS INTEGER
SONAME 'data_masking.so';
CREATE FUNCTION gen_rnd_email RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION gen_rnd_pan RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION gen_rnd_ssn RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION gen_rnd_us_phone RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION mask_inner RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION mask_outer RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION mask_pan RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION mask_pan_relaxed RETURNS STRING
SONAME 'data_masking.so';
CREATE FUNCTION mask_ssn RETURNS STRING
SONAME 'data_masking.so';
</pre><p>
      プラグインおよび UDF がソースレプリケーションサーバーで使用されている場合は、レプリケーションの問題を回避するために、それらをすべてのレプリカサーバーにインストールします。
    </p><p>
      前述のようにインストールすると、プラグインと UDF はアンインストールされるまでインストールされたままになります。 これらを削除するには、<code class="literal">UNINSTALL PLUGIN</code> および <code class="literal">DROP FUNCTION</code> ステートメントを使用します: 
    </p><pre class="programlisting">UNINSTALL PLUGIN data_masking;
DROP FUNCTION gen_blocklist;
DROP FUNCTION gen_dictionary;
DROP FUNCTION gen_dictionary_drop;
DROP FUNCTION gen_dictionary_load;
DROP FUNCTION gen_range;
DROP FUNCTION gen_rnd_email;
DROP FUNCTION gen_rnd_pan;
DROP FUNCTION gen_rnd_ssn;
DROP FUNCTION gen_rnd_us_phone;
DROP FUNCTION mask_inner;
DROP FUNCTION mask_outer;
DROP FUNCTION mask_pan;
DROP FUNCTION mask_pan_relaxed;
DROP FUNCTION mask_ssn;
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="data-masking-usage"></a>6.5.3 MySQL Enterprise Data Masking and De-Identification の使用</h3></div></div></div><p>
      MySQL Enterprise Data Masking and De-Identification を使用する前に、<a class="xref" href="security.html#data-masking-installation" title="6.5.2 MySQL Enterprise Data Masking and De-Identification のインストールまたはアンインストール">セクション6.5.2「MySQL Enterprise Data Masking and De-Identification のインストールまたはアンインストール」</a> に記載されている手順に従ってインストールします。
    </p><p>
      アプリケーションで MySQL Enterprise Data Masking and De-Identification を使用するには、実行する操作に適した関数を呼び出します。 関数の詳細は、<a class="xref" href="security.html#data-masking-functions" title="6.5.5 MySQL Enterprise Data Masking and De-Identification ユーザー定義関数の説明">セクション6.5.5「MySQL Enterprise Data Masking and De-Identification ユーザー定義関数の説明」</a> を参照してください。 このセクションでは、関数を使用して代表的なタスクを実行する方法を示します。 最初に、使用可能な関数の概要を示し、次にその関数を実際のコンテキストで使用する方法の例をいくつか示します: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-masking-functions" title="識別特性を削除するためのデータのマスキング">識別特性を削除するためのデータのマスキング</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-generation-functions" title="特定の特性を持つランダムデータの生成">特定の特性を持つランダムデータの生成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-dictionary-functions" title="ディクショナリを使用したランダムデータの生成">ディクショナリを使用したランダムデータの生成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-customer-identification" title="顧客識別のためのマスクされたデータの使用">顧客識別のためのマスクされたデータの使用</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-views" title="マスクされたデータを表示するビューの作成">マスクされたデータを表示するビューの作成</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="data-masking-usage-masking-functions"></a>識別特性を削除するためのデータのマスキング</h4></div></div></div><p>
        MySQL には、任意の文字列をマスキングする汎用マスキング関数と、特定のタイプの値をマスキングする特別な目的のマスキング関数が用意されています。
      </p><h5><a name="idm46723748681264"></a>汎用マスキング関数</h5><p>
        <code class="literal">mask_inner()</code> および <code class="literal">mask_outer()</code> は、文字列内の位置に基づいて任意の文字列の一部をマスクする汎用関数です:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mask_inner()</code> は、その文字列引数の内部をマスクし、末尾はマスクされないままにします。 その他の引数は、マスクされていない端のサイズを指定します。 
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_inner('This is a string', 5, 1);</code></strong>
+--------------------------------------+
| mask_inner('This is a string', 5, 1) |
+--------------------------------------+
| This XXXXXXXXXXg                     |
+--------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_inner('This is a string', 1, 5);</code></strong>
+--------------------------------------+
| mask_inner('This is a string', 1, 5) |
+--------------------------------------+
| TXXXXXXXXXXtring                     |
+--------------------------------------+
</pre></li><li class="listitem"><p>
            <code class="literal">mask_outer()</code> は逆の処理を行い、文字列引数の終わりをマスキングして、内部をマスクしないままにします。 その他の引数は、マスクされた端のサイズを指定します。 
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_outer('This is a string', 5, 1);</code></strong>
+--------------------------------------+
| mask_outer('This is a string', 5, 1) |
+--------------------------------------+
| XXXXXis a strinX                     |
+--------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_outer('This is a string', 1, 5);</code></strong>
+--------------------------------------+
| mask_outer('This is a string', 1, 5) |
+--------------------------------------+
| Xhis is a sXXXXX                     |
+--------------------------------------+
</pre></li></ul></div><p>
        デフォルトでは、<code class="literal">mask_inner()</code> および <code class="literal">mask_outer()</code> はマスキング文字として<code class="literal">'X'</code>を使用しますが、オプションのマスキング文字引数を使用できます:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_inner('This is a string', 5, 1, '*');</code></strong>
+-------------------------------------------+
| mask_inner('This is a string', 5, 1, '*') |
+-------------------------------------------+
| This **********g                          |
+-------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_outer('This is a string', 5, 1, '#');</code></strong>
+-------------------------------------------+
| mask_outer('This is a string', 5, 1, '#') |
+-------------------------------------------+
| #####is a strin#                          |
+-------------------------------------------+
</pre><h5><a name="idm46723748661280"></a>特殊用途マスキング関数</h5><p>
        その他のマスキング関数では、特定のタイプの値を表す文字列引数を想定し、それをマスクして識別特性を削除します。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          この例では、適切なタイプの値を返すランダム値生成関数を使用して関数の引数を指定します。 生成関数の詳細は、<a class="xref" href="security.html#data-masking-usage-generation-functions" title="特定の特性を持つランダムデータの生成">特定の特性を持つランダムデータの生成</a> を参照してください。 
        </p></div><p><b>支払カードプライマリアカウント番号マスキング. </b>
          マスキング機能は、主要アカウント番号の厳密で緩和されたマスキングを提供します。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">mask_pan()</code> は、数値の最後の 4 桁を除くすべての桁をマスクします:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan());</code></strong>
+-------------------------+
| mask_pan(gen_rnd_pan()) |
+-------------------------+
| XXXXXXXXXXXX2461        |
+-------------------------+
</pre></li><li class="listitem"><p>
            <code class="literal">mask_pan_relaxed()</code> は似ていますが、支払カード会社のマスクが解除されたことを示す最初の 6 桁はマスクされません:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan());</code></strong>
+---------------------------------+
| mask_pan_relaxed(gen_rnd_pan()) |
+---------------------------------+
| 770630XXXXXX0807                |
+---------------------------------+
</pre></li></ul></div><p><b>US 社会保障番号マスキング. </b>
          <code class="literal">mask_ssn()</code> は、数値の最後の 4 桁を除くすべての桁をマスクします:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_ssn(gen_rnd_ssn());</code></strong>
+-------------------------+
| mask_ssn(gen_rnd_ssn()) |
+-------------------------+
| XXX-XX-1723             |
+-------------------------+
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="data-masking-usage-generation-functions"></a>特定の特性を持つランダムデータの生成</h4></div></div></div><p>
        いくつかの関数でランダム値が生成されます。 これらの値は、テストやシミュレーションなどに使用できます。 
      </p><p>
        <code class="literal">gen_range()</code> は、指定された範囲から選択されたランダムな整数を返します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_range(1, 10);</code></strong>
+------------------+
| gen_range(1, 10) |
+------------------+
|                6 |
+------------------+
</pre><p>
        <code class="literal">gen_rnd_email()</code> は、<code class="literal">example.com</code> ドメインでランダムな電子メールアドレスを返します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_email();</code></strong>
+---------------------------+
| gen_rnd_email()           |
+---------------------------+
| ayxnq.xmkpvvy@example.com |
+---------------------------+
</pre><p>
        <code class="literal">gen_rnd_pan()</code> は、ランダムな支払カード主要アカウント番号を返します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_pan();</code></strong>
</pre><p>
        (戻り値は公開ではなくテスト目的でのみ使用する必要があるため、<code class="literal">gen_rnd_pan()</code> 関数の結果は表示されません。 番号が正当な支払アカウントに割り当てられていないことを保証できません。) 
      </p><p>
        <code class="literal">gen_rnd_ssn()</code> はランダムな US 社会保障番号を返し、それぞれ正当な番号に使用されていない範囲から選択された最初と 2 番目の部分が含まれます:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_ssn();</code></strong>
+---------------+
| gen_rnd_ssn() |
+---------------+
| 912-45-1615   |
+---------------+
</pre><p>
        <code class="literal">gen_rnd_us_phone()</code> は、正当な番号に使用されていない 555 市外局番でランダムな米国電話番号を返します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_us_phone();</code></strong>
+--------------------+
| gen_rnd_us_phone() |
+--------------------+
| 1-555-747-5627     |
+--------------------+
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="data-masking-usage-dictionary-functions"></a>ディクショナリを使用したランダムデータの生成</h4></div></div></div><p>
        MySQL Enterprise Data Masking and De-Identification では、ディクショナリをランダム値のソースとして使用できます。 ディクショナリを使用するには、最初にファイルからロードし、名前を指定する必要があります。 ロードされた各ディクショナリは、ディクショナリレジストリの一部になります。 その後、登録済ディクショナリからアイテムを選択し、ランダム値または他の値の置換として使用できます。 
      </p><p>
        有効なディクショナリファイルには、次の特性があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            ファイルの内容はプレーンテキストで、1 行につき 1 語です。
          </p></li><li class="listitem"><p>
            空の行は無視されます。
          </p></li><li class="listitem"><p>
            ファイルには少なくとも 1 つの用語が含まれている必要があります。
          </p></li></ul></div><p>
        <code class="filename">de_cities.txt</code> という名前のファイルにドイツの次の市区町村名が含まれているとします:
      </p><pre class="programlisting">Berlin
Munich
Bremen
</pre><p>
        また、<code class="filename">us_cities.txt</code> という名前のファイルに米国の次の市区町村名が含まれているとします:
      </p><pre class="programlisting">Chicago
Houston
Phoenix
El Paso
Detroit
</pre><p>
        <code class="literal">secure_file_priv</code> システム変数が<code class="filename">/usr/local/mysql/mysql-files</code> に設定されているとします。 その場合は、MySQL サーバーがアクセスできるように、ディクショナリファイルをそのディレクトリにコピーします。 次に、<code class="literal">gen_dictionary_load()</code> を使用してディクショナリをディクショナリレジストリにロードし、ディクショナリに名前を割り当てます: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_load('/usr/local/mysql/mysql-files/de_cities.txt', 'DE_Cities');</code></strong>
+--------------------------------------------------------------------------------+
| gen_dictionary_load('/usr/local/mysql/mysql-files/de_cities.txt', 'DE_Cities') |
+--------------------------------------------------------------------------------+
| Dictionary load success                                                        |
+--------------------------------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_load('/usr/local/mysql/mysql-files/us_cities.txt', 'US_Cities');</code></strong>
+--------------------------------------------------------------------------------+
| gen_dictionary_load('/usr/local/mysql/mysql-files/us_cities.txt', 'US_Cities') |
+--------------------------------------------------------------------------------+
| Dictionary load success                                                        |
+--------------------------------------------------------------------------------+
</pre><p>
        ディクショナリからランダムな用語を選択するには、<code class="literal">gen_dictionary()</code> を使用します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary('DE_Cities');</code></strong>
+-----------------------------+
| gen_dictionary('DE_Cities') |
+-----------------------------+
| Berlin                      |
+-----------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary('US_Cities');</code></strong>
+-----------------------------+
| gen_dictionary('US_Cities') |
+-----------------------------+
| Phoenix                     |
+-----------------------------+
</pre><p>
        複数のディクショナリからランダムな用語を選択するには、いずれかのディクショナリをランダムに選択し、そこから用語を選択します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary(ELT(gen_range(1,2), 'DE_Cities', 'US_Cities'));</code></strong>
+---------------------------------------------------------------+
| gen_dictionary(ELT(gen_range(1,2), 'DE_Cities', 'US_Cities')) |
+---------------------------------------------------------------+
| Detroit                                                       |
+---------------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary(ELT(gen_range(1,2), 'DE_Cities', 'US_Cities'));</code></strong>
+---------------------------------------------------------------+
| gen_dictionary(ELT(gen_range(1,2), 'DE_Cities', 'US_Cities')) |
+---------------------------------------------------------------+
| Bremen                                                        |
+---------------------------------------------------------------+
</pre><p>
        <code class="literal">gen_blocklist()</code> 関数を使用すると、あるディクショナリの用語を別のディクショナリの用語に置き換えることができ、置換によるマスキングに影響します。 引数は、置換する用語、用語が表示されるディクショナリおよび置換を選択するディクショナリです。 たとえば、米国の市をドイツの市に、またはその逆に置き換えるには、次のように <code class="literal">gen_blocklist()</code> を使用します: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_blocklist('Munich', 'DE_Cities', 'US_Cities');</code></strong>
+---------------------------------------------------+
| gen_blocklist('Munich', 'DE_Cities', 'US_Cities') |
+---------------------------------------------------+
| Houston                                           |
+---------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_blocklist('El Paso', 'US_Cities', 'DE_Cities');</code></strong>
+----------------------------------------------------+
| gen_blocklist('El Paso', 'US_Cities', 'DE_Cities') |
+----------------------------------------------------+
| Bremen                                             |
+----------------------------------------------------+
</pre><p>
        置換する用語が最初のディクショナリにない場合、<code class="literal">gen_blocklist()</code> はそれを変更せずに戻します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_blocklist('Moscow', 'DE_Cities', 'US_Cities');</code></strong>
+---------------------------------------------------+
| gen_blocklist('Moscow', 'DE_Cities', 'US_Cities') |
+---------------------------------------------------+
| Moscow                                            |
+---------------------------------------------------+
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="data-masking-usage-customer-identification"></a>顧客識別のためのマスクされたデータの使用</h4></div></div></div><p>
        カスタマサービスコールセンターでは、一般的なアイデンティティ検証手法として、顧客に最後の 4 桁の社会保障番号 (SSN) を提供するように依頼します。 たとえば、顧客の名前が Joanna Bond で、最後の 4 桁の SSN が <code class="literal">0007</code> であるとします。 
      </p><p>
        顧客レコードを含む <code class="literal">customer</code> テーブルに次のカラムがあるとします:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">id</code>: 顧客 ID 番号。
          </p></li><li class="listitem"><p>
            <code class="literal">first_name</code>: 顧客の名。
          </p></li><li class="listitem"><p>
            <code class="literal">last_name</code>: 顧客の姓。
          </p></li><li class="listitem"><p>
            <code class="literal">ssn</code>: 顧客社会保障番号。
          </p></li></ul></div><p>
        たとえば、テーブルは次のように定義できます:
      </p><pre class="programlisting">CREATE TABLE customer
(
id         BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
first_name VARCHAR(40),
last_name  VARCHAR(40),
ssn        VARCHAR(11)
);
</pre><p>
        顧客サービス担当者が顧客 SSN をチェックするために使用するアプリケーションは、次のようなクエリーを実行します:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT id, ssn</code></strong>
mysql&gt; <strong class="userinput"><code>FROM customer</code></strong>
mysql&gt; <strong class="userinput"><code>WHERE first_name = 'Joanna' AND last_name = 'Bond';</code></strong>
+-----+-------------+
| id  | ssn         |
+-----+-------------+
| 786 | 906-39-0007 |
+-----+-------------+
</pre><p>
        ただし、は SSN をカスタマーサービス担当者に公開します。カスタマーサービス担当者は、最後の 4 桁以外を表示する必要はありません。 かわりに、アプリケーションは次のクエリーを使用して、マスクされた SSN のみを表示できます: 
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT id, mask_ssn(CONVERT(ssn USING binary)) AS masked_ssn</code></strong>
mysql&gt; <strong class="userinput"><code>FROM customer</code></strong>
mysql&gt; <strong class="userinput"><code>WHERE first_name = 'Joanna' AND last_name = 'Bond';</code></strong>
+-----+-------------+
| id  | masked_ssn  |
+-----+-------------+
| 786 | XXX-XX-0007 |
+-----+-------------+
</pre><p>
        これで、担当者には必要なもののみが表示され、お客様のプライバシーは保持されます。
      </p><p>
        <code class="literal">mask_ssn()</code> への引数に <code class="literal">CONVERT()</code> 関数が使用されたのはなぜですか。 <code class="literal">mask_ssn()</code> には長さ 11 の引数が必要であるためです。 したがって、<code class="literal">ssn</code> が <code class="literal">VARCHAR(11)</code> として定義されている場合でも、<code class="literal">ssn</code> カラムにマルチバイト文字セットが含まれていると、UDF に渡されたときに 11 バイトを超える可能性があり、エラーが発生します。 値をバイナリ文字列に変換すると、UDF に長さ 11 の引数が表示されます。 
      </p><p>
        文字列引数にシングルバイト文字セットがない場合は、他のデータマスキング関数でも同様の方法が必要になることがあります。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="data-masking-usage-views"></a>マスクされたデータを表示するビューの作成</h4></div></div></div><p>
        テーブルのマスキングされたデータが複数のクエリーに使用される場合、マスキングされたデータを生成するビューを定義すると便利です。 これにより、アプリケーションは個々のクエリーでマスキングを実行せずにビューから選択できます。 
      </p><p>
        たとえば、前のセクションの <code class="literal">customer</code> テーブルのマスキングビューは、次のように定義できます:
      </p><pre class="programlisting">CREATE VIEW masked_customer AS
SELECT id, first_name, last_name,
mask_ssn(CONVERT(ssn USING binary)) AS masked_ssn
FROM customer;
</pre><p>
        その後、顧客を検索するクエリーは単純になりますが、マスキングされたデータは返されます:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT id, masked_ssn</code></strong>
mysql&gt; <strong class="userinput"><code>FROM masked_customer</code></strong>
mysql&gt; <strong class="userinput"><code>WHERE first_name = 'Joanna' AND last_name = 'Bond';</code></strong>
+-----+-------------+
| id  | masked_ssn  |
+-----+-------------+
| 786 | XXX-XX-0007 |
+-----+-------------+
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="data-masking-function-reference"></a>6.5.4 MySQL Enterprise Data Masking and De-Identification ユーザー定義関数リファレンス</h3></div></div></div><div class="table"><a name="idm46723748547056"></a><p class="title"><b>表 6.38 「MySQL Enterprise Data Masking and De-Identification のユーザー定義関数」</b></p><div class="table-contents"><table frame="box" rules="all" summary="「MySQL Enterprise Data Masking and De-Identification のユーザー定義関数をリストする参照。」"><col style="width=22%"><col style="width=55%"><col style="width=11%"><col style="width=11%"><thead><tr><th>名前</th>
<th>説明</th>
<th>導入</th>
<th>非推奨</th>
</tr></thead><tbody><tr><th scope="row"><a class="link" href="security.html#function_gen-blacklist"><code class="literal">gen_blacklist()</code></a></th>
<td>
      辞書用語置換の実行
    </td>
<td></td>
<td>8.0.23</td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-blocklist"><code class="literal">gen_blocklist()</code></a></th>
<td>
      辞書用語置換の実行
    </td>
<td>8.0.23</td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-dictionary"><code class="literal">gen_dictionary()</code></a></th>
<td>
      辞書からランダムな用語を返します
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-dictionary-drop"><code class="literal">gen_dictionary_drop()</code></a></th>
<td>
      レジストリからディクショナリを削除
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-dictionary-load"><code class="literal">gen_dictionary_load()</code></a></th>
<td>
      ディクショナリをレジストリにロード
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-range"><code class="literal">gen_range()</code></a></th>
<td>
      範囲内の乱数を生成
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-rnd-email"><code class="literal">gen_rnd_email()</code></a></th>
<td>
      ランダムな電子メールアドレスの生成
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-rnd-pan"><code class="literal">gen_rnd_pan()</code></a></th>
<td>
      ランダム支払カードプライマリアカウント番号の生成
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-rnd-ssn"><code class="literal">gen_rnd_ssn()</code></a></th>
<td>
      ランダム US 社会保障番号の生成
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_gen-rnd-us-phone"><code class="literal">gen_rnd_us_phone()</code></a></th>
<td>
      ランダムな米国電話番号の生成
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_mask-inner"><code class="literal">mask_inner()</code></a></th>
<td>
      文字列の内部部分のマスク
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_mask-outer"><code class="literal">mask_outer()</code></a></th>
<td>
      文字列の左右の部分をマスク
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_mask-pan"><code class="literal">mask_pan()</code></a></th>
<td>
      文字列の支払カードプライマリアカウント番号部分のマスク
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_mask-pan-relaxed"><code class="literal">mask_pan_relaxed()</code></a></th>
<td>
      文字列の支払カードプライマリアカウント番号部分のマスク
    </td>
<td></td>
<td></td>
</tr><tr><th scope="row"><a class="link" href="security.html#function_mask-ssn"><code class="literal">mask_ssn()</code></a></th>
<td>
      US 社会保障番号のマスク
    </td>
<td></td>
<td></td>
</tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="data-masking-functions"></a>6.5.5 MySQL Enterprise Data Masking and De-Identification ユーザー定義関数の説明</h3></div></div></div><p>
      MySQL Enterprise Data Masking and De-Identification プラグインライブラリには、次のカテゴリにグループ化できるいくつかのユーザー定義関数 (UDF) が含まれています:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#data-masking-masking-functions" title="データマスキング関数">データマスキング関数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-generation-functions" title="ランダムデータ生成関数">ランダムデータ生成関数</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-dictionary-functions" title="ランダムデータディクショナリビューの関数">ランダムデータディクショナリビューの関数</a></p></li></ul></div><p>
      MySQL 8.0.19 では、これらの UDF は文字列引数および戻り値のシングルバイト <code class="literal">latin1</code> 文字セットをサポートしています。 MySQL 8.0.19 より前では、UDF は文字列引数をバイナリ文字列として扱い (大文字と小文字を区別しない)、文字列の戻り値はバイナリ文字列です。 戻り値の文字セットの違いは、次のとおりです: 
    </p><p>
      MySQL 8.0.19 以上:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT CHARSET(gen_rnd_email());</code></strong>
+--------------------------+
| CHARSET(gen_rnd_email()) |
+--------------------------+
| latin1                   |
+--------------------------+
</pre><p>
      MySQL 8.0.19 より前:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT CHARSET(gen_rnd_email());</code></strong>
+--------------------------+
| CHARSET(gen_rnd_email()) |
+--------------------------+
| binary                   |
+--------------------------+
</pre><p>
      いずれのバージョンでも、文字列の戻り値を別の文字セットにする必要がある場合は、変換します。 次の例は、<code class="literal">gen_rnd_email()</code> の結果を <code class="literal">utf8mb4</code> 文字セットに変換する方法を示しています: 
    </p><pre class="programlisting">SET @email = CONVERT(gen_rnd_email() USING utf8mb4);
</pre><p>
      <a class="xref" href="security.html#data-masking-usage-customer-identification" title="顧客識別のためのマスクされたデータの使用">顧客識別のためのマスクされたデータの使用</a> に示されているように、文字列引数の変換が必要になる場合もあります。
    </p><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="data-masking-masking-functions"></a>データマスキング関数</h4></div></div></div><p>
        このセクションの各関数は、文字列引数に対してマスキング操作を実行し、マスキングされた結果を返します。
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_mask-inner"></a>
            <code class="literal">mask_inner(<em class="replaceable"><code>str</code></em>, <em class="replaceable"><code>margin1</code></em>, <em class="replaceable"><code>margin2</code></em> [, <em class="replaceable"><code>mask_char</code></em>])</code>
          </p><a class="indexterm" name="idm46723748440224"></a><a class="indexterm" name="idm46723748438784"></a><p>
            文字列の内部部分をマスクし、末尾はそのままにして、結果を返します。 オプションのマスキング文字を指定できます。 
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>str</code></em>: マスクする文字列。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>margin1</code></em>: マスクされないままにする文字列の左端の文字数を指定する負でない整数。 値が 0 の場合、左の終了文字はマスクされません。 
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>margin2</code></em>: マスクされないままにする文字列の右端の文字数を指定する負でない整数。 値が 0 の場合、右側の終了文字はマスクされません。 
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>mask_char</code></em>: (オプション) マスキングに使用する単一の文字。 <em class="replaceable"><code>mask_char</code></em> が指定されていない場合、デフォルトは<code class="literal">'X'</code>です。 
              </p><p>
                マスキング文字はシングルバイト文字である必要があります。 マルチバイト文字を使用しようとすると、エラーが発生します。 
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            マスクされた文字列。いずれかのマージンが負の場合は <code class="literal">NULL</code>。
          </p><p>
            マージン値の合計が引数の長さより大きい場合、マスキングは行われず、引数は変更されずに返されます。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_inner('abcdef', 1, 2), mask_inner('abcdef',0, 5);</code></strong>
+----------------------------+---------------------------+
| mask_inner('abcdef', 1, 2) | mask_inner('abcdef',0, 5) |
+----------------------------+---------------------------+
| aXXXef                     | Xbcdef                    |
+----------------------------+---------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_inner('abcdef', 1, 2, '*'), mask_inner('abcdef',0, 5, '#');</code></strong>
+---------------------------------+--------------------------------+
| mask_inner('abcdef', 1, 2, '*') | mask_inner('abcdef',0, 5, '#') |
+---------------------------------+--------------------------------+
| a***ef                          | #bcdef                         |
+---------------------------------+--------------------------------+
</pre></li><li class="listitem"><p><a name="function_mask-outer"></a>
            <code class="literal">mask_outer(<em class="replaceable"><code>str</code></em>, <em class="replaceable"><code>margin1</code></em>, <em class="replaceable"><code>margin2</code></em> [, <em class="replaceable"><code>mask_char</code></em>])</code>
          </p><a class="indexterm" name="idm46723748417008"></a><a class="indexterm" name="idm46723748415568"></a><p>
            文字列の左端と右端をマスクし、内部をマスクしないままにして、結果を返します。 オプションのマスキング文字を指定できます。 
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>str</code></em>: マスクする文字列。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>margin1</code></em>: マスクする文字列の左端の文字数を指定する負でない整数。 値が 0 の場合、左端の文字はマスクされません。 
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>margin2</code></em>: マスクする文字列の右端の文字数を指定する負でない整数。 値が 0 の場合、右端の文字はマスクされません。 
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>mask_char</code></em>: (オプション) マスキングに使用する単一の文字。 <em class="replaceable"><code>mask_char</code></em> が指定されていない場合、デフォルトは<code class="literal">'X'</code>です。 
              </p><p>
                マスキング文字はシングルバイト文字である必要があります。 マルチバイト文字を使用しようとすると、エラーが発生します。 
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            マスクされた文字列。いずれかのマージンが負の場合は <code class="literal">NULL</code>。
          </p><p>
            マージン値の合計が引数の長さより大きい場合、引数全体がマスクされます。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_outer('abcdef', 1, 2), mask_outer('abcdef',0, 5);</code></strong>
+----------------------------+---------------------------+
| mask_outer('abcdef', 1, 2) | mask_outer('abcdef',0, 5) |
+----------------------------+---------------------------+
| XbcdXX                     | aXXXXX                    |
+----------------------------+---------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_outer('abcdef', 1, 2, '*'), mask_outer('abcdef',0, 5, '#');</code></strong>
+---------------------------------+--------------------------------+
| mask_outer('abcdef', 1, 2, '*') | mask_outer('abcdef',0, 5, '#') |
+---------------------------------+--------------------------------+
| *bcd**                          | a#####                         |
+---------------------------------+--------------------------------+
</pre></li><li class="listitem"><p><a name="function_mask-pan"></a>
            <code class="literal">mask_pan(<em class="replaceable"><code>str</code></em>)</code>
          </p><a class="indexterm" name="idm46723748395232"></a><a class="indexterm" name="idm46723748393792"></a><p>
            支払カードプライマリアカウント番号をマスクし、最後の 4 桁を除くすべての数字を<code class="literal">'X'</code>文字に置き換えて返します。
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>str</code></em>: マスクする文字列。 文字列はプライマリアカウント番号に適した長さである必要がありますが、それ以外の場合は選択されません。 
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            マスクされた支払番号を文字列として指定します。 引数が必須より短い場合は、変更されずに返されます。 
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan());</code></strong>
+-------------------------+
| mask_pan(gen_rnd_pan()) |
+-------------------------+
| XXXXXXXXXXXX9102        |
+-------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan(19));</code></strong>
+---------------------------+
| mask_pan(gen_rnd_pan(19)) |
+---------------------------+
| XXXXXXXXXXXXXXX8268       |
+---------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan('a*Z');</code></strong>
+-----------------+
| mask_pan('a*Z') |
+-----------------+
| a*Z             |
+-----------------+
</pre></li><li class="listitem"><p><a name="function_mask-pan-relaxed"></a>
            <code class="literal">mask_pan_relaxed(<em class="replaceable"><code>str</code></em>)</code>
          </p><a class="indexterm" name="idm46723748379808"></a><a class="indexterm" name="idm46723748378336"></a><p>
            支払カードプライマリアカウント番号をマスクし、最初の 6 桁と最後の 4 桁を除くすべての数字を<code class="literal">'X'</code>文字に置き換えて返します。 最初の 6 桁は、支払カード会社を示します。 
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>str</code></em>: マスクする文字列。 文字列はプライマリアカウント番号に適した長さである必要がありますが、それ以外の場合は選択されません。 
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            マスクされた支払番号を文字列として指定します。 引数が必須より短い場合は、変更されずに返されます。 
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan());</code></strong>
+---------------------------------+
| mask_pan_relaxed(gen_rnd_pan()) |
+---------------------------------+
| 551279XXXXXX3108                |
+---------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan(19));</code></strong>
+-----------------------------------+
| mask_pan_relaxed(gen_rnd_pan(19)) |
+-----------------------------------+
| 462634XXXXXXXXX6739               |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed('a*Z');</code></strong>
+-------------------------+
| mask_pan_relaxed('a*Z') |
+-------------------------+
| a*Z                     |
+-------------------------+
</pre></li><li class="listitem"><p><a name="function_mask-ssn"></a>
            <code class="literal">mask_ssn(<em class="replaceable"><code>str</code></em>)</code>
          </p><a class="indexterm" name="idm46723748364208"></a><a class="indexterm" name="idm46723748362768"></a><p>
            米国社会保障番号をマスクし、最後の 4 桁を除くすべての数字を<code class="literal">'X'</code>文字に置き換えて返します。
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>str</code></em>: マスクする文字列。 文字列の長さは 11 文字である必要がありますが、それ以外の場合はチェックされません。 
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            マスクされた社会保障番号 (文字列)。引数の長さが正しくない場合は <code class="literal">NULL</code>。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_ssn('909-63-6922'), mask_ssn('abcdefghijk');</code></strong>
+-------------------------+-------------------------+
| mask_ssn('909-63-6922') | mask_ssn('abcdefghijk') |
+-------------------------+-------------------------+
| XXX-XX-6922             | XXX-XX-hijk             |
+-------------------------+-------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_ssn('909');</code></strong>
+-----------------+
| mask_ssn('909') |
+-----------------+
| NULL            |
+-----------------+
</pre></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="data-masking-generation-functions"></a>ランダムデータ生成関数</h4></div></div></div><p>
        このセクションの関数は、様々なタイプのデータに対してランダムな値を生成します。 可能な場合、生成された値にはデモンストレーションまたはテスト値用に予約された特性があり、正当なデータを間違えないようにします。 たとえば、<code class="literal">gen_rnd_us_phone()</code> は 555 市外局番を使用する米国電話番号を返しますが、これは実際の使用では電話番号に割り当てられていません。 個々の関数の説明では、この原則の例外について説明します。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_gen-range"></a>
            <code class="literal">gen_range(<em class="replaceable"><code>lower</code></em>, <em class="replaceable"><code>upper</code></em>)</code>
          </p><a class="indexterm" name="idm46723748344512"></a><a class="indexterm" name="idm46723748343072"></a><p>
            指定された範囲から選択された乱数を生成します。
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>lower</code></em>: 範囲の下限を指定する整数。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>upper</code></em>: 範囲の上限を指定する整数。下限より小さくすることはできません。
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            <em class="replaceable"><code>lower</code></em> から <em class="replaceable"><code>upper</code></em> までの範囲のランダムな整数 (<em class="replaceable"><code>upper</code></em> 引数が <em class="replaceable"><code>lower</code></em> より小さい場合は <code class="literal">NULL</code>)。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_range(100, 200), gen_range(-1000, -800);</code></strong>
+---------------------+------------------------+
| gen_range(100, 200) | gen_range(-1000, -800) |
+---------------------+------------------------+
|                 177 |                   -917 |
+---------------------+------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_range(1, 0);</code></strong>
+-----------------+
| gen_range(1, 0) |
+-----------------+
|            NULL |
+-----------------+
</pre></li><li class="listitem"><p><a name="function_gen-rnd-email"></a>
            <code class="literal">gen_rnd_email()</code>
          </p><a class="indexterm" name="idm46723748327760"></a><a class="indexterm" name="idm46723748326320"></a><p>
            <code class="literal">example.com</code> ドメインにランダムな電子メールアドレスを生成します。
          </p><p>
            引数:
          </p><p>
            なし
          </p><p>
            戻り値:
          </p><p>
            文字列としてのランダムな電子メールアドレス。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_email();</code></strong>
+---------------------------+
| gen_rnd_email()           |
+---------------------------+
| ijocv.mwvhhuf@example.com |
+---------------------------+
</pre></li><li class="listitem"><p><a name="function_gen-rnd-pan"></a>
            <code class="literal">gen_rnd_pan([<em class="replaceable"><code>size</code></em>])</code>
          </p><a class="indexterm" name="idm46723748316144"></a><a class="indexterm" name="idm46723748314704"></a><p>
            ランダム支払カードプライマリアカウント番号を生成します。 数値は Luhn チェック (検証桁に対してチェックサム検証を実行するアルゴリズム) に合格します。 
          </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">警告</div><p>
              <code class="literal">gen_rnd_pan()</code> から返される値はテスト目的でのみ使用する必要があり、公開には適していません。 特定の戻り値が正当な支払アカウントに割り当てられていないことを保証する方法はありません。 <code class="literal">gen_rnd_pan()</code> の結果を公開する必要がある場合は、<code class="literal">mask_pan()</code> または <code class="literal">mask_pan_relaxed()</code> でマスキングすることを検討してください。 
            </p></div><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>size</code></em>: (オプション) 結果のサイズを指定する整数。 <em class="replaceable"><code>size</code></em> が指定されていない場合、デフォルトは 16 です。 指定する場合、<em class="replaceable"><code>size</code></em> は 12 から 19 の範囲の整数である必要があります。 
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            文字列としてのランダムな支払番号。許可された範囲外の <em class="replaceable"><code>size</code></em> 引数が指定されている場合は <code class="literal">NULL</code>。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan());</code></strong>
+-------------------------+
| mask_pan(gen_rnd_pan()) |
+-------------------------+
| XXXXXXXXXXXX5805        |
+-------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan(19));</code></strong>
+---------------------------+
| mask_pan(gen_rnd_pan(19)) |
+---------------------------+
| XXXXXXXXXXXXXXX5067       |
+---------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan());</code></strong>
+---------------------------------+
| mask_pan_relaxed(gen_rnd_pan()) |
+---------------------------------+
| 398403XXXXXX9547                |
+---------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan(19));</code></strong>
+-----------------------------------+
| mask_pan_relaxed(gen_rnd_pan(19)) |
+-----------------------------------+
| 578416XXXXXXXXX6509               |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_pan(11), gen_rnd_pan(20);</code></strong>
+-----------------+-----------------+
| gen_rnd_pan(11) | gen_rnd_pan(20) |
+-----------------+-----------------+
| NULL            | NULL            |
+-----------------+-----------------+
</pre></li><li class="listitem"><p><a name="function_gen-rnd-ssn"></a>
            <code class="literal">gen_rnd_ssn()</code>
          </p><a class="indexterm" name="idm46723748291824"></a><a class="indexterm" name="idm46723748290384"></a><p>
            ランダムな US 社会保障番号を <code class="literal"><em class="replaceable"><code>AAA</code></em>-<em class="replaceable"><code>BB</code></em>-<em class="replaceable"><code>CCCC</code></em></code> 形式で生成します。 <em class="replaceable"><code>AAA</code></em> 部分が 900 を超え、<em class="replaceable"><code>BB</code></em> 部分が 70 未満です。これは、正当な社会保障番号に使用されない特性です。 
          </p><p>
            引数:
          </p><p>
            なし
          </p><p>
            戻り値:
          </p><p>
            文字列としてのランダムな社会保障番号。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_ssn();</code></strong>
+---------------+
| gen_rnd_ssn() |
+---------------+
| 951-26-0058   |
+---------------+
</pre></li><li class="listitem"><p><a name="function_gen-rnd-us-phone"></a>
            <code class="literal">gen_rnd_us_phone()</code>
          </p><a class="indexterm" name="idm46723748278512"></a><a class="indexterm" name="idm46723748277040"></a><p>
            ランダムな米国電話番号を <code class="literal">1-555-<em class="replaceable"><code>AAA</code></em>-<em class="replaceable"><code>BBBB</code></em></code> 形式で生成します。 555 市外局番は正当な電話番号には使用されません。 
          </p><p>
            引数:
          </p><p>
            なし
          </p><p>
            戻り値:
          </p><p>
            文字列としてのランダムな US 電話番号。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_us_phone();</code></strong>
+--------------------+
| gen_rnd_us_phone() |
+--------------------+
| 1-555-682-5423     |
+--------------------+
</pre></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="data-masking-dictionary-functions"></a>ランダムデータディクショナリビューの関数</h4></div></div></div><p>
        このセクションの関数は、用語のディクショナリを操作し、それらに基づいて生成およびマスキング操作を実行します。 これらの関数の中には、<code class="literal">SUPER</code> 権限を必要とするものがあります。 
      </p><p>
        ディクショナリがロードされると、ディクショナリレジストリの一部になり、他のディクショナリ関数で使用される名前が割り当てられます。 ディクショナリは、行ごとに 1 語を含むプレーンテキストファイルからロードされます。 空の行は無視されます。 有効にするには、辞書ファイルに空でない行が少なくとも 1 つ含まれている必要があります。 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="function_gen-blacklist"></a>
            <code class="literal">gen_blacklist(<em class="replaceable"><code>str</code></em>, <em class="replaceable"><code>dictionary_name</code></em>, <em class="replaceable"><code>replacement_dictionary_name</code></em>)</code>
          </p><a class="indexterm" name="idm46723748260736"></a><a class="indexterm" name="idm46723748259296"></a><p>
            1 つの辞書に存在する用語を 2 つ目の辞書の用語に置き換え、置換する用語を返します。 これは、置換によって元の用語をマスクします。 この関数は MySQL 8.0.23 では非推奨です。かわりに <code class="literal">gen_blocklist()</code> を使用してください。 
          </p></li><li class="listitem"><p><a name="function_gen-blocklist"></a>
            <code class="literal">gen_blocklist(<em class="replaceable"><code>str</code></em>, <em class="replaceable"><code>dictionary_name</code></em>, <em class="replaceable"><code>replacement_dictionary_name</code></em>)</code>
          </p><a class="indexterm" name="idm46723748251856"></a><a class="indexterm" name="idm46723748250416"></a><p>
            1 つの辞書に存在する用語を 2 つ目の辞書の用語に置き換え、置換する用語を返します。 これは、置換によって元の用語をマスクします。 この関数は MySQL 8.0.23 で追加されました。<code class="literal">gen_blacklist()</code> のかわりに使用してください。 
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>str</code></em>: 置換する用語を示す文字列。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>dictionary_name</code></em>: 置換する用語を含むディクショナリを指定する文字列。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>replacement_dictionary_name</code></em>: 置換語を選択するディクショナリを指定する文字列。
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            <em class="replaceable"><code>str</code></em> の代替として <em class="replaceable"><code>replacement_dictionary_name</code></em> からランダムに選択された文字列。<em class="replaceable"><code>dictionary_name</code></em> に表示されない場合は <em class="replaceable"><code>str</code></em>、いずれかのディクショナリ名がディクショナリレジストリにない場合は <code class="literal">NULL</code>。
          </p><p>
            置換する用語が両方のディクショナリにある場合は、戻り値が同じ用語である可能性があります。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_blocklist('Berlin', 'DE_Cities', 'US_Cities');</code></strong>
+---------------------------------------------------+
| gen_blocklist('Berlin', 'DE_Cities', 'US_Cities') |
+---------------------------------------------------+
| Phoenix                                           |
+---------------------------------------------------+
</pre></li><li class="listitem"><p><a name="function_gen-dictionary"></a>
            <code class="literal">gen_dictionary(<em class="replaceable"><code>dictionary_name</code></em>)</code>
          </p><a class="indexterm" name="idm46723748232112"></a><a class="indexterm" name="idm46723748230640"></a><p>
            ディクショナリからランダムな用語を返します。
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>dictionary_name</code></em>: 用語を選択するディクショナリを指定する文字列。
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            ディクショナリからの文字列としてのランダムな用語。ディクショナリ名がディクショナリレジストリにない場合は <code class="literal">NULL</code>。
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary('mydict');</code></strong>
+--------------------------+
| gen_dictionary('mydict') |
+--------------------------+
| My term                  |
+--------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary('no-such-dict');</code></strong>
+--------------------------------+
| gen_dictionary('no-such-dict') |
+--------------------------------+
| NULL                           |
+--------------------------------+
</pre></li><li class="listitem"><p><a name="function_gen-dictionary-drop"></a>
            <code class="literal">gen_dictionary_drop(<em class="replaceable"><code>dictionary_name</code></em>)</code>
          </p><a class="indexterm" name="idm46723748217824"></a><a class="indexterm" name="idm46723748216352"></a><p>
            ディクショナリレジストリからディクショナリを削除します。
          </p><p>
            この関数には、<code class="literal">SUPER</code> 権限が必要です。
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>dictionary_name</code></em>: ディクショナリレジストリから削除するディクショナリを指定する文字列。
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            削除操作が成功したかどうかを示す文字列。 <code class="literal">Dictionary removed</code> は成功を示します。 <code class="literal">Dictionary removal error</code> は失敗を示します。 
          </p><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_drop('mydict');</code></strong>
+-------------------------------+
| gen_dictionary_drop('mydict') |
+-------------------------------+
| Dictionary removed            |
+-------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_drop('no-such-dict');</code></strong>
+-------------------------------------+
| gen_dictionary_drop('no-such-dict') |
+-------------------------------------+
| Dictionary removal error            |
+-------------------------------------+
</pre></li><li class="listitem"><p><a name="function_gen-dictionary-load"></a>
            <code class="literal">gen_dictionary_load(<em class="replaceable"><code>dictionary_path</code></em>, <em class="replaceable"><code>dictionary_name</code></em>)</code>
          </p><a class="indexterm" name="idm46723748201008"></a><a class="indexterm" name="idm46723748199536"></a><p>
            ファイルをディクショナリレジストリにロードし、ディクショナリ名引数を必要とする他の関数で使用される名前をディクショナリに割り当てます。
          </p><p>
            この関数には、<code class="literal">SUPER</code> 権限が必要です。
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
              ディクショナリは永続的ではありません。 アプリケーションで使用されるディクショナリは、サーバーの起動ごとにロードする必要があります。 
            </p></div><p>
            レジストリにロードされたディクショナリは、基礎となるディクショナリファイルが変更された場合でもそのまま使用されます。 ディクショナリをリロードするには、まず <code class="literal">gen_dictionary_drop()</code> でディクショナリを削除してから、<code class="literal">gen_dictionary_load()</code> で再度ロードします。 
          </p><p>
            引数:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>dictionary_path</code></em>: ディクショナリファイルのパス名を指定する文字列。
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>dictionary_name</code></em>: ディクショナリの名前を示す文字列。
              </p></li></ul></div><p>
            戻り値:
          </p><p>
            ロード操作が成功したかどうかを示す文字列。 <code class="literal">Dictionary load success</code> は成功を示します。 <code class="literal">Dictionary load error</code> は失敗を示します。 ディクショナリロードの失敗は、次のようないくつかの理由で発生します: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                指定された名前のディクショナリはすでにロードされています。
              </p></li><li class="listitem"><p>
                ディクショナリファイルが見つかりません。
              </p></li><li class="listitem"><p>
                辞書ファイルに用語が含まれていません。
              </p></li><li class="listitem"><p>
                <code class="literal">secure_file_priv</code> システム変数が設定されており、ディクショナリファイルが変数で指定されたディレクトリにありません。
              </p></li></ul></div><p>
            例:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_load('/usr/local/mysql/mysql-files/mydict','mydict');</code></strong>
+---------------------------------------------------------------------+
| gen_dictionary_load('/usr/local/mysql/mysql-files/mydict','mydict') |
+---------------------------------------------------------------------+
| Dictionary load success                                             |
+---------------------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_load('/dev/null','null');</code></strong>
+-----------------------------------------+
| gen_dictionary_load('/dev/null','null') |
+-----------------------------------------+
| Dictionary load error                   |
+-----------------------------------------+
</pre></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="enterprise-encryption"></a>6.6 MySQL Enterprise Encryption</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#enterprise-encryption-installation">6.6.1 MySQL Enterprise Encryption のインストール</a></span></dt><dt><span class="section"><a href="security.html#enterprise-encryption-usage">6.6.2 MySQL Enterprise Encryption の使用方法と例</a></span></dt><dt><span class="section"><a href="security.html#enterprise-encryption-function-reference">6.6.3 MySQL Enterprise Encryption ユーザー定義関数リファレンス</a></span></dt><dt><span class="section"><a href="security.html#enterprise-encryption-functions">6.6.4 MySQL Enterprise Encryption ユーザー定義関数の説明</a></span></dt></dl></div><a class="indexterm" name="idm46723748173488"></a><a class="indexterm" name="idm46723748172400"></a><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
      MySQL Enterprise Encryption は、商用製品である MySQL Enterprise Edition に含まれる拡張機能です。 商用製品の詳細は、<a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a> を参照してください。 
    </p></div><p>
    MySQL Enterprise Edition には、SQL レベルで OpenSSL 機能を公開する OpenSSL ライブラリに基づく一連の暗号化機能が含まれています。 これらの関数を使用することによって、エンタープライズアプリケーションが次の操作を実行できるようになります。 
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        公開鍵非対称暗号方式を使用した、追加のデータ保護の実装
      </p></li><li class="listitem"><p>
        公開鍵、秘密鍵、およびデジタル署名の作成
      </p></li><li class="listitem"><p>
        非対称暗号化および非対称復号化の実行
      </p></li><li class="listitem"><p>
        デジタル署名およびデータの検証や妥当性検査に対する暗号化ハッシュの使用
      </p></li></ul></div><p>
    MySQL Enterprise Encryption は、RSA、DSA および DH 暗号化アルゴリズムをサポートしています。
  </p><p>
    MySQL Enterprise Encryption はユーザー定義関数 (UDF) ライブラリとして提供され、個々の関数を個別にインストールできます。
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="enterprise-encryption-installation"></a>6.6.1 MySQL Enterprise Encryption のインストール</h3></div></div></div><p>
      MySQL Enterprise Encryption 関数は、プラグインディレクトリ (<code class="literal">plugin_dir</code> システム変数で指定されたディレクトリ) にインストールされているユーザー定義関数 (UDF) ライブラリファイルにあります。 UDF ライブラリのベース名は <code class="filename">openssl_udf</code> であり、サフィクスはプラットフォームに依存します。 たとえば、ファイル名は Linux では <code class="filename">openssl_udf.so</code>、Windows では <code class="filename">openssl_udf.dll</code> です。 
    </p><p>
      ライブラリファイルから関数をインストールするには、<code class="literal">CREATE FUNCTION</code> ステートメントを使用します。 ライブラリからすべての関数をロードするには、必要に応じてファイル名接尾辞を調整して、次の一連のステートメントを使用します: 
    </p><pre class="programlisting">CREATE FUNCTION asymmetric_decrypt RETURNS STRING
SONAME 'openssl_udf.so';
CREATE FUNCTION asymmetric_derive RETURNS STRING
SONAME 'openssl_udf.so';
CREATE FUNCTION asymmetric_encrypt RETURNS STRING
SONAME 'openssl_udf.so';
CREATE FUNCTION asymmetric_sign RETURNS STRING
SONAME 'openssl_udf.so';
CREATE FUNCTION asymmetric_verify RETURNS INTEGER
SONAME 'openssl_udf.so';
CREATE FUNCTION create_asymmetric_priv_key RETURNS STRING
SONAME 'openssl_udf.so';
CREATE FUNCTION create_asymmetric_pub_key RETURNS STRING
SONAME 'openssl_udf.so';
CREATE FUNCTION create_dh_parameters RETURNS STRING
SONAME 'openssl_udf.so';
CREATE FUNCTION create_digest RETURNS STRING
SONAME 'openssl_udf.so';
</pre><p>
      一度インストールすれば、何回サーバーを再起動しても UDF はインストールされたままです。 UDF をアンロードするには、<code class="literal">DROP FUNCTION</code> ステートメントを使用します: 
    </p><pre class="programlisting">DROP FUNCTION asymmetric_decrypt;
DROP FUNCTION asymmetric_derive;
DROP FUNCTION asymmetric_encrypt;
DROP FUNCTION asymmetric_sign;
DROP FUNCTION asymmetric_verify;
DROP FUNCTION create_asymmetric_priv_key;
DROP FUNCTION create_asymmetric_pub_key;
DROP FUNCTION create_dh_parameters;
DROP FUNCTION create_digest;
</pre><p>
      <code class="literal">CREATE FUNCTION</code> および <code class="literal">DROP FUNCTION</code> ステートメントでは、関数名を小文字で指定する必要があります。 これは、大文字と小文字のどちらでも使用できる関数の呼び出し時での使用とは異なります。 
    </p><p>
      <code class="literal">mysql</code> データベースの場合、<code class="literal">CREATE FUNCTION</code> および <code class="literal">DROP FUNCTION</code> ステートメントでは、それぞれ <code class="literal">INSERT</code> および <code class="literal">DROP</code> 権限が必要です。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="enterprise-encryption-usage"></a>6.6.2 MySQL Enterprise Encryption の使用方法と例</h3></div></div></div><p>
      アプリケーションで MySQL Enterprise Encryption を使用するには、実行する操作に適した関数を呼び出します。 このセクションでは、代表的なタスクの実行方法を示します: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#enterprise-encryption-usage-create-key-pair" title="RSA 暗号化を使用した秘密キーと公開キーのペアの作成">RSA 暗号化を使用した秘密キーと公開キーのペアの作成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#enterprise-encryption-usage-encrypt-decrypt" title="秘密キーを使用してデータを暗号化し、公開キーを使用して復号化">秘密キーを使用してデータを暗号化し、公開キーを使用して復号化</a></p></li><li class="listitem"><p><a class="xref" href="security.html#enterprise-encryption-usage-create-digest" title="文字列からダイジェストを生成">文字列からダイジェストを生成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#enterprise-encryption-usage-digital-signing" title="キーペアでダイジェストを使用">キーペアでダイジェストを使用</a></p></li><li class="listitem"><p><a class="xref" href="security.html#enterprise-encryption-usage-create-symmetic-key" title="対称キーの作成">対称キーの作成</a></p></li><li class="listitem"><p><a class="xref" href="security.html#enterprise-encryption-usage-limit-cpu" title="キー生成操作による CPU 使用率の制限">キー生成操作による CPU 使用率の制限</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="enterprise-encryption-usage-create-key-pair"></a>RSA 暗号化を使用した秘密キーと公開キーのペアの作成</h4></div></div></div><pre class="programlisting">-- Encryption algorithm; can be 'DSA' or 'DH' instead
SET @algo = 'RSA';
-- Key length in bits; make larger for stronger keys
SET @key_len = 1024;

-- Create private key
SET @priv = create_asymmetric_priv_key(@algo, @key_len);
-- Derive corresponding public key from private key, using same algorithm
SET @pub = create_asymmetric_pub_key(@algo, @priv);
</pre><p>
        鍵のペアを使用すると、データを暗号化および復号化したり、データを署名および検証したり、対称鍵を生成したりできるようになりました。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="enterprise-encryption-usage-encrypt-decrypt"></a>秘密キーを使用してデータを暗号化し、公開キーを使用して復号化</h4></div></div></div><p>
        これには、鍵ペアのメンバーが RSA 鍵である必要があります。
      </p><pre class="programlisting">SET @ciphertext = asymmetric_encrypt(@algo, 'My secret text', @priv);
SET @plaintext = asymmetric_decrypt(@algo, @ciphertext, @pub);
</pre><p>
        反対に、公開鍵を使用して暗号化し、秘密鍵を使用して復号化できます。
      </p><pre class="programlisting">SET @ciphertext = asymmetric_encrypt(@algo, 'My secret text', @pub);
SET @plaintext = asymmetric_decrypt(@algo, @ciphertext, @priv);
</pre><p>
        いずれの場合でも、暗号化関数および復号化関数用に指定されたアルゴリズムは、鍵を生成したときに使用されたアルゴリズムと一致する必要があります。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="enterprise-encryption-usage-create-digest"></a>文字列からダイジェストを生成</h4></div></div></div><pre class="programlisting">-- Digest type; can be 'SHA256', 'SHA384', or 'SHA512' instead
SET @dig_type = 'SHA224';

-- Generate digest string
SET @dig = create_digest(@dig_type, 'My text to digest');
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="enterprise-encryption-usage-digital-signing"></a>キーペアでダイジェストを使用</h4></div></div></div><p>
        キーペアを使用してデータに署名し、署名がダイジェストと一致することを確認できます。
      </p><pre class="programlisting">-- Encryption algorithm; could be 'DSA' instead; keys must
-- have been created using same algorithm
SET @algo = 'RSA';

-- Generate signature for digest and verify signature against digest
SET @sig = asymmetric_sign(@algo, @dig, @priv, @dig_type);
-- Verify signature against digest
SET @verf = asymmetric_verify(@algo, @dig, @sig, @pub, @dig_type);
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="enterprise-encryption-usage-create-symmetic-key"></a>対称キーの作成</h4></div></div></div><p>
        これには、共有対称シークレットを使用して作成される DH 秘密鍵/公開鍵が入力として必要です。 キー長を <code class="literal">create_dh_parameters()</code> に渡してシークレットを作成し、そのシークレットを<span class="quote">「<span class="quote">「キー長」</span>」</span>として <code class="literal">create_asymmetric_priv_key()</code> に渡します。 
      </p><pre class="programlisting">-- Generate DH shared symmetric secret
SET @dhp = create_dh_parameters(1024);
-- Generate DH key pairs
SET @algo = 'DH';
SET @priv1 = create_asymmetric_priv_key(@algo, @dhp);
SET @pub1 = create_asymmetric_pub_key(@algo, @priv1);
SET @priv2 = create_asymmetric_priv_key(@algo, @dhp);
SET @pub2 = create_asymmetric_pub_key(@algo, @priv2);

-- Generate symmetric key using public key of first party,
-- private key of second party
SET @sym1 = asymmetric_derive(@pub1, @priv2);

-- Or use public key of second party, private key of first party
SET @sym2 = asymmetric_derive(@pub2, @priv1);
</pre><p>
        鍵文字列の値は、<code class="literal">SET</code>、<code class="literal">SELECT</code>、または <code class="literal">INSERT</code> を使用することで実行時に作成し、変数やテーブルに格納できます。
      </p><pre class="programlisting">SET @priv1 = create_asymmetric_priv_key('RSA', 1024);
SELECT create_asymmetric_priv_key('RSA', 1024) INTO @priv2;
INSERT INTO t (key_col) VALUES(create_asymmetric_priv_key('RSA', 1024));
</pre><p>
        ファイルに格納されている鍵文字列の値は、<code class="literal">FILE</code> 権限を持つユーザーが <code class="literal">LOAD_FILE()</code> 関数を使用することで読み取ることができます。
      </p><p>
        ダイジェストと署名の文字列は、同様に処理できます。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="enterprise-encryption-usage-limit-cpu"></a>キー生成操作による CPU 使用率の制限</h4></div></div></div><p>
        <code class="literal">create_asymmetric_priv_key()</code> および <code class="literal">create_dh_parameters()</code> 暗号化関数はキー長パラメータを取り、これらの関数に必要な CPU リソースの量はキーの長さが増加するにつれて増加します。 一部のインストールでは、アプリケーションが過度に長いキーを頻繁に生成する場合、これによって CPU 使用率が許容できなくなることがあります。 
      </p><p>
        OpenSSL では、すべてのキーに 1,024 ビットの最小キー長が課されます。 OpenSSL では、<code class="literal">create_asymmetric_priv_key()</code> では DSA キーおよび RSA キーに対してそれぞれ 10,000 ビットおよび 16,384 ビットの最大キー長、および <code class="literal">create_dh_parameters()</code> では 10,000 ビットの最大キー長も課されます。 これらの最大値が大きすぎる場合は、MySQL サーバー管理者がキー生成の最大長を低く設定できるようにするために、3 つの環境変数を使用できます。これにより、CPU 使用率を制限できます: 
      </p><a class="indexterm" name="idm46723748094816"></a><a class="indexterm" name="idm46723748093232"></a><a class="indexterm" name="idm46723748091264"></a><a class="indexterm" name="idm46723748089680"></a><a class="indexterm" name="idm46723748087712"></a><a class="indexterm" name="idm46723748086128"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">MYSQL_OPENSSL_UDF_DSA_BITS_THRESHOLD</code>: <code class="literal">create_asymmetric_priv_key()</code> の DSA キーの最大長 (ビット単位)。 この変数の最小値と最大値は 1,024 と 10,000 です。 
          </p></li><li class="listitem"><p>
            <code class="literal">MYSQL_OPENSSL_UDF_RSA_BITS_THRESHOLD</code>: <code class="literal">create_asymmetric_priv_key()</code> の RSA キーの最大長 (ビット単位)。 この変数の最小値と最大値は 1,024 と 16,384 です。 
          </p></li><li class="listitem"><p>
            <code class="literal">MYSQL_OPENSSL_UDF_DH_BITS_THRESHOLD</code>: <code class="literal">create_dh_parameters()</code> の最大キー長 (ビット単位)。 この変数の最小値と最大値は 1,024 と 10,000 です。 
          </p></li></ul></div><p>
        これらの環境変数のいずれかを使用するには、サーバーを起動するプロセスの環境に設定します。 設定されている場合、それらの値は OpenSSL によって課される最大キー長よりも優先されます。 たとえば、DSA に 4,096 ビット、<code class="literal">create_asymmetric_priv_key()</code> に RSA キーの最大キー長を設定するには、次の変数を設定します: 
      </p><pre class="programlisting">export MYSQL_OPENSSL_UDF_DSA_BITS_THRESHOLD=4096
export MYSQL_OPENSSL_UDF_RSA_BITS_THRESHOLD=4096
</pre><p>
        この例では Bourne シェル構文を使用します。 ほかのシェルの構文は異なる場合があります。 
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="enterprise-encryption-function-reference"></a>6.6.3 MySQL Enterprise Encryption ユーザー定義関数リファレンス</h3></div></div></div><div class="table"><a name="idm46723748069936"></a><p class="title"><b>表 6.39 「MySQL Enterprise Encryption のユーザー定義関数」</b></p><div class="table-contents"><table frame="box" rules="all" summary="「MySQL Enterprise Encryption のユーザー定義関数をリストする参照。」"><col style="width=28%"><col style="width=71%"><thead><tr><th>名前</th>
<th>説明</th>
</tr></thead><tbody><tr><td><a class="link" href="security.html#function_asymmetric-decrypt"><code class="literal">asymmetric_decrypt()</code></a></td>
<td>
      秘密鍵または公開鍵を使用して暗号文を復号化します
    </td>
</tr><tr><td><a class="link" href="security.html#function_asymmetric-derive"><code class="literal">asymmetric_derive()</code></a></td>
<td>
      非対称鍵から対称鍵を導出します
    </td>
</tr><tr><td><a class="link" href="security.html#function_asymmetric-encrypt"><code class="literal">asymmetric_encrypt()</code></a></td>
<td>
      秘密キーまたは公開キーを使用したクリアテキストの暗号化
    </td>
</tr><tr><td><a class="link" href="security.html#function_asymmetric-sign"><code class="literal">asymmetric_sign()</code></a></td>
<td>
      ダイジェストから署名を生成します
    </td>
</tr><tr><td><a class="link" href="security.html#function_asymmetric-verify"><code class="literal">asymmetric_verify()</code></a></td>
<td>
      署名がダイジェストと一致することを確認します
    </td>
</tr><tr><td><a class="link" href="security.html#function_create-asymmetric-priv-key"><code class="literal">create_asymmetric_priv_key()</code></a></td>
<td>
      秘密鍵を作成します
    </td>
</tr><tr><td><a class="link" href="security.html#function_create-asymmetric-pub-key"><code class="literal">create_asymmetric_pub_key()</code></a></td>
<td>
      公開鍵を作成します
    </td>
</tr><tr><td><a class="link" href="security.html#function_create-dh-parameters"><code class="literal">create_dh_parameters()</code></a></td>
<td>
      共有 DH シークレットを生成します
    </td>
</tr><tr><td><a class="link" href="security.html#function_create-digest"><code class="literal">create_digest()</code></a></td>
<td>
      文字列からダイジェストを生成します
    </td>
</tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="enterprise-encryption-functions"></a>6.6.4 MySQL Enterprise Encryption ユーザー定義関数の説明</h3></div></div></div><p>
      MySQL Enterprise Encryption 関数には、次の一般的な特性があります:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          引数の型が不正な場合や引数の数が間違っている場合は、各関数でエラーが返されます。
        </p></li><li class="listitem"><p>
          要求された演算を実行することを関数に許可するのに引数が適していない場合は、必要に応じて <code class="literal">NULL</code> または 0 が返されます。 これは、指定されたアルゴリズムが関数でサポートされていない場合、鍵の長さが短すぎたり長すぎたりする場合、PEM 書式の鍵文字列として要求される文字列が有効な鍵でない場合などに発生します。 (OpenSSL では独自のキー長制限が課され、サーバー管理者は環境変数を設定して最大キー長に追加の制限を課すことができます。 <a class="xref" href="security.html#enterprise-encryption-usage" title="6.6.2 MySQL Enterprise Encryption の使用方法と例">セクション6.6.2「MySQL Enterprise Encryption の使用方法と例」</a>を参照してください。) 
        </p></li><li class="listitem"><p>
          ベースとなる SSL ライブラリでは、ランダム度の初期化が処理されます。
        </p></li></ul></div><p>
      関数の一部には、暗号化アルゴリズムの引数が指定されます。 次の表には、サポートされているアルゴリズムのサマリーを関数別に示します。 
    </p><div class="table"><a name="idm46723748026288"></a><p class="title"><b>表 6.40 関数でサポートされているアルゴリズム</b></p><div class="table-contents"><table summary="Supported encryption algorithms by function."><col style="width=50%"><col style="width=50%"><thead><tr>
          <th>関数</th>
          <th>サポートされているアルゴリズム</th>
        </tr></thead><tbody><tr>
          <td><code class="literal">asymmetric_decrypt()</code></td>
          <td>RSA</td>
        </tr><tr>
          <td><code class="literal">asymmetric_derive()</code></td>
          <td>DH</td>
        </tr><tr>
          <td><code class="literal">asymmetric_encrypt()</code></td>
          <td>RSA</td>
        </tr><tr>
          <td><code class="literal">asymmetric_sign()</code></td>
          <td>RSA、DSA</td>
        </tr><tr>
          <td><code class="literal">asymmetric_verify()</code></td>
          <td>RSA、DSA</td>
        </tr><tr>
          <td><code class="literal">create_asymmetric_priv_key()</code></td>
          <td>RSA、DSA、DH</td>
        </tr><tr>
          <td><code class="literal">create_asymmetric_pub_key()</code></td>
          <td>RSA、DSA、DH</td>
        </tr><tr>
          <td><code class="literal">create_dh_parameters()</code></td>
          <td>DH</td>
        </tr></tbody></table></div></div><br class="table-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
        RSA、DSA、または DH のいずれかの暗号化アルゴリズムを使用すれば鍵を作成できますが、鍵引数が指定されるその他の関数では、特定のタイプの鍵のみが許可される可能性があります。 たとえば、<code class="literal">asymmetric_encrypt()</code> および <code class="literal">asymmetric_decrypt()</code> は RSA キーのみを受け入れます。 
      </p></div><p>
      次の説明では、MySQL Enterprise Encryption 関数のコール順序について説明します。 追加の例と説明については、<a class="xref" href="security.html#enterprise-encryption-usage" title="6.6.2 MySQL Enterprise Encryption の使用方法と例">セクション6.6.2「MySQL Enterprise Encryption の使用方法と例」</a>を参照してください。 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a name="function_asymmetric-decrypt"></a><p>
          <code class="literal">asymmetric_decrypt(<em class="replaceable"><code>algorithm</code></em>, <em class="replaceable"><code>crypt_str</code></em>, <em class="replaceable"><code>key_str</code></em>)</code>
        </p><a class="indexterm" name="idm46723747985824"></a><p>
          指定されたアルゴリズムおよび鍵文字列を使用して、暗号化された文字列を復号化し、結果として生成されるプレーンテキストをバイナリ文字列として返します。 復号化に失敗した場合は、結果が <code class="literal">NULL</code> になります。 
        </p><p>
          <em class="replaceable"><code>key_str</code></em> は、PEM 書式の有効な鍵文字列である必要があります。 復号化を成功させるには、<code class="literal">asymmetric_encrypt()</code> で暗号化文字列を生成するために使用される秘密キー文字列または公開キー文字列に対応する公開キー文字列または秘密キー文字列である必要があります。<em class="replaceable"><code>algorithm</code></em> は、キーの作成に使用される暗号化アルゴリズムを示します。 
        </p><p>
          サポートされている <em class="replaceable"><code>algorithm</code></em> 値: <code class="literal">'RSA'</code>
        </p><p>
          使用例については、<code class="literal">asymmetric_encrypt()</code> の説明を参照してください。
        </p></li><li class="listitem"><a name="function_asymmetric-derive"></a><p>
          <code class="literal">asymmetric_derive(<em class="replaceable"><code>pub_key_str</code></em>, <em class="replaceable"><code>priv_key_str</code></em>)</code>
        </p><a class="indexterm" name="idm46723747969904"></a><p>
          あるパーティーの秘密鍵と別のパーティーの公開鍵を使用して対称鍵を導出し、結果として生成される鍵をバイナリ文字列として返します。 鍵の抽出に失敗した場合は、結果が <code class="literal">NULL</code> になります。 
        </p><p>
          <em class="replaceable"><code>pub_key_str</code></em> および <em class="replaceable"><code>priv_key_str</code></em> は、PEM 書式の有効な鍵文字列である必要があります。 これらは、DH アルゴリズムを使用して作成する必要があります。 
        </p><p>
          公開鍵と秘密鍵の 2 つのペアを持っていると仮定します。
        </p><pre class="programlisting">SET @dhp = create_dh_parameters(1024);
SET @priv1 = create_asymmetric_priv_key('DH', @dhp);
SET @pub1 = create_asymmetric_pub_key('DH', @priv1);
SET @priv2 = create_asymmetric_priv_key('DH', @dhp);
SET @pub2 = create_asymmetric_pub_key('DH', @priv2);
</pre><p>
          さらに、1 つのペアから秘密鍵を使用し、もう 1 つのペアから公開鍵を使用して、対称鍵文字列を作成すると仮定します。 その後、この対称鍵の ID 関係が次のように保持されます。 
        </p><pre class="programlisting">asymmetric_derive(@pub1, @priv2) = asymmetric_derive(@pub2, @priv1)
</pre></li><li class="listitem"><a name="function_asymmetric-encrypt"></a><p>
          <code class="literal">asymmetric_encrypt(<em class="replaceable"><code>algorithm</code></em>, <em class="replaceable"><code>str</code></em>, <em class="replaceable"><code>key_str</code></em>)</code>
        </p><a class="indexterm" name="idm46723747954608"></a><p>
          指定されたアルゴリズムおよび鍵文字列を使用して文字列を暗号化し、結果として生成される暗号化テキストをバイナリ文字列として返します。 暗号化に失敗した場合は、結果が <code class="literal">NULL</code> になります。 
        </p><p>
          <em class="replaceable"><code>str</code></em> の長さは、バイト単位で <em class="replaceable"><code>key_str</code></em> の長さ − 11 よりも大きくすることができません。
        </p><p>
          <em class="replaceable"><code>key_str</code></em> は、PEM 書式の有効な鍵文字列にする必要があります。<em class="replaceable"><code>algorithm</code></em> は、鍵を作成する際に使用された暗号化アルゴリズムを示します。
        </p><p>
          サポートされている <em class="replaceable"><code>algorithm</code></em> 値: <code class="literal">'RSA'</code>
        </p><p>
          文字列を暗号化するには、秘密キーまたは公開キーの文字列を <code class="literal">asymmetric_encrypt()</code> に渡します。 元の暗号化されていない文字列をリカバリするには、暗号化に使用される秘密キー文字列または公開キー文字列に対応する公開キー文字列または秘密キー文字列とともに、暗号化された文字列を <code class="literal">asymmetric_decrypt()</code> に渡します。 
        </p><pre class="programlisting">-- Generate private/public key pair
SET @priv = create_asymmetric_priv_key('RSA', 1024);
SET @pub = create_asymmetric_pub_key('RSA', @priv);

-- Encrypt using private key, decrypt using public key
SET @ciphertext = asymmetric_encrypt('RSA', 'The quick brown fox', @priv);
SET @plaintext = asymmetric_decrypt('RSA', @ciphertext, @pub);

-- Encrypt using public key, decrypt using private key
SET @ciphertext = asymmetric_encrypt('RSA', 'The quick brown fox', @pub);
SET @plaintext = asymmetric_decrypt('RSA', @ciphertext, @priv);
</pre><p>
          次のように仮定します。
        </p><pre class="programlisting">SET @s = a string to be encrypted
SET @priv = a valid private RSA key string in PEM format
SET @pub = the corresponding public RSA key string in PEM format
</pre><p>
          その後、これらの ID 関係が次のように保持されます。
        </p><pre class="programlisting">asymmetric_decrypt('RSA', asymmetric_encrypt('RSA', @s, @priv), @pub) = @s
asymmetric_decrypt('RSA', asymmetric_encrypt('RSA', @s, @pub), @priv) = @s
</pre></li><li class="listitem"><a name="function_asymmetric-sign"></a><p>
          <code class="literal">asymmetric_sign(<em class="replaceable"><code>algorithm</code></em>, <em class="replaceable"><code>digest_str</code></em>, <em class="replaceable"><code>priv_key_str</code></em>, <em class="replaceable"><code>digest_type</code></em>)</code>
        </p><a class="indexterm" name="idm46723747931104"></a><p>
          秘密鍵文字列を使用してダイジェスト文字列に署名し、その署名をバイナリ文字列として返します。 署名に失敗した場合は、結果が <code class="literal">NULL</code> になります。 
        </p><p>
          <em class="replaceable"><code>digest_str</code></em> はダイジェスト文字列です。 これは、<code class="literal">create_digest()</code> をコールして生成できます。<em class="replaceable"><code>digest_type</code></em> は、ダイジェスト文字列の生成に使用されるダイジェストアルゴリズムを示します。 
        </p><p>
          <em class="replaceable"><code>priv_key_str</code></em> は、ダイジェスト文字列に著名する際に使用される秘密鍵文字列です。 これは、PEM 書式の有効な鍵文字列にする必要があります。<em class="replaceable"><code>algorithm</code></em> は、鍵を作成する際に使用された暗号化アルゴリズムを示します。 
        </p><p>
          サポートされている <em class="replaceable"><code>algorithm</code></em> 値: <code class="literal">'RSA'</code>、<code class="literal">'DSA'</code>
        </p><p>
          サポートされている <em class="replaceable"><code>digest_type</code></em> 値: <code class="literal">'SHA224'</code>、<code class="literal">'SHA256'</code>、<code class="literal">'SHA384'</code>、<code class="literal">'SHA512'</code>
        </p><p>
          使用例については、<code class="literal">asymmetric_verify()</code> の説明を参照してください。
        </p></li><li class="listitem"><a name="function_asymmetric-verify"></a><p>
          <code class="literal">asymmetric_verify(<em class="replaceable"><code>algorithm</code></em>, <em class="replaceable"><code>digest_str</code></em>, <em class="replaceable"><code>sig_str</code></em>, <em class="replaceable"><code>pub_key_str</code></em>, <em class="replaceable"><code>digest_type</code></em>)</code>
        </p><a class="indexterm" name="idm46723747908192"></a><p>
          署名文字列がダイジェスト文字列と一致するかどうかを確認し、確認に成功したのか失敗したのかを示す 1 または 0 を返します。
        </p><p>
          <em class="replaceable"><code>digest_str</code></em> はダイジェスト文字列です。 これは、<code class="literal">create_digest()</code> をコールして生成できます。<em class="replaceable"><code>digest_type</code></em> は、ダイジェスト文字列の生成に使用されるダイジェストアルゴリズムを示します。 
        </p><p>
          <em class="replaceable"><code>sig_str</code></em> は署名文字列です。 これは、<code class="literal">asymmetric_sign()</code> をコールして生成できます。 
        </p><p>
          <em class="replaceable"><code>pub_key_str</code></em> は、署名者の公開鍵文字列です。 署名文字列を生成するために <code class="literal">asymmetric_sign()</code> に渡される秘密キーに対応し、PEM 形式の有効なキー文字列である必要があります。<em class="replaceable"><code>algorithm</code></em> は、キーの作成に使用される暗号化アルゴリズムを示します。 
        </p><p>
          サポートされている <em class="replaceable"><code>algorithm</code></em> 値: <code class="literal">'RSA'</code>、<code class="literal">'DSA'</code>
        </p><p>
          サポートされている <em class="replaceable"><code>digest_type</code></em> 値: <code class="literal">'SHA224'</code>、<code class="literal">'SHA256'</code>、<code class="literal">'SHA384'</code>、<code class="literal">'SHA512'</code>
        </p><pre class="programlisting">-- Set the encryption algorithm and digest type
SET @algo = 'RSA';
SET @dig_type = 'SHA224';

-- Create private/public key pair
SET @priv = create_asymmetric_priv_key(@algo, 1024);
SET @pub = create_asymmetric_pub_key(@algo, @priv);

-- Generate digest from string
SET @dig = create_digest(@dig_type, 'The quick brown fox');

-- Generate signature for digest and verify signature against digest
SET @sig = asymmetric_sign(@algo, @dig, @priv, @dig_type);
SET @verf = asymmetric_verify(@algo, @dig, @sig, @pub, @dig_type);
</pre></li><li class="listitem"><a name="function_create-asymmetric-priv-key"></a><p>
          <code class="literal">create_asymmetric_priv_key(<em class="replaceable"><code>algorithm</code></em>, {<em class="replaceable"><code>key_len</code></em>|<em class="replaceable"><code>dh_secret</code></em>})</code>
        </p><a class="indexterm" name="idm46723747883392"></a><p>
          指定されたアルゴリズムおよび鍵の長さまたは DH シークレットを使用して秘密鍵を作成し、その鍵を PEM 書式のバイナリ文字列として返します。 鍵の生成に失敗した場合は、結果が <code class="literal">NULL</code> になります。 
        </p><p>
          サポートされている <em class="replaceable"><code>algorithm</code></em> 値: <code class="literal">'RSA'</code>、<code class="literal">'DSA'</code>、<code class="literal">'DH'</code>
        </p><p>
          サポートされている <em class="replaceable"><code>key_len</code></em> 値: 最小の鍵の長さは 1,024 ビットです。 最大の鍵の長さはアルゴリズムによって異なり、RSA の場合は 16,384、DSA の場合は 10,000 です。 これらのキー長制限は、OpenSSL によって課される制約です。 サーバー管理者は、環境変数を設定することで、最大キー長に追加の制限を課すことができます。 <a class="xref" href="security.html#enterprise-encryption-usage" title="6.6.2 MySQL Enterprise Encryption の使用方法と例">セクション6.6.2「MySQL Enterprise Encryption の使用方法と例」</a>を参照してください。 
        </p><p>
          DH 鍵の場合は、キーの長さの代わりに、共有 DH シークレットを渡します。 シークレットを作成するには、キーの長さを <code class="literal">create_dh_parameters()</code> に渡します。 
        </p><p>
          この例では、2,048 ビットの DSA 秘密鍵を作成してから、その秘密鍵から公開鍵を導出します。
        </p><pre class="programlisting">SET @priv = create_asymmetric_priv_key('DSA', 2048);
SET @pub = create_asymmetric_pub_key('DSA', @priv);
</pre><p>
          DH 鍵の生成を示す例については、<code class="literal">asymmetric_derive()</code> の説明を参照してください。
        </p><p>
          鍵の長さと暗号化アルゴリズムを選択する際の一般的ないくつかの考慮事項は、次のとおりです。
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              鍵のサイズとともに、公開鍵と秘密鍵の暗号化強度が増加しますが、鍵の生成時間も同様に増加します。
            </p></li><li class="listitem"><p>
              DH 鍵の生成時間は、RSA 鍵または RSA 鍵よりも大幅に長くなります。
            </p></li><li class="listitem"><p>
              非対称暗号化関数は、対称関数よりも遅くなります。 パフォーマンスが重要な要素であり、その関数が非常に頻繁に使用される場合は、対称暗号化を使用した方が適切です。 たとえば、<code class="literal">AES_ENCRYPT()</code> および <code class="literal">AES_DECRYPT()</code> を使用することを検討してください。 
            </p></li></ul></div></li><li class="listitem"><a name="function_create-asymmetric-pub-key"></a><p>
          <code class="literal">create_asymmetric_pub_key(<em class="replaceable"><code>algorithm</code></em>, <em class="replaceable"><code>priv_key_str</code></em>)</code>
        </p><a class="indexterm" name="idm46723747855568"></a><p>
          指定されたアルゴリズムを使用して、指定された秘密鍵から公開鍵を導出し、その鍵を PEM 書式のバイナリ文字列として返します。 鍵の抽出に失敗した場合は、結果が <code class="literal">NULL</code> になります。 
        </p><p>
          <em class="replaceable"><code>priv_key_str</code></em> は、PEM 書式の有効な鍵文字列にする必要があります。<em class="replaceable"><code>algorithm</code></em> は、鍵を作成する際に使用された暗号化アルゴリズムを示します。
        </p><p>
          サポートされている <em class="replaceable"><code>algorithm</code></em> 値: <code class="literal">'RSA'</code>、<code class="literal">'DSA'</code>、<code class="literal">'DH'</code>
        </p><p>
          使用例については、<code class="literal">create_asymmetric_priv_key()</code> の説明を参照してください。
        </p></li><li class="listitem"><a name="function_create-dh-parameters"></a><p>
          <code class="literal">create_dh_parameters(<em class="replaceable"><code>key_len</code></em>)</code>
        </p><a class="indexterm" name="idm46723747840064"></a><p>
          DH 秘密キーと公開キーのペアを生成するための共有シークレットを作成し、<code class="literal">create_asymmetric_priv_key()</code> に渡すことができるバイナリ文字列を返します。 シークレットの生成に失敗した場合は、結果が NULL になります。 
        </p><p>
          サポートされている <em class="replaceable"><code>key_len</code></em> 値: 最小および最大の鍵の長さは、1,024 ビットおよび 10,000 ビットです。 これらのキー長制限は、OpenSSL によって課される制約です。 サーバー管理者は、環境変数を設定することで、最大キー長に追加の制限を課すことができます。 <a class="xref" href="security.html#enterprise-encryption-usage" title="6.6.2 MySQL Enterprise Encryption の使用方法と例">セクション6.6.2「MySQL Enterprise Encryption の使用方法と例」</a>を参照してください。 
        </p><p>
          対称キーの生成に戻り値を使用する方法を示す例は、<code class="literal">asymmetric_derive()</code> の説明を参照してください。
        </p><pre class="programlisting">SET @dhp = create_dh_parameters(1024);
</pre></li><li class="listitem"><a name="function_create-digest"></a><p>
          <code class="literal">create_digest(<em class="replaceable"><code>digest_type</code></em>, <em class="replaceable"><code>str</code></em>)</code>
        </p><a class="indexterm" name="idm46723747825424"></a><p>
          指定されたダイジェストタイプを使用して、指定された文字列からダイジェストを作成し、そのダイジェストをバイナリ文字列として返します。 ダイジェストの生成に失敗した場合は、結果が <code class="literal">NULL</code> になります。 
        </p><p>
          サポートされている <em class="replaceable"><code>digest_type</code></em> 値: <code class="literal">'SHA224'</code>、<code class="literal">'SHA256'</code>、<code class="literal">'SHA384'</code>、<code class="literal">'SHA512'</code>
        </p><pre class="programlisting">SET @dig = create_digest('SHA512', The quick brown fox');
</pre><p>
          生成されるダイジェスト文字列は、<code class="literal">asymmetric_sign()</code> および <code class="literal">asymmetric_verify()</code> での使用に適しています。
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="selinux"></a>6.7 SELinux</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#selinux-checking">6.7.1 SELinux が有効かどうかの確認</a></span></dt><dt><span class="section"><a href="security.html#selinux-mode">6.7.2 SELinux モードの変更</a></span></dt><dt><span class="section"><a href="security.html#selinux-policies">6.7.3 MySQL Server SELinux ポリシー</a></span></dt><dt><span class="section"><a href="security.html#selinux-file-context">6.7.4 SELinux ファイルコンテキスト</a></span></dt><dt><span class="section"><a href="security.html#selinux-context-tcp-port">6.7.5 SELinux TCP ポートコンテキスト</a></span></dt><dt><span class="section"><a href="security.html#selinux-troubleshooting">6.7.6 SELinux のトラブルシューティング</a></span></dt></dl></div><a class="indexterm" name="idm46723747811264"></a><p>
    セキュリティ強化された Linux (SELinux) は、<span class="emphasis"><em>SELinux コンテキスト</em></span>と呼ばれるセキュリティラベルを各システムオブジェクトに適用することでアクセス権を実装する必須アクセス制御 (MAC) システムです。 SELinux ポリシーモジュールは、SELinux コンテキストを使用して、プロセス、ファイル、ポートおよびその他のシステムオブジェクトが相互作用する方法のルールを定義します。 システムオブジェクト間の相互作用は、ポリシールールで許可されている場合にのみ許可されます。 
  </p><p>
    SELinux コンテキスト (システムオブジェクトに適用されるラベル) には、次のフィールドがあります: <code class="literal">user</code>, <code class="literal">role</code>, <code class="literal">type</code> および <code class="literal">security level</code>。 SELinux コンテキスト全体ではなく型情報は、プロセスが他のシステムオブジェクトと相互作用する方法のルールを定義するために最も一般的に使用されます。 たとえば、MySQL SELinux ポリシーモジュールでは、<code class="literal">type</code> 情報を使用してポリシールールを定義します。 
  </p><p>
    <span class="command"><strong>ls</strong></span> や <span class="command"><strong>ps</strong></span> などのオペレーティングシステムコマンドを <code class="literal">-Z</code> オプションとともに使用して、SELinux コンテキストを表示できます。 SELinux が有効で、MySQL Server が実行されている場合、次のコマンドは <span class="command"><strong>mysqld</strong></span> プロセスおよび MySQL データディレクトリの SELinux コンテキストを表示します: 
  </p><p>
    <span class="command"><strong>mysqld</strong></span> プロセス:
  </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>ps -eZ | grep mysqld</code></strong>
system_u:system_r:mysqld_t:s0    5924 ?        00:00:03 mysqld</pre><p>
    MySQL データディレクトリ:
  </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>cd /var/lib</code></strong>
shell&gt; <strong class="userinput"><code>ls -Z | grep mysql</code></strong>
system_u:object_r:mysqld_db_t:s0 mysql
</pre><p>
    ここでは:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">system_u</code> は、システムプロセスおよびオブジェクトの SELinux ユーザーアイデンティティです。
      </p></li><li class="listitem"><p>
        <code class="literal">system_r</code> は、システムプロセスに使用される SELinux ロールです。
      </p></li><li class="listitem"><p>
        <code class="literal">objects_r</code> は、システムオブジェクトに使用される SELinux ロールです。
      </p></li><li class="listitem"><p>
        <code class="literal">mysqld_t</code> は mysqld プロセスに関連付けられたタイプです。
      </p></li><li class="listitem"><p>
        <code class="literal">mysqld_db_t</code> は、MySQL データディレクトリとそのファイルに関連付けられたタイプです。
      </p></li><li class="listitem"><p>
        <code class="literal">s0</code> はセキュリティレベルです。
      </p></li></ul></div><p>
    SELinux コンテキストの解釈の詳細は、ディストリビューションの SELinux ドキュメントを参照してください。
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="selinux-checking"></a>6.7.1 SELinux が有効かどうかの確認</h3></div></div></div><a class="indexterm" name="idm46723747780832"></a><p>
      Oracle Linux、RHEL、CentOS、Fedora などの一部の Linux ディストリビューションでは、SELinux がデフォルトで有効になっています。 <span class="command"><strong>sestatus</strong></span> コマンドを使用して、ディストリビューションで SELinux が有効になっているかどうかを確認します: 
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>sestatus</code></strong>
SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   enforcing
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Memory protection checking:     actual (secure)
Max kernel policy version:      31
</pre><p>
      SELinux が無効になっているか、<span class="command"><strong>sestatus</strong></span> コマンドが見つからない場合は、SELinux を有効にする前にディストリビューションの SELinux ドキュメントを参照してガイダンスを確認してください。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="selinux-mode"></a>6.7.2 SELinux モードの変更</h3></div></div></div><a class="indexterm" name="idm46723747772048"></a><p>
      SELinux は、強制モード、許可モードおよび無効モードをサポートしています。 Enforcing モードがデフォルトです。 許可モードでは、強制モードで許可されていない操作が許可され、それらの操作が SELinux 監査ログに記録されます。 通常、許可モードはポリシーの開発時またはトラブルシューティング時に使用されます。 無効モードでは、ポリシーは強制されず、コンテキストはシステムオブジェクトに適用されないため、後で SELinux を有効にすることは困難です。 
    </p><p>
      現在の SELinux モードを表示するには、前述の <span class="command"><strong>sestatus</strong></span> コマンドまたは <span class="command"><strong>getenforce</strong></span> ユーティリティを使用します。
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>getenforce</code></strong>
Enforcing
</pre><p>
      SELinux モードを変更するには、<code class="literal">setenforce</code> ユーティリティを使用します:
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>setenforce 0</code></strong>
shell&gt; <strong class="userinput"><code>getenforce</code></strong>
Permissive
</pre><pre class="programlisting">shell&gt; <strong class="userinput"><code>setenforce 1</code></strong>
shell&gt; <strong class="userinput"><code>getenforce</code></strong>
Enforcing
</pre><p>
      <span class="command"><strong>setenforce</strong></span> で行われた変更は、システムを再起動すると失われます。 SELinux モードを永続的に変更するには、<code class="filename">/etc/selinux/config</code> ファイルを編集してシステムを再起動します。 
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="selinux-policies"></a>6.7.3 MySQL Server SELinux ポリシー</h3></div></div></div><a class="indexterm" name="idm46723747754960"></a><p>
      通常、MySQL Server SELinux ポリシーモジュールはデフォルトでインストールされます。 <span class="command"><strong>semodule -l</strong></span> コマンドを使用して、インストールされているモジュールを表示できます。 MySQL Server SELinux ポリシーモジュールには、次のものがあります: 
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">myqld_selinux</code>
        </p></li><li class="listitem"><p>
          <code class="literal">myqld_safe_selinux</code>
        </p></li></ul></div><p>
      MySQL Server SELinux ポリシーモジュールの詳細は、SELinux マニュアルページを参照してください。 マニュアルページには、MySQL サービスに関連付けられたタイプおよびブールに関する情報が表示されます。 マニュアルページには、<code class="literal"><em class="replaceable"><code>service-name</code></em>_selinux</code> 形式で名前が付けられます。 
    </p><pre class="programlisting">man mysqld_selinux</pre><p>
      SELinux のマニュアルページが使用できない場合は、<code class="literal">sepolicy manpage</code> ユーティリティーを使用してマニュアルページを生成する方法について、配布 SELinux のドキュメントを参照してください。
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="selinux-file-context"></a>6.7.4 SELinux ファイルコンテキスト</h3></div></div></div><a class="indexterm" name="idm46723747742176"></a><p>
      MySQL Server は、多くのファイルに対して読取りおよび書込みを行います。 これらのファイルに対して SELinux コンテキストが正しく設定されていない場合、ファイルへのアクセスが拒否される可能性があります。 
    </p><p>
      次の手順では、<code class="literal">semanage</code> バイナリを使用してファイルコンテキストを管理します。RHEL では、これは <code class="literal">policycoreutils-python-utils</code> パッケージの一部です:
    </p><pre class="programlisting">yum install -y policycoreutils-python-utils
</pre><p>
      <code class="literal">semanage</code> バイナリをインストールした後、<code class="literal">semanage</code> と <code class="literal">fcontext</code> オプションを使用して MySQL ファイルコンテキストをリストできます。
    </p><pre class="programlisting">semanage fcontext -l | grep -i mysql
</pre><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-context-data-dir"></a>MySQL データディレクトリコンテキストの設定</h4></div></div></div><a class="indexterm" name="idm46723747731168"></a><p>
        デフォルトのデータディレクトリの場所は<code class="filename">/var/lib/mysql/</code>で、使用される SELinux コンテキストは <code class="literal">mysqld_db_t</code> です。
      </p><p>
        構成ファイルを編集して、データディレクトリまたはデータディレクトリ内の通常のファイル (バイナリログなど) に別の場所を使用する場合は、新しい場所のコンテキストを設定する必要がある場合があります。 例: 
      </p><pre class="programlisting">semanage fcontext -a -t mysqld_db_t "/path/to/my/custom/datadir(/.*)?"
restorecon -Rv /path/to/my/custom/datadir

semanage fcontext -a -t mysqld_db_t "/path/to/my/custom/logdir(/.*)?"
restorecon -Rv /path/to/my/custom/logdir
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-context-error-log"></a>MySQL エラーログファイルコンテキストの設定</h4></div></div></div><a class="indexterm" name="idm46723747723648"></a><p>
        RedHat RPM のデフォルトの場所は<code class="filename">/var/log/mysqld.log</code> で、使用される SELinux コンテキストタイプは <code class="literal">mysqld_log_t</code> です。
      </p><p>
        構成ファイルを編集して別の場所を使用する場合は、新しい場所のコンテキストを設定する必要がある場合があります。 例: 
      </p><pre class="programlisting">semanage fcontext -a -t mysqld_log_t "/path/to/my/custom/error.log"
restorecon -Rv /path/to/my/custom/error.log
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-context-pid-file"></a>PID ファイルコンテキストの設定</h4></div></div></div><a class="indexterm" name="idm46723747716544"></a><p>
        PID ファイルのデフォルトの場所は<code class="filename">/var/run/mysqld/mysqld.pid</code> で、使用される SELinux コンテキストタイプは <code class="literal">mysqld_var_run_t</code> です。
      </p><p>
        構成ファイルを編集して別の場所を使用する場合は、新しい場所のコンテキストを設定する必要がある場合があります。 例: 
      </p><pre class="programlisting">semanage fcontext -a -t mysqld_var_run_t "/path/to/my/custom/pidfile/directory/.*?"
restorecon -Rv /path/to/my/custom/pidfile/directory
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-context-unix-domain-socket"></a>Unix ドメインソケットコンテキストの設定</h4></div></div></div><a class="indexterm" name="idm46723747709344"></a><p>
        Unix ドメインソケットのデフォルトの場所は<code class="filename">/var/lib/mysql/mysql.sock</code> で、使用される SELinux コンテキストタイプは <code class="literal">mysqld_var_run_t</code> です。
      </p><p>
        構成ファイルを編集して別の場所を使用する場合は、新しい場所のコンテキストを設定する必要がある場合があります。 例: 
      </p><pre class="programlisting">semanage fcontext -a -t mysqld_var_run_t "/path/to/my/custom/mysql\.sock"
restorecon -Rv /path/to/my/custom/mysql.sock
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-context-secure-file-priv"></a>secure_file_priv ディレクトリコンテキストの設定</h4></div></div></div><a class="indexterm" name="idm46723747702144"></a><p>
        5.6.34、5.7.16 および 8.0.11 以降の MySQL バージョンの場合。
      </p><p>
        MySQL Server RPM をインストールすると、<code class="filename">/var/lib/mysql-files/</code>ディレクトリが作成されますが、SELinux コンテキストは設定されません。 <code class="filename">/var/lib/mysql-files/</code>ディレクトリは、<code class="literal">SELECT ... INTO OUTFILE</code> などの操作に使用されます。 
      </p><p>
        <code class="literal">secure_file_priv</code> を設定してこのディレクトリの使用を有効にした場合、次のようにコンテキストを設定する必要がある場合があります:
      </p><pre class="programlisting">semanage fcontext -a -t mysqld_db_t "/var/lib/mysql-files/(/.*)?"
restorecon -Rv /var/lib/mysql-files
</pre><p>
        別の場所を使用した場合は、このパスを編集します。 セキュリティ上の理由から、このディレクトリはデータディレクトリ内にあってはなりません。 
      </p><p>
        この変数の詳細は、<code class="literal">secure_file_priv</code> のドキュメントを参照してください。
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="selinux-context-tcp-port"></a>6.7.5 SELinux TCP ポートコンテキスト</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="security.html#selinux-context-mysqld-tcp-port">6.7.5.1 mysqld の TCP ポートコンテキストの設定</a></span></dt><dt><span class="section"><a href="security.html#selinux-context-mysql-feature-ports">6.7.5.2 MySQL 機能の TCP ポートコンテキストの設定</a></span></dt></dl></div><a class="indexterm" name="idm46723747690432"></a><p>
      次の手順では、<code class="literal">semanage</code> バイナリを使用してポートコンテキストを管理します。RHEL では、これは <code class="literal">policycoreutils-python-utils</code> パッケージの一部です:
    </p><pre class="programlisting">yum install -y policycoreutils-python-utils
</pre><p>
      <code class="literal">semanage</code> バイナリをインストールした後、<code class="literal">semanage</code> を <code class="literal">port</code> オプションとともに使用して、<code class="literal">mysqld_port_t</code> コンテキストで定義されたポートをリストできます。
    </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>semanage port -l | grep mysqld</code></strong>
mysqld_port_t                  tcp      1186, 3306, 63132-63164
</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-context-mysqld-tcp-port"></a>6.7.5.1 mysqld の TCP ポートコンテキストの設定</h4></div></div></div><a class="indexterm" name="idm46723747678864"></a><p>
        <span class="command"><strong>mysqld</strong></span> のデフォルトの TCP ポートは <code class="literal">3306</code> で、使用される SELinux コンテキストタイプは <code class="literal">mysqld_port_t</code> です。
      </p><p>
        別の TCP <code class="literal">port</code> を使用するように <span class="command"><strong>mysqld</strong></span> を構成する場合は、新しいポートのコンテキストを設定する必要がある場合があります。 たとえば、ポート 3307 など、デフォルト以外のポートの SELinux コンテキストを定義するには、次のようにします: 
      </p><pre class="programlisting">semanage port -a -t mysqld_port_t -p tcp 3307
</pre><p>
        ポートが追加されたことを確認するには:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>semanage port -l | grep mysqld</code></strong>
mysqld_port_t                  tcp      3307, 1186, 3306, 63132-63164
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-context-mysql-feature-ports"></a>6.7.5.2 MySQL 機能の TCP ポートコンテキストの設定</h4></div></div></div><a class="indexterm" name="idm46723747666848"></a><p>
        特定の MySQL 機能を有効にする場合は、それらの機能で使用される追加ポートの SELinux TCP ポートコンテキストの設定が必要になることがあります。 MySQL 機能で使用されるポートに正しい SELinux コンテキストがない場合、機能が正しく機能しない可能性があります。 
      </p><p>
        次の各セクションでは、MySQL 機能のポートコンテキストを設定する方法について説明します。 通常、同じメソッドを使用して、MySQL 機能のポートコンテキストを設定できます。 MySQL 機能で使用されるポートの詳細は、<a class="ulink" href="https://dev.mysql.com/doc/mysql-port-reference/en/" target="_top">MySQL Port Reference</a> を参照してください。 
      </p><p>
        MySQL 8.0.14 から MySQL 8.0.17 へ、<code class="literal">mysql_connect_any</code> SELinux ブールを <code class="literal">ON</code> に設定する必要があります。 MySQL 8.0.18 では、<code class="literal">mysql_connect_any</code> の有効化は必須ではなく、推奨されません。 
      </p><pre class="programlisting">setsebool -P mysql_connect_any=ON
</pre><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="selinux-context-group-replication-port"></a>グループレプリケーションの TCP ポートコンテキストの設定</h5></div></div></div><a class="indexterm" name="idm46723747656272"></a><p>
          SELinux が有効な場合は、<code class="literal">group_replication_local_address</code> 変数で定義されている Group Replication 通信ポートのポートコンテキストを設定する必要があります。<span class="command"><strong>mysqld</strong></span> は、Group Replication 通信ポートにバインドし、そこでリスニングできる必要があります。InnoDB クラスタ はグループレプリケーションに依存するため、これはクラスタで使用されるインスタンスにも同様に適用されます。 MySQL で現在使用されているポートを表示するには、次のコマンドを発行します: 
        </p><pre class="programlisting">semanage port -l | grep mysqld
</pre><p>
          Group Replication 通信ポートが 33061 の場合は、次を発行してポートコンテキストを設定します:
        </p><pre class="programlisting">semanage port -a -t mysqld_port_t -p tcp 33061
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="selinux-context-document-store-ports"></a>ドキュメントストアの TCP ポートコンテキストの設定</h5></div></div></div><a class="indexterm" name="idm46723747647392"></a><p>
          SELinux が有効になっている場合は、<code class="literal">mysqlx_port</code> 変数で定義されている X プラグイン で使用される通信ポートのポートコンテキストを設定する必要があります。<span class="command"><strong>mysqld</strong></span> は、X プラグイン 通信ポートにバインドし、そこでリスニングできる必要があります。
        </p><p>
          X プラグイン 通信ポートが 33060 の場合は、次を発行してポートコンテキストを設定します:
        </p><pre class="programlisting">semanage port -a -t mysqld_port_t -p tcp 33060
</pre></div><div class="simplesect"><div class="titlepage"><div><div><h5 class="title"><a name="selinux-context-router-ports"></a>MySQL Router の TCP ポートコンテキストの設定</h5></div></div></div><a class="indexterm" name="idm46723747639680"></a><p>
          SELinux が有効な場合は、MySQL Router で使用される通信ポートのポートコンテキストを設定する必要があります。 MySQL Router で使用される追加の通信ポートがデフォルトの 6446、6447、64460 および 64470 であると仮定すると、各インスタンスで次を発行してポートコンテキストを設定します: 
        </p><pre class="programlisting">semanage port -a -t mysqld_port_t -p tcp 6446
semanage port -a -t mysqld_port_t -p tcp 6447
semanage port -a -t mysqld_port_t -p tcp 64460
semanage port -a -t mysqld_port_t -p tcp 64470
</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="selinux-troubleshooting"></a>6.7.6 SELinux のトラブルシューティング</h3></div></div></div><a class="indexterm" name="idm46723747634016"></a><p>
      SELinux のトラブルシューティングでは、通常、SELinux を許容モードにし、問題のある操作を再実行し、SELinux 監査ログでアクセス拒否メッセージをチェックし、問題が解決した後に SELinux を強制モードに戻します。
    </p><p>
      <span class="command"><strong>setenforce</strong></span> を使用してシステム全体を許可モードにしないようにするには、<span class="command"><strong>semanage</strong></span> コマンドを使用して SELinux ドメイン (<code class="filename">mysqld_t</code>) を許可モードにすることで、MySQL サービスのみを許可できます:
    </p><pre class="programlisting">semanage permissive -a mysqld_t</pre><p>
      トラブルシューティングが終了したら、次のコマンドを使用して <code class="literal">mysqld_t</code> ドメインを強制モードに戻します:
    </p><pre class="programlisting">semanage permissive -d mysqld_t</pre><p>
      SELinux は、拒否された操作のログを<code class="filename">/var/log/audit/audit.log</code> に書き込みます。 拒否を確認するには、<span class="quote">「<span class="quote">「拒否」</span>」</span>メッセージを検索します。 
    </p><pre class="programlisting">grep "denied" /var/log/audit/audit.log</pre><p>
      次の各セクションでは、SELinux 関連の問題が発生する可能性のあるいくつかの一般的な領域について説明します。
    </p><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-troubleshooting-file-contexts"></a>ファイルコンテキスト</h4></div></div></div><p>
        MySQL ディレクトリまたはファイルの SELinux コンテキストが正しくない場合、アクセスが拒否される可能性があります。 この問題は、MySQL がデフォルト以外のディレクトリまたはファイルに対して読取りまたは書込みを行うように構成されている場合に発生することがあります。 たとえば、デフォルト以外のデータディレクトリを使用するように MySQL を構成する場合、ディレクトリには予期される SELinux コンテキストがない可能性があります。 
      </p><p>
        無効な SELinux コンテキストを持つデフォルト以外のデータディレクトリで MySQL サービスを起動しようとすると、次の起動が失敗します。
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>systemctl start mysql.service</code></strong>
Job for mysqld.service failed because the control process exited with error code.
See "systemctl status mysqld.service" and "journalctl -xe" for details.
</pre><p>
        この場合、<span class="quote">「<span class="quote">否認</span>」</span>メッセージは<code class="filename">/var/log/audit/audit.log</code> に記録されます:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>grep "denied" /var/log/audit/audit.log</code></strong>
type=AVC msg=audit(1587133719.786:194): avc:  denied  { write } for  pid=7133 comm="mysqld"
name="mysql" dev="dm-0" ino=51347078 scontext=system_u:system_r:mysqld_t:s0
tcontext=unconfined_u:object_r:default_t:s0 tclass=dir permissive=0
</pre><p>
        MySQL ディレクトリおよびファイルに対する適切な SELinux コンテキストの設定の詳細は、<a class="xref" href="security.html#selinux-file-context" title="6.7.4 SELinux ファイルコンテキスト">セクション6.7.4「SELinux ファイルコンテキスト」</a> を参照してください。
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-troubleshooting-port-access"></a>ポートアクセス</h4></div></div></div><p>
        SELinux は、MySQL Server などのサービスが特定のポートを使用することを想定しています。 SELinux ポリシーを更新せずにポートを変更すると、サービス障害が発生する場合があります。 
      </p><p>
        <code class="literal">mysqld_port_t</code> ポートタイプは、MySQL がリスニングするポートを定義します。 ポート 3307 などのデフォルト以外のポートを使用するように MySQL Server を構成し、変更を反映するようにポリシーを更新しない場合、MySQL サービスは起動に失敗します: 
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>systemctl start mysqld.service</code></strong>
Job for mysqld.service failed because the control process exited with error code.
See "systemctl status mysqld.service" and "journalctl -xe" for details.
</pre><p>
        この場合、拒否メッセージが<code class="filename">/var/log/audit/audit.log</code> に記録されます:
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>grep "denied" /var/log/audit/audit.log</code></strong>
type=AVC msg=audit(1587134375.845:198): avc:  denied  { name_bind } for  pid=7340
comm="mysqld" src=3307 scontext=system_u:system_r:mysqld_t:s0
tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket permissive=0
</pre><p>
        MySQL の適切な SELinux ポートコンテキストの設定の詳細は、<a class="xref" href="security.html#selinux-context-tcp-port" title="6.7.5 SELinux TCP ポートコンテキスト">セクション6.7.5「SELinux TCP ポートコンテキスト」</a> を参照してください。 必要なコンテキストで定義されていないポートを使用する MySQL 機能を有効にすると、同様のポートアクセスの問題が発生する可能性があります。 詳細は、<a class="xref" href="security.html#selinux-context-mysql-feature-ports" title="6.7.5.2 MySQL 機能の TCP ポートコンテキストの設定">セクション6.7.5.2「MySQL 機能の TCP ポートコンテキストの設定」</a>を参照してください。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h4 class="title"><a name="selinux-troubleshooting-app-changes"></a>アプリケーションの変更</h4></div></div></div><p>
        SELinux は、アプリケーションの変更を認識しない場合があります。 たとえば、新しいリリース、アプリケーション拡張機能または新機能が SELinux で許可されていない方法でシステムリソースにアクセスすると、アクセスが拒否される場合があります。 このような場合は、<span class="command"><strong>audit2allow</strong></span> ユーティリティを使用して、必要に応じてアクセスを許可するカスタムポリシーを作成できます。 カスタムポリシーを作成する一般的な方法は、SELinux モードを permissive に変更し、SELinux 監査ログでアクセス拒否メッセージを識別し、<span class="command"><strong>audit2allow</strong></span> ユーティリティを使用してアクセスを許可するカスタムポリシーを作成することです。 
      </p><p>
        <span class="command"><strong>audit2allow</strong></span> ユーティリティの使用の詳細は、ディストリビューションの SELinux ドキュメントを参照してください。
      </p><p>
        標準の MySQL SELinux ポリシーモジュールで処理する必要があると思われる MySQL のアクセスの問題が発生した場合は、配布バグ追跡システムでバグレポートを開きます。
      </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="fips-mode"></a>6.8 FIPS のサポート</h2></div></div></div><a class="indexterm" name="idm46723747591328"></a><a class="indexterm" name="idm46723747589888"></a><a class="indexterm" name="idm46723747587840"></a><p>
      OpenSSL 1.0.2 を使用してコンパイルされた場合、MySQL は FIPS モードをサポートし、OpenSSL ライブラリおよび FIPS オブジェクトモジュールを実行時に使用できます。
    </p><p>
      サーバー側の FIPS モードは、サーバーによって実行される暗号化操作に適用されます。 これには、サーバー内で実行されるレプリケーション (ソース/レプリカおよびグループレプリケーション) および X プラグインが含まれます。 FIPS モードは、クライアントによるサーバーへの接続試行にも適用されます。 
    </p><p>
      次の各セクションでは、FIPS モードと、MySQL 内で FIPS モードを利用する方法について説明します:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#fips-overview" title="FIPS の概要">FIPS の概要</a></p></li><li class="listitem"><p><a class="xref" href="security.html#fips-system-requirements" title="MySQL での FIPS モードのシステム要件">MySQL での FIPS モードのシステム要件</a></p></li><li class="listitem"><p><a class="xref" href="security.html#fips-configuration" title="MySQL での FIPS モードの構成">MySQL での FIPS モードの構成</a></p></li></ul></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="fips-overview"></a>FIPS の概要</h3></div></div></div><p>
        Federal Information Processing Standards 140-2 (FIPS 140-2) では、機密情報または貴重な情報を保護するために使用される暗号化モジュールのために連邦政府 (US Government) 機関で必要とされるセキュリティ標準について説明します。 このような連邦政府で使用できるとみなされるには、FIPS 140-2 で暗号化モジュールが動作保証されている必要があります。 機密データを保護するシステムに適切な FIPS 140-2 証明書がない場合、連邦政府機関はそれを購入できません。 
      </p><p>
        OpenSSL などの製品は FIPS モードで使用できますが、OpenSSL ライブラリ自体は FIPS に対して検証されません。 かわりに、OpenSSL ライブラリを OpenSSL FIPS オブジェクトモジュールとともに使用して、OpenSSL ベースのアプリケーションが FIPS モードで動作できるようにします。 
      </p><p>
        FIPS と OpenSSL でのその実装に関する一般的な情報については、次の参考資料を参照してください:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="ulink" href="https://doi.org/10.6028/NIST.FIPS.140-2" target="_top">国立標準技術研究所 FIPS PUB 140-2</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://www.openssl.org/docs/fips/" target="_top">OpenSSL FIPS 140-2 のセキュリティポリシー</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://www.openssl.org/docs/fips/UserGuide-2.0.pdf" target="_top">OpenSSL FIPS Object Module v 2.0 のユーザーガイド</a>
          </p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          FIPS モードでは、許容される暗号化アルゴリズムの制限や長いキー長の要件などの暗号化操作に条件が適用されます。 OpenSSL の場合、FIPS の正確な動作は OpenSSL のバージョンによって異なります。 詳細は、OpenSSL FIPS User Guide を参照してください。 
        </p></div></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="fips-system-requirements"></a>MySQL での FIPS モードのシステム要件</h3></div></div></div><p>
        MySQL で FIPS モードをサポートするには、次のシステム要件を満たす必要があります:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            ビルド時に、MySQL は OpenSSL を使用してコンパイルする必要があります。 コンパイルで OpenSSL とは異なる SSL ライブラリが使用されている場合、FIPS モードは MySQL では使用できません。 
          </p><p>
            また、FIPS での使用が動作保証されている OpenSSL バージョンで MySQL をコンパイルする必要があります。 OpenSSL 1.0.2 は認定されていますが、OpenSSL 1.1.1 は認定されていません。 最新バージョンの MySQL のバイナリディストリビューションは、一部のプラットフォームでは OpenSSL 1.1.1 を使用してコンパイルされます。つまり、FIPS に対して動作保証されていません。 これにより、システムおよび MySQL の構成に応じて、使用可能な MySQL 機能がトレードオフされます: 
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                OpenSSL 1.0.2 および必要な FIPS オブジェクトモジュールを備えたシステムを使用します。 この場合、OpenSSL 1.0.2 を使用してコンパイルされたバイナリ配布を使用するか、OpenSSL 1.0.2 を使用してソースから MySQL をコンパイルすると、MySQL の FIPS モードを有効にできます。 ただし、この場合、TLSv1.3 プロトコルまたは暗号スイート (OpenSSL 1.1.1 が必要) は使用できません。 さらに、2019 年末に End of Life ステータスに達した OpenSSL バージョンを使用しています。 
              </p></li><li class="listitem"><p>
                OpenSSL 1.1.1 以上のシステムを使用します。 この場合、バイナリパッケージを使用して MySQL をインストールでき、すでにサポートされている他の TLS プロトコルに加えて、TLSv1.3 プロトコルおよび暗号スイートを使用できます。 ただし、MySQL で FIPS モードを有効にすることはできません。 
              </p></li></ul></div></li><li class="listitem"><p>
            実行時に、OpenSSL ライブラリおよび OpenSSL FIPS オブジェクトモジュールが共有 (動的にリンクされた) オブジェクトとして使用可能である必要があります。 静的にリンクされた OpenSSL オブジェクトは構築できますが、MySQL では使用できません。 
          </p></li></ul></div><p>
        FIPS モードは、EL7 上の MySQL に対してテストされていますが、他のシステムでも動作する可能性があります。
      </p><p>
        プラットフォームまたはオペレーティングシステムで OpenSSL FIPS オブジェクトモジュールが提供されている場合は、それを使用できます。 それ以外の場合は、ソースから OpenSSL ライブラリおよび FIPS オブジェクトモジュールをビルドできます。 OpenSSL FIPS ユーザーガイド (<a class="xref" href="security.html#fips-overview" title="FIPS の概要">FIPS の概要</a> を参照) の手順を使用します。 
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="fips-configuration"></a>MySQL での FIPS モードの構成</h3></div></div></div><p>
        MySQL では、サーバー側とクライアント側で FIPS モードを制御できます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">ssl_fips_mode</code> システム変数は、サーバーが FIPS モードで動作するかどうかを制御します。
          </p></li><li class="listitem"><p>
            <code class="option">--ssl-fips-mode</code> クライアントオプションは、特定の MySQL クライアントが FIPS モードで動作するかどうかを制御します。
          </p></li></ul></div><p>
        <code class="literal">ssl_fips_mode</code> システム変数および <code class="option">--ssl-fips-mode</code> クライアントオプションでは、次の値が許可されます:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">OFF</code>: FIPS モードを無効にします。
          </p></li><li class="listitem"><p>
            <code class="literal">ON</code>: FIPS モードを有効にします。
          </p></li><li class="listitem"><p>
            <code class="literal">STRICT</code>: <span class="quote">「<span class="quote">strict</span>」</span> FIPS モードを有効にします。
          </p></li></ul></div><p>
        サーバー側では、<code class="literal">ssl_fips_mode</code> の数値 0、1 および 2 は <code class="literal">OFF</code>、<code class="literal">ON</code> および <code class="literal">STRICT</code> と同等です。
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">重要</div><p>
          一般に、<code class="literal">STRICT</code> には <code class="literal">ON</code> よりも多くの制限がありますが、MySQL 自体には FIPS モード値を OpenSSL に指定する以外に FIPS 固有のコードはありません。 <code class="literal">ON</code> または <code class="literal">STRICT</code> の FIPS モードの正確な動作は、OpenSSL のバージョンによって異なります。 詳細は、OpenSSL FIPS ユーザーガイド (<a class="xref" href="security.html#fips-overview" title="FIPS の概要">FIPS の概要</a> を参照) を参照してください。 
        </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">注記</div><p>
          OpenSSL FIPS オブジェクトモジュールが使用できない場合、<code class="literal">ssl_fips_mode</code> および <code class="option">--ssl-fips-mode</code> で許可される値は <code class="literal">OFF</code> のみです。 FIPS モードを別の値に設定しようとすると、エラーが発生します。 
        </p></div><p>
        サーバー側の FIPS モードは、サーバーによって実行される暗号化操作に適用されます。 これには、サーバー内で実行されるレプリケーション (ソース/レプリカおよびグループレプリケーション) および X プラグインが含まれます。 
      </p><p>
        FIPS モードは、クライアントによるサーバーへの接続試行にも適用されます。 有効にすると、クライアント側またはサーバー側のいずれかで、サポートされている暗号化方式のどれを選択できるかが制限されます。 ただし、FIPS モードを有効にする場合、暗号化された接続を使用する必要はありません。また、ユーザー資格証明を暗号化する必要もあります。 たとえば、FIPS モードが有効になっている場合は、より強力な暗号化アルゴリズムが必要です。 特に、MD5 は制限されているため、<code class="literal">RC4-MD5</code> などの暗号化暗号を使用して暗号化された接続を確立しようとしても機能しません。 ただし、FIPS モードには、暗号化されていない接続の確立を妨げるものはありません。 (これを行うには、特定のユーザーアカウントに対して <code class="literal">CREATE USER</code> または <code class="literal">ALTER USER</code> の <code class="literal">REQUIRE</code> 句を使用するか、すべてのアカウントに影響するように <code class="literal">require_secure_transport</code> システム変数を設定します。) 
      </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="server-administration.html">前</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="backup-and-recovery.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第 5 章 MySQL サーバーの管理 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 第 7 章 バックアップとリカバリ</td></tr></table></div><div class="copyright-footer"></div></body></html>
